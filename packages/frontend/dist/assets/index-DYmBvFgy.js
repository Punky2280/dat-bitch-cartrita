(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Jhe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var e_={exports:{}},Hh={},t_={exports:{}},Zt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vM;function $O(){if(vM)return Zt;vM=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;function m(z){return z===null||typeof z!="object"?null:(z=p&&z[p]||z["@@iterator"],typeof z=="function"?z:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,b={};function _(z,Y,se){this.props=z,this.context=Y,this.refs=b,this.updater=se||g}_.prototype.isReactComponent={},_.prototype.setState=function(z,Y){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,Y,"setState")},_.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function x(){}x.prototype=_.prototype;function N(z,Y,se){this.props=z,this.context=Y,this.refs=b,this.updater=se||g}var T=N.prototype=new x;T.constructor=N,y(T,_.prototype),T.isPureReactComponent=!0;var S=Array.isArray,M=Object.prototype.hasOwnProperty,C={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function F(z,Y,se){var J,q={},Q=null,te=null;if(Y!=null)for(J in Y.ref!==void 0&&(te=Y.ref),Y.key!==void 0&&(Q=""+Y.key),Y)M.call(Y,J)&&!R.hasOwnProperty(J)&&(q[J]=Y[J]);var X=arguments.length-2;if(X===1)q.children=se;else if(1<X){for(var ce=Array(X),me=0;me<X;me++)ce[me]=arguments[me+2];q.children=ce}if(z&&z.defaultProps)for(J in X=z.defaultProps,X)q[J]===void 0&&(q[J]=X[J]);return{$$typeof:n,type:z,key:Q,ref:te,props:q,_owner:C.current}}function k(z,Y){return{$$typeof:n,type:z.type,key:Y,ref:z.ref,props:z.props,_owner:z._owner}}function D(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}function P(z){var Y={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(se){return Y[se]})}var G=/\/+/g;function $(z,Y){return typeof z=="object"&&z!==null&&z.key!=null?P(""+z.key):Y.toString(36)}function U(z,Y,se,J,q){var Q=typeof z;(Q==="undefined"||Q==="boolean")&&(z=null);var te=!1;if(z===null)te=!0;else switch(Q){case"string":case"number":te=!0;break;case"object":switch(z.$$typeof){case n:case e:te=!0}}if(te)return te=z,q=q(te),z=J===""?"."+$(te,0):J,S(q)?(se="",z!=null&&(se=z.replace(G,"$&/")+"/"),U(q,Y,se,"",function(me){return me})):q!=null&&(D(q)&&(q=k(q,se+(!q.key||te&&te.key===q.key?"":(""+q.key).replace(G,"$&/")+"/")+z)),Y.push(q)),1;if(te=0,J=J===""?".":J+":",S(z))for(var X=0;X<z.length;X++){Q=z[X];var ce=J+$(Q,X);te+=U(Q,Y,se,ce,q)}else if(ce=m(z),typeof ce=="function")for(z=ce.call(z),X=0;!(Q=z.next()).done;)Q=Q.value,ce=J+$(Q,X++),te+=U(Q,Y,se,ce,q);else if(Q==="object")throw Y=String(z),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.");return te}function K(z,Y,se){if(z==null)return z;var J=[],q=0;return U(z,J,"","",function(Q){return Y.call(se,Q,q++)}),J}function O(z){if(z._status===-1){var Y=z._result;Y=Y(),Y.then(function(se){(z._status===0||z._status===-1)&&(z._status=1,z._result=se)},function(se){(z._status===0||z._status===-1)&&(z._status=2,z._result=se)}),z._status===-1&&(z._status=0,z._result=Y)}if(z._status===1)return z._result.default;throw z._result}var j={current:null},L={transition:null},B={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:L,ReactCurrentOwner:C};function V(){throw Error("act(...) is not supported in production builds of React.")}return Zt.Children={map:K,forEach:function(z,Y,se){K(z,function(){Y.apply(this,arguments)},se)},count:function(z){var Y=0;return K(z,function(){Y++}),Y},toArray:function(z){return K(z,function(Y){return Y})||[]},only:function(z){if(!D(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},Zt.Component=_,Zt.Fragment=t,Zt.Profiler=i,Zt.PureComponent=N,Zt.StrictMode=r,Zt.Suspense=l,Zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,Zt.act=V,Zt.cloneElement=function(z,Y,se){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var J=y({},z.props),q=z.key,Q=z.ref,te=z._owner;if(Y!=null){if(Y.ref!==void 0&&(Q=Y.ref,te=C.current),Y.key!==void 0&&(q=""+Y.key),z.type&&z.type.defaultProps)var X=z.type.defaultProps;for(ce in Y)M.call(Y,ce)&&!R.hasOwnProperty(ce)&&(J[ce]=Y[ce]===void 0&&X!==void 0?X[ce]:Y[ce])}var ce=arguments.length-2;if(ce===1)J.children=se;else if(1<ce){X=Array(ce);for(var me=0;me<ce;me++)X[me]=arguments[me+2];J.children=X}return{$$typeof:n,type:z.type,key:q,ref:Q,props:J,_owner:te}},Zt.createContext=function(z){return z={$$typeof:a,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:s,_context:z},z.Consumer=z},Zt.createElement=F,Zt.createFactory=function(z){var Y=F.bind(null,z);return Y.type=z,Y},Zt.createRef=function(){return{current:null}},Zt.forwardRef=function(z){return{$$typeof:o,render:z}},Zt.isValidElement=D,Zt.lazy=function(z){return{$$typeof:h,_payload:{_status:-1,_result:z},_init:O}},Zt.memo=function(z,Y){return{$$typeof:u,type:z,compare:Y===void 0?null:Y}},Zt.startTransition=function(z){var Y=L.transition;L.transition={};try{z()}finally{L.transition=Y}},Zt.unstable_act=V,Zt.useCallback=function(z,Y){return j.current.useCallback(z,Y)},Zt.useContext=function(z){return j.current.useContext(z)},Zt.useDebugValue=function(){},Zt.useDeferredValue=function(z){return j.current.useDeferredValue(z)},Zt.useEffect=function(z,Y){return j.current.useEffect(z,Y)},Zt.useId=function(){return j.current.useId()},Zt.useImperativeHandle=function(z,Y,se){return j.current.useImperativeHandle(z,Y,se)},Zt.useInsertionEffect=function(z,Y){return j.current.useInsertionEffect(z,Y)},Zt.useLayoutEffect=function(z,Y){return j.current.useLayoutEffect(z,Y)},Zt.useMemo=function(z,Y){return j.current.useMemo(z,Y)},Zt.useReducer=function(z,Y,se){return j.current.useReducer(z,Y,se)},Zt.useRef=function(z){return j.current.useRef(z)},Zt.useState=function(z){return j.current.useState(z)},Zt.useSyncExternalStore=function(z,Y,se){return j.current.useSyncExternalStore(z,Y,se)},Zt.useTransition=function(){return j.current.useTransition()},Zt.version="18.3.1",Zt}var _M;function Up(){return _M||(_M=1,t_.exports=$O()),t_.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bM;function WO(){if(bM)return Hh;bM=1;var n=Up(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,u){var h,p={},m=null,g=null;u!==void 0&&(m=""+u),l.key!==void 0&&(m=""+l.key),l.ref!==void 0&&(g=l.ref);for(h in l)r.call(l,h)&&!s.hasOwnProperty(h)&&(p[h]=l[h]);if(o&&o.defaultProps)for(h in l=o.defaultProps,l)p[h]===void 0&&(p[h]=l[h]);return{$$typeof:e,type:o,key:m,ref:g,props:p,_owner:i.current}}return Hh.Fragment=t,Hh.jsx=a,Hh.jsxs=a,Hh}var wM;function qO(){return wM||(wM=1,e_.exports=WO()),e_.exports}var c=qO(),E=Up();const we=Kd(E);var lg={},n_={exports:{}},wi={},r_={exports:{}},i_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SM;function XO(){return SM||(SM=1,function(n){function e(L,B){var V=L.length;L.push(B);e:for(;0<V;){var z=V-1>>>1,Y=L[z];if(0<i(Y,B))L[z]=B,L[V]=Y,V=z;else break e}}function t(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var B=L[0],V=L.pop();if(V!==B){L[0]=V;e:for(var z=0,Y=L.length,se=Y>>>1;z<se;){var J=2*(z+1)-1,q=L[J],Q=J+1,te=L[Q];if(0>i(q,V))Q<Y&&0>i(te,q)?(L[z]=te,L[Q]=V,z=Q):(L[z]=q,L[J]=V,z=J);else if(Q<Y&&0>i(te,V))L[z]=te,L[Q]=V,z=Q;else break e}}return B}function i(L,B){var V=L.sortIndex-B.sortIndex;return V!==0?V:L.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,p=null,m=3,g=!1,y=!1,b=!1,_=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(L){for(var B=t(u);B!==null;){if(B.callback===null)r(u);else if(B.startTime<=L)r(u),B.sortIndex=B.expirationTime,e(l,B);else break;B=t(u)}}function S(L){if(b=!1,T(L),!y)if(t(l)!==null)y=!0,O(M);else{var B=t(u);B!==null&&j(S,B.startTime-L)}}function M(L,B){y=!1,b&&(b=!1,x(F),F=-1),g=!0;var V=m;try{for(T(B),p=t(l);p!==null&&(!(p.expirationTime>B)||L&&!P());){var z=p.callback;if(typeof z=="function"){p.callback=null,m=p.priorityLevel;var Y=z(p.expirationTime<=B);B=n.unstable_now(),typeof Y=="function"?p.callback=Y:p===t(l)&&r(l),T(B)}else r(l);p=t(l)}if(p!==null)var se=!0;else{var J=t(u);J!==null&&j(S,J.startTime-B),se=!1}return se}finally{p=null,m=V,g=!1}}var C=!1,R=null,F=-1,k=5,D=-1;function P(){return!(n.unstable_now()-D<k)}function G(){if(R!==null){var L=n.unstable_now();D=L;var B=!0;try{B=R(!0,L)}finally{B?$():(C=!1,R=null)}}else C=!1}var $;if(typeof N=="function")$=function(){N(G)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,K=U.port2;U.port1.onmessage=G,$=function(){K.postMessage(null)}}else $=function(){_(G,0)};function O(L){R=L,C||(C=!0,$())}function j(L,B){F=_(function(){L(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(L){L.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,O(M))},n.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<L?Math.floor(1e3/L):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(L){switch(m){case 1:case 2:case 3:var B=3;break;default:B=m}var V=m;m=B;try{return L()}finally{m=V}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(L,B){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var V=m;m=L;try{return B()}finally{m=V}},n.unstable_scheduleCallback=function(L,B,V){var z=n.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?z+V:z):V=z,L){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=V+Y,L={id:h++,callback:B,priorityLevel:L,startTime:V,expirationTime:Y,sortIndex:-1},V>z?(L.sortIndex=V,e(u,L),t(l)===null&&L===t(u)&&(b?(x(F),F=-1):b=!0,j(S,V-z))):(L.sortIndex=Y,e(l,L),y||g||(y=!0,O(M))),L},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(L){var B=m;return function(){var V=m;m=B;try{return L.apply(this,arguments)}finally{m=V}}}}(i_)),i_}var TM;function YO(){return TM||(TM=1,r_.exports=XO()),r_.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NM;function KO(){if(NM)return wi;NM=1;var n=Up(),e=YO();function t(d){for(var f="https://reactjs.org/docs/error-decoder.html?invariant="+d,v=1;v<arguments.length;v++)f+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function s(d,f){a(d,f),a(d+"Capture",f)}function a(d,f){for(i[d]=f,d=0;d<f.length;d++)r.add(f[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function m(d){return l.call(p,d)?!0:l.call(h,d)?!1:u.test(d)?p[d]=!0:(h[d]=!0,!1)}function g(d,f,v,w){if(v!==null&&v.type===0)return!1;switch(typeof f){case"function":case"symbol":return!0;case"boolean":return w?!1:v!==null?!v.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function y(d,f,v,w){if(f===null||typeof f>"u"||g(d,f,v,w))return!0;if(w)return!1;if(v!==null)switch(v.type){case 3:return!f;case 4:return f===!1;case 5:return isNaN(f);case 6:return isNaN(f)||1>f}return!1}function b(d,f,v,w,A,I,H){this.acceptsBooleans=f===2||f===3||f===4,this.attributeName=w,this.attributeNamespace=A,this.mustUseProperty=v,this.propertyName=d,this.type=f,this.sanitizeURL=I,this.removeEmptyString=H}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){_[d]=new b(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var f=d[0];_[f]=new b(f,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){_[d]=new b(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){_[d]=new b(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){_[d]=new b(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){_[d]=new b(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){_[d]=new b(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){_[d]=new b(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){_[d]=new b(d,5,!1,d.toLowerCase(),null,!1,!1)});var x=/[\-:]([a-z])/g;function N(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var f=d.replace(x,N);_[f]=new b(f,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var f=d.replace(x,N);_[f]=new b(f,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var f=d.replace(x,N);_[f]=new b(f,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){_[d]=new b(d,1,!1,d.toLowerCase(),null,!1,!1)}),_.xlinkHref=new b("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){_[d]=new b(d,1,!1,d.toLowerCase(),null,!0,!0)});function T(d,f,v,w){var A=_.hasOwnProperty(f)?_[f]:null;(A!==null?A.type!==0:w||!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(y(f,v,A,w)&&(v=null),w||A===null?m(f)&&(v===null?d.removeAttribute(f):d.setAttribute(f,""+v)):A.mustUseProperty?d[A.propertyName]=v===null?A.type===3?!1:"":v:(f=A.attributeName,w=A.attributeNamespace,v===null?d.removeAttribute(f):(A=A.type,v=A===3||A===4&&v===!0?"":""+v,w?d.setAttributeNS(w,f,v):d.setAttribute(f,v))))}var S=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),C=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),P=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),j=Symbol.for("react.offscreen"),L=Symbol.iterator;function B(d){return d===null||typeof d!="object"?null:(d=L&&d[L]||d["@@iterator"],typeof d=="function"?d:null)}var V=Object.assign,z;function Y(d){if(z===void 0)try{throw Error()}catch(v){var f=v.stack.trim().match(/\n( *(at )?)/);z=f&&f[1]||""}return`
`+z+d}var se=!1;function J(d,f){if(!d||se)return"";se=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(f)if(f=function(){throw Error()},Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(be){var w=be}Reflect.construct(d,[],f)}else{try{f.call()}catch(be){w=be}d.call(f.prototype)}else{try{throw Error()}catch(be){w=be}d()}}catch(be){if(be&&w&&typeof be.stack=="string"){for(var A=be.stack.split(`
`),I=w.stack.split(`
`),H=A.length-1,re=I.length-1;1<=H&&0<=re&&A[H]!==I[re];)re--;for(;1<=H&&0<=re;H--,re--)if(A[H]!==I[re]){if(H!==1||re!==1)do if(H--,re--,0>re||A[H]!==I[re]){var oe=`
`+A[H].replace(" at new "," at ");return d.displayName&&oe.includes("<anonymous>")&&(oe=oe.replace("<anonymous>",d.displayName)),oe}while(1<=H&&0<=re);break}}}finally{se=!1,Error.prepareStackTrace=v}return(d=d?d.displayName||d.name:"")?Y(d):""}function q(d){switch(d.tag){case 5:return Y(d.type);case 16:return Y("Lazy");case 13:return Y("Suspense");case 19:return Y("SuspenseList");case 0:case 2:case 15:return d=J(d.type,!1),d;case 11:return d=J(d.type.render,!1),d;case 1:return d=J(d.type,!0),d;default:return""}}function Q(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case R:return"Fragment";case C:return"Portal";case k:return"Profiler";case F:return"StrictMode";case $:return"Suspense";case U:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case P:return(d.displayName||"Context")+".Consumer";case D:return(d._context.displayName||"Context")+".Provider";case G:var f=d.render;return d=d.displayName,d||(d=f.displayName||f.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case K:return f=d.displayName||null,f!==null?f:Q(d.type)||"Memo";case O:f=d._payload,d=d._init;try{return Q(d(f))}catch{}}return null}function te(d){var f=d.type;switch(d.tag){case 24:return"Cache";case 9:return(f.displayName||"Context")+".Consumer";case 10:return(f._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=f.render,d=d.displayName||d.name||"",f.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return f;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Q(f);case 8:return f===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f}return null}function X(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ce(d){var f=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function me(d){var f=ce(d)?"checked":"value",v=Object.getOwnPropertyDescriptor(d.constructor.prototype,f),w=""+d[f];if(!d.hasOwnProperty(f)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var A=v.get,I=v.set;return Object.defineProperty(d,f,{configurable:!0,get:function(){return A.call(this)},set:function(H){w=""+H,I.call(this,H)}}),Object.defineProperty(d,f,{enumerable:v.enumerable}),{getValue:function(){return w},setValue:function(H){w=""+H},stopTracking:function(){d._valueTracker=null,delete d[f]}}}}function Re(d){d._valueTracker||(d._valueTracker=me(d))}function He(d){if(!d)return!1;var f=d._valueTracker;if(!f)return!0;var v=f.getValue(),w="";return d&&(w=ce(d)?d.checked?"true":"false":d.value),d=w,d!==v?(f.setValue(d),!0):!1}function Qe(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function ie(d,f){var v=f.checked;return V({},f,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??d._wrapperState.initialChecked})}function Et(d,f){var v=f.defaultValue==null?"":f.defaultValue,w=f.checked!=null?f.checked:f.defaultChecked;v=X(f.value!=null?f.value:v),d._wrapperState={initialChecked:w,initialValue:v,controlled:f.type==="checkbox"||f.type==="radio"?f.checked!=null:f.value!=null}}function yt(d,f){f=f.checked,f!=null&&T(d,"checked",f,!1)}function tt(d,f){yt(d,f);var v=X(f.value),w=f.type;if(v!=null)w==="number"?(v===0&&d.value===""||d.value!=v)&&(d.value=""+v):d.value!==""+v&&(d.value=""+v);else if(w==="submit"||w==="reset"){d.removeAttribute("value");return}f.hasOwnProperty("value")?_t(d,f.type,v):f.hasOwnProperty("defaultValue")&&_t(d,f.type,X(f.defaultValue)),f.checked==null&&f.defaultChecked!=null&&(d.defaultChecked=!!f.defaultChecked)}function Ne(d,f,v){if(f.hasOwnProperty("value")||f.hasOwnProperty("defaultValue")){var w=f.type;if(!(w!=="submit"&&w!=="reset"||f.value!==void 0&&f.value!==null))return;f=""+d._wrapperState.initialValue,v||f===d.value||(d.value=f),d.defaultValue=f}v=d.name,v!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,v!==""&&(d.name=v)}function _t(d,f,v){(f!=="number"||Qe(d.ownerDocument)!==d)&&(v==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+v&&(d.defaultValue=""+v))}var it=Array.isArray;function wt(d,f,v,w){if(d=d.options,f){f={};for(var A=0;A<v.length;A++)f["$"+v[A]]=!0;for(v=0;v<d.length;v++)A=f.hasOwnProperty("$"+d[v].value),d[v].selected!==A&&(d[v].selected=A),A&&w&&(d[v].defaultSelected=!0)}else{for(v=""+X(v),f=null,A=0;A<d.length;A++){if(d[A].value===v){d[A].selected=!0,w&&(d[A].defaultSelected=!0);return}f!==null||d[A].disabled||(f=d[A])}f!==null&&(f.selected=!0)}}function fn(d,f){if(f.dangerouslySetInnerHTML!=null)throw Error(t(91));return V({},f,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function ne(d,f){var v=f.value;if(v==null){if(v=f.children,f=f.defaultValue,v!=null){if(f!=null)throw Error(t(92));if(it(v)){if(1<v.length)throw Error(t(93));v=v[0]}f=v}f==null&&(f=""),v=f}d._wrapperState={initialValue:X(v)}}function W(d,f){var v=X(f.value),w=X(f.defaultValue);v!=null&&(v=""+v,v!==d.value&&(d.value=v),f.defaultValue==null&&d.defaultValue!==v&&(d.defaultValue=v)),w!=null&&(d.defaultValue=""+w)}function ye(d){var f=d.textContent;f===d._wrapperState.initialValue&&f!==""&&f!==null&&(d.value=f)}function Ce(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pe(d,f){return d==null||d==="http://www.w3.org/1999/xhtml"?Ce(f):d==="http://www.w3.org/2000/svg"&&f==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var Te,ut=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(f,v,w,A){MSApp.execUnsafeLocalFunction(function(){return d(f,v,w,A)})}:d}(function(d,f){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=f;else{for(Te=Te||document.createElement("div"),Te.innerHTML="<svg>"+f.valueOf().toString()+"</svg>",f=Te.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;f.firstChild;)d.appendChild(f.firstChild)}});function qe(d,f){if(f){var v=d.firstChild;if(v&&v===d.lastChild&&v.nodeType===3){v.nodeValue=f;return}}d.textContent=f}var Ke={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lt=["Webkit","ms","Moz","O"];Object.keys(Ke).forEach(function(d){lt.forEach(function(f){f=f+d.charAt(0).toUpperCase()+d.substring(1),Ke[f]=Ke[d]})});function De(d,f,v){return f==null||typeof f=="boolean"||f===""?"":v||typeof f!="number"||f===0||Ke.hasOwnProperty(d)&&Ke[d]?(""+f).trim():f+"px"}function et(d,f){d=d.style;for(var v in f)if(f.hasOwnProperty(v)){var w=v.indexOf("--")===0,A=De(v,f[v],w);v==="float"&&(v="cssFloat"),w?d.setProperty(v,A):d[v]=A}}var St=V({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pt(d,f){if(f){if(St[d]&&(f.children!=null||f.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(f.dangerouslySetInnerHTML!=null){if(f.children!=null)throw Error(t(60));if(typeof f.dangerouslySetInnerHTML!="object"||!("__html"in f.dangerouslySetInnerHTML))throw Error(t(61))}if(f.style!=null&&typeof f.style!="object")throw Error(t(62))}}function We(d,f){if(d.indexOf("-")===-1)return typeof f.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mt=null;function le(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Ze=null,Ie=null,rt=null;function Be(d){if(d=Ah(d)){if(typeof Ze!="function")throw Error(t(280));var f=d.stateNode;f&&(f=Sm(f),Ze(d.stateNode,d.type,f))}}function Le(d){Ie?rt?rt.push(d):rt=[d]:Ie=d}function dt(){if(Ie){var d=Ie,f=rt;if(rt=Ie=null,Be(d),f)for(d=0;d<f.length;d++)Be(f[d])}}function Dt(d,f){return d(f)}function pn(){}var nn=!1;function Br(d,f,v){if(nn)return d(f,v);nn=!0;try{return Dt(d,f,v)}finally{nn=!1,(Ie!==null||rt!==null)&&(pn(),dt())}}function Pr(d,f){var v=d.stateNode;if(v===null)return null;var w=Sm(v);if(w===null)return null;v=w[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(d=d.type,w=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!w;break e;default:d=!1}if(d)return null;if(v&&typeof v!="function")throw Error(t(231,f,typeof v));return v}var To=!1;if(o)try{var qs={};Object.defineProperty(qs,"passive",{get:function(){To=!0}}),window.addEventListener("test",qs,qs),window.removeEventListener("test",qs,qs)}catch{To=!1}function _s(d,f,v,w,A,I,H,re,oe){var be=Array.prototype.slice.call(arguments,3);try{f.apply(v,be)}catch(ze){this.onError(ze)}}var bs=!1,Ea=null,Ma=!1,Xs=null,jc={onError:function(d){bs=!0,Ea=d}};function No(d,f,v,w,A,I,H,re,oe){bs=!1,Ea=null,_s.apply(jc,arguments)}function Rl(d,f,v,w,A,I,H,re,oe){if(No.apply(this,arguments),bs){if(bs){var be=Ea;bs=!1,Ea=null}else throw Error(t(198));Ma||(Ma=!0,Xs=be)}}function ns(d){var f=d,v=d;if(d.alternate)for(;f.return;)f=f.return;else{d=f;do f=d,(f.flags&4098)!==0&&(v=f.return),d=f.return;while(d)}return f.tag===3?v:null}function Fc(d){if(d.tag===13){var f=d.memoizedState;if(f===null&&(d=d.alternate,d!==null&&(f=d.memoizedState)),f!==null)return f.dehydrated}return null}function Oc(d){if(ns(d)!==d)throw Error(t(188))}function hh(d){var f=d.alternate;if(!f){if(f=ns(d),f===null)throw Error(t(188));return f!==d?null:d}for(var v=d,w=f;;){var A=v.return;if(A===null)break;var I=A.alternate;if(I===null){if(w=A.return,w!==null){v=w;continue}break}if(A.child===I.child){for(I=A.child;I;){if(I===v)return Oc(A),d;if(I===w)return Oc(A),f;I=I.sibling}throw Error(t(188))}if(v.return!==w.return)v=A,w=I;else{for(var H=!1,re=A.child;re;){if(re===v){H=!0,v=A,w=I;break}if(re===w){H=!0,w=A,v=I;break}re=re.sibling}if(!H){for(re=I.child;re;){if(re===v){H=!0,v=I,w=A;break}if(re===w){H=!0,w=I,v=A;break}re=re.sibling}if(!H)throw Error(t(189))}}if(v.alternate!==w)throw Error(t(190))}if(v.tag!==3)throw Error(t(188));return v.stateNode.current===v?d:f}function Uc(d){return d=hh(d),d!==null?Bc(d):null}function Bc(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var f=Bc(d);if(f!==null)return f;d=d.sibling}return null}var zc=e.unstable_scheduleCallback,Z=e.unstable_cancelCallback,he=e.unstable_shouldYield,_e=e.unstable_requestPaint,ge=e.unstable_now,fe=e.unstable_getCurrentPriorityLevel,Ve=e.unstable_ImmediatePriority,Je=e.unstable_UserBlockingPriority,ct=e.unstable_NormalPriority,at=e.unstable_LowPriority,Pt=e.unstable_IdlePriority,Ct=null,ht=null;function Gt(d){if(ht&&typeof ht.onCommitFiberRoot=="function")try{ht.onCommitFiberRoot(Ct,d,void 0,(d.current.flags&128)===128)}catch{}}var Wt=Math.clz32?Math.clz32:gn,In=Math.log,wn=Math.LN2;function gn(d){return d>>>=0,d===0?32:31-(In(d)/wn|0)|0}var Tt=64,yn=4194304;function Kt(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function vr(d,f){var v=d.pendingLanes;if(v===0)return 0;var w=0,A=d.suspendedLanes,I=d.pingedLanes,H=v&268435455;if(H!==0){var re=H&~A;re!==0?w=Kt(re):(I&=H,I!==0&&(w=Kt(I)))}else H=v&~A,H!==0?w=Kt(H):I!==0&&(w=Kt(I));if(w===0)return 0;if(f!==0&&f!==w&&(f&A)===0&&(A=w&-w,I=f&-f,A>=I||A===16&&(I&4194240)!==0))return f;if((w&4)!==0&&(w|=v&16),f=d.entangledLanes,f!==0)for(d=d.entanglements,f&=w;0<f;)v=31-Wt(f),A=1<<v,w|=d[v],f&=~A;return w}function Eo(d,f){switch(d){case 1:case 2:case 4:return f+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ni(d,f){for(var v=d.suspendedLanes,w=d.pingedLanes,A=d.expirationTimes,I=d.pendingLanes;0<I;){var H=31-Wt(I),re=1<<H,oe=A[H];oe===-1?((re&v)===0||(re&w)!==0)&&(A[H]=Eo(re,f)):oe<=f&&(d.expiredLanes|=re),I&=~re}}function Ca(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Sn(){var d=Tt;return Tt<<=1,(Tt&4194240)===0&&(Tt=64),d}function zr(d){for(var f=[],v=0;31>v;v++)f.push(d);return f}function _r(d,f,v){d.pendingLanes|=f,f!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,f=31-Wt(f),d[f]=v}function kr(d,f){var v=d.pendingLanes&~f;d.pendingLanes=f,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=f,d.mutableReadLanes&=f,d.entangledLanes&=f,f=d.entanglements;var w=d.eventTimes;for(d=d.expirationTimes;0<v;){var A=31-Wt(v),I=1<<A;f[A]=0,w[A]=-1,d[A]=-1,v&=~I}}function br(d,f){var v=d.entangledLanes|=f;for(d=d.entanglements;v;){var w=31-Wt(v),A=1<<w;A&f|d[w]&f&&(d[w]|=f),v&=~A}}var sn=0;function Ys(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var QT,Ty,JT,eN,tN,Ny=!1,lm=[],Mo=null,Co=null,Ao=null,fh=new Map,ph=new Map,Ro=[],fF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nN(d,f){switch(d){case"focusin":case"focusout":Mo=null;break;case"dragenter":case"dragleave":Co=null;break;case"mouseover":case"mouseout":Ao=null;break;case"pointerover":case"pointerout":fh.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":ph.delete(f.pointerId)}}function mh(d,f,v,w,A,I){return d===null||d.nativeEvent!==I?(d={blockedOn:f,domEventName:v,eventSystemFlags:w,nativeEvent:I,targetContainers:[A]},f!==null&&(f=Ah(f),f!==null&&Ty(f)),d):(d.eventSystemFlags|=w,f=d.targetContainers,A!==null&&f.indexOf(A)===-1&&f.push(A),d)}function pF(d,f,v,w,A){switch(f){case"focusin":return Mo=mh(Mo,d,f,v,w,A),!0;case"dragenter":return Co=mh(Co,d,f,v,w,A),!0;case"mouseover":return Ao=mh(Ao,d,f,v,w,A),!0;case"pointerover":var I=A.pointerId;return fh.set(I,mh(fh.get(I)||null,d,f,v,w,A)),!0;case"gotpointercapture":return I=A.pointerId,ph.set(I,mh(ph.get(I)||null,d,f,v,w,A)),!0}return!1}function rN(d){var f=Pl(d.target);if(f!==null){var v=ns(f);if(v!==null){if(f=v.tag,f===13){if(f=Fc(v),f!==null){d.blockedOn=f,tN(d.priority,function(){JT(v)});return}}else if(f===3&&v.stateNode.current.memoizedState.isDehydrated){d.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}d.blockedOn=null}function cm(d){if(d.blockedOn!==null)return!1;for(var f=d.targetContainers;0<f.length;){var v=My(d.domEventName,d.eventSystemFlags,f[0],d.nativeEvent);if(v===null){v=d.nativeEvent;var w=new v.constructor(v.type,v);Mt=w,v.target.dispatchEvent(w),Mt=null}else return f=Ah(v),f!==null&&Ty(f),d.blockedOn=v,!1;f.shift()}return!0}function iN(d,f,v){cm(d)&&v.delete(f)}function mF(){Ny=!1,Mo!==null&&cm(Mo)&&(Mo=null),Co!==null&&cm(Co)&&(Co=null),Ao!==null&&cm(Ao)&&(Ao=null),fh.forEach(iN),ph.forEach(iN)}function gh(d,f){d.blockedOn===f&&(d.blockedOn=null,Ny||(Ny=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,mF)))}function xh(d){function f(A){return gh(A,d)}if(0<lm.length){gh(lm[0],d);for(var v=1;v<lm.length;v++){var w=lm[v];w.blockedOn===d&&(w.blockedOn=null)}}for(Mo!==null&&gh(Mo,d),Co!==null&&gh(Co,d),Ao!==null&&gh(Ao,d),fh.forEach(f),ph.forEach(f),v=0;v<Ro.length;v++)w=Ro[v],w.blockedOn===d&&(w.blockedOn=null);for(;0<Ro.length&&(v=Ro[0],v.blockedOn===null);)rN(v),v.blockedOn===null&&Ro.shift()}var Vc=S.ReactCurrentBatchConfig,um=!0;function gF(d,f,v,w){var A=sn,I=Vc.transition;Vc.transition=null;try{sn=1,Ey(d,f,v,w)}finally{sn=A,Vc.transition=I}}function xF(d,f,v,w){var A=sn,I=Vc.transition;Vc.transition=null;try{sn=4,Ey(d,f,v,w)}finally{sn=A,Vc.transition=I}}function Ey(d,f,v,w){if(um){var A=My(d,f,v,w);if(A===null)Hy(d,f,w,dm,v),nN(d,w);else if(pF(A,d,f,v,w))w.stopPropagation();else if(nN(d,w),f&4&&-1<fF.indexOf(d)){for(;A!==null;){var I=Ah(A);if(I!==null&&QT(I),I=My(d,f,v,w),I===null&&Hy(d,f,w,dm,v),I===A)break;A=I}A!==null&&w.stopPropagation()}else Hy(d,f,w,null,v)}}var dm=null;function My(d,f,v,w){if(dm=null,d=le(w),d=Pl(d),d!==null)if(f=ns(d),f===null)d=null;else if(v=f.tag,v===13){if(d=Fc(f),d!==null)return d;d=null}else if(v===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;d=null}else f!==d&&(d=null);return dm=d,null}function sN(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fe()){case Ve:return 1;case Je:return 4;case ct:case at:return 16;case Pt:return 536870912;default:return 16}default:return 16}}var Po=null,Cy=null,hm=null;function aN(){if(hm)return hm;var d,f=Cy,v=f.length,w,A="value"in Po?Po.value:Po.textContent,I=A.length;for(d=0;d<v&&f[d]===A[d];d++);var H=v-d;for(w=1;w<=H&&f[v-w]===A[I-w];w++);return hm=A.slice(d,1<w?1-w:void 0)}function fm(d){var f=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&f===13&&(d=13)):d=f,d===10&&(d=13),32<=d||d===13?d:0}function pm(){return!0}function oN(){return!1}function ji(d){function f(v,w,A,I,H){this._reactName=v,this._targetInst=A,this.type=w,this.nativeEvent=I,this.target=H,this.currentTarget=null;for(var re in d)d.hasOwnProperty(re)&&(v=d[re],this[re]=v?v(I):I[re]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?pm:oN,this.isPropagationStopped=oN,this}return V(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=pm)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=pm)},persist:function(){},isPersistent:pm}),f}var Gc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ay=ji(Gc),yh=V({},Gc,{view:0,detail:0}),yF=ji(yh),Ry,Py,vh,mm=V({},yh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ly,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==vh&&(vh&&d.type==="mousemove"?(Ry=d.screenX-vh.screenX,Py=d.screenY-vh.screenY):Py=Ry=0,vh=d),Ry)},movementY:function(d){return"movementY"in d?d.movementY:Py}}),lN=ji(mm),vF=V({},mm,{dataTransfer:0}),_F=ji(vF),bF=V({},yh,{relatedTarget:0}),ky=ji(bF),wF=V({},Gc,{animationName:0,elapsedTime:0,pseudoElement:0}),SF=ji(wF),TF=V({},Gc,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),NF=ji(TF),EF=V({},Gc,{data:0}),cN=ji(EF),MF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},CF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function RF(d){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(d):(d=AF[d])?!!f[d]:!1}function Ly(){return RF}var PF=V({},yh,{key:function(d){if(d.key){var f=MF[d.key]||d.key;if(f!=="Unidentified")return f}return d.type==="keypress"?(d=fm(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?CF[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ly,charCode:function(d){return d.type==="keypress"?fm(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?fm(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),kF=ji(PF),LF=V({},mm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uN=ji(LF),DF=V({},yh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ly}),IF=ji(DF),jF=V({},Gc,{propertyName:0,elapsedTime:0,pseudoElement:0}),FF=ji(jF),OF=V({},mm,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),UF=ji(OF),BF=[9,13,27,32],Dy=o&&"CompositionEvent"in window,_h=null;o&&"documentMode"in document&&(_h=document.documentMode);var zF=o&&"TextEvent"in window&&!_h,dN=o&&(!Dy||_h&&8<_h&&11>=_h),hN=" ",fN=!1;function pN(d,f){switch(d){case"keyup":return BF.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mN(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Hc=!1;function VF(d,f){switch(d){case"compositionend":return mN(f);case"keypress":return f.which!==32?null:(fN=!0,hN);case"textInput":return d=f.data,d===hN&&fN?null:d;default:return null}}function GF(d,f){if(Hc)return d==="compositionend"||!Dy&&pN(d,f)?(d=aN(),hm=Cy=Po=null,Hc=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return dN&&f.locale!=="ko"?null:f.data;default:return null}}var HF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gN(d){var f=d&&d.nodeName&&d.nodeName.toLowerCase();return f==="input"?!!HF[d.type]:f==="textarea"}function xN(d,f,v,w){Le(w),f=_m(f,"onChange"),0<f.length&&(v=new Ay("onChange","change",null,v,w),d.push({event:v,listeners:f}))}var bh=null,wh=null;function $F(d){IN(d,0)}function gm(d){var f=Yc(d);if(He(f))return d}function WF(d,f){if(d==="change")return f}var yN=!1;if(o){var Iy;if(o){var jy="oninput"in document;if(!jy){var vN=document.createElement("div");vN.setAttribute("oninput","return;"),jy=typeof vN.oninput=="function"}Iy=jy}else Iy=!1;yN=Iy&&(!document.documentMode||9<document.documentMode)}function _N(){bh&&(bh.detachEvent("onpropertychange",bN),wh=bh=null)}function bN(d){if(d.propertyName==="value"&&gm(wh)){var f=[];xN(f,wh,d,le(d)),Br($F,f)}}function qF(d,f,v){d==="focusin"?(_N(),bh=f,wh=v,bh.attachEvent("onpropertychange",bN)):d==="focusout"&&_N()}function XF(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return gm(wh)}function YF(d,f){if(d==="click")return gm(f)}function KF(d,f){if(d==="input"||d==="change")return gm(f)}function ZF(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var ws=typeof Object.is=="function"?Object.is:ZF;function Sh(d,f){if(ws(d,f))return!0;if(typeof d!="object"||d===null||typeof f!="object"||f===null)return!1;var v=Object.keys(d),w=Object.keys(f);if(v.length!==w.length)return!1;for(w=0;w<v.length;w++){var A=v[w];if(!l.call(f,A)||!ws(d[A],f[A]))return!1}return!0}function wN(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function SN(d,f){var v=wN(d);d=0;for(var w;v;){if(v.nodeType===3){if(w=d+v.textContent.length,d<=f&&w>=f)return{node:v,offset:f-d};d=w}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=wN(v)}}function TN(d,f){return d&&f?d===f?!0:d&&d.nodeType===3?!1:f&&f.nodeType===3?TN(d,f.parentNode):"contains"in d?d.contains(f):d.compareDocumentPosition?!!(d.compareDocumentPosition(f)&16):!1:!1}function NN(){for(var d=window,f=Qe();f instanceof d.HTMLIFrameElement;){try{var v=typeof f.contentWindow.location.href=="string"}catch{v=!1}if(v)d=f.contentWindow;else break;f=Qe(d.document)}return f}function Fy(d){var f=d&&d.nodeName&&d.nodeName.toLowerCase();return f&&(f==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||f==="textarea"||d.contentEditable==="true")}function QF(d){var f=NN(),v=d.focusedElem,w=d.selectionRange;if(f!==v&&v&&v.ownerDocument&&TN(v.ownerDocument.documentElement,v)){if(w!==null&&Fy(v)){if(f=w.start,d=w.end,d===void 0&&(d=f),"selectionStart"in v)v.selectionStart=f,v.selectionEnd=Math.min(d,v.value.length);else if(d=(f=v.ownerDocument||document)&&f.defaultView||window,d.getSelection){d=d.getSelection();var A=v.textContent.length,I=Math.min(w.start,A);w=w.end===void 0?I:Math.min(w.end,A),!d.extend&&I>w&&(A=w,w=I,I=A),A=SN(v,I);var H=SN(v,w);A&&H&&(d.rangeCount!==1||d.anchorNode!==A.node||d.anchorOffset!==A.offset||d.focusNode!==H.node||d.focusOffset!==H.offset)&&(f=f.createRange(),f.setStart(A.node,A.offset),d.removeAllRanges(),I>w?(d.addRange(f),d.extend(H.node,H.offset)):(f.setEnd(H.node,H.offset),d.addRange(f)))}}for(f=[],d=v;d=d.parentNode;)d.nodeType===1&&f.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<f.length;v++)d=f[v],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var JF=o&&"documentMode"in document&&11>=document.documentMode,$c=null,Oy=null,Th=null,Uy=!1;function EN(d,f,v){var w=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Uy||$c==null||$c!==Qe(w)||(w=$c,"selectionStart"in w&&Fy(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Th&&Sh(Th,w)||(Th=w,w=_m(Oy,"onSelect"),0<w.length&&(f=new Ay("onSelect","select",null,f,v),d.push({event:f,listeners:w}),f.target=$c)))}function xm(d,f){var v={};return v[d.toLowerCase()]=f.toLowerCase(),v["Webkit"+d]="webkit"+f,v["Moz"+d]="moz"+f,v}var Wc={animationend:xm("Animation","AnimationEnd"),animationiteration:xm("Animation","AnimationIteration"),animationstart:xm("Animation","AnimationStart"),transitionend:xm("Transition","TransitionEnd")},By={},MN={};o&&(MN=document.createElement("div").style,"AnimationEvent"in window||(delete Wc.animationend.animation,delete Wc.animationiteration.animation,delete Wc.animationstart.animation),"TransitionEvent"in window||delete Wc.transitionend.transition);function ym(d){if(By[d])return By[d];if(!Wc[d])return d;var f=Wc[d],v;for(v in f)if(f.hasOwnProperty(v)&&v in MN)return By[d]=f[v];return d}var CN=ym("animationend"),AN=ym("animationiteration"),RN=ym("animationstart"),PN=ym("transitionend"),kN=new Map,LN="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ko(d,f){kN.set(d,f),s(f,[d])}for(var zy=0;zy<LN.length;zy++){var Vy=LN[zy],eO=Vy.toLowerCase(),tO=Vy[0].toUpperCase()+Vy.slice(1);ko(eO,"on"+tO)}ko(CN,"onAnimationEnd"),ko(AN,"onAnimationIteration"),ko(RN,"onAnimationStart"),ko("dblclick","onDoubleClick"),ko("focusin","onFocus"),ko("focusout","onBlur"),ko(PN,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nO=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nh));function DN(d,f,v){var w=d.type||"unknown-event";d.currentTarget=v,Rl(w,f,void 0,d),d.currentTarget=null}function IN(d,f){f=(f&4)!==0;for(var v=0;v<d.length;v++){var w=d[v],A=w.event;w=w.listeners;e:{var I=void 0;if(f)for(var H=w.length-1;0<=H;H--){var re=w[H],oe=re.instance,be=re.currentTarget;if(re=re.listener,oe!==I&&A.isPropagationStopped())break e;DN(A,re,be),I=oe}else for(H=0;H<w.length;H++){if(re=w[H],oe=re.instance,be=re.currentTarget,re=re.listener,oe!==I&&A.isPropagationStopped())break e;DN(A,re,be),I=oe}}}if(Ma)throw d=Xs,Ma=!1,Xs=null,d}function Pn(d,f){var v=f[Ky];v===void 0&&(v=f[Ky]=new Set);var w=d+"__bubble";v.has(w)||(jN(f,d,2,!1),v.add(w))}function Gy(d,f,v){var w=0;f&&(w|=4),jN(v,d,w,f)}var vm="_reactListening"+Math.random().toString(36).slice(2);function Eh(d){if(!d[vm]){d[vm]=!0,r.forEach(function(v){v!=="selectionchange"&&(nO.has(v)||Gy(v,!1,d),Gy(v,!0,d))});var f=d.nodeType===9?d:d.ownerDocument;f===null||f[vm]||(f[vm]=!0,Gy("selectionchange",!1,f))}}function jN(d,f,v,w){switch(sN(f)){case 1:var A=gF;break;case 4:A=xF;break;default:A=Ey}v=A.bind(null,f,v,d),A=void 0,!To||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(A=!0),w?A!==void 0?d.addEventListener(f,v,{capture:!0,passive:A}):d.addEventListener(f,v,!0):A!==void 0?d.addEventListener(f,v,{passive:A}):d.addEventListener(f,v,!1)}function Hy(d,f,v,w,A){var I=w;if((f&1)===0&&(f&2)===0&&w!==null)e:for(;;){if(w===null)return;var H=w.tag;if(H===3||H===4){var re=w.stateNode.containerInfo;if(re===A||re.nodeType===8&&re.parentNode===A)break;if(H===4)for(H=w.return;H!==null;){var oe=H.tag;if((oe===3||oe===4)&&(oe=H.stateNode.containerInfo,oe===A||oe.nodeType===8&&oe.parentNode===A))return;H=H.return}for(;re!==null;){if(H=Pl(re),H===null)return;if(oe=H.tag,oe===5||oe===6){w=I=H;continue e}re=re.parentNode}}w=w.return}Br(function(){var be=I,ze=le(v),Ge=[];e:{var Oe=kN.get(d);if(Oe!==void 0){var ot=Ay,mt=d;switch(d){case"keypress":if(fm(v)===0)break e;case"keydown":case"keyup":ot=kF;break;case"focusin":mt="focus",ot=ky;break;case"focusout":mt="blur",ot=ky;break;case"beforeblur":case"afterblur":ot=ky;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ot=lN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ot=_F;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ot=IF;break;case CN:case AN:case RN:ot=SF;break;case PN:ot=FF;break;case"scroll":ot=yF;break;case"wheel":ot=UF;break;case"copy":case"cut":case"paste":ot=NF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ot=uN}var gt=(f&4)!==0,Yn=!gt&&d==="scroll",xe=gt?Oe!==null?Oe+"Capture":null:Oe;gt=[];for(var ue=be,ve;ue!==null;){ve=ue;var $e=ve.stateNode;if(ve.tag===5&&$e!==null&&(ve=$e,xe!==null&&($e=Pr(ue,xe),$e!=null&&gt.push(Mh(ue,$e,ve)))),Yn)break;ue=ue.return}0<gt.length&&(Oe=new ot(Oe,mt,null,v,ze),Ge.push({event:Oe,listeners:gt}))}}if((f&7)===0){e:{if(Oe=d==="mouseover"||d==="pointerover",ot=d==="mouseout"||d==="pointerout",Oe&&v!==Mt&&(mt=v.relatedTarget||v.fromElement)&&(Pl(mt)||mt[Aa]))break e;if((ot||Oe)&&(Oe=ze.window===ze?ze:(Oe=ze.ownerDocument)?Oe.defaultView||Oe.parentWindow:window,ot?(mt=v.relatedTarget||v.toElement,ot=be,mt=mt?Pl(mt):null,mt!==null&&(Yn=ns(mt),mt!==Yn||mt.tag!==5&&mt.tag!==6)&&(mt=null)):(ot=null,mt=be),ot!==mt)){if(gt=lN,$e="onMouseLeave",xe="onMouseEnter",ue="mouse",(d==="pointerout"||d==="pointerover")&&(gt=uN,$e="onPointerLeave",xe="onPointerEnter",ue="pointer"),Yn=ot==null?Oe:Yc(ot),ve=mt==null?Oe:Yc(mt),Oe=new gt($e,ue+"leave",ot,v,ze),Oe.target=Yn,Oe.relatedTarget=ve,$e=null,Pl(ze)===be&&(gt=new gt(xe,ue+"enter",mt,v,ze),gt.target=ve,gt.relatedTarget=Yn,$e=gt),Yn=$e,ot&&mt)t:{for(gt=ot,xe=mt,ue=0,ve=gt;ve;ve=qc(ve))ue++;for(ve=0,$e=xe;$e;$e=qc($e))ve++;for(;0<ue-ve;)gt=qc(gt),ue--;for(;0<ve-ue;)xe=qc(xe),ve--;for(;ue--;){if(gt===xe||xe!==null&&gt===xe.alternate)break t;gt=qc(gt),xe=qc(xe)}gt=null}else gt=null;ot!==null&&FN(Ge,Oe,ot,gt,!1),mt!==null&&Yn!==null&&FN(Ge,Yn,mt,gt,!0)}}e:{if(Oe=be?Yc(be):window,ot=Oe.nodeName&&Oe.nodeName.toLowerCase(),ot==="select"||ot==="input"&&Oe.type==="file")var xt=WF;else if(gN(Oe))if(yN)xt=KF;else{xt=XF;var At=qF}else(ot=Oe.nodeName)&&ot.toLowerCase()==="input"&&(Oe.type==="checkbox"||Oe.type==="radio")&&(xt=YF);if(xt&&(xt=xt(d,be))){xN(Ge,xt,v,ze);break e}At&&At(d,Oe,be),d==="focusout"&&(At=Oe._wrapperState)&&At.controlled&&Oe.type==="number"&&_t(Oe,"number",Oe.value)}switch(At=be?Yc(be):window,d){case"focusin":(gN(At)||At.contentEditable==="true")&&($c=At,Oy=be,Th=null);break;case"focusout":Th=Oy=$c=null;break;case"mousedown":Uy=!0;break;case"contextmenu":case"mouseup":case"dragend":Uy=!1,EN(Ge,v,ze);break;case"selectionchange":if(JF)break;case"keydown":case"keyup":EN(Ge,v,ze)}var Rt;if(Dy)e:{switch(d){case"compositionstart":var Ft="onCompositionStart";break e;case"compositionend":Ft="onCompositionEnd";break e;case"compositionupdate":Ft="onCompositionUpdate";break e}Ft=void 0}else Hc?pN(d,v)&&(Ft="onCompositionEnd"):d==="keydown"&&v.keyCode===229&&(Ft="onCompositionStart");Ft&&(dN&&v.locale!=="ko"&&(Hc||Ft!=="onCompositionStart"?Ft==="onCompositionEnd"&&Hc&&(Rt=aN()):(Po=ze,Cy="value"in Po?Po.value:Po.textContent,Hc=!0)),At=_m(be,Ft),0<At.length&&(Ft=new cN(Ft,d,null,v,ze),Ge.push({event:Ft,listeners:At}),Rt?Ft.data=Rt:(Rt=mN(v),Rt!==null&&(Ft.data=Rt)))),(Rt=zF?VF(d,v):GF(d,v))&&(be=_m(be,"onBeforeInput"),0<be.length&&(ze=new cN("onBeforeInput","beforeinput",null,v,ze),Ge.push({event:ze,listeners:be}),ze.data=Rt))}IN(Ge,f)})}function Mh(d,f,v){return{instance:d,listener:f,currentTarget:v}}function _m(d,f){for(var v=f+"Capture",w=[];d!==null;){var A=d,I=A.stateNode;A.tag===5&&I!==null&&(A=I,I=Pr(d,v),I!=null&&w.unshift(Mh(d,I,A)),I=Pr(d,f),I!=null&&w.push(Mh(d,I,A))),d=d.return}return w}function qc(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function FN(d,f,v,w,A){for(var I=f._reactName,H=[];v!==null&&v!==w;){var re=v,oe=re.alternate,be=re.stateNode;if(oe!==null&&oe===w)break;re.tag===5&&be!==null&&(re=be,A?(oe=Pr(v,I),oe!=null&&H.unshift(Mh(v,oe,re))):A||(oe=Pr(v,I),oe!=null&&H.push(Mh(v,oe,re)))),v=v.return}H.length!==0&&d.push({event:f,listeners:H})}var rO=/\r\n?/g,iO=/\u0000|\uFFFD/g;function ON(d){return(typeof d=="string"?d:""+d).replace(rO,`
`).replace(iO,"")}function bm(d,f,v){if(f=ON(f),ON(d)!==f&&v)throw Error(t(425))}function wm(){}var $y=null,Wy=null;function qy(d,f){return d==="textarea"||d==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var Xy=typeof setTimeout=="function"?setTimeout:void 0,sO=typeof clearTimeout=="function"?clearTimeout:void 0,UN=typeof Promise=="function"?Promise:void 0,aO=typeof queueMicrotask=="function"?queueMicrotask:typeof UN<"u"?function(d){return UN.resolve(null).then(d).catch(oO)}:Xy;function oO(d){setTimeout(function(){throw d})}function Yy(d,f){var v=f,w=0;do{var A=v.nextSibling;if(d.removeChild(v),A&&A.nodeType===8)if(v=A.data,v==="/$"){if(w===0){d.removeChild(A),xh(f);return}w--}else v!=="$"&&v!=="$?"&&v!=="$!"||w++;v=A}while(v);xh(f)}function Lo(d){for(;d!=null;d=d.nextSibling){var f=d.nodeType;if(f===1||f===3)break;if(f===8){if(f=d.data,f==="$"||f==="$!"||f==="$?")break;if(f==="/$")return null}}return d}function BN(d){d=d.previousSibling;for(var f=0;d;){if(d.nodeType===8){var v=d.data;if(v==="$"||v==="$!"||v==="$?"){if(f===0)return d;f--}else v==="/$"&&f++}d=d.previousSibling}return null}var Xc=Math.random().toString(36).slice(2),Ks="__reactFiber$"+Xc,Ch="__reactProps$"+Xc,Aa="__reactContainer$"+Xc,Ky="__reactEvents$"+Xc,lO="__reactListeners$"+Xc,cO="__reactHandles$"+Xc;function Pl(d){var f=d[Ks];if(f)return f;for(var v=d.parentNode;v;){if(f=v[Aa]||v[Ks]){if(v=f.alternate,f.child!==null||v!==null&&v.child!==null)for(d=BN(d);d!==null;){if(v=d[Ks])return v;d=BN(d)}return f}d=v,v=d.parentNode}return null}function Ah(d){return d=d[Ks]||d[Aa],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Yc(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function Sm(d){return d[Ch]||null}var Zy=[],Kc=-1;function Do(d){return{current:d}}function kn(d){0>Kc||(d.current=Zy[Kc],Zy[Kc]=null,Kc--)}function Mn(d,f){Kc++,Zy[Kc]=d.current,d.current=f}var Io={},Vr=Do(Io),xi=Do(!1),kl=Io;function Zc(d,f){var v=d.type.contextTypes;if(!v)return Io;var w=d.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===f)return w.__reactInternalMemoizedMaskedChildContext;var A={},I;for(I in v)A[I]=f[I];return w&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=f,d.__reactInternalMemoizedMaskedChildContext=A),A}function yi(d){return d=d.childContextTypes,d!=null}function Tm(){kn(xi),kn(Vr)}function zN(d,f,v){if(Vr.current!==Io)throw Error(t(168));Mn(Vr,f),Mn(xi,v)}function VN(d,f,v){var w=d.stateNode;if(f=f.childContextTypes,typeof w.getChildContext!="function")return v;w=w.getChildContext();for(var A in w)if(!(A in f))throw Error(t(108,te(d)||"Unknown",A));return V({},v,w)}function Nm(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Io,kl=Vr.current,Mn(Vr,d),Mn(xi,xi.current),!0}function GN(d,f,v){var w=d.stateNode;if(!w)throw Error(t(169));v?(d=VN(d,f,kl),w.__reactInternalMemoizedMergedChildContext=d,kn(xi),kn(Vr),Mn(Vr,d)):kn(xi),Mn(xi,v)}var Ra=null,Em=!1,Qy=!1;function HN(d){Ra===null?Ra=[d]:Ra.push(d)}function uO(d){Em=!0,HN(d)}function jo(){if(!Qy&&Ra!==null){Qy=!0;var d=0,f=sn;try{var v=Ra;for(sn=1;d<v.length;d++){var w=v[d];do w=w(!0);while(w!==null)}Ra=null,Em=!1}catch(A){throw Ra!==null&&(Ra=Ra.slice(d+1)),zc(Ve,jo),A}finally{sn=f,Qy=!1}}return null}var Qc=[],Jc=0,Mm=null,Cm=0,rs=[],is=0,Ll=null,Pa=1,ka="";function Dl(d,f){Qc[Jc++]=Cm,Qc[Jc++]=Mm,Mm=d,Cm=f}function $N(d,f,v){rs[is++]=Pa,rs[is++]=ka,rs[is++]=Ll,Ll=d;var w=Pa;d=ka;var A=32-Wt(w)-1;w&=~(1<<A),v+=1;var I=32-Wt(f)+A;if(30<I){var H=A-A%5;I=(w&(1<<H)-1).toString(32),w>>=H,A-=H,Pa=1<<32-Wt(f)+A|v<<A|w,ka=I+d}else Pa=1<<I|v<<A|w,ka=d}function Jy(d){d.return!==null&&(Dl(d,1),$N(d,1,0))}function ev(d){for(;d===Mm;)Mm=Qc[--Jc],Qc[Jc]=null,Cm=Qc[--Jc],Qc[Jc]=null;for(;d===Ll;)Ll=rs[--is],rs[is]=null,ka=rs[--is],rs[is]=null,Pa=rs[--is],rs[is]=null}var Fi=null,Oi=null,jn=!1,Ss=null;function WN(d,f){var v=ls(5,null,null,0);v.elementType="DELETED",v.stateNode=f,v.return=d,f=d.deletions,f===null?(d.deletions=[v],d.flags|=16):f.push(v)}function qN(d,f){switch(d.tag){case 5:var v=d.type;return f=f.nodeType!==1||v.toLowerCase()!==f.nodeName.toLowerCase()?null:f,f!==null?(d.stateNode=f,Fi=d,Oi=Lo(f.firstChild),!0):!1;case 6:return f=d.pendingProps===""||f.nodeType!==3?null:f,f!==null?(d.stateNode=f,Fi=d,Oi=null,!0):!1;case 13:return f=f.nodeType!==8?null:f,f!==null?(v=Ll!==null?{id:Pa,overflow:ka}:null,d.memoizedState={dehydrated:f,treeContext:v,retryLane:1073741824},v=ls(18,null,null,0),v.stateNode=f,v.return=d,d.child=v,Fi=d,Oi=null,!0):!1;default:return!1}}function tv(d){return(d.mode&1)!==0&&(d.flags&128)===0}function nv(d){if(jn){var f=Oi;if(f){var v=f;if(!qN(d,f)){if(tv(d))throw Error(t(418));f=Lo(v.nextSibling);var w=Fi;f&&qN(d,f)?WN(w,v):(d.flags=d.flags&-4097|2,jn=!1,Fi=d)}}else{if(tv(d))throw Error(t(418));d.flags=d.flags&-4097|2,jn=!1,Fi=d}}}function XN(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Fi=d}function Am(d){if(d!==Fi)return!1;if(!jn)return XN(d),jn=!0,!1;var f;if((f=d.tag!==3)&&!(f=d.tag!==5)&&(f=d.type,f=f!=="head"&&f!=="body"&&!qy(d.type,d.memoizedProps)),f&&(f=Oi)){if(tv(d))throw YN(),Error(t(418));for(;f;)WN(d,f),f=Lo(f.nextSibling)}if(XN(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,f=0;d;){if(d.nodeType===8){var v=d.data;if(v==="/$"){if(f===0){Oi=Lo(d.nextSibling);break e}f--}else v!=="$"&&v!=="$!"&&v!=="$?"||f++}d=d.nextSibling}Oi=null}}else Oi=Fi?Lo(d.stateNode.nextSibling):null;return!0}function YN(){for(var d=Oi;d;)d=Lo(d.nextSibling)}function eu(){Oi=Fi=null,jn=!1}function rv(d){Ss===null?Ss=[d]:Ss.push(d)}var dO=S.ReactCurrentBatchConfig;function Rh(d,f,v){if(d=v.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(t(309));var w=v.stateNode}if(!w)throw Error(t(147,d));var A=w,I=""+d;return f!==null&&f.ref!==null&&typeof f.ref=="function"&&f.ref._stringRef===I?f.ref:(f=function(H){var re=A.refs;H===null?delete re[I]:re[I]=H},f._stringRef=I,f)}if(typeof d!="string")throw Error(t(284));if(!v._owner)throw Error(t(290,d))}return d}function Rm(d,f){throw d=Object.prototype.toString.call(f),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":d))}function KN(d){var f=d._init;return f(d._payload)}function ZN(d){function f(xe,ue){if(d){var ve=xe.deletions;ve===null?(xe.deletions=[ue],xe.flags|=16):ve.push(ue)}}function v(xe,ue){if(!d)return null;for(;ue!==null;)f(xe,ue),ue=ue.sibling;return null}function w(xe,ue){for(xe=new Map;ue!==null;)ue.key!==null?xe.set(ue.key,ue):xe.set(ue.index,ue),ue=ue.sibling;return xe}function A(xe,ue){return xe=Ho(xe,ue),xe.index=0,xe.sibling=null,xe}function I(xe,ue,ve){return xe.index=ve,d?(ve=xe.alternate,ve!==null?(ve=ve.index,ve<ue?(xe.flags|=2,ue):ve):(xe.flags|=2,ue)):(xe.flags|=1048576,ue)}function H(xe){return d&&xe.alternate===null&&(xe.flags|=2),xe}function re(xe,ue,ve,$e){return ue===null||ue.tag!==6?(ue=Xv(ve,xe.mode,$e),ue.return=xe,ue):(ue=A(ue,ve),ue.return=xe,ue)}function oe(xe,ue,ve,$e){var xt=ve.type;return xt===R?ze(xe,ue,ve.props.children,$e,ve.key):ue!==null&&(ue.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===O&&KN(xt)===ue.type)?($e=A(ue,ve.props),$e.ref=Rh(xe,ue,ve),$e.return=xe,$e):($e=eg(ve.type,ve.key,ve.props,null,xe.mode,$e),$e.ref=Rh(xe,ue,ve),$e.return=xe,$e)}function be(xe,ue,ve,$e){return ue===null||ue.tag!==4||ue.stateNode.containerInfo!==ve.containerInfo||ue.stateNode.implementation!==ve.implementation?(ue=Yv(ve,xe.mode,$e),ue.return=xe,ue):(ue=A(ue,ve.children||[]),ue.return=xe,ue)}function ze(xe,ue,ve,$e,xt){return ue===null||ue.tag!==7?(ue=Vl(ve,xe.mode,$e,xt),ue.return=xe,ue):(ue=A(ue,ve),ue.return=xe,ue)}function Ge(xe,ue,ve){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return ue=Xv(""+ue,xe.mode,ve),ue.return=xe,ue;if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case M:return ve=eg(ue.type,ue.key,ue.props,null,xe.mode,ve),ve.ref=Rh(xe,null,ue),ve.return=xe,ve;case C:return ue=Yv(ue,xe.mode,ve),ue.return=xe,ue;case O:var $e=ue._init;return Ge(xe,$e(ue._payload),ve)}if(it(ue)||B(ue))return ue=Vl(ue,xe.mode,ve,null),ue.return=xe,ue;Rm(xe,ue)}return null}function Oe(xe,ue,ve,$e){var xt=ue!==null?ue.key:null;if(typeof ve=="string"&&ve!==""||typeof ve=="number")return xt!==null?null:re(xe,ue,""+ve,$e);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case M:return ve.key===xt?oe(xe,ue,ve,$e):null;case C:return ve.key===xt?be(xe,ue,ve,$e):null;case O:return xt=ve._init,Oe(xe,ue,xt(ve._payload),$e)}if(it(ve)||B(ve))return xt!==null?null:ze(xe,ue,ve,$e,null);Rm(xe,ve)}return null}function ot(xe,ue,ve,$e,xt){if(typeof $e=="string"&&$e!==""||typeof $e=="number")return xe=xe.get(ve)||null,re(ue,xe,""+$e,xt);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case M:return xe=xe.get($e.key===null?ve:$e.key)||null,oe(ue,xe,$e,xt);case C:return xe=xe.get($e.key===null?ve:$e.key)||null,be(ue,xe,$e,xt);case O:var At=$e._init;return ot(xe,ue,ve,At($e._payload),xt)}if(it($e)||B($e))return xe=xe.get(ve)||null,ze(ue,xe,$e,xt,null);Rm(ue,$e)}return null}function mt(xe,ue,ve,$e){for(var xt=null,At=null,Rt=ue,Ft=ue=0,Tr=null;Rt!==null&&Ft<ve.length;Ft++){Rt.index>Ft?(Tr=Rt,Rt=null):Tr=Rt.sibling;var cn=Oe(xe,Rt,ve[Ft],$e);if(cn===null){Rt===null&&(Rt=Tr);break}d&&Rt&&cn.alternate===null&&f(xe,Rt),ue=I(cn,ue,Ft),At===null?xt=cn:At.sibling=cn,At=cn,Rt=Tr}if(Ft===ve.length)return v(xe,Rt),jn&&Dl(xe,Ft),xt;if(Rt===null){for(;Ft<ve.length;Ft++)Rt=Ge(xe,ve[Ft],$e),Rt!==null&&(ue=I(Rt,ue,Ft),At===null?xt=Rt:At.sibling=Rt,At=Rt);return jn&&Dl(xe,Ft),xt}for(Rt=w(xe,Rt);Ft<ve.length;Ft++)Tr=ot(Rt,xe,Ft,ve[Ft],$e),Tr!==null&&(d&&Tr.alternate!==null&&Rt.delete(Tr.key===null?Ft:Tr.key),ue=I(Tr,ue,Ft),At===null?xt=Tr:At.sibling=Tr,At=Tr);return d&&Rt.forEach(function($o){return f(xe,$o)}),jn&&Dl(xe,Ft),xt}function gt(xe,ue,ve,$e){var xt=B(ve);if(typeof xt!="function")throw Error(t(150));if(ve=xt.call(ve),ve==null)throw Error(t(151));for(var At=xt=null,Rt=ue,Ft=ue=0,Tr=null,cn=ve.next();Rt!==null&&!cn.done;Ft++,cn=ve.next()){Rt.index>Ft?(Tr=Rt,Rt=null):Tr=Rt.sibling;var $o=Oe(xe,Rt,cn.value,$e);if($o===null){Rt===null&&(Rt=Tr);break}d&&Rt&&$o.alternate===null&&f(xe,Rt),ue=I($o,ue,Ft),At===null?xt=$o:At.sibling=$o,At=$o,Rt=Tr}if(cn.done)return v(xe,Rt),jn&&Dl(xe,Ft),xt;if(Rt===null){for(;!cn.done;Ft++,cn=ve.next())cn=Ge(xe,cn.value,$e),cn!==null&&(ue=I(cn,ue,Ft),At===null?xt=cn:At.sibling=cn,At=cn);return jn&&Dl(xe,Ft),xt}for(Rt=w(xe,Rt);!cn.done;Ft++,cn=ve.next())cn=ot(Rt,xe,Ft,cn.value,$e),cn!==null&&(d&&cn.alternate!==null&&Rt.delete(cn.key===null?Ft:cn.key),ue=I(cn,ue,Ft),At===null?xt=cn:At.sibling=cn,At=cn);return d&&Rt.forEach(function(HO){return f(xe,HO)}),jn&&Dl(xe,Ft),xt}function Yn(xe,ue,ve,$e){if(typeof ve=="object"&&ve!==null&&ve.type===R&&ve.key===null&&(ve=ve.props.children),typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case M:e:{for(var xt=ve.key,At=ue;At!==null;){if(At.key===xt){if(xt=ve.type,xt===R){if(At.tag===7){v(xe,At.sibling),ue=A(At,ve.props.children),ue.return=xe,xe=ue;break e}}else if(At.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===O&&KN(xt)===At.type){v(xe,At.sibling),ue=A(At,ve.props),ue.ref=Rh(xe,At,ve),ue.return=xe,xe=ue;break e}v(xe,At);break}else f(xe,At);At=At.sibling}ve.type===R?(ue=Vl(ve.props.children,xe.mode,$e,ve.key),ue.return=xe,xe=ue):($e=eg(ve.type,ve.key,ve.props,null,xe.mode,$e),$e.ref=Rh(xe,ue,ve),$e.return=xe,xe=$e)}return H(xe);case C:e:{for(At=ve.key;ue!==null;){if(ue.key===At)if(ue.tag===4&&ue.stateNode.containerInfo===ve.containerInfo&&ue.stateNode.implementation===ve.implementation){v(xe,ue.sibling),ue=A(ue,ve.children||[]),ue.return=xe,xe=ue;break e}else{v(xe,ue);break}else f(xe,ue);ue=ue.sibling}ue=Yv(ve,xe.mode,$e),ue.return=xe,xe=ue}return H(xe);case O:return At=ve._init,Yn(xe,ue,At(ve._payload),$e)}if(it(ve))return mt(xe,ue,ve,$e);if(B(ve))return gt(xe,ue,ve,$e);Rm(xe,ve)}return typeof ve=="string"&&ve!==""||typeof ve=="number"?(ve=""+ve,ue!==null&&ue.tag===6?(v(xe,ue.sibling),ue=A(ue,ve),ue.return=xe,xe=ue):(v(xe,ue),ue=Xv(ve,xe.mode,$e),ue.return=xe,xe=ue),H(xe)):v(xe,ue)}return Yn}var tu=ZN(!0),QN=ZN(!1),Pm=Do(null),km=null,nu=null,iv=null;function sv(){iv=nu=km=null}function av(d){var f=Pm.current;kn(Pm),d._currentValue=f}function ov(d,f,v){for(;d!==null;){var w=d.alternate;if((d.childLanes&f)!==f?(d.childLanes|=f,w!==null&&(w.childLanes|=f)):w!==null&&(w.childLanes&f)!==f&&(w.childLanes|=f),d===v)break;d=d.return}}function ru(d,f){km=d,iv=nu=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&f)!==0&&(vi=!0),d.firstContext=null)}function ss(d){var f=d._currentValue;if(iv!==d)if(d={context:d,memoizedValue:f,next:null},nu===null){if(km===null)throw Error(t(308));nu=d,km.dependencies={lanes:0,firstContext:d}}else nu=nu.next=d;return f}var Il=null;function lv(d){Il===null?Il=[d]:Il.push(d)}function JN(d,f,v,w){var A=f.interleaved;return A===null?(v.next=v,lv(f)):(v.next=A.next,A.next=v),f.interleaved=v,La(d,w)}function La(d,f){d.lanes|=f;var v=d.alternate;for(v!==null&&(v.lanes|=f),v=d,d=d.return;d!==null;)d.childLanes|=f,v=d.alternate,v!==null&&(v.childLanes|=f),v=d,d=d.return;return v.tag===3?v.stateNode:null}var Fo=!1;function cv(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eE(d,f){d=d.updateQueue,f.updateQueue===d&&(f.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Da(d,f){return{eventTime:d,lane:f,tag:0,payload:null,callback:null,next:null}}function Oo(d,f,v){var w=d.updateQueue;if(w===null)return null;if(w=w.shared,(an&2)!==0){var A=w.pending;return A===null?f.next=f:(f.next=A.next,A.next=f),w.pending=f,La(d,v)}return A=w.interleaved,A===null?(f.next=f,lv(w)):(f.next=A.next,A.next=f),w.interleaved=f,La(d,v)}function Lm(d,f,v){if(f=f.updateQueue,f!==null&&(f=f.shared,(v&4194240)!==0)){var w=f.lanes;w&=d.pendingLanes,v|=w,f.lanes=v,br(d,v)}}function tE(d,f){var v=d.updateQueue,w=d.alternate;if(w!==null&&(w=w.updateQueue,v===w)){var A=null,I=null;if(v=v.firstBaseUpdate,v!==null){do{var H={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};I===null?A=I=H:I=I.next=H,v=v.next}while(v!==null);I===null?A=I=f:I=I.next=f}else A=I=f;v={baseState:w.baseState,firstBaseUpdate:A,lastBaseUpdate:I,shared:w.shared,effects:w.effects},d.updateQueue=v;return}d=v.lastBaseUpdate,d===null?v.firstBaseUpdate=f:d.next=f,v.lastBaseUpdate=f}function Dm(d,f,v,w){var A=d.updateQueue;Fo=!1;var I=A.firstBaseUpdate,H=A.lastBaseUpdate,re=A.shared.pending;if(re!==null){A.shared.pending=null;var oe=re,be=oe.next;oe.next=null,H===null?I=be:H.next=be,H=oe;var ze=d.alternate;ze!==null&&(ze=ze.updateQueue,re=ze.lastBaseUpdate,re!==H&&(re===null?ze.firstBaseUpdate=be:re.next=be,ze.lastBaseUpdate=oe))}if(I!==null){var Ge=A.baseState;H=0,ze=be=oe=null,re=I;do{var Oe=re.lane,ot=re.eventTime;if((w&Oe)===Oe){ze!==null&&(ze=ze.next={eventTime:ot,lane:0,tag:re.tag,payload:re.payload,callback:re.callback,next:null});e:{var mt=d,gt=re;switch(Oe=f,ot=v,gt.tag){case 1:if(mt=gt.payload,typeof mt=="function"){Ge=mt.call(ot,Ge,Oe);break e}Ge=mt;break e;case 3:mt.flags=mt.flags&-65537|128;case 0:if(mt=gt.payload,Oe=typeof mt=="function"?mt.call(ot,Ge,Oe):mt,Oe==null)break e;Ge=V({},Ge,Oe);break e;case 2:Fo=!0}}re.callback!==null&&re.lane!==0&&(d.flags|=64,Oe=A.effects,Oe===null?A.effects=[re]:Oe.push(re))}else ot={eventTime:ot,lane:Oe,tag:re.tag,payload:re.payload,callback:re.callback,next:null},ze===null?(be=ze=ot,oe=Ge):ze=ze.next=ot,H|=Oe;if(re=re.next,re===null){if(re=A.shared.pending,re===null)break;Oe=re,re=Oe.next,Oe.next=null,A.lastBaseUpdate=Oe,A.shared.pending=null}}while(!0);if(ze===null&&(oe=Ge),A.baseState=oe,A.firstBaseUpdate=be,A.lastBaseUpdate=ze,f=A.shared.interleaved,f!==null){A=f;do H|=A.lane,A=A.next;while(A!==f)}else I===null&&(A.shared.lanes=0);Ol|=H,d.lanes=H,d.memoizedState=Ge}}function nE(d,f,v){if(d=f.effects,f.effects=null,d!==null)for(f=0;f<d.length;f++){var w=d[f],A=w.callback;if(A!==null){if(w.callback=null,w=v,typeof A!="function")throw Error(t(191,A));A.call(w)}}}var Ph={},Zs=Do(Ph),kh=Do(Ph),Lh=Do(Ph);function jl(d){if(d===Ph)throw Error(t(174));return d}function uv(d,f){switch(Mn(Lh,f),Mn(kh,d),Mn(Zs,Ph),d=f.nodeType,d){case 9:case 11:f=(f=f.documentElement)?f.namespaceURI:Pe(null,"");break;default:d=d===8?f.parentNode:f,f=d.namespaceURI||null,d=d.tagName,f=Pe(f,d)}kn(Zs),Mn(Zs,f)}function iu(){kn(Zs),kn(kh),kn(Lh)}function rE(d){jl(Lh.current);var f=jl(Zs.current),v=Pe(f,d.type);f!==v&&(Mn(kh,d),Mn(Zs,v))}function dv(d){kh.current===d&&(kn(Zs),kn(kh))}var zn=Do(0);function Im(d){for(var f=d;f!==null;){if(f.tag===13){var v=f.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===d)break;for(;f.sibling===null;){if(f.return===null||f.return===d)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var hv=[];function fv(){for(var d=0;d<hv.length;d++)hv[d]._workInProgressVersionPrimary=null;hv.length=0}var jm=S.ReactCurrentDispatcher,pv=S.ReactCurrentBatchConfig,Fl=0,Vn=null,ur=null,wr=null,Fm=!1,Dh=!1,Ih=0,hO=0;function Gr(){throw Error(t(321))}function mv(d,f){if(f===null)return!1;for(var v=0;v<f.length&&v<d.length;v++)if(!ws(d[v],f[v]))return!1;return!0}function gv(d,f,v,w,A,I){if(Fl=I,Vn=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,jm.current=d===null||d.memoizedState===null?gO:xO,d=v(w,A),Dh){I=0;do{if(Dh=!1,Ih=0,25<=I)throw Error(t(301));I+=1,wr=ur=null,f.updateQueue=null,jm.current=yO,d=v(w,A)}while(Dh)}if(jm.current=Bm,f=ur!==null&&ur.next!==null,Fl=0,wr=ur=Vn=null,Fm=!1,f)throw Error(t(300));return d}function xv(){var d=Ih!==0;return Ih=0,d}function Qs(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wr===null?Vn.memoizedState=wr=d:wr=wr.next=d,wr}function as(){if(ur===null){var d=Vn.alternate;d=d!==null?d.memoizedState:null}else d=ur.next;var f=wr===null?Vn.memoizedState:wr.next;if(f!==null)wr=f,ur=d;else{if(d===null)throw Error(t(310));ur=d,d={memoizedState:ur.memoizedState,baseState:ur.baseState,baseQueue:ur.baseQueue,queue:ur.queue,next:null},wr===null?Vn.memoizedState=wr=d:wr=wr.next=d}return wr}function jh(d,f){return typeof f=="function"?f(d):f}function yv(d){var f=as(),v=f.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=d;var w=ur,A=w.baseQueue,I=v.pending;if(I!==null){if(A!==null){var H=A.next;A.next=I.next,I.next=H}w.baseQueue=A=I,v.pending=null}if(A!==null){I=A.next,w=w.baseState;var re=H=null,oe=null,be=I;do{var ze=be.lane;if((Fl&ze)===ze)oe!==null&&(oe=oe.next={lane:0,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null}),w=be.hasEagerState?be.eagerState:d(w,be.action);else{var Ge={lane:ze,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null};oe===null?(re=oe=Ge,H=w):oe=oe.next=Ge,Vn.lanes|=ze,Ol|=ze}be=be.next}while(be!==null&&be!==I);oe===null?H=w:oe.next=re,ws(w,f.memoizedState)||(vi=!0),f.memoizedState=w,f.baseState=H,f.baseQueue=oe,v.lastRenderedState=w}if(d=v.interleaved,d!==null){A=d;do I=A.lane,Vn.lanes|=I,Ol|=I,A=A.next;while(A!==d)}else A===null&&(v.lanes=0);return[f.memoizedState,v.dispatch]}function vv(d){var f=as(),v=f.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=d;var w=v.dispatch,A=v.pending,I=f.memoizedState;if(A!==null){v.pending=null;var H=A=A.next;do I=d(I,H.action),H=H.next;while(H!==A);ws(I,f.memoizedState)||(vi=!0),f.memoizedState=I,f.baseQueue===null&&(f.baseState=I),v.lastRenderedState=I}return[I,w]}function iE(){}function sE(d,f){var v=Vn,w=as(),A=f(),I=!ws(w.memoizedState,A);if(I&&(w.memoizedState=A,vi=!0),w=w.queue,_v(lE.bind(null,v,w,d),[d]),w.getSnapshot!==f||I||wr!==null&&wr.memoizedState.tag&1){if(v.flags|=2048,Fh(9,oE.bind(null,v,w,A,f),void 0,null),Sr===null)throw Error(t(349));(Fl&30)!==0||aE(v,f,A)}return A}function aE(d,f,v){d.flags|=16384,d={getSnapshot:f,value:v},f=Vn.updateQueue,f===null?(f={lastEffect:null,stores:null},Vn.updateQueue=f,f.stores=[d]):(v=f.stores,v===null?f.stores=[d]:v.push(d))}function oE(d,f,v,w){f.value=v,f.getSnapshot=w,cE(f)&&uE(d)}function lE(d,f,v){return v(function(){cE(f)&&uE(d)})}function cE(d){var f=d.getSnapshot;d=d.value;try{var v=f();return!ws(d,v)}catch{return!0}}function uE(d){var f=La(d,1);f!==null&&Ms(f,d,1,-1)}function dE(d){var f=Qs();return typeof d=="function"&&(d=d()),f.memoizedState=f.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jh,lastRenderedState:d},f.queue=d,d=d.dispatch=mO.bind(null,Vn,d),[f.memoizedState,d]}function Fh(d,f,v,w){return d={tag:d,create:f,destroy:v,deps:w,next:null},f=Vn.updateQueue,f===null?(f={lastEffect:null,stores:null},Vn.updateQueue=f,f.lastEffect=d.next=d):(v=f.lastEffect,v===null?f.lastEffect=d.next=d:(w=v.next,v.next=d,d.next=w,f.lastEffect=d)),d}function hE(){return as().memoizedState}function Om(d,f,v,w){var A=Qs();Vn.flags|=d,A.memoizedState=Fh(1|f,v,void 0,w===void 0?null:w)}function Um(d,f,v,w){var A=as();w=w===void 0?null:w;var I=void 0;if(ur!==null){var H=ur.memoizedState;if(I=H.destroy,w!==null&&mv(w,H.deps)){A.memoizedState=Fh(f,v,I,w);return}}Vn.flags|=d,A.memoizedState=Fh(1|f,v,I,w)}function fE(d,f){return Om(8390656,8,d,f)}function _v(d,f){return Um(2048,8,d,f)}function pE(d,f){return Um(4,2,d,f)}function mE(d,f){return Um(4,4,d,f)}function gE(d,f){if(typeof f=="function")return d=d(),f(d),function(){f(null)};if(f!=null)return d=d(),f.current=d,function(){f.current=null}}function xE(d,f,v){return v=v!=null?v.concat([d]):null,Um(4,4,gE.bind(null,f,d),v)}function bv(){}function yE(d,f){var v=as();f=f===void 0?null:f;var w=v.memoizedState;return w!==null&&f!==null&&mv(f,w[1])?w[0]:(v.memoizedState=[d,f],d)}function vE(d,f){var v=as();f=f===void 0?null:f;var w=v.memoizedState;return w!==null&&f!==null&&mv(f,w[1])?w[0]:(d=d(),v.memoizedState=[d,f],d)}function _E(d,f,v){return(Fl&21)===0?(d.baseState&&(d.baseState=!1,vi=!0),d.memoizedState=v):(ws(v,f)||(v=Sn(),Vn.lanes|=v,Ol|=v,d.baseState=!0),f)}function fO(d,f){var v=sn;sn=v!==0&&4>v?v:4,d(!0);var w=pv.transition;pv.transition={};try{d(!1),f()}finally{sn=v,pv.transition=w}}function bE(){return as().memoizedState}function pO(d,f,v){var w=Vo(d);if(v={lane:w,action:v,hasEagerState:!1,eagerState:null,next:null},wE(d))SE(f,v);else if(v=JN(d,f,v,w),v!==null){var A=ii();Ms(v,d,w,A),TE(v,f,w)}}function mO(d,f,v){var w=Vo(d),A={lane:w,action:v,hasEagerState:!1,eagerState:null,next:null};if(wE(d))SE(f,A);else{var I=d.alternate;if(d.lanes===0&&(I===null||I.lanes===0)&&(I=f.lastRenderedReducer,I!==null))try{var H=f.lastRenderedState,re=I(H,v);if(A.hasEagerState=!0,A.eagerState=re,ws(re,H)){var oe=f.interleaved;oe===null?(A.next=A,lv(f)):(A.next=oe.next,oe.next=A),f.interleaved=A;return}}catch{}finally{}v=JN(d,f,A,w),v!==null&&(A=ii(),Ms(v,d,w,A),TE(v,f,w))}}function wE(d){var f=d.alternate;return d===Vn||f!==null&&f===Vn}function SE(d,f){Dh=Fm=!0;var v=d.pending;v===null?f.next=f:(f.next=v.next,v.next=f),d.pending=f}function TE(d,f,v){if((v&4194240)!==0){var w=f.lanes;w&=d.pendingLanes,v|=w,f.lanes=v,br(d,v)}}var Bm={readContext:ss,useCallback:Gr,useContext:Gr,useEffect:Gr,useImperativeHandle:Gr,useInsertionEffect:Gr,useLayoutEffect:Gr,useMemo:Gr,useReducer:Gr,useRef:Gr,useState:Gr,useDebugValue:Gr,useDeferredValue:Gr,useTransition:Gr,useMutableSource:Gr,useSyncExternalStore:Gr,useId:Gr,unstable_isNewReconciler:!1},gO={readContext:ss,useCallback:function(d,f){return Qs().memoizedState=[d,f===void 0?null:f],d},useContext:ss,useEffect:fE,useImperativeHandle:function(d,f,v){return v=v!=null?v.concat([d]):null,Om(4194308,4,gE.bind(null,f,d),v)},useLayoutEffect:function(d,f){return Om(4194308,4,d,f)},useInsertionEffect:function(d,f){return Om(4,2,d,f)},useMemo:function(d,f){var v=Qs();return f=f===void 0?null:f,d=d(),v.memoizedState=[d,f],d},useReducer:function(d,f,v){var w=Qs();return f=v!==void 0?v(f):f,w.memoizedState=w.baseState=f,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:f},w.queue=d,d=d.dispatch=pO.bind(null,Vn,d),[w.memoizedState,d]},useRef:function(d){var f=Qs();return d={current:d},f.memoizedState=d},useState:dE,useDebugValue:bv,useDeferredValue:function(d){return Qs().memoizedState=d},useTransition:function(){var d=dE(!1),f=d[0];return d=fO.bind(null,d[1]),Qs().memoizedState=d,[f,d]},useMutableSource:function(){},useSyncExternalStore:function(d,f,v){var w=Vn,A=Qs();if(jn){if(v===void 0)throw Error(t(407));v=v()}else{if(v=f(),Sr===null)throw Error(t(349));(Fl&30)!==0||aE(w,f,v)}A.memoizedState=v;var I={value:v,getSnapshot:f};return A.queue=I,fE(lE.bind(null,w,I,d),[d]),w.flags|=2048,Fh(9,oE.bind(null,w,I,v,f),void 0,null),v},useId:function(){var d=Qs(),f=Sr.identifierPrefix;if(jn){var v=ka,w=Pa;v=(w&~(1<<32-Wt(w)-1)).toString(32)+v,f=":"+f+"R"+v,v=Ih++,0<v&&(f+="H"+v.toString(32)),f+=":"}else v=hO++,f=":"+f+"r"+v.toString(32)+":";return d.memoizedState=f},unstable_isNewReconciler:!1},xO={readContext:ss,useCallback:yE,useContext:ss,useEffect:_v,useImperativeHandle:xE,useInsertionEffect:pE,useLayoutEffect:mE,useMemo:vE,useReducer:yv,useRef:hE,useState:function(){return yv(jh)},useDebugValue:bv,useDeferredValue:function(d){var f=as();return _E(f,ur.memoizedState,d)},useTransition:function(){var d=yv(jh)[0],f=as().memoizedState;return[d,f]},useMutableSource:iE,useSyncExternalStore:sE,useId:bE,unstable_isNewReconciler:!1},yO={readContext:ss,useCallback:yE,useContext:ss,useEffect:_v,useImperativeHandle:xE,useInsertionEffect:pE,useLayoutEffect:mE,useMemo:vE,useReducer:vv,useRef:hE,useState:function(){return vv(jh)},useDebugValue:bv,useDeferredValue:function(d){var f=as();return ur===null?f.memoizedState=d:_E(f,ur.memoizedState,d)},useTransition:function(){var d=vv(jh)[0],f=as().memoizedState;return[d,f]},useMutableSource:iE,useSyncExternalStore:sE,useId:bE,unstable_isNewReconciler:!1};function Ts(d,f){if(d&&d.defaultProps){f=V({},f),d=d.defaultProps;for(var v in d)f[v]===void 0&&(f[v]=d[v]);return f}return f}function wv(d,f,v,w){f=d.memoizedState,v=v(w,f),v=v==null?f:V({},f,v),d.memoizedState=v,d.lanes===0&&(d.updateQueue.baseState=v)}var zm={isMounted:function(d){return(d=d._reactInternals)?ns(d)===d:!1},enqueueSetState:function(d,f,v){d=d._reactInternals;var w=ii(),A=Vo(d),I=Da(w,A);I.payload=f,v!=null&&(I.callback=v),f=Oo(d,I,A),f!==null&&(Ms(f,d,A,w),Lm(f,d,A))},enqueueReplaceState:function(d,f,v){d=d._reactInternals;var w=ii(),A=Vo(d),I=Da(w,A);I.tag=1,I.payload=f,v!=null&&(I.callback=v),f=Oo(d,I,A),f!==null&&(Ms(f,d,A,w),Lm(f,d,A))},enqueueForceUpdate:function(d,f){d=d._reactInternals;var v=ii(),w=Vo(d),A=Da(v,w);A.tag=2,f!=null&&(A.callback=f),f=Oo(d,A,w),f!==null&&(Ms(f,d,w,v),Lm(f,d,w))}};function NE(d,f,v,w,A,I,H){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(w,I,H):f.prototype&&f.prototype.isPureReactComponent?!Sh(v,w)||!Sh(A,I):!0}function EE(d,f,v){var w=!1,A=Io,I=f.contextType;return typeof I=="object"&&I!==null?I=ss(I):(A=yi(f)?kl:Vr.current,w=f.contextTypes,I=(w=w!=null)?Zc(d,A):Io),f=new f(v,I),d.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=zm,d.stateNode=f,f._reactInternals=d,w&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=A,d.__reactInternalMemoizedMaskedChildContext=I),f}function ME(d,f,v,w){d=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(v,w),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(v,w),f.state!==d&&zm.enqueueReplaceState(f,f.state,null)}function Sv(d,f,v,w){var A=d.stateNode;A.props=v,A.state=d.memoizedState,A.refs={},cv(d);var I=f.contextType;typeof I=="object"&&I!==null?A.context=ss(I):(I=yi(f)?kl:Vr.current,A.context=Zc(d,I)),A.state=d.memoizedState,I=f.getDerivedStateFromProps,typeof I=="function"&&(wv(d,f,I,v),A.state=d.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(f=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),f!==A.state&&zm.enqueueReplaceState(A,A.state,null),Dm(d,v,A,w),A.state=d.memoizedState),typeof A.componentDidMount=="function"&&(d.flags|=4194308)}function su(d,f){try{var v="",w=f;do v+=q(w),w=w.return;while(w);var A=v}catch(I){A=`
Error generating stack: `+I.message+`
`+I.stack}return{value:d,source:f,stack:A,digest:null}}function Tv(d,f,v){return{value:d,source:null,stack:v??null,digest:f??null}}function Nv(d,f){try{console.error(f.value)}catch(v){setTimeout(function(){throw v})}}var vO=typeof WeakMap=="function"?WeakMap:Map;function CE(d,f,v){v=Da(-1,v),v.tag=3,v.payload={element:null};var w=f.value;return v.callback=function(){Xm||(Xm=!0,Bv=w),Nv(d,f)},v}function AE(d,f,v){v=Da(-1,v),v.tag=3;var w=d.type.getDerivedStateFromError;if(typeof w=="function"){var A=f.value;v.payload=function(){return w(A)},v.callback=function(){Nv(d,f)}}var I=d.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(v.callback=function(){Nv(d,f),typeof w!="function"&&(Bo===null?Bo=new Set([this]):Bo.add(this));var H=f.stack;this.componentDidCatch(f.value,{componentStack:H!==null?H:""})}),v}function RE(d,f,v){var w=d.pingCache;if(w===null){w=d.pingCache=new vO;var A=new Set;w.set(f,A)}else A=w.get(f),A===void 0&&(A=new Set,w.set(f,A));A.has(v)||(A.add(v),d=LO.bind(null,d,f,v),f.then(d,d))}function PE(d){do{var f;if((f=d.tag===13)&&(f=d.memoizedState,f=f!==null?f.dehydrated!==null:!0),f)return d;d=d.return}while(d!==null);return null}function kE(d,f,v,w,A){return(d.mode&1)===0?(d===f?d.flags|=65536:(d.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(f=Da(-1,1),f.tag=2,Oo(v,f,1))),v.lanes|=1),d):(d.flags|=65536,d.lanes=A,d)}var _O=S.ReactCurrentOwner,vi=!1;function ri(d,f,v,w){f.child=d===null?QN(f,null,v,w):tu(f,d.child,v,w)}function LE(d,f,v,w,A){v=v.render;var I=f.ref;return ru(f,A),w=gv(d,f,v,w,I,A),v=xv(),d!==null&&!vi?(f.updateQueue=d.updateQueue,f.flags&=-2053,d.lanes&=~A,Ia(d,f,A)):(jn&&v&&Jy(f),f.flags|=1,ri(d,f,w,A),f.child)}function DE(d,f,v,w,A){if(d===null){var I=v.type;return typeof I=="function"&&!qv(I)&&I.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(f.tag=15,f.type=I,IE(d,f,I,w,A)):(d=eg(v.type,null,w,f,f.mode,A),d.ref=f.ref,d.return=f,f.child=d)}if(I=d.child,(d.lanes&A)===0){var H=I.memoizedProps;if(v=v.compare,v=v!==null?v:Sh,v(H,w)&&d.ref===f.ref)return Ia(d,f,A)}return f.flags|=1,d=Ho(I,w),d.ref=f.ref,d.return=f,f.child=d}function IE(d,f,v,w,A){if(d!==null){var I=d.memoizedProps;if(Sh(I,w)&&d.ref===f.ref)if(vi=!1,f.pendingProps=w=I,(d.lanes&A)!==0)(d.flags&131072)!==0&&(vi=!0);else return f.lanes=d.lanes,Ia(d,f,A)}return Ev(d,f,v,w,A)}function jE(d,f,v){var w=f.pendingProps,A=w.children,I=d!==null?d.memoizedState:null;if(w.mode==="hidden")if((f.mode&1)===0)f.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mn(ou,Ui),Ui|=v;else{if((v&1073741824)===0)return d=I!==null?I.baseLanes|v:v,f.lanes=f.childLanes=1073741824,f.memoizedState={baseLanes:d,cachePool:null,transitions:null},f.updateQueue=null,Mn(ou,Ui),Ui|=d,null;f.memoizedState={baseLanes:0,cachePool:null,transitions:null},w=I!==null?I.baseLanes:v,Mn(ou,Ui),Ui|=w}else I!==null?(w=I.baseLanes|v,f.memoizedState=null):w=v,Mn(ou,Ui),Ui|=w;return ri(d,f,A,v),f.child}function FE(d,f){var v=f.ref;(d===null&&v!==null||d!==null&&d.ref!==v)&&(f.flags|=512,f.flags|=2097152)}function Ev(d,f,v,w,A){var I=yi(v)?kl:Vr.current;return I=Zc(f,I),ru(f,A),v=gv(d,f,v,w,I,A),w=xv(),d!==null&&!vi?(f.updateQueue=d.updateQueue,f.flags&=-2053,d.lanes&=~A,Ia(d,f,A)):(jn&&w&&Jy(f),f.flags|=1,ri(d,f,v,A),f.child)}function OE(d,f,v,w,A){if(yi(v)){var I=!0;Nm(f)}else I=!1;if(ru(f,A),f.stateNode===null)Gm(d,f),EE(f,v,w),Sv(f,v,w,A),w=!0;else if(d===null){var H=f.stateNode,re=f.memoizedProps;H.props=re;var oe=H.context,be=v.contextType;typeof be=="object"&&be!==null?be=ss(be):(be=yi(v)?kl:Vr.current,be=Zc(f,be));var ze=v.getDerivedStateFromProps,Ge=typeof ze=="function"||typeof H.getSnapshotBeforeUpdate=="function";Ge||typeof H.UNSAFE_componentWillReceiveProps!="function"&&typeof H.componentWillReceiveProps!="function"||(re!==w||oe!==be)&&ME(f,H,w,be),Fo=!1;var Oe=f.memoizedState;H.state=Oe,Dm(f,w,H,A),oe=f.memoizedState,re!==w||Oe!==oe||xi.current||Fo?(typeof ze=="function"&&(wv(f,v,ze,w),oe=f.memoizedState),(re=Fo||NE(f,v,re,w,Oe,oe,be))?(Ge||typeof H.UNSAFE_componentWillMount!="function"&&typeof H.componentWillMount!="function"||(typeof H.componentWillMount=="function"&&H.componentWillMount(),typeof H.UNSAFE_componentWillMount=="function"&&H.UNSAFE_componentWillMount()),typeof H.componentDidMount=="function"&&(f.flags|=4194308)):(typeof H.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=w,f.memoizedState=oe),H.props=w,H.state=oe,H.context=be,w=re):(typeof H.componentDidMount=="function"&&(f.flags|=4194308),w=!1)}else{H=f.stateNode,eE(d,f),re=f.memoizedProps,be=f.type===f.elementType?re:Ts(f.type,re),H.props=be,Ge=f.pendingProps,Oe=H.context,oe=v.contextType,typeof oe=="object"&&oe!==null?oe=ss(oe):(oe=yi(v)?kl:Vr.current,oe=Zc(f,oe));var ot=v.getDerivedStateFromProps;(ze=typeof ot=="function"||typeof H.getSnapshotBeforeUpdate=="function")||typeof H.UNSAFE_componentWillReceiveProps!="function"&&typeof H.componentWillReceiveProps!="function"||(re!==Ge||Oe!==oe)&&ME(f,H,w,oe),Fo=!1,Oe=f.memoizedState,H.state=Oe,Dm(f,w,H,A);var mt=f.memoizedState;re!==Ge||Oe!==mt||xi.current||Fo?(typeof ot=="function"&&(wv(f,v,ot,w),mt=f.memoizedState),(be=Fo||NE(f,v,be,w,Oe,mt,oe)||!1)?(ze||typeof H.UNSAFE_componentWillUpdate!="function"&&typeof H.componentWillUpdate!="function"||(typeof H.componentWillUpdate=="function"&&H.componentWillUpdate(w,mt,oe),typeof H.UNSAFE_componentWillUpdate=="function"&&H.UNSAFE_componentWillUpdate(w,mt,oe)),typeof H.componentDidUpdate=="function"&&(f.flags|=4),typeof H.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof H.componentDidUpdate!="function"||re===d.memoizedProps&&Oe===d.memoizedState||(f.flags|=4),typeof H.getSnapshotBeforeUpdate!="function"||re===d.memoizedProps&&Oe===d.memoizedState||(f.flags|=1024),f.memoizedProps=w,f.memoizedState=mt),H.props=w,H.state=mt,H.context=oe,w=be):(typeof H.componentDidUpdate!="function"||re===d.memoizedProps&&Oe===d.memoizedState||(f.flags|=4),typeof H.getSnapshotBeforeUpdate!="function"||re===d.memoizedProps&&Oe===d.memoizedState||(f.flags|=1024),w=!1)}return Mv(d,f,v,w,I,A)}function Mv(d,f,v,w,A,I){FE(d,f);var H=(f.flags&128)!==0;if(!w&&!H)return A&&GN(f,v,!1),Ia(d,f,I);w=f.stateNode,_O.current=f;var re=H&&typeof v.getDerivedStateFromError!="function"?null:w.render();return f.flags|=1,d!==null&&H?(f.child=tu(f,d.child,null,I),f.child=tu(f,null,re,I)):ri(d,f,re,I),f.memoizedState=w.state,A&&GN(f,v,!0),f.child}function UE(d){var f=d.stateNode;f.pendingContext?zN(d,f.pendingContext,f.pendingContext!==f.context):f.context&&zN(d,f.context,!1),uv(d,f.containerInfo)}function BE(d,f,v,w,A){return eu(),rv(A),f.flags|=256,ri(d,f,v,w),f.child}var Cv={dehydrated:null,treeContext:null,retryLane:0};function Av(d){return{baseLanes:d,cachePool:null,transitions:null}}function zE(d,f,v){var w=f.pendingProps,A=zn.current,I=!1,H=(f.flags&128)!==0,re;if((re=H)||(re=d!==null&&d.memoizedState===null?!1:(A&2)!==0),re?(I=!0,f.flags&=-129):(d===null||d.memoizedState!==null)&&(A|=1),Mn(zn,A&1),d===null)return nv(f),d=f.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((f.mode&1)===0?f.lanes=1:d.data==="$!"?f.lanes=8:f.lanes=1073741824,null):(H=w.children,d=w.fallback,I?(w=f.mode,I=f.child,H={mode:"hidden",children:H},(w&1)===0&&I!==null?(I.childLanes=0,I.pendingProps=H):I=tg(H,w,0,null),d=Vl(d,w,v,null),I.return=f,d.return=f,I.sibling=d,f.child=I,f.child.memoizedState=Av(v),f.memoizedState=Cv,d):Rv(f,H));if(A=d.memoizedState,A!==null&&(re=A.dehydrated,re!==null))return bO(d,f,H,w,re,A,v);if(I){I=w.fallback,H=f.mode,A=d.child,re=A.sibling;var oe={mode:"hidden",children:w.children};return(H&1)===0&&f.child!==A?(w=f.child,w.childLanes=0,w.pendingProps=oe,f.deletions=null):(w=Ho(A,oe),w.subtreeFlags=A.subtreeFlags&14680064),re!==null?I=Ho(re,I):(I=Vl(I,H,v,null),I.flags|=2),I.return=f,w.return=f,w.sibling=I,f.child=w,w=I,I=f.child,H=d.child.memoizedState,H=H===null?Av(v):{baseLanes:H.baseLanes|v,cachePool:null,transitions:H.transitions},I.memoizedState=H,I.childLanes=d.childLanes&~v,f.memoizedState=Cv,w}return I=d.child,d=I.sibling,w=Ho(I,{mode:"visible",children:w.children}),(f.mode&1)===0&&(w.lanes=v),w.return=f,w.sibling=null,d!==null&&(v=f.deletions,v===null?(f.deletions=[d],f.flags|=16):v.push(d)),f.child=w,f.memoizedState=null,w}function Rv(d,f){return f=tg({mode:"visible",children:f},d.mode,0,null),f.return=d,d.child=f}function Vm(d,f,v,w){return w!==null&&rv(w),tu(f,d.child,null,v),d=Rv(f,f.pendingProps.children),d.flags|=2,f.memoizedState=null,d}function bO(d,f,v,w,A,I,H){if(v)return f.flags&256?(f.flags&=-257,w=Tv(Error(t(422))),Vm(d,f,H,w)):f.memoizedState!==null?(f.child=d.child,f.flags|=128,null):(I=w.fallback,A=f.mode,w=tg({mode:"visible",children:w.children},A,0,null),I=Vl(I,A,H,null),I.flags|=2,w.return=f,I.return=f,w.sibling=I,f.child=w,(f.mode&1)!==0&&tu(f,d.child,null,H),f.child.memoizedState=Av(H),f.memoizedState=Cv,I);if((f.mode&1)===0)return Vm(d,f,H,null);if(A.data==="$!"){if(w=A.nextSibling&&A.nextSibling.dataset,w)var re=w.dgst;return w=re,I=Error(t(419)),w=Tv(I,w,void 0),Vm(d,f,H,w)}if(re=(H&d.childLanes)!==0,vi||re){if(w=Sr,w!==null){switch(H&-H){case 4:A=2;break;case 16:A=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:A=32;break;case 536870912:A=268435456;break;default:A=0}A=(A&(w.suspendedLanes|H))!==0?0:A,A!==0&&A!==I.retryLane&&(I.retryLane=A,La(d,A),Ms(w,d,A,-1))}return Wv(),w=Tv(Error(t(421))),Vm(d,f,H,w)}return A.data==="$?"?(f.flags|=128,f.child=d.child,f=DO.bind(null,d),A._reactRetry=f,null):(d=I.treeContext,Oi=Lo(A.nextSibling),Fi=f,jn=!0,Ss=null,d!==null&&(rs[is++]=Pa,rs[is++]=ka,rs[is++]=Ll,Pa=d.id,ka=d.overflow,Ll=f),f=Rv(f,w.children),f.flags|=4096,f)}function VE(d,f,v){d.lanes|=f;var w=d.alternate;w!==null&&(w.lanes|=f),ov(d.return,f,v)}function Pv(d,f,v,w,A){var I=d.memoizedState;I===null?d.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:w,tail:v,tailMode:A}:(I.isBackwards=f,I.rendering=null,I.renderingStartTime=0,I.last=w,I.tail=v,I.tailMode=A)}function GE(d,f,v){var w=f.pendingProps,A=w.revealOrder,I=w.tail;if(ri(d,f,w.children,v),w=zn.current,(w&2)!==0)w=w&1|2,f.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=f.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&VE(d,v,f);else if(d.tag===19)VE(d,v,f);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===f)break e;for(;d.sibling===null;){if(d.return===null||d.return===f)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}w&=1}if(Mn(zn,w),(f.mode&1)===0)f.memoizedState=null;else switch(A){case"forwards":for(v=f.child,A=null;v!==null;)d=v.alternate,d!==null&&Im(d)===null&&(A=v),v=v.sibling;v=A,v===null?(A=f.child,f.child=null):(A=v.sibling,v.sibling=null),Pv(f,!1,A,v,I);break;case"backwards":for(v=null,A=f.child,f.child=null;A!==null;){if(d=A.alternate,d!==null&&Im(d)===null){f.child=A;break}d=A.sibling,A.sibling=v,v=A,A=d}Pv(f,!0,v,null,I);break;case"together":Pv(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function Gm(d,f){(f.mode&1)===0&&d!==null&&(d.alternate=null,f.alternate=null,f.flags|=2)}function Ia(d,f,v){if(d!==null&&(f.dependencies=d.dependencies),Ol|=f.lanes,(v&f.childLanes)===0)return null;if(d!==null&&f.child!==d.child)throw Error(t(153));if(f.child!==null){for(d=f.child,v=Ho(d,d.pendingProps),f.child=v,v.return=f;d.sibling!==null;)d=d.sibling,v=v.sibling=Ho(d,d.pendingProps),v.return=f;v.sibling=null}return f.child}function wO(d,f,v){switch(f.tag){case 3:UE(f),eu();break;case 5:rE(f);break;case 1:yi(f.type)&&Nm(f);break;case 4:uv(f,f.stateNode.containerInfo);break;case 10:var w=f.type._context,A=f.memoizedProps.value;Mn(Pm,w._currentValue),w._currentValue=A;break;case 13:if(w=f.memoizedState,w!==null)return w.dehydrated!==null?(Mn(zn,zn.current&1),f.flags|=128,null):(v&f.child.childLanes)!==0?zE(d,f,v):(Mn(zn,zn.current&1),d=Ia(d,f,v),d!==null?d.sibling:null);Mn(zn,zn.current&1);break;case 19:if(w=(v&f.childLanes)!==0,(d.flags&128)!==0){if(w)return GE(d,f,v);f.flags|=128}if(A=f.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),Mn(zn,zn.current),w)break;return null;case 22:case 23:return f.lanes=0,jE(d,f,v)}return Ia(d,f,v)}var HE,kv,$E,WE;HE=function(d,f){for(var v=f.child;v!==null;){if(v.tag===5||v.tag===6)d.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===f)break;for(;v.sibling===null;){if(v.return===null||v.return===f)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},kv=function(){},$E=function(d,f,v,w){var A=d.memoizedProps;if(A!==w){d=f.stateNode,jl(Zs.current);var I=null;switch(v){case"input":A=ie(d,A),w=ie(d,w),I=[];break;case"select":A=V({},A,{value:void 0}),w=V({},w,{value:void 0}),I=[];break;case"textarea":A=fn(d,A),w=fn(d,w),I=[];break;default:typeof A.onClick!="function"&&typeof w.onClick=="function"&&(d.onclick=wm)}pt(v,w);var H;v=null;for(be in A)if(!w.hasOwnProperty(be)&&A.hasOwnProperty(be)&&A[be]!=null)if(be==="style"){var re=A[be];for(H in re)re.hasOwnProperty(H)&&(v||(v={}),v[H]="")}else be!=="dangerouslySetInnerHTML"&&be!=="children"&&be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&be!=="autoFocus"&&(i.hasOwnProperty(be)?I||(I=[]):(I=I||[]).push(be,null));for(be in w){var oe=w[be];if(re=A?.[be],w.hasOwnProperty(be)&&oe!==re&&(oe!=null||re!=null))if(be==="style")if(re){for(H in re)!re.hasOwnProperty(H)||oe&&oe.hasOwnProperty(H)||(v||(v={}),v[H]="");for(H in oe)oe.hasOwnProperty(H)&&re[H]!==oe[H]&&(v||(v={}),v[H]=oe[H])}else v||(I||(I=[]),I.push(be,v)),v=oe;else be==="dangerouslySetInnerHTML"?(oe=oe?oe.__html:void 0,re=re?re.__html:void 0,oe!=null&&re!==oe&&(I=I||[]).push(be,oe)):be==="children"?typeof oe!="string"&&typeof oe!="number"||(I=I||[]).push(be,""+oe):be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&(i.hasOwnProperty(be)?(oe!=null&&be==="onScroll"&&Pn("scroll",d),I||re===oe||(I=[])):(I=I||[]).push(be,oe))}v&&(I=I||[]).push("style",v);var be=I;(f.updateQueue=be)&&(f.flags|=4)}},WE=function(d,f,v,w){v!==w&&(f.flags|=4)};function Oh(d,f){if(!jn)switch(d.tailMode){case"hidden":f=d.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?d.tail=null:v.sibling=null;break;case"collapsed":v=d.tail;for(var w=null;v!==null;)v.alternate!==null&&(w=v),v=v.sibling;w===null?f||d.tail===null?d.tail=null:d.tail.sibling=null:w.sibling=null}}function Hr(d){var f=d.alternate!==null&&d.alternate.child===d.child,v=0,w=0;if(f)for(var A=d.child;A!==null;)v|=A.lanes|A.childLanes,w|=A.subtreeFlags&14680064,w|=A.flags&14680064,A.return=d,A=A.sibling;else for(A=d.child;A!==null;)v|=A.lanes|A.childLanes,w|=A.subtreeFlags,w|=A.flags,A.return=d,A=A.sibling;return d.subtreeFlags|=w,d.childLanes=v,f}function SO(d,f,v){var w=f.pendingProps;switch(ev(f),f.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hr(f),null;case 1:return yi(f.type)&&Tm(),Hr(f),null;case 3:return w=f.stateNode,iu(),kn(xi),kn(Vr),fv(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(d===null||d.child===null)&&(Am(f)?f.flags|=4:d===null||d.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Ss!==null&&(Gv(Ss),Ss=null))),kv(d,f),Hr(f),null;case 5:dv(f);var A=jl(Lh.current);if(v=f.type,d!==null&&f.stateNode!=null)$E(d,f,v,w,A),d.ref!==f.ref&&(f.flags|=512,f.flags|=2097152);else{if(!w){if(f.stateNode===null)throw Error(t(166));return Hr(f),null}if(d=jl(Zs.current),Am(f)){w=f.stateNode,v=f.type;var I=f.memoizedProps;switch(w[Ks]=f,w[Ch]=I,d=(f.mode&1)!==0,v){case"dialog":Pn("cancel",w),Pn("close",w);break;case"iframe":case"object":case"embed":Pn("load",w);break;case"video":case"audio":for(A=0;A<Nh.length;A++)Pn(Nh[A],w);break;case"source":Pn("error",w);break;case"img":case"image":case"link":Pn("error",w),Pn("load",w);break;case"details":Pn("toggle",w);break;case"input":Et(w,I),Pn("invalid",w);break;case"select":w._wrapperState={wasMultiple:!!I.multiple},Pn("invalid",w);break;case"textarea":ne(w,I),Pn("invalid",w)}pt(v,I),A=null;for(var H in I)if(I.hasOwnProperty(H)){var re=I[H];H==="children"?typeof re=="string"?w.textContent!==re&&(I.suppressHydrationWarning!==!0&&bm(w.textContent,re,d),A=["children",re]):typeof re=="number"&&w.textContent!==""+re&&(I.suppressHydrationWarning!==!0&&bm(w.textContent,re,d),A=["children",""+re]):i.hasOwnProperty(H)&&re!=null&&H==="onScroll"&&Pn("scroll",w)}switch(v){case"input":Re(w),Ne(w,I,!0);break;case"textarea":Re(w),ye(w);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(w.onclick=wm)}w=A,f.updateQueue=w,w!==null&&(f.flags|=4)}else{H=A.nodeType===9?A:A.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Ce(v)),d==="http://www.w3.org/1999/xhtml"?v==="script"?(d=H.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof w.is=="string"?d=H.createElement(v,{is:w.is}):(d=H.createElement(v),v==="select"&&(H=d,w.multiple?H.multiple=!0:w.size&&(H.size=w.size))):d=H.createElementNS(d,v),d[Ks]=f,d[Ch]=w,HE(d,f,!1,!1),f.stateNode=d;e:{switch(H=We(v,w),v){case"dialog":Pn("cancel",d),Pn("close",d),A=w;break;case"iframe":case"object":case"embed":Pn("load",d),A=w;break;case"video":case"audio":for(A=0;A<Nh.length;A++)Pn(Nh[A],d);A=w;break;case"source":Pn("error",d),A=w;break;case"img":case"image":case"link":Pn("error",d),Pn("load",d),A=w;break;case"details":Pn("toggle",d),A=w;break;case"input":Et(d,w),A=ie(d,w),Pn("invalid",d);break;case"option":A=w;break;case"select":d._wrapperState={wasMultiple:!!w.multiple},A=V({},w,{value:void 0}),Pn("invalid",d);break;case"textarea":ne(d,w),A=fn(d,w),Pn("invalid",d);break;default:A=w}pt(v,A),re=A;for(I in re)if(re.hasOwnProperty(I)){var oe=re[I];I==="style"?et(d,oe):I==="dangerouslySetInnerHTML"?(oe=oe?oe.__html:void 0,oe!=null&&ut(d,oe)):I==="children"?typeof oe=="string"?(v!=="textarea"||oe!=="")&&qe(d,oe):typeof oe=="number"&&qe(d,""+oe):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(i.hasOwnProperty(I)?oe!=null&&I==="onScroll"&&Pn("scroll",d):oe!=null&&T(d,I,oe,H))}switch(v){case"input":Re(d),Ne(d,w,!1);break;case"textarea":Re(d),ye(d);break;case"option":w.value!=null&&d.setAttribute("value",""+X(w.value));break;case"select":d.multiple=!!w.multiple,I=w.value,I!=null?wt(d,!!w.multiple,I,!1):w.defaultValue!=null&&wt(d,!!w.multiple,w.defaultValue,!0);break;default:typeof A.onClick=="function"&&(d.onclick=wm)}switch(v){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}}w&&(f.flags|=4)}f.ref!==null&&(f.flags|=512,f.flags|=2097152)}return Hr(f),null;case 6:if(d&&f.stateNode!=null)WE(d,f,d.memoizedProps,w);else{if(typeof w!="string"&&f.stateNode===null)throw Error(t(166));if(v=jl(Lh.current),jl(Zs.current),Am(f)){if(w=f.stateNode,v=f.memoizedProps,w[Ks]=f,(I=w.nodeValue!==v)&&(d=Fi,d!==null))switch(d.tag){case 3:bm(w.nodeValue,v,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&bm(w.nodeValue,v,(d.mode&1)!==0)}I&&(f.flags|=4)}else w=(v.nodeType===9?v:v.ownerDocument).createTextNode(w),w[Ks]=f,f.stateNode=w}return Hr(f),null;case 13:if(kn(zn),w=f.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(jn&&Oi!==null&&(f.mode&1)!==0&&(f.flags&128)===0)YN(),eu(),f.flags|=98560,I=!1;else if(I=Am(f),w!==null&&w.dehydrated!==null){if(d===null){if(!I)throw Error(t(318));if(I=f.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(t(317));I[Ks]=f}else eu(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Hr(f),I=!1}else Ss!==null&&(Gv(Ss),Ss=null),I=!0;if(!I)return f.flags&65536?f:null}return(f.flags&128)!==0?(f.lanes=v,f):(w=w!==null,w!==(d!==null&&d.memoizedState!==null)&&w&&(f.child.flags|=8192,(f.mode&1)!==0&&(d===null||(zn.current&1)!==0?dr===0&&(dr=3):Wv())),f.updateQueue!==null&&(f.flags|=4),Hr(f),null);case 4:return iu(),kv(d,f),d===null&&Eh(f.stateNode.containerInfo),Hr(f),null;case 10:return av(f.type._context),Hr(f),null;case 17:return yi(f.type)&&Tm(),Hr(f),null;case 19:if(kn(zn),I=f.memoizedState,I===null)return Hr(f),null;if(w=(f.flags&128)!==0,H=I.rendering,H===null)if(w)Oh(I,!1);else{if(dr!==0||d!==null&&(d.flags&128)!==0)for(d=f.child;d!==null;){if(H=Im(d),H!==null){for(f.flags|=128,Oh(I,!1),w=H.updateQueue,w!==null&&(f.updateQueue=w,f.flags|=4),f.subtreeFlags=0,w=v,v=f.child;v!==null;)I=v,d=w,I.flags&=14680066,H=I.alternate,H===null?(I.childLanes=0,I.lanes=d,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=H.childLanes,I.lanes=H.lanes,I.child=H.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=H.memoizedProps,I.memoizedState=H.memoizedState,I.updateQueue=H.updateQueue,I.type=H.type,d=H.dependencies,I.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),v=v.sibling;return Mn(zn,zn.current&1|2),f.child}d=d.sibling}I.tail!==null&&ge()>lu&&(f.flags|=128,w=!0,Oh(I,!1),f.lanes=4194304)}else{if(!w)if(d=Im(H),d!==null){if(f.flags|=128,w=!0,v=d.updateQueue,v!==null&&(f.updateQueue=v,f.flags|=4),Oh(I,!0),I.tail===null&&I.tailMode==="hidden"&&!H.alternate&&!jn)return Hr(f),null}else 2*ge()-I.renderingStartTime>lu&&v!==1073741824&&(f.flags|=128,w=!0,Oh(I,!1),f.lanes=4194304);I.isBackwards?(H.sibling=f.child,f.child=H):(v=I.last,v!==null?v.sibling=H:f.child=H,I.last=H)}return I.tail!==null?(f=I.tail,I.rendering=f,I.tail=f.sibling,I.renderingStartTime=ge(),f.sibling=null,v=zn.current,Mn(zn,w?v&1|2:v&1),f):(Hr(f),null);case 22:case 23:return $v(),w=f.memoizedState!==null,d!==null&&d.memoizedState!==null!==w&&(f.flags|=8192),w&&(f.mode&1)!==0?(Ui&1073741824)!==0&&(Hr(f),f.subtreeFlags&6&&(f.flags|=8192)):Hr(f),null;case 24:return null;case 25:return null}throw Error(t(156,f.tag))}function TO(d,f){switch(ev(f),f.tag){case 1:return yi(f.type)&&Tm(),d=f.flags,d&65536?(f.flags=d&-65537|128,f):null;case 3:return iu(),kn(xi),kn(Vr),fv(),d=f.flags,(d&65536)!==0&&(d&128)===0?(f.flags=d&-65537|128,f):null;case 5:return dv(f),null;case 13:if(kn(zn),d=f.memoizedState,d!==null&&d.dehydrated!==null){if(f.alternate===null)throw Error(t(340));eu()}return d=f.flags,d&65536?(f.flags=d&-65537|128,f):null;case 19:return kn(zn),null;case 4:return iu(),null;case 10:return av(f.type._context),null;case 22:case 23:return $v(),null;case 24:return null;default:return null}}var Hm=!1,$r=!1,NO=typeof WeakSet=="function"?WeakSet:Set,ft=null;function au(d,f){var v=d.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(w){$n(d,f,w)}else v.current=null}function Lv(d,f,v){try{v()}catch(w){$n(d,f,w)}}var qE=!1;function EO(d,f){if($y=um,d=NN(),Fy(d)){if("selectionStart"in d)var v={start:d.selectionStart,end:d.selectionEnd};else e:{v=(v=d.ownerDocument)&&v.defaultView||window;var w=v.getSelection&&v.getSelection();if(w&&w.rangeCount!==0){v=w.anchorNode;var A=w.anchorOffset,I=w.focusNode;w=w.focusOffset;try{v.nodeType,I.nodeType}catch{v=null;break e}var H=0,re=-1,oe=-1,be=0,ze=0,Ge=d,Oe=null;t:for(;;){for(var ot;Ge!==v||A!==0&&Ge.nodeType!==3||(re=H+A),Ge!==I||w!==0&&Ge.nodeType!==3||(oe=H+w),Ge.nodeType===3&&(H+=Ge.nodeValue.length),(ot=Ge.firstChild)!==null;)Oe=Ge,Ge=ot;for(;;){if(Ge===d)break t;if(Oe===v&&++be===A&&(re=H),Oe===I&&++ze===w&&(oe=H),(ot=Ge.nextSibling)!==null)break;Ge=Oe,Oe=Ge.parentNode}Ge=ot}v=re===-1||oe===-1?null:{start:re,end:oe}}else v=null}v=v||{start:0,end:0}}else v=null;for(Wy={focusedElem:d,selectionRange:v},um=!1,ft=f;ft!==null;)if(f=ft,d=f.child,(f.subtreeFlags&1028)!==0&&d!==null)d.return=f,ft=d;else for(;ft!==null;){f=ft;try{var mt=f.alternate;if((f.flags&1024)!==0)switch(f.tag){case 0:case 11:case 15:break;case 1:if(mt!==null){var gt=mt.memoizedProps,Yn=mt.memoizedState,xe=f.stateNode,ue=xe.getSnapshotBeforeUpdate(f.elementType===f.type?gt:Ts(f.type,gt),Yn);xe.__reactInternalSnapshotBeforeUpdate=ue}break;case 3:var ve=f.stateNode.containerInfo;ve.nodeType===1?ve.textContent="":ve.nodeType===9&&ve.documentElement&&ve.removeChild(ve.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch($e){$n(f,f.return,$e)}if(d=f.sibling,d!==null){d.return=f.return,ft=d;break}ft=f.return}return mt=qE,qE=!1,mt}function Uh(d,f,v){var w=f.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var A=w=w.next;do{if((A.tag&d)===d){var I=A.destroy;A.destroy=void 0,I!==void 0&&Lv(f,v,I)}A=A.next}while(A!==w)}}function $m(d,f){if(f=f.updateQueue,f=f!==null?f.lastEffect:null,f!==null){var v=f=f.next;do{if((v.tag&d)===d){var w=v.create;v.destroy=w()}v=v.next}while(v!==f)}}function Dv(d){var f=d.ref;if(f!==null){var v=d.stateNode;switch(d.tag){case 5:d=v;break;default:d=v}typeof f=="function"?f(d):f.current=d}}function XE(d){var f=d.alternate;f!==null&&(d.alternate=null,XE(f)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(f=d.stateNode,f!==null&&(delete f[Ks],delete f[Ch],delete f[Ky],delete f[lO],delete f[cO])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function YE(d){return d.tag===5||d.tag===3||d.tag===4}function KE(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||YE(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Iv(d,f,v){var w=d.tag;if(w===5||w===6)d=d.stateNode,f?v.nodeType===8?v.parentNode.insertBefore(d,f):v.insertBefore(d,f):(v.nodeType===8?(f=v.parentNode,f.insertBefore(d,v)):(f=v,f.appendChild(d)),v=v._reactRootContainer,v!=null||f.onclick!==null||(f.onclick=wm));else if(w!==4&&(d=d.child,d!==null))for(Iv(d,f,v),d=d.sibling;d!==null;)Iv(d,f,v),d=d.sibling}function jv(d,f,v){var w=d.tag;if(w===5||w===6)d=d.stateNode,f?v.insertBefore(d,f):v.appendChild(d);else if(w!==4&&(d=d.child,d!==null))for(jv(d,f,v),d=d.sibling;d!==null;)jv(d,f,v),d=d.sibling}var Lr=null,Ns=!1;function Uo(d,f,v){for(v=v.child;v!==null;)ZE(d,f,v),v=v.sibling}function ZE(d,f,v){if(ht&&typeof ht.onCommitFiberUnmount=="function")try{ht.onCommitFiberUnmount(Ct,v)}catch{}switch(v.tag){case 5:$r||au(v,f);case 6:var w=Lr,A=Ns;Lr=null,Uo(d,f,v),Lr=w,Ns=A,Lr!==null&&(Ns?(d=Lr,v=v.stateNode,d.nodeType===8?d.parentNode.removeChild(v):d.removeChild(v)):Lr.removeChild(v.stateNode));break;case 18:Lr!==null&&(Ns?(d=Lr,v=v.stateNode,d.nodeType===8?Yy(d.parentNode,v):d.nodeType===1&&Yy(d,v),xh(d)):Yy(Lr,v.stateNode));break;case 4:w=Lr,A=Ns,Lr=v.stateNode.containerInfo,Ns=!0,Uo(d,f,v),Lr=w,Ns=A;break;case 0:case 11:case 14:case 15:if(!$r&&(w=v.updateQueue,w!==null&&(w=w.lastEffect,w!==null))){A=w=w.next;do{var I=A,H=I.destroy;I=I.tag,H!==void 0&&((I&2)!==0||(I&4)!==0)&&Lv(v,f,H),A=A.next}while(A!==w)}Uo(d,f,v);break;case 1:if(!$r&&(au(v,f),w=v.stateNode,typeof w.componentWillUnmount=="function"))try{w.props=v.memoizedProps,w.state=v.memoizedState,w.componentWillUnmount()}catch(re){$n(v,f,re)}Uo(d,f,v);break;case 21:Uo(d,f,v);break;case 22:v.mode&1?($r=(w=$r)||v.memoizedState!==null,Uo(d,f,v),$r=w):Uo(d,f,v);break;default:Uo(d,f,v)}}function QE(d){var f=d.updateQueue;if(f!==null){d.updateQueue=null;var v=d.stateNode;v===null&&(v=d.stateNode=new NO),f.forEach(function(w){var A=IO.bind(null,d,w);v.has(w)||(v.add(w),w.then(A,A))})}}function Es(d,f){var v=f.deletions;if(v!==null)for(var w=0;w<v.length;w++){var A=v[w];try{var I=d,H=f,re=H;e:for(;re!==null;){switch(re.tag){case 5:Lr=re.stateNode,Ns=!1;break e;case 3:Lr=re.stateNode.containerInfo,Ns=!0;break e;case 4:Lr=re.stateNode.containerInfo,Ns=!0;break e}re=re.return}if(Lr===null)throw Error(t(160));ZE(I,H,A),Lr=null,Ns=!1;var oe=A.alternate;oe!==null&&(oe.return=null),A.return=null}catch(be){$n(A,f,be)}}if(f.subtreeFlags&12854)for(f=f.child;f!==null;)JE(f,d),f=f.sibling}function JE(d,f){var v=d.alternate,w=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Es(f,d),Js(d),w&4){try{Uh(3,d,d.return),$m(3,d)}catch(gt){$n(d,d.return,gt)}try{Uh(5,d,d.return)}catch(gt){$n(d,d.return,gt)}}break;case 1:Es(f,d),Js(d),w&512&&v!==null&&au(v,v.return);break;case 5:if(Es(f,d),Js(d),w&512&&v!==null&&au(v,v.return),d.flags&32){var A=d.stateNode;try{qe(A,"")}catch(gt){$n(d,d.return,gt)}}if(w&4&&(A=d.stateNode,A!=null)){var I=d.memoizedProps,H=v!==null?v.memoizedProps:I,re=d.type,oe=d.updateQueue;if(d.updateQueue=null,oe!==null)try{re==="input"&&I.type==="radio"&&I.name!=null&&yt(A,I),We(re,H);var be=We(re,I);for(H=0;H<oe.length;H+=2){var ze=oe[H],Ge=oe[H+1];ze==="style"?et(A,Ge):ze==="dangerouslySetInnerHTML"?ut(A,Ge):ze==="children"?qe(A,Ge):T(A,ze,Ge,be)}switch(re){case"input":tt(A,I);break;case"textarea":W(A,I);break;case"select":var Oe=A._wrapperState.wasMultiple;A._wrapperState.wasMultiple=!!I.multiple;var ot=I.value;ot!=null?wt(A,!!I.multiple,ot,!1):Oe!==!!I.multiple&&(I.defaultValue!=null?wt(A,!!I.multiple,I.defaultValue,!0):wt(A,!!I.multiple,I.multiple?[]:"",!1))}A[Ch]=I}catch(gt){$n(d,d.return,gt)}}break;case 6:if(Es(f,d),Js(d),w&4){if(d.stateNode===null)throw Error(t(162));A=d.stateNode,I=d.memoizedProps;try{A.nodeValue=I}catch(gt){$n(d,d.return,gt)}}break;case 3:if(Es(f,d),Js(d),w&4&&v!==null&&v.memoizedState.isDehydrated)try{xh(f.containerInfo)}catch(gt){$n(d,d.return,gt)}break;case 4:Es(f,d),Js(d);break;case 13:Es(f,d),Js(d),A=d.child,A.flags&8192&&(I=A.memoizedState!==null,A.stateNode.isHidden=I,!I||A.alternate!==null&&A.alternate.memoizedState!==null||(Uv=ge())),w&4&&QE(d);break;case 22:if(ze=v!==null&&v.memoizedState!==null,d.mode&1?($r=(be=$r)||ze,Es(f,d),$r=be):Es(f,d),Js(d),w&8192){if(be=d.memoizedState!==null,(d.stateNode.isHidden=be)&&!ze&&(d.mode&1)!==0)for(ft=d,ze=d.child;ze!==null;){for(Ge=ft=ze;ft!==null;){switch(Oe=ft,ot=Oe.child,Oe.tag){case 0:case 11:case 14:case 15:Uh(4,Oe,Oe.return);break;case 1:au(Oe,Oe.return);var mt=Oe.stateNode;if(typeof mt.componentWillUnmount=="function"){w=Oe,v=Oe.return;try{f=w,mt.props=f.memoizedProps,mt.state=f.memoizedState,mt.componentWillUnmount()}catch(gt){$n(w,v,gt)}}break;case 5:au(Oe,Oe.return);break;case 22:if(Oe.memoizedState!==null){nM(Ge);continue}}ot!==null?(ot.return=Oe,ft=ot):nM(Ge)}ze=ze.sibling}e:for(ze=null,Ge=d;;){if(Ge.tag===5){if(ze===null){ze=Ge;try{A=Ge.stateNode,be?(I=A.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(re=Ge.stateNode,oe=Ge.memoizedProps.style,H=oe!=null&&oe.hasOwnProperty("display")?oe.display:null,re.style.display=De("display",H))}catch(gt){$n(d,d.return,gt)}}}else if(Ge.tag===6){if(ze===null)try{Ge.stateNode.nodeValue=be?"":Ge.memoizedProps}catch(gt){$n(d,d.return,gt)}}else if((Ge.tag!==22&&Ge.tag!==23||Ge.memoizedState===null||Ge===d)&&Ge.child!==null){Ge.child.return=Ge,Ge=Ge.child;continue}if(Ge===d)break e;for(;Ge.sibling===null;){if(Ge.return===null||Ge.return===d)break e;ze===Ge&&(ze=null),Ge=Ge.return}ze===Ge&&(ze=null),Ge.sibling.return=Ge.return,Ge=Ge.sibling}}break;case 19:Es(f,d),Js(d),w&4&&QE(d);break;case 21:break;default:Es(f,d),Js(d)}}function Js(d){var f=d.flags;if(f&2){try{e:{for(var v=d.return;v!==null;){if(YE(v)){var w=v;break e}v=v.return}throw Error(t(160))}switch(w.tag){case 5:var A=w.stateNode;w.flags&32&&(qe(A,""),w.flags&=-33);var I=KE(d);jv(d,I,A);break;case 3:case 4:var H=w.stateNode.containerInfo,re=KE(d);Iv(d,re,H);break;default:throw Error(t(161))}}catch(oe){$n(d,d.return,oe)}d.flags&=-3}f&4096&&(d.flags&=-4097)}function MO(d,f,v){ft=d,eM(d)}function eM(d,f,v){for(var w=(d.mode&1)!==0;ft!==null;){var A=ft,I=A.child;if(A.tag===22&&w){var H=A.memoizedState!==null||Hm;if(!H){var re=A.alternate,oe=re!==null&&re.memoizedState!==null||$r;re=Hm;var be=$r;if(Hm=H,($r=oe)&&!be)for(ft=A;ft!==null;)H=ft,oe=H.child,H.tag===22&&H.memoizedState!==null?rM(A):oe!==null?(oe.return=H,ft=oe):rM(A);for(;I!==null;)ft=I,eM(I),I=I.sibling;ft=A,Hm=re,$r=be}tM(d)}else(A.subtreeFlags&8772)!==0&&I!==null?(I.return=A,ft=I):tM(d)}}function tM(d){for(;ft!==null;){var f=ft;if((f.flags&8772)!==0){var v=f.alternate;try{if((f.flags&8772)!==0)switch(f.tag){case 0:case 11:case 15:$r||$m(5,f);break;case 1:var w=f.stateNode;if(f.flags&4&&!$r)if(v===null)w.componentDidMount();else{var A=f.elementType===f.type?v.memoizedProps:Ts(f.type,v.memoizedProps);w.componentDidUpdate(A,v.memoizedState,w.__reactInternalSnapshotBeforeUpdate)}var I=f.updateQueue;I!==null&&nE(f,I,w);break;case 3:var H=f.updateQueue;if(H!==null){if(v=null,f.child!==null)switch(f.child.tag){case 5:v=f.child.stateNode;break;case 1:v=f.child.stateNode}nE(f,H,v)}break;case 5:var re=f.stateNode;if(v===null&&f.flags&4){v=re;var oe=f.memoizedProps;switch(f.type){case"button":case"input":case"select":case"textarea":oe.autoFocus&&v.focus();break;case"img":oe.src&&(v.src=oe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(f.memoizedState===null){var be=f.alternate;if(be!==null){var ze=be.memoizedState;if(ze!==null){var Ge=ze.dehydrated;Ge!==null&&xh(Ge)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}$r||f.flags&512&&Dv(f)}catch(Oe){$n(f,f.return,Oe)}}if(f===d){ft=null;break}if(v=f.sibling,v!==null){v.return=f.return,ft=v;break}ft=f.return}}function nM(d){for(;ft!==null;){var f=ft;if(f===d){ft=null;break}var v=f.sibling;if(v!==null){v.return=f.return,ft=v;break}ft=f.return}}function rM(d){for(;ft!==null;){var f=ft;try{switch(f.tag){case 0:case 11:case 15:var v=f.return;try{$m(4,f)}catch(oe){$n(f,v,oe)}break;case 1:var w=f.stateNode;if(typeof w.componentDidMount=="function"){var A=f.return;try{w.componentDidMount()}catch(oe){$n(f,A,oe)}}var I=f.return;try{Dv(f)}catch(oe){$n(f,I,oe)}break;case 5:var H=f.return;try{Dv(f)}catch(oe){$n(f,H,oe)}}}catch(oe){$n(f,f.return,oe)}if(f===d){ft=null;break}var re=f.sibling;if(re!==null){re.return=f.return,ft=re;break}ft=f.return}}var CO=Math.ceil,Wm=S.ReactCurrentDispatcher,Fv=S.ReactCurrentOwner,os=S.ReactCurrentBatchConfig,an=0,Sr=null,rr=null,Dr=0,Ui=0,ou=Do(0),dr=0,Bh=null,Ol=0,qm=0,Ov=0,zh=null,_i=null,Uv=0,lu=1/0,ja=null,Xm=!1,Bv=null,Bo=null,Ym=!1,zo=null,Km=0,Vh=0,zv=null,Zm=-1,Qm=0;function ii(){return(an&6)!==0?ge():Zm!==-1?Zm:Zm=ge()}function Vo(d){return(d.mode&1)===0?1:(an&2)!==0&&Dr!==0?Dr&-Dr:dO.transition!==null?(Qm===0&&(Qm=Sn()),Qm):(d=sn,d!==0||(d=window.event,d=d===void 0?16:sN(d.type)),d)}function Ms(d,f,v,w){if(50<Vh)throw Vh=0,zv=null,Error(t(185));_r(d,v,w),((an&2)===0||d!==Sr)&&(d===Sr&&((an&2)===0&&(qm|=v),dr===4&&Go(d,Dr)),bi(d,w),v===1&&an===0&&(f.mode&1)===0&&(lu=ge()+500,Em&&jo()))}function bi(d,f){var v=d.callbackNode;ni(d,f);var w=vr(d,d===Sr?Dr:0);if(w===0)v!==null&&Z(v),d.callbackNode=null,d.callbackPriority=0;else if(f=w&-w,d.callbackPriority!==f){if(v!=null&&Z(v),f===1)d.tag===0?uO(sM.bind(null,d)):HN(sM.bind(null,d)),aO(function(){(an&6)===0&&jo()}),v=null;else{switch(Ys(w)){case 1:v=Ve;break;case 4:v=Je;break;case 16:v=ct;break;case 536870912:v=Pt;break;default:v=ct}v=fM(v,iM.bind(null,d))}d.callbackPriority=f,d.callbackNode=v}}function iM(d,f){if(Zm=-1,Qm=0,(an&6)!==0)throw Error(t(327));var v=d.callbackNode;if(cu()&&d.callbackNode!==v)return null;var w=vr(d,d===Sr?Dr:0);if(w===0)return null;if((w&30)!==0||(w&d.expiredLanes)!==0||f)f=Jm(d,w);else{f=w;var A=an;an|=2;var I=oM();(Sr!==d||Dr!==f)&&(ja=null,lu=ge()+500,Bl(d,f));do try{PO();break}catch(re){aM(d,re)}while(!0);sv(),Wm.current=I,an=A,rr!==null?f=0:(Sr=null,Dr=0,f=dr)}if(f!==0){if(f===2&&(A=Ca(d),A!==0&&(w=A,f=Vv(d,A))),f===1)throw v=Bh,Bl(d,0),Go(d,w),bi(d,ge()),v;if(f===6)Go(d,w);else{if(A=d.current.alternate,(w&30)===0&&!AO(A)&&(f=Jm(d,w),f===2&&(I=Ca(d),I!==0&&(w=I,f=Vv(d,I))),f===1))throw v=Bh,Bl(d,0),Go(d,w),bi(d,ge()),v;switch(d.finishedWork=A,d.finishedLanes=w,f){case 0:case 1:throw Error(t(345));case 2:zl(d,_i,ja);break;case 3:if(Go(d,w),(w&130023424)===w&&(f=Uv+500-ge(),10<f)){if(vr(d,0)!==0)break;if(A=d.suspendedLanes,(A&w)!==w){ii(),d.pingedLanes|=d.suspendedLanes&A;break}d.timeoutHandle=Xy(zl.bind(null,d,_i,ja),f);break}zl(d,_i,ja);break;case 4:if(Go(d,w),(w&4194240)===w)break;for(f=d.eventTimes,A=-1;0<w;){var H=31-Wt(w);I=1<<H,H=f[H],H>A&&(A=H),w&=~I}if(w=A,w=ge()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*CO(w/1960))-w,10<w){d.timeoutHandle=Xy(zl.bind(null,d,_i,ja),w);break}zl(d,_i,ja);break;case 5:zl(d,_i,ja);break;default:throw Error(t(329))}}}return bi(d,ge()),d.callbackNode===v?iM.bind(null,d):null}function Vv(d,f){var v=zh;return d.current.memoizedState.isDehydrated&&(Bl(d,f).flags|=256),d=Jm(d,f),d!==2&&(f=_i,_i=v,f!==null&&Gv(f)),d}function Gv(d){_i===null?_i=d:_i.push.apply(_i,d)}function AO(d){for(var f=d;;){if(f.flags&16384){var v=f.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var w=0;w<v.length;w++){var A=v[w],I=A.getSnapshot;A=A.value;try{if(!ws(I(),A))return!1}catch{return!1}}}if(v=f.child,f.subtreeFlags&16384&&v!==null)v.return=f,f=v;else{if(f===d)break;for(;f.sibling===null;){if(f.return===null||f.return===d)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Go(d,f){for(f&=~Ov,f&=~qm,d.suspendedLanes|=f,d.pingedLanes&=~f,d=d.expirationTimes;0<f;){var v=31-Wt(f),w=1<<v;d[v]=-1,f&=~w}}function sM(d){if((an&6)!==0)throw Error(t(327));cu();var f=vr(d,0);if((f&1)===0)return bi(d,ge()),null;var v=Jm(d,f);if(d.tag!==0&&v===2){var w=Ca(d);w!==0&&(f=w,v=Vv(d,w))}if(v===1)throw v=Bh,Bl(d,0),Go(d,f),bi(d,ge()),v;if(v===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=f,zl(d,_i,ja),bi(d,ge()),null}function Hv(d,f){var v=an;an|=1;try{return d(f)}finally{an=v,an===0&&(lu=ge()+500,Em&&jo())}}function Ul(d){zo!==null&&zo.tag===0&&(an&6)===0&&cu();var f=an;an|=1;var v=os.transition,w=sn;try{if(os.transition=null,sn=1,d)return d()}finally{sn=w,os.transition=v,an=f,(an&6)===0&&jo()}}function $v(){Ui=ou.current,kn(ou)}function Bl(d,f){d.finishedWork=null,d.finishedLanes=0;var v=d.timeoutHandle;if(v!==-1&&(d.timeoutHandle=-1,sO(v)),rr!==null)for(v=rr.return;v!==null;){var w=v;switch(ev(w),w.tag){case 1:w=w.type.childContextTypes,w!=null&&Tm();break;case 3:iu(),kn(xi),kn(Vr),fv();break;case 5:dv(w);break;case 4:iu();break;case 13:kn(zn);break;case 19:kn(zn);break;case 10:av(w.type._context);break;case 22:case 23:$v()}v=v.return}if(Sr=d,rr=d=Ho(d.current,null),Dr=Ui=f,dr=0,Bh=null,Ov=qm=Ol=0,_i=zh=null,Il!==null){for(f=0;f<Il.length;f++)if(v=Il[f],w=v.interleaved,w!==null){v.interleaved=null;var A=w.next,I=v.pending;if(I!==null){var H=I.next;I.next=A,w.next=H}v.pending=w}Il=null}return d}function aM(d,f){do{var v=rr;try{if(sv(),jm.current=Bm,Fm){for(var w=Vn.memoizedState;w!==null;){var A=w.queue;A!==null&&(A.pending=null),w=w.next}Fm=!1}if(Fl=0,wr=ur=Vn=null,Dh=!1,Ih=0,Fv.current=null,v===null||v.return===null){dr=1,Bh=f,rr=null;break}e:{var I=d,H=v.return,re=v,oe=f;if(f=Dr,re.flags|=32768,oe!==null&&typeof oe=="object"&&typeof oe.then=="function"){var be=oe,ze=re,Ge=ze.tag;if((ze.mode&1)===0&&(Ge===0||Ge===11||Ge===15)){var Oe=ze.alternate;Oe?(ze.updateQueue=Oe.updateQueue,ze.memoizedState=Oe.memoizedState,ze.lanes=Oe.lanes):(ze.updateQueue=null,ze.memoizedState=null)}var ot=PE(H);if(ot!==null){ot.flags&=-257,kE(ot,H,re,I,f),ot.mode&1&&RE(I,be,f),f=ot,oe=be;var mt=f.updateQueue;if(mt===null){var gt=new Set;gt.add(oe),f.updateQueue=gt}else mt.add(oe);break e}else{if((f&1)===0){RE(I,be,f),Wv();break e}oe=Error(t(426))}}else if(jn&&re.mode&1){var Yn=PE(H);if(Yn!==null){(Yn.flags&65536)===0&&(Yn.flags|=256),kE(Yn,H,re,I,f),rv(su(oe,re));break e}}I=oe=su(oe,re),dr!==4&&(dr=2),zh===null?zh=[I]:zh.push(I),I=H;do{switch(I.tag){case 3:I.flags|=65536,f&=-f,I.lanes|=f;var xe=CE(I,oe,f);tE(I,xe);break e;case 1:re=oe;var ue=I.type,ve=I.stateNode;if((I.flags&128)===0&&(typeof ue.getDerivedStateFromError=="function"||ve!==null&&typeof ve.componentDidCatch=="function"&&(Bo===null||!Bo.has(ve)))){I.flags|=65536,f&=-f,I.lanes|=f;var $e=AE(I,re,f);tE(I,$e);break e}}I=I.return}while(I!==null)}cM(v)}catch(xt){f=xt,rr===v&&v!==null&&(rr=v=v.return);continue}break}while(!0)}function oM(){var d=Wm.current;return Wm.current=Bm,d===null?Bm:d}function Wv(){(dr===0||dr===3||dr===2)&&(dr=4),Sr===null||(Ol&268435455)===0&&(qm&268435455)===0||Go(Sr,Dr)}function Jm(d,f){var v=an;an|=2;var w=oM();(Sr!==d||Dr!==f)&&(ja=null,Bl(d,f));do try{RO();break}catch(A){aM(d,A)}while(!0);if(sv(),an=v,Wm.current=w,rr!==null)throw Error(t(261));return Sr=null,Dr=0,dr}function RO(){for(;rr!==null;)lM(rr)}function PO(){for(;rr!==null&&!he();)lM(rr)}function lM(d){var f=hM(d.alternate,d,Ui);d.memoizedProps=d.pendingProps,f===null?cM(d):rr=f,Fv.current=null}function cM(d){var f=d;do{var v=f.alternate;if(d=f.return,(f.flags&32768)===0){if(v=SO(v,f,Ui),v!==null){rr=v;return}}else{if(v=TO(v,f),v!==null){v.flags&=32767,rr=v;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{dr=6,rr=null;return}}if(f=f.sibling,f!==null){rr=f;return}rr=f=d}while(f!==null);dr===0&&(dr=5)}function zl(d,f,v){var w=sn,A=os.transition;try{os.transition=null,sn=1,kO(d,f,v,w)}finally{os.transition=A,sn=w}return null}function kO(d,f,v,w){do cu();while(zo!==null);if((an&6)!==0)throw Error(t(327));v=d.finishedWork;var A=d.finishedLanes;if(v===null)return null;if(d.finishedWork=null,d.finishedLanes=0,v===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var I=v.lanes|v.childLanes;if(kr(d,I),d===Sr&&(rr=Sr=null,Dr=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||Ym||(Ym=!0,fM(ct,function(){return cu(),null})),I=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||I){I=os.transition,os.transition=null;var H=sn;sn=1;var re=an;an|=4,Fv.current=null,EO(d,v),JE(v,d),QF(Wy),um=!!$y,Wy=$y=null,d.current=v,MO(v),_e(),an=re,sn=H,os.transition=I}else d.current=v;if(Ym&&(Ym=!1,zo=d,Km=A),I=d.pendingLanes,I===0&&(Bo=null),Gt(v.stateNode),bi(d,ge()),f!==null)for(w=d.onRecoverableError,v=0;v<f.length;v++)A=f[v],w(A.value,{componentStack:A.stack,digest:A.digest});if(Xm)throw Xm=!1,d=Bv,Bv=null,d;return(Km&1)!==0&&d.tag!==0&&cu(),I=d.pendingLanes,(I&1)!==0?d===zv?Vh++:(Vh=0,zv=d):Vh=0,jo(),null}function cu(){if(zo!==null){var d=Ys(Km),f=os.transition,v=sn;try{if(os.transition=null,sn=16>d?16:d,zo===null)var w=!1;else{if(d=zo,zo=null,Km=0,(an&6)!==0)throw Error(t(331));var A=an;for(an|=4,ft=d.current;ft!==null;){var I=ft,H=I.child;if((ft.flags&16)!==0){var re=I.deletions;if(re!==null){for(var oe=0;oe<re.length;oe++){var be=re[oe];for(ft=be;ft!==null;){var ze=ft;switch(ze.tag){case 0:case 11:case 15:Uh(8,ze,I)}var Ge=ze.child;if(Ge!==null)Ge.return=ze,ft=Ge;else for(;ft!==null;){ze=ft;var Oe=ze.sibling,ot=ze.return;if(XE(ze),ze===be){ft=null;break}if(Oe!==null){Oe.return=ot,ft=Oe;break}ft=ot}}}var mt=I.alternate;if(mt!==null){var gt=mt.child;if(gt!==null){mt.child=null;do{var Yn=gt.sibling;gt.sibling=null,gt=Yn}while(gt!==null)}}ft=I}}if((I.subtreeFlags&2064)!==0&&H!==null)H.return=I,ft=H;else e:for(;ft!==null;){if(I=ft,(I.flags&2048)!==0)switch(I.tag){case 0:case 11:case 15:Uh(9,I,I.return)}var xe=I.sibling;if(xe!==null){xe.return=I.return,ft=xe;break e}ft=I.return}}var ue=d.current;for(ft=ue;ft!==null;){H=ft;var ve=H.child;if((H.subtreeFlags&2064)!==0&&ve!==null)ve.return=H,ft=ve;else e:for(H=ue;ft!==null;){if(re=ft,(re.flags&2048)!==0)try{switch(re.tag){case 0:case 11:case 15:$m(9,re)}}catch(xt){$n(re,re.return,xt)}if(re===H){ft=null;break e}var $e=re.sibling;if($e!==null){$e.return=re.return,ft=$e;break e}ft=re.return}}if(an=A,jo(),ht&&typeof ht.onPostCommitFiberRoot=="function")try{ht.onPostCommitFiberRoot(Ct,d)}catch{}w=!0}return w}finally{sn=v,os.transition=f}}return!1}function uM(d,f,v){f=su(v,f),f=CE(d,f,1),d=Oo(d,f,1),f=ii(),d!==null&&(_r(d,1,f),bi(d,f))}function $n(d,f,v){if(d.tag===3)uM(d,d,v);else for(;f!==null;){if(f.tag===3){uM(f,d,v);break}else if(f.tag===1){var w=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(Bo===null||!Bo.has(w))){d=su(v,d),d=AE(f,d,1),f=Oo(f,d,1),d=ii(),f!==null&&(_r(f,1,d),bi(f,d));break}}f=f.return}}function LO(d,f,v){var w=d.pingCache;w!==null&&w.delete(f),f=ii(),d.pingedLanes|=d.suspendedLanes&v,Sr===d&&(Dr&v)===v&&(dr===4||dr===3&&(Dr&130023424)===Dr&&500>ge()-Uv?Bl(d,0):Ov|=v),bi(d,f)}function dM(d,f){f===0&&((d.mode&1)===0?f=1:(f=yn,yn<<=1,(yn&130023424)===0&&(yn=4194304)));var v=ii();d=La(d,f),d!==null&&(_r(d,f,v),bi(d,v))}function DO(d){var f=d.memoizedState,v=0;f!==null&&(v=f.retryLane),dM(d,v)}function IO(d,f){var v=0;switch(d.tag){case 13:var w=d.stateNode,A=d.memoizedState;A!==null&&(v=A.retryLane);break;case 19:w=d.stateNode;break;default:throw Error(t(314))}w!==null&&w.delete(f),dM(d,v)}var hM;hM=function(d,f,v){if(d!==null)if(d.memoizedProps!==f.pendingProps||xi.current)vi=!0;else{if((d.lanes&v)===0&&(f.flags&128)===0)return vi=!1,wO(d,f,v);vi=(d.flags&131072)!==0}else vi=!1,jn&&(f.flags&1048576)!==0&&$N(f,Cm,f.index);switch(f.lanes=0,f.tag){case 2:var w=f.type;Gm(d,f),d=f.pendingProps;var A=Zc(f,Vr.current);ru(f,v),A=gv(null,f,w,d,A,v);var I=xv();return f.flags|=1,typeof A=="object"&&A!==null&&typeof A.render=="function"&&A.$$typeof===void 0?(f.tag=1,f.memoizedState=null,f.updateQueue=null,yi(w)?(I=!0,Nm(f)):I=!1,f.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,cv(f),A.updater=zm,f.stateNode=A,A._reactInternals=f,Sv(f,w,d,v),f=Mv(null,f,w,!0,I,v)):(f.tag=0,jn&&I&&Jy(f),ri(null,f,A,v),f=f.child),f;case 16:w=f.elementType;e:{switch(Gm(d,f),d=f.pendingProps,A=w._init,w=A(w._payload),f.type=w,A=f.tag=FO(w),d=Ts(w,d),A){case 0:f=Ev(null,f,w,d,v);break e;case 1:f=OE(null,f,w,d,v);break e;case 11:f=LE(null,f,w,d,v);break e;case 14:f=DE(null,f,w,Ts(w.type,d),v);break e}throw Error(t(306,w,""))}return f;case 0:return w=f.type,A=f.pendingProps,A=f.elementType===w?A:Ts(w,A),Ev(d,f,w,A,v);case 1:return w=f.type,A=f.pendingProps,A=f.elementType===w?A:Ts(w,A),OE(d,f,w,A,v);case 3:e:{if(UE(f),d===null)throw Error(t(387));w=f.pendingProps,I=f.memoizedState,A=I.element,eE(d,f),Dm(f,w,null,v);var H=f.memoizedState;if(w=H.element,I.isDehydrated)if(I={element:w,isDehydrated:!1,cache:H.cache,pendingSuspenseBoundaries:H.pendingSuspenseBoundaries,transitions:H.transitions},f.updateQueue.baseState=I,f.memoizedState=I,f.flags&256){A=su(Error(t(423)),f),f=BE(d,f,w,v,A);break e}else if(w!==A){A=su(Error(t(424)),f),f=BE(d,f,w,v,A);break e}else for(Oi=Lo(f.stateNode.containerInfo.firstChild),Fi=f,jn=!0,Ss=null,v=QN(f,null,w,v),f.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(eu(),w===A){f=Ia(d,f,v);break e}ri(d,f,w,v)}f=f.child}return f;case 5:return rE(f),d===null&&nv(f),w=f.type,A=f.pendingProps,I=d!==null?d.memoizedProps:null,H=A.children,qy(w,A)?H=null:I!==null&&qy(w,I)&&(f.flags|=32),FE(d,f),ri(d,f,H,v),f.child;case 6:return d===null&&nv(f),null;case 13:return zE(d,f,v);case 4:return uv(f,f.stateNode.containerInfo),w=f.pendingProps,d===null?f.child=tu(f,null,w,v):ri(d,f,w,v),f.child;case 11:return w=f.type,A=f.pendingProps,A=f.elementType===w?A:Ts(w,A),LE(d,f,w,A,v);case 7:return ri(d,f,f.pendingProps,v),f.child;case 8:return ri(d,f,f.pendingProps.children,v),f.child;case 12:return ri(d,f,f.pendingProps.children,v),f.child;case 10:e:{if(w=f.type._context,A=f.pendingProps,I=f.memoizedProps,H=A.value,Mn(Pm,w._currentValue),w._currentValue=H,I!==null)if(ws(I.value,H)){if(I.children===A.children&&!xi.current){f=Ia(d,f,v);break e}}else for(I=f.child,I!==null&&(I.return=f);I!==null;){var re=I.dependencies;if(re!==null){H=I.child;for(var oe=re.firstContext;oe!==null;){if(oe.context===w){if(I.tag===1){oe=Da(-1,v&-v),oe.tag=2;var be=I.updateQueue;if(be!==null){be=be.shared;var ze=be.pending;ze===null?oe.next=oe:(oe.next=ze.next,ze.next=oe),be.pending=oe}}I.lanes|=v,oe=I.alternate,oe!==null&&(oe.lanes|=v),ov(I.return,v,f),re.lanes|=v;break}oe=oe.next}}else if(I.tag===10)H=I.type===f.type?null:I.child;else if(I.tag===18){if(H=I.return,H===null)throw Error(t(341));H.lanes|=v,re=H.alternate,re!==null&&(re.lanes|=v),ov(H,v,f),H=I.sibling}else H=I.child;if(H!==null)H.return=I;else for(H=I;H!==null;){if(H===f){H=null;break}if(I=H.sibling,I!==null){I.return=H.return,H=I;break}H=H.return}I=H}ri(d,f,A.children,v),f=f.child}return f;case 9:return A=f.type,w=f.pendingProps.children,ru(f,v),A=ss(A),w=w(A),f.flags|=1,ri(d,f,w,v),f.child;case 14:return w=f.type,A=Ts(w,f.pendingProps),A=Ts(w.type,A),DE(d,f,w,A,v);case 15:return IE(d,f,f.type,f.pendingProps,v);case 17:return w=f.type,A=f.pendingProps,A=f.elementType===w?A:Ts(w,A),Gm(d,f),f.tag=1,yi(w)?(d=!0,Nm(f)):d=!1,ru(f,v),EE(f,w,A),Sv(f,w,A,v),Mv(null,f,w,!0,d,v);case 19:return GE(d,f,v);case 22:return jE(d,f,v)}throw Error(t(156,f.tag))};function fM(d,f){return zc(d,f)}function jO(d,f,v,w){this.tag=d,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ls(d,f,v,w){return new jO(d,f,v,w)}function qv(d){return d=d.prototype,!(!d||!d.isReactComponent)}function FO(d){if(typeof d=="function")return qv(d)?1:0;if(d!=null){if(d=d.$$typeof,d===G)return 11;if(d===K)return 14}return 2}function Ho(d,f){var v=d.alternate;return v===null?(v=ls(d.tag,f,d.key,d.mode),v.elementType=d.elementType,v.type=d.type,v.stateNode=d.stateNode,v.alternate=d,d.alternate=v):(v.pendingProps=f,v.type=d.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=d.flags&14680064,v.childLanes=d.childLanes,v.lanes=d.lanes,v.child=d.child,v.memoizedProps=d.memoizedProps,v.memoizedState=d.memoizedState,v.updateQueue=d.updateQueue,f=d.dependencies,v.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},v.sibling=d.sibling,v.index=d.index,v.ref=d.ref,v}function eg(d,f,v,w,A,I){var H=2;if(w=d,typeof d=="function")qv(d)&&(H=1);else if(typeof d=="string")H=5;else e:switch(d){case R:return Vl(v.children,A,I,f);case F:H=8,A|=8;break;case k:return d=ls(12,v,f,A|2),d.elementType=k,d.lanes=I,d;case $:return d=ls(13,v,f,A),d.elementType=$,d.lanes=I,d;case U:return d=ls(19,v,f,A),d.elementType=U,d.lanes=I,d;case j:return tg(v,A,I,f);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case D:H=10;break e;case P:H=9;break e;case G:H=11;break e;case K:H=14;break e;case O:H=16,w=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return f=ls(H,v,f,A),f.elementType=d,f.type=w,f.lanes=I,f}function Vl(d,f,v,w){return d=ls(7,d,w,f),d.lanes=v,d}function tg(d,f,v,w){return d=ls(22,d,w,f),d.elementType=j,d.lanes=v,d.stateNode={isHidden:!1},d}function Xv(d,f,v){return d=ls(6,d,null,f),d.lanes=v,d}function Yv(d,f,v){return f=ls(4,d.children!==null?d.children:[],d.key,f),f.lanes=v,f.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},f}function OO(d,f,v,w,A){this.tag=f,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zr(0),this.expirationTimes=zr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zr(0),this.identifierPrefix=w,this.onRecoverableError=A,this.mutableSourceEagerHydrationData=null}function Kv(d,f,v,w,A,I,H,re,oe){return d=new OO(d,f,v,re,oe),f===1?(f=1,I===!0&&(f|=8)):f=0,I=ls(3,null,null,f),d.current=I,I.stateNode=d,I.memoizedState={element:w,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},cv(I),d}function UO(d,f,v){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:C,key:w==null?null:""+w,children:d,containerInfo:f,implementation:v}}function pM(d){if(!d)return Io;d=d._reactInternals;e:{if(ns(d)!==d||d.tag!==1)throw Error(t(170));var f=d;do{switch(f.tag){case 3:f=f.stateNode.context;break e;case 1:if(yi(f.type)){f=f.stateNode.__reactInternalMemoizedMergedChildContext;break e}}f=f.return}while(f!==null);throw Error(t(171))}if(d.tag===1){var v=d.type;if(yi(v))return VN(d,v,f)}return f}function mM(d,f,v,w,A,I,H,re,oe){return d=Kv(v,w,!0,d,A,I,H,re,oe),d.context=pM(null),v=d.current,w=ii(),A=Vo(v),I=Da(w,A),I.callback=f??null,Oo(v,I,A),d.current.lanes=A,_r(d,A,w),bi(d,w),d}function ng(d,f,v,w){var A=f.current,I=ii(),H=Vo(A);return v=pM(v),f.context===null?f.context=v:f.pendingContext=v,f=Da(I,H),f.payload={element:d},w=w===void 0?null:w,w!==null&&(f.callback=w),d=Oo(A,f,H),d!==null&&(Ms(d,A,H,I),Lm(d,A,H)),H}function rg(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function gM(d,f){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var v=d.retryLane;d.retryLane=v!==0&&v<f?v:f}}function Zv(d,f){gM(d,f),(d=d.alternate)&&gM(d,f)}function BO(){return null}var xM=typeof reportError=="function"?reportError:function(d){console.error(d)};function Qv(d){this._internalRoot=d}ig.prototype.render=Qv.prototype.render=function(d){var f=this._internalRoot;if(f===null)throw Error(t(409));ng(d,f,null,null)},ig.prototype.unmount=Qv.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var f=d.containerInfo;Ul(function(){ng(null,d,null,null)}),f[Aa]=null}};function ig(d){this._internalRoot=d}ig.prototype.unstable_scheduleHydration=function(d){if(d){var f=eN();d={blockedOn:null,target:d,priority:f};for(var v=0;v<Ro.length&&f!==0&&f<Ro[v].priority;v++);Ro.splice(v,0,d),v===0&&rN(d)}};function Jv(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function sg(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function yM(){}function zO(d,f,v,w,A){if(A){if(typeof w=="function"){var I=w;w=function(){var be=rg(H);I.call(be)}}var H=mM(f,w,d,0,null,!1,!1,"",yM);return d._reactRootContainer=H,d[Aa]=H.current,Eh(d.nodeType===8?d.parentNode:d),Ul(),H}for(;A=d.lastChild;)d.removeChild(A);if(typeof w=="function"){var re=w;w=function(){var be=rg(oe);re.call(be)}}var oe=Kv(d,0,!1,null,null,!1,!1,"",yM);return d._reactRootContainer=oe,d[Aa]=oe.current,Eh(d.nodeType===8?d.parentNode:d),Ul(function(){ng(f,oe,v,w)}),oe}function ag(d,f,v,w,A){var I=v._reactRootContainer;if(I){var H=I;if(typeof A=="function"){var re=A;A=function(){var oe=rg(H);re.call(oe)}}ng(f,H,d,A)}else H=zO(v,f,d,A,w);return rg(H)}QT=function(d){switch(d.tag){case 3:var f=d.stateNode;if(f.current.memoizedState.isDehydrated){var v=Kt(f.pendingLanes);v!==0&&(br(f,v|1),bi(f,ge()),(an&6)===0&&(lu=ge()+500,jo()))}break;case 13:Ul(function(){var w=La(d,1);if(w!==null){var A=ii();Ms(w,d,1,A)}}),Zv(d,1)}},Ty=function(d){if(d.tag===13){var f=La(d,134217728);if(f!==null){var v=ii();Ms(f,d,134217728,v)}Zv(d,134217728)}},JT=function(d){if(d.tag===13){var f=Vo(d),v=La(d,f);if(v!==null){var w=ii();Ms(v,d,f,w)}Zv(d,f)}},eN=function(){return sn},tN=function(d,f){var v=sn;try{return sn=d,f()}finally{sn=v}},Ze=function(d,f,v){switch(f){case"input":if(tt(d,v),f=v.name,v.type==="radio"&&f!=null){for(v=d;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+f)+'][type="radio"]'),f=0;f<v.length;f++){var w=v[f];if(w!==d&&w.form===d.form){var A=Sm(w);if(!A)throw Error(t(90));He(w),tt(w,A)}}}break;case"textarea":W(d,v);break;case"select":f=v.value,f!=null&&wt(d,!!v.multiple,f,!1)}},Dt=Hv,pn=Ul;var VO={usingClientEntryPoint:!1,Events:[Ah,Yc,Sm,Le,dt,Hv]},Gh={findFiberByHostInstance:Pl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},GO={bundleType:Gh.bundleType,version:Gh.version,rendererPackageName:Gh.rendererPackageName,rendererConfig:Gh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:S.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Uc(d),d===null?null:d.stateNode},findFiberByHostInstance:Gh.findFiberByHostInstance||BO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var og=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!og.isDisabled&&og.supportsFiber)try{Ct=og.inject(GO),ht=og}catch{}}return wi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VO,wi.createPortal=function(d,f){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jv(f))throw Error(t(200));return UO(d,f,null,v)},wi.createRoot=function(d,f){if(!Jv(d))throw Error(t(299));var v=!1,w="",A=xM;return f!=null&&(f.unstable_strictMode===!0&&(v=!0),f.identifierPrefix!==void 0&&(w=f.identifierPrefix),f.onRecoverableError!==void 0&&(A=f.onRecoverableError)),f=Kv(d,1,!1,null,null,v,!1,w,A),d[Aa]=f.current,Eh(d.nodeType===8?d.parentNode:d),new Qv(f)},wi.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var f=d._reactInternals;if(f===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=Uc(f),d=d===null?null:d.stateNode,d},wi.flushSync=function(d){return Ul(d)},wi.hydrate=function(d,f,v){if(!sg(f))throw Error(t(200));return ag(null,d,f,!0,v)},wi.hydrateRoot=function(d,f,v){if(!Jv(d))throw Error(t(405));var w=v!=null&&v.hydratedSources||null,A=!1,I="",H=xM;if(v!=null&&(v.unstable_strictMode===!0&&(A=!0),v.identifierPrefix!==void 0&&(I=v.identifierPrefix),v.onRecoverableError!==void 0&&(H=v.onRecoverableError)),f=mM(f,null,d,1,v??null,A,!1,I,H),d[Aa]=f.current,Eh(d),w)for(d=0;d<w.length;d++)v=w[d],A=v._getVersion,A=A(v._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[v,A]:f.mutableSourceEagerHydrationData.push(v,A);return new ig(f)},wi.render=function(d,f,v){if(!sg(f))throw Error(t(200));return ag(null,d,f,!1,v)},wi.unmountComponentAtNode=function(d){if(!sg(d))throw Error(t(40));return d._reactRootContainer?(Ul(function(){ag(null,null,d,!1,function(){d._reactRootContainer=null,d[Aa]=null})}),!0):!1},wi.unstable_batchedUpdates=Hv,wi.unstable_renderSubtreeIntoContainer=function(d,f,v,w){if(!sg(v))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return ag(d,f,v,!1,w)},wi.version="18.3.1-next-f1338f8080-20240426",wi}var EM;function sk(){if(EM)return n_.exports;EM=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),n_.exports=KO(),n_.exports}var MM;function ZO(){if(MM)return lg;MM=1;var n=sk();return lg.createRoot=n.createRoot,lg.hydrateRoot=n.hydrateRoot,lg}var QO=ZO();const JO=Kd(QO);/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var CM="popstate";function eU(n={}){function e(r,i){let{pathname:s,search:a,hash:o}=r.location;return ww("",{pathname:s,search:a,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Zf(i)}return nU(e,t,null,n)}function mr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function ma(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function tU(){return Math.random().toString(36).substring(2,10)}function AM(n,e){return{usr:n.state,key:n.key,idx:e}}function ww(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Bp(e):e,state:t,key:e&&e.key||r||tU()}}function Zf({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Bp(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function nU(n,e,t,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,a=i.history,o="POP",l=null,u=h();u==null&&(u=0,a.replaceState({...a.state,idx:u},""));function h(){return(a.state||{idx:null}).idx}function p(){o="POP";let _=h(),x=_==null?null:_-u;u=_,l&&l({action:o,location:b.location,delta:x})}function m(_,x){o="PUSH";let N=ww(b.location,_,x);u=h()+1;let T=AM(N,u),S=b.createHref(N);try{a.pushState(T,"",S)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;i.location.assign(S)}s&&l&&l({action:o,location:b.location,delta:1})}function g(_,x){o="REPLACE";let N=ww(b.location,_,x);u=h();let T=AM(N,u),S=b.createHref(N);a.replaceState(T,"",S),s&&l&&l({action:o,location:b.location,delta:0})}function y(_){return rU(_)}let b={get action(){return o},get location(){return n(i,a)},listen(_){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(CM,p),l=_,()=>{i.removeEventListener(CM,p),l=null}},createHref(_){return e(i,_)},createURL:y,encodeLocation(_){let x=y(_);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:m,replace:g,go(_){return a.go(_)}};return b}function rU(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),mr(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:Zf(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function ak(n,e,t="/"){return iU(n,e,t,!1)}function iU(n,e,t,r){let i=typeof e=="string"?Bp(e):e,s=fo(i.pathname||"/",t);if(s==null)return null;let a=ok(n);sU(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=gU(s);o=pU(a[l],u,r)}return o}function ok(n,e=[],t=[],r=""){let i=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(mr(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let u=so([r,l.relativePath]),h=t.concat(l);s.children&&s.children.length>0&&(mr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),ok(s.children,e,h,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:hU(u,s.index),routesMeta:h})};return n.forEach((s,a)=>{if(s.path===""||!s.path?.includes("?"))i(s,a);else for(let o of lk(s.path))i(s,a,o)}),e}function lk(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let a=lk(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),i&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function sU(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:fU(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var aU=/^:[\w-]+$/,oU=3,lU=2,cU=1,uU=10,dU=-2,RM=n=>n==="*";function hU(n,e){let t=n.split("/"),r=t.length;return t.some(RM)&&(r+=dU),e&&(r+=lU),t.filter(i=>!RM(i)).reduce((i,s)=>i+(aU.test(s)?oU:s===""?cU:uU),r)}function fU(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function pU(n,e,t=!1){let{routesMeta:r}=n,i={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],u=o===r.length-1,h=s==="/"?e:e.slice(s.length)||"/",p=W0({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},h),m=l.route;if(!p&&u&&t&&!r[r.length-1].route.index&&(p=W0({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},h)),!p)return null;Object.assign(i,p.params),a.push({params:i,pathname:so([s,p.pathname]),pathnameBase:_U(so([s,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(s=so([s,p.pathnameBase]))}return a}function W0(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=mU(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce((u,{paramName:h,isOptional:p},m)=>{if(h==="*"){let y=o[m]||"";a=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const g=o[m];return p&&!g?u[h]=void 0:u[h]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:a,pattern:n}}function mU(n,e=!1,t=!0){ma(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function gU(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ma(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function fo(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function xU(n,e="/"){let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?Bp(n):n;return{pathname:t?t.startsWith("/")?t:yU(t,e):e,search:bU(r),hash:wU(i)}}function yU(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function s_(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function vU(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function ck(n){let e=vU(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function uk(n,e,t,r=!1){let i;typeof n=="string"?i=Bp(n):(i={...n},mr(!i.pathname||!i.pathname.includes("?"),s_("?","pathname","search",i)),mr(!i.pathname||!i.pathname.includes("#"),s_("#","pathname","hash",i)),mr(!i.search||!i.search.includes("#"),s_("#","search","hash",i)));let s=n===""||i.pathname==="",a=s?"/":i.pathname,o;if(a==null)o=t;else{let p=e.length-1;if(!r&&a.startsWith("..")){let m=a.split("/");for(;m[0]==="..";)m.shift(),p-=1;i.pathname=m.join("/")}o=p>=0?e[p]:"/"}let l=xU(i,o),u=a&&a!=="/"&&a.endsWith("/"),h=(s||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||h)&&(l.pathname+="/"),l}var so=n=>n.join("/").replace(/\/\/+/g,"/"),_U=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),bU=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,wU=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function SU(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var dk=["POST","PUT","PATCH","DELETE"];new Set(dk);var TU=["GET",...dk];new Set(TU);var Zd=E.createContext(null);Zd.displayName="DataRouter";var Ax=E.createContext(null);Ax.displayName="DataRouterState";E.createContext(!1);var hk=E.createContext({isTransitioning:!1});hk.displayName="ViewTransition";var NU=E.createContext(new Map);NU.displayName="Fetchers";var EU=E.createContext(null);EU.displayName="Await";var Sa=E.createContext(null);Sa.displayName="Navigation";var Rx=E.createContext(null);Rx.displayName="Location";var vo=E.createContext({outlet:null,matches:[],isDataRoute:!1});vo.displayName="Route";var GS=E.createContext(null);GS.displayName="RouteError";function MU(n,{relative:e}={}){mr(zp(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=E.useContext(Sa),{hash:i,pathname:s,search:a}=Vp(n,{relative:e}),o=s;return t!=="/"&&(o=s==="/"?t:so([t,s])),r.createHref({pathname:o,search:a,hash:i})}function zp(){return E.useContext(Rx)!=null}function Rc(){return mr(zp(),"useLocation() may be used only in the context of a <Router> component."),E.useContext(Rx).location}var fk="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function pk(n){E.useContext(Sa).static||E.useLayoutEffect(n)}function CU(){let{isDataRoute:n}=E.useContext(vo);return n?zU():AU()}function AU(){mr(zp(),"useNavigate() may be used only in the context of a <Router> component.");let n=E.useContext(Zd),{basename:e,navigator:t}=E.useContext(Sa),{matches:r}=E.useContext(vo),{pathname:i}=Rc(),s=JSON.stringify(ck(r)),a=E.useRef(!1);return pk(()=>{a.current=!0}),E.useCallback((l,u={})=>{if(ma(a.current,fk),!a.current)return;if(typeof l=="number"){t.go(l);return}let h=uk(l,JSON.parse(s),i,u.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:so([e,h.pathname])),(u.replace?t.replace:t.push)(h,u.state,u)},[e,t,s,i,n])}E.createContext(null);function Vp(n,{relative:e}={}){let{matches:t}=E.useContext(vo),{pathname:r}=Rc(),i=JSON.stringify(ck(t));return E.useMemo(()=>uk(n,JSON.parse(i),r,e==="path"),[n,i,r,e])}function RU(n,e,t,r){mr(zp(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=E.useContext(Sa),{matches:s}=E.useContext(vo),a=s[s.length-1],o=a?a.params:{},l=a?a.pathname:"/",u=a?a.pathnameBase:"/",h=a&&a.route;{let x=h&&h.path||"";mk(l,!h||x.endsWith("*")||x.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${x}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${x}"> to <Route path="${x==="/"?"*":`${x}/*`}">.`)}let p=Rc(),m;m=p;let g=m.pathname||"/",y=g;if(u!=="/"){let x=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(x.length).join("/")}let b=ak(n,{pathname:y});return ma(h||b!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),ma(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),IU(b&&b.map(x=>Object.assign({},x,{params:Object.assign({},o,x.params),pathname:so([u,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?u:so([u,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),s,t,r)}function PU(){let n=BU(),e=SU(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",n),a=E.createElement(E.Fragment,null,E.createElement("p",null," Hey developer "),E.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",E.createElement("code",{style:s},"ErrorBoundary")," or"," ",E.createElement("code",{style:s},"errorElement")," prop on your route.")),E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},e),t?E.createElement("pre",{style:i},t):null,a)}var kU=E.createElement(PU,null),LU=class extends E.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?E.createElement(vo.Provider,{value:this.props.routeContext},E.createElement(GS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function DU({routeContext:n,match:e,children:t}){let r=E.useContext(Zd);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),E.createElement(vo.Provider,{value:n},t)}function IU(n,e=[],t=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,s=t?.errors;if(s!=null){let l=i.findIndex(u=>u.route.id&&s?.[u.route.id]!==void 0);mr(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,l+1))}let a=!1,o=-1;if(t)for(let l=0;l<i.length;l++){let u=i[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(o=l),u.route.id){let{loaderData:h,errors:p}=t,m=u.route.loader&&!h.hasOwnProperty(u.route.id)&&(!p||p[u.route.id]===void 0);if(u.route.lazy||m){a=!0,o>=0?i=i.slice(0,o+1):i=[i[0]];break}}}return i.reduceRight((l,u,h)=>{let p,m=!1,g=null,y=null;t&&(p=s&&u.route.id?s[u.route.id]:void 0,g=u.route.errorElement||kU,a&&(o<0&&h===0?(mk("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,y=null):o===h&&(m=!0,y=u.route.hydrateFallbackElement||null)));let b=e.concat(i.slice(0,h+1)),_=()=>{let x;return p?x=g:m?x=y:u.route.Component?x=E.createElement(u.route.Component,null):u.route.element?x=u.route.element:x=l,E.createElement(DU,{match:u,routeContext:{outlet:l,matches:b,isDataRoute:t!=null},children:x})};return t&&(u.route.ErrorBoundary||u.route.errorElement||h===0)?E.createElement(LU,{location:t.location,revalidation:t.revalidation,component:g,error:p,children:_(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):_()},null)}function HS(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jU(n){let e=E.useContext(Zd);return mr(e,HS(n)),e}function FU(n){let e=E.useContext(Ax);return mr(e,HS(n)),e}function OU(n){let e=E.useContext(vo);return mr(e,HS(n)),e}function $S(n){let e=OU(n),t=e.matches[e.matches.length-1];return mr(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function UU(){return $S("useRouteId")}function BU(){let n=E.useContext(GS),e=FU("useRouteError"),t=$S("useRouteError");return n!==void 0?n:e.errors?.[t]}function zU(){let{router:n}=jU("useNavigate"),e=$S("useNavigate"),t=E.useRef(!1);return pk(()=>{t.current=!0}),E.useCallback(async(i,s={})=>{ma(t.current,fk),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...s}))},[n,e])}var PM={};function mk(n,e,t){!e&&!PM[n]&&(PM[n]=!0,ma(!1,t))}E.memo(VU);function VU({routes:n,future:e,state:t}){return RU(n,void 0,t,e)}function GU({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:i,static:s=!1}){mr(!zp(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=n.replace(/^\/*/,"/"),o=E.useMemo(()=>({basename:a,navigator:i,static:s,future:{}}),[a,i,s]);typeof t=="string"&&(t=Bp(t));let{pathname:l="/",search:u="",hash:h="",state:p=null,key:m="default"}=t,g=E.useMemo(()=>{let y=fo(l,a);return y==null?null:{location:{pathname:y,search:u,hash:h,state:p,key:m},navigationType:r}},[a,l,u,h,p,m,r]);return ma(g!=null,`<Router basename="${a}"> is not able to match the URL "${l}${u}${h}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:E.createElement(Sa.Provider,{value:o},E.createElement(Rx.Provider,{children:e,value:g}))}var E0="get",M0="application/x-www-form-urlencoded";function Px(n){return n!=null&&typeof n.tagName=="string"}function HU(n){return Px(n)&&n.tagName.toLowerCase()==="button"}function $U(n){return Px(n)&&n.tagName.toLowerCase()==="form"}function WU(n){return Px(n)&&n.tagName.toLowerCase()==="input"}function qU(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function XU(n,e){return n.button===0&&(!e||e==="_self")&&!qU(n)}var cg=null;function YU(){if(cg===null)try{new FormData(document.createElement("form"),0),cg=!1}catch{cg=!0}return cg}var KU=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function a_(n){return n!=null&&!KU.has(n)?(ma(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${M0}"`),null):n}function ZU(n,e){let t,r,i,s,a;if($U(n)){let o=n.getAttribute("action");r=o?fo(o,e):null,t=n.getAttribute("method")||E0,i=a_(n.getAttribute("enctype"))||M0,s=new FormData(n)}else if(HU(n)||WU(n)&&(n.type==="submit"||n.type==="image")){let o=n.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||o.getAttribute("action");if(r=l?fo(l,e):null,t=n.getAttribute("formmethod")||o.getAttribute("method")||E0,i=a_(n.getAttribute("formenctype"))||a_(o.getAttribute("enctype"))||M0,s=new FormData(o,n),!YU()){let{name:u,type:h,value:p}=n;if(h==="image"){let m=u?`${u}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else u&&s.append(u,p)}}else{if(Px(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=E0,r=null,i=M0,a=n}return s&&i==="text/plain"&&(a=s,s=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function WS(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function QU(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&fo(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function JU(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function eB(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function tB(n,e,t){let r=await Promise.all(n.map(async i=>{let s=e.routes[i.route.id];if(s){let a=await JU(s,t);return a.links?a.links():[]}return[]}));return sB(r.flat(1).filter(eB).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function kM(n,e,t,r,i,s){let a=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,o=(l,u)=>t[u].pathname!==l.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==l.params["*"];return s==="assets"?e.filter((l,u)=>a(l,u)||o(l,u)):s==="data"?e.filter((l,u)=>{let h=r.routes[l.route.id];if(!h||!h.hasLoader)return!1;if(a(l,u)||o(l,u))return!0;if(l.route.shouldRevalidate){let p=l.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function nB(n,e,{includeHydrateFallback:t}={}){return rB(n.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function rB(n){return[...new Set(n)]}function iB(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function sB(n,e){let t=new Set;return new Set(e),n.reduce((r,i)=>{let s=JSON.stringify(iB(i));return t.has(s)||(t.add(s),r.push({key:s,link:i})),r},[])}function gk(){let n=E.useContext(Zd);return WS(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function aB(){let n=E.useContext(Ax);return WS(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var qS=E.createContext(void 0);qS.displayName="FrameworkContext";function xk(){let n=E.useContext(qS);return WS(n,"You must render this element inside a <HydratedRouter> element"),n}function oB(n,e){let t=E.useContext(qS),[r,i]=E.useState(!1),[s,a]=E.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:u,onMouseLeave:h,onTouchStart:p}=e,m=E.useRef(null);E.useEffect(()=>{if(n==="render"&&a(!0),n==="viewport"){let b=x=>{x.forEach(N=>{a(N.isIntersecting)})},_=new IntersectionObserver(b,{threshold:.5});return m.current&&_.observe(m.current),()=>{_.disconnect()}}},[n]),E.useEffect(()=>{if(r){let b=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(b)}}},[r]);let g=()=>{i(!0)},y=()=>{i(!1),a(!1)};return t?n!=="intent"?[s,m,{}]:[s,m,{onFocus:$h(o,g),onBlur:$h(l,y),onMouseEnter:$h(u,g),onMouseLeave:$h(h,y),onTouchStart:$h(p,g)}]:[!1,m,{}]}function $h(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function lB({page:n,...e}){let{router:t}=gk(),r=E.useMemo(()=>ak(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?E.createElement(uB,{page:n,matches:r,...e}):null}function cB(n){let{manifest:e,routeModules:t}=xk(),[r,i]=E.useState([]);return E.useEffect(()=>{let s=!1;return tB(n,e,t).then(a=>{s||i(a)}),()=>{s=!0}},[n,e,t]),r}function uB({page:n,matches:e,...t}){let r=Rc(),{manifest:i,routeModules:s}=xk(),{basename:a}=gk(),{loaderData:o,matches:l}=aB(),u=E.useMemo(()=>kM(n,e,l,i,r,"data"),[n,e,l,i,r]),h=E.useMemo(()=>kM(n,e,l,i,r,"assets"),[n,e,l,i,r]),p=E.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let y=new Set,b=!1;if(e.forEach(x=>{let N=i.routes[x.route.id];!N||!N.hasLoader||(!u.some(T=>T.route.id===x.route.id)&&x.route.id in o&&s[x.route.id]?.shouldRevalidate||N.hasClientLoader?b=!0:y.add(x.route.id))}),y.size===0)return[];let _=QU(n,a,"data");return b&&y.size>0&&_.searchParams.set("_routes",e.filter(x=>y.has(x.route.id)).map(x=>x.route.id).join(",")),[_.pathname+_.search]},[a,o,r,i,u,e,n,s]),m=E.useMemo(()=>nB(h,i),[h,i]),g=cB(h);return E.createElement(E.Fragment,null,p.map(y=>E.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),m.map(y=>E.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),g.map(({key:y,link:b})=>E.createElement("link",{key:y,...b})))}function dB(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var yk=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{yk&&(window.__reactRouterVersion="7.7.1")}catch{}function hB({basename:n,children:e,window:t}){let r=E.useRef();r.current==null&&(r.current=eU({window:t,v5Compat:!0}));let i=r.current,[s,a]=E.useState({action:i.action,location:i.location}),o=E.useCallback(l=>{E.startTransition(()=>a(l))},[a]);return E.useLayoutEffect(()=>i.listen(o),[i,o]),E.createElement(GU,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:i})}var vk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_k=E.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:i,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:h,viewTransition:p,...m},g){let{basename:y}=E.useContext(Sa),b=typeof u=="string"&&vk.test(u),_,x=!1;if(typeof u=="string"&&b&&(_=u,yk))try{let k=new URL(window.location.href),D=u.startsWith("//")?new URL(k.protocol+u):new URL(u),P=fo(D.pathname,y);D.origin===k.origin&&P!=null?u=P+D.search+D.hash:x=!0}catch{ma(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let N=MU(u,{relative:i}),[T,S,M]=oB(r,m),C=gB(u,{replace:a,state:o,target:l,preventScrollReset:h,relative:i,viewTransition:p});function R(k){e&&e(k),k.defaultPrevented||C(k)}let F=E.createElement("a",{...m,...M,href:_||N,onClick:x||s?e:R,ref:dB(g,S),target:l,"data-discover":!b&&t==="render"?"true":void 0});return T&&!b?E.createElement(E.Fragment,null,F,E.createElement(lB,{page:N})):F});_k.displayName="Link";var fB=E.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:i=!1,style:s,to:a,viewTransition:o,children:l,...u},h){let p=Vp(a,{relative:u.relative}),m=Rc(),g=E.useContext(Ax),{navigator:y,basename:b}=E.useContext(Sa),_=g!=null&&bB(p)&&o===!0,x=y.encodeLocation?y.encodeLocation(p).pathname:p.pathname,N=m.pathname,T=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;t||(N=N.toLowerCase(),T=T?T.toLowerCase():null,x=x.toLowerCase()),T&&b&&(T=fo(T,b)||T);const S=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let M=N===x||!i&&N.startsWith(x)&&N.charAt(S)==="/",C=T!=null&&(T===x||!i&&T.startsWith(x)&&T.charAt(x.length)==="/"),R={isActive:M,isPending:C,isTransitioning:_},F=M?e:void 0,k;typeof r=="function"?k=r(R):k=[r,M?"active":null,C?"pending":null,_?"transitioning":null].filter(Boolean).join(" ");let D=typeof s=="function"?s(R):s;return E.createElement(_k,{...u,"aria-current":F,className:k,ref:h,style:D,to:a,viewTransition:o},typeof l=="function"?l(R):l)});fB.displayName="NavLink";var pB=E.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:i,state:s,method:a=E0,action:o,onSubmit:l,relative:u,preventScrollReset:h,viewTransition:p,...m},g)=>{let y=vB(),b=_B(o,{relative:u}),_=a.toLowerCase()==="get"?"get":"post",x=typeof o=="string"&&vk.test(o),N=T=>{if(l&&l(T),T.defaultPrevented)return;T.preventDefault();let S=T.nativeEvent.submitter,M=S?.getAttribute("formmethod")||a;y(S||T.currentTarget,{fetcherKey:e,method:M,navigate:t,replace:i,state:s,relative:u,preventScrollReset:h,viewTransition:p})};return E.createElement("form",{ref:g,method:_,action:b,onSubmit:r?l:N,...m,"data-discover":!x&&n==="render"?"true":void 0})});pB.displayName="Form";function mB(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bk(n){let e=E.useContext(Zd);return mr(e,mB(n)),e}function gB(n,{target:e,replace:t,state:r,preventScrollReset:i,relative:s,viewTransition:a}={}){let o=CU(),l=Rc(),u=Vp(n,{relative:s});return E.useCallback(h=>{if(XU(h,e)){h.preventDefault();let p=t!==void 0?t:Zf(l)===Zf(u);o(n,{replace:p,state:r,preventScrollReset:i,relative:s,viewTransition:a})}},[l,o,u,t,r,e,n,i,s,a])}var xB=0,yB=()=>`__${String(++xB)}__`;function vB(){let{router:n}=bk("useSubmit"),{basename:e}=E.useContext(Sa),t=UU();return E.useCallback(async(r,i={})=>{let{action:s,method:a,encType:o,formData:l,body:u}=ZU(r,e);if(i.navigate===!1){let h=i.fetcherKey||yB();await n.fetch(h,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||a,formEncType:i.encType||o,flushSync:i.flushSync})}else await n.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||a,formEncType:i.encType||o,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function _B(n,{relative:e}={}){let{basename:t}=E.useContext(Sa),r=E.useContext(vo);mr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...Vp(n||".",{relative:e})},a=Rc();if(n==null){s.search=a.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(h=>h==="")){o.delete("index"),l.filter(p=>p).forEach(p=>o.append("index",p));let h=o.toString();s.search=h?`?${h}`:""}}return(!n||n===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:so([t,s.pathname])),Zf(s)}function bB(n,{relative:e}={}){let t=E.useContext(hk);mr(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=bk("useViewTransitionState"),i=Vp(n,{relative:e});if(!t.isTransitioning)return!1;let s=fo(t.currentLocation.pathname,r)||t.currentLocation.pathname,a=fo(t.nextLocation.pathname,r)||t.nextLocation.pathname;return W0(i.pathname,a)!=null||W0(i.pathname,s)!=null}sk();const da="http://localhost:8001",wk="http://localhost:8001",Sk={transports:["websocket","polling"],withCredentials:!0,timeout:2e4,forceNew:!1,reconnection:!0,reconnectionDelay:1500,reconnectionDelayMax:8e3,randomizationFactor:.4,reconnectionAttempts:6},wB=[{text:"Hello Cartrita!",icon:"",label:"Say hello"},{text:"What time is it?",icon:"",label:"Ask for the time"},{text:"Create an image of a sunset",icon:"",label:"Generate an image"},{text:"What can you help me with?",icon:"",label:"Ask what she can do"}],SB=({onLoginSuccess:n,onSwitchToRegister:e})=>{const[t,r]=E.useState(""),[i,s]=E.useState(""),[a,o]=E.useState(""),[l,u]=E.useState(!1),h=async p=>{p.preventDefault(),o(""),u(!0);try{const m=await fetch(`${da}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:i})});let g;try{g=await m.json()}catch{throw new Error("Invalid response from server")}if(m.status===401)throw new Error("Invalid email or password.");if(!m.ok)throw new Error(g?.message||"Login failed.");if(!g?.token)throw new Error("No authentication token received.");n(g.token)}catch(m){o(m.message)}finally{u(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4",children:c.jsxs("div",{className:"w-full max-w-md p-8 space-y-6 bg-gray-800 bg-opacity-80 border-2 border-cyan-500 rounded-2xl shadow-lg shadow-cyan-500/20",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-4xl font-extrabold text-white",children:"Welcome Back"}),c.jsx("p",{className:"mt-2 text-gray-400",children:"Log in to access your dashboard"})]}),c.jsxs("form",{onSubmit:h,className:"space-y-6",children:[c.jsx("input",{id:"login-email",name:"email",type:"email",placeholder:"Email",value:t,onChange:p=>r(p.target.value),className:"w-full bg-gray-900 text-white p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"username",required:!0}),c.jsx("input",{id:"login-password",name:"password",type:"password",placeholder:"Password",value:i,onChange:p=>s(p.target.value),className:"w-full bg-gray-900 text-white p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"current-password",required:!0}),a&&c.jsx("p",{className:"text-red-400 text-center font-semibold",children:a}),c.jsx("button",{type:"submit",className:"w-full btn-skittles text-white p-3 rounded-lg font-bold text-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50",disabled:l,children:l?"Logging In...":"Login"})]}),c.jsxs("p",{className:"text-center text-gray-400",children:["Don't have an account?"," ",c.jsx("button",{onClick:e,className:"font-bold text-cyan-400 hover:underline",children:"Register here"})]})]})})},TB=({onSwitchToLogin:n,onRegisterSuccess:e})=>{const[t,r]=E.useState(""),[i,s]=E.useState(""),[a,o]=E.useState(""),[l,u]=E.useState(""),[h,p]=E.useState(""),[m,g]=E.useState(!1),y=async b=>{if(b.preventDefault(),p(""),a!==l){p("Passwords do not match");return}if(a.length<6){p("Password must be at least 6 characters long");return}g(!0);try{const _=await fetch(`${da}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:i,password:a})}),x=await _.json();if(_.status===409)throw new Error("An account with that email already exists.");if(!_.ok)throw new Error(x.message||"Registration failed.");e()}catch(_){p(_.message)}finally{g(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4",children:c.jsxs("div",{className:"w-full max-w-md p-8 space-y-6 bg-gray-800 bg-opacity-80 border-2 border-cyan-500 rounded-2xl shadow-lg shadow-cyan-500/20",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("h2",{className:"text-4xl font-extrabold text-white",children:"Join the Resistance"}),c.jsx("p",{className:"mt-2 text-gray-400",children:"Create your account to get started"})]}),c.jsxs("form",{onSubmit:y,className:"space-y-6",children:[c.jsx("input",{id:"register-name",name:"name",type:"text",placeholder:"Full Name",value:t,onChange:b=>r(b.target.value),className:"w-full bg-gray-900 text-white p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"name",required:!0}),c.jsx("input",{id:"register-email",name:"email",type:"email",placeholder:"Email",value:i,onChange:b=>s(b.target.value),className:"w-full bg-gray-900 text-white p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"email",required:!0}),c.jsx("input",{id:"register-password",name:"password",type:"password",placeholder:"Password",value:a,onChange:b=>o(b.target.value),className:"w-full bg-gray-900 text-white p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"new-password",required:!0,minLength:8}),c.jsx("input",{id:"register-confirm-password",name:"confirmPassword",type:"password",placeholder:"Confirm Password",value:l,onChange:b=>u(b.target.value),className:"w-full bg-gray-900 text-white p-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"new-password",required:!0,minLength:8}),h&&c.jsx("p",{className:"text-red-400 text-center font-semibold",children:h}),c.jsx("button",{type:"submit",className:"w-full btn-skittles text-white p-3 rounded-lg font-bold text-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50",disabled:m,children:m?"Creating Account...":"Register"})]}),c.jsxs("p",{className:"text-center text-gray-400",children:["Already have an account?"," ",c.jsx("button",{onClick:n,className:"font-bold text-cyan-400 hover:underline",children:"Login here"})]})]})})},NB=(n,e,t,r)=>{const i=[t,{code:e,...r||{}}];if(n?.services?.logger?.forward)return n.services.logger.forward(i,"warn","react-i18next::",!0);pc(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),n?.services?.logger?.warn?n.services.logger.warn(...i):console?.warn&&console.warn(...i)},LM={},Sw=(n,e,t,r)=>{pc(t)&&LM[t]||(pc(t)&&(LM[t]=new Date),NB(n,e,t,r))},Tk=(n,e)=>()=>{if(n.isInitialized)e();else{const t=()=>{setTimeout(()=>{n.off("initialized",t)},0),e()};n.on("initialized",t)}},Tw=(n,e,t)=>{n.loadNamespaces(e,Tk(n,t))},DM=(n,e,t,r)=>{if(pc(t)&&(t=[t]),n.options.preload&&n.options.preload.indexOf(e)>-1)return Tw(n,t,r);t.forEach(i=>{n.options.ns.indexOf(i)<0&&n.options.ns.push(i)}),n.loadLanguages(e,Tk(n,r))},EB=(n,e,t={})=>!e.languages||!e.languages.length?(Sw(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(n,{lng:t.lng,precheck:(r,i)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,n))return!1}}),pc=n=>typeof n=="string",MB=n=>typeof n=="object"&&n!==null,CB=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,AB={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},RB=n=>AB[n],PB=n=>n.replace(CB,RB);let Nw={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:PB};const kB=(n={})=>{Nw={...Nw,...n}},LB=()=>Nw;let Nk;const DB=n=>{Nk=n},IB=()=>Nk,jB={type:"3rdParty",init(n){kB(n.options.react),DB(n)}},FB=E.createContext();class OB{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const UB=(n,e)=>{const t=E.useRef();return E.useEffect(()=>{t.current=n},[n,e]),t.current},Ek=(n,e,t,r)=>n.getFixedT(e,t,r),BB=(n,e,t,r)=>E.useCallback(Ek(n,e,t,r),[n,e,t,r]),zB=(n,e={})=>{const{i18n:t}=e,{i18n:r,defaultNS:i}=E.useContext(FB)||{},s=t||r||IB();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new OB),!s){Sw(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const S=(C,R)=>pc(R)?R:MB(R)&&pc(R.defaultValue)?R.defaultValue:Array.isArray(C)?C[C.length-1]:C,M=[S,{},!1];return M.t=S,M.i18n={},M.ready=!1,M}s.options.react?.wait&&Sw(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const a={...LB(),...s.options.react,...e},{useSuspense:o,keyPrefix:l}=a;let u=i||s.options?.defaultNS;u=pc(u)?[u]:u||["translation"],s.reportNamespaces.addUsedNamespaces?.(u);const h=(s.isInitialized||s.initializedStoreOnce)&&u.every(S=>EB(S,s,a)),p=BB(s,e.lng||null,a.nsMode==="fallback"?u:u[0],l),m=()=>p,g=()=>Ek(s,e.lng||null,a.nsMode==="fallback"?u:u[0],l),[y,b]=E.useState(m);let _=u.join();e.lng&&(_=`${e.lng}${_}`);const x=UB(_),N=E.useRef(!0);E.useEffect(()=>{const{bindI18n:S,bindI18nStore:M}=a;N.current=!0,!h&&!o&&(e.lng?DM(s,e.lng,u,()=>{N.current&&b(g)}):Tw(s,u,()=>{N.current&&b(g)})),h&&x&&x!==_&&N.current&&b(g);const C=()=>{N.current&&b(g)};return S&&s?.on(S,C),M&&s?.store.on(M,C),()=>{N.current=!1,s&&S&&S?.split(" ").forEach(R=>s.off(R,C)),M&&s&&M.split(" ").forEach(R=>s.store.off(R,C))}},[s,_]),E.useEffect(()=>{N.current&&h&&b(m)},[s,l,h]);const T=[y,s,h];if(T.t=y,T.i18n=s,T.ready=h,h||!h&&!o)return T;throw new Promise(S=>{e.lng?DM(s,e.lng,u,()=>S()):Tw(s,u,()=>S())})},ga=Object.create(null);ga.open="0";ga.close="1";ga.ping="2";ga.pong="3";ga.message="4";ga.upgrade="5";ga.noop="6";const C0=Object.create(null);Object.keys(ga).forEach(n=>{C0[ga[n]]=n});const Ew={type:"error",data:"parser error"},Mk=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ck=typeof ArrayBuffer=="function",Ak=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,XS=({type:n,data:e},t,r)=>Mk&&e instanceof Blob?t?r(e):IM(e,r):Ck&&(e instanceof ArrayBuffer||Ak(e))?t?r(e):IM(new Blob([e]),r):r(ga[n]+(e||"")),IM=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function jM(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let o_;function VB(n,e){if(Mk&&n.data instanceof Blob)return n.data.arrayBuffer().then(jM).then(e);if(Ck&&(n.data instanceof ArrayBuffer||Ak(n.data)))return e(jM(n.data));XS(n,!1,t=>{o_||(o_=new TextEncoder),e(o_.encode(t))})}const FM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Mf=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<FM.length;n++)Mf[FM.charCodeAt(n)]=n;const GB=n=>{let e=n.length*.75,t=n.length,r,i=0,s,a,o,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const u=new ArrayBuffer(e),h=new Uint8Array(u);for(r=0;r<t;r+=4)s=Mf[n.charCodeAt(r)],a=Mf[n.charCodeAt(r+1)],o=Mf[n.charCodeAt(r+2)],l=Mf[n.charCodeAt(r+3)],h[i++]=s<<2|a>>4,h[i++]=(a&15)<<4|o>>2,h[i++]=(o&3)<<6|l&63;return u},HB=typeof ArrayBuffer=="function",YS=(n,e)=>{if(typeof n!="string")return{type:"message",data:Rk(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:$B(n.substring(1),e)}:C0[t]?n.length>1?{type:C0[t],data:n.substring(1)}:{type:C0[t]}:Ew},$B=(n,e)=>{if(HB){const t=GB(n);return Rk(t,e)}else return{base64:!0,data:n}},Rk=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},Pk="",WB=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((s,a)=>{XS(s,!1,o=>{r[a]=o,++i===t&&e(r.join(Pk))})})},qB=(n,e)=>{const t=n.split(Pk),r=[];for(let i=0;i<t.length;i++){const s=YS(t[i],e);if(r.push(s),s.type==="error")break}return r};function XB(){return new TransformStream({transform(n,e){VB(n,t=>{const r=t.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let l_;function ug(n){return n.reduce((e,t)=>e+t.length,0)}function dg(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)t[i]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function YB(n,e){l_||(l_=new TextDecoder);const t=[];let r=0,i=-1,s=!1;return new TransformStream({transform(a,o){for(t.push(a);;){if(r===0){if(ug(t)<1)break;const l=dg(t,1);s=(l[0]&128)===128,i=l[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(ug(t)<2)break;const l=dg(t,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(ug(t)<8)break;const l=dg(t,8),u=new DataView(l.buffer,l.byteOffset,l.length),h=u.getUint32(0);if(h>Math.pow(2,21)-1){o.enqueue(Ew);break}i=h*Math.pow(2,32)+u.getUint32(4),r=3}else{if(ug(t)<i)break;const l=dg(t,i);o.enqueue(YS(s?l:l_.decode(l),e)),r=0}if(i===0||i>n){o.enqueue(Ew);break}}}})}const kk=4;function or(n){if(n)return KB(n)}function KB(n){for(var e in or.prototype)n[e]=or.prototype[e];return n}or.prototype.on=or.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};or.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};or.prototype.off=or.prototype.removeListener=or.prototype.removeAllListeners=or.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};or.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};or.prototype.emitReserved=or.prototype.emit;or.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};or.prototype.hasListeners=function(n){return!!this.listeners(n).length};const kx=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),hs=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),ZB="arraybuffer";function Lk(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const QB=hs.setTimeout,JB=hs.clearTimeout;function Lx(n,e){e.useNativeTimers?(n.setTimeoutFn=QB.bind(hs),n.clearTimeoutFn=JB.bind(hs)):(n.setTimeoutFn=hs.setTimeout.bind(hs),n.clearTimeoutFn=hs.clearTimeout.bind(hs))}const e4=1.33;function t4(n){return typeof n=="string"?n4(n):Math.ceil((n.byteLength||n.size)*e4)}function n4(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function Dk(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function r4(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function i4(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class s4 extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class KS extends or{constructor(e){super(),this.writable=!1,Lx(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new s4(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=YS(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=r4(e);return t.length?"?"+t:""}}class a4 extends KS{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};qB(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,WB(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Dk()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let Ik=!1;try{Ik=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const o4=Ik;function l4(){}class c4 extends a4{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class ha extends or{constructor(e,t,r){super(),this.createRequest=e,Lx(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=Lk(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=ha.requestsCount++,ha.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=l4,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ha.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ha.requestsCount=0;ha.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",OM);else if(typeof addEventListener=="function"){const n="onpagehide"in hs?"pagehide":"unload";addEventListener(n,OM,!1)}}function OM(){for(let n in ha.requests)ha.requests.hasOwnProperty(n)&&ha.requests[n].abort()}const u4=function(){const n=jk({xdomain:!1});return n&&n.responseType!==null}();class d4 extends c4{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=u4&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ha(jk,this.uri(),e)}}function jk(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||o4))return new XMLHttpRequest}catch{}if(!e)try{return new hs[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Fk=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class h4 extends KS{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=Fk?{}:Lk(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;XS(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}i&&kx(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Dk()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const c_=hs.WebSocket||hs.MozWebSocket;class f4 extends h4{createSocket(e,t,r){return Fk?new c_(e,t,r):t?new c_(e,t):new c_(e)}doWrite(e,t){this.ws.send(t)}}class p4 extends KS{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=YB(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),i=XB();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const s=()=>{r.read().then(({done:o,value:l})=>{o||(this.onPacket(l),s())}).catch(o=>{})};s();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;this._writer.write(r).then(()=>{i&&kx(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const m4={websocket:f4,webtransport:p4,polling:d4},g4=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,x4=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Mw(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=g4.exec(n||""),s={},a=14;for(;a--;)s[x4[a]]=i[a]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=y4(s,s.path),s.queryKey=v4(s,s.query),s}function y4(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function v4(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}const Cw=typeof addEventListener=="function"&&typeof removeEventListener=="function",A0=[];Cw&&addEventListener("offline",()=>{A0.forEach(n=>n())},!1);class cl extends or{constructor(e,t){if(super(),this.binaryType=ZB,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=Mw(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=Mw(t.host).host);Lx(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const i=r.prototype.name;this.transports.push(i),this._transportsByName[i]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=i4(this.opts.query)),Cw&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},A0.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=kk,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&cl.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",cl.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(t+=t4(i)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,kx(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(cl.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Cw&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=A0.indexOf(this._offlineEventListener);r!==-1&&A0.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}cl.protocol=kk;class _4 extends cl{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;cl.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",p=>{if(!r)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;cl.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=t.name,this.emitReserved("upgradeError",m)}}))};function s(){r||(r=!0,h(),t.close(),t=null)}const a=p=>{const m=new Error("probe error: "+p);m.transport=t.name,s(),this.emitReserved("upgradeError",m)};function o(){a("transport closed")}function l(){a("socket closed")}function u(p){t&&p.name!==t.name&&s()}const h=()=>{t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",o),this.off("close",l),this.off("upgrading",u)};t.once("open",i),t.once("error",a),t.once("close",o),this.once("close",l),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let b4=class extends _4{constructor(e,t={}){const r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(i=>m4[i]).filter(i=>!!i)),super(e,r)}};function w4(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=Mw(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}const S4=typeof ArrayBuffer=="function",T4=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Ok=Object.prototype.toString,N4=typeof Blob=="function"||typeof Blob<"u"&&Ok.call(Blob)==="[object BlobConstructor]",E4=typeof File=="function"||typeof File<"u"&&Ok.call(File)==="[object FileConstructor]";function ZS(n){return S4&&(n instanceof ArrayBuffer||T4(n))||N4&&n instanceof Blob||E4&&n instanceof File}function R0(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(R0(n[t]))return!0;return!1}if(ZS(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return R0(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&R0(n[t]))return!0;return!1}function M4(n){const e=[],t=n.data,r=n;return r.data=Aw(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Aw(n,e){if(!n)return n;if(ZS(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=Aw(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=Aw(n[r],e));return t}return n}function C4(n,e){return n.data=Rw(n.data,e),delete n.attachments,n}function Rw(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Rw(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Rw(n[t],e));return n}const A4=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],R4=5;var rn;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(rn||(rn={}));class P4{constructor(e){this.replacer=e}encode(e){return(e.type===rn.EVENT||e.type===rn.ACK)&&R0(e)?this.encodeAsBinary({type:e.type===rn.EVENT?rn.BINARY_EVENT:rn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===rn.BINARY_EVENT||e.type===rn.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=M4(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function UM(n){return Object.prototype.toString.call(n)==="[object Object]"}class QS extends or{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===rn.BINARY_EVENT;r||t.type===rn.BINARY_ACK?(t.type=r?rn.EVENT:rn.ACK,this.reconstructor=new k4(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(ZS(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(rn[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===rn.BINARY_EVENT||r.type===rn.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const a=e.substring(s,t);if(a!=Number(a)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(a)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const a=e.charAt(t);if(a==null||Number(a)!=a){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(QS.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case rn.CONNECT:return UM(t);case rn.DISCONNECT:return t===void 0;case rn.CONNECT_ERROR:return typeof t=="string"||UM(t);case rn.EVENT:case rn.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&A4.indexOf(t[0])===-1);case rn.ACK:case rn.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class k4{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=C4(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const L4=Object.freeze(Object.defineProperty({__proto__:null,Decoder:QS,Encoder:P4,get PacketType(){return rn},protocol:R4},Symbol.toStringTag,{value:"Module"}));function Ds(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const D4=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Uk extends or{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ds(e,"open",this.onopen.bind(this)),Ds(e,"packet",this.onpacket.bind(this)),Ds(e,"error",this.onerror.bind(this)),Ds(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,i,s;if(D4.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const a={type:rn.EVENT,data:t};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const h=this.ids++,p=t.pop();this._registerAckCallback(h,p),a.id=h}const o=(i=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||i===void 0?void 0:i.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!o||(l?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i),a=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,o)};a.withError=!0,this.acks[e]=a}emitWithAck(e,...t){return new Promise((r,i)=>{const s=(a,o)=>a?i(a):r(o);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:rn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case rn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case rn.EVENT:case rn.BINARY_EVENT:this.onevent(e);break;case rn.ACK:case rn.BINARY_ACK:this.onack(e);break;case rn.DISCONNECT:this.ondisconnect();break;case rn.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:rn.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:rn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Qd(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Qd.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};Qd.prototype.reset=function(){this.attempts=0};Qd.prototype.setMin=function(n){this.ms=n};Qd.prototype.setMax=function(n){this.max=n};Qd.prototype.setJitter=function(n){this.jitter=n};class Pw extends or{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Lx(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Qd({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||L4;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new b4(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Ds(t,"open",function(){r.onopen(),e&&e()}),s=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),e?e(o):this.maybeReconnectOnOpen()},a=Ds(t,"error",s);if(this._timeout!==!1){const o=this._timeout,l=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},o);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ds(e,"ping",this.onping.bind(this)),Ds(e,"data",this.ondata.bind(this)),Ds(e,"error",this.onerror.bind(this)),Ds(e,"close",this.onclose.bind(this)),Ds(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){kx(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Uk(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Wh={};function Of(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=w4(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,a=Wh[i]&&s in Wh[i].nsps,o=e.forceNew||e["force new connection"]||e.multiplex===!1||a;let l;return o?l=new Pw(r,e):(Wh[i]||(Wh[i]=new Pw(r,e)),l=Wh[i]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(Of,{Manager:Pw,Socket:Uk,io:Of,connect:Of});const I4=(n,e)=>{const[t,r]=E.useState(!1),[i,s]=E.useState(null),[a,o]=E.useState({connected:!1,reconnectAttempts:0,latency:0,lastPing:null}),[l,u]=E.useState(!1),h=E.useRef(null),p=E.useRef(null),m=E.useRef(e),g=E.useCallback(()=>{p.current&&clearInterval(p.current),p.current=setInterval(()=>{if(h.current?.connected){const x=Date.now();h.current.emit("ping",x)}},5e3)},[]),y=E.useCallback(x=>{const N={id:Date.now()+Math.random(),speaker:x.speaker||"cartrita",text:x.text,created_at:x.timestamp||new Date().toISOString(),model:x.model,tools_used:x.tools_used||[],response_time_ms:x.response_time_ms,intent_analysis:x.intent_analysis,performance_score:x.performance_score,request_id:x.request_id};m.current.onMessage(N),u(!1)},[]);E.useEffect(()=>{m.current=e},[e]),E.useEffect(()=>{if(!n)return;if(n.split(".").length!==3){console.warn(" Skipping socket connect: malformed token");return}const x=Of(wk,{...Sk,auth:{token:n}});return h.current=x,x.on("connect",()=>{console.log(" Connected to Cartrita server"),console.log(" Socket ID:",x.id),r(!0),s(null),o(N=>({...N,connected:!0,reconnectAttempts:0})),m.current.onConnect(),g()}),x.on("disconnect",N=>{console.log(" Disconnected:",N),r(!1),o(T=>({...T,connected:!1,latency:0})),m.current.onDisconnect(),(N==="transport close"||N==="transport error")&&s("Connection lost, retrying...")}),x.on("connect_error",N=>{console.error(" Connect error:",N),s("Connection failed, please try again later.")}),x.on("pong",N=>{const T=Date.now()-N;o(S=>({...S,latency:T}))}),x.on("agent_response",y),x.on("typing",()=>u(!0)),x.on("stopTyping",()=>u(!1)),x.on("error",N=>{console.error(" Socket error:",N),console.error(" Socket error details:",JSON.stringify(N,null,2));const T=N.message||N.type||N.description||"Unknown socket error";s(`Socket error: ${T}`),u(!1)}),()=>{x.disconnect(),p.current&&clearInterval(p.current)}},[n,y,g]);const b=E.useCallback((x,N="en")=>{h.current?.connected&&h.current.emit("user_message",{text:x,timestamp:new Date().toISOString(),language:N})},[]),_=E.useCallback(()=>{s(null)},[]);return{socket:h.current,isConnected:t,connectionError:i,connectionStats:a,isTyping:l,sendMessage:b,clearConnectionError:_}},j4=(n,e)=>{const t=!n||n.split(".").length!==3,r=E.useCallback(async()=>{if(!n){console.warn(" No token available for chat history request");return}if(t){console.warn(" Skipping chat history; token malformed");return}try{console.log(" Loading chat history...");const s=await fetch(`${da}/api/chat/history`,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(console.log(" Chat history response status:",s.status),!s.ok){const l=await s.text();console.warn(" Chat history fetch blocked (non-ok)",s.status,l);return}const a=await s.json();console.log(" Chat history data received:",a);const o=a.conversations||[];e.onHistoryLoaded(o)}catch(s){console.warn("Error loading chat history (suppressed):",s)}},[n,t,e.onHistoryLoaded]),i=E.useCallback(async()=>{if(!n)return;if(!(await fetch(`${da}/api/chat/history`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok)throw new Error("Failed to clear chat history")},[n]);return{loadHistory:r,clearHistory:i}},F4=(n,e)=>{const[t,r]=E.useState(null),[i,s]=E.useState(null),a=E.useCallback(async()=>{if(n)try{const o=await fetch(`${da}/api/agent/metrics`,{headers:{Authorization:`Bearer ${n}`}});if(o.ok){const l=await o.json();r(l.metrics),s(l.health)}}catch(o){console.error("Error fetching agent metrics:",o)}},[n]);return E.useEffect(()=>{if(!e)return;a();const o=setInterval(a,1e4);return()=>clearInterval(o)},[a,e]),{agentMetrics:t,agentHealth:i,refetch:a}},O4=n=>{const e=Math.floor(n/1e3),t=Math.floor(e/60),r=Math.floor(t/60),i=Math.floor(r/24);return i>0?`${i}d ${r%24}h`:r>0?`${r}h ${t%60}m`:t>0?`${t}m`:`${e}s`},U4=({agentMetrics:n,agentHealth:e})=>!n&&!e?null:c.jsxs("div",{className:"mt-3 p-3 bg-gray-900/50 border border-gray-600/50 rounded-lg",children:[c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs",children:n&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Requests"}),c.jsx("div",{className:"text-sm font-semibold text-blue-400",children:n.requests_processed})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Success Rate"}),c.jsx("div",{className:"text-sm font-semibold text-green-400",children:n.requests_processed>0?`${(n.successful_responses/n.requests_processed*100).toFixed(1)}%`:"100%"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Avg Response"}),c.jsxs("div",{className:"text-sm font-semibold text-yellow-400",children:[Math.round(n.average_response_time),"ms"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Cache Hit Rate"}),c.jsx("div",{className:"text-sm font-semibold text-purple-400",children:n.cache_hits+n.cache_misses>0?`${(n.cache_hits/(n.cache_hits+n.cache_misses)*100).toFixed(1)}%`:"0%"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Intent Accuracy"}),c.jsxs("div",{className:"text-sm font-semibold text-cyan-400",children:[(n.intent_accuracy*100).toFixed(1),"%"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Tool Accuracy"}),c.jsxs("div",{className:"text-sm font-semibold text-orange-400",children:[(n.tool_selection_accuracy*100).toFixed(1),"%"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Uptime"}),c.jsx("div",{className:"text-sm font-semibold text-gray-300",children:O4(n.uptime)})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Health"}),c.jsx("div",{className:`text-sm font-semibold ${e?.healthy?"text-green-400":"text-red-400"}`,children:e?.healthy?" Healthy":" Issues"})]})]})}),e&&!e.healthy&&e.issues?.length>0&&c.jsxs("div",{className:"mt-2 text-xs text-red-300",children:["Issues: ",e.issues?.join(", ")]})]}),B4=({chatStats:n,isConnected:e,connectionStats:t,connectionError:r,agentMetrics:i,agentHealth:s,showMetrics:a,onToggleMetrics:o,onClearChat:l,onClearError:u})=>c.jsxs("div",{className:"p-4 border-b border-gray-600/50 bg-gradient-to-r from-gray-800/80 to-gray-700/80",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-xl font-bold text-gradient",children:"Chat with Cartrita"}),c.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[c.jsx("p",{className:"text-xs text-gray-400",children:n.totalMessages>0?`${n.totalMessages} messages`:"Start a new conversation"}),n.averageResponseTime>0&&c.jsxs("span",{className:"text-xs text-blue-400",children:[" ",Math.round(n.averageResponseTime),"ms avg"]}),n.toolsUsed>0&&c.jsxs("span",{className:"text-xs text-purple-400",children:[" ",n.toolsUsed," tools used"]})]})]}),c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:`w-3 h-3 rounded-full transition-all duration-300 ${e?"bg-green-500 shadow-lg shadow-green-500/50 status-pulse":"bg-red-500 shadow-lg shadow-red-500/50"}`}),c.jsxs("div",{className:"text-right",children:[c.jsx("span",{className:"text-sm text-gray-300 block",children:e?"Connected":"Disconnected"}),t.latency>0&&c.jsxs("span",{className:"text-xs text-gray-500",children:[t.latency,"ms"]})]})]}),c.jsx("button",{onClick:o,className:`text-gray-400 hover:text-blue-400 transition-colors p-1 rounded ${a?"text-blue-400":""}`,title:"Toggle metrics",children:""}),c.jsx("button",{onClick:l,className:"text-gray-400 hover:text-red-400 transition-colors p-1 rounded",title:"Clear chat history",children:""})]})]}),r&&c.jsxs("div",{className:"mt-2 p-2 bg-red-900/50 border border-red-500/50 rounded text-red-200 text-sm flex justify-between items-center",children:[c.jsxs("span",{children:[" ",r]}),c.jsx("button",{onClick:u,className:"text-red-300 hover:text-red-100 ml-2",title:"Dismiss error",children:""})]}),a&&c.jsx(U4,{agentMetrics:i,agentHealth:s})]}),z4=n=>typeof n!="string"?"":n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>"),V4=n=>({time_query:"",image_generation:"",coding:"",research:"",conversation:"",general:""})[n]||"",G4=n=>n>=90?"text-green-400":n>=70?"text-yellow-400":"text-red-400",H4=({message:n,index:e})=>{const t=n.speaker==="user";return c.jsx("div",{className:`flex message-appear ${t?"justify-end":"justify-start"}`,style:{animationDelay:`${e*50}ms`},children:c.jsxs("div",{className:`max-w-[75%] px-4 py-3 rounded-2xl shadow-lg ${t?"bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-br-md":"bg-gradient-to-br from-gray-700 to-gray-800 text-gray-100 rounded-bl-md"}`,children:[c.jsx("div",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:z4(n.text)}}),c.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs opacity-70",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{children:new Date(n.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),n.response_time_ms&&c.jsxs("span",{className:"text-blue-300",children:["",n.response_time_ms,"ms"]})]}),c.jsxs("div",{className:"flex items-center space-x-1",children:[n.intent_analysis&&c.jsx("span",{title:`Intent: ${n.intent_analysis.primary_intent} (${(n.intent_analysis.primary_confidence*100).toFixed(0)}%)`,children:V4(n.intent_analysis.primary_intent)}),n.tools_used&&n.tools_used.length>0&&c.jsxs("span",{title:`Tools: ${n.tools_used.join(", ")}`,className:"text-purple-300",children:["",n.tools_used.length]}),n.performance_score&&c.jsxs("span",{className:G4(n.performance_score),title:`Performance: ${n.performance_score}/100`,children:["",n.performance_score]}),n.model&&c.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-black/20 rounded text-[10px]",children:n.model})]})]})]})})},$4=({onSuggestionClick:n})=>c.jsxs("div",{className:"text-center text-gray-400 mt-16",children:[c.jsx("div",{className:"text-6xl mb-4",children:""}),c.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Ready to Chat!"}),c.jsx("p",{className:"text-gray-500",children:"Start a conversation with Cartrita. She's sassy, smart, and ready to help."}),c.jsx("div",{className:"mt-6 grid grid-cols-1 gap-2 max-w-md mx-auto",children:wB.map((e,t)=>c.jsxs("button",{onClick:()=>n(e.text),className:"text-left p-2 rounded bg-gray-800/50 hover:bg-gray-700/50 transition-colors text-sm",children:[e.icon," ",e.label]},t))})]}),W4=()=>c.jsx("div",{className:"flex justify-start message-appear",children:c.jsx("div",{className:"bg-gradient-to-br from-gray-700 to-gray-800 px-4 py-3 rounded-2xl rounded-bl-md shadow-lg",children:c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{className:"text-sm text-gray-300",children:"Cartrita is thinking"}),c.jsxs("div",{className:"typing-indicator ml-2",children:[c.jsx("div",{className:"typing-dot"}),c.jsx("div",{className:"typing-dot"}),c.jsx("div",{className:"typing-dot"})]})]})})}),q4=({messages:n,isLoading:e,isTyping:t,messagesEndRef:r,onSuggestionClick:i})=>c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",children:[n.length===0?c.jsx($4,{onSuggestionClick:i}):n.map((s,a)=>c.jsx(H4,{message:s,index:a},s.id)),(e||t)&&c.jsx(W4,{}),c.jsx("div",{ref:r})]}),on={gray900:"#0d0d0f",gray800:"#1a1c1f",gray700:"#26292d",gray600:"#32353a",gray500:"#4a4f57",gray400:"#6a7079",gray300:"#8b929c",gray200:"#b1b7c0",gray100:"#d8dce2",white:"#ffffff",black:"#000000",accentPrimary:"#6366f1",accentPrimaryHover:"#4f46e5",accentSecondary:"#ec4899",accentTertiary:"#10b981",warning:"#f59e0b",danger:"#ef4444",info:"#0ea5e9",success:"#10b981",accentPurple:"#8b5cf6",accentBlue:"#3b82f6",accentGreen:"#43e97b",accentTeal:"#38f9d7",accentPink:"#fa709a",accentYellow:"#fee140",accentAqua:"#4facfe",accentCyan:"#00f2fe",accentRose:"#f5576c",accentMagenta:"#f093fb",accentPeachLight:"#ffecd2",accentPeach:"#fcb69f",accentMint:"#00ff88"},nl={bg:on.gray900,bgAlt:on.gray800,border:on.gray600,textInverted:on.white,focus:on.accentPrimary},Kn={trigger:`linear-gradient(135deg, ${on.accentBlue} 0%, ${on.accentPurple} 100%)`,ai:`linear-gradient(135deg, ${on.accentMagenta} 0%, ${on.accentRose} 100%)`,rag:`linear-gradient(135deg, ${on.accentAqua} 0%, ${on.accentCyan} 100%)`,mcp:`linear-gradient(135deg, ${on.accentGreen} 0%, ${on.accentTeal} 100%)`,http:`linear-gradient(135deg, ${on.accentPink} 0%, ${on.accentYellow} 100%)`,logic:`linear-gradient(135deg, ${on.accentPeachLight} 0%, ${on.accentPurple} 100%)`,data:`linear-gradient(135deg, ${on.accentPeachLight} 0%, ${on.accentPeach} 100%)`,fallback:`linear-gradient(135deg, ${on.accentBlue} 0%, ${on.accentPurple} 100%)`};function X4({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"}))}const Dx=E.forwardRef(X4);function Y4({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const JS=E.forwardRef(Y4);function K4({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const Ix=E.forwardRef(K4);function Z4({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"}))}const BM=E.forwardRef(Z4);function Q4({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"}))}const zM=E.forwardRef(Q4);function J4({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const Qf=E.forwardRef(J4);function e5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const kw=E.forwardRef(e5);function t5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"}))}const n5=E.forwardRef(t5);function r5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Xi=E.forwardRef(r5);function i5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Lw=E.forwardRef(i5);function s5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15a4.5 4.5 0 0 0 4.5 4.5H18a3.75 3.75 0 0 0 1.332-7.257 3 3 0 0 0-3.758-3.848 5.25 5.25 0 0 0-10.233 2.33A4.502 4.502 0 0 0 2.25 15Z"}))}const Bk=E.forwardRef(s5);function a5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const o5=E.forwardRef(a5);function l5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V6.75a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 6.75v10.5a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h9v9h-9v-9Z"}))}const Jf=E.forwardRef(l5);function c5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const u5=E.forwardRef(c5);function d5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const zk=E.forwardRef(d5);function h5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const f5=E.forwardRef(h5);function p5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const po=E.forwardRef(p5);function m5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const g5=E.forwardRef(m5);function x5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const y5=E.forwardRef(x5);function v5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"}))}const u_=E.forwardRef(v5);function _5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const b5=E.forwardRef(_5);function w5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const q0=E.forwardRef(w5);function S5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"}))}const gl=E.forwardRef(S5);function T5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}))}const N5=E.forwardRef(T5);function E5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const Vk=E.forwardRef(E5);function M5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const C5=E.forwardRef(M5);function A5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v17.25m0 0c-1.472 0-2.882.265-4.185.75M12 20.25c1.472 0 2.882.265 4.185.75M18.75 4.97A48.416 48.416 0 0 0 12 4.5c-2.291 0-4.545.16-6.75.47m13.5 0c1.01.143 2.01.317 3 .52m-3-.52 2.62 10.726c.122.499-.106 1.028-.589 1.202a5.988 5.988 0 0 1-2.031.352 5.988 5.988 0 0 1-2.031-.352c-.483-.174-.711-.703-.59-1.202L18.75 4.971Zm-16.5.52c.99-.203 1.99-.377 3-.52m0 0 2.62 10.726c.122.499-.106 1.028-.589 1.202a5.989 5.989 0 0 1-2.031.352 5.989 5.989 0 0 1-2.031-.352c-.483-.174-.711-.703-.59-1.202L5.25 4.971Z"}))}const R5=E.forwardRef(A5);function P5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"}))}const k5=E.forwardRef(P5);function L5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"}))}const nd=E.forwardRef(L5);function D5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"}))}const I5=E.forwardRef(D5);function j5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))}const F5=E.forwardRef(j5);function O5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const Jd=E.forwardRef(O5);function U5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const Gk=E.forwardRef(U5);function B5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"}))}const Dw=E.forwardRef(B5);function z5({title:n,titleId:e,...t},r){return E.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?E.createElement("title",{id:e},n):null,E.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const X0=E.forwardRef(z5),Hk=()=>{const n=[],e=window.isSecureContext||window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";return e||n.push("getUserMedia requires HTTPS or localhost"),navigator.mediaDevices||n.push("navigator.mediaDevices not available"),navigator.mediaDevices?.getUserMedia||n.push("getUserMedia not available"),{isSupported:n.length===0,issues:n,isSecureContext:e}},$k=()=>({echoCancellation:!0,noiseSuppression:!1,autoGainControl:!0,sampleRate:{ideal:44100,min:16e3},channelCount:{ideal:1}}),Wk=()=>{const n=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"];for(const e of n)if(MediaRecorder.isTypeSupported(e))return e;return""},qk=async()=>{try{const n=await navigator.mediaDevices.enumerateDevices();return console.log("[MediaUtils] Available devices:"),n.forEach((e,t)=>{console.log(`  ${t}: ${e.kind} - ${e.label||"Unnamed device"}`)}),n}catch(n){return console.error("[MediaUtils] Could not enumerate devices:",n),[]}},e1=({isRecording:n,audioStream:e,width:t=300,height:r=60,barColor:i=on.accentMint,backgroundColor:s="rgba(0, 0, 0, 0.2)",sensitivity:a=1})=>{const o=E.useRef(null),l=E.useRef(null),u=E.useRef(null),h=E.useRef(null),[p,m]=E.useState(!1);E.useEffect(()=>(n&&e?(g(),m(!0)):(b(),m(!1)),()=>b()),[n,e]);const g=async()=>{if(!(!e||!o.current))try{const _=new(window.AudioContext||window.webkitAudioContext),x=_.createAnalyser(),N=_.createMediaStreamSource(e);x.fftSize=256,x.smoothingTimeConstant=.8,N.connect(x),u.current=_,l.current=x,y()}catch(_){console.error("[AudioVisualizer] Failed to initialize audio analysis:",_)}},y=()=>{if(!l.current||!o.current)return;const _=o.current,x=_.getContext("2d");if(!x)return;const N=l.current,T=N.frequencyBinCount,S=new Uint8Array(T),M=()=>{if(!n){x.fillStyle=s,x.fillRect(0,0,_.width,_.height);return}N.getByteFrequencyData(S),x.fillStyle=s,x.fillRect(0,0,_.width,_.height);const C=32,R=_.width/C,F=_.height-10;for(let k=0;k<C;k++){const D=Math.floor(k*T/C),P=Math.max(2,S[D]/255*F*a),G=x.createLinearGradient(0,_.height,0,_.height-P);G.addColorStop(0,i),G.addColorStop(1,i+"60"),x.fillStyle=G,x.fillRect(k*R+1,_.height-P,R-2,P)}if(n){const k=.1+.1*Math.sin(Date.now()*.005);x.fillStyle=`${i}${Math.floor(k*255).toString(16).padStart(2,"0")}`,x.fillRect(0,0,_.width,_.height)}h.current=requestAnimationFrame(M)};M()},b=()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null),u.current&&(u.current.close(),u.current=null),l.current=null};return c.jsxs("div",{className:"audio-visualizer-container",children:[c.jsx("canvas",{ref:o,width:t,height:r,className:`audio-visualizer ${p?"active":"inactive"}`,style:{border:`1px solid ${p?i:on.gray600}`,borderRadius:"8px",background:s,transition:"border-color 0.3s ease",boxShadow:p?`0 0 20px ${i}40`:"none",opacity:p?1:.6}}),p&&c.jsxs("div",{className:"recording-indicator",style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:"8px",fontSize:"12px",color:i,fontWeight:"bold"},children:[c.jsx("div",{style:{width:"8px",height:"8px",backgroundColor:i,borderRadius:"50%",marginRight:"6px",animation:"pulse 1.5s infinite"}}),"Recording Audio..."]}),c.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.5; transform: scale(1.1); }
        }
      `})]})},t1=({onPermissionChange:n,requiredPermissions:e,showUI:t=!0,autoRequest:r=!1})=>{const[i,s]=E.useState({microphone:"unknown",camera:"unknown"}),[a,o]=E.useState(!1);E.useEffect(()=>{l(),r&&u()},[r]),E.useEffect(()=>{n(i)},[i,n]);const l=async()=>{try{if(!navigator.permissions){console.warn("[MediaPermissions] Permissions API not supported");return}const b=e.includes("microphone")?await navigator.permissions.query({name:"microphone"}):null,_=e.includes("camera")?await navigator.permissions.query({name:"camera"}):null;s(x=>({...x,microphone:b?b.state:"unknown",camera:_?_.state:"unknown"})),b&&(b.onchange=()=>{s(x=>({...x,microphone:b.state}))}),_&&(_.onchange=()=>{s(x=>({...x,camera:_.state}))})}catch(b){console.error("[MediaPermissions] Failed to check permissions:",b)}},u=async()=>{try{const b={};e.includes("microphone")&&(b.audio={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},s(x=>({...x,microphone:"requesting"}))),e.includes("camera")&&(b.video={width:{ideal:1280},height:{ideal:720},facingMode:"user"},s(x=>({...x,camera:"requesting"}))),console.log("[MediaPermissions] Requesting permissions...",b);const _=await navigator.mediaDevices.getUserMedia(b);s(x=>({...x,microphone:b.audio?"granted":x.microphone,camera:b.video?"granted":x.camera,error:void 0})),_.getTracks().forEach(x=>x.stop()),console.log("[MediaPermissions] Permissions granted")}catch(b){console.error("[MediaPermissions] Permission request failed:",b);let _="Permission request failed";const x=i.microphone==="requesting"?"denied":i.microphone,N=i.camera==="requesting"?"denied":i.camera;b.name==="NotAllowedError"?_="Permission was denied. Please allow access and try again.":b.name==="NotFoundError"?_="No microphone or camera found.":b.name==="NotReadableError"?_="Device is already in use by another application.":b.name==="OverconstrainedError"&&(_="Device does not meet the required constraints."),s(T=>({...T,microphone:x,camera:N,error:_}))}},h=()=>{alert(`To enable microphone/camera access:

1. Click the lock icon () in your browser's address bar
2. Select "Allow" for microphone and camera
3. Refresh the page

Or go to your browser settings:
- Chrome: Settings  Privacy & Security  Site Settings  Camera/Microphone
- Firefox: Settings  Privacy & Security  Permissions
- Safari: Safari  Preferences  Websites  Camera/Microphone`)},p=(b,_)=>{const x="h-5 w-5";return _==="granted"?c.jsx(Xi,{className:`${x} text-green-500`}):_==="denied"?c.jsx(X0,{className:`${x} text-red-500`}):_==="requesting"?c.jsx("div",{className:`${x} animate-pulse`,children:b==="microphone"?c.jsx(gl,{className:`${x} text-blue-500`}):c.jsx(Dw,{className:`${x} text-blue-500`})}):b==="microphone"?c.jsx(gl,{className:`${x} text-gray-400`}):c.jsx(Dw,{className:`${x} text-gray-400`})},m=(b,_)=>{const x=b==="microphone"?"Microphone":"Camera";switch(_){case"granted":return`${x} access granted`;case"denied":return`${x} access denied`;case"requesting":return`Requesting ${x.toLowerCase()} access...`;default:return`${x} permission unknown`}},g=e.every(b=>i[b]==="granted"),y=e.some(b=>i[b]==="denied")||!!i.error;return t?c.jsx("div",{className:"media-permission-handler",children:c.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("h3",{className:"text-sm font-medium text-white",children:"Media Permissions"}),c.jsx("button",{onClick:()=>o(!a),className:"text-gray-400 hover:text-white transition-colors",children:c.jsx(b5,{className:"h-4 w-4"})})]}),c.jsx("div",{className:"space-y-2",children:e.map(b=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[p(b,i[b]),c.jsx("span",{className:"text-sm text-gray-300",children:m(b,i[b])})]}),i[b]==="denied"&&c.jsx("button",{onClick:u,className:"text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-white transition-colors",children:"Retry"})]},b))}),i.error&&c.jsx("div",{className:"bg-red-900/20 border border-red-500/20 rounded p-3",children:c.jsxs("div",{className:"flex items-start space-x-2",children:[c.jsx(po,{className:"h-5 w-5 text-red-400 mt-0.5"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm text-red-200",children:i.error}),c.jsx("button",{onClick:h,className:"mt-2 text-xs text-red-300 hover:text-red-100 underline",children:"How to fix this"})]})]})}),c.jsxs("div",{className:"flex items-center justify-between pt-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[g&&c.jsxs("div",{className:"flex items-center space-x-1 text-green-400 text-xs",children:[c.jsx(Xi,{className:"h-4 w-4"}),c.jsx("span",{children:"Ready to use"})]}),y&&c.jsxs("div",{className:"flex items-center space-x-1 text-red-400 text-xs",children:[c.jsx(X0,{className:"h-4 w-4"}),c.jsx("span",{children:"Permissions needed"})]})]}),c.jsxs("div",{className:"space-x-2",children:[y&&c.jsxs("button",{onClick:h,className:"text-xs text-gray-400 hover:text-white transition-colors",children:[c.jsx(o5,{className:"h-4 w-4 inline mr-1"}),"Settings"]}),!g&&c.jsx("button",{onClick:u,disabled:i.microphone==="requesting"||i.camera==="requesting",className:"text-xs bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-3 py-1 rounded text-white transition-colors",children:i.microphone==="requesting"||i.camera==="requesting"?"Requesting...":"Grant Access"})]})]}),a&&c.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/20 rounded p-3 text-xs text-blue-200",children:[c.jsx("p",{className:"mb-2",children:c.jsx("strong",{children:"Why do we need these permissions?"})}),c.jsxs("ul",{className:"space-y-1 text-blue-300",children:[e.includes("microphone")&&c.jsx("li",{children:" Microphone: For voice commands and transcription"}),e.includes("camera")&&c.jsx("li",{children:" Camera: For visual analysis and context understanding"})]}),c.jsx("p",{className:"mt-2 text-blue-400",children:"Your privacy is protected - media is processed securely and not stored without permission."})]})]})}):null},V5=({onTranscript:n,disabled:e=!1,token:t})=>{const[r,i]=E.useState(!1),[s,a]=E.useState(!1),[o,l]=E.useState({microphone:"unknown",camera:"unknown"}),[u,h]=E.useState(!1),p=E.useRef(null),m=E.useRef(null),g=E.useRef([]);async function y(S){try{const M=new AudioContext,C=await S.arrayBuffer(),F=(await M.decodeAudioData(C)).getChannelData(0),k=F.reduce((P,G)=>P+Math.abs(G),0)/F.length;let D=0;for(let P=0;P<F.length;P++){const G=Math.abs(F[P]);G>D&&(D=G)}return console.log("[VoiceToText] Audio analysis - Avg volume:",k.toFixed(6),"Max volume:",D.toFixed(6)),k>.001||D>.01}catch(M){return console.error("[VoiceToText] Audio validation error:",M),!0}}const b=async()=>{if(!(e||!t))try{console.log("[VoiceToText] Starting recording");const S=Hk();if(!S.isSupported)throw console.error("[VoiceToText] Media support issues:",S.issues),new Error(`Media not supported: ${S.issues.join(", ")}`);await qk();const M=$k();console.log("[VoiceToText] Audio constraints:",M);const C=await navigator.mediaDevices.getUserMedia({audio:M});console.log("[VoiceToText] Microphone access granted"),console.log("[VoiceToText] Audio tracks:",C.getAudioTracks().length);const R=C.getAudioTracks();if(R.length===0)throw new Error("No audio tracks available");R.forEach((D,P)=>{console.log(`[VoiceToText] Track ${P}:`,D.label,"enabled:",D.enabled,"readyState:",D.readyState)}),m.current=C,g.current=[],i(!0);const F=Wk();console.log("[VoiceToText] Using MIME type:",F||"default");const k=new MediaRecorder(C,F?{mimeType:F}:void 0);p.current=k,k.ondataavailable=D=>{D.data.size>0&&g.current.push(D.data)},k.onstop=async()=>{console.log("[VoiceToText] Recording stopped, processing..."),a(!0);try{const D=new Blob(g.current,{type:"audio/webm"});if(console.log("[VoiceToText] Audio blob created:",D.size,"bytes"),!await y(D)){console.warn("[VoiceToText] Skipping transcription  audio appears silent"),console.warn("[VoiceToText] Try speaking louder or closer to the microphone"),alert("No speech detected in your recording. Please speak louder and closer to the microphone, then try again.");return}const G=new FormData;G.append("audio",D,"recording.webm"),console.log("[VoiceToText] FormData created, sending request...");const $=await fetch(`${da}/api/voice-to-text/transcribe`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:G});if(console.log("[VoiceToText] Response received:",$.status,$.statusText),!$.ok){const K=await $.text();throw console.error("[VoiceToText] Error response:",K),new Error(`Transcription failed: ${$.status} ${$.statusText} - ${K}`)}const U=await $.json();console.log("[VoiceToText] Transcription result:",U),U.transcript?(console.log("[VoiceToText] Transcription successful:",U.transcript),n(U.transcript)):console.warn("[VoiceToText] No transcript received")}catch(D){console.error("[VoiceToText] Transcription error:",D);const P=D instanceof Error?D.message:"Unknown error";alert(`Failed to transcribe speech: ${P}`)}finally{a(!1)}},k.start(1e3)}catch(S){console.error("[VoiceToText] Failed to start recording:",S),i(!1),S instanceof Error?S.name==="NotAllowedError"?alert("Microphone permission was denied. Please allow microphone access in your browser settings and try again."):S.name==="NotFoundError"?alert("No microphone found. Please connect a microphone and try again."):S.name==="NotReadableError"?alert("Microphone is already in use by another application. Please close other applications using the microphone and try again."):alert(`Failed to start voice recording: ${S.message}`):alert("Failed to start voice recording. Please try again.")}},_=()=>{console.log("[VoiceToText] Stopping recording"),p.current&&p.current.state!=="inactive"&&(p.current.stop(),p.current=null),m.current&&(m.current.getTracks().forEach(S=>S.stop()),m.current=null),i(!1)},x=()=>{if(r)_();else{if(o.microphone!=="granted"){h(!0);return}b()}},N=S=>{l(S),S.microphone==="granted"&&u&&h(!1)};E.useEffect(()=>()=>{r&&_()},[]);const T=e||s||!t;return c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:x,disabled:T,className:`
          p-2 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2
          ${r?"bg-red-500 hover:bg-red-600 text-white focus:ring-red-500":s?"bg-blue-500 text-white animate-pulse":"bg-gray-100 hover:bg-gray-200 text-gray-600 focus:ring-blue-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}
          ${T?"opacity-50 cursor-not-allowed":"cursor-pointer"}
        `,title:r?"Stop recording":s?"Processing...":"Start voice input",children:r?c.jsx(Jd,{className:"h-5 w-5"}):c.jsx(gl,{className:`h-5 w-5 ${s?"animate-pulse":""}`})}),s&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-blue-500 text-white text-xs rounded shadow-lg whitespace-nowrap",children:"Processing..."}),r&&c.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"}),r&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4",children:c.jsx(e1,{isRecording:r,audioStream:m.current,width:200,height:40,barColor:on.danger,backgroundColor:"rgba(0, 0, 0, 0.8)",sensitivity:1.2})}),u&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 w-80",children:c.jsx(t1,{onPermissionChange:N,requiredPermissions:["microphone"],showUI:!0,autoRequest:!1})})]})},G5=({inputText:n,isConnected:e,isLoading:t,messageHistoryCount:r,inputRef:i,onInputChange:s,onKeyPress:a,onSendMessage:o,onVoiceTranscript:l,token:u})=>c.jsxs("div",{className:"p-4 border-t border-gray-600/50 bg-gray-800/30",children:[c.jsxs("div",{className:"flex items-end space-x-3",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx("textarea",{ref:i,value:n,onChange:s,onKeyDown:a,placeholder:"Type your message or use voice input... (Ctrl+/ for history)",className:"w-full input-enhanced px-4 py-3 pr-12 rounded-xl resize-none min-h-[48px] max-h-[120px] text-sm leading-relaxed",disabled:!e||t,rows:1}),c.jsx("div",{className:"absolute right-2 bottom-2",children:c.jsx(V5,{onTranscript:l,disabled:!e||t,token:u})}),n.length>0&&c.jsxs("div",{className:"absolute bottom-1 right-14 text-xs text-gray-500",children:[n.length,"/2000"]})]}),c.jsx("button",{onClick:o,disabled:!n.trim()||!e||t,className:"btn-skittles px-6 py-3 rounded-xl font-semibold text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center space-x-2",children:t?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),c.jsx("span",{children:"Sending..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{children:"Send"}),c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})]})})]}),r>0&&c.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-center",children:["Use Ctrl+/ to navigate message history (",r," saved)"]})]});class H5{history=[];currentIndex=-1;add(e){this.history=[e,...this.history.slice(0,49)],this.currentIndex=-1}getPrevious(){return this.currentIndex<this.history.length-1?(this.currentIndex++,this.history[this.currentIndex]):null}getNext(){return this.currentIndex>0?(this.currentIndex--,this.history[this.currentIndex]):this.currentIndex===0?(this.currentIndex=-1,""):null}getCount(){return this.history.length}clear(){this.history=[],this.currentIndex=-1}}const Xk={messages:[],isLoading:!1,isConnected:!1,chatStats:{totalMessages:0,userMessages:0,cartritaMessages:0,conversationStarted:null,averageResponseTime:0,toolsUsed:0,totalPerformanceScore:0}},VM=n=>{const e=n.filter(o=>o.speaker==="user").length,t=n.filter(o=>o.speaker==="cartrita").length,r=n.reduce((o,l)=>o+(l.tools_used?.length||0),0),i=n.reduce((o,l)=>o+(l.performance_score||0),0),s=n.filter(o=>o.response_time_ms).map(o=>o.response_time_ms),a=s.length>0?s.reduce((o,l)=>o+l,0)/s.length:0;return{totalMessages:n.length,userMessages:e,cartritaMessages:t,conversationStarted:n.length>0?new Date(n[0].created_at):null,averageResponseTime:a,toolsUsed:r,totalPerformanceScore:i}},$5=(n,e)=>{switch(e.type){case"ADD_MESSAGE":{const t=[...n.messages,e.payload];return{...n,messages:t,chatStats:VM(t),isLoading:!1}}case"SET_MESSAGES":return{...n,messages:e.payload,chatStats:VM(e.payload)};case"CLEAR_MESSAGES":return{...n,messages:[],chatStats:Xk.chatStats};case"SET_LOADING":return{...n,isLoading:e.payload};case"SET_CONNECTED":return{...n,isConnected:e.payload};default:return n}},W5=({token:n})=>{const{i18n:e}=zB(),[t,r]=E.useReducer($5,Xk),[i,s]=E.useState(""),[a,o]=E.useState(!1),l=E.useRef(null),u=E.useRef(null),h=E.useMemo(()=>({onMessage:U=>r({type:"ADD_MESSAGE",payload:U}),onConnect:()=>r({type:"SET_CONNECTED",payload:!0}),onDisconnect:()=>r({type:"SET_CONNECTED",payload:!1})}),[]),p=E.useMemo(()=>({onHistoryLoaded:U=>r({type:"SET_MESSAGES",payload:U})}),[]),{isConnected:m,connectionError:g,connectionStats:y,isTyping:b,sendMessage:_,clearConnectionError:x}=I4(n,h),{loadHistory:N,clearHistory:T}=j4(n,p),{agentMetrics:S,agentHealth:M}=F4(n,m),C=new H5,R=E.useCallback(()=>{l.current?.scrollIntoView({behavior:"smooth",block:"end"})},[]);E.useEffect(()=>{const U=setTimeout(R,100);return()=>clearTimeout(U)},[t.messages,R]),E.useEffect(()=>{n&&N()},[n,N]);const F=E.useCallback(()=>{const U=i.trim();if(!U||!m||t.isLoading)return;C.add(U);const K={id:Date.now(),speaker:"user",text:U,created_at:new Date().toISOString()};r({type:"ADD_MESSAGE",payload:K}),r({type:"SET_LOADING",payload:!0}),s(""),_(U,e.language||"en"),u.current?.focus()},[i,m,t.isLoading,_,e.language]),k=E.useCallback(U=>{if(U.key==="Enter"&&!U.shiftKey)U.preventDefault(),F();else if(U.key==="ArrowUp"&&U.ctrlKey){U.preventDefault();const K=C.getPrevious();K&&s(K)}else if(U.key==="ArrowDown"&&U.ctrlKey){U.preventDefault();const K=C.getNext();s(K||"")}},[F]),D=E.useCallback(U=>{s(U.target.value)},[]),P=E.useCallback(U=>{s(K=>`${K} ${U}`.trim())},[]),G=E.useCallback(async()=>{if(window.confirm("Are you sure you want to clear all chat history?"))try{await T(),r({type:"CLEAR_MESSAGES"})}catch(U){console.error("Error clearing chat:",U)}},[T]),$=E.useCallback(U=>{s(U),u.current?.focus()},[]);return c.jsxs("div",{className:"backdrop-blur-xl bg-white/10 dark:bg-black/20 border border-white/20 rounded-xl h-[700px] flex flex-col overflow-hidden",children:[c.jsx(B4,{chatStats:t.chatStats,isConnected:m,connectionStats:y,connectionError:g,agentMetrics:S,agentHealth:M,showMetrics:a,onToggleMetrics:()=>o(!a),onClearChat:G,onClearError:x}),c.jsx(q4,{messages:t.messages,isLoading:t.isLoading,isTyping:b,messagesEndRef:l,onSuggestionClick:$}),c.jsx(G5,{inputText:i,isConnected:m,isLoading:t.isLoading,messageHistoryCount:C.getCount(),inputRef:u,onInputChange:D,onKeyPress:k,onSendMessage:F,onVoiceTranscript:P,token:n})]})},Yk=E.createContext(void 0),q5=({children:n})=>{const[e,t]=E.useState([]),r=E.useCallback(a=>t(o=>o.filter(l=>l.id!==a)),[]),i=E.useCallback(a=>{const o=Math.random().toString(36).slice(2,11),l={id:o,duration:5e3,...a};return t(u=>[...u,l]),l.duration&&l.duration>0&&setTimeout(()=>r(o),l.duration),o},[r]),s=E.useCallback(()=>t([]),[]);return c.jsxs(Yk.Provider,{value:{notifications:e,addNotification:i,removeNotification:r,clearAll:s},children:[n,c.jsx(X5,{})]})},X5=()=>{const{notifications:n,removeNotification:e}=Kk();return n.length?c.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:n.map(t=>c.jsx(Y5,{notification:t,onRemove:()=>e(t.id)},t.id))}):null},Y5=({notification:n,onRemove:e})=>{const t=n.type==="success"?"bg-green-900/90 border-green-700 text-green-100":n.type==="error"?"bg-red-900/90 border-red-700 text-red-100":n.type==="warning"?"bg-yellow-900/90 border-yellow-700 text-yellow-100":"bg-blue-900/90 border-blue-700 text-blue-100",r=n.type==="success"?"":n.type==="error"?"":n.type==="warning"?"":"";return c.jsx("div",{className:`p-4 rounded-lg border backdrop-blur-sm animate-in slide-in-from-right-full ${t}`,children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[c.jsx("span",{className:"text-lg",children:r}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-semibold text-sm",children:n.title}),n.message&&c.jsx("p",{className:"text-sm opacity-90 mt-1",children:n.message}),n.actions?.length?c.jsx("div",{className:"flex space-x-2 mt-3",children:n.actions.map((i,s)=>c.jsx("button",{onClick:i.onClick,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${i.variant==="primary"?"bg-white/20 hover:bg-white/30":"bg-transparent hover:bg-white/10 border border-current"}`,children:i.label},s))}):null]})]}),c.jsx("button",{onClick:e,className:"text-current/70 hover:text-current transition-colors p-1",children:""})]})})},Kk=()=>{const n=E.useContext(Yk);if(!n)throw new Error("useNotification must be used within a NotificationProvider");return n},n1=()=>{const{addNotification:n}=Kk();return{success:(e,t)=>n({type:"success",title:e,message:t}),error:(e,t)=>n({type:"error",title:e,message:t}),warning:(e,t)=>n({type:"warning",title:e,message:t}),info:(e,t)=>n({type:"info",title:e,message:t})}},K5=({token:n,onBack:e})=>{const t=n1(),[r,i]=E.useState(null),[s,a]=E.useState({name:"",email:""}),[o,l]=E.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[u,h]=E.useState({sarcasm_level:5,verbosity:"normal",humor_style:"playful",language_preference:"en",timezone:"America/New_York",theme:"dark",notifications_enabled:!0,voice_enabled:!0,ambient_listening:!1}),[p,m]=E.useState({voice_responses:!1,ambient_listening:!1,sound_effects:!0,camera_enabled:!1}),[g,y]=E.useState(!0),[b,_]=E.useState(!1),[x,N]=E.useState(!1),[T,S]=E.useState(!1),[M,C]=E.useState(!1),[R,F]=E.useState(""),[k,D]=E.useState(""),[P,G]=E.useState("profile");E.useEffect(()=>{n&&(async()=>{y(!0),D("");try{const[q,Q]=await Promise.all([fetch("/api/user/me",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/user/preferences",{headers:{Authorization:`Bearer ${n}`}})]);if(!q.ok){const ce=await q.text();throw new Error(`Failed to fetch user profile (${q.status}): ${ce}`)}if(!Q.ok){const ce=await Q.text();throw new Error(`Failed to fetch user settings (${Q.status}): ${ce}`)}const te=await q.json(),X=await Q.json();i(te),a({name:te.name,email:te.email}),h({sarcasm_level:X.sarcasm_level??5,verbosity:X.verbosity||"normal",humor_style:X.humor_style||"playful",language_preference:X.language_preference||"en",timezone:X.timezone||"America/New_York",theme:X.theme||"dark",notifications_enabled:X.notifications_enabled??!0,voice_enabled:X.voice_enabled??!0,ambient_listening:X.ambient_listening??!1}),m({voice_responses:X.voice_responses??!1,ambient_listening:X.ambient_listening??!1,sound_effects:X.sound_effects??!0,camera_enabled:X.camera_enabled??!1})}catch(q){console.error("Error during settings page data fetch:",q),console.warn("Backend unavailable, using default settings");const Q={sarcasm_level:5,verbosity:"normal",humor_style:"playful",language_preference:"en",timezone:"America/New_York",theme:"dark",notifications_enabled:!0,voice_enabled:!0,ambient_listening:!1,voice_responses:!1,sound_effects:!0,camera_enabled:!1};r||(i({id:1,name:"User",email:"user@example.com",created_at:new Date().toISOString()}),a({name:"User",email:"user@example.com"})),h({sarcasm_level:Q.sarcasm_level,verbosity:Q.verbosity,humor_style:Q.humor_style,language_preference:Q.language_preference,timezone:Q.timezone,theme:Q.theme,notifications_enabled:Q.notifications_enabled,voice_enabled:Q.voice_enabled,ambient_listening:Q.ambient_listening}),m({voice_responses:Q.voice_responses,ambient_listening:Q.ambient_listening,sound_effects:Q.sound_effects,camera_enabled:Q.camera_enabled}),q.message.includes("Failed to fetch")?t.warning("Backend unavailable","Using default settings. Please check backend connection."):q.message.includes("403")||q.message.includes("Forbidden")?t.error("Authentication failed","Please try logging out and logging back in."):q.message.includes("500")?t.error("Server error","Using default settings. Check backend logs for details."):t.warning("Settings loading failed",`${q.message}. Using defaults.`)}finally{y(!1)}})()},[n]);const $=async J=>{J.preventDefault(),_(!0),F(""),D("");try{const q=await fetch("/api/user/me",{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(s)}),Q=await q.json();if(!q.ok)throw new Error(Q.message||"Failed to update profile");i(Q.user),t.success("Profile updated","Your profile information has been saved")}catch(q){t.error("Profile update failed",q.message)}finally{_(!1)}},U=async J=>{if(J.preventDefault(),N(!0),F(""),D(""),o.newPassword!==o.confirmPassword){t.error("Password mismatch","New passwords do not match"),N(!1);return}if(o.newPassword.length<6){t.error("Password too short","Password must be at least 6 characters"),N(!1);return}try{const q=await fetch("/api/user/me/password",{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:o.currentPassword,newPassword:o.newPassword})}),Q=await q.json();if(!q.ok)throw new Error(Q.message||"Failed to update password");t.success("Password updated","Your password has been changed successfully"),l({currentPassword:"",newPassword:"",confirmPassword:""})}catch(q){t.error("Password update failed",q.message)}finally{N(!1)}},K=async J=>{J.preventDefault(),S(!0),F(""),D("");try{const q=await fetch("/api/user/preferences",{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(u)}),Q=await q.json();if(!q.ok)throw new Error(Q.message||"Failed to update personality settings");t.success("Personality updated","Your personality settings have been saved")}catch(q){t.error("Personality update failed",q.message)}finally{S(!1)}},O=(J,q)=>{a(Q=>({...Q,[J]:q}))},j=(J,q)=>{l(Q=>({...Q,[J]:q}))},L=(J,q)=>{h(Q=>({...Q,[J]:q}))},B=(J,q)=>{m(Q=>({...Q,[J]:q}))},V=async J=>{J.preventDefault(),C(!0),F(""),D("");try{const q=await fetch("/api/user/preferences",{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(p)}),Q=await q.json();if(!q.ok)throw new Error(Q.message||"Failed to update audio settings");t.success("Audio settings updated","Your audio preferences have been saved")}catch(q){t.error("Audio update failed",q.message)}finally{C(!1)}},z=async()=>{if(confirm("Are you sure you want to clear all your chat history? This cannot be undone."))try{const J=await fetch("/api/settings/clear-chat-history",{method:"POST",headers:{Authorization:`Bearer ${n}`}}),q=await J.json();if(!J.ok)throw new Error(q.error||"Failed to clear chat history");t.success("Chat history cleared",`${q.deletedCount} messages deleted successfully.`)}catch(J){t.error("Clear history failed",J.message)}},Y=async()=>{try{const J=await fetch("/api/settings/export-data",{headers:{Authorization:`Bearer ${n}`}});if(!J.ok){const X=await J.json();throw new Error(X.error||"Failed to export data")}const q=await J.blob(),Q=window.URL.createObjectURL(q),te=document.createElement("a");te.href=Q,te.download=`cartrita-data-${Date.now()}.json`,document.body.appendChild(te),te.click(),document.body.removeChild(te),window.URL.revokeObjectURL(Q),t.success("Data exported","Your data has been downloaded successfully")}catch(J){t.error("Export failed",J.message)}},se=async()=>{const J=prompt("Enter your password to confirm account deletion:");if(J&&confirm("Are you absolutely sure you want to delete your account? This action cannot be undone and will permanently delete all your data."))try{const q=await fetch("/api/settings/delete-account",{method:"DELETE",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({confirmPassword:J})}),Q=await q.json();if(!q.ok)throw new Error(Q.error||"Failed to delete account");alert("Account deleted successfully. You will be logged out."),window.location.href="/"}catch(q){t.error("Delete account failed",q.message)}};return g?c.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center",children:c.jsx("div",{className:"glass-card p-8 rounded-xl",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("div",{className:"spinner"}),c.jsx("span",{className:"text-white text-lg",children:"Loading your settings..."})]})})}):c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-4",children:c.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50",children:" Back"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-gradient",children:"Settings"}),c.jsx("p",{className:"text-gray-400",children:"Manage your account and preferences"})]})]}),r&&c.jsxs("div",{className:"text-right",children:[c.jsx("p",{className:"text-sm text-gray-400",children:"Signed in as"}),c.jsx("p",{className:"font-semibold",children:r.name})]})]})}),c.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[R&&c.jsxs("div",{className:"mb-6 p-4 bg-green-900/50 border border-green-500/50 rounded-lg text-green-200",children:[" ",R]}),k&&c.jsxs("div",{className:"mb-6 p-4 bg-red-900/50 border border-red-500/50 rounded-lg text-red-200",children:[" ",k]}),c.jsx("div",{className:"mb-8",children:c.jsx("nav",{className:"flex space-x-1 glass-card p-1 rounded-xl w-fit",children:[{key:"profile",label:"Profile",icon:""},{key:"password",label:"Password",icon:""},{key:"personality",label:"Personality",icon:""},{key:"preferences",label:"Preferences",icon:""},{key:"health",label:"System Health",icon:""}].map(J=>c.jsxs("button",{onClick:()=>G(J.key),className:`px-4 py-2 rounded-lg transition-all duration-200 flex items-center space-x-2 ${P===J.key?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-800/50"}`,children:[c.jsx("span",{children:J.icon}),c.jsx("span",{children:J.label})]},J.key))})}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[c.jsxs("div",{className:"lg:col-span-2",children:[P==="profile"&&c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Profile Information"})]}),c.jsxs("form",{onSubmit:$,className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Full Name"}),c.jsx("input",{type:"text",value:s.name,onChange:J=>O("name",J.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your full name",autoComplete:"name",required:!0})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address"}),c.jsx("input",{type:"email",value:s.email,onChange:J=>O("email",J.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your email address",autoComplete:"email",required:!0})]}),c.jsx("button",{type:"submit",disabled:b,className:"btn-skittles px-6 py-3 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:b?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"spinner w-4 h-4"}),c.jsx("span",{children:"Updating..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Update Profile"})]})})]})]}),P==="password"&&c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Change Password"})]}),c.jsxs("form",{onSubmit:U,className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Current Password"}),c.jsx("input",{type:"password",value:o.currentPassword,onChange:J=>j("currentPassword",J.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your current password",autoComplete:"current-password",required:!0})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"New Password"}),c.jsx("input",{type:"password",value:o.newPassword,onChange:J=>j("newPassword",J.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your new password",autoComplete:"new-password",required:!0,minLength:6}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Password must be at least 6 characters long"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm New Password"}),c.jsx("input",{type:"password",value:o.confirmPassword,onChange:J=>j("confirmPassword",J.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Confirm your new password",autoComplete:"new-password",required:!0,minLength:6})]}),c.jsx("button",{type:"submit",disabled:x,className:"btn-skittles px-6 py-3 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:x?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"spinner w-4 h-4"}),c.jsx("span",{children:"Updating..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Update Password"})]})})]})]}),P==="personality"&&c.jsxs("form",{onSubmit:K,className:"glass-card p-6 rounded-xl",children:[c.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Cartrita's Personality"})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Sarcasm Level:"," ",c.jsxs("span",{className:"font-bold text-white",children:[u.sarcasm_level,"/10"]})]}),c.jsx("input",{type:"range",min:"1",max:"10",value:u.sarcasm_level,onChange:J=>L("sarcasm_level",parseInt(J.target.value,10)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"}),c.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[c.jsx("span",{children:"Sincere"}),c.jsx("span",{children:"Balanced"}),c.jsx("span",{children:"Unfiltered"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Response Length"}),c.jsxs("select",{value:u.verbosity,onChange:J=>L("verbosity",J.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[c.jsx("option",{value:"minimal",children:"Minimal - Short and to the point"}),c.jsx("option",{value:"normal",children:"Normal - Balanced responses"}),c.jsx("option",{value:"verbose",children:"Verbose - Detailed explanations"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Humor Style"}),c.jsxs("select",{value:u.humor_style,onChange:J=>L("humor_style",J.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[c.jsx("option",{value:"playful",children:" Playful - Light and fun"}),c.jsx("option",{value:"sarcastic",children:" Sarcastic - Witty and sharp"}),c.jsx("option",{value:"witty",children:" Witty - Clever wordplay"}),c.jsx("option",{value:"dry",children:" Dry - Deadpan delivery"}),c.jsx("option",{value:"absurd",children:" Absurd - Random and silly"}),c.jsx("option",{value:"intellectual",children:" Intellectual - Smart references"}),c.jsx("option",{value:"wholesome",children:" Wholesome - Positive and uplifting"}),c.jsx("option",{value:"edgy",children:" Edgy - Bold and provocative"}),c.jsx("option",{value:"dad-jokes",children:" Dad Jokes - Puns and groaners"}),c.jsx("option",{value:"observational",children:" Observational - Commentary on life"}),c.jsx("option",{value:"none",children:" None - Serious mode only"})]}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose how Cartrita expresses humor in conversations"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Language Preference"}),c.jsxs("select",{value:u.language_preference,onChange:J=>L("language_preference",J.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[c.jsx("option",{value:"en",children:"English"}),c.jsx("option",{value:"es",children:"Spanish"}),c.jsx("option",{value:"fr",children:"French"}),c.jsx("option",{value:"de",children:"German"}),c.jsx("option",{value:"it",children:"Italian"}),c.jsx("option",{value:"pt",children:"Portuguese"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Timezone"}),c.jsxs("select",{value:u.timezone,onChange:J=>L("timezone",J.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[c.jsx("option",{value:"America/New_York",children:"Eastern Time"}),c.jsx("option",{value:"America/Chicago",children:"Central Time"}),c.jsx("option",{value:"America/Denver",children:"Mountain Time"}),c.jsx("option",{value:"America/Los_Angeles",children:"Pacific Time"}),c.jsx("option",{value:"Europe/London",children:"London"}),c.jsx("option",{value:"Europe/Paris",children:"Paris"}),c.jsx("option",{value:"Asia/Tokyo",children:"Tokyo"}),c.jsx("option",{value:"Australia/Sydney",children:"Sydney"})]})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-300",children:"Features"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-600 rounded-lg",children:[c.jsx("span",{className:"text-sm",children:" Notifications"}),c.jsx("input",{type:"checkbox",checked:u.notifications_enabled,onChange:J=>h(q=>({...q,notifications_enabled:J.target.checked})),className:"toggle"})]}),c.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-600 rounded-lg",children:[c.jsx("span",{className:"text-sm",children:" Voice Responses"}),c.jsx("input",{type:"checkbox",checked:u.voice_enabled,onChange:J=>h(q=>({...q,voice_enabled:J.target.checked})),className:"toggle"})]}),c.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-600 rounded-lg",children:[c.jsx("span",{className:"text-sm",children:" Ambient Listening"}),c.jsx("input",{type:"checkbox",checked:u.ambient_listening,onChange:J=>h(q=>({...q,ambient_listening:J.target.checked})),className:"toggle"})]}),c.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-600 rounded-lg",children:[c.jsx("span",{className:"text-sm",children:" Dark Theme"}),c.jsx("input",{type:"checkbox",checked:u.theme==="dark",onChange:J=>L("theme",J.target.checked?"dark":"light"),className:"toggle"})]})]})]}),c.jsx("button",{type:"submit",disabled:T,className:"w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-semibold transition-all duration-300 flex items-center justify-center space-x-2",children:T?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),c.jsx("span",{children:"Saving Personality..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Save Personality Settings"})]})})]})]}),P==="preferences"&&c.jsx("div",{className:"space-y-6",children:c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"General Preferences"})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"p-4 border border-gray-600/50 rounded-lg",children:[c.jsx("h3",{className:"font-medium mb-2",children:" Theme Settings"}),c.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Customize your visual experience"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("label",{className:"flex items-center space-x-3",children:[c.jsx("input",{type:"radio",name:"theme",value:"dark",checked:u.theme==="dark",onChange:()=>L("theme","dark"),className:"text-blue-600"}),c.jsx("span",{children:"Dark Mode"})]}),c.jsxs("label",{className:"flex items-center space-x-3",children:[c.jsx("input",{type:"radio",name:"theme",value:"light",checked:u.theme==="light",onChange:()=>L("theme","light"),className:"text-blue-600"}),c.jsx("span",{children:"Light Mode"})]}),c.jsxs("label",{className:"flex items-center space-x-3",children:[c.jsx("input",{type:"radio",name:"theme",value:"auto",checked:u.theme==="auto",onChange:()=>L("theme","auto"),className:"text-blue-600"}),c.jsx("span",{children:"Auto (System)"})]})]})]}),c.jsxs("form",{onSubmit:V,className:"p-4 border border-gray-600/50 rounded-lg",children:[c.jsxs("h3",{className:"font-medium mb-2 flex items-center justify-between",children:[c.jsx("span",{children:" Audio Settings"}),c.jsx("button",{type:"submit",disabled:M,className:"text-sm bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-3 py-1 rounded transition-colors",children:M?"Saving...":"Save"})]}),c.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Configure audio and voice features"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("label",{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Voice Responses"}),c.jsx("input",{type:"checkbox",checked:p.voice_responses,onChange:J=>B("voice_responses",J.target.checked),className:"toggle"})]}),c.jsxs("label",{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Ambient Listening"}),c.jsx("input",{type:"checkbox",checked:p.ambient_listening,onChange:J=>B("ambient_listening",J.target.checked),className:"toggle"})]}),c.jsxs("label",{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Camera Access"}),c.jsx("input",{type:"checkbox",checked:p.camera_enabled,onChange:J=>B("camera_enabled",J.target.checked),className:"toggle"})]}),c.jsxs("label",{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Sound Effects"}),c.jsx("input",{type:"checkbox",checked:p.sound_effects,onChange:J=>B("sound_effects",J.target.checked),className:"toggle"})]})]})]})]})]})}),P==="health"&&c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"System Health"})]}),c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"text-6xl mb-4",children:""}),c.jsx("h3",{className:"text-xl font-semibold mb-2",children:"System Health Monitor"}),c.jsx("p",{className:"text-gray-400",children:"Comprehensive system health monitoring will be displayed here"})]})]})]}),c.jsxs("div",{className:"space-y-6",children:[r&&c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Account Info"})]}),c.jsxs("div",{className:"space-y-3 text-sm",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gray-400",children:"User ID:"}),c.jsxs("span",{className:"font-mono",children:["#",r.id]})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gray-400",children:"Member since:"}),c.jsx("span",{children:new Date(r.created_at).toLocaleDateString()})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gray-400",children:"Status:"}),c.jsx("span",{className:"text-green-400",children:"Active"})]})]})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Quick Actions"})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("button",{onClick:z,className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors text-sm flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Clear Chat History"})]}),c.jsxs("button",{onClick:Y,className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors text-sm flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Export Data"})]}),c.jsxs("button",{onClick:se,className:"w-full text-left p-3 rounded-lg hover:bg-red-900/20 hover:text-red-400 transition-colors text-sm flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Delete Account"})]})]})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Help & Support"})]}),c.jsxs("div",{className:"space-y-3 text-sm",children:[c.jsx("a",{href:"#",className:"block text-blue-400 hover:text-blue-300 transition-colors",children:" Documentation"}),c.jsx("a",{href:"#",className:"block text-blue-400 hover:text-blue-300 transition-colors",children:" Contact Support"}),c.jsx("a",{href:"#",className:"block text-blue-400 hover:text-blue-300 transition-colors",children:" Report Bug"})]})]})]})]})]})]})};function Or(n){if(typeof n=="string"||typeof n=="number")return""+n;let e="";if(Array.isArray(n))for(let t=0,r;t<n.length;t++)(r=Or(n[t]))!==""&&(e+=(e&&" ")+r);else for(let t in n)n[t]&&(e+=(e&&" ")+t);return e}var d_={exports:{}},h_={},f_={exports:{}},p_={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GM;function Z5(){if(GM)return p_;GM=1;var n=Up();function e(p,m){return p===m&&(p!==0||1/p===1/m)||p!==p&&m!==m}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,i=n.useEffect,s=n.useLayoutEffect,a=n.useDebugValue;function o(p,m){var g=m(),y=r({inst:{value:g,getSnapshot:m}}),b=y[0].inst,_=y[1];return s(function(){b.value=g,b.getSnapshot=m,l(b)&&_({inst:b})},[p,g,m]),i(function(){return l(b)&&_({inst:b}),p(function(){l(b)&&_({inst:b})})},[p]),a(g),g}function l(p){var m=p.getSnapshot;p=p.value;try{var g=m();return!t(p,g)}catch{return!0}}function u(p,m){return m()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return p_.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:h,p_}var HM;function Q5(){return HM||(HM=1,f_.exports=Z5()),f_.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $M;function J5(){if($M)return h_;$M=1;var n=Up(),e=Q5();function t(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var r=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=n.useRef,a=n.useEffect,o=n.useMemo,l=n.useDebugValue;return h_.useSyncExternalStoreWithSelector=function(u,h,p,m,g){var y=s(null);if(y.current===null){var b={hasValue:!1,value:null};y.current=b}else b=y.current;y=o(function(){function x(C){if(!N){if(N=!0,T=C,C=m(C),g!==void 0&&b.hasValue){var R=b.value;if(g(R,C))return S=R}return S=C}if(R=S,r(T,C))return R;var F=m(C);return g!==void 0&&g(R,F)?(T=C,R):(T=C,S=F)}var N=!1,T,S,M=p===void 0?null:p;return[function(){return x(h())},M===null?void 0:function(){return x(M())}]},[h,p,m,g]);var _=i(u,y[0],y[1]);return a(function(){b.hasValue=!0,b.value=_},[_]),l(_),_},h_}var WM;function ez(){return WM||(WM=1,d_.exports=J5()),d_.exports}var tz=ez();const nz=Kd(tz),rz={},qM=n=>{let e;const t=new Set,r=(h,p)=>{const m=typeof h=="function"?h(e):h;if(!Object.is(m,e)){const g=e;e=p??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(y=>y(e,g))}},i=()=>e,l={setState:r,getState:i,getInitialState:()=>u,subscribe:h=>(t.add(h),()=>t.delete(h)),destroy:()=>{(rz?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},u=e=n(r,i,l);return l},iz=n=>n?qM(n):qM,{useDebugValue:sz}=we,{useSyncExternalStoreWithSelector:az}=nz,oz=n=>n;function Zk(n,e=oz,t){const r=az(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return sz(r),r}const XM=(n,e)=>{const t=iz(n),r=(i,s=e)=>Zk(t,i,s);return Object.assign(r,t),r},lz=(n,e)=>n?XM(n,e):XM;function Ar(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(const[r,i]of n)if(!Object.is(i,e.get(r)))return!1;return!0}if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(const r of n)if(!e.has(r))return!1;return!0}const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(const r of t)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(n[r],e[r]))return!1;return!0}var cz={value:()=>{}};function Gp(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new P0(t)}function P0(n){this._=n}function uz(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}P0.prototype=Gp.prototype={constructor:P0,on:function(n,e){var t=this._,r=uz(n+"",t),i,s=-1,a=r.length;if(arguments.length<2){for(;++s<a;)if((i=(n=r[s]).type)&&(i=dz(t[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<a;)if(i=(n=r[s]).type)t[i]=YM(t[i],n.name,e);else if(e==null)for(i in t)t[i]=YM(t[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new P0(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var t=new Array(i),r=0,i,s;r<i;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,s=r.length;i<s;++i)r[i].value.apply(e,t)}};function dz(n,e){for(var t=0,r=n.length,i;t<r;++t)if((i=n[t]).name===e)return i.value}function YM(n,e,t){for(var r=0,i=n.length;r<i;++r)if(n[r].name===e){n[r]=cz,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}var Iw="http://www.w3.org/1999/xhtml";const KM={svg:"http://www.w3.org/2000/svg",xhtml:Iw,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function jx(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),KM.hasOwnProperty(e)?{space:KM[e],local:n}:n}function hz(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Iw&&e.documentElement.namespaceURI===Iw?e.createElement(n):e.createElementNS(t,n)}}function fz(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Qk(n){var e=jx(n);return(e.local?fz:hz)(e)}function pz(){}function r1(n){return n==null?pz:function(){return this.querySelector(n)}}function mz(n){typeof n!="function"&&(n=r1(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],a=s.length,o=r[i]=new Array(a),l,u,h=0;h<a;++h)(l=s[h])&&(u=n.call(l,l.__data__,h,s))&&("__data__"in l&&(u.__data__=l.__data__),o[h]=u);return new es(r,this._parents)}function gz(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function xz(){return[]}function Jk(n){return n==null?xz:function(){return this.querySelectorAll(n)}}function yz(n){return function(){return gz(n.apply(this,arguments))}}function vz(n){typeof n=="function"?n=yz(n):n=Jk(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var a=e[s],o=a.length,l,u=0;u<o;++u)(l=a[u])&&(r.push(n.call(l,l.__data__,u,a)),i.push(l));return new es(r,i)}function eL(n){return function(){return this.matches(n)}}function tL(n){return function(e){return e.matches(n)}}var _z=Array.prototype.find;function bz(n){return function(){return _z.call(this.children,n)}}function wz(){return this.firstElementChild}function Sz(n){return this.select(n==null?wz:bz(typeof n=="function"?n:tL(n)))}var Tz=Array.prototype.filter;function Nz(){return Array.from(this.children)}function Ez(n){return function(){return Tz.call(this.children,n)}}function Mz(n){return this.selectAll(n==null?Nz:Ez(typeof n=="function"?n:tL(n)))}function Cz(n){typeof n!="function"&&(n=eL(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],a=s.length,o=r[i]=[],l,u=0;u<a;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&o.push(l);return new es(r,this._parents)}function nL(n){return new Array(n.length)}function Az(){return new es(this._enter||this._groups.map(nL),this._parents)}function Y0(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Y0.prototype={constructor:Y0,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Rz(n){return function(){return n}}function Pz(n,e,t,r,i,s){for(var a=0,o,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):t[a]=new Y0(n,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function kz(n,e,t,r,i,s,a){var o,l,u=new Map,h=e.length,p=s.length,m=new Array(h),g;for(o=0;o<h;++o)(l=e[o])&&(m[o]=g=a.call(l,l.__data__,o,e)+"",u.has(g)?i[o]=l:u.set(g,l));for(o=0;o<p;++o)g=a.call(n,s[o],o,s)+"",(l=u.get(g))?(r[o]=l,l.__data__=s[o],u.delete(g)):t[o]=new Y0(n,s[o]);for(o=0;o<h;++o)(l=e[o])&&u.get(m[o])===l&&(i[o]=l)}function Lz(n){return n.__data__}function Dz(n,e){if(!arguments.length)return Array.from(this,Lz);var t=e?kz:Pz,r=this._parents,i=this._groups;typeof n!="function"&&(n=Rz(n));for(var s=i.length,a=new Array(s),o=new Array(s),l=new Array(s),u=0;u<s;++u){var h=r[u],p=i[u],m=p.length,g=Iz(n.call(h,h&&h.__data__,u,r)),y=g.length,b=o[u]=new Array(y),_=a[u]=new Array(y),x=l[u]=new Array(m);t(h,p,b,_,x,g,e);for(var N=0,T=0,S,M;N<y;++N)if(S=b[N]){for(N>=T&&(T=N+1);!(M=_[T])&&++T<y;);S._next=M||null}}return a=new es(a,r),a._enter=o,a._exit=l,a}function Iz(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function jz(){return new es(this._exit||this._groups.map(nL),this._parents)}function Fz(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function Oz(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,a=Math.min(i,s),o=new Array(i),l=0;l<a;++l)for(var u=t[l],h=r[l],p=u.length,m=o[l]=new Array(p),g,y=0;y<p;++y)(g=u[y]||h[y])&&(m[y]=g);for(;l<i;++l)o[l]=t[l];return new es(o,this._parents)}function Uz(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],a;--i>=0;)(a=r[i])&&(s&&a.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(a,s),s=a);return this}function Bz(n){n||(n=zz);function e(p,m){return p&&m?n(p.__data__,m.__data__):!p-!m}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var a=t[s],o=a.length,l=i[s]=new Array(o),u,h=0;h<o;++h)(u=a[h])&&(l[h]=u);l.sort(e)}return new es(i,this._parents).order()}function zz(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function Vz(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function Gz(){return Array.from(this)}function Hz(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var a=r[i];if(a)return a}return null}function $z(){let n=0;for(const e of this)++n;return n}function Wz(){return!this.node()}function qz(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,a=i.length,o;s<a;++s)(o=i[s])&&n.call(o,o.__data__,s,i);return this}function Xz(n){return function(){this.removeAttribute(n)}}function Yz(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Kz(n,e){return function(){this.setAttribute(n,e)}}function Zz(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function Qz(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function Jz(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function e6(n,e){var t=jx(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?Yz:Xz:typeof e=="function"?t.local?Jz:Qz:t.local?Zz:Kz)(t,e))}function rL(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function t6(n){return function(){this.style.removeProperty(n)}}function n6(n,e,t){return function(){this.style.setProperty(n,e,t)}}function r6(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function i6(n,e,t){return arguments.length>1?this.each((e==null?t6:typeof e=="function"?r6:n6)(n,e,t??"")):md(this.node(),n)}function md(n,e){return n.style.getPropertyValue(e)||rL(n).getComputedStyle(n,null).getPropertyValue(e)}function s6(n){return function(){delete this[n]}}function a6(n,e){return function(){this[n]=e}}function o6(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function l6(n,e){return arguments.length>1?this.each((e==null?s6:typeof e=="function"?o6:a6)(n,e)):this.node()[n]}function iL(n){return n.trim().split(/^|\s+/)}function i1(n){return n.classList||new sL(n)}function sL(n){this._node=n,this._names=iL(n.getAttribute("class")||"")}sL.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function aL(n,e){for(var t=i1(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function oL(n,e){for(var t=i1(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function c6(n){return function(){aL(this,n)}}function u6(n){return function(){oL(this,n)}}function d6(n,e){return function(){(e.apply(this,arguments)?aL:oL)(this,n)}}function h6(n,e){var t=iL(n+"");if(arguments.length<2){for(var r=i1(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?d6:e?c6:u6)(t,e))}function f6(){this.textContent=""}function p6(n){return function(){this.textContent=n}}function m6(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function g6(n){return arguments.length?this.each(n==null?f6:(typeof n=="function"?m6:p6)(n)):this.node().textContent}function x6(){this.innerHTML=""}function y6(n){return function(){this.innerHTML=n}}function v6(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function _6(n){return arguments.length?this.each(n==null?x6:(typeof n=="function"?v6:y6)(n)):this.node().innerHTML}function b6(){this.nextSibling&&this.parentNode.appendChild(this)}function w6(){return this.each(b6)}function S6(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function T6(){return this.each(S6)}function N6(n){var e=typeof n=="function"?n:Qk(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function E6(){return null}function M6(n,e){var t=typeof n=="function"?n:Qk(n),r=e==null?E6:typeof e=="function"?e:r1(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function C6(){var n=this.parentNode;n&&n.removeChild(this)}function A6(){return this.each(C6)}function R6(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function P6(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function k6(n){return this.select(n?P6:R6)}function L6(n){return arguments.length?this.property("__data__",n):this.node().__data__}function D6(n){return function(e){n.call(this,e,this.__data__)}}function I6(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function j6(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function F6(n,e,t){return function(){var r=this.__on,i,s=D6(e);if(r){for(var a=0,o=r.length;a<o;++a)if((i=r[a]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function O6(n,e,t){var r=I6(n+""),i,s=r.length,a;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,h;l<u;++l)for(i=0,h=o[l];i<s;++i)if((a=r[i]).type===h.type&&a.name===h.name)return h.value}return}for(o=e?F6:j6,i=0;i<s;++i)this.each(o(r[i],e,t));return this}function lL(n,e,t){var r=rL(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function U6(n,e){return function(){return lL(this,n,e)}}function B6(n,e){return function(){return lL(this,n,e.apply(this,arguments))}}function z6(n,e){return this.each((typeof e=="function"?B6:U6)(n,e))}function*V6(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,a;i<s;++i)(a=r[i])&&(yield a)}var cL=[null];function es(n,e){this._groups=n,this._parents=e}function Hp(){return new es([[document.documentElement]],cL)}function G6(){return this}es.prototype=Hp.prototype={constructor:es,select:mz,selectAll:vz,selectChild:Sz,selectChildren:Mz,filter:Cz,data:Dz,enter:Az,exit:jz,join:Fz,merge:Oz,selection:G6,order:Uz,sort:Bz,call:Vz,nodes:Gz,node:Hz,size:$z,empty:Wz,each:qz,attr:e6,style:i6,property:l6,classed:h6,text:g6,html:_6,raise:w6,lower:T6,append:N6,insert:M6,remove:A6,clone:k6,datum:L6,on:O6,dispatch:z6,[Symbol.iterator]:V6};function qi(n){return typeof n=="string"?new es([[document.querySelector(n)]],[document.documentElement]):new es([[n]],cL)}function H6(n){let e;for(;e=n.sourceEvent;)n=e;return n}function us(n,e){if(n=H6(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop]}}return[n.pageX,n.pageY]}const $6={passive:!1},ep={capture:!0,passive:!1};function m_(n){n.stopImmediatePropagation()}function rd(n){n.preventDefault(),n.stopImmediatePropagation()}function uL(n){var e=n.document.documentElement,t=qi(n).on("dragstart.drag",rd,ep);"onselectstart"in e?t.on("selectstart.drag",rd,ep):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function dL(n,e){var t=n.document.documentElement,r=qi(n).on("dragstart.drag",null);e&&(r.on("click.drag",rd,ep),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const hg=n=>()=>n;function jw(n,{sourceEvent:e,subject:t,target:r,identifier:i,active:s,x:a,y:o,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}jw.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function W6(n){return!n.ctrlKey&&!n.button}function q6(){return this.parentNode}function X6(n,e){return e??{x:n.x,y:n.y}}function Y6(){return navigator.maxTouchPoints||"ontouchstart"in this}function K6(){var n=W6,e=q6,t=X6,r=Y6,i={},s=Gp("start","drag","end"),a=0,o,l,u,h,p=0;function m(S){S.on("mousedown.drag",g).filter(r).on("touchstart.drag",_).on("touchmove.drag",x,$6).on("touchend.drag touchcancel.drag",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(S,M){if(!(h||!n.call(this,S,M))){var C=T(this,e.call(this,S,M),S,M,"mouse");C&&(qi(S.view).on("mousemove.drag",y,ep).on("mouseup.drag",b,ep),uL(S.view),m_(S),u=!1,o=S.clientX,l=S.clientY,C("start",S))}}function y(S){if(rd(S),!u){var M=S.clientX-o,C=S.clientY-l;u=M*M+C*C>p}i.mouse("drag",S)}function b(S){qi(S.view).on("mousemove.drag mouseup.drag",null),dL(S.view,u),rd(S),i.mouse("end",S)}function _(S,M){if(n.call(this,S,M)){var C=S.changedTouches,R=e.call(this,S,M),F=C.length,k,D;for(k=0;k<F;++k)(D=T(this,R,S,M,C[k].identifier,C[k]))&&(m_(S),D("start",S,C[k]))}}function x(S){var M=S.changedTouches,C=M.length,R,F;for(R=0;R<C;++R)(F=i[M[R].identifier])&&(rd(S),F("drag",S,M[R]))}function N(S){var M=S.changedTouches,C=M.length,R,F;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),R=0;R<C;++R)(F=i[M[R].identifier])&&(m_(S),F("end",S,M[R]))}function T(S,M,C,R,F,k){var D=s.copy(),P=us(k||C,M),G,$,U;if((U=t.call(S,new jw("beforestart",{sourceEvent:C,target:m,identifier:F,active:a,x:P[0],y:P[1],dx:0,dy:0,dispatch:D}),R))!=null)return G=U.x-P[0]||0,$=U.y-P[1]||0,function K(O,j,L){var B=P,V;switch(O){case"start":i[F]=K,V=a++;break;case"end":delete i[F],--a;case"drag":P=us(L||j,M),V=a;break}D.call(O,S,new jw(O,{sourceEvent:j,subject:U,target:m,identifier:F,active:V,x:P[0]+G,y:P[1]+$,dx:P[0]-B[0],dy:P[1]-B[1],dispatch:D}),R)}}return m.filter=function(S){return arguments.length?(n=typeof S=="function"?S:hg(!!S),m):n},m.container=function(S){return arguments.length?(e=typeof S=="function"?S:hg(S),m):e},m.subject=function(S){return arguments.length?(t=typeof S=="function"?S:hg(S),m):t},m.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:hg(!!S),m):r},m.on=function(){var S=s.on.apply(s,arguments);return S===s?m:S},m.clickDistance=function(S){return arguments.length?(p=(S=+S)*S,m):Math.sqrt(p)},m}function s1(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function hL(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function $p(){}var tp=.7,K0=1/tp,id="\\s*([+-]?\\d+)\\s*",np="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",fa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Z6=/^#([0-9a-f]{3,8})$/,Q6=new RegExp(`^rgb\\(${id},${id},${id}\\)$`),J6=new RegExp(`^rgb\\(${fa},${fa},${fa}\\)$`),eV=new RegExp(`^rgba\\(${id},${id},${id},${np}\\)$`),tV=new RegExp(`^rgba\\(${fa},${fa},${fa},${np}\\)$`),nV=new RegExp(`^hsl\\(${np},${fa},${fa}\\)$`),rV=new RegExp(`^hsla\\(${np},${fa},${fa},${np}\\)$`),ZM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};s1($p,rp,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:QM,formatHex:QM,formatHex8:iV,formatHsl:sV,formatRgb:JM,toString:JM});function QM(){return this.rgb().formatHex()}function iV(){return this.rgb().formatHex8()}function sV(){return fL(this).formatHsl()}function JM(){return this.rgb().formatRgb()}function rp(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=Z6.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?eC(e):t===3?new Ni(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?fg(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?fg(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Q6.exec(n))?new Ni(e[1],e[2],e[3],1):(e=J6.exec(n))?new Ni(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=eV.exec(n))?fg(e[1],e[2],e[3],e[4]):(e=tV.exec(n))?fg(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=nV.exec(n))?rC(e[1],e[2]/100,e[3]/100,1):(e=rV.exec(n))?rC(e[1],e[2]/100,e[3]/100,e[4]):ZM.hasOwnProperty(n)?eC(ZM[n]):n==="transparent"?new Ni(NaN,NaN,NaN,0):null}function eC(n){return new Ni(n>>16&255,n>>8&255,n&255,1)}function fg(n,e,t,r){return r<=0&&(n=e=t=NaN),new Ni(n,e,t,r)}function aV(n){return n instanceof $p||(n=rp(n)),n?(n=n.rgb(),new Ni(n.r,n.g,n.b,n.opacity)):new Ni}function Fw(n,e,t,r){return arguments.length===1?aV(n):new Ni(n,e,t,r??1)}function Ni(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}s1(Ni,Fw,hL($p,{brighter(n){return n=n==null?K0:Math.pow(K0,n),new Ni(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?tp:Math.pow(tp,n),new Ni(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Ni(mc(this.r),mc(this.g),mc(this.b),Z0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tC,formatHex:tC,formatHex8:oV,formatRgb:nC,toString:nC}));function tC(){return`#${hc(this.r)}${hc(this.g)}${hc(this.b)}`}function oV(){return`#${hc(this.r)}${hc(this.g)}${hc(this.b)}${hc((isNaN(this.opacity)?1:this.opacity)*255)}`}function nC(){const n=Z0(this.opacity);return`${n===1?"rgb(":"rgba("}${mc(this.r)}, ${mc(this.g)}, ${mc(this.b)}${n===1?")":`, ${n})`}`}function Z0(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function mc(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function hc(n){return n=mc(n),(n<16?"0":"")+n.toString(16)}function rC(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Os(n,e,t,r)}function fL(n){if(n instanceof Os)return new Os(n.h,n.s,n.l,n.opacity);if(n instanceof $p||(n=rp(n)),!n)return new Os;if(n instanceof Os)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),a=NaN,o=s-i,l=(s+i)/2;return o?(e===s?a=(t-r)/o+(t<r)*6:t===s?a=(r-e)/o+2:a=(e-t)/o+4,o/=l<.5?s+i:2-s-i,a*=60):o=l>0&&l<1?0:a,new Os(a,o,l,n.opacity)}function lV(n,e,t,r){return arguments.length===1?fL(n):new Os(n,e,t,r??1)}function Os(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}s1(Os,lV,hL($p,{brighter(n){return n=n==null?K0:Math.pow(K0,n),new Os(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?tp:Math.pow(tp,n),new Os(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Ni(g_(n>=240?n-240:n+120,i,r),g_(n,i,r),g_(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Os(iC(this.h),pg(this.s),pg(this.l),Z0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Z0(this.opacity);return`${n===1?"hsl(":"hsla("}${iC(this.h)}, ${pg(this.s)*100}%, ${pg(this.l)*100}%${n===1?")":`, ${n})`}`}}));function iC(n){return n=(n||0)%360,n<0?n+360:n}function pg(n){return Math.max(0,Math.min(1,n||0))}function g_(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const pL=n=>()=>n;function cV(n,e){return function(t){return n+t*e}}function uV(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function dV(n){return(n=+n)==1?mL:function(e,t){return t-e?uV(e,t,n):pL(isNaN(e)?t:e)}}function mL(n,e){var t=e-n;return t?cV(n,t):pL(isNaN(n)?e:n)}const sC=function n(e){var t=dV(e);function r(i,s){var a=t((i=Fw(i)).r,(s=Fw(s)).r),o=t(i.g,s.g),l=t(i.b,s.b),u=mL(i.opacity,s.opacity);return function(h){return i.r=a(h),i.g=o(h),i.b=l(h),i.opacity=u(h),i+""}}return r.gamma=n,r}(1);function rl(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var Ow=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,x_=new RegExp(Ow.source,"g");function hV(n){return function(){return n}}function fV(n){return function(e){return n(e)+""}}function pV(n,e){var t=Ow.lastIndex=x_.lastIndex=0,r,i,s,a=-1,o=[],l=[];for(n=n+"",e=e+"";(r=Ow.exec(n))&&(i=x_.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),o[a]?o[a]+=s:o[++a]=s),(r=r[0])===(i=i[0])?o[a]?o[a]+=i:o[++a]=i:(o[++a]=null,l.push({i:a,x:rl(r,i)})),t=x_.lastIndex;return t<e.length&&(s=e.slice(t),o[a]?o[a]+=s:o[++a]=s),o.length<2?l[0]?fV(l[0].x):hV(e):(e=l.length,function(u){for(var h=0,p;h<e;++h)o[(p=l[h]).i]=p.x(u);return o.join("")})}var aC=180/Math.PI,Uw={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function gL(n,e,t,r,i,s){var a,o,l;return(a=Math.sqrt(n*n+e*e))&&(n/=a,e/=a),(l=n*t+e*r)&&(t-=n*l,r-=e*l),(o=Math.sqrt(t*t+r*r))&&(t/=o,r/=o,l/=o),n*r<e*t&&(n=-n,e=-e,l=-l,a=-a),{translateX:i,translateY:s,rotate:Math.atan2(e,n)*aC,skewX:Math.atan(l)*aC,scaleX:a,scaleY:o}}var mg;function mV(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?Uw:gL(e.a,e.b,e.c,e.d,e.e,e.f)}function gV(n){return n==null||(mg||(mg=document.createElementNS("http://www.w3.org/2000/svg","g")),mg.setAttribute("transform",n),!(n=mg.transform.baseVal.consolidate()))?Uw:(n=n.matrix,gL(n.a,n.b,n.c,n.d,n.e,n.f))}function xL(n,e,t,r){function i(u){return u.length?u.pop()+" ":""}function s(u,h,p,m,g,y){if(u!==p||h!==m){var b=g.push("translate(",null,e,null,t);y.push({i:b-4,x:rl(u,p)},{i:b-2,x:rl(h,m)})}else(p||m)&&g.push("translate("+p+e+m+t)}function a(u,h,p,m){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),m.push({i:p.push(i(p)+"rotate(",null,r)-2,x:rl(u,h)})):h&&p.push(i(p)+"rotate("+h+r)}function o(u,h,p,m){u!==h?m.push({i:p.push(i(p)+"skewX(",null,r)-2,x:rl(u,h)}):h&&p.push(i(p)+"skewX("+h+r)}function l(u,h,p,m,g,y){if(u!==p||h!==m){var b=g.push(i(g)+"scale(",null,",",null,")");y.push({i:b-4,x:rl(u,p)},{i:b-2,x:rl(h,m)})}else(p!==1||m!==1)&&g.push(i(g)+"scale("+p+","+m+")")}return function(u,h){var p=[],m=[];return u=n(u),h=n(h),s(u.translateX,u.translateY,h.translateX,h.translateY,p,m),a(u.rotate,h.rotate,p,m),o(u.skewX,h.skewX,p,m),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,p,m),u=h=null,function(g){for(var y=-1,b=m.length,_;++y<b;)p[(_=m[y]).i]=_.x(g);return p.join("")}}}var xV=xL(mV,"px, ","px)","deg)"),yV=xL(gV,", ",")",")"),vV=1e-12;function oC(n){return((n=Math.exp(n))+1/n)/2}function _V(n){return((n=Math.exp(n))-1/n)/2}function bV(n){return((n=Math.exp(2*n))-1)/(n+1)}const wV=function n(e,t,r){function i(s,a){var o=s[0],l=s[1],u=s[2],h=a[0],p=a[1],m=a[2],g=h-o,y=p-l,b=g*g+y*y,_,x;if(b<vV)x=Math.log(m/u)/e,_=function(R){return[o+R*g,l+R*y,u*Math.exp(e*R*x)]};else{var N=Math.sqrt(b),T=(m*m-u*u+r*b)/(2*u*t*N),S=(m*m-u*u-r*b)/(2*m*t*N),M=Math.log(Math.sqrt(T*T+1)-T),C=Math.log(Math.sqrt(S*S+1)-S);x=(C-M)/e,_=function(R){var F=R*x,k=oC(M),D=u/(t*N)*(k*bV(e*F+M)-_V(M));return[o+D*g,l+D*y,u*k/oC(e*F+M)]}}return _.duration=x*1e3*e/Math.SQRT2,_}return i.rho=function(s){var a=Math.max(.001,+s),o=a*a,l=o*o;return n(a,o,l)},i}(Math.SQRT2,2,4);var gd=0,Cf=0,qh=0,yL=1e3,Q0,Af,J0=0,Sc=0,Fx=0,ip=typeof performance=="object"&&performance.now?performance:Date,vL=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function a1(){return Sc||(vL(SV),Sc=ip.now()+Fx)}function SV(){Sc=0}function ex(){this._call=this._time=this._next=null}ex.prototype=o1.prototype={constructor:ex,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?a1():+t)+(e==null?0:+e),!this._next&&Af!==this&&(Af?Af._next=this:Q0=this,Af=this),this._call=n,this._time=t,Bw()},stop:function(){this._call&&(this._call=null,this._time=1/0,Bw())}};function o1(n,e,t){var r=new ex;return r.restart(n,e,t),r}function TV(){a1(),++gd;for(var n=Q0,e;n;)(e=Sc-n._time)>=0&&n._call.call(void 0,e),n=n._next;--gd}function lC(){Sc=(J0=ip.now())+Fx,gd=Cf=0;try{TV()}finally{gd=0,EV(),Sc=0}}function NV(){var n=ip.now(),e=n-J0;e>yL&&(Fx-=e,J0=n)}function EV(){for(var n,e=Q0,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Q0=t);Af=n,Bw(r)}function Bw(n){if(!gd){Cf&&(Cf=clearTimeout(Cf));var e=n-Sc;e>24?(n<1/0&&(Cf=setTimeout(lC,n-ip.now()-Fx)),qh&&(qh=clearInterval(qh))):(qh||(J0=ip.now(),qh=setInterval(NV,yL)),gd=1,vL(lC))}}function cC(n,e,t){var r=new ex;return e=e==null?0:+e,r.restart(i=>{r.stop(),n(i+e)},e,t),r}var MV=Gp("start","end","cancel","interrupt"),CV=[],_L=0,uC=1,zw=2,k0=3,dC=4,Vw=5,L0=6;function Ox(n,e,t,r,i,s){var a=n.__transition;if(!a)n.__transition={};else if(t in a)return;AV(n,t,{name:e,index:r,group:i,on:MV,tween:CV,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:_L})}function l1(n,e){var t=Ws(n,e);if(t.state>_L)throw new Error("too late; already scheduled");return t}function Ta(n,e){var t=Ws(n,e);if(t.state>k0)throw new Error("too late; already running");return t}function Ws(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function AV(n,e,t){var r=n.__transition,i;r[e]=t,t.timer=o1(s,0,t.time);function s(u){t.state=uC,t.timer.restart(a,t.delay,t.time),t.delay<=u&&a(u-t.delay)}function a(u){var h,p,m,g;if(t.state!==uC)return l();for(h in r)if(g=r[h],g.name===t.name){if(g.state===k0)return cC(a);g.state===dC?(g.state=L0,g.timer.stop(),g.on.call("interrupt",n,n.__data__,g.index,g.group),delete r[h]):+h<e&&(g.state=L0,g.timer.stop(),g.on.call("cancel",n,n.__data__,g.index,g.group),delete r[h])}if(cC(function(){t.state===k0&&(t.state=dC,t.timer.restart(o,t.delay,t.time),o(u))}),t.state=zw,t.on.call("start",n,n.__data__,t.index,t.group),t.state===zw){for(t.state=k0,i=new Array(m=t.tween.length),h=0,p=-1;h<m;++h)(g=t.tween[h].value.call(n,n.__data__,t.index,t.group))&&(i[++p]=g);i.length=p+1}}function o(u){for(var h=u<t.duration?t.ease.call(null,u/t.duration):(t.timer.restart(l),t.state=Vw,1),p=-1,m=i.length;++p<m;)i[p].call(n,h);t.state===Vw&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=L0,t.timer.stop(),delete r[e];for(var u in r)return;delete n.__transition}}function D0(n,e){var t=n.__transition,r,i,s=!0,a;if(t){e=e==null?null:e+"";for(a in t){if((r=t[a]).name!==e){s=!1;continue}i=r.state>zw&&r.state<Vw,r.state=L0,r.timer.stop(),r.on.call(i?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[a]}s&&delete n.__transition}}function RV(n){return this.each(function(){D0(this,n)})}function PV(n,e){var t,r;return function(){var i=Ta(this,n),s=i.tween;if(s!==t){r=t=s;for(var a=0,o=r.length;a<o;++a)if(r[a].name===e){r=r.slice(),r.splice(a,1);break}}i.tween=r}}function kV(n,e,t){var r,i;if(typeof t!="function")throw new Error;return function(){var s=Ta(this,n),a=s.tween;if(a!==r){i=(r=a).slice();for(var o={name:e,value:t},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=o;break}l===u&&i.push(o)}s.tween=i}}function LV(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=Ws(this.node(),t).tween,i=0,s=r.length,a;i<s;++i)if((a=r[i]).name===n)return a.value;return null}return this.each((e==null?PV:kV)(t,n,e))}function c1(n,e,t){var r=n._id;return n.each(function(){var i=Ta(this,r);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return Ws(i,r).value[e]}}function bL(n,e){var t;return(typeof e=="number"?rl:e instanceof rp?sC:(t=rp(e))?(e=t,sC):pV)(n,e)}function DV(n){return function(){this.removeAttribute(n)}}function IV(n){return function(){this.removeAttributeNS(n.space,n.local)}}function jV(n,e,t){var r,i=t+"",s;return function(){var a=this.getAttribute(n);return a===i?null:a===r?s:s=e(r=a,t)}}function FV(n,e,t){var r,i=t+"",s;return function(){var a=this.getAttributeNS(n.space,n.local);return a===i?null:a===r?s:s=e(r=a,t)}}function OV(n,e,t){var r,i,s;return function(){var a,o=t(this),l;return o==null?void this.removeAttribute(n):(a=this.getAttribute(n),l=o+"",a===l?null:a===r&&l===i?s:(i=l,s=e(r=a,o)))}}function UV(n,e,t){var r,i,s;return function(){var a,o=t(this),l;return o==null?void this.removeAttributeNS(n.space,n.local):(a=this.getAttributeNS(n.space,n.local),l=o+"",a===l?null:a===r&&l===i?s:(i=l,s=e(r=a,o)))}}function BV(n,e){var t=jx(n),r=t==="transform"?yV:bL;return this.attrTween(n,typeof e=="function"?(t.local?UV:OV)(t,r,c1(this,"attr."+n,e)):e==null?(t.local?IV:DV)(t):(t.local?FV:jV)(t,r,e))}function zV(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function VV(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function GV(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&VV(n,s)),t}return i._value=e,i}function HV(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&zV(n,s)),t}return i._value=e,i}function $V(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=jx(n);return this.tween(t,(r.local?GV:HV)(r,e))}function WV(n,e){return function(){l1(this,n).delay=+e.apply(this,arguments)}}function qV(n,e){return e=+e,function(){l1(this,n).delay=e}}function XV(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?WV:qV)(e,n)):Ws(this.node(),e).delay}function YV(n,e){return function(){Ta(this,n).duration=+e.apply(this,arguments)}}function KV(n,e){return e=+e,function(){Ta(this,n).duration=e}}function ZV(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?YV:KV)(e,n)):Ws(this.node(),e).duration}function QV(n,e){if(typeof e!="function")throw new Error;return function(){Ta(this,n).ease=e}}function JV(n){var e=this._id;return arguments.length?this.each(QV(e,n)):Ws(this.node(),e).ease}function e8(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Ta(this,n).ease=t}}function t8(n){if(typeof n!="function")throw new Error;return this.each(e8(this._id,n))}function n8(n){typeof n!="function"&&(n=eL(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],a=s.length,o=r[i]=[],l,u=0;u<a;++u)(l=s[u])&&n.call(l,l.__data__,u,s)&&o.push(l);return new mo(r,this._parents,this._name,this._id)}function r8(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,i=t.length,s=Math.min(r,i),a=new Array(r),o=0;o<s;++o)for(var l=e[o],u=t[o],h=l.length,p=a[o]=new Array(h),m,g=0;g<h;++g)(m=l[g]||u[g])&&(p[g]=m);for(;o<r;++o)a[o]=e[o];return new mo(a,this._parents,this._name,this._id)}function i8(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function s8(n,e,t){var r,i,s=i8(e)?l1:Ta;return function(){var a=s(this,n),o=a.on;o!==r&&(i=(r=o).copy()).on(e,t),a.on=i}}function a8(n,e){var t=this._id;return arguments.length<2?Ws(this.node(),t).on.on(n):this.each(s8(t,n,e))}function o8(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function l8(){return this.on("end.remove",o8(this._id))}function c8(n){var e=this._name,t=this._id;typeof n!="function"&&(n=r1(n));for(var r=this._groups,i=r.length,s=new Array(i),a=0;a<i;++a)for(var o=r[a],l=o.length,u=s[a]=new Array(l),h,p,m=0;m<l;++m)(h=o[m])&&(p=n.call(h,h.__data__,m,o))&&("__data__"in h&&(p.__data__=h.__data__),u[m]=p,Ox(u[m],e,t,m,u,Ws(h,t)));return new mo(s,this._parents,e,t)}function u8(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Jk(n));for(var r=this._groups,i=r.length,s=[],a=[],o=0;o<i;++o)for(var l=r[o],u=l.length,h,p=0;p<u;++p)if(h=l[p]){for(var m=n.call(h,h.__data__,p,l),g,y=Ws(h,t),b=0,_=m.length;b<_;++b)(g=m[b])&&Ox(g,e,t,b,m,y);s.push(m),a.push(h)}return new mo(s,a,e,t)}var d8=Hp.prototype.constructor;function h8(){return new d8(this._groups,this._parents)}function f8(n,e){var t,r,i;return function(){var s=md(this,n),a=(this.style.removeProperty(n),md(this,n));return s===a?null:s===t&&a===r?i:i=e(t=s,r=a)}}function wL(n){return function(){this.style.removeProperty(n)}}function p8(n,e,t){var r,i=t+"",s;return function(){var a=md(this,n);return a===i?null:a===r?s:s=e(r=a,t)}}function m8(n,e,t){var r,i,s;return function(){var a=md(this,n),o=t(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(n),md(this,n))),a===l?null:a===r&&l===i?s:(i=l,s=e(r=a,o))}}function g8(n,e){var t,r,i,s="style."+e,a="end."+s,o;return function(){var l=Ta(this,n),u=l.on,h=l.value[s]==null?o||(o=wL(e)):void 0;(u!==t||i!==h)&&(r=(t=u).copy()).on(a,i=h),l.on=r}}function x8(n,e,t){var r=(n+="")=="transform"?xV:bL;return e==null?this.styleTween(n,f8(n,r)).on("end.style."+n,wL(n)):typeof e=="function"?this.styleTween(n,m8(n,r,c1(this,"style."+n,e))).each(g8(this._id,n)):this.styleTween(n,p8(n,r,e),t).on("end.style."+n,null)}function y8(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function v8(n,e,t){var r,i;function s(){var a=e.apply(this,arguments);return a!==i&&(r=(i=a)&&y8(n,a,t)),r}return s._value=e,s}function _8(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,v8(n,e,t??""))}function b8(n){return function(){this.textContent=n}}function w8(n){return function(){var e=n(this);this.textContent=e??""}}function S8(n){return this.tween("text",typeof n=="function"?w8(c1(this,"text",n)):b8(n==null?"":n+""))}function T8(n){return function(e){this.textContent=n.call(this,e)}}function N8(n){var e,t;function r(){var i=n.apply(this,arguments);return i!==t&&(e=(t=i)&&T8(i)),e}return r._value=n,r}function E8(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,N8(n))}function M8(){for(var n=this._name,e=this._id,t=SL(),r=this._groups,i=r.length,s=0;s<i;++s)for(var a=r[s],o=a.length,l,u=0;u<o;++u)if(l=a[u]){var h=Ws(l,e);Ox(l,n,t,u,a,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new mo(r,this._parents,n,t)}function C8(){var n,e,t=this,r=t._id,i=t.size();return new Promise(function(s,a){var o={value:a},l={value:function(){--i===0&&s()}};t.each(function(){var u=Ta(this,r),h=u.on;h!==n&&(e=(n=h).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),u.on=e}),i===0&&s()})}var A8=0;function mo(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function SL(){return++A8}var Fa=Hp.prototype;mo.prototype={constructor:mo,select:c8,selectAll:u8,selectChild:Fa.selectChild,selectChildren:Fa.selectChildren,filter:n8,merge:r8,selection:h8,transition:M8,call:Fa.call,nodes:Fa.nodes,node:Fa.node,size:Fa.size,empty:Fa.empty,each:Fa.each,on:a8,attr:BV,attrTween:$V,style:x8,styleTween:_8,text:S8,textTween:E8,remove:l8,tween:LV,delay:XV,duration:ZV,ease:JV,easeVarying:t8,end:C8,[Symbol.iterator]:Fa[Symbol.iterator]};function R8(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var P8={time:null,delay:0,duration:250,ease:R8};function k8(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function L8(n){var e,t;n instanceof mo?(e=n._id,n=n._name):(e=SL(),(t=P8).time=a1(),n=n==null?null:n+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var a=r[s],o=a.length,l,u=0;u<o;++u)(l=a[u])&&Ox(l,n,e,u,a,t||k8(l,e));return new mo(r,this._parents,n,e)}Hp.prototype.interrupt=RV;Hp.prototype.transition=L8;const gg=n=>()=>n;function D8(n,{sourceEvent:e,target:t,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Ja(n,e,t){this.k=n,this.x=e,this.y=t}Ja.prototype={constructor:Ja,scale:function(n){return n===1?this:new Ja(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new Ja(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ao=new Ja(1,0,0);Ja.prototype;function y_(n){n.stopImmediatePropagation()}function Xh(n){n.preventDefault(),n.stopImmediatePropagation()}function I8(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function j8(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function hC(){return this.__zoom||ao}function F8(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function O8(){return navigator.maxTouchPoints||"ontouchstart"in this}function U8(n,e,t){var r=n.invertX(e[0][0])-t[0][0],i=n.invertX(e[1][0])-t[1][0],s=n.invertY(e[0][1])-t[0][1],a=n.invertY(e[1][1])-t[1][1];return n.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>s?(s+a)/2:Math.min(0,s)||Math.max(0,a))}function TL(){var n=I8,e=j8,t=U8,r=F8,i=O8,s=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],o=250,l=wV,u=Gp("start","zoom","end"),h,p,m,g=500,y=150,b=0,_=10;function x(U){U.property("__zoom",hC).on("wheel.zoom",F,{passive:!1}).on("mousedown.zoom",k).on("dblclick.zoom",D).filter(i).on("touchstart.zoom",P).on("touchmove.zoom",G).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(U,K,O,j){var L=U.selection?U.selection():U;L.property("__zoom",hC),U!==L?M(U,K,O,j):L.interrupt().each(function(){C(this,arguments).event(j).start().zoom(null,typeof K=="function"?K.apply(this,arguments):K).end()})},x.scaleBy=function(U,K,O,j){x.scaleTo(U,function(){var L=this.__zoom.k,B=typeof K=="function"?K.apply(this,arguments):K;return L*B},O,j)},x.scaleTo=function(U,K,O,j){x.transform(U,function(){var L=e.apply(this,arguments),B=this.__zoom,V=O==null?S(L):typeof O=="function"?O.apply(this,arguments):O,z=B.invert(V),Y=typeof K=="function"?K.apply(this,arguments):K;return t(T(N(B,Y),V,z),L,a)},O,j)},x.translateBy=function(U,K,O,j){x.transform(U,function(){return t(this.__zoom.translate(typeof K=="function"?K.apply(this,arguments):K,typeof O=="function"?O.apply(this,arguments):O),e.apply(this,arguments),a)},null,j)},x.translateTo=function(U,K,O,j,L){x.transform(U,function(){var B=e.apply(this,arguments),V=this.__zoom,z=j==null?S(B):typeof j=="function"?j.apply(this,arguments):j;return t(ao.translate(z[0],z[1]).scale(V.k).translate(typeof K=="function"?-K.apply(this,arguments):-K,typeof O=="function"?-O.apply(this,arguments):-O),B,a)},j,L)};function N(U,K){return K=Math.max(s[0],Math.min(s[1],K)),K===U.k?U:new Ja(K,U.x,U.y)}function T(U,K,O){var j=K[0]-O[0]*U.k,L=K[1]-O[1]*U.k;return j===U.x&&L===U.y?U:new Ja(U.k,j,L)}function S(U){return[(+U[0][0]+ +U[1][0])/2,(+U[0][1]+ +U[1][1])/2]}function M(U,K,O,j){U.on("start.zoom",function(){C(this,arguments).event(j).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(j).end()}).tween("zoom",function(){var L=this,B=arguments,V=C(L,B).event(j),z=e.apply(L,B),Y=O==null?S(z):typeof O=="function"?O.apply(L,B):O,se=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),J=L.__zoom,q=typeof K=="function"?K.apply(L,B):K,Q=l(J.invert(Y).concat(se/J.k),q.invert(Y).concat(se/q.k));return function(te){if(te===1)te=q;else{var X=Q(te),ce=se/X[2];te=new Ja(ce,Y[0]-X[0]*ce,Y[1]-X[1]*ce)}V.zoom(null,te)}})}function C(U,K,O){return!O&&U.__zooming||new R(U,K)}function R(U,K){this.that=U,this.args=K,this.active=0,this.sourceEvent=null,this.extent=e.apply(U,K),this.taps=0}R.prototype={event:function(U){return U&&(this.sourceEvent=U),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(U,K){return this.mouse&&U!=="mouse"&&(this.mouse[1]=K.invert(this.mouse[0])),this.touch0&&U!=="touch"&&(this.touch0[1]=K.invert(this.touch0[0])),this.touch1&&U!=="touch"&&(this.touch1[1]=K.invert(this.touch1[0])),this.that.__zoom=K,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(U){var K=qi(this.that).datum();u.call(U,this.that,new D8(U,{sourceEvent:this.sourceEvent,target:x,transform:this.that.__zoom,dispatch:u}),K)}};function F(U,...K){if(!n.apply(this,arguments))return;var O=C(this,K).event(U),j=this.__zoom,L=Math.max(s[0],Math.min(s[1],j.k*Math.pow(2,r.apply(this,arguments)))),B=us(U);if(O.wheel)(O.mouse[0][0]!==B[0]||O.mouse[0][1]!==B[1])&&(O.mouse[1]=j.invert(O.mouse[0]=B)),clearTimeout(O.wheel);else{if(j.k===L)return;O.mouse=[B,j.invert(B)],D0(this),O.start()}Xh(U),O.wheel=setTimeout(V,y),O.zoom("mouse",t(T(N(j,L),O.mouse[0],O.mouse[1]),O.extent,a));function V(){O.wheel=null,O.end()}}function k(U,...K){if(m||!n.apply(this,arguments))return;var O=U.currentTarget,j=C(this,K,!0).event(U),L=qi(U.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",se,!0),B=us(U,O),V=U.clientX,z=U.clientY;uL(U.view),y_(U),j.mouse=[B,this.__zoom.invert(B)],D0(this),j.start();function Y(J){if(Xh(J),!j.moved){var q=J.clientX-V,Q=J.clientY-z;j.moved=q*q+Q*Q>b}j.event(J).zoom("mouse",t(T(j.that.__zoom,j.mouse[0]=us(J,O),j.mouse[1]),j.extent,a))}function se(J){L.on("mousemove.zoom mouseup.zoom",null),dL(J.view,j.moved),Xh(J),j.event(J).end()}}function D(U,...K){if(n.apply(this,arguments)){var O=this.__zoom,j=us(U.changedTouches?U.changedTouches[0]:U,this),L=O.invert(j),B=O.k*(U.shiftKey?.5:2),V=t(T(N(O,B),j,L),e.apply(this,K),a);Xh(U),o>0?qi(this).transition().duration(o).call(M,V,j,U):qi(this).call(x.transform,V,j,U)}}function P(U,...K){if(n.apply(this,arguments)){var O=U.touches,j=O.length,L=C(this,K,U.changedTouches.length===j).event(U),B,V,z,Y;for(y_(U),V=0;V<j;++V)z=O[V],Y=us(z,this),Y=[Y,this.__zoom.invert(Y),z.identifier],L.touch0?!L.touch1&&L.touch0[2]!==Y[2]&&(L.touch1=Y,L.taps=0):(L.touch0=Y,B=!0,L.taps=1+!!h);h&&(h=clearTimeout(h)),B&&(L.taps<2&&(p=Y[0],h=setTimeout(function(){h=null},g)),D0(this),L.start())}}function G(U,...K){if(this.__zooming){var O=C(this,K).event(U),j=U.changedTouches,L=j.length,B,V,z,Y;for(Xh(U),B=0;B<L;++B)V=j[B],z=us(V,this),O.touch0&&O.touch0[2]===V.identifier?O.touch0[0]=z:O.touch1&&O.touch1[2]===V.identifier&&(O.touch1[0]=z);if(V=O.that.__zoom,O.touch1){var se=O.touch0[0],J=O.touch0[1],q=O.touch1[0],Q=O.touch1[1],te=(te=q[0]-se[0])*te+(te=q[1]-se[1])*te,X=(X=Q[0]-J[0])*X+(X=Q[1]-J[1])*X;V=N(V,Math.sqrt(te/X)),z=[(se[0]+q[0])/2,(se[1]+q[1])/2],Y=[(J[0]+Q[0])/2,(J[1]+Q[1])/2]}else if(O.touch0)z=O.touch0[0],Y=O.touch0[1];else return;O.zoom("touch",t(T(V,z,Y),O.extent,a))}}function $(U,...K){if(this.__zooming){var O=C(this,K).event(U),j=U.changedTouches,L=j.length,B,V;for(y_(U),m&&clearTimeout(m),m=setTimeout(function(){m=null},g),B=0;B<L;++B)V=j[B],O.touch0&&O.touch0[2]===V.identifier?delete O.touch0:O.touch1&&O.touch1[2]===V.identifier&&delete O.touch1;if(O.touch1&&!O.touch0&&(O.touch0=O.touch1,delete O.touch1),O.touch0)O.touch0[1]=this.__zoom.invert(O.touch0[0]);else if(O.end(),O.taps===2&&(V=us(V,this),Math.hypot(p[0]-V[0],p[1]-V[1])<_)){var z=qi(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return x.wheelDelta=function(U){return arguments.length?(r=typeof U=="function"?U:gg(+U),x):r},x.filter=function(U){return arguments.length?(n=typeof U=="function"?U:gg(!!U),x):n},x.touchable=function(U){return arguments.length?(i=typeof U=="function"?U:gg(!!U),x):i},x.extent=function(U){return arguments.length?(e=typeof U=="function"?U:gg([[+U[0][0],+U[0][1]],[+U[1][0],+U[1][1]]]),x):e},x.scaleExtent=function(U){return arguments.length?(s[0]=+U[0],s[1]=+U[1],x):[s[0],s[1]]},x.translateExtent=function(U){return arguments.length?(a[0][0]=+U[0][0],a[1][0]=+U[1][0],a[0][1]=+U[0][1],a[1][1]=+U[1][1],x):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},x.constrain=function(U){return arguments.length?(t=U,x):t},x.duration=function(U){return arguments.length?(o=+U,x):o},x.interpolate=function(U){return arguments.length?(l=U,x):l},x.on=function(){var U=u.on.apply(u,arguments);return U===u?x:U},x.clickDistance=function(U){return arguments.length?(b=(U=+U)*U,x):Math.sqrt(b)},x.tapDistance=function(U){return arguments.length?(_=+U,x):_},x}const Ux=E.createContext(null),B8=Ux.Provider,go={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:n=>`Node type "${n}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:n=>`The old edge with id=${n} does not exist.`,error009:n=>`Marker type "${n}" doesn't exist.`,error008:(n,e)=>`Couldn't create edge for ${n?"target":"source"} handle id: "${n?e.targetHandle:e.sourceHandle}", edge id: ${e.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:n=>`Edge type "${n}" not found. Using fallback type "default".`,error012:n=>`Node with id "${n}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},NL=go.error001();function Rn(n,e){const t=E.useContext(Ux);if(t===null)throw new Error(NL);return Zk(t,n,e)}const yr=()=>{const n=E.useContext(Ux);if(n===null)throw new Error(NL);return E.useMemo(()=>({getState:n.getState,setState:n.setState,subscribe:n.subscribe,destroy:n.destroy}),[n])},z8=n=>n.userSelectionActive?"none":"all";function Bx({position:n,children:e,className:t,style:r,...i}){const s=Rn(z8),a=`${n}`.split("-");return we.createElement("div",{className:Or(["react-flow__panel",t,...a]),style:{...r,pointerEvents:s},...i},e)}function V8({proOptions:n,position:e="bottom-right"}){return n?.hideAttribution?null:we.createElement(Bx,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},we.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const G8=({x:n,y:e,label:t,labelStyle:r={},labelShowBg:i=!0,labelBgStyle:s={},labelBgPadding:a=[2,4],labelBgBorderRadius:o=2,children:l,className:u,...h})=>{const p=E.useRef(null),[m,g]=E.useState({x:0,y:0,width:0,height:0}),y=Or(["react-flow__edge-textwrapper",u]);return E.useEffect(()=>{if(p.current){const b=p.current.getBBox();g({x:b.x,y:b.y,width:b.width,height:b.height})}},[t]),typeof t>"u"||!t?null:we.createElement("g",{transform:`translate(${n-m.width/2} ${e-m.height/2})`,className:y,visibility:m.width?"visible":"hidden",...h},i&&we.createElement("rect",{width:m.width+2*a[0],x:-a[0],y:-a[1],height:m.height+2*a[1],className:"react-flow__edge-textbg",style:s,rx:o,ry:o}),we.createElement("text",{className:"react-flow__edge-text",y:m.height/2,dy:"0.3em",ref:p,style:r},t),l)};var H8=E.memo(G8);const u1=n=>({width:n.offsetWidth,height:n.offsetHeight}),xd=(n,e=0,t=1)=>Math.min(Math.max(n,e),t),d1=(n={x:0,y:0},e)=>({x:xd(n.x,e[0][0],e[1][0]),y:xd(n.y,e[0][1],e[1][1])}),fC=(n,e,t)=>n<e?xd(Math.abs(n-e),1,50)/50:n>t?-xd(Math.abs(n-t),1,50)/50:0,EL=(n,e)=>{const t=fC(n.x,35,e.width-35)*20,r=fC(n.y,35,e.height-35)*20;return[t,r]},ML=n=>n.getRootNode?.()||window?.document,CL=(n,e)=>({x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x2,e.x2),y2:Math.max(n.y2,e.y2)}),sp=({x:n,y:e,width:t,height:r})=>({x:n,y:e,x2:n+t,y2:e+r}),AL=({x:n,y:e,x2:t,y2:r})=>({x:n,y:e,width:t-n,height:r-e}),pC=n=>({...n.positionAbsolute||{x:0,y:0},width:n.width||0,height:n.height||0}),$8=(n,e)=>AL(CL(sp(n),sp(e))),Gw=(n,e)=>{const t=Math.max(0,Math.min(n.x+n.width,e.x+e.width)-Math.max(n.x,e.x)),r=Math.max(0,Math.min(n.y+n.height,e.y+e.height)-Math.max(n.y,e.y));return Math.ceil(t*r)},W8=n=>ms(n.width)&&ms(n.height)&&ms(n.x)&&ms(n.y),ms=n=>!isNaN(n)&&isFinite(n),Wn=Symbol.for("internals"),RL=["Enter"," ","Escape"],q8=(n,e)=>{},X8=n=>"nativeEvent"in n;function Hw(n){const t=(X8(n)?n.nativeEvent:n).composedPath?.()?.[0]||n.target;return["INPUT","SELECT","TEXTAREA"].includes(t?.nodeName)||t?.hasAttribute("contenteditable")||!!t?.closest(".nokey")}const PL=n=>"clientX"in n,ul=(n,e)=>{const t=PL(n),r=t?n.clientX:n.touches?.[0].clientX,i=t?n.clientY:n.touches?.[0].clientY;return{x:r-(e?.left??0),y:i-(e?.top??0)}},tx=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0,Wp=({id:n,path:e,labelX:t,labelY:r,label:i,labelStyle:s,labelShowBg:a,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:u,style:h,markerEnd:p,markerStart:m,interactionWidth:g=20})=>we.createElement(we.Fragment,null,we.createElement("path",{id:n,style:h,d:e,fill:"none",className:"react-flow__edge-path",markerEnd:p,markerStart:m}),g&&we.createElement("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:g,className:"react-flow__edge-interaction"}),i&&ms(t)&&ms(r)?we.createElement(H8,{x:t,y:r,label:i,labelStyle:s,labelShowBg:a,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:u}):null);Wp.displayName="BaseEdge";function Yh(n,e,t){return t===void 0?t:r=>{const i=e().edges.find(s=>s.id===n);i&&t(r,{...i})}}function kL({sourceX:n,sourceY:e,targetX:t,targetY:r}){const i=Math.abs(t-n)/2,s=t<n?t+i:t-i,a=Math.abs(r-e)/2,o=r<e?r+a:r-a;return[s,o,i,a]}function LL({sourceX:n,sourceY:e,targetX:t,targetY:r,sourceControlX:i,sourceControlY:s,targetControlX:a,targetControlY:o}){const l=n*.125+i*.375+a*.375+t*.125,u=e*.125+s*.375+o*.375+r*.125,h=Math.abs(l-n),p=Math.abs(u-e);return[l,u,h,p]}var xl;(function(n){n.Strict="strict",n.Loose="loose"})(xl||(xl={}));var fc;(function(n){n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal"})(fc||(fc={}));var ap;(function(n){n.Partial="partial",n.Full="full"})(ap||(ap={}));var al;(function(n){n.Bezier="default",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n.SimpleBezier="simplebezier"})(al||(al={}));var nx;(function(n){n.Arrow="arrow",n.ArrowClosed="arrowclosed"})(nx||(nx={}));var Nt;(function(n){n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom"})(Nt||(Nt={}));function mC({pos:n,x1:e,y1:t,x2:r,y2:i}){return n===Nt.Left||n===Nt.Right?[.5*(e+r),t]:[e,.5*(t+i)]}function DL({sourceX:n,sourceY:e,sourcePosition:t=Nt.Bottom,targetX:r,targetY:i,targetPosition:s=Nt.Top}){const[a,o]=mC({pos:t,x1:n,y1:e,x2:r,y2:i}),[l,u]=mC({pos:s,x1:r,y1:i,x2:n,y2:e}),[h,p,m,g]=LL({sourceX:n,sourceY:e,targetX:r,targetY:i,sourceControlX:a,sourceControlY:o,targetControlX:l,targetControlY:u});return[`M${n},${e} C${a},${o} ${l},${u} ${r},${i}`,h,p,m,g]}const h1=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,sourcePosition:i=Nt.Bottom,targetPosition:s=Nt.Top,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:g,markerStart:y,interactionWidth:b})=>{const[_,x,N]=DL({sourceX:n,sourceY:e,sourcePosition:i,targetX:t,targetY:r,targetPosition:s});return we.createElement(Wp,{path:_,labelX:x,labelY:N,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:g,markerStart:y,interactionWidth:b})});h1.displayName="SimpleBezierEdge";const gC={[Nt.Left]:{x:-1,y:0},[Nt.Right]:{x:1,y:0},[Nt.Top]:{x:0,y:-1},[Nt.Bottom]:{x:0,y:1}},Y8=({source:n,sourcePosition:e=Nt.Bottom,target:t})=>e===Nt.Left||e===Nt.Right?n.x<t.x?{x:1,y:0}:{x:-1,y:0}:n.y<t.y?{x:0,y:1}:{x:0,y:-1},xC=(n,e)=>Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));function K8({source:n,sourcePosition:e=Nt.Bottom,target:t,targetPosition:r=Nt.Top,center:i,offset:s}){const a=gC[e],o=gC[r],l={x:n.x+a.x*s,y:n.y+a.y*s},u={x:t.x+o.x*s,y:t.y+o.y*s},h=Y8({source:l,sourcePosition:e,target:u}),p=h.x!==0?"x":"y",m=h[p];let g=[],y,b;const _={x:0,y:0},x={x:0,y:0},[N,T,S,M]=kL({sourceX:n.x,sourceY:n.y,targetX:t.x,targetY:t.y});if(a[p]*o[p]===-1){y=i.x??N,b=i.y??T;const R=[{x:y,y:l.y},{x:y,y:u.y}],F=[{x:l.x,y:b},{x:u.x,y:b}];a[p]===m?g=p==="x"?R:F:g=p==="x"?F:R}else{const R=[{x:l.x,y:u.y}],F=[{x:u.x,y:l.y}];if(p==="x"?g=a.x===m?F:R:g=a.y===m?R:F,e===r){const $=Math.abs(n[p]-t[p]);if($<=s){const U=Math.min(s-1,s-$);a[p]===m?_[p]=(l[p]>n[p]?-1:1)*U:x[p]=(u[p]>t[p]?-1:1)*U}}if(e!==r){const $=p==="x"?"y":"x",U=a[p]===o[$],K=l[$]>u[$],O=l[$]<u[$];(a[p]===1&&(!U&&K||U&&O)||a[p]!==1&&(!U&&O||U&&K))&&(g=p==="x"?R:F)}const k={x:l.x+_.x,y:l.y+_.y},D={x:u.x+x.x,y:u.y+x.y},P=Math.max(Math.abs(k.x-g[0].x),Math.abs(D.x-g[0].x)),G=Math.max(Math.abs(k.y-g[0].y),Math.abs(D.y-g[0].y));P>=G?(y=(k.x+D.x)/2,b=g[0].y):(y=g[0].x,b=(k.y+D.y)/2)}return[[n,{x:l.x+_.x,y:l.y+_.y},...g,{x:u.x+x.x,y:u.y+x.y},t],y,b,S,M]}function Z8(n,e,t,r){const i=Math.min(xC(n,e)/2,xC(e,t)/2,r),{x:s,y:a}=e;if(n.x===s&&s===t.x||n.y===a&&a===t.y)return`L${s} ${a}`;if(n.y===a){const u=n.x<t.x?-1:1,h=n.y<t.y?1:-1;return`L ${s+i*u},${a}Q ${s},${a} ${s},${a+i*h}`}const o=n.x<t.x?1:-1,l=n.y<t.y?-1:1;return`L ${s},${a+i*l}Q ${s},${a} ${s+i*o},${a}`}function $w({sourceX:n,sourceY:e,sourcePosition:t=Nt.Bottom,targetX:r,targetY:i,targetPosition:s=Nt.Top,borderRadius:a=5,centerX:o,centerY:l,offset:u=20}){const[h,p,m,g,y]=K8({source:{x:n,y:e},sourcePosition:t,target:{x:r,y:i},targetPosition:s,center:{x:o,y:l},offset:u});return[h.reduce((_,x,N)=>{let T="";return N>0&&N<h.length-1?T=Z8(h[N-1],x,h[N+1],a):T=`${N===0?"M":"L"}${x.x} ${x.y}`,_+=T,_},""),p,m,g,y]}const zx=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,label:i,labelStyle:s,labelShowBg:a,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:u,style:h,sourcePosition:p=Nt.Bottom,targetPosition:m=Nt.Top,markerEnd:g,markerStart:y,pathOptions:b,interactionWidth:_})=>{const[x,N,T]=$w({sourceX:n,sourceY:e,sourcePosition:p,targetX:t,targetY:r,targetPosition:m,borderRadius:b?.borderRadius,offset:b?.offset});return we.createElement(Wp,{path:x,labelX:N,labelY:T,label:i,labelStyle:s,labelShowBg:a,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:u,style:h,markerEnd:g,markerStart:y,interactionWidth:_})});zx.displayName="SmoothStepEdge";const f1=E.memo(n=>we.createElement(zx,{...n,pathOptions:E.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])}));f1.displayName="StepEdge";function Q8({sourceX:n,sourceY:e,targetX:t,targetY:r}){const[i,s,a,o]=kL({sourceX:n,sourceY:e,targetX:t,targetY:r});return[`M ${n},${e}L ${t},${r}`,i,s,a,o]}const p1=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,label:i,labelStyle:s,labelShowBg:a,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:u,style:h,markerEnd:p,markerStart:m,interactionWidth:g})=>{const[y,b,_]=Q8({sourceX:n,sourceY:e,targetX:t,targetY:r});return we.createElement(Wp,{path:y,labelX:b,labelY:_,label:i,labelStyle:s,labelShowBg:a,labelBgStyle:o,labelBgPadding:l,labelBgBorderRadius:u,style:h,markerEnd:p,markerStart:m,interactionWidth:g})});p1.displayName="StraightEdge";function xg(n,e){return n>=0?.5*n:e*25*Math.sqrt(-n)}function yC({pos:n,x1:e,y1:t,x2:r,y2:i,c:s}){switch(n){case Nt.Left:return[e-xg(e-r,s),t];case Nt.Right:return[e+xg(r-e,s),t];case Nt.Top:return[e,t-xg(t-i,s)];case Nt.Bottom:return[e,t+xg(i-t,s)]}}function IL({sourceX:n,sourceY:e,sourcePosition:t=Nt.Bottom,targetX:r,targetY:i,targetPosition:s=Nt.Top,curvature:a=.25}){const[o,l]=yC({pos:t,x1:n,y1:e,x2:r,y2:i,c:a}),[u,h]=yC({pos:s,x1:r,y1:i,x2:n,y2:e,c:a}),[p,m,g,y]=LL({sourceX:n,sourceY:e,targetX:r,targetY:i,sourceControlX:o,sourceControlY:l,targetControlX:u,targetControlY:h});return[`M${n},${e} C${o},${l} ${u},${h} ${r},${i}`,p,m,g,y]}const rx=E.memo(({sourceX:n,sourceY:e,targetX:t,targetY:r,sourcePosition:i=Nt.Bottom,targetPosition:s=Nt.Top,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:g,markerStart:y,pathOptions:b,interactionWidth:_})=>{const[x,N,T]=IL({sourceX:n,sourceY:e,sourcePosition:i,targetX:t,targetY:r,targetPosition:s,curvature:b?.curvature});return we.createElement(Wp,{path:x,labelX:N,labelY:T,label:a,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:m,markerEnd:g,markerStart:y,interactionWidth:_})});rx.displayName="BezierEdge";const m1=E.createContext(null),J8=m1.Provider;m1.Consumer;const eG=()=>E.useContext(m1),tG=n=>"id"in n&&"source"in n&&"target"in n,nG=({source:n,sourceHandle:e,target:t,targetHandle:r})=>`reactflow__edge-${n}${e||""}-${t}${r||""}`,Ww=(n,e)=>typeof n>"u"?"":typeof n=="string"?n:`${e?`${e}__`:""}${Object.keys(n).sort().map(r=>`${r}=${n[r]}`).join("&")}`,rG=(n,e)=>e.some(t=>t.source===n.source&&t.target===n.target&&(t.sourceHandle===n.sourceHandle||!t.sourceHandle&&!n.sourceHandle)&&(t.targetHandle===n.targetHandle||!t.targetHandle&&!n.targetHandle)),jL=(n,e)=>{if(!n.source||!n.target)return e;let t;return tG(n)?t={...n}:t={...n,id:nG(n)},rG(t,e)?e:e.concat(t)},qw=({x:n,y:e},[t,r,i],s,[a,o])=>{const l={x:(n-t)/i,y:(e-r)/i};return s?{x:a*Math.round(l.x/a),y:o*Math.round(l.y/o)}:l},FL=({x:n,y:e},[t,r,i])=>({x:n*i+t,y:e*i+r}),gc=(n,e=[0,0])=>{if(!n)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const t=(n.width??0)*e[0],r=(n.height??0)*e[1],i={x:n.position.x-t,y:n.position.y-r};return{...i,positionAbsolute:n.positionAbsolute?{x:n.positionAbsolute.x-t,y:n.positionAbsolute.y-r}:i}},Vx=(n,e=[0,0])=>{if(n.length===0)return{x:0,y:0,width:0,height:0};const t=n.reduce((r,i)=>{const{x:s,y:a}=gc(i,e).positionAbsolute;return CL(r,sp({x:s,y:a,width:i.width||0,height:i.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return AL(t)},OL=(n,e,[t,r,i]=[0,0,1],s=!1,a=!1,o=[0,0])=>{const l={x:(e.x-t)/i,y:(e.y-r)/i,width:e.width/i,height:e.height/i},u=[];return n.forEach(h=>{const{width:p,height:m,selectable:g=!0,hidden:y=!1}=h;if(a&&!g||y)return!1;const{positionAbsolute:b}=gc(h,o),_={x:b.x,y:b.y,width:p||0,height:m||0},x=Gw(l,_),N=typeof p>"u"||typeof m>"u"||p===null||m===null,T=s&&x>0,S=(p||0)*(m||0);(N||T||x>=S||h.dragging)&&u.push(h)}),u},UL=(n,e)=>{const t=n.map(r=>r.id);return e.filter(r=>t.includes(r.source)||t.includes(r.target))},BL=(n,e,t,r,i,s=.1)=>{const a=e/(n.width*(1+s)),o=t/(n.height*(1+s)),l=Math.min(a,o),u=xd(l,r,i),h=n.x+n.width/2,p=n.y+n.height/2,m=e/2-h*u,g=t/2-p*u;return{x:m,y:g,zoom:u}},ec=(n,e=0)=>n.transition().duration(e);function vC(n,e,t,r){return(e[t]||[]).reduce((i,s)=>(`${n.id}-${s.id}-${t}`!==r&&i.push({id:s.id||null,type:t,nodeId:n.id,x:(n.positionAbsolute?.x??0)+s.x+s.width/2,y:(n.positionAbsolute?.y??0)+s.y+s.height/2}),i),[])}function iG(n,e,t,r,i,s){const{x:a,y:o}=ul(n),u=e.elementsFromPoint(a,o).find(y=>y.classList.contains("react-flow__handle"));if(u){const y=u.getAttribute("data-nodeid");if(y){const b=g1(void 0,u),_=u.getAttribute("data-handleid"),x=s({nodeId:y,id:_,type:b});if(x){const N=i.find(T=>T.nodeId===y&&T.type===b&&T.id===_);return{handle:{id:_,type:b,nodeId:y,x:N?.x||t.x,y:N?.y||t.y},validHandleResult:x}}}}let h=[],p=1/0;if(i.forEach(y=>{const b=Math.sqrt((y.x-t.x)**2+(y.y-t.y)**2);if(b<=r){const _=s(y);b<=p&&(b<p?h=[{handle:y,validHandleResult:_}]:b===p&&h.push({handle:y,validHandleResult:_}),p=b)}}),!h.length)return{handle:null,validHandleResult:zL()};if(h.length===1)return h[0];const m=h.some(({validHandleResult:y})=>y.isValid),g=h.some(({handle:y})=>y.type==="target");return h.find(({handle:y,validHandleResult:b})=>g?y.type==="target":m?b.isValid:!0)||h[0]}const sG={source:null,target:null,sourceHandle:null,targetHandle:null},zL=()=>({handleDomNode:null,isValid:!1,connection:sG,endHandle:null});function VL(n,e,t,r,i,s,a){const o=i==="target",l=a.querySelector(`.react-flow__handle[data-id="${n?.nodeId}-${n?.id}-${n?.type}"]`),u={...zL(),handleDomNode:l};if(l){const h=g1(void 0,l),p=l.getAttribute("data-nodeid"),m=l.getAttribute("data-handleid"),g=l.classList.contains("connectable"),y=l.classList.contains("connectableend"),b={source:o?p:t,sourceHandle:o?m:r,target:o?t:p,targetHandle:o?r:m};u.connection=b,g&&y&&(e===xl.Strict?o&&h==="source"||!o&&h==="target":p!==t||m!==r)&&(u.endHandle={nodeId:p,handleId:m,type:h},u.isValid=s(b))}return u}function aG({nodes:n,nodeId:e,handleId:t,handleType:r}){return n.reduce((i,s)=>{if(s[Wn]){const{handleBounds:a}=s[Wn];let o=[],l=[];a&&(o=vC(s,a,"source",`${e}-${t}-${r}`),l=vC(s,a,"target",`${e}-${t}-${r}`)),i.push(...o,...l)}return i},[])}function g1(n,e){return n||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function v_(n){n?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function oG(n,e){let t=null;return e?t="valid":n&&!e&&(t="invalid"),t}function GL({event:n,handleId:e,nodeId:t,onConnect:r,isTarget:i,getState:s,setState:a,isValidConnection:o,edgeUpdaterType:l,onReconnectEnd:u}){const h=ML(n.target),{connectionMode:p,domNode:m,autoPanOnConnect:g,connectionRadius:y,onConnectStart:b,panBy:_,getNodes:x,cancelConnection:N}=s();let T=0,S;const{x:M,y:C}=ul(n),R=h?.elementFromPoint(M,C),F=g1(l,R),k=m?.getBoundingClientRect();if(!k||!F)return;let D,P=ul(n,k),G=!1,$=null,U=!1,K=null;const O=aG({nodes:x(),nodeId:t,handleId:e,handleType:F}),j=()=>{if(!g)return;const[V,z]=EL(P,k);_({x:V,y:z}),T=requestAnimationFrame(j)};a({connectionPosition:P,connectionStatus:null,connectionNodeId:t,connectionHandleId:e,connectionHandleType:F,connectionStartHandle:{nodeId:t,handleId:e,type:F},connectionEndHandle:null}),b?.(n,{nodeId:t,handleId:e,handleType:F});function L(V){const{transform:z}=s();P=ul(V,k);const{handle:Y,validHandleResult:se}=iG(V,h,qw(P,z,!1,[1,1]),y,O,J=>VL(J,p,t,e,i?"target":"source",o,h));if(S=Y,G||(j(),G=!0),K=se.handleDomNode,$=se.connection,U=se.isValid,a({connectionPosition:S&&U?FL({x:S.x,y:S.y},z):P,connectionStatus:oG(!!S,U),connectionEndHandle:se.endHandle}),!S&&!U&&!K)return v_(D);$.source!==$.target&&K&&(v_(D),D=K,K.classList.add("connecting","react-flow__handle-connecting"),K.classList.toggle("valid",U),K.classList.toggle("react-flow__handle-valid",U))}function B(V){(S||K)&&$&&U&&r?.($),s().onConnectEnd?.(V),l&&u?.(V),v_(D),N(),cancelAnimationFrame(T),G=!1,U=!1,$=null,K=null,h.removeEventListener("mousemove",L),h.removeEventListener("mouseup",B),h.removeEventListener("touchmove",L),h.removeEventListener("touchend",B)}h.addEventListener("mousemove",L),h.addEventListener("mouseup",B),h.addEventListener("touchmove",L),h.addEventListener("touchend",B)}const _C=()=>!0,lG=n=>({connectionStartHandle:n.connectionStartHandle,connectOnClick:n.connectOnClick,noPanClassName:n.noPanClassName}),cG=(n,e,t)=>r=>{const{connectionStartHandle:i,connectionEndHandle:s,connectionClickStartHandle:a}=r;return{connecting:i?.nodeId===n&&i?.handleId===e&&i?.type===t||s?.nodeId===n&&s?.handleId===e&&s?.type===t,clickConnecting:a?.nodeId===n&&a?.handleId===e&&a?.type===t}},HL=E.forwardRef(({type:n="source",position:e=Nt.Top,isValidConnection:t,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:s=!0,id:a,onConnect:o,children:l,className:u,onMouseDown:h,onTouchStart:p,...m},g)=>{const y=a||null,b=n==="target",_=yr(),x=eG(),{connectOnClick:N,noPanClassName:T}=Rn(lG,Ar),{connecting:S,clickConnecting:M}=Rn(cG(x,y,n),Ar);x||_.getState().onError?.("010",go.error010());const C=k=>{const{defaultEdgeOptions:D,onConnect:P,hasDefaultEdges:G}=_.getState(),$={...D,...k};if(G){const{edges:U,setEdges:K}=_.getState();K(jL($,U))}P?.($),o?.($)},R=k=>{if(!x)return;const D=PL(k);i&&(D&&k.button===0||!D)&&GL({event:k,handleId:y,nodeId:x,onConnect:C,isTarget:b,getState:_.getState,setState:_.setState,isValidConnection:t||_.getState().isValidConnection||_C}),D?h?.(k):p?.(k)},F=k=>{const{onClickConnectStart:D,onClickConnectEnd:P,connectionClickStartHandle:G,connectionMode:$,isValidConnection:U}=_.getState();if(!x||!G&&!i)return;if(!G){D?.(k,{nodeId:x,handleId:y,handleType:n}),_.setState({connectionClickStartHandle:{nodeId:x,type:n,handleId:y}});return}const K=ML(k.target),O=t||U||_C,{connection:j,isValid:L}=VL({nodeId:x,id:y,type:n},$,G.nodeId,G.handleId||null,G.type,O,K);L&&C(j),P?.(k),_.setState({connectionClickStartHandle:null})};return we.createElement("div",{"data-handleid":y,"data-nodeid":x,"data-handlepos":e,"data-id":`${x}-${y}-${n}`,className:Or(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",T,u,{source:!b,target:b,connectable:r,connectablestart:i,connectableend:s,connecting:M,connectionindicator:r&&(i&&!S||s&&S)}]),onMouseDown:R,onTouchStart:R,onClick:N?F:void 0,ref:g,...m},l)});HL.displayName="Handle";var ix=E.memo(HL);const $L=({data:n,isConnectable:e,targetPosition:t=Nt.Top,sourcePosition:r=Nt.Bottom})=>we.createElement(we.Fragment,null,we.createElement(ix,{type:"target",position:t,isConnectable:e}),n?.label,we.createElement(ix,{type:"source",position:r,isConnectable:e}));$L.displayName="DefaultNode";var Xw=E.memo($L);const WL=({data:n,isConnectable:e,sourcePosition:t=Nt.Bottom})=>we.createElement(we.Fragment,null,n?.label,we.createElement(ix,{type:"source",position:t,isConnectable:e}));WL.displayName="InputNode";var qL=E.memo(WL);const XL=({data:n,isConnectable:e,targetPosition:t=Nt.Top})=>we.createElement(we.Fragment,null,we.createElement(ix,{type:"target",position:t,isConnectable:e}),n?.label);XL.displayName="OutputNode";var YL=E.memo(XL);const x1=()=>null;x1.displayName="GroupNode";const uG=n=>({selectedNodes:n.getNodes().filter(e=>e.selected),selectedEdges:n.edges.filter(e=>e.selected).map(e=>({...e}))}),yg=n=>n.id;function dG(n,e){return Ar(n.selectedNodes.map(yg),e.selectedNodes.map(yg))&&Ar(n.selectedEdges.map(yg),e.selectedEdges.map(yg))}const KL=E.memo(({onSelectionChange:n})=>{const e=yr(),{selectedNodes:t,selectedEdges:r}=Rn(uG,dG);return E.useEffect(()=>{const i={nodes:t,edges:r};n?.(i),e.getState().onSelectionChange.forEach(s=>s(i))},[t,r,n]),null});KL.displayName="SelectionListener";const hG=n=>!!n.onSelectionChange;function fG({onSelectionChange:n}){const e=Rn(hG);return n||e?we.createElement(KL,{onSelectionChange:n}):null}const pG=n=>({setNodes:n.setNodes,setEdges:n.setEdges,setDefaultNodesAndEdges:n.setDefaultNodesAndEdges,setMinZoom:n.setMinZoom,setMaxZoom:n.setMaxZoom,setTranslateExtent:n.setTranslateExtent,setNodeExtent:n.setNodeExtent,reset:n.reset});function uu(n,e){E.useEffect(()=>{typeof n<"u"&&e(n)},[n])}function Qt(n,e,t){E.useEffect(()=>{typeof e<"u"&&t({[n]:e})},[e])}const mG=({nodes:n,edges:e,defaultNodes:t,defaultEdges:r,onConnect:i,onConnectStart:s,onConnectEnd:a,onClickConnectStart:o,onClickConnectEnd:l,nodesDraggable:u,nodesConnectable:h,nodesFocusable:p,edgesFocusable:m,edgesUpdatable:g,elevateNodesOnSelect:y,minZoom:b,maxZoom:_,nodeExtent:x,onNodesChange:N,onEdgesChange:T,elementsSelectable:S,connectionMode:M,snapGrid:C,snapToGrid:R,translateExtent:F,connectOnClick:k,defaultEdgeOptions:D,fitView:P,fitViewOptions:G,onNodesDelete:$,onEdgesDelete:U,onNodeDrag:K,onNodeDragStart:O,onNodeDragStop:j,onSelectionDrag:L,onSelectionDragStart:B,onSelectionDragStop:V,noPanClassName:z,nodeOrigin:Y,rfId:se,autoPanOnConnect:J,autoPanOnNodeDrag:q,onError:Q,connectionRadius:te,isValidConnection:X,nodeDragThreshold:ce})=>{const{setNodes:me,setEdges:Re,setDefaultNodesAndEdges:He,setMinZoom:Qe,setMaxZoom:ie,setTranslateExtent:Et,setNodeExtent:yt,reset:tt}=Rn(pG,Ar),Ne=yr();return E.useEffect(()=>{const _t=r?.map(it=>({...it,...D}));return He(t,_t),()=>{tt()}},[]),Qt("defaultEdgeOptions",D,Ne.setState),Qt("connectionMode",M,Ne.setState),Qt("onConnect",i,Ne.setState),Qt("onConnectStart",s,Ne.setState),Qt("onConnectEnd",a,Ne.setState),Qt("onClickConnectStart",o,Ne.setState),Qt("onClickConnectEnd",l,Ne.setState),Qt("nodesDraggable",u,Ne.setState),Qt("nodesConnectable",h,Ne.setState),Qt("nodesFocusable",p,Ne.setState),Qt("edgesFocusable",m,Ne.setState),Qt("edgesUpdatable",g,Ne.setState),Qt("elementsSelectable",S,Ne.setState),Qt("elevateNodesOnSelect",y,Ne.setState),Qt("snapToGrid",R,Ne.setState),Qt("snapGrid",C,Ne.setState),Qt("onNodesChange",N,Ne.setState),Qt("onEdgesChange",T,Ne.setState),Qt("connectOnClick",k,Ne.setState),Qt("fitViewOnInit",P,Ne.setState),Qt("fitViewOnInitOptions",G,Ne.setState),Qt("onNodesDelete",$,Ne.setState),Qt("onEdgesDelete",U,Ne.setState),Qt("onNodeDrag",K,Ne.setState),Qt("onNodeDragStart",O,Ne.setState),Qt("onNodeDragStop",j,Ne.setState),Qt("onSelectionDrag",L,Ne.setState),Qt("onSelectionDragStart",B,Ne.setState),Qt("onSelectionDragStop",V,Ne.setState),Qt("noPanClassName",z,Ne.setState),Qt("nodeOrigin",Y,Ne.setState),Qt("rfId",se,Ne.setState),Qt("autoPanOnConnect",J,Ne.setState),Qt("autoPanOnNodeDrag",q,Ne.setState),Qt("onError",Q,Ne.setState),Qt("connectionRadius",te,Ne.setState),Qt("isValidConnection",X,Ne.setState),Qt("nodeDragThreshold",ce,Ne.setState),uu(n,me),uu(e,Re),uu(b,Qe),uu(_,ie),uu(F,Et),uu(x,yt),null},bC={display:"none"},gG={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},ZL="react-flow__node-desc",QL="react-flow__edge-desc",xG="react-flow__aria-live",yG=n=>n.ariaLiveMessage;function vG({rfId:n}){const e=Rn(yG);return we.createElement("div",{id:`${xG}-${n}`,"aria-live":"assertive","aria-atomic":"true",style:gG},e)}function _G({rfId:n,disableKeyboardA11y:e}){return we.createElement(we.Fragment,null,we.createElement("div",{id:`${ZL}-${n}`,style:bC},"Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),we.createElement("div",{id:`${QL}-${n}`,style:bC},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!e&&we.createElement(vG,{rfId:n}))}var op=(n=null,e={actInsideInputWithModifier:!0})=>{const[t,r]=E.useState(!1),i=E.useRef(!1),s=E.useRef(new Set([])),[a,o]=E.useMemo(()=>{if(n!==null){const u=(Array.isArray(n)?n:[n]).filter(p=>typeof p=="string").map(p=>p.split("+")),h=u.reduce((p,m)=>p.concat(...m),[]);return[u,h]}return[[],[]]},[n]);return E.useEffect(()=>{const l=typeof document<"u"?document:null,u=e?.target||l;if(n!==null){const h=g=>{if(i.current=g.ctrlKey||g.metaKey||g.shiftKey,(!i.current||i.current&&!e.actInsideInputWithModifier)&&Hw(g))return!1;const b=SC(g.code,o);s.current.add(g[b]),wC(a,s.current,!1)&&(g.preventDefault(),r(!0))},p=g=>{if((!i.current||i.current&&!e.actInsideInputWithModifier)&&Hw(g))return!1;const b=SC(g.code,o);wC(a,s.current,!0)?(r(!1),s.current.clear()):s.current.delete(g[b]),g.key==="Meta"&&s.current.clear(),i.current=!1},m=()=>{s.current.clear(),r(!1)};return u?.addEventListener("keydown",h),u?.addEventListener("keyup",p),window.addEventListener("blur",m),()=>{u?.removeEventListener("keydown",h),u?.removeEventListener("keyup",p),window.removeEventListener("blur",m)}}},[n,r]),t};function wC(n,e,t){return n.filter(r=>t||r.length===e.size).some(r=>r.every(i=>e.has(i)))}function SC(n,e){return e.includes(n)?"code":"key"}function JL(n,e,t,r){const i=n.parentNode||n.parentId;if(!i)return t;const s=e.get(i),a=gc(s,r);return JL(s,e,{x:(t.x??0)+a.x,y:(t.y??0)+a.y,z:(s[Wn]?.z??0)>(t.z??0)?s[Wn]?.z??0:t.z??0},r)}function e3(n,e,t){n.forEach(r=>{const i=r.parentNode||r.parentId;if(i&&!n.has(i))throw new Error(`Parent node ${i} not found`);if(i||t?.[r.id]){const{x:s,y:a,z:o}=JL(r,n,{...r.position,z:r[Wn]?.z??0},e);r.positionAbsolute={x:s,y:a},r[Wn].z=o,t?.[r.id]&&(r[Wn].isParent=!0)}})}function __(n,e,t,r){const i=new Map,s={},a=r?1e3:0;return n.forEach(o=>{const l=(ms(o.zIndex)?o.zIndex:0)+(o.selected?a:0),u=e.get(o.id),h={...o,positionAbsolute:{x:o.position.x,y:o.position.y}},p=o.parentNode||o.parentId;p&&(s[p]=!0);const m=u?.type&&u?.type!==o.type;Object.defineProperty(h,Wn,{enumerable:!1,value:{handleBounds:m?void 0:u?.[Wn]?.handleBounds,z:l}}),i.set(o.id,h)}),e3(i,t,s),i}function t3(n,e={}){const{getNodes:t,width:r,height:i,minZoom:s,maxZoom:a,d3Zoom:o,d3Selection:l,fitViewOnInitDone:u,fitViewOnInit:h,nodeOrigin:p}=n(),m=e.initial&&!u&&h;if(o&&l&&(m||!e.initial)){const y=t().filter(_=>{const x=e.includeHiddenNodes?_.width&&_.height:!_.hidden;return e.nodes?.length?x&&e.nodes.some(N=>N.id===_.id):x}),b=y.every(_=>_.width&&_.height);if(y.length>0&&b){const _=Vx(y,p),{x,y:N,zoom:T}=BL(_,r,i,e.minZoom??s,e.maxZoom??a,e.padding??.1),S=ao.translate(x,N).scale(T);return typeof e.duration=="number"&&e.duration>0?o.transform(ec(l,e.duration),S):o.transform(l,S),!0}}return!1}function bG(n,e){return n.forEach(t=>{const r=e.get(t.id);r&&e.set(r.id,{...r,[Wn]:r[Wn],selected:t.selected})}),new Map(e)}function wG(n,e){return e.map(t=>{const r=n.find(i=>i.id===t.id);return r&&(t.selected=r.selected),t})}function vg({changedNodes:n,changedEdges:e,get:t,set:r}){const{nodeInternals:i,edges:s,onNodesChange:a,onEdgesChange:o,hasDefaultNodes:l,hasDefaultEdges:u}=t();n?.length&&(l&&r({nodeInternals:bG(n,i)}),a?.(n)),e?.length&&(u&&r({edges:wG(e,s)}),o?.(e))}const du=()=>{},SG={zoomIn:du,zoomOut:du,zoomTo:du,getZoom:()=>1,setViewport:du,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:du,fitBounds:du,project:n=>n,screenToFlowPosition:n=>n,flowToScreenPosition:n=>n,viewportInitialized:!1},TG=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection}),NG=()=>{const n=yr(),{d3Zoom:e,d3Selection:t}=Rn(TG,Ar);return E.useMemo(()=>t&&e?{zoomIn:i=>e.scaleBy(ec(t,i?.duration),1.2),zoomOut:i=>e.scaleBy(ec(t,i?.duration),1/1.2),zoomTo:(i,s)=>e.scaleTo(ec(t,s?.duration),i),getZoom:()=>n.getState().transform[2],setViewport:(i,s)=>{const[a,o,l]=n.getState().transform,u=ao.translate(i.x??a,i.y??o).scale(i.zoom??l);e.transform(ec(t,s?.duration),u)},getViewport:()=>{const[i,s,a]=n.getState().transform;return{x:i,y:s,zoom:a}},fitView:i=>t3(n.getState,i),setCenter:(i,s,a)=>{const{width:o,height:l,maxZoom:u}=n.getState(),h=typeof a?.zoom<"u"?a.zoom:u,p=o/2-i*h,m=l/2-s*h,g=ao.translate(p,m).scale(h);e.transform(ec(t,a?.duration),g)},fitBounds:(i,s)=>{const{width:a,height:o,minZoom:l,maxZoom:u}=n.getState(),{x:h,y:p,zoom:m}=BL(i,a,o,l,u,s?.padding??.1),g=ao.translate(h,p).scale(m);e.transform(ec(t,s?.duration),g)},project:i=>{const{transform:s,snapToGrid:a,snapGrid:o}=n.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),qw(i,s,a,o)},screenToFlowPosition:i=>{const{transform:s,snapToGrid:a,snapGrid:o,domNode:l}=n.getState();if(!l)return i;const{x:u,y:h}=l.getBoundingClientRect(),p={x:i.x-u,y:i.y-h};return qw(p,s,a,o)},flowToScreenPosition:i=>{const{transform:s,domNode:a}=n.getState();if(!a)return i;const{x:o,y:l}=a.getBoundingClientRect(),u=FL(i,s);return{x:u.x+o,y:u.y+l}},viewportInitialized:!0}:SG,[e,t])};function Gx(){const n=NG(),e=yr(),t=E.useCallback(()=>e.getState().getNodes().map(b=>({...b})),[]),r=E.useCallback(b=>e.getState().nodeInternals.get(b),[]),i=E.useCallback(()=>{const{edges:b=[]}=e.getState();return b.map(_=>({..._}))},[]),s=E.useCallback(b=>{const{edges:_=[]}=e.getState();return _.find(x=>x.id===b)},[]),a=E.useCallback(b=>{const{getNodes:_,setNodes:x,hasDefaultNodes:N,onNodesChange:T}=e.getState(),S=_(),M=typeof b=="function"?b(S):b;if(N)x(M);else if(T){const C=M.length===0?S.map(R=>({type:"remove",id:R.id})):M.map(R=>({item:R,type:"reset"}));T(C)}},[]),o=E.useCallback(b=>{const{edges:_=[],setEdges:x,hasDefaultEdges:N,onEdgesChange:T}=e.getState(),S=typeof b=="function"?b(_):b;if(N)x(S);else if(T){const M=S.length===0?_.map(C=>({type:"remove",id:C.id})):S.map(C=>({item:C,type:"reset"}));T(M)}},[]),l=E.useCallback(b=>{const _=Array.isArray(b)?b:[b],{getNodes:x,setNodes:N,hasDefaultNodes:T,onNodesChange:S}=e.getState();if(T){const C=[...x(),..._];N(C)}else if(S){const M=_.map(C=>({item:C,type:"add"}));S(M)}},[]),u=E.useCallback(b=>{const _=Array.isArray(b)?b:[b],{edges:x=[],setEdges:N,hasDefaultEdges:T,onEdgesChange:S}=e.getState();if(T)N([...x,..._]);else if(S){const M=_.map(C=>({item:C,type:"add"}));S(M)}},[]),h=E.useCallback(()=>{const{getNodes:b,edges:_=[],transform:x}=e.getState(),[N,T,S]=x;return{nodes:b().map(M=>({...M})),edges:_.map(M=>({...M})),viewport:{x:N,y:T,zoom:S}}},[]),p=E.useCallback(({nodes:b,edges:_})=>{const{nodeInternals:x,getNodes:N,edges:T,hasDefaultNodes:S,hasDefaultEdges:M,onNodesDelete:C,onEdgesDelete:R,onNodesChange:F,onEdgesChange:k}=e.getState(),D=(b||[]).map(K=>K.id),P=(_||[]).map(K=>K.id),G=N().reduce((K,O)=>{const j=O.parentNode||O.parentId,L=!D.includes(O.id)&&j&&K.find(V=>V.id===j);return(typeof O.deletable=="boolean"?O.deletable:!0)&&(D.includes(O.id)||L)&&K.push(O),K},[]),$=T.filter(K=>typeof K.deletable=="boolean"?K.deletable:!0),U=$.filter(K=>P.includes(K.id));if(G||U){const K=UL(G,$),O=[...U,...K],j=O.reduce((L,B)=>(L.includes(B.id)||L.push(B.id),L),[]);if((M||S)&&(M&&e.setState({edges:T.filter(L=>!j.includes(L.id))}),S&&(G.forEach(L=>{x.delete(L.id)}),e.setState({nodeInternals:new Map(x)}))),j.length>0&&(R?.(O),k&&k(j.map(L=>({id:L,type:"remove"})))),G.length>0&&(C?.(G),F)){const L=G.map(B=>({id:B.id,type:"remove"}));F(L)}}},[]),m=E.useCallback(b=>{const _=W8(b),x=_?null:e.getState().nodeInternals.get(b.id);return!_&&!x?[null,null,_]:[_?b:pC(x),x,_]},[]),g=E.useCallback((b,_=!0,x)=>{const[N,T,S]=m(b);return N?(x||e.getState().getNodes()).filter(M=>{if(!S&&(M.id===T.id||!M.positionAbsolute))return!1;const C=pC(M),R=Gw(C,N);return _&&R>0||R>=N.width*N.height}):[]},[]),y=E.useCallback((b,_,x=!0)=>{const[N]=m(b);if(!N)return!1;const T=Gw(N,_);return x&&T>0||T>=N.width*N.height},[]);return E.useMemo(()=>({...n,getNodes:t,getNode:r,getEdges:i,getEdge:s,setNodes:a,setEdges:o,addNodes:l,addEdges:u,toObject:h,deleteElements:p,getIntersectingNodes:g,isNodeIntersecting:y}),[n,t,r,i,s,a,o,l,u,h,p,g,y])}const EG={actInsideInputWithModifier:!1};var MG=({deleteKeyCode:n,multiSelectionKeyCode:e})=>{const t=yr(),{deleteElements:r}=Gx(),i=op(n,EG),s=op(e);E.useEffect(()=>{if(i){const{edges:a,getNodes:o}=t.getState(),l=o().filter(h=>h.selected),u=a.filter(h=>h.selected);r({nodes:l,edges:u}),t.setState({nodesSelectionActive:!1})}},[i]),E.useEffect(()=>{t.setState({multiSelectionActive:s})},[s])};function CG(n){const e=yr();E.useEffect(()=>{let t;const r=()=>{if(!n.current)return;const i=u1(n.current);(i.height===0||i.width===0)&&e.getState().onError?.("004",go.error004()),e.setState({width:i.width||500,height:i.height||500})};return r(),window.addEventListener("resize",r),n.current&&(t=new ResizeObserver(()=>r()),t.observe(n.current)),()=>{window.removeEventListener("resize",r),t&&n.current&&t.unobserve(n.current)}},[])}const y1={position:"absolute",width:"100%",height:"100%",top:0,left:0},AG=(n,e)=>n.x!==e.x||n.y!==e.y||n.zoom!==e.k,_g=n=>({x:n.x,y:n.y,zoom:n.k}),hu=(n,e)=>n.target.closest(`.${e}`),TC=(n,e)=>e===2&&Array.isArray(n)&&n.includes(2),NC=n=>{const e=n.ctrlKey&&tx()?10:1;return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*e},RG=n=>({d3Zoom:n.d3Zoom,d3Selection:n.d3Selection,d3ZoomHandler:n.d3ZoomHandler,userSelectionActive:n.userSelectionActive}),PG=({onMove:n,onMoveStart:e,onMoveEnd:t,onPaneContextMenu:r,zoomOnScroll:i=!0,zoomOnPinch:s=!0,panOnScroll:a=!1,panOnScrollSpeed:o=.5,panOnScrollMode:l=fc.Free,zoomOnDoubleClick:u=!0,elementsSelectable:h,panOnDrag:p=!0,defaultViewport:m,translateExtent:g,minZoom:y,maxZoom:b,zoomActivationKeyCode:_,preventScrolling:x=!0,children:N,noWheelClassName:T,noPanClassName:S})=>{const M=E.useRef(),C=yr(),R=E.useRef(!1),F=E.useRef(!1),k=E.useRef(null),D=E.useRef({x:0,y:0,zoom:0}),{d3Zoom:P,d3Selection:G,d3ZoomHandler:$,userSelectionActive:U}=Rn(RG,Ar),K=op(_),O=E.useRef(0),j=E.useRef(!1),L=E.useRef();return CG(k),E.useEffect(()=>{if(k.current){const B=k.current.getBoundingClientRect(),V=TL().scaleExtent([y,b]).translateExtent(g),z=qi(k.current).call(V),Y=ao.translate(m.x,m.y).scale(xd(m.zoom,y,b)),se=[[0,0],[B.width,B.height]],J=V.constrain()(Y,se,g);V.transform(z,J),V.wheelDelta(NC),C.setState({d3Zoom:V,d3Selection:z,d3ZoomHandler:z.on("wheel.zoom"),transform:[J.x,J.y,J.k],domNode:k.current.closest(".react-flow")})}},[]),E.useEffect(()=>{G&&P&&(a&&!K&&!U?G.on("wheel.zoom",B=>{if(hu(B,T))return!1;B.preventDefault(),B.stopImmediatePropagation();const V=G.property("__zoom").k||1;if(B.ctrlKey&&s){const X=us(B),ce=NC(B),me=V*Math.pow(2,ce);P.scaleTo(G,me,X,B);return}const z=B.deltaMode===1?20:1;let Y=l===fc.Vertical?0:B.deltaX*z,se=l===fc.Horizontal?0:B.deltaY*z;!tx()&&B.shiftKey&&l!==fc.Vertical&&(Y=B.deltaY*z,se=0),P.translateBy(G,-(Y/V)*o,-(se/V)*o,{internal:!0});const J=_g(G.property("__zoom")),{onViewportChangeStart:q,onViewportChange:Q,onViewportChangeEnd:te}=C.getState();clearTimeout(L.current),j.current||(j.current=!0,e?.(B,J),q?.(J)),j.current&&(n?.(B,J),Q?.(J),L.current=setTimeout(()=>{t?.(B,J),te?.(J),j.current=!1},150))},{passive:!1}):typeof $<"u"&&G.on("wheel.zoom",function(B,V){if(!x&&B.type==="wheel"&&!B.ctrlKey||hu(B,T))return null;B.preventDefault(),$.call(this,B,V)},{passive:!1}))},[U,a,l,G,P,$,K,s,x,T,e,n,t]),E.useEffect(()=>{P&&P.on("start",B=>{if(!B.sourceEvent||B.sourceEvent.internal)return null;O.current=B.sourceEvent?.button;const{onViewportChangeStart:V}=C.getState(),z=_g(B.transform);R.current=!0,D.current=z,B.sourceEvent?.type==="mousedown"&&C.setState({paneDragging:!0}),V?.(z),e?.(B.sourceEvent,z)})},[P,e]),E.useEffect(()=>{P&&(U&&!R.current?P.on("zoom",null):U||P.on("zoom",B=>{const{onViewportChange:V}=C.getState();if(C.setState({transform:[B.transform.x,B.transform.y,B.transform.k]}),F.current=!!(r&&TC(p,O.current??0)),(n||V)&&!B.sourceEvent?.internal){const z=_g(B.transform);V?.(z),n?.(B.sourceEvent,z)}}))},[U,P,n,p,r]),E.useEffect(()=>{P&&P.on("end",B=>{if(!B.sourceEvent||B.sourceEvent.internal)return null;const{onViewportChangeEnd:V}=C.getState();if(R.current=!1,C.setState({paneDragging:!1}),r&&TC(p,O.current??0)&&!F.current&&r(B.sourceEvent),F.current=!1,(t||V)&&AG(D.current,B.transform)){const z=_g(B.transform);D.current=z,clearTimeout(M.current),M.current=setTimeout(()=>{V?.(z),t?.(B.sourceEvent,z)},a?150:0)}})},[P,a,p,t,r]),E.useEffect(()=>{P&&P.filter(B=>{const V=K||i,z=s&&B.ctrlKey;if((p===!0||Array.isArray(p)&&p.includes(1))&&B.button===1&&B.type==="mousedown"&&(hu(B,"react-flow__node")||hu(B,"react-flow__edge")))return!0;if(!p&&!V&&!a&&!u&&!s||U||!u&&B.type==="dblclick"||hu(B,T)&&B.type==="wheel"||hu(B,S)&&(B.type!=="wheel"||a&&B.type==="wheel"&&!K)||!s&&B.ctrlKey&&B.type==="wheel"||!V&&!a&&!z&&B.type==="wheel"||!p&&(B.type==="mousedown"||B.type==="touchstart")||Array.isArray(p)&&!p.includes(B.button)&&B.type==="mousedown")return!1;const Y=Array.isArray(p)&&p.includes(B.button)||!B.button||B.button<=1;return(!B.ctrlKey||B.type==="wheel")&&Y})},[U,P,i,s,a,u,p,h,K]),we.createElement("div",{className:"react-flow__renderer",ref:k,style:y1},N)},kG=n=>({userSelectionActive:n.userSelectionActive,userSelectionRect:n.userSelectionRect});function LG(){const{userSelectionActive:n,userSelectionRect:e}=Rn(kG,Ar);return n&&e?we.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}function EC(n,e){const t=e.parentNode||e.parentId,r=n.find(i=>i.id===t);if(r){const i=e.position.x+e.width-r.width,s=e.position.y+e.height-r.height;if(i>0||s>0||e.position.x<0||e.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,i>0&&(r.style.width+=i),s>0&&(r.style.height+=s),e.position.x<0){const a=Math.abs(e.position.x);r.position.x=r.position.x-a,r.style.width+=a,e.position.x=0}if(e.position.y<0){const a=Math.abs(e.position.y);r.position.y=r.position.y-a,r.style.height+=a,e.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function n3(n,e){if(n.some(r=>r.type==="reset"))return n.filter(r=>r.type==="reset").map(r=>r.item);const t=n.filter(r=>r.type==="add").map(r=>r.item);return e.reduce((r,i)=>{const s=n.filter(o=>o.id===i.id);if(s.length===0)return r.push(i),r;const a={...i};for(const o of s)if(o)switch(o.type){case"select":{a.selected=o.selected;break}case"position":{typeof o.position<"u"&&(a.position=o.position),typeof o.positionAbsolute<"u"&&(a.positionAbsolute=o.positionAbsolute),typeof o.dragging<"u"&&(a.dragging=o.dragging),a.expandParent&&EC(r,a);break}case"dimensions":{typeof o.dimensions<"u"&&(a.width=o.dimensions.width,a.height=o.dimensions.height),typeof o.updateStyle<"u"&&(a.style={...a.style||{},...o.dimensions}),typeof o.resizing=="boolean"&&(a.resizing=o.resizing),a.expandParent&&EC(r,a);break}case"remove":return r}return r.push(a),r},t)}function r3(n,e){return n3(n,e)}function DG(n,e){return n3(n,e)}const il=(n,e)=>({id:n,type:"select",selected:e});function qu(n,e){return n.reduce((t,r)=>{const i=e.includes(r.id);return!r.selected&&i?(r.selected=!0,t.push(il(r.id,!0))):r.selected&&!i&&(r.selected=!1,t.push(il(r.id,!1))),t},[])}const b_=(n,e)=>t=>{t.target===e.current&&n?.(t)},IG=n=>({userSelectionActive:n.userSelectionActive,elementsSelectable:n.elementsSelectable,dragging:n.paneDragging}),i3=E.memo(({isSelecting:n,selectionMode:e=ap.Full,panOnDrag:t,onSelectionStart:r,onSelectionEnd:i,onPaneClick:s,onPaneContextMenu:a,onPaneScroll:o,onPaneMouseEnter:l,onPaneMouseMove:u,onPaneMouseLeave:h,children:p})=>{const m=E.useRef(null),g=yr(),y=E.useRef(0),b=E.useRef(0),_=E.useRef(),{userSelectionActive:x,elementsSelectable:N,dragging:T}=Rn(IG,Ar),S=()=>{g.setState({userSelectionActive:!1,userSelectionRect:null}),y.current=0,b.current=0},M=$=>{s?.($),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1})},C=$=>{if(Array.isArray(t)&&t?.includes(2)){$.preventDefault();return}a?.($)},R=o?$=>o($):void 0,F=$=>{const{resetSelectedElements:U,domNode:K}=g.getState();if(_.current=K?.getBoundingClientRect(),!N||!n||$.button!==0||$.target!==m.current||!_.current)return;const{x:O,y:j}=ul($,_.current);U(),g.setState({userSelectionRect:{width:0,height:0,startX:O,startY:j,x:O,y:j}}),r?.($)},k=$=>{const{userSelectionRect:U,nodeInternals:K,edges:O,transform:j,onNodesChange:L,onEdgesChange:B,nodeOrigin:V,getNodes:z}=g.getState();if(!n||!_.current||!U)return;g.setState({userSelectionActive:!0,nodesSelectionActive:!1});const Y=ul($,_.current),se=U.startX??0,J=U.startY??0,q={...U,x:Y.x<se?Y.x:se,y:Y.y<J?Y.y:J,width:Math.abs(Y.x-se),height:Math.abs(Y.y-J)},Q=z(),te=OL(K,q,j,e===ap.Partial,!0,V),X=UL(te,O).map(me=>me.id),ce=te.map(me=>me.id);if(y.current!==ce.length){y.current=ce.length;const me=qu(Q,ce);me.length&&L?.(me)}if(b.current!==X.length){b.current=X.length;const me=qu(O,X);me.length&&B?.(me)}g.setState({userSelectionRect:q})},D=$=>{if($.button!==0)return;const{userSelectionRect:U}=g.getState();!x&&U&&$.target===m.current&&M?.($),g.setState({nodesSelectionActive:y.current>0}),S(),i?.($)},P=$=>{x&&(g.setState({nodesSelectionActive:y.current>0}),i?.($)),S()},G=N&&(n||x);return we.createElement("div",{className:Or(["react-flow__pane",{dragging:T,selection:n}]),onClick:G?void 0:b_(M,m),onContextMenu:b_(C,m),onWheel:b_(R,m),onMouseEnter:G?void 0:l,onMouseDown:G?F:void 0,onMouseMove:G?k:u,onMouseUp:G?D:void 0,onMouseLeave:G?P:h,ref:m,style:y1},p,we.createElement(LG,null))});i3.displayName="Pane";function s3(n,e){const t=n.parentNode||n.parentId;if(!t)return!1;const r=e.get(t);return r?r.selected?!0:s3(r,e):!1}function MC(n,e,t){let r=n;do{if(r?.matches(e))return!0;if(r===t.current)return!1;r=r.parentElement}while(r);return!1}function jG(n,e,t,r){return Array.from(n.values()).filter(i=>(i.selected||i.id===r)&&(!i.parentNode||i.parentId||!s3(i,n))&&(i.draggable||e&&typeof i.draggable>"u")).map(i=>({id:i.id,position:i.position||{x:0,y:0},positionAbsolute:i.positionAbsolute||{x:0,y:0},distance:{x:t.x-(i.positionAbsolute?.x??0),y:t.y-(i.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:i.extent,parentNode:i.parentNode||i.parentId,parentId:i.parentNode||i.parentId,width:i.width,height:i.height,expandParent:i.expandParent}))}function FG(n,e){return!e||e==="parent"?e:[e[0],[e[1][0]-(n.width||0),e[1][1]-(n.height||0)]]}function a3(n,e,t,r,i=[0,0],s){const a=FG(n,n.extent||r);let o=a;const l=n.parentNode||n.parentId;if(n.extent==="parent"&&!n.expandParent)if(l&&n.width&&n.height){const p=t.get(l),{x:m,y:g}=gc(p,i).positionAbsolute;o=p&&ms(m)&&ms(g)&&ms(p.width)&&ms(p.height)?[[m+n.width*i[0],g+n.height*i[1]],[m+p.width-n.width+n.width*i[0],g+p.height-n.height+n.height*i[1]]]:o}else s?.("005",go.error005()),o=a;else if(n.extent&&l&&n.extent!=="parent"){const p=t.get(l),{x:m,y:g}=gc(p,i).positionAbsolute;o=[[n.extent[0][0]+m,n.extent[0][1]+g],[n.extent[1][0]+m,n.extent[1][1]+g]]}let u={x:0,y:0};if(l){const p=t.get(l);u=gc(p,i).positionAbsolute}const h=o&&o!=="parent"?d1(e,o):e;return{position:{x:h.x-u.x,y:h.y-u.y},positionAbsolute:h}}function w_({nodeId:n,dragItems:e,nodeInternals:t}){const r=e.map(i=>({...t.get(i.id),position:i.position,positionAbsolute:i.positionAbsolute}));return[n?r.find(i=>i.id===n):r[0],r]}const CC=(n,e,t,r)=>{const i=e.querySelectorAll(n);if(!i||!i.length)return null;const s=Array.from(i),a=e.getBoundingClientRect(),o={x:a.width*r[0],y:a.height*r[1]};return s.map(l=>{const u=l.getBoundingClientRect();return{id:l.getAttribute("data-handleid"),position:l.getAttribute("data-handlepos"),x:(u.left-a.left-o.x)/t,y:(u.top-a.top-o.y)/t,...u1(l)}})};function Kh(n,e,t){return t===void 0?t:r=>{const i=e().nodeInternals.get(n);i&&t(r,{...i})}}function Yw({id:n,store:e,unselect:t=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:s,multiSelectionActive:a,nodeInternals:o,onError:l}=e.getState(),u=o.get(n);if(!u){l?.("012",go.error012(n));return}e.setState({nodesSelectionActive:!1}),u.selected?(t||u.selected&&a)&&(s({nodes:[u],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):i([n])}function OG(){const n=yr();return E.useCallback(({sourceEvent:t})=>{const{transform:r,snapGrid:i,snapToGrid:s}=n.getState(),a=t.touches?t.touches[0].clientX:t.clientX,o=t.touches?t.touches[0].clientY:t.clientY,l={x:(a-r[0])/r[2],y:(o-r[1])/r[2]};return{xSnapped:s?i[0]*Math.round(l.x/i[0]):l.x,ySnapped:s?i[1]*Math.round(l.y/i[1]):l.y,...l}},[])}function S_(n){return(e,t,r)=>n?.(e,r)}function o3({nodeRef:n,disabled:e=!1,noDragClassName:t,handleSelector:r,nodeId:i,isSelectable:s,selectNodesOnDrag:a}){const o=yr(),[l,u]=E.useState(!1),h=E.useRef([]),p=E.useRef({x:null,y:null}),m=E.useRef(0),g=E.useRef(null),y=E.useRef({x:0,y:0}),b=E.useRef(null),_=E.useRef(!1),x=E.useRef(!1),N=E.useRef(!1),T=OG();return E.useEffect(()=>{if(n?.current){const S=qi(n.current),M=({x:F,y:k})=>{const{nodeInternals:D,onNodeDrag:P,onSelectionDrag:G,updateNodePositions:$,nodeExtent:U,snapGrid:K,snapToGrid:O,nodeOrigin:j,onError:L}=o.getState();p.current={x:F,y:k};let B=!1,V={x:0,y:0,x2:0,y2:0};if(h.current.length>1&&U){const Y=Vx(h.current,j);V=sp(Y)}if(h.current=h.current.map(Y=>{const se={x:F-Y.distance.x,y:k-Y.distance.y};O&&(se.x=K[0]*Math.round(se.x/K[0]),se.y=K[1]*Math.round(se.y/K[1]));const J=[[U[0][0],U[0][1]],[U[1][0],U[1][1]]];h.current.length>1&&U&&!Y.extent&&(J[0][0]=Y.positionAbsolute.x-V.x+U[0][0],J[1][0]=Y.positionAbsolute.x+(Y.width??0)-V.x2+U[1][0],J[0][1]=Y.positionAbsolute.y-V.y+U[0][1],J[1][1]=Y.positionAbsolute.y+(Y.height??0)-V.y2+U[1][1]);const q=a3(Y,se,D,J,j,L);return B=B||Y.position.x!==q.position.x||Y.position.y!==q.position.y,Y.position=q.position,Y.positionAbsolute=q.positionAbsolute,Y}),!B)return;$(h.current,!0,!0),u(!0);const z=i?P:S_(G);if(z&&b.current){const[Y,se]=w_({nodeId:i,dragItems:h.current,nodeInternals:D});z(b.current,Y,se)}},C=()=>{if(!g.current)return;const[F,k]=EL(y.current,g.current);if(F!==0||k!==0){const{transform:D,panBy:P}=o.getState();p.current.x=(p.current.x??0)-F/D[2],p.current.y=(p.current.y??0)-k/D[2],P({x:F,y:k})&&M(p.current)}m.current=requestAnimationFrame(C)},R=F=>{const{nodeInternals:k,multiSelectionActive:D,nodesDraggable:P,unselectNodesAndEdges:G,onNodeDragStart:$,onSelectionDragStart:U}=o.getState();x.current=!0;const K=i?$:S_(U);(!a||!s)&&!D&&i&&(k.get(i)?.selected||G()),i&&s&&a&&Yw({id:i,store:o,nodeRef:n});const O=T(F);if(p.current=O,h.current=jG(k,P,O,i),K&&h.current){const[j,L]=w_({nodeId:i,dragItems:h.current,nodeInternals:k});K(F.sourceEvent,j,L)}};if(e)S.on(".drag",null);else{const F=K6().on("start",k=>{const{domNode:D,nodeDragThreshold:P}=o.getState();P===0&&R(k),N.current=!1;const G=T(k);p.current=G,g.current=D?.getBoundingClientRect()||null,y.current=ul(k.sourceEvent,g.current)}).on("drag",k=>{const D=T(k),{autoPanOnNodeDrag:P,nodeDragThreshold:G}=o.getState();if(k.sourceEvent.type==="touchmove"&&k.sourceEvent.touches.length>1&&(N.current=!0),!N.current){if(!_.current&&x.current&&P&&(_.current=!0,C()),!x.current){const $=D.xSnapped-(p?.current?.x??0),U=D.ySnapped-(p?.current?.y??0);Math.sqrt($*$+U*U)>G&&R(k)}(p.current.x!==D.xSnapped||p.current.y!==D.ySnapped)&&h.current&&x.current&&(b.current=k.sourceEvent,y.current=ul(k.sourceEvent,g.current),M(D))}}).on("end",k=>{if(!(!x.current||N.current)&&(u(!1),_.current=!1,x.current=!1,cancelAnimationFrame(m.current),h.current)){const{updateNodePositions:D,nodeInternals:P,onNodeDragStop:G,onSelectionDragStop:$}=o.getState(),U=i?G:S_($);if(D(h.current,!1,!1),U){const[K,O]=w_({nodeId:i,dragItems:h.current,nodeInternals:P});U(k.sourceEvent,K,O)}}}).filter(k=>{const D=k.target;return!k.button&&(!t||!MC(D,`.${t}`,n))&&(!r||MC(D,r,n))});return S.call(F),()=>{S.on(".drag",null)}}}},[n,e,t,r,s,o,i,a,T]),l}function l3(){const n=yr();return E.useCallback(t=>{const{nodeInternals:r,nodeExtent:i,updateNodePositions:s,getNodes:a,snapToGrid:o,snapGrid:l,onError:u,nodesDraggable:h}=n.getState(),p=a().filter(N=>N.selected&&(N.draggable||h&&typeof N.draggable>"u")),m=o?l[0]:5,g=o?l[1]:5,y=t.isShiftPressed?4:1,b=t.x*m*y,_=t.y*g*y,x=p.map(N=>{if(N.positionAbsolute){const T={x:N.positionAbsolute.x+b,y:N.positionAbsolute.y+_};o&&(T.x=l[0]*Math.round(T.x/l[0]),T.y=l[1]*Math.round(T.y/l[1]));const{positionAbsolute:S,position:M}=a3(N,T,r,i,void 0,u);N.position=M,N.positionAbsolute=S}return N});s(x,!0,!1)},[])}const sd={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Zh=n=>{const e=({id:t,type:r,data:i,xPos:s,yPos:a,xPosOrigin:o,yPosOrigin:l,selected:u,onClick:h,onMouseEnter:p,onMouseMove:m,onMouseLeave:g,onContextMenu:y,onDoubleClick:b,style:_,className:x,isDraggable:N,isSelectable:T,isConnectable:S,isFocusable:M,selectNodesOnDrag:C,sourcePosition:R,targetPosition:F,hidden:k,resizeObserver:D,dragHandle:P,zIndex:G,isParent:$,noDragClassName:U,noPanClassName:K,initialized:O,disableKeyboardA11y:j,ariaLabel:L,rfId:B,hasHandleBounds:V})=>{const z=yr(),Y=E.useRef(null),se=E.useRef(null),J=E.useRef(R),q=E.useRef(F),Q=E.useRef(r),te=T||N||h||p||m||g,X=l3(),ce=Kh(t,z.getState,p),me=Kh(t,z.getState,m),Re=Kh(t,z.getState,g),He=Kh(t,z.getState,y),Qe=Kh(t,z.getState,b),ie=tt=>{const{nodeDragThreshold:Ne}=z.getState();if(T&&(!C||!N||Ne>0)&&Yw({id:t,store:z,nodeRef:Y}),h){const _t=z.getState().nodeInternals.get(t);_t&&h(tt,{..._t})}},Et=tt=>{if(!Hw(tt)&&!j)if(RL.includes(tt.key)&&T){const Ne=tt.key==="Escape";Yw({id:t,store:z,unselect:Ne,nodeRef:Y})}else N&&u&&Object.prototype.hasOwnProperty.call(sd,tt.key)&&(z.setState({ariaLiveMessage:`Moved selected node ${tt.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~s}, y: ${~~a}`}),X({x:sd[tt.key].x,y:sd[tt.key].y,isShiftPressed:tt.shiftKey}))};E.useEffect(()=>()=>{se.current&&(D?.unobserve(se.current),se.current=null)},[]),E.useEffect(()=>{if(Y.current&&!k){const tt=Y.current;(!O||!V||se.current!==tt)&&(se.current&&D?.unobserve(se.current),D?.observe(tt),se.current=tt)}},[k,O,V]),E.useEffect(()=>{const tt=Q.current!==r,Ne=J.current!==R,_t=q.current!==F;Y.current&&(tt||Ne||_t)&&(tt&&(Q.current=r),Ne&&(J.current=R),_t&&(q.current=F),z.getState().updateNodeDimensions([{id:t,nodeElement:Y.current,forceUpdate:!0}]))},[t,r,R,F]);const yt=o3({nodeRef:Y,disabled:k||!N,noDragClassName:U,handleSelector:P,nodeId:t,isSelectable:T,selectNodesOnDrag:C});return k?null:we.createElement("div",{className:Or(["react-flow__node",`react-flow__node-${r}`,{[K]:N},x,{selected:u,selectable:T,parent:$,dragging:yt}]),ref:Y,style:{zIndex:G,transform:`translate(${o}px,${l}px)`,pointerEvents:te?"all":"none",visibility:O?"visible":"hidden",..._},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:ce,onMouseMove:me,onMouseLeave:Re,onContextMenu:He,onClick:ie,onDoubleClick:Qe,onKeyDown:M?Et:void 0,tabIndex:M?0:void 0,role:M?"button":void 0,"aria-describedby":j?void 0:`${ZL}-${B}`,"aria-label":L},we.createElement(J8,{value:t},we.createElement(n,{id:t,data:i,type:r,xPos:s,yPos:a,selected:u,isConnectable:S,sourcePosition:R,targetPosition:F,dragging:yt,dragHandle:P,zIndex:G})))};return e.displayName="NodeWrapper",E.memo(e)};const UG=n=>{const e=n.getNodes().filter(t=>t.selected);return{...Vx(e,n.nodeOrigin),transformString:`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`,userSelectionActive:n.userSelectionActive}};function BG({onSelectionContextMenu:n,noPanClassName:e,disableKeyboardA11y:t}){const r=yr(),{width:i,height:s,x:a,y:o,transformString:l,userSelectionActive:u}=Rn(UG,Ar),h=l3(),p=E.useRef(null);if(E.useEffect(()=>{t||p.current?.focus({preventScroll:!0})},[t]),o3({nodeRef:p}),u||!i||!s)return null;const m=n?y=>{const b=r.getState().getNodes().filter(_=>_.selected);n(y,b)}:void 0,g=y=>{Object.prototype.hasOwnProperty.call(sd,y.key)&&h({x:sd[y.key].x,y:sd[y.key].y,isShiftPressed:y.shiftKey})};return we.createElement("div",{className:Or(["react-flow__nodesselection","react-flow__container",e]),style:{transform:l}},we.createElement("div",{ref:p,className:"react-flow__nodesselection-rect",onContextMenu:m,tabIndex:t?void 0:-1,onKeyDown:t?void 0:g,style:{width:i,height:s,top:o,left:a}}))}var zG=E.memo(BG);const VG=n=>n.nodesSelectionActive,c3=({children:n,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:a,deleteKeyCode:o,onMove:l,onMoveStart:u,onMoveEnd:h,selectionKeyCode:p,selectionOnDrag:m,selectionMode:g,onSelectionStart:y,onSelectionEnd:b,multiSelectionKeyCode:_,panActivationKeyCode:x,zoomActivationKeyCode:N,elementsSelectable:T,zoomOnScroll:S,zoomOnPinch:M,panOnScroll:C,panOnScrollSpeed:R,panOnScrollMode:F,zoomOnDoubleClick:k,panOnDrag:D,defaultViewport:P,translateExtent:G,minZoom:$,maxZoom:U,preventScrolling:K,onSelectionContextMenu:O,noWheelClassName:j,noPanClassName:L,disableKeyboardA11y:B})=>{const V=Rn(VG),z=op(p),Y=op(x),se=Y||D,J=Y||C,q=z||m&&se!==!0;return MG({deleteKeyCode:o,multiSelectionKeyCode:_}),we.createElement(PG,{onMove:l,onMoveStart:u,onMoveEnd:h,onPaneContextMenu:s,elementsSelectable:T,zoomOnScroll:S,zoomOnPinch:M,panOnScroll:J,panOnScrollSpeed:R,panOnScrollMode:F,zoomOnDoubleClick:k,panOnDrag:!z&&se,defaultViewport:P,translateExtent:G,minZoom:$,maxZoom:U,zoomActivationKeyCode:N,preventScrolling:K,noWheelClassName:j,noPanClassName:L},we.createElement(i3,{onSelectionStart:y,onSelectionEnd:b,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:s,onPaneScroll:a,panOnDrag:se,isSelecting:!!q,selectionMode:g},n,V&&we.createElement(zG,{onSelectionContextMenu:O,noPanClassName:L,disableKeyboardA11y:B})))};c3.displayName="FlowRenderer";var GG=E.memo(c3);function HG(n){return Rn(E.useCallback(t=>n?OL(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes(),[n]))}function $G(n){const e={input:Zh(n.input||qL),default:Zh(n.default||Xw),output:Zh(n.output||YL),group:Zh(n.group||x1)},t={},r=Object.keys(n).filter(i=>!["input","default","output","group"].includes(i)).reduce((i,s)=>(i[s]=Zh(n[s]||Xw),i),t);return{...e,...r}}const WG=({x:n,y:e,width:t,height:r,origin:i})=>!t||!r?{x:n,y:e}:i[0]<0||i[1]<0||i[0]>1||i[1]>1?{x:n,y:e}:{x:n-t*i[0],y:e-r*i[1]},qG=n=>({nodesDraggable:n.nodesDraggable,nodesConnectable:n.nodesConnectable,nodesFocusable:n.nodesFocusable,elementsSelectable:n.elementsSelectable,updateNodeDimensions:n.updateNodeDimensions,onError:n.onError}),u3=n=>{const{nodesDraggable:e,nodesConnectable:t,nodesFocusable:r,elementsSelectable:i,updateNodeDimensions:s,onError:a}=Rn(qG,Ar),o=HG(n.onlyRenderVisibleElements),l=E.useRef(),u=E.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const h=new ResizeObserver(p=>{const m=p.map(g=>({id:g.target.getAttribute("data-id"),nodeElement:g.target,forceUpdate:!0}));s(m)});return l.current=h,h},[]);return E.useEffect(()=>()=>{l?.current?.disconnect()},[]),we.createElement("div",{className:"react-flow__nodes",style:y1},o.map(h=>{let p=h.type||"default";n.nodeTypes[p]||(a?.("003",go.error003(p)),p="default");const m=n.nodeTypes[p]||n.nodeTypes.default,g=!!(h.draggable||e&&typeof h.draggable>"u"),y=!!(h.selectable||i&&typeof h.selectable>"u"),b=!!(h.connectable||t&&typeof h.connectable>"u"),_=!!(h.focusable||r&&typeof h.focusable>"u"),x=n.nodeExtent?d1(h.positionAbsolute,n.nodeExtent):h.positionAbsolute,N=x?.x??0,T=x?.y??0,S=WG({x:N,y:T,width:h.width??0,height:h.height??0,origin:n.nodeOrigin});return we.createElement(m,{key:h.id,id:h.id,className:h.className,style:h.style,type:p,data:h.data,sourcePosition:h.sourcePosition||Nt.Bottom,targetPosition:h.targetPosition||Nt.Top,hidden:h.hidden,xPos:N,yPos:T,xPosOrigin:S.x,yPosOrigin:S.y,selectNodesOnDrag:n.selectNodesOnDrag,onClick:n.onNodeClick,onMouseEnter:n.onNodeMouseEnter,onMouseMove:n.onNodeMouseMove,onMouseLeave:n.onNodeMouseLeave,onContextMenu:n.onNodeContextMenu,onDoubleClick:n.onNodeDoubleClick,selected:!!h.selected,isDraggable:g,isSelectable:y,isConnectable:b,isFocusable:_,resizeObserver:u,dragHandle:h.dragHandle,zIndex:h[Wn]?.z??0,isParent:!!h[Wn]?.isParent,noDragClassName:n.noDragClassName,noPanClassName:n.noPanClassName,initialized:!!h.width&&!!h.height,rfId:n.rfId,disableKeyboardA11y:n.disableKeyboardA11y,ariaLabel:h.ariaLabel,hasHandleBounds:!!h[Wn]?.handleBounds})}))};u3.displayName="NodeRenderer";var XG=E.memo(u3);const YG=(n,e,t)=>t===Nt.Left?n-e:t===Nt.Right?n+e:n,KG=(n,e,t)=>t===Nt.Top?n-e:t===Nt.Bottom?n+e:n,AC="react-flow__edgeupdater",RC=({position:n,centerX:e,centerY:t,radius:r=10,onMouseDown:i,onMouseEnter:s,onMouseOut:a,type:o})=>we.createElement("circle",{onMouseDown:i,onMouseEnter:s,onMouseOut:a,className:Or([AC,`${AC}-${o}`]),cx:YG(e,r,n),cy:KG(t,r,n),r,stroke:"transparent",fill:"transparent"}),ZG=()=>!0;var fu=n=>{const e=({id:t,className:r,type:i,data:s,onClick:a,onEdgeDoubleClick:o,selected:l,animated:u,label:h,labelStyle:p,labelShowBg:m,labelBgStyle:g,labelBgPadding:y,labelBgBorderRadius:b,style:_,source:x,target:N,sourceX:T,sourceY:S,targetX:M,targetY:C,sourcePosition:R,targetPosition:F,elementsSelectable:k,hidden:D,sourceHandleId:P,targetHandleId:G,onContextMenu:$,onMouseEnter:U,onMouseMove:K,onMouseLeave:O,reconnectRadius:j,onReconnect:L,onReconnectStart:B,onReconnectEnd:V,markerEnd:z,markerStart:Y,rfId:se,ariaLabel:J,isFocusable:q,isReconnectable:Q,pathOptions:te,interactionWidth:X,disableKeyboardA11y:ce})=>{const me=E.useRef(null),[Re,He]=E.useState(!1),[Qe,ie]=E.useState(!1),Et=yr(),yt=E.useMemo(()=>`url('#${Ww(Y,se)}')`,[Y,se]),tt=E.useMemo(()=>`url('#${Ww(z,se)}')`,[z,se]);if(D)return null;const Ne=Ke=>{const{edges:lt,addSelectedEdges:De,unselectNodesAndEdges:et,multiSelectionActive:St}=Et.getState(),pt=lt.find(We=>We.id===t);pt&&(k&&(Et.setState({nodesSelectionActive:!1}),pt.selected&&St?(et({nodes:[],edges:[pt]}),me.current?.blur()):De([t])),a&&a(Ke,pt))},_t=Yh(t,Et.getState,o),it=Yh(t,Et.getState,$),wt=Yh(t,Et.getState,U),fn=Yh(t,Et.getState,K),ne=Yh(t,Et.getState,O),W=(Ke,lt)=>{if(Ke.button!==0)return;const{edges:De,isValidConnection:et}=Et.getState(),St=lt?N:x,pt=(lt?G:P)||null,We=lt?"target":"source",Mt=et||ZG,le=lt,Ze=De.find(Be=>Be.id===t);ie(!0),B?.(Ke,Ze,We);const Ie=Be=>{ie(!1),V?.(Be,Ze,We)};GL({event:Ke,handleId:pt,nodeId:St,onConnect:Be=>L?.(Ze,Be),isTarget:le,getState:Et.getState,setState:Et.setState,isValidConnection:Mt,edgeUpdaterType:We,onReconnectEnd:Ie})},ye=Ke=>W(Ke,!0),Ce=Ke=>W(Ke,!1),Pe=()=>He(!0),Te=()=>He(!1),ut=!k&&!a,qe=Ke=>{if(!ce&&RL.includes(Ke.key)&&k){const{unselectNodesAndEdges:lt,addSelectedEdges:De,edges:et}=Et.getState();Ke.key==="Escape"?(me.current?.blur(),lt({edges:[et.find(pt=>pt.id===t)]})):De([t])}};return we.createElement("g",{className:Or(["react-flow__edge",`react-flow__edge-${i}`,r,{selected:l,animated:u,inactive:ut,updating:Re}]),onClick:Ne,onDoubleClick:_t,onContextMenu:it,onMouseEnter:wt,onMouseMove:fn,onMouseLeave:ne,onKeyDown:q?qe:void 0,tabIndex:q?0:void 0,role:q?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":J===null?void 0:J||`Edge from ${x} to ${N}`,"aria-describedby":q?`${QL}-${se}`:void 0,ref:me},!Qe&&we.createElement(n,{id:t,source:x,target:N,selected:l,animated:u,label:h,labelStyle:p,labelShowBg:m,labelBgStyle:g,labelBgPadding:y,labelBgBorderRadius:b,data:s,style:_,sourceX:T,sourceY:S,targetX:M,targetY:C,sourcePosition:R,targetPosition:F,sourceHandleId:P,targetHandleId:G,markerStart:yt,markerEnd:tt,pathOptions:te,interactionWidth:X}),Q&&we.createElement(we.Fragment,null,(Q==="source"||Q===!0)&&we.createElement(RC,{position:R,centerX:T,centerY:S,radius:j,onMouseDown:ye,onMouseEnter:Pe,onMouseOut:Te,type:"source"}),(Q==="target"||Q===!0)&&we.createElement(RC,{position:F,centerX:M,centerY:C,radius:j,onMouseDown:Ce,onMouseEnter:Pe,onMouseOut:Te,type:"target"})))};return e.displayName="EdgeWrapper",E.memo(e)};function QG(n){const e={default:fu(n.default||rx),straight:fu(n.bezier||p1),step:fu(n.step||f1),smoothstep:fu(n.step||zx),simplebezier:fu(n.simplebezier||h1)},t={},r=Object.keys(n).filter(i=>!["default","bezier"].includes(i)).reduce((i,s)=>(i[s]=fu(n[s]||rx),i),t);return{...e,...r}}function PC(n,e,t=null){const r=(t?.x||0)+e.x,i=(t?.y||0)+e.y,s=t?.width||e.width,a=t?.height||e.height;switch(n){case Nt.Top:return{x:r+s/2,y:i};case Nt.Right:return{x:r+s,y:i+a/2};case Nt.Bottom:return{x:r+s/2,y:i+a};case Nt.Left:return{x:r,y:i+a/2}}}function kC(n,e){return n?n.length===1||!e?n[0]:e&&n.find(t=>t.id===e)||null:null}const JG=(n,e,t,r,i,s)=>{const a=PC(t,n,e),o=PC(s,r,i);return{sourceX:a.x,sourceY:a.y,targetX:o.x,targetY:o.y}};function eH({sourcePos:n,targetPos:e,sourceWidth:t,sourceHeight:r,targetWidth:i,targetHeight:s,width:a,height:o,transform:l}){const u={x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),x2:Math.max(n.x+t,e.x+i),y2:Math.max(n.y+r,e.y+s)};u.x===u.x2&&(u.x2+=1),u.y===u.y2&&(u.y2+=1);const h=sp({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:a/l[2],height:o/l[2]}),p=Math.max(0,Math.min(h.x2,u.x2)-Math.max(h.x,u.x)),m=Math.max(0,Math.min(h.y2,u.y2)-Math.max(h.y,u.y));return Math.ceil(p*m)>0}function LC(n){const e=n?.[Wn]?.handleBounds||null,t=e&&n?.width&&n?.height&&typeof n?.positionAbsolute?.x<"u"&&typeof n?.positionAbsolute?.y<"u";return[{x:n?.positionAbsolute?.x||0,y:n?.positionAbsolute?.y||0,width:n?.width||0,height:n?.height||0},e,!!t]}const tH=[{level:0,isMaxLevel:!0,edges:[]}];function nH(n,e,t=!1){let r=-1;const i=n.reduce((a,o)=>{const l=ms(o.zIndex);let u=l?o.zIndex:0;if(t){const h=e.get(o.target),p=e.get(o.source),m=o.selected||h?.selected||p?.selected,g=Math.max(p?.[Wn]?.z||0,h?.[Wn]?.z||0,1e3);u=(l?o.zIndex:0)+(m?g:0)}return a[u]?a[u].push(o):a[u]=[o],r=u>r?u:r,a},{}),s=Object.entries(i).map(([a,o])=>{const l=+a;return{edges:o,level:l,isMaxLevel:l===r}});return s.length===0?tH:s}function rH(n,e,t){const r=Rn(E.useCallback(i=>n?i.edges.filter(s=>{const a=e.get(s.source),o=e.get(s.target);return a?.width&&a?.height&&o?.width&&o?.height&&eH({sourcePos:a.positionAbsolute||{x:0,y:0},targetPos:o.positionAbsolute||{x:0,y:0},sourceWidth:a.width,sourceHeight:a.height,targetWidth:o.width,targetHeight:o.height,width:i.width,height:i.height,transform:i.transform})}):i.edges,[n,e]));return nH(r,e,t)}const iH=({color:n="none",strokeWidth:e=1})=>we.createElement("polyline",{style:{stroke:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),sH=({color:n="none",strokeWidth:e=1})=>we.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),DC={[nx.Arrow]:iH,[nx.ArrowClosed]:sH};function aH(n){const e=yr();return E.useMemo(()=>Object.prototype.hasOwnProperty.call(DC,n)?DC[n]:(e.getState().onError?.("009",go.error009(n)),null),[n])}const oH=({id:n,type:e,color:t,width:r=12.5,height:i=12.5,markerUnits:s="strokeWidth",strokeWidth:a,orient:o="auto-start-reverse"})=>{const l=aH(e);return l?we.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:o,refX:"0",refY:"0"},we.createElement(l,{color:t,strokeWidth:a})):null},lH=({defaultColor:n,rfId:e})=>t=>{const r=[];return t.edges.reduce((i,s)=>([s.markerStart,s.markerEnd].forEach(a=>{if(a&&typeof a=="object"){const o=Ww(a,e);r.includes(o)||(i.push({id:o,color:a.color||n,...a}),r.push(o))}}),i),[]).sort((i,s)=>i.id.localeCompare(s.id))},d3=({defaultColor:n,rfId:e})=>{const t=Rn(E.useCallback(lH({defaultColor:n,rfId:e}),[n,e]),(r,i)=>!(r.length!==i.length||r.some((s,a)=>s.id!==i[a].id)));return we.createElement("defs",null,t.map(r=>we.createElement(oH,{id:r.id,key:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient})))};d3.displayName="MarkerDefinitions";var cH=E.memo(d3);const uH=n=>({nodesConnectable:n.nodesConnectable,edgesFocusable:n.edgesFocusable,edgesUpdatable:n.edgesUpdatable,elementsSelectable:n.elementsSelectable,width:n.width,height:n.height,connectionMode:n.connectionMode,nodeInternals:n.nodeInternals,onError:n.onError}),h3=({defaultMarkerColor:n,onlyRenderVisibleElements:e,elevateEdgesOnSelect:t,rfId:r,edgeTypes:i,noPanClassName:s,onEdgeContextMenu:a,onEdgeMouseEnter:o,onEdgeMouseMove:l,onEdgeMouseLeave:u,onEdgeClick:h,onEdgeDoubleClick:p,onReconnect:m,onReconnectStart:g,onReconnectEnd:y,reconnectRadius:b,children:_,disableKeyboardA11y:x})=>{const{edgesFocusable:N,edgesUpdatable:T,elementsSelectable:S,width:M,height:C,connectionMode:R,nodeInternals:F,onError:k}=Rn(uH,Ar),D=rH(e,F,t);return M?we.createElement(we.Fragment,null,D.map(({level:P,edges:G,isMaxLevel:$})=>we.createElement("svg",{key:P,style:{zIndex:P},width:M,height:C,className:"react-flow__edges react-flow__container"},$&&we.createElement(cH,{defaultColor:n,rfId:r}),we.createElement("g",null,G.map(U=>{const[K,O,j]=LC(F.get(U.source)),[L,B,V]=LC(F.get(U.target));if(!j||!V)return null;let z=U.type||"default";i[z]||(k?.("011",go.error011(z)),z="default");const Y=i[z]||i.default,se=R===xl.Strict?B.target:(B.target??[]).concat(B.source??[]),J=kC(O.source,U.sourceHandle),q=kC(se,U.targetHandle),Q=J?.position||Nt.Bottom,te=q?.position||Nt.Top,X=!!(U.focusable||N&&typeof U.focusable>"u"),ce=U.reconnectable||U.updatable,me=typeof m<"u"&&(ce||T&&typeof ce>"u");if(!J||!q)return k?.("008",go.error008(J,U)),null;const{sourceX:Re,sourceY:He,targetX:Qe,targetY:ie}=JG(K,J,Q,L,q,te);return we.createElement(Y,{key:U.id,id:U.id,className:Or([U.className,s]),type:z,data:U.data,selected:!!U.selected,animated:!!U.animated,hidden:!!U.hidden,label:U.label,labelStyle:U.labelStyle,labelShowBg:U.labelShowBg,labelBgStyle:U.labelBgStyle,labelBgPadding:U.labelBgPadding,labelBgBorderRadius:U.labelBgBorderRadius,style:U.style,source:U.source,target:U.target,sourceHandleId:U.sourceHandle,targetHandleId:U.targetHandle,markerEnd:U.markerEnd,markerStart:U.markerStart,sourceX:Re,sourceY:He,targetX:Qe,targetY:ie,sourcePosition:Q,targetPosition:te,elementsSelectable:S,onContextMenu:a,onMouseEnter:o,onMouseMove:l,onMouseLeave:u,onClick:h,onEdgeDoubleClick:p,onReconnect:m,onReconnectStart:g,onReconnectEnd:y,reconnectRadius:b,rfId:r,ariaLabel:U.ariaLabel,isFocusable:X,isReconnectable:me,pathOptions:"pathOptions"in U?U.pathOptions:void 0,interactionWidth:U.interactionWidth,disableKeyboardA11y:x})})))),_):null};h3.displayName="EdgeRenderer";var dH=E.memo(h3);const hH=n=>`translate(${n.transform[0]}px,${n.transform[1]}px) scale(${n.transform[2]})`;function fH({children:n}){const e=Rn(hH);return we.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:e}},n)}function pH(n){const e=Gx(),t=E.useRef(!1);E.useEffect(()=>{!t.current&&e.viewportInitialized&&n&&(setTimeout(()=>n(e),1),t.current=!0)},[n,e.viewportInitialized])}const mH={[Nt.Left]:Nt.Right,[Nt.Right]:Nt.Left,[Nt.Top]:Nt.Bottom,[Nt.Bottom]:Nt.Top},f3=({nodeId:n,handleType:e,style:t,type:r=al.Bezier,CustomComponent:i,connectionStatus:s})=>{const{fromNode:a,handleId:o,toX:l,toY:u,connectionMode:h}=Rn(E.useCallback(C=>({fromNode:C.nodeInternals.get(n),handleId:C.connectionHandleId,toX:(C.connectionPosition.x-C.transform[0])/C.transform[2],toY:(C.connectionPosition.y-C.transform[1])/C.transform[2],connectionMode:C.connectionMode}),[n]),Ar),p=a?.[Wn]?.handleBounds;let m=p?.[e];if(h===xl.Loose&&(m=m||p?.[e==="source"?"target":"source"]),!a||!m)return null;const g=o?m.find(C=>C.id===o):m[0],y=g?g.x+g.width/2:(a.width??0)/2,b=g?g.y+g.height/2:a.height??0,_=(a.positionAbsolute?.x??0)+y,x=(a.positionAbsolute?.y??0)+b,N=g?.position,T=N?mH[N]:null;if(!N||!T)return null;if(i)return we.createElement(i,{connectionLineType:r,connectionLineStyle:t,fromNode:a,fromHandle:g,fromX:_,fromY:x,toX:l,toY:u,fromPosition:N,toPosition:T,connectionStatus:s});let S="";const M={sourceX:_,sourceY:x,sourcePosition:N,targetX:l,targetY:u,targetPosition:T};return r===al.Bezier?[S]=IL(M):r===al.Step?[S]=$w({...M,borderRadius:0}):r===al.SmoothStep?[S]=$w(M):r===al.SimpleBezier?[S]=DL(M):S=`M${_},${x} ${l},${u}`,we.createElement("path",{d:S,fill:"none",className:"react-flow__connection-path",style:t})};f3.displayName="ConnectionLine";const gH=n=>({nodeId:n.connectionNodeId,handleType:n.connectionHandleType,nodesConnectable:n.nodesConnectable,connectionStatus:n.connectionStatus,width:n.width,height:n.height});function xH({containerStyle:n,style:e,type:t,component:r}){const{nodeId:i,handleType:s,nodesConnectable:a,width:o,height:l,connectionStatus:u}=Rn(gH,Ar);return!(i&&s&&o&&a)?null:we.createElement("svg",{style:n,width:o,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},we.createElement("g",{className:Or(["react-flow__connection",u])},we.createElement(f3,{nodeId:i,handleType:s,style:e,type:t,CustomComponent:r,connectionStatus:u})))}function IC(n,e){return E.useRef(null),yr(),E.useMemo(()=>e(n),[n])}const p3=({nodeTypes:n,edgeTypes:e,onMove:t,onMoveStart:r,onMoveEnd:i,onInit:s,onNodeClick:a,onEdgeClick:o,onNodeDoubleClick:l,onEdgeDoubleClick:u,onNodeMouseEnter:h,onNodeMouseMove:p,onNodeMouseLeave:m,onNodeContextMenu:g,onSelectionContextMenu:y,onSelectionStart:b,onSelectionEnd:_,connectionLineType:x,connectionLineStyle:N,connectionLineComponent:T,connectionLineContainerStyle:S,selectionKeyCode:M,selectionOnDrag:C,selectionMode:R,multiSelectionKeyCode:F,panActivationKeyCode:k,zoomActivationKeyCode:D,deleteKeyCode:P,onlyRenderVisibleElements:G,elementsSelectable:$,selectNodesOnDrag:U,defaultViewport:K,translateExtent:O,minZoom:j,maxZoom:L,preventScrolling:B,defaultMarkerColor:V,zoomOnScroll:z,zoomOnPinch:Y,panOnScroll:se,panOnScrollSpeed:J,panOnScrollMode:q,zoomOnDoubleClick:Q,panOnDrag:te,onPaneClick:X,onPaneMouseEnter:ce,onPaneMouseMove:me,onPaneMouseLeave:Re,onPaneScroll:He,onPaneContextMenu:Qe,onEdgeContextMenu:ie,onEdgeMouseEnter:Et,onEdgeMouseMove:yt,onEdgeMouseLeave:tt,onReconnect:Ne,onReconnectStart:_t,onReconnectEnd:it,reconnectRadius:wt,noDragClassName:fn,noWheelClassName:ne,noPanClassName:W,elevateEdgesOnSelect:ye,disableKeyboardA11y:Ce,nodeOrigin:Pe,nodeExtent:Te,rfId:ut})=>{const qe=IC(n,$G),Ke=IC(e,QG);return pH(s),we.createElement(GG,{onPaneClick:X,onPaneMouseEnter:ce,onPaneMouseMove:me,onPaneMouseLeave:Re,onPaneContextMenu:Qe,onPaneScroll:He,deleteKeyCode:P,selectionKeyCode:M,selectionOnDrag:C,selectionMode:R,onSelectionStart:b,onSelectionEnd:_,multiSelectionKeyCode:F,panActivationKeyCode:k,zoomActivationKeyCode:D,elementsSelectable:$,onMove:t,onMoveStart:r,onMoveEnd:i,zoomOnScroll:z,zoomOnPinch:Y,zoomOnDoubleClick:Q,panOnScroll:se,panOnScrollSpeed:J,panOnScrollMode:q,panOnDrag:te,defaultViewport:K,translateExtent:O,minZoom:j,maxZoom:L,onSelectionContextMenu:y,preventScrolling:B,noDragClassName:fn,noWheelClassName:ne,noPanClassName:W,disableKeyboardA11y:Ce},we.createElement(fH,null,we.createElement(dH,{edgeTypes:Ke,onEdgeClick:o,onEdgeDoubleClick:u,onlyRenderVisibleElements:G,onEdgeContextMenu:ie,onEdgeMouseEnter:Et,onEdgeMouseMove:yt,onEdgeMouseLeave:tt,onReconnect:Ne,onReconnectStart:_t,onReconnectEnd:it,reconnectRadius:wt,defaultMarkerColor:V,noPanClassName:W,elevateEdgesOnSelect:!!ye,disableKeyboardA11y:Ce,rfId:ut},we.createElement(xH,{style:N,type:x,component:T,containerStyle:S})),we.createElement("div",{className:"react-flow__edgelabel-renderer"}),we.createElement(XG,{nodeTypes:qe,onNodeClick:a,onNodeDoubleClick:l,onNodeMouseEnter:h,onNodeMouseMove:p,onNodeMouseLeave:m,onNodeContextMenu:g,selectNodesOnDrag:U,onlyRenderVisibleElements:G,noPanClassName:W,noDragClassName:fn,disableKeyboardA11y:Ce,nodeOrigin:Pe,nodeExtent:Te,rfId:ut})))};p3.displayName="GraphView";var yH=E.memo(p3);const Kw=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Wo={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:Kw,nodeExtent:Kw,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:xl.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:q8,isValidConnection:void 0},vH=()=>lz((n,e)=>({...Wo,setNodes:t=>{const{nodeInternals:r,nodeOrigin:i,elevateNodesOnSelect:s}=e();n({nodeInternals:__(t,r,i,s)})},getNodes:()=>Array.from(e().nodeInternals.values()),setEdges:t=>{const{defaultEdgeOptions:r={}}=e();n({edges:t.map(i=>({...r,...i}))})},setDefaultNodesAndEdges:(t,r)=>{const i=typeof t<"u",s=typeof r<"u",a=i?__(t,new Map,e().nodeOrigin,e().elevateNodesOnSelect):new Map;n({nodeInternals:a,edges:s?r:[],hasDefaultNodes:i,hasDefaultEdges:s})},updateNodeDimensions:t=>{const{onNodesChange:r,nodeInternals:i,fitViewOnInit:s,fitViewOnInitDone:a,fitViewOnInitOptions:o,domNode:l,nodeOrigin:u}=e(),h=l?.querySelector(".react-flow__viewport");if(!h)return;const p=window.getComputedStyle(h),{m22:m}=new window.DOMMatrixReadOnly(p.transform),g=t.reduce((b,_)=>{const x=i.get(_.id);if(x?.hidden)i.set(x.id,{...x,[Wn]:{...x[Wn],handleBounds:void 0}});else if(x){const N=u1(_.nodeElement);!!(N.width&&N.height&&(x.width!==N.width||x.height!==N.height||_.forceUpdate))&&(i.set(x.id,{...x,[Wn]:{...x[Wn],handleBounds:{source:CC(".source",_.nodeElement,m,u),target:CC(".target",_.nodeElement,m,u)}},...N}),b.push({id:x.id,type:"dimensions",dimensions:N}))}return b},[]);e3(i,u);const y=a||s&&!a&&t3(e,{initial:!0,...o});n({nodeInternals:new Map(i),fitViewOnInitDone:y}),g?.length>0&&r?.(g)},updateNodePositions:(t,r=!0,i=!1)=>{const{triggerNodeChanges:s}=e(),a=t.map(o=>{const l={id:o.id,type:"position",dragging:i};return r&&(l.positionAbsolute=o.positionAbsolute,l.position=o.position),l});s(a)},triggerNodeChanges:t=>{const{onNodesChange:r,nodeInternals:i,hasDefaultNodes:s,nodeOrigin:a,getNodes:o,elevateNodesOnSelect:l}=e();if(t?.length){if(s){const u=r3(t,o()),h=__(u,i,a,l);n({nodeInternals:h})}r?.(t)}},addSelectedNodes:t=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let a,o=null;r?a=t.map(l=>il(l,!0)):(a=qu(s(),t),o=qu(i,[])),vg({changedNodes:a,changedEdges:o,get:e,set:n})},addSelectedEdges:t=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let a,o=null;r?a=t.map(l=>il(l,!0)):(a=qu(i,t),o=qu(s(),[])),vg({changedNodes:o,changedEdges:a,get:e,set:n})},unselectNodesAndEdges:({nodes:t,edges:r}={})=>{const{edges:i,getNodes:s}=e(),a=t||s(),o=r||i,l=a.map(h=>(h.selected=!1,il(h.id,!1))),u=o.map(h=>il(h.id,!1));vg({changedNodes:l,changedEdges:u,get:e,set:n})},setMinZoom:t=>{const{d3Zoom:r,maxZoom:i}=e();r?.scaleExtent([t,i]),n({minZoom:t})},setMaxZoom:t=>{const{d3Zoom:r,minZoom:i}=e();r?.scaleExtent([i,t]),n({maxZoom:t})},setTranslateExtent:t=>{e().d3Zoom?.translateExtent(t),n({translateExtent:t})},resetSelectedElements:()=>{const{edges:t,getNodes:r}=e(),s=r().filter(o=>o.selected).map(o=>il(o.id,!1)),a=t.filter(o=>o.selected).map(o=>il(o.id,!1));vg({changedNodes:s,changedEdges:a,get:e,set:n})},setNodeExtent:t=>{const{nodeInternals:r}=e();r.forEach(i=>{i.positionAbsolute=d1(i.position,t)}),n({nodeExtent:t,nodeInternals:new Map(r)})},panBy:t=>{const{transform:r,width:i,height:s,d3Zoom:a,d3Selection:o,translateExtent:l}=e();if(!a||!o||!t.x&&!t.y)return!1;const u=ao.translate(r[0]+t.x,r[1]+t.y).scale(r[2]),h=[[0,0],[i,s]],p=a?.constrain()(u,h,l);return a.transform(o,p),r[0]!==p.x||r[1]!==p.y||r[2]!==p.k},cancelConnection:()=>n({connectionNodeId:Wo.connectionNodeId,connectionHandleId:Wo.connectionHandleId,connectionHandleType:Wo.connectionHandleType,connectionStatus:Wo.connectionStatus,connectionStartHandle:Wo.connectionStartHandle,connectionEndHandle:Wo.connectionEndHandle}),reset:()=>n({...Wo})}),Object.is),v1=({children:n})=>{const e=E.useRef(null);return e.current||(e.current=vH()),we.createElement(B8,{value:e.current},n)};v1.displayName="ReactFlowProvider";const m3=({children:n})=>E.useContext(Ux)?we.createElement(we.Fragment,null,n):we.createElement(v1,null,n);m3.displayName="ReactFlowWrapper";const _H={input:qL,default:Xw,output:YL,group:x1},bH={default:rx,straight:p1,step:f1,smoothstep:zx,simplebezier:h1},wH=[0,0],SH=[15,15],TH={x:0,y:0,zoom:1},NH={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},g3=E.forwardRef(({nodes:n,edges:e,defaultNodes:t,defaultEdges:r,className:i,nodeTypes:s=_H,edgeTypes:a=bH,onNodeClick:o,onEdgeClick:l,onInit:u,onMove:h,onMoveStart:p,onMoveEnd:m,onConnect:g,onConnectStart:y,onConnectEnd:b,onClickConnectStart:_,onClickConnectEnd:x,onNodeMouseEnter:N,onNodeMouseMove:T,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:C,onNodeDragStart:R,onNodeDrag:F,onNodeDragStop:k,onNodesDelete:D,onEdgesDelete:P,onSelectionChange:G,onSelectionDragStart:$,onSelectionDrag:U,onSelectionDragStop:K,onSelectionContextMenu:O,onSelectionStart:j,onSelectionEnd:L,connectionMode:B=xl.Strict,connectionLineType:V=al.Bezier,connectionLineStyle:z,connectionLineComponent:Y,connectionLineContainerStyle:se,deleteKeyCode:J="Backspace",selectionKeyCode:q="Shift",selectionOnDrag:Q=!1,selectionMode:te=ap.Full,panActivationKeyCode:X="Space",multiSelectionKeyCode:ce=tx()?"Meta":"Control",zoomActivationKeyCode:me=tx()?"Meta":"Control",snapToGrid:Re=!1,snapGrid:He=SH,onlyRenderVisibleElements:Qe=!1,selectNodesOnDrag:ie=!0,nodesDraggable:Et,nodesConnectable:yt,nodesFocusable:tt,nodeOrigin:Ne=wH,edgesFocusable:_t,edgesUpdatable:it,elementsSelectable:wt,defaultViewport:fn=TH,minZoom:ne=.5,maxZoom:W=2,translateExtent:ye=Kw,preventScrolling:Ce=!0,nodeExtent:Pe,defaultMarkerColor:Te="#b1b1b7",zoomOnScroll:ut=!0,zoomOnPinch:qe=!0,panOnScroll:Ke=!1,panOnScrollSpeed:lt=.5,panOnScrollMode:De=fc.Free,zoomOnDoubleClick:et=!0,panOnDrag:St=!0,onPaneClick:pt,onPaneMouseEnter:We,onPaneMouseMove:Mt,onPaneMouseLeave:le,onPaneScroll:Ze,onPaneContextMenu:Ie,children:rt,onEdgeContextMenu:Be,onEdgeDoubleClick:Le,onEdgeMouseEnter:dt,onEdgeMouseMove:Dt,onEdgeMouseLeave:pn,onEdgeUpdate:nn,onEdgeUpdateStart:Br,onEdgeUpdateEnd:Pr,onReconnect:To,onReconnectStart:qs,onReconnectEnd:_s,reconnectRadius:bs=10,edgeUpdaterRadius:Ea=10,onNodesChange:Ma,onEdgesChange:Xs,noDragClassName:jc="nodrag",noWheelClassName:No="nowheel",noPanClassName:Rl="nopan",fitView:ns=!1,fitViewOptions:Fc,connectOnClick:Oc=!0,attributionPosition:hh,proOptions:Uc,defaultEdgeOptions:Bc,elevateNodesOnSelect:zc=!0,elevateEdgesOnSelect:Z=!1,disableKeyboardA11y:he=!1,autoPanOnConnect:_e=!0,autoPanOnNodeDrag:ge=!0,connectionRadius:fe=20,isValidConnection:Ve,onError:Je,style:ct,id:at,nodeDragThreshold:Pt,...Ct},ht)=>{const Gt=at||"1";return we.createElement("div",{...Ct,style:{...ct,...NH},ref:ht,className:Or(["react-flow",i]),"data-testid":"rf__wrapper",id:at},we.createElement(m3,null,we.createElement(yH,{onInit:u,onMove:h,onMoveStart:p,onMoveEnd:m,onNodeClick:o,onEdgeClick:l,onNodeMouseEnter:N,onNodeMouseMove:T,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:C,nodeTypes:s,edgeTypes:a,connectionLineType:V,connectionLineStyle:z,connectionLineComponent:Y,connectionLineContainerStyle:se,selectionKeyCode:q,selectionOnDrag:Q,selectionMode:te,deleteKeyCode:J,multiSelectionKeyCode:ce,panActivationKeyCode:X,zoomActivationKeyCode:me,onlyRenderVisibleElements:Qe,selectNodesOnDrag:ie,defaultViewport:fn,translateExtent:ye,minZoom:ne,maxZoom:W,preventScrolling:Ce,zoomOnScroll:ut,zoomOnPinch:qe,zoomOnDoubleClick:et,panOnScroll:Ke,panOnScrollSpeed:lt,panOnScrollMode:De,panOnDrag:St,onPaneClick:pt,onPaneMouseEnter:We,onPaneMouseMove:Mt,onPaneMouseLeave:le,onPaneScroll:Ze,onPaneContextMenu:Ie,onSelectionContextMenu:O,onSelectionStart:j,onSelectionEnd:L,onEdgeContextMenu:Be,onEdgeDoubleClick:Le,onEdgeMouseEnter:dt,onEdgeMouseMove:Dt,onEdgeMouseLeave:pn,onReconnect:To??nn,onReconnectStart:qs??Br,onReconnectEnd:_s??Pr,reconnectRadius:bs??Ea,defaultMarkerColor:Te,noDragClassName:jc,noWheelClassName:No,noPanClassName:Rl,elevateEdgesOnSelect:Z,rfId:Gt,disableKeyboardA11y:he,nodeOrigin:Ne,nodeExtent:Pe}),we.createElement(mG,{nodes:n,edges:e,defaultNodes:t,defaultEdges:r,onConnect:g,onConnectStart:y,onConnectEnd:b,onClickConnectStart:_,onClickConnectEnd:x,nodesDraggable:Et,nodesConnectable:yt,nodesFocusable:tt,edgesFocusable:_t,edgesUpdatable:it,elementsSelectable:wt,elevateNodesOnSelect:zc,minZoom:ne,maxZoom:W,nodeExtent:Pe,onNodesChange:Ma,onEdgesChange:Xs,snapToGrid:Re,snapGrid:He,connectionMode:B,translateExtent:ye,connectOnClick:Oc,defaultEdgeOptions:Bc,fitView:ns,fitViewOptions:Fc,onNodesDelete:D,onEdgesDelete:P,onNodeDragStart:R,onNodeDrag:F,onNodeDragStop:k,onSelectionDrag:U,onSelectionDragStart:$,onSelectionDragStop:K,noPanClassName:Rl,nodeOrigin:Ne,rfId:Gt,autoPanOnConnect:_e,autoPanOnNodeDrag:ge,onError:Je,connectionRadius:fe,isValidConnection:Ve,nodeDragThreshold:Pt}),we.createElement(fG,{onSelectionChange:G}),rt,we.createElement(V8,{proOptions:Uc,position:hh}),we.createElement(_G,{rfId:Gt,disableKeyboardA11y:he})))});g3.displayName="ReactFlow";function x3(n){return e=>{const[t,r]=E.useState(e),i=E.useCallback(s=>r(a=>n(s,a)),[]);return[t,r,i]}}const EH=x3(r3),MH=x3(DG),y3=({id:n,x:e,y:t,width:r,height:i,style:s,color:a,strokeColor:o,strokeWidth:l,className:u,borderRadius:h,shapeRendering:p,onClick:m,selected:g})=>{const{background:y,backgroundColor:b}=s||{},_=a||y||b;return we.createElement("rect",{className:Or(["react-flow__minimap-node",{selected:g},u]),x:e,y:t,rx:h,ry:h,width:r,height:i,fill:_,stroke:o,strokeWidth:l,shapeRendering:p,onClick:m?x=>m(x,n):void 0})};y3.displayName="MiniMapNode";var CH=E.memo(y3);const AH=n=>n.nodeOrigin,RH=n=>n.getNodes().filter(e=>!e.hidden&&e.width&&e.height),T_=n=>n instanceof Function?n:()=>n;function PH({nodeStrokeColor:n="transparent",nodeColor:e="#e2e2e2",nodeClassName:t="",nodeBorderRadius:r=5,nodeStrokeWidth:i=2,nodeComponent:s=CH,onClick:a}){const o=Rn(RH,Ar),l=Rn(AH),u=T_(e),h=T_(n),p=T_(t),m=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return we.createElement(we.Fragment,null,o.map(g=>{const{x:y,y:b}=gc(g,l).positionAbsolute;return we.createElement(s,{key:g.id,x:y,y:b,width:g.width,height:g.height,style:g.style,selected:g.selected,className:p(g),color:u(g),borderRadius:r,strokeColor:h(g),strokeWidth:i,shapeRendering:m,onClick:a,id:g.id})}))}var kH=E.memo(PH);const LH=200,DH=150,IH=n=>{const e=n.getNodes(),t={x:-n.transform[0]/n.transform[2],y:-n.transform[1]/n.transform[2],width:n.width/n.transform[2],height:n.height/n.transform[2]};return{viewBB:t,boundingRect:e.length>0?$8(Vx(e,n.nodeOrigin),t):t,rfId:n.rfId}},jH="react-flow__minimap-desc";function v3({style:n,className:e,nodeStrokeColor:t="transparent",nodeColor:r="#e2e2e2",nodeClassName:i="",nodeBorderRadius:s=5,nodeStrokeWidth:a=2,nodeComponent:o,maskColor:l="rgb(240, 240, 240, 0.6)",maskStrokeColor:u="none",maskStrokeWidth:h=1,position:p="bottom-right",onClick:m,onNodeClick:g,pannable:y=!1,zoomable:b=!1,ariaLabel:_="React Flow mini map",inversePan:x=!1,zoomStep:N=10,offsetScale:T=5}){const S=yr(),M=E.useRef(null),{boundingRect:C,viewBB:R,rfId:F}=Rn(IH,Ar),k=n?.width??LH,D=n?.height??DH,P=C.width/k,G=C.height/D,$=Math.max(P,G),U=$*k,K=$*D,O=T*$,j=C.x-(U-C.width)/2-O,L=C.y-(K-C.height)/2-O,B=U+O*2,V=K+O*2,z=`${jH}-${F}`,Y=E.useRef(0);Y.current=$,E.useEffect(()=>{if(M.current){const q=qi(M.current),Q=ce=>{const{transform:me,d3Selection:Re,d3Zoom:He}=S.getState();if(ce.sourceEvent.type!=="wheel"||!Re||!He)return;const Qe=-ce.sourceEvent.deltaY*(ce.sourceEvent.deltaMode===1?.05:ce.sourceEvent.deltaMode?1:.002)*N,ie=me[2]*Math.pow(2,Qe);He.scaleTo(Re,ie)},te=ce=>{const{transform:me,d3Selection:Re,d3Zoom:He,translateExtent:Qe,width:ie,height:Et}=S.getState();if(ce.sourceEvent.type!=="mousemove"||!Re||!He)return;const yt=Y.current*Math.max(1,me[2])*(x?-1:1),tt={x:me[0]-ce.sourceEvent.movementX*yt,y:me[1]-ce.sourceEvent.movementY*yt},Ne=[[0,0],[ie,Et]],_t=ao.translate(tt.x,tt.y).scale(me[2]),it=He.constrain()(_t,Ne,Qe);He.transform(Re,it)},X=TL().on("zoom",y?te:null).on("zoom.wheel",b?Q:null);return q.call(X),()=>{q.on("zoom",null)}}},[y,b,x,N]);const se=m?q=>{const Q=us(q);m(q,{x:Q[0],y:Q[1]})}:void 0,J=g?(q,Q)=>{const te=S.getState().nodeInternals.get(Q);g(q,te)}:void 0;return we.createElement(Bx,{position:p,style:n,className:Or(["react-flow__minimap",e]),"data-testid":"rf__minimap"},we.createElement("svg",{width:k,height:D,viewBox:`${j} ${L} ${B} ${V}`,role:"img","aria-labelledby":z,ref:M,onClick:se},_&&we.createElement("title",{id:z},_),we.createElement(kH,{onClick:J,nodeColor:r,nodeStrokeColor:t,nodeBorderRadius:s,nodeClassName:i,nodeStrokeWidth:a,nodeComponent:o}),we.createElement("path",{className:"react-flow__minimap-mask",d:`M${j-O},${L-O}h${B+O*2}v${V+O*2}h${-B-O*2}z
        M${R.x},${R.y}h${R.width}v${R.height}h${-R.width}z`,fill:l,fillRule:"evenodd",stroke:u,strokeWidth:h,pointerEvents:"none"})))}v3.displayName="MiniMap";var FH=E.memo(v3);function OH(){return we.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},we.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function UH(){return we.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},we.createElement("path",{d:"M0 0h32v4.2H0z"}))}function BH(){return we.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},we.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function zH(){return we.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},we.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function VH(){return we.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},we.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Rf=({children:n,className:e,...t})=>we.createElement("button",{type:"button",className:Or(["react-flow__controls-button",e]),...t},n);Rf.displayName="ControlButton";const GH=n=>({isInteractive:n.nodesDraggable||n.nodesConnectable||n.elementsSelectable,minZoomReached:n.transform[2]<=n.minZoom,maxZoomReached:n.transform[2]>=n.maxZoom}),_3=({style:n,showZoom:e=!0,showFitView:t=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:s,onZoomOut:a,onFitView:o,onInteractiveChange:l,className:u,children:h,position:p="bottom-left"})=>{const m=yr(),[g,y]=E.useState(!1),{isInteractive:b,minZoomReached:_,maxZoomReached:x}=Rn(GH,Ar),{zoomIn:N,zoomOut:T,fitView:S}=Gx();if(E.useEffect(()=>{y(!0)},[]),!g)return null;const M=()=>{N(),s?.()},C=()=>{T(),a?.()},R=()=>{S(i),o?.()},F=()=>{m.setState({nodesDraggable:!b,nodesConnectable:!b,elementsSelectable:!b}),l?.(!b)};return we.createElement(Bx,{className:Or(["react-flow__controls",u]),position:p,style:n,"data-testid":"rf__controls"},e&&we.createElement(we.Fragment,null,we.createElement(Rf,{onClick:M,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:x},we.createElement(OH,null)),we.createElement(Rf,{onClick:C,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:_},we.createElement(UH,null))),t&&we.createElement(Rf,{className:"react-flow__controls-fitview",onClick:R,title:"fit view","aria-label":"fit view"},we.createElement(BH,null)),r&&we.createElement(Rf,{className:"react-flow__controls-interactive",onClick:F,title:"toggle interactivity","aria-label":"toggle interactivity"},b?we.createElement(VH,null):we.createElement(zH,null)),h)};_3.displayName="Controls";var HH=E.memo(_3),Gs;(function(n){n.Lines="lines",n.Dots="dots",n.Cross="cross"})(Gs||(Gs={}));function $H({color:n,dimensions:e,lineWidth:t}){return we.createElement("path",{stroke:n,strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})}function WH({color:n,radius:e}){return we.createElement("circle",{cx:e,cy:e,r:e,fill:n})}const qH={[Gs.Dots]:"#91919a",[Gs.Lines]:"#eee",[Gs.Cross]:"#e2e2e2"},XH={[Gs.Dots]:1,[Gs.Lines]:1,[Gs.Cross]:6},YH=n=>({transform:n.transform,patternId:`pattern-${n.rfId}`});function b3({id:n,variant:e=Gs.Dots,gap:t=20,size:r,lineWidth:i=1,offset:s=2,color:a,style:o,className:l}){const u=E.useRef(null),{transform:h,patternId:p}=Rn(YH,Ar),m=a||qH[e],g=r||XH[e],y=e===Gs.Dots,b=e===Gs.Cross,_=Array.isArray(t)?t:[t,t],x=[_[0]*h[2]||1,_[1]*h[2]||1],N=g*h[2],T=b?[N,N]:x,S=y?[N/s,N/s]:[T[0]/s,T[1]/s];return we.createElement("svg",{className:Or(["react-flow__background",l]),style:{...o,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:u,"data-testid":"rf__background"},we.createElement("pattern",{id:p+n,x:h[0]%x[0],y:h[1]%x[1],width:x[0],height:x[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${S[0]},-${S[1]})`},y?we.createElement(WH,{color:m,radius:N/s}):we.createElement($H,{dimensions:T,color:m,lineWidth:i})),we.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${p+n})`}))}b3.displayName="Background";var KH=E.memo(b3);const ZH=({workflow:n,onSave:e,token:t,nodeTypes:r})=>{const i=E.useRef(null),[s,a,o]=EH(n?.workflow_data.nodes||[]),[l,u,h]=MH(n?.workflow_data.edges||[]),[p,m]=E.useState(!1),[g,y]=E.useState(!1),[b,_]=E.useState([]),[x,N]=E.useState(!1),[T,S]=E.useState(null),{project:M}=Gx();E.useEffect(()=>()=>{T&&clearTimeout(T)},[T]);const C=E.useCallback(O=>u(j=>jL(O,j)),[u]),R=E.useCallback(O=>{O.preventDefault(),O.dataTransfer.dropEffect="move"},[]),F=E.useCallback(O=>{O.preventDefault();const j=i.current?.getBoundingClientRect(),L=O.dataTransfer.getData("application/reactflow");if(L&&j){const B=JSON.parse(L),V=M({x:O.clientX-j.left,y:O.clientY-j.top}),z={id:`${B.type}_${Date.now()}`,type:"default",position:V,data:{label:B.name,nodeType:B.type,icon:B.icon,description:B.description,config:D(B.type)},style:{background:k(B.type),border:`2px solid ${nl.border}`,borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:nl.textInverted,width:180,height:80,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"}};a(Y=>Y.concat(z))}},[M,a]),k=O=>O.startsWith("trigger")?Kn.trigger:O.startsWith("ai-")?Kn.ai:O.startsWith("rag-")?Kn.rag:O.startsWith("mcp-")?Kn.mcp:O.startsWith("http-")||O.includes("integration")?Kn.http:O.startsWith("logic-")?Kn.logic:O.startsWith("data-")?Kn.data:Kn.fallback,D=O=>({"ai-gpt4":{model:"gpt-4",prompt:"You are a helpful assistant. Please respond to: {{input}}",temperature:.7},"ai-claude":{model:"claude-3-sonnet",prompt:"You are a helpful assistant. Please respond to: {{input}}",temperature:.7},"http-request":{method:"GET",url:"https://api.example.com",headers:{}},"rag-search":{query:"{{input}}",top_k:5},"logic-condition":{condition:"data.value > 0",true_value:"positive",false_value:"negative"}})[O]||{},P=async()=>{const O={name:n?.name||"New Workflow",description:n?.description||"",workflow_data:{nodes:s,edges:l},category:n?.category||"custom",tags:n?.tags||[]};e(O)},G=async()=>{if(n?.id){y(!0),_([]),N(!0);try{const j=await(await fetch(`/api/workflows/${n.id}/execute`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({input_data:{message:"Test execution"}})})).json();j.success?$(j.execution.id):(_([{level:"error",message:j.error||"Failed to start workflow execution",timestamp:new Date().toISOString()}]),y(!1))}catch(O){console.error("Execution failed:",O),_([{level:"error",message:`Execution failed: ${O instanceof Error?O.message:"Unknown error"}`,timestamp:new Date().toISOString()}]),y(!1)}}},$=async O=>{try{const L=await(await fetch(`/api/workflows/executions/${O}`,{headers:{Authorization:`Bearer ${t}`}})).json();if(L.success){const B=L.execution;if(B.status==="running"){const V=setTimeout(()=>$(O),1e3);S(V)}else y(!1),_(B.execution_logs||[]),T&&(clearTimeout(T),S(null))}else _([{level:"error",message:L.error||"Failed to get execution status",timestamp:new Date().toISOString()}]),y(!1)}catch(j){console.error("Polling failed:",j),_(L=>[...L,{level:"error",message:`Polling failed: ${j instanceof Error?j.message:"Unknown error"}`,timestamp:new Date().toISOString()}]),y(!1),T&&(clearTimeout(T),S(null))}},[U,K]=E.useState(!1);return E.useEffect(()=>{const O=()=>K(window.innerWidth<640);return O(),window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[]),U?c.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col",children:[c.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-gray-700",children:[c.jsx("button",{onClick:()=>window.history.back(),className:"text-gray-400 hover:text-white",children:" Back"}),c.jsx("span",{className:"text-sm text-gray-500",children:"Mobile View"})]}),c.jsxs("div",{className:"p-6 space-y-4",children:[c.jsx("h2",{className:"text-xl font-semibold",children:"Workflow Builder Unavailable on Small Screens"}),c.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:"Editing complex graphs is disabled below the small (640px) breakpoint for usability. View execution history & metadata from the Workflows list instead. Rotate your device or use a larger screen to edit."}),c.jsx("button",{onClick:()=>N(!x),className:"px-4 py-2 bg-gray-700 rounded-lg text-sm",children:x?"Hide Logs":"Show Logs"}),x&&c.jsxs("div",{className:"border border-gray-700 rounded-lg p-4 max-h-64 overflow-y-auto text-xs space-y-2",children:[b.length===0&&c.jsx("div",{className:"text-gray-500",children:"No logs yet."}),b.map((O,j)=>c.jsxs("div",{className:"bg-gray-800/60 px-2 py-1 rounded",children:[O.timestamp,"  ",O.message]},j))]})]})]}):c.jsxs("div",{className:"h-screen bg-gray-900 flex",children:[c.jsxs("div",{className:`bg-gray-800 border-r border-gray-700 transition-all duration-300 ${p?"w-80":"w-16"}`,children:[c.jsx("div",{className:"p-4",children:c.jsxs("button",{onClick:()=>m(!p),className:"w-full flex items-center justify-center p-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:[c.jsx("span",{className:"text-xl",children:""}),p&&c.jsx("span",{className:"ml-2 font-semibold",children:"Node Palette"})]})}),p&&c.jsx("div",{className:"px-4 pb-4 overflow-y-auto h-full",children:Object.entries(r).map(([O,j])=>c.jsxs("div",{className:"mb-6",children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-300 uppercase tracking-wide mb-3",children:O}),c.jsx("div",{className:"space-y-2",children:j.map(L=>c.jsx("div",{draggable:!0,onDragStart:B=>{B.dataTransfer.setData("application/reactflow",JSON.stringify(L)),B.dataTransfer.effectAllowed="move"},className:"p-3 bg-gray-700 hover:bg-gray-600 rounded-lg cursor-grab active:cursor-grabbing transition-colors border border-gray-600 hover:border-blue-400",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("span",{className:"text-lg",children:L.icon}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-sm font-medium text-white truncate",children:L.name}),c.jsx("p",{className:"text-xs text-gray-400 truncate",children:L.description})]})]})},L.type))})]},O))})]}),c.jsxs("div",{className:"flex-1 relative",children:[c.jsx("div",{ref:i,className:"w-full h-full",children:c.jsxs(g3,{nodes:s,edges:l,onNodesChange:o,onEdgesChange:h,onConnect:C,onDrop:F,onDragOver:R,connectionMode:xl.Loose,fitView:!0,style:{background:nl.bg},children:[c.jsx(KH,{color:on.gray500,gap:20,size:1,style:{backgroundColor:nl.bg}}),c.jsx(HH,{}),c.jsx(FH,{style:{backgroundColor:nl.bgAlt,border:`1px solid ${nl.border}`},nodeColor:()=>nl.focus}),c.jsxs(Bx,{position:"top-right",className:"flex space-x-2",children:[c.jsxs("button",{onClick:P,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Save"})]}),c.jsxs("button",{onClick:G,disabled:g||!n?.id,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[c.jsx("span",{children:g?"":""}),c.jsx("span",{children:g?"Executing...":"Execute"})]}),c.jsxs("button",{onClick:()=>N(!x),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Logs"})]})]})]})}),x&&c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-64 bg-gray-800 border-t border-gray-700 p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white",children:"Execution Logs"}),c.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-white",children:""})]}),c.jsxs("div",{className:"overflow-y-auto h-40 space-y-2",children:[b.map((O,j)=>c.jsxs("div",{className:`p-2 rounded text-sm ${O.level==="error"?"bg-red-900/50 text-red-200":O.level==="success"?"bg-green-900/50 text-green-200":"bg-gray-700 text-gray-200"}`,children:[c.jsx("span",{className:"text-gray-400 text-xs",children:O.timestamp}),c.jsx("span",{className:"ml-2 font-medium",children:O.message}),O.nodeId&&c.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(",O.nodeId,")"]})]},j)),b.length===0&&c.jsx("div",{className:"text-gray-400 text-center py-8",children:"No execution logs yet. Run a workflow to see logs here."})]})]})]})]})},QH=({token:n,onBack:e})=>{const[t,r]=E.useState([]),[i,s]=E.useState([]),[a,o]=E.useState({}),[l,u]=E.useState(null),[h,p]=E.useState(null),[m,g]=E.useState([]),[y,b]=E.useState(!1),[_,x]=E.useState(!1),[N,T]=E.useState(!0),[S,M]=E.useState(""),[C,R]=E.useState("all");E.useEffect(()=>{F()},[n]);const F=async()=>{T(!0);try{const[O,j,L]=await Promise.all([fetch("/api/workflows",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/workflows/templates",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/workflows/node-types",{headers:{Authorization:`Bearer ${n}`}})]),[B,V,z]=await Promise.all([O.json(),j.json(),L.json()]);B.success&&r(B.workflows),V.success&&s(V.templates),z.success&&o(z.nodeTypes)}catch(O){console.error("Failed to load data:",O)}finally{T(!1)}},k=()=>{const O={id:0,name:"New Workflow",description:"A new workflow",workflow_data:{nodes:[],edges:[]},category:"custom",tags:[],is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};u(O),x(!0)},D=O=>{const j={...O,id:0,name:`${O.name} (Copy)`,is_template:!1};u(j),x(!0)},P=async O=>{try{const j=l?.id?`/api/workflows/${l.id}`:"/api/workflows",L=l?.id?"PUT":"POST";(await(await fetch(j,{method:L,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(O)})).json()).success&&(F(),x(!1),u(null))}catch(j){console.error("Failed to save workflow:",j)}},G=async O=>{if(confirm("Are you sure you want to delete this workflow?"))try{(await fetch(`/api/workflows/${O}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok&&F()}catch(j){console.error("Failed to delete workflow:",j)}},$=t.filter(O=>{const j=O.name.toLowerCase().includes(S.toLowerCase())||O.description.toLowerCase().includes(S.toLowerCase()),L=C==="all"||O.category===C;return j&&L}),U=[...new Set(t.map(O=>O.category)),"all"];E.useEffect(()=>{if(!h)return;let O=!1;const j=async()=>{b(!0);try{const V=await(await fetch(`/api/workflows/${h}/executions?limit=15`,{headers:{Authorization:`Bearer ${n}`}})).json();!O&&V.executions&&g(V.executions.map(z=>({id:z.id,status:z.status||"unknown",started_at:z.started_at||z.created_at,completed_at:z.completed_at,error:z.error})))}catch{}finally{O||b(!1)}};j();const L=setInterval(j,1e4);return()=>{O=!0,clearInterval(L)}},[h,n]);const K=O=>{const L={pending:"bg-gray-700 text-gray-200",running:"bg-blue-600 text-white",completed:"bg-green-600 text-white",failed:"bg-red-600 text-white",canceled:"bg-yellow-600 text-white"}[O]||"bg-gray-600 text-gray-200";return c.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-medium ${L}`,children:O})};return N?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),c.jsx("p",{className:"text-white text-xl mt-4",children:"Loading Workflow System..."})]})}):_?c.jsx(v1,{children:c.jsx(ZH,{workflow:l,onSave:P,token:n,nodeTypes:a})}):c.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[c.jsx("header",{className:"bg-gray-800 border-b border-gray-700 p-6",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700",children:" Back"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent",children:" Workflow Automation"}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Build powerful AI workflows, RAG pipelines, and multi-agent automations"})]})]}),c.jsxs("button",{onClick:k,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Create Workflow"})]})]})}),c.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[c.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row gap-4",children:[c.jsx("div",{className:"flex-1",children:c.jsx("input",{type:"text",placeholder:"Search workflows...",value:S,onChange:O=>M(O.target.value),className:"w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"})}),c.jsxs("select",{value:C,onChange:O=>R(O.target.value),className:"px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[c.jsx("option",{value:"all",children:"All Categories"}),U.filter(O=>O!=="all").map(O=>c.jsx("option",{value:O,children:O},O))]})]}),i.length>0&&c.jsxs("div",{className:"mb-12",children:[c.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Workflow Templates"})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(O=>c.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6 hover:border-blue-500 transition-colors",children:[c.jsxs("div",{className:"flex items-start justify-between mb-4",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:O.name}),c.jsx("p",{className:"text-gray-400 text-sm",children:O.description})]}),c.jsx("span",{className:"px-3 py-1 bg-blue-600 text-blue-100 rounded-full text-xs font-medium",children:O.category})]}),c.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:O.tags.map(j=>c.jsx("span",{className:"px-2 py-1 bg-gray-700 text-gray-300 rounded text-xs",children:j},j))}),c.jsx("button",{onClick:()=>D(O),className:"w-full px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg font-semibold transition-all transform hover:scale-105",children:"Use Template"})]},O.id))})]}),c.jsxs("div",{children:[c.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Your Workflows"}),c.jsxs("span",{className:"text-sm font-normal text-gray-400",children:["(",$.length,")"]})]}),$.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"text-gray-400 text-lg mb-4",children:S||C!=="all"?"No workflows match your filters":"No workflows yet"}),c.jsx("button",{onClick:k,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Create Your First Workflow"})]}):c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:$.map(O=>c.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6 hover:border-blue-500 transition-colors",children:[c.jsxs("div",{className:"flex items-start justify-between mb-4",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:O.name}),c.jsx("p",{className:"text-gray-400 text-sm",children:O.description})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:`w-3 h-3 rounded-full ${O.is_active?"bg-green-400":"bg-red-400"}`}),c.jsx("span",{className:"px-3 py-1 bg-purple-600 text-purple-100 rounded-full text-xs font-medium",children:O.category})]})]}),c.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:O.tags.map(j=>c.jsx("span",{className:"px-2 py-1 bg-gray-700 text-gray-300 rounded text-xs",children:j},j))}),c.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:[c.jsxs("div",{children:["Nodes: ",O.workflow_data.nodes?.length||0]}),c.jsxs("div",{children:["Updated:"," ",new Date(O.updated_at).toLocaleDateString()]})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:()=>{u(O),x(!0)},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Edit"}),c.jsx("button",{onClick:()=>G(O.id),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:""}),c.jsx("button",{onClick:()=>p(h===O.id.toString()?null:O.id.toString()),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold transition-colors",children:h===O.id.toString()?"Hide":"History"})]}),h===O.id.toString()&&c.jsxs("div",{className:"mt-6 border-t border-gray-700 pt-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("h4",{className:"text-sm font-semibold text-gray-300 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Recent Executions"})]}),y&&c.jsx("span",{className:"text-xs text-gray-500 animate-pulse",children:"Refreshing..."})]}),c.jsx("div",{className:"overflow-x-auto hidden md:block",children:c.jsxs("table",{className:"min-w-full text-xs",children:[c.jsx("thead",{className:"bg-gray-700/60 text-gray-300",children:c.jsxs("tr",{children:[c.jsx("th",{className:"text-left px-3 py-2",children:"ID"}),c.jsx("th",{className:"text-left px-3 py-2",children:"Status"}),c.jsx("th",{className:"text-left px-3 py-2",children:"Started"}),c.jsx("th",{className:"text-left px-3 py-2",children:"Completed"}),c.jsx("th",{className:"text-left px-3 py-2",children:"Duration"}),c.jsx("th",{className:"text-left px-3 py-2",children:"Error"})]})}),c.jsxs("tbody",{className:"divide-y divide-gray-700/70",children:[m.length===0&&!y&&c.jsx("tr",{children:c.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-500",children:"No executions yet."})}),m.map(j=>{const L=j.started_at&&j.completed_at?((new Date(j.completed_at).getTime()-new Date(j.started_at).getTime())/1e3).toFixed(2)+"s":"";return c.jsxs("tr",{className:"hover:bg-gray-700/40",children:[c.jsx("td",{className:"px-3 py-2 font-mono text-[10px]",children:j.id.slice(0,8)}),c.jsx("td",{className:"px-3 py-2",children:K(j.status)}),c.jsx("td",{className:"px-3 py-2 text-gray-400",children:j.started_at?new Date(j.started_at).toLocaleTimeString():""}),c.jsx("td",{className:"px-3 py-2 text-gray-400",children:j.completed_at?new Date(j.completed_at).toLocaleTimeString():""}),c.jsx("td",{className:"px-3 py-2 text-gray-300",children:L}),c.jsx("td",{className:"px-3 py-2 text-red-400 truncate max-w-[160px]",title:j.error||"",children:j.error?j.error.slice(0,40):""})]},j.id)})]})]})}),c.jsxs("div",{className:"md:hidden space-y-3",children:[m.length===0&&!y&&c.jsx("div",{className:"text-gray-500 text-xs",children:"No executions yet."}),m.map(j=>{const L=j.started_at&&j.completed_at?((new Date(j.completed_at).getTime()-new Date(j.started_at).getTime())/1e3).toFixed(2)+"s":"";return c.jsxs("div",{className:"border border-gray-700 rounded-lg p-3 bg-gray-800/50 text-[11px]",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"font-mono",children:j.id.slice(0,8)}),K(j.status)]}),c.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-gray-400",children:[c.jsxs("span",{children:["Start: ",j.started_at?new Date(j.started_at).toLocaleTimeString():""]}),c.jsxs("span",{children:["End: ",j.completed_at?new Date(j.completed_at).toLocaleTimeString():""]}),c.jsxs("span",{children:["Dur: ",L]})]}),j.error&&c.jsx("div",{className:"mt-1 text-red-400 truncate",title:j.error,children:j.error.slice(0,60)})]},j.id)})]}),c.jsx("div",{className:"mt-3 text-[10px] text-gray-500",children:"Auto-refresh every 10s (MVP polling)"}),c.jsxs("div",{className:"mt-4 bg-gray-800/60 border border-gray-700 rounded p-3",children:[c.jsx("div",{className:"text-[11px] text-gray-400",children:"Upcoming Monitoring Enhancements:"}),c.jsxs("ul",{className:"mt-2 text-[11px] text-gray-300 space-y-1 list-disc list-inside",children:[c.jsx("li",{children:"Real-time streaming via SSE/WebSocket"}),c.jsx("li",{children:"Node-level progress & timeline visualization"}),c.jsx("li",{children:"Log streaming with auto-scroll & filters"})]})]})]})]},O.id))})]})]})]})};function JH(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(h){u=!0,i=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}function e$(n,e,t){return e=l$(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function jC(n,e){return r$(n)||JH(n,e)||w3(n,e)||a$()}function t$(n){return n$(n)||i$(n)||w3(n)||s$()}function n$(n){if(Array.isArray(n))return Zw(n)}function r$(n){if(Array.isArray(n))return n}function i$(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function w3(n,e){if(n){if(typeof n=="string")return Zw(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Zw(n,e)}}function Zw(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function s$(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a$(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o$(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function l$(n){var e=o$(n,"string");return typeof e=="symbol"?e:String(e)}var c$=function(e,t){var r=new Set(t);return Object.assign.apply(Object,[{}].concat(t$(Object.entries(e).filter(function(i){var s=jC(i,1),a=s[0];return!r.has(a)}).map(function(i){var s=jC(i,2),a=s[0],o=s[1];return e$({},a,o)}))))};function Qw(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function u$(n){if(Array.isArray(n))return n}function d$(n){if(Array.isArray(n))return Qw(n)}function h$(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function f$(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(h){u=!0,i=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}function p$(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m$(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g$(n,e){return u$(n)||f$(n,e)||S3(n,e)||p$()}function FC(n){return d$(n)||h$(n)||S3(n)||m$()}function S3(n,e){if(n){if(typeof n=="string")return Qw(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Qw(n,e):void 0}}function x$(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,r=t===void 0?"div":t,i=e.nodeMapper,s=i===void 0?function(h){return h}:i,a=e.methodNames,o=a===void 0?[]:a,l=e.initPropNames,u=l===void 0?[]:l;return E.forwardRef(function(h,p){var m=E.useRef(),g=E.useMemo(function(){var _=Object.fromEntries(u.filter(function(x){return h.hasOwnProperty(x)}).map(function(x){return[x,h[x]]}));return n(_)},[]);OC(function(){g(s(m.current))},E.useLayoutEffect),OC(function(){return g._destructor instanceof Function?g._destructor:void 0});var y=E.useCallback(function(_){for(var x=arguments.length,N=new Array(x>1?x-1:0),T=1;T<x;T++)N[T-1]=arguments[T];return g[_]instanceof Function?g[_].apply(g,N):void 0},[g]),b=E.useRef({});return Object.keys(c$(h,[].concat(FC(o),FC(u)))).filter(function(_){return b.current[_]!==h[_]}).forEach(function(_){return y(_,h[_])}),b.current=h,E.useImperativeHandle(p,function(){return Object.fromEntries(o.map(function(_){return[_,function(){for(var x=arguments.length,N=new Array(x),T=0;T<x;T++)N[T]=arguments[T];return y.apply(void 0,[_].concat(N))}]}))},[y]),we.createElement(r,{ref:m})})}function OC(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E.useEffect,t=E.useRef(),r=E.useRef(!1),i=E.useRef(!1),s=E.useState(0),a=g$(s,2);a[0];var o=a[1];r.current&&(i.current=!0),e(function(){return r.current||(t.current=n(),r.current=!0),o(function(l){return l+1}),function(){i.current&&t.current&&t.current()}},[])}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const eh="178",jr={ROTATE:0,DOLLY:1,PAN:2},eo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},T3=0,Jw=1,N3=2,y$=0,_1=1,v$=2,Wi=3,Ai=0,bn=1,Yr=2,Ri=0,Yi=1,yd=2,vd=3,_d=4,ad=5,Kr=100,b1=101,w1=102,E3=103,M3=104,Wa=200,S1=201,T1=202,N1=203,lp=204,cp=205,E1=206,M1=207,C1=208,A1=209,R1=210,_$=211,b$=212,w$=213,S$=214,up=0,dp=1,hp=2,yl=3,fp=4,pp=5,mp=6,gp=7,qp=0,C3=1,A3=2,Pi=0,R3=1,P3=2,k3=3,L3=4,T$=5,D3=6,I3=7,P1=300,xa=301,ya=302,bd=303,wd=304,Tc=306,Nc=1e3,oa=1001,Ec=1002,An=1003,k1=1004,to=1005,pr=1006,od=1007,Ei=1008,Hn=1009,xc=1010,yc=1011,zs=1012,Er=1013,En=1014,Zn=1015,Cr=1016,Hx=1017,$x=1018,Ki=1020,Wx=35902,L1=1021,Xp=1022,qn=1023,Zi=1026,Qi=1027,Yp=1028,th=1029,no=1030,nh=1031,N$=1032,rh=1033,vc=33776,dl=33777,hl=33778,fl=33779,xp=35840,yp=35841,vp=35842,_p=35843,bp=36196,Sd=37492,Td=37496,Nd=37808,Ed=37809,Md=37810,Cd=37811,Ad=37812,Rd=37813,Pd=37814,kd=37815,Ld=37816,Dd=37817,Id=37818,jd=37819,Fd=37820,Od=37821,_c=36492,eS=36494,tS=36495,D1=36283,wp=36284,Sp=36285,Tp=36286,E$=3200,M$=3201,xo=0,j3=1,ui="",li="srgb",pa="srgb-linear",Ud="linear",st="srgb",C$=0,tc=7680,A$=7681,R$=7682,P$=7683,k$=34055,L$=34056,D$=5386,I$=512,j$=513,F$=514,O$=515,U$=516,B$=517,z$=518,nS=519,I1=512,qx=513,j1=514,Xx=515,F1=516,O1=517,U1=518,B1=519,sx=35044,Xu=35048,UC="300 es",fi=2e3,vl=2001;class _o{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const r=t[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}const Wr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let BC=1234567;const Uf=Math.PI/180,Mc=180/Math.PI;function oo(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Wr[n&255]+Wr[n>>8&255]+Wr[n>>16&255]+Wr[n>>24&255]+"-"+Wr[e&255]+Wr[e>>8&255]+"-"+Wr[e>>16&15|64]+Wr[e>>24&255]+"-"+Wr[t&63|128]+Wr[t>>8&255]+"-"+Wr[t>>16&255]+Wr[t>>24&255]+Wr[r&255]+Wr[r>>8&255]+Wr[r>>16&255]+Wr[r>>24&255]).toLowerCase()}function $t(n,e,t){return Math.max(e,Math.min(t,n))}function z1(n,e){return(n%e+e)%e}function V$(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function G$(n,e,t){return n!==e?(t-n)/(e-n):0}function Bf(n,e,t){return(1-t)*n+t*e}function H$(n,e,t,r){return Bf(n,e,1-Math.exp(-t*r))}function $$(n,e=1){return e-Math.abs(z1(n,e*2)-e)}function W$(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function q$(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function X$(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Y$(n,e){return n+Math.random()*(e-n)}function K$(n){return n*(.5-Math.random())}function Z$(n){n!==void 0&&(BC=n);let e=BC+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Q$(n){return n*Uf}function J$(n){return n*Mc}function e9(n){return(n&n-1)===0&&n!==0}function t9(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function n9(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function r9(n,e,t,r,i){const s=Math.cos,a=Math.sin,o=s(t/2),l=a(t/2),u=s((e+r)/2),h=a((e+r)/2),p=s((e-r)/2),m=a((e-r)/2),g=s((r-e)/2),y=a((r-e)/2);switch(i){case"XYX":n.set(o*h,l*p,l*m,o*u);break;case"YZY":n.set(l*m,o*h,l*p,o*u);break;case"ZXZ":n.set(l*p,l*m,o*h,o*u);break;case"XZX":n.set(o*h,l*y,l*g,o*u);break;case"YXY":n.set(l*g,o*h,l*y,o*u);break;case"ZYZ":n.set(l*y,l*g,o*h,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function di(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Ht(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const ax={DEG2RAD:Uf,RAD2DEG:Mc,generateUUID:oo,clamp:$t,euclideanModulo:z1,mapLinear:V$,inverseLerp:G$,lerp:Bf,damp:H$,pingpong:$$,smoothstep:W$,smootherstep:q$,randInt:X$,randFloat:Y$,randFloatSpread:K$,seededRandom:Z$,degToRad:Q$,radToDeg:J$,isPowerOfTwo:e9,ceilPowerOfTwo:t9,floorPowerOfTwo:n9,setQuaternionFromProperEuler:r9,normalize:Ht,denormalize:di};class je{constructor(e=0,t=0){je.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=$t(this.x,e.x,t.x),this.y=$t(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=$t(this.x,e,t),this.y=$t(this.y,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar($t(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos($t(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*i+e.x,this.y=s*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Hs{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,a,o){let l=r[i+0],u=r[i+1],h=r[i+2],p=r[i+3];const m=s[a+0],g=s[a+1],y=s[a+2],b=s[a+3];if(o===0){e[t+0]=l,e[t+1]=u,e[t+2]=h,e[t+3]=p;return}if(o===1){e[t+0]=m,e[t+1]=g,e[t+2]=y,e[t+3]=b;return}if(p!==b||l!==m||u!==g||h!==y){let _=1-o;const x=l*m+u*g+h*y+p*b,N=x>=0?1:-1,T=1-x*x;if(T>Number.EPSILON){const M=Math.sqrt(T),C=Math.atan2(M,x*N);_=Math.sin(_*C)/M,o=Math.sin(o*C)/M}const S=o*N;if(l=l*_+m*S,u=u*_+g*S,h=h*_+y*S,p=p*_+b*S,_===1-o){const M=1/Math.sqrt(l*l+u*u+h*h+p*p);l*=M,u*=M,h*=M,p*=M}}e[t]=l,e[t+1]=u,e[t+2]=h,e[t+3]=p}static multiplyQuaternionsFlat(e,t,r,i,s,a){const o=r[i],l=r[i+1],u=r[i+2],h=r[i+3],p=s[a],m=s[a+1],g=s[a+2],y=s[a+3];return e[t]=o*y+h*p+l*g-u*m,e[t+1]=l*y+h*m+u*p-o*g,e[t+2]=u*y+h*g+o*m-l*p,e[t+3]=h*y-o*p-l*m-u*g,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,u=o(r/2),h=o(i/2),p=o(s/2),m=l(r/2),g=l(i/2),y=l(s/2);switch(a){case"XYZ":this._x=m*h*p+u*g*y,this._y=u*g*p-m*h*y,this._z=u*h*y+m*g*p,this._w=u*h*p-m*g*y;break;case"YXZ":this._x=m*h*p+u*g*y,this._y=u*g*p-m*h*y,this._z=u*h*y-m*g*p,this._w=u*h*p+m*g*y;break;case"ZXY":this._x=m*h*p-u*g*y,this._y=u*g*p+m*h*y,this._z=u*h*y+m*g*p,this._w=u*h*p-m*g*y;break;case"ZYX":this._x=m*h*p-u*g*y,this._y=u*g*p+m*h*y,this._z=u*h*y-m*g*p,this._w=u*h*p+m*g*y;break;case"YZX":this._x=m*h*p+u*g*y,this._y=u*g*p+m*h*y,this._z=u*h*y-m*g*p,this._w=u*h*p-m*g*y;break;case"XZY":this._x=m*h*p-u*g*y,this._y=u*g*p-m*h*y,this._z=u*h*y+m*g*p,this._w=u*h*p+m*g*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],a=t[1],o=t[5],l=t[9],u=t[2],h=t[6],p=t[10],m=r+o+p;if(m>0){const g=.5/Math.sqrt(m+1);this._w=.25/g,this._x=(h-l)*g,this._y=(s-u)*g,this._z=(a-i)*g}else if(r>o&&r>p){const g=2*Math.sqrt(1+r-o-p);this._w=(h-l)/g,this._x=.25*g,this._y=(i+a)/g,this._z=(s+u)/g}else if(o>p){const g=2*Math.sqrt(1+o-r-p);this._w=(s-u)/g,this._x=(i+a)/g,this._y=.25*g,this._z=(l+h)/g}else{const g=2*Math.sqrt(1+p-r-o);this._w=(a-i)/g,this._x=(s+u)/g,this._y=(l+h)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs($t(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,a=e._w,o=t._x,l=t._y,u=t._z,h=t._w;return this._x=r*h+a*o+i*u-s*l,this._y=i*h+a*l+s*o-r*u,this._z=s*h+a*u+r*l-i*o,this._w=a*h-r*o-i*l-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,a=this._w;let o=a*e._w+r*e._x+i*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=i,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const g=1-t;return this._w=g*a+t*this._w,this._x=g*r+t*this._x,this._y=g*i+t*this._y,this._z=g*s+t*this._z,this.normalize(),this}const u=Math.sqrt(l),h=Math.atan2(u,o),p=Math.sin((1-t)*h)/u,m=Math.sin(t*h)/u;return this._w=a*p+this._w*m,this._x=r*p+this._x*m,this._y=i*p+this._y*m,this._z=s*p+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ee{constructor(e=0,t=0,r=0){ee.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(zC.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(zC.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,a=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*a,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*a,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*a,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,a=e.y,o=e.z,l=e.w,u=2*(a*i-o*r),h=2*(o*t-s*i),p=2*(s*r-a*t);return this.x=t+l*u+a*p-o*h,this.y=r+l*h+o*u-s*p,this.z=i+l*p+s*h-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=$t(this.x,e.x,t.x),this.y=$t(this.y,e.y,t.y),this.z=$t(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=$t(this.x,e,t),this.y=$t(this.y,e,t),this.z=$t(this.z,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar($t(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,a=t.x,o=t.y,l=t.z;return this.x=i*l-s*o,this.y=s*a-r*l,this.z=r*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return N_.copy(this).projectOnVector(e),this.sub(N_)}reflect(e){return this.sub(N_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos($t(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const N_=new ee,zC=new Hs;class Ut{constructor(e,t,r,i,s,a,o,l,u){Ut.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,a,o,l,u)}set(e,t,r,i,s,a,o,l,u){const h=this.elements;return h[0]=e,h[1]=i,h[2]=o,h[3]=t,h[4]=s,h[5]=l,h[6]=r,h[7]=a,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],o=r[3],l=r[6],u=r[1],h=r[4],p=r[7],m=r[2],g=r[5],y=r[8],b=i[0],_=i[3],x=i[6],N=i[1],T=i[4],S=i[7],M=i[2],C=i[5],R=i[8];return s[0]=a*b+o*N+l*M,s[3]=a*_+o*T+l*C,s[6]=a*x+o*S+l*R,s[1]=u*b+h*N+p*M,s[4]=u*_+h*T+p*C,s[7]=u*x+h*S+p*R,s[2]=m*b+g*N+y*M,s[5]=m*_+g*T+y*C,s[8]=m*x+g*S+y*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8];return t*a*h-t*o*u-r*s*h+r*o*l+i*s*u-i*a*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8],p=h*a-o*u,m=o*l-h*s,g=u*s-a*l,y=t*p+r*m+i*g;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=p*b,e[1]=(i*u-h*r)*b,e[2]=(o*r-i*a)*b,e[3]=m*b,e[4]=(h*t-i*l)*b,e[5]=(i*s-o*t)*b,e[6]=g*b,e[7]=(r*l-u*t)*b,e[8]=(a*t-r*s)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,a,o){const l=Math.cos(s),u=Math.sin(s);return this.set(r*l,r*u,-r*(l*a+u*o)+a+e,-i*u,i*l,-i*(-u*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(E_.makeScale(e,t)),this}rotate(e){return this.premultiply(E_.makeRotation(-e)),this}translate(e,t){return this.premultiply(E_.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const E_=new Ut;function V1(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Np(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function F3(){const n=Np("canvas");return n.style.display="block",n}const VC={};function Ji(n){n in VC||(VC[n]=!0,console.warn(n))}function i9(n,e,t){return new Promise(function(r,i){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:r()}}setTimeout(s,t)})}function s9(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function a9(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const GC=new Ut().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),HC=new Ut().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function o9(){const n={enabled:!0,workingColorSpace:pa,spaces:{},convert:function(i,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===st&&(i.r=lo(i.r),i.g=lo(i.g),i.b=lo(i.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===st&&(i.r=ld(i.r),i.g=ld(i.g),i.b=ld(i.b))),i},workingToColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},colorSpaceToWorking:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===ui?Ud:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,a){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,s){return Ji("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(i,s)},toWorkingColorSpace:function(i,s){return Ji("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(i,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[pa]:{primaries:e,whitePoint:r,transfer:Ud,toXYZ:GC,fromXYZ:HC,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:li},outputColorSpaceConfig:{drawingBufferColorSpace:li}},[li]:{primaries:e,whitePoint:r,transfer:st,toXYZ:GC,fromXYZ:HC,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:li}}}),n}const Ot=o9();function lo(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function ld(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let pu;class l9{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{pu===void 0&&(pu=Np("canvas")),pu.width=e.width,pu.height=e.height;const i=pu.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=pu}return r.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Np("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=lo(s[a]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(lo(t[r]/255)*255):t[r]=lo(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let c9=0;class G1{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:c9++}),this.uuid=oo(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?s.push(M_(i[a].image)):s.push(M_(i[a]))}else s=M_(i);r.url=s}return t||(e.images[this.uuid]=r),r}}function M_(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?l9.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let u9=0;const C_=new ee;class Jn extends _o{constructor(e=Jn.DEFAULT_IMAGE,t=Jn.DEFAULT_MAPPING,r=oa,i=oa,s=pr,a=Ei,o=qn,l=Hn,u=Jn.DEFAULT_ANISOTROPY,h=ui){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:u9++}),this.uuid=oo(),this.name="",this.source=new G1(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new je(0,0),this.repeat=new je(1,1),this.center=new je(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ut,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(C_).x}get height(){return this.source.getSize(C_).y}get depth(){return this.source.getSize(C_).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==P1)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Nc:e.x=e.x-Math.floor(e.x);break;case oa:e.x=e.x<0?0:1;break;case Ec:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Nc:e.y=e.y-Math.floor(e.y);break;case oa:e.y=e.y<0?0:1;break;case Ec:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Jn.DEFAULT_IMAGE=null;Jn.DEFAULT_MAPPING=P1;Jn.DEFAULT_ANISOTROPY=1;class Lt{constructor(e=0,t=0,r=0,i=1){Lt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*s,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*s,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*s,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const l=e.elements,u=l[0],h=l[4],p=l[8],m=l[1],g=l[5],y=l[9],b=l[2],_=l[6],x=l[10];if(Math.abs(h-m)<.01&&Math.abs(p-b)<.01&&Math.abs(y-_)<.01){if(Math.abs(h+m)<.1&&Math.abs(p+b)<.1&&Math.abs(y+_)<.1&&Math.abs(u+g+x-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const T=(u+1)/2,S=(g+1)/2,M=(x+1)/2,C=(h+m)/4,R=(p+b)/4,F=(y+_)/4;return T>S&&T>M?T<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(T),i=C/r,s=R/r):S>M?S<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(S),r=C/i,s=F/i):M<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(M),r=R/s,i=F/s),this.set(r,i,s,t),this}let N=Math.sqrt((_-y)*(_-y)+(p-b)*(p-b)+(m-h)*(m-h));return Math.abs(N)<.001&&(N=1),this.x=(_-y)/N,this.y=(p-b)/N,this.z=(m-h)/N,this.w=Math.acos((u+g+x-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=$t(this.x,e.x,t.x),this.y=$t(this.y,e.y,t.y),this.z=$t(this.z,e.z,t.z),this.w=$t(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=$t(this.x,e,t),this.y=$t(this.y,e,t),this.z=$t(this.z,e,t),this.w=$t(this.w,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar($t(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Pc extends _o{constructor(e=1,t=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:pr,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=r.depth,this.scissor=new Lt(0,0,e,t),this.scissorTest=!1,this.viewport=new Lt(0,0,e,t);const i={width:e,height:t,depth:r.depth},s=new Jn(i);this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(e={}){const t={minFilter:pr,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let r=0;r<this.textures.length;r++)this.textures[r].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new G1(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class _l extends Pc{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class H1 extends Jn{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=An,this.minFilter=An,this.wrapR=oa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class d9 extends Jn{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=An,this.minFilter=An,this.wrapR=oa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class kc{constructor(e=new ee(1/0,1/0,1/0),t=new ee(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Cs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Cs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Cs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Cs):Cs.fromBufferAttribute(s,a),Cs.applyMatrix4(e.matrixWorld),this.expandByPoint(Cs);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),bg.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),bg.copy(r.boundingBox)),bg.applyMatrix4(e.matrixWorld),this.union(bg)}const i=e.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Cs),Cs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Qh),wg.subVectors(this.max,Qh),mu.subVectors(e.a,Qh),gu.subVectors(e.b,Qh),xu.subVectors(e.c,Qh),qo.subVectors(gu,mu),Xo.subVectors(xu,gu),Gl.subVectors(mu,xu);let t=[0,-qo.z,qo.y,0,-Xo.z,Xo.y,0,-Gl.z,Gl.y,qo.z,0,-qo.x,Xo.z,0,-Xo.x,Gl.z,0,-Gl.x,-qo.y,qo.x,0,-Xo.y,Xo.x,0,-Gl.y,Gl.x,0];return!A_(t,mu,gu,xu,wg)||(t=[1,0,0,0,1,0,0,0,1],!A_(t,mu,gu,xu,wg))?!1:(Sg.crossVectors(qo,Xo),t=[Sg.x,Sg.y,Sg.z],A_(t,mu,gu,xu,wg))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Cs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Cs).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Oa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Oa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Oa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Oa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Oa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Oa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Oa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Oa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Oa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Oa=[new ee,new ee,new ee,new ee,new ee,new ee,new ee,new ee],Cs=new ee,bg=new kc,mu=new ee,gu=new ee,xu=new ee,qo=new ee,Xo=new ee,Gl=new ee,Qh=new ee,wg=new ee,Sg=new ee,Hl=new ee;function A_(n,e,t,r,i){for(let s=0,a=n.length-3;s<=a;s+=3){Hl.fromArray(n,s);const o=i.x*Math.abs(Hl.x)+i.y*Math.abs(Hl.y)+i.z*Math.abs(Hl.z),l=e.dot(Hl),u=t.dot(Hl),h=r.dot(Hl);if(Math.max(-Math.max(l,u,h),Math.min(l,u,h))>o)return!1}return!0}const h9=new kc,Jh=new ee,R_=new ee;class Kp{constructor(e=new ee,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):h9.setFromPoints(e).getCenter(r);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Jh.subVectors(e,this.center);const t=Jh.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(Jh,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(R_.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Jh.copy(e.center).add(R_)),this.expandByPoint(Jh.copy(e.center).sub(R_))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Ua=new ee,P_=new ee,Tg=new ee,Yo=new ee,k_=new ee,Ng=new ee,L_=new ee;class Yx{constructor(e=new ee,t=new ee(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ua)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ua.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ua.copy(this.origin).addScaledVector(this.direction,t),Ua.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){P_.copy(e).add(t).multiplyScalar(.5),Tg.copy(t).sub(e).normalize(),Yo.copy(this.origin).sub(P_);const s=e.distanceTo(t)*.5,a=-this.direction.dot(Tg),o=Yo.dot(this.direction),l=-Yo.dot(Tg),u=Yo.lengthSq(),h=Math.abs(1-a*a);let p,m,g,y;if(h>0)if(p=a*l-o,m=a*o-l,y=s*h,p>=0)if(m>=-y)if(m<=y){const b=1/h;p*=b,m*=b,g=p*(p+a*m+2*o)+m*(a*p+m+2*l)+u}else m=s,p=Math.max(0,-(a*m+o)),g=-p*p+m*(m+2*l)+u;else m=-s,p=Math.max(0,-(a*m+o)),g=-p*p+m*(m+2*l)+u;else m<=-y?(p=Math.max(0,-(-a*s+o)),m=p>0?-s:Math.min(Math.max(-s,-l),s),g=-p*p+m*(m+2*l)+u):m<=y?(p=0,m=Math.min(Math.max(-s,-l),s),g=m*(m+2*l)+u):(p=Math.max(0,-(a*s+o)),m=p>0?s:Math.min(Math.max(-s,-l),s),g=-p*p+m*(m+2*l)+u);else m=a>0?-s:s,p=Math.max(0,-(a*m+o)),g=-p*p+m*(m+2*l)+u;return r&&r.copy(this.origin).addScaledVector(this.direction,p),i&&i.copy(P_).addScaledVector(Tg,m),g}intersectSphere(e,t){Ua.subVectors(e.center,this.origin);const r=Ua.dot(this.direction),i=Ua.dot(Ua)-r*r,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,a,o,l;const u=1/this.direction.x,h=1/this.direction.y,p=1/this.direction.z,m=this.origin;return u>=0?(r=(e.min.x-m.x)*u,i=(e.max.x-m.x)*u):(r=(e.max.x-m.x)*u,i=(e.min.x-m.x)*u),h>=0?(s=(e.min.y-m.y)*h,a=(e.max.y-m.y)*h):(s=(e.max.y-m.y)*h,a=(e.min.y-m.y)*h),r>a||s>i||((s>r||isNaN(r))&&(r=s),(a<i||isNaN(i))&&(i=a),p>=0?(o=(e.min.z-m.z)*p,l=(e.max.z-m.z)*p):(o=(e.max.z-m.z)*p,l=(e.min.z-m.z)*p),r>l||o>i)||((o>r||r!==r)&&(r=o),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Ua)!==null}intersectTriangle(e,t,r,i,s){k_.subVectors(t,e),Ng.subVectors(r,e),L_.crossVectors(k_,Ng);let a=this.direction.dot(L_),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Yo.subVectors(this.origin,e);const l=o*this.direction.dot(Ng.crossVectors(Yo,Ng));if(l<0)return null;const u=o*this.direction.dot(k_.cross(Yo));if(u<0||l+u>a)return null;const h=-o*Yo.dot(L_);return h<0?null:this.at(h/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Yt{constructor(e,t,r,i,s,a,o,l,u,h,p,m,g,y,b,_){Yt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,a,o,l,u,h,p,m,g,y,b,_)}set(e,t,r,i,s,a,o,l,u,h,p,m,g,y,b,_){const x=this.elements;return x[0]=e,x[4]=t,x[8]=r,x[12]=i,x[1]=s,x[5]=a,x[9]=o,x[13]=l,x[2]=u,x[6]=h,x[10]=p,x[14]=m,x[3]=g,x[7]=y,x[11]=b,x[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Yt().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/yu.setFromMatrixColumn(e,0).length(),s=1/yu.setFromMatrixColumn(e,1).length(),a=1/yu.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(i),u=Math.sin(i),h=Math.cos(s),p=Math.sin(s);if(e.order==="XYZ"){const m=a*h,g=a*p,y=o*h,b=o*p;t[0]=l*h,t[4]=-l*p,t[8]=u,t[1]=g+y*u,t[5]=m-b*u,t[9]=-o*l,t[2]=b-m*u,t[6]=y+g*u,t[10]=a*l}else if(e.order==="YXZ"){const m=l*h,g=l*p,y=u*h,b=u*p;t[0]=m+b*o,t[4]=y*o-g,t[8]=a*u,t[1]=a*p,t[5]=a*h,t[9]=-o,t[2]=g*o-y,t[6]=b+m*o,t[10]=a*l}else if(e.order==="ZXY"){const m=l*h,g=l*p,y=u*h,b=u*p;t[0]=m-b*o,t[4]=-a*p,t[8]=y+g*o,t[1]=g+y*o,t[5]=a*h,t[9]=b-m*o,t[2]=-a*u,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const m=a*h,g=a*p,y=o*h,b=o*p;t[0]=l*h,t[4]=y*u-g,t[8]=m*u+b,t[1]=l*p,t[5]=b*u+m,t[9]=g*u-y,t[2]=-u,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const m=a*l,g=a*u,y=o*l,b=o*u;t[0]=l*h,t[4]=b-m*p,t[8]=y*p+g,t[1]=p,t[5]=a*h,t[9]=-o*h,t[2]=-u*h,t[6]=g*p+y,t[10]=m-b*p}else if(e.order==="XZY"){const m=a*l,g=a*u,y=o*l,b=o*u;t[0]=l*h,t[4]=-p,t[8]=u*h,t[1]=m*p+b,t[5]=a*h,t[9]=g*p-y,t[2]=y*p-g,t[6]=o*h,t[10]=b*p+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(f9,e,p9)}lookAt(e,t,r){const i=this.elements;return Bi.subVectors(e,t),Bi.lengthSq()===0&&(Bi.z=1),Bi.normalize(),Ko.crossVectors(r,Bi),Ko.lengthSq()===0&&(Math.abs(r.z)===1?Bi.x+=1e-4:Bi.z+=1e-4,Bi.normalize(),Ko.crossVectors(r,Bi)),Ko.normalize(),Eg.crossVectors(Bi,Ko),i[0]=Ko.x,i[4]=Eg.x,i[8]=Bi.x,i[1]=Ko.y,i[5]=Eg.y,i[9]=Bi.y,i[2]=Ko.z,i[6]=Eg.z,i[10]=Bi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],o=r[4],l=r[8],u=r[12],h=r[1],p=r[5],m=r[9],g=r[13],y=r[2],b=r[6],_=r[10],x=r[14],N=r[3],T=r[7],S=r[11],M=r[15],C=i[0],R=i[4],F=i[8],k=i[12],D=i[1],P=i[5],G=i[9],$=i[13],U=i[2],K=i[6],O=i[10],j=i[14],L=i[3],B=i[7],V=i[11],z=i[15];return s[0]=a*C+o*D+l*U+u*L,s[4]=a*R+o*P+l*K+u*B,s[8]=a*F+o*G+l*O+u*V,s[12]=a*k+o*$+l*j+u*z,s[1]=h*C+p*D+m*U+g*L,s[5]=h*R+p*P+m*K+g*B,s[9]=h*F+p*G+m*O+g*V,s[13]=h*k+p*$+m*j+g*z,s[2]=y*C+b*D+_*U+x*L,s[6]=y*R+b*P+_*K+x*B,s[10]=y*F+b*G+_*O+x*V,s[14]=y*k+b*$+_*j+x*z,s[3]=N*C+T*D+S*U+M*L,s[7]=N*R+T*P+S*K+M*B,s[11]=N*F+T*G+S*O+M*V,s[15]=N*k+T*$+S*j+M*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],a=e[1],o=e[5],l=e[9],u=e[13],h=e[2],p=e[6],m=e[10],g=e[14],y=e[3],b=e[7],_=e[11],x=e[15];return y*(+s*l*p-i*u*p-s*o*m+r*u*m+i*o*g-r*l*g)+b*(+t*l*g-t*u*m+s*a*m-i*a*g+i*u*h-s*l*h)+_*(+t*u*p-t*o*g-s*a*p+r*a*g+s*o*h-r*u*h)+x*(-i*o*h-t*l*p+t*o*m+i*a*p-r*a*m+r*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8],p=e[9],m=e[10],g=e[11],y=e[12],b=e[13],_=e[14],x=e[15],N=p*_*u-b*m*u+b*l*g-o*_*g-p*l*x+o*m*x,T=y*m*u-h*_*u-y*l*g+a*_*g+h*l*x-a*m*x,S=h*b*u-y*p*u+y*o*g-a*b*g-h*o*x+a*p*x,M=y*p*l-h*b*l-y*o*m+a*b*m+h*o*_-a*p*_,C=t*N+r*T+i*S+s*M;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/C;return e[0]=N*R,e[1]=(b*m*s-p*_*s-b*i*g+r*_*g+p*i*x-r*m*x)*R,e[2]=(o*_*s-b*l*s+b*i*u-r*_*u-o*i*x+r*l*x)*R,e[3]=(p*l*s-o*m*s-p*i*u+r*m*u+o*i*g-r*l*g)*R,e[4]=T*R,e[5]=(h*_*s-y*m*s+y*i*g-t*_*g-h*i*x+t*m*x)*R,e[6]=(y*l*s-a*_*s-y*i*u+t*_*u+a*i*x-t*l*x)*R,e[7]=(a*m*s-h*l*s+h*i*u-t*m*u-a*i*g+t*l*g)*R,e[8]=S*R,e[9]=(y*p*s-h*b*s-y*r*g+t*b*g+h*r*x-t*p*x)*R,e[10]=(a*b*s-y*o*s+y*r*u-t*b*u-a*r*x+t*o*x)*R,e[11]=(h*o*s-a*p*s-h*r*u+t*p*u+a*r*g-t*o*g)*R,e[12]=M*R,e[13]=(h*b*i-y*p*i+y*r*m-t*b*m-h*r*_+t*p*_)*R,e[14]=(y*o*i-a*b*i-y*r*l+t*b*l+a*r*_-t*o*_)*R,e[15]=(a*p*i-h*o*i+h*r*l-t*p*l-a*r*m+t*o*m)*R,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,a=e.x,o=e.y,l=e.z,u=s*a,h=s*o;return this.set(u*a+r,u*o-i*l,u*l+i*o,0,u*o+i*l,h*o+r,h*l-i*a,0,u*l-i*o,h*l+i*a,s*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,a){return this.set(1,r,s,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,a=t._y,o=t._z,l=t._w,u=s+s,h=a+a,p=o+o,m=s*u,g=s*h,y=s*p,b=a*h,_=a*p,x=o*p,N=l*u,T=l*h,S=l*p,M=r.x,C=r.y,R=r.z;return i[0]=(1-(b+x))*M,i[1]=(g+S)*M,i[2]=(y-T)*M,i[3]=0,i[4]=(g-S)*C,i[5]=(1-(m+x))*C,i[6]=(_+N)*C,i[7]=0,i[8]=(y+T)*R,i[9]=(_-N)*R,i[10]=(1-(m+b))*R,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=yu.set(i[0],i[1],i[2]).length();const a=yu.set(i[4],i[5],i[6]).length(),o=yu.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],As.copy(this);const u=1/s,h=1/a,p=1/o;return As.elements[0]*=u,As.elements[1]*=u,As.elements[2]*=u,As.elements[4]*=h,As.elements[5]*=h,As.elements[6]*=h,As.elements[8]*=p,As.elements[9]*=p,As.elements[10]*=p,t.setFromRotationMatrix(As),r.x=s,r.y=a,r.z=o,this}makePerspective(e,t,r,i,s,a,o=fi){const l=this.elements,u=2*s/(t-e),h=2*s/(r-i),p=(t+e)/(t-e),m=(r+i)/(r-i);let g,y;if(o===fi)g=-(a+s)/(a-s),y=-2*a*s/(a-s);else if(o===vl)g=-a/(a-s),y=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=u,l[4]=0,l[8]=p,l[12]=0,l[1]=0,l[5]=h,l[9]=m,l[13]=0,l[2]=0,l[6]=0,l[10]=g,l[14]=y,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,i,s,a,o=fi){const l=this.elements,u=1/(t-e),h=1/(r-i),p=1/(a-s),m=(t+e)*u,g=(r+i)*h;let y,b;if(o===fi)y=(a+s)*p,b=-2*p;else if(o===vl)y=s*p,b=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-m,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-g,l[2]=0,l[6]=0,l[10]=b,l[14]=-y,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const yu=new ee,As=new Yt,f9=new ee(0,0,0),p9=new ee(1,1,1),Ko=new ee,Eg=new ee,Bi=new ee,$C=new Yt,WC=new Hs;class ki{constructor(e=0,t=0,r=0,i=ki.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],a=i[4],o=i[8],l=i[1],u=i[5],h=i[9],p=i[2],m=i[6],g=i[10];switch(t){case"XYZ":this._y=Math.asin($t(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,g),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(m,u),this._z=0);break;case"YXZ":this._x=Math.asin(-$t(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,g),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin($t(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-p,g),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-$t(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(m,g),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin($t(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(o,g));break;case"XZY":this._z=Math.asin(-$t(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,u),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return $C.makeRotationFromQuaternion(e),this.setFromRotationMatrix($C,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return WC.setFromEuler(this),this.setFromQuaternion(WC,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ki.DEFAULT_ORDER="XYZ";class $1{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let m9=0;const qC=new ee,vu=new Hs,Ba=new Yt,Mg=new ee,ef=new ee,g9=new ee,x9=new Hs,XC=new ee(1,0,0),YC=new ee(0,1,0),KC=new ee(0,0,1),ZC={type:"added"},y9={type:"removed"},_u={type:"childadded",child:null},D_={type:"childremoved",child:null};class er extends _o{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:m9++}),this.uuid=oo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=er.DEFAULT_UP.clone();const e=new ee,t=new ki,r=new Hs,i=new ee(1,1,1);function s(){r.setFromEuler(t,!1)}function a(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Yt},normalMatrix:{value:new Ut}}),this.matrix=new Yt,this.matrixWorld=new Yt,this.matrixAutoUpdate=er.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return vu.setFromAxisAngle(e,t),this.quaternion.multiply(vu),this}rotateOnWorldAxis(e,t){return vu.setFromAxisAngle(e,t),this.quaternion.premultiply(vu),this}rotateX(e){return this.rotateOnAxis(XC,e)}rotateY(e){return this.rotateOnAxis(YC,e)}rotateZ(e){return this.rotateOnAxis(KC,e)}translateOnAxis(e,t){return qC.copy(e).applyQuaternion(this.quaternion),this.position.add(qC.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(XC,e)}translateY(e){return this.translateOnAxis(YC,e)}translateZ(e){return this.translateOnAxis(KC,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ba.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Mg.copy(e):Mg.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),ef.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ba.lookAt(ef,Mg,this.up):Ba.lookAt(Mg,ef,this.up),this.quaternion.setFromRotationMatrix(Ba),i&&(Ba.extractRotation(i.matrixWorld),vu.setFromRotationMatrix(Ba),this.quaternion.premultiply(vu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ZC),_u.child=e,this.dispatchEvent(_u),_u.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(y9),D_.child=e,this.dispatchEvent(D_),D_.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ba.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ba.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ba),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ZC),_u.child=e,this.dispatchEvent(_u),_u.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ef,e,g9),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ef,x9,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,h=l.length;u<h;u++){const p=l[u];s(e.shapes,p)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(s(e.materials,this.material[l]));i.material=o}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];i.animations.push(s(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),u=a(e.textures),h=a(e.images),p=a(e.shapes),m=a(e.skeletons),g=a(e.animations),y=a(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),h.length>0&&(r.images=h),p.length>0&&(r.shapes=p),m.length>0&&(r.skeletons=m),g.length>0&&(r.animations=g),y.length>0&&(r.nodes=y)}return r.object=i,r;function a(o){const l=[];for(const u in o){const h=o[u];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}er.DEFAULT_UP=new ee(0,1,0);er.DEFAULT_MATRIX_AUTO_UPDATE=!0;er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Rs=new ee,za=new ee,I_=new ee,Va=new ee,bu=new ee,wu=new ee,QC=new ee,j_=new ee,F_=new ee,O_=new ee,U_=new Lt,B_=new Lt,z_=new Lt;class ps{constructor(e=new ee,t=new ee,r=new ee){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Rs.subVectors(e,t),i.cross(Rs);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){Rs.subVectors(i,t),za.subVectors(r,t),I_.subVectors(e,t);const a=Rs.dot(Rs),o=Rs.dot(za),l=Rs.dot(I_),u=za.dot(za),h=za.dot(I_),p=a*u-o*o;if(p===0)return s.set(0,0,0),null;const m=1/p,g=(u*l-o*h)*m,y=(a*h-o*l)*m;return s.set(1-g-y,y,g)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Va)===null?!1:Va.x>=0&&Va.y>=0&&Va.x+Va.y<=1}static getInterpolation(e,t,r,i,s,a,o,l){return this.getBarycoord(e,t,r,i,Va)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Va.x),l.addScaledVector(a,Va.y),l.addScaledVector(o,Va.z),l)}static getInterpolatedAttribute(e,t,r,i,s,a){return U_.setScalar(0),B_.setScalar(0),z_.setScalar(0),U_.fromBufferAttribute(e,t),B_.fromBufferAttribute(e,r),z_.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(U_,s.x),a.addScaledVector(B_,s.y),a.addScaledVector(z_,s.z),a}static isFrontFacing(e,t,r,i){return Rs.subVectors(r,t),za.subVectors(e,t),Rs.cross(za).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Rs.subVectors(this.c,this.b),za.subVectors(this.a,this.b),Rs.cross(za).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ps.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ps.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,s){return ps.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return ps.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ps.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let a,o;bu.subVectors(i,r),wu.subVectors(s,r),j_.subVectors(e,r);const l=bu.dot(j_),u=wu.dot(j_);if(l<=0&&u<=0)return t.copy(r);F_.subVectors(e,i);const h=bu.dot(F_),p=wu.dot(F_);if(h>=0&&p<=h)return t.copy(i);const m=l*p-h*u;if(m<=0&&l>=0&&h<=0)return a=l/(l-h),t.copy(r).addScaledVector(bu,a);O_.subVectors(e,s);const g=bu.dot(O_),y=wu.dot(O_);if(y>=0&&g<=y)return t.copy(s);const b=g*u-l*y;if(b<=0&&u>=0&&y<=0)return o=u/(u-y),t.copy(r).addScaledVector(wu,o);const _=h*y-g*p;if(_<=0&&p-h>=0&&g-y>=0)return QC.subVectors(s,i),o=(p-h)/(p-h+(g-y)),t.copy(i).addScaledVector(QC,o);const x=1/(_+b+m);return a=b*x,o=m*x,t.copy(r).addScaledVector(bu,a).addScaledVector(wu,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const O3={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Zo={h:0,s:0,l:0},Cg={h:0,s:0,l:0};function V_(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class vt{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=li){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ot.colorSpaceToWorking(this,t),this}setRGB(e,t,r,i=Ot.workingColorSpace){return this.r=e,this.g=t,this.b=r,Ot.colorSpaceToWorking(this,i),this}setHSL(e,t,r,i=Ot.workingColorSpace){if(e=z1(e,1),t=$t(t,0,1),r=$t(r,0,1),t===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,a=2*r-s;this.r=V_(a,s,e+1/3),this.g=V_(a,s,e),this.b=V_(a,s,e-1/3)}return Ot.colorSpaceToWorking(this,i),this}setStyle(e,t=li){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=li){const r=O3[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=lo(e.r),this.g=lo(e.g),this.b=lo(e.b),this}copyLinearToSRGB(e){return this.r=ld(e.r),this.g=ld(e.g),this.b=ld(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=li){return Ot.workingToColorSpace(qr.copy(this),e),Math.round($t(qr.r*255,0,255))*65536+Math.round($t(qr.g*255,0,255))*256+Math.round($t(qr.b*255,0,255))}getHexString(e=li){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ot.workingColorSpace){Ot.workingToColorSpace(qr.copy(this),t);const r=qr.r,i=qr.g,s=qr.b,a=Math.max(r,i,s),o=Math.min(r,i,s);let l,u;const h=(o+a)/2;if(o===a)l=0,u=0;else{const p=a-o;switch(u=h<=.5?p/(a+o):p/(2-a-o),a){case r:l=(i-s)/p+(i<s?6:0);break;case i:l=(s-r)/p+2;break;case s:l=(r-i)/p+4;break}l/=6}return e.h=l,e.s=u,e.l=h,e}getRGB(e,t=Ot.workingColorSpace){return Ot.workingToColorSpace(qr.copy(this),t),e.r=qr.r,e.g=qr.g,e.b=qr.b,e}getStyle(e=li){Ot.workingToColorSpace(qr.copy(this),e);const t=qr.r,r=qr.g,i=qr.b;return e!==li?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(Zo),this.setHSL(Zo.h+e,Zo.s+t,Zo.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Zo),e.getHSL(Cg);const r=Bf(Zo.h,Cg.h,t),i=Bf(Zo.s,Cg.s,t),s=Bf(Zo.l,Cg.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const qr=new vt;vt.NAMES=O3;let v9=0;class Qr extends _o{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:v9++}),this.uuid=oo(),this.name="",this.type="Material",this.blending=Yi,this.side=Ai,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=lp,this.blendDst=cp,this.blendEquation=Kr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new vt(0,0,0),this.blendAlpha=0,this.depthFunc=yl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=nS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tc,this.stencilZFail=tc,this.stencilZPass=tc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Yi&&(r.blending=this.blending),this.side!==Ai&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==lp&&(r.blendSrc=this.blendSrc),this.blendDst!==cp&&(r.blendDst=this.blendDst),this.blendEquation!==Kr&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==yl&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==nS&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==tc&&(r.stencilFail=this.stencilFail),this.stencilZFail!==tc&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==tc&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(t){const s=i(e.textures),a=i(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Us extends Qr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ki,this.combine=qp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ya=_9();function _9(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),r=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(r[l]=0,r[l|256]=32768,i[l]=24,i[l|256]=24):u<-14?(r[l]=1024>>-u-14,r[l|256]=1024>>-u-14|32768,i[l]=-u-1,i[l|256]=-u-1):u<=15?(r[l]=u+15<<10,r[l|256]=u+15<<10|32768,i[l]=13,i[l|256]=13):u<128?(r[l]=31744,r[l|256]=64512,i[l]=24,i[l|256]=24):(r[l]=31744,r[l|256]=64512,i[l]=13,i[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,h=0;for(;(u&8388608)===0;)u<<=1,h-=8388608;u&=-8388609,h+=947912704,s[l]=u|h}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:o}}function zi(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=$t(n,-65504,65504),Ya.floatView[0]=n;const e=Ya.uint32View[0],t=e>>23&511;return Ya.baseTable[t]+((e&8388607)>>Ya.shiftTable[t])}function Ag(n){const e=n>>10;return Ya.uint32View[0]=Ya.mantissaTable[Ya.offsetTable[e]+(n&1023)]+Ya.exponentTable[e],Ya.floatView[0]}const ir=new ee,Rg=new je;let b9=0;class Fr{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:b9++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=sx,this.updateRanges=[],this.gpuType=Zn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Rg.fromBufferAttribute(this,t),Rg.applyMatrix3(e),this.setXY(t,Rg.x,Rg.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix3(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix4(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.applyNormalMatrix(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ir.fromBufferAttribute(this,t),ir.transformDirection(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=di(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Ht(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=di(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=di(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=di(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=di(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array),i=Ht(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array),i=Ht(i,this.array),s=Ht(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==sx&&(e.usage=this.usage),e}}class W1 extends Fr{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class q1 extends Fr{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class U3 extends Fr{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=Ag(this.array[e*this.itemSize]);return this.normalized&&(t=di(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize]=zi(t),this}getY(e){let t=Ag(this.array[e*this.itemSize+1]);return this.normalized&&(t=di(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize+1]=zi(t),this}getZ(e){let t=Ag(this.array[e*this.itemSize+2]);return this.normalized&&(t=di(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize+2]=zi(t),this}getW(e){let t=Ag(this.array[e*this.itemSize+3]);return this.normalized&&(t=di(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ht(t,this.array)),this.array[e*this.itemSize+3]=zi(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array)),this.array[e+0]=zi(t),this.array[e+1]=zi(r),this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array),i=Ht(i,this.array)),this.array[e+0]=zi(t),this.array[e+1]=zi(r),this.array[e+2]=zi(i),this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array),i=Ht(i,this.array),s=Ht(s,this.array)),this.array[e+0]=zi(t),this.array[e+1]=zi(r),this.array[e+2]=zi(i),this.array[e+3]=zi(s),this}}class tr extends Fr{constructor(e,t,r){super(new Float32Array(e),t,r)}}let w9=0;const cs=new Yt,G_=new er,Su=new ee,Vi=new kc,tf=new kc,Nr=new ee;class ei extends _o{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:w9++}),this.uuid=oo(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(V1(e)?q1:W1)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Ut().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return cs.makeRotationFromQuaternion(e),this.applyMatrix4(cs),this}rotateX(e){return cs.makeRotationX(e),this.applyMatrix4(cs),this}rotateY(e){return cs.makeRotationY(e),this.applyMatrix4(cs),this}rotateZ(e){return cs.makeRotationZ(e),this.applyMatrix4(cs),this}translate(e,t,r){return cs.makeTranslation(e,t,r),this.applyMatrix4(cs),this}scale(e,t,r){return cs.makeScale(e,t,r),this.applyMatrix4(cs),this}lookAt(e){return G_.lookAt(e),G_.updateMatrix(),this.applyMatrix4(G_.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Su).negate(),this.translate(Su.x,Su.y,Su.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const a=e[i];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new tr(r,3))}else{const r=Math.min(e.length,t.count);for(let i=0;i<r;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new kc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ee(-1/0,-1/0,-1/0),new ee(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];Vi.setFromBufferAttribute(s),this.morphTargetsRelative?(Nr.addVectors(this.boundingBox.min,Vi.min),this.boundingBox.expandByPoint(Nr),Nr.addVectors(this.boundingBox.max,Vi.max),this.boundingBox.expandByPoint(Nr)):(this.boundingBox.expandByPoint(Vi.min),this.boundingBox.expandByPoint(Vi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Kp);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ee,1/0);return}if(e){const r=this.boundingSphere.center;if(Vi.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];tf.setFromBufferAttribute(o),this.morphTargetsRelative?(Nr.addVectors(Vi.min,tf.min),Vi.expandByPoint(Nr),Nr.addVectors(Vi.max,tf.max),Vi.expandByPoint(Nr)):(Vi.expandByPoint(tf.min),Vi.expandByPoint(tf.max))}Vi.getCenter(r);let i=0;for(let s=0,a=e.count;s<a;s++)Nr.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Nr));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],l=this.morphTargetsRelative;for(let u=0,h=o.count;u<h;u++)Nr.fromBufferAttribute(o,u),l&&(Su.fromBufferAttribute(e,u),Nr.add(Su)),i=Math.max(i,r.distanceToSquared(Nr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Fr(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let F=0;F<r.count;F++)o[F]=new ee,l[F]=new ee;const u=new ee,h=new ee,p=new ee,m=new je,g=new je,y=new je,b=new ee,_=new ee;function x(F,k,D){u.fromBufferAttribute(r,F),h.fromBufferAttribute(r,k),p.fromBufferAttribute(r,D),m.fromBufferAttribute(s,F),g.fromBufferAttribute(s,k),y.fromBufferAttribute(s,D),h.sub(u),p.sub(u),g.sub(m),y.sub(m);const P=1/(g.x*y.y-y.x*g.y);isFinite(P)&&(b.copy(h).multiplyScalar(y.y).addScaledVector(p,-g.y).multiplyScalar(P),_.copy(p).multiplyScalar(g.x).addScaledVector(h,-y.x).multiplyScalar(P),o[F].add(b),o[k].add(b),o[D].add(b),l[F].add(_),l[k].add(_),l[D].add(_))}let N=this.groups;N.length===0&&(N=[{start:0,count:e.count}]);for(let F=0,k=N.length;F<k;++F){const D=N[F],P=D.start,G=D.count;for(let $=P,U=P+G;$<U;$+=3)x(e.getX($+0),e.getX($+1),e.getX($+2))}const T=new ee,S=new ee,M=new ee,C=new ee;function R(F){M.fromBufferAttribute(i,F),C.copy(M);const k=o[F];T.copy(k),T.sub(M.multiplyScalar(M.dot(k))).normalize(),S.crossVectors(C,k);const P=S.dot(l[F])<0?-1:1;a.setXYZW(F,T.x,T.y,T.z,P)}for(let F=0,k=N.length;F<k;++F){const D=N[F],P=D.start,G=D.count;for(let $=P,U=P+G;$<U;$+=3)R(e.getX($+0)),R(e.getX($+1)),R(e.getX($+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Fr(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let m=0,g=r.count;m<g;m++)r.setXYZ(m,0,0,0);const i=new ee,s=new ee,a=new ee,o=new ee,l=new ee,u=new ee,h=new ee,p=new ee;if(e)for(let m=0,g=e.count;m<g;m+=3){const y=e.getX(m+0),b=e.getX(m+1),_=e.getX(m+2);i.fromBufferAttribute(t,y),s.fromBufferAttribute(t,b),a.fromBufferAttribute(t,_),h.subVectors(a,s),p.subVectors(i,s),h.cross(p),o.fromBufferAttribute(r,y),l.fromBufferAttribute(r,b),u.fromBufferAttribute(r,_),o.add(h),l.add(h),u.add(h),r.setXYZ(y,o.x,o.y,o.z),r.setXYZ(b,l.x,l.y,l.z),r.setXYZ(_,u.x,u.y,u.z)}else for(let m=0,g=t.count;m<g;m+=3)i.fromBufferAttribute(t,m+0),s.fromBufferAttribute(t,m+1),a.fromBufferAttribute(t,m+2),h.subVectors(a,s),p.subVectors(i,s),h.cross(p),r.setXYZ(m+0,h.x,h.y,h.z),r.setXYZ(m+1,h.x,h.y,h.z),r.setXYZ(m+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Nr.fromBufferAttribute(e,t),Nr.normalize(),e.setXYZ(t,Nr.x,Nr.y,Nr.z)}toNonIndexed(){function e(o,l){const u=o.array,h=o.itemSize,p=o.normalized,m=new u.constructor(l.length*h);let g=0,y=0;for(let b=0,_=l.length;b<_;b++){o.isInterleavedBufferAttribute?g=l[b]*o.data.stride+o.offset:g=l[b]*h;for(let x=0;x<h;x++)m[y++]=u[g++]}return new Fr(m,h,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ei,r=this.index.array,i=this.attributes;for(const o in i){const l=i[o],u=e(l,r);t.setAttribute(o,u)}const s=this.morphAttributes;for(const o in s){const l=[],u=s[o];for(let h=0,p=u.length;h<p;h++){const m=u[h],g=e(m,r);l.push(g)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const u=a[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const u=r[l];e.data.attributes[l]=u.toJSON(e.data)}const i={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],h=[];for(let p=0,m=u.length;p<m;p++){const g=u[p];h.push(g.toJSON(e.data))}h.length>0&&(i[l]=h,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const u in i){const h=i[u];this.setAttribute(u,h.clone(t))}const s=e.morphAttributes;for(const u in s){const h=[],p=s[u];for(let m=0,g=p.length;m<g;m++)h.push(p[m].clone(t));this.morphAttributes[u]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,h=a.length;u<h;u++){const p=a[u];this.addGroup(p.start,p.count,p.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const JC=new Yt,$l=new Yx,Pg=new Kp,eA=new ee,kg=new ee,Lg=new ee,Dg=new ee,H_=new ee,Ig=new ee,tA=new ee,jg=new ee;class Xn extends er{constructor(e=new ei,t=new Us){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(s&&o){Ig.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const h=o[l],p=s[l];h!==0&&(H_.fromBufferAttribute(p,e),a?Ig.addScaledVector(H_,h):Ig.addScaledVector(H_.sub(t),h))}t.add(Ig)}return t}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Pg.copy(r.boundingSphere),Pg.applyMatrix4(s),$l.copy(e.ray).recast(e.near),!(Pg.containsPoint($l.origin)===!1&&($l.intersectSphere(Pg,eA)===null||$l.origin.distanceToSquared(eA)>(e.far-e.near)**2))&&(JC.copy(s).invert(),$l.copy(e.ray).applyMatrix4(JC),!(r.boundingBox!==null&&$l.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,$l)))}_computeIntersections(e,t,r){let i;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,u=s.attributes.uv,h=s.attributes.uv1,p=s.attributes.normal,m=s.groups,g=s.drawRange;if(o!==null)if(Array.isArray(a))for(let y=0,b=m.length;y<b;y++){const _=m[y],x=a[_.materialIndex],N=Math.max(_.start,g.start),T=Math.min(o.count,Math.min(_.start+_.count,g.start+g.count));for(let S=N,M=T;S<M;S+=3){const C=o.getX(S),R=o.getX(S+1),F=o.getX(S+2);i=Fg(this,x,e,r,u,h,p,C,R,F),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=_.materialIndex,t.push(i))}}else{const y=Math.max(0,g.start),b=Math.min(o.count,g.start+g.count);for(let _=y,x=b;_<x;_+=3){const N=o.getX(_),T=o.getX(_+1),S=o.getX(_+2);i=Fg(this,a,e,r,u,h,p,N,T,S),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(a))for(let y=0,b=m.length;y<b;y++){const _=m[y],x=a[_.materialIndex],N=Math.max(_.start,g.start),T=Math.min(l.count,Math.min(_.start+_.count,g.start+g.count));for(let S=N,M=T;S<M;S+=3){const C=S,R=S+1,F=S+2;i=Fg(this,x,e,r,u,h,p,C,R,F),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=_.materialIndex,t.push(i))}}else{const y=Math.max(0,g.start),b=Math.min(l.count,g.start+g.count);for(let _=y,x=b;_<x;_+=3){const N=_,T=_+1,S=_+2;i=Fg(this,a,e,r,u,h,p,N,T,S),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}}}}function S9(n,e,t,r,i,s,a,o){let l;if(e.side===bn?l=r.intersectTriangle(a,s,i,!0,o):l=r.intersectTriangle(i,s,a,e.side===Ai,o),l===null)return null;jg.copy(o),jg.applyMatrix4(n.matrixWorld);const u=t.ray.origin.distanceTo(jg);return u<t.near||u>t.far?null:{distance:u,point:jg.clone(),object:n}}function Fg(n,e,t,r,i,s,a,o,l,u){n.getVertexPosition(o,kg),n.getVertexPosition(l,Lg),n.getVertexPosition(u,Dg);const h=S9(n,e,t,r,kg,Lg,Dg,tA);if(h){const p=new ee;ps.getBarycoord(tA,kg,Lg,Dg,p),i&&(h.uv=ps.getInterpolatedAttribute(i,o,l,u,p,new je)),s&&(h.uv1=ps.getInterpolatedAttribute(s,o,l,u,p,new je)),a&&(h.normal=ps.getInterpolatedAttribute(a,o,l,u,p,new ee),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const m={a:o,b:l,c:u,normal:new ee,materialIndex:0};ps.getNormal(kg,Lg,Dg,m.normal),h.face=m,h.barycoord=p}return h}class Lc extends ei{constructor(e=1,t=1,r=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:a};const o=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const l=[],u=[],h=[],p=[];let m=0,g=0;y("z","y","x",-1,-1,r,t,e,a,s,0),y("z","y","x",1,-1,r,t,-e,a,s,1),y("x","z","y",1,1,e,r,t,i,a,2),y("x","z","y",1,-1,e,r,-t,i,a,3),y("x","y","z",1,-1,e,t,r,i,s,4),y("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(l),this.setAttribute("position",new tr(u,3)),this.setAttribute("normal",new tr(h,3)),this.setAttribute("uv",new tr(p,2));function y(b,_,x,N,T,S,M,C,R,F,k){const D=S/R,P=M/F,G=S/2,$=M/2,U=C/2,K=R+1,O=F+1;let j=0,L=0;const B=new ee;for(let V=0;V<O;V++){const z=V*P-$;for(let Y=0;Y<K;Y++){const se=Y*D-G;B[b]=se*N,B[_]=z*T,B[x]=U,u.push(B.x,B.y,B.z),B[b]=0,B[_]=0,B[x]=C>0?1:-1,h.push(B.x,B.y,B.z),p.push(Y/R),p.push(1-V/F),j+=1}}for(let V=0;V<F;V++)for(let z=0;z<R;z++){const Y=m+z+K*V,se=m+z+K*(V+1),J=m+(z+1)+K*(V+1),q=m+(z+1)+K*V;l.push(Y,se,q),l.push(se,J,q),L+=6}o.addGroup(g,L,k),g+=L,m+=j}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Bd(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function ai(n){const e={};for(let t=0;t<n.length;t++){const r=Bd(n[t]);for(const i in r)e[i]=r[i]}return e}function T9(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function B3(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Ot.workingColorSpace}const z3={clone:Bd,merge:ai};var N9=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,E9=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class va extends Qr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=N9,this.fragmentShader=E9,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Bd(e.uniforms),this.uniformsGroups=T9(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class X1 extends er{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Yt,this.projectionMatrix=new Yt,this.projectionMatrixInverse=new Yt,this.coordinateSystem=fi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Qo=new ee,nA=new je,rA=new je;class Mr extends X1{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Mc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Uf*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Mc*2*Math.atan(Math.tan(Uf*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){Qo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Qo.x,Qo.y).multiplyScalar(-e/Qo.z),Qo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Qo.x,Qo.y).multiplyScalar(-e/Qo.z)}getViewSize(e,t){return this.getViewBounds(e,nA,rA),t.subVectors(rA,nA)}setViewOffset(e,t,r,i,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Uf*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,u=a.fullHeight;s+=a.offsetX*i/l,t-=a.offsetY*r/u,i*=a.width/l,r*=a.height/u}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Tu=-90,Nu=1;class V3 extends er{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Mr(Tu,Nu,e,t);i.layers=this.layers,this.add(i);const s=new Mr(Tu,Nu,e,t);s.layers=this.layers,this.add(s);const a=new Mr(Tu,Nu,e,t);a.layers=this.layers,this.add(a);const o=new Mr(Tu,Nu,e,t);o.layers=this.layers,this.add(o);const l=new Mr(Tu,Nu,e,t);l.layers=this.layers,this.add(l);const u=new Mr(Tu,Nu,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,a,o,l]=t;for(const u of t)this.remove(u);if(e===fi)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===vl)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,u,h]=this.children,p=e.getRenderTarget(),m=e.getActiveCubeFace(),g=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const b=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,a),e.setRenderTarget(r,2,i),e.render(t,o),e.setRenderTarget(r,3,i),e.render(t,l),e.setRenderTarget(r,4,i),e.render(t,u),r.texture.generateMipmaps=b,e.setRenderTarget(r,5,i),e.render(t,h),e.setRenderTarget(p,m,g),e.xr.enabled=y,r.texture.needsPMREMUpdate=!0}}class Zp extends Jn{constructor(e=[],t=xa,r,i,s,a,o,l,u,h){super(e,t,r,i,s,a,o,l,u,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class G3 extends _l{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new Zp(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Lc(5,5,5),s=new va({name:"CubemapFromEquirect",uniforms:Bd(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:bn,blending:Ri});s.uniforms.tEquirect.value=t;const a=new Xn(i,s),o=t.minFilter;return t.minFilter===Ei&&(t.minFilter=pr),new V3(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,r=!0,i=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,r,i);e.setRenderTarget(s)}}let Yu=class extends er{constructor(){super(),this.isGroup=!0,this.type="Group"}};const M9={type:"move"};class I0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Yu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Yu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ee,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ee),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Yu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ee,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ee),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,a=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){a=!0;for(const b of e.hand.values()){const _=t.getJointPose(b,r),x=this._getHandJoint(u,b);_!==null&&(x.matrix.fromArray(_.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,x.jointRadius=_.radius),x.visible=_!==null}const h=u.joints["index-finger-tip"],p=u.joints["thumb-tip"],m=h.position.distanceTo(p.position),g=.02,y=.005;u.inputState.pinching&&m>g+y?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&m<=g-y&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(M9)))}return o!==null&&(o.visible=i!==null),l!==null&&(l.visible=s!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Yu;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class Kx extends er{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ki,this.environmentIntensity=1,this.environmentRotation=new ki,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Y1{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=sx,this.updateRanges=[],this.version=0,this.uuid=oo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=oo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=oo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const si=new ee;class Ep{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)si.fromBufferAttribute(this,t),si.applyMatrix4(e),this.setXYZ(t,si.x,si.y,si.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)si.fromBufferAttribute(this,t),si.applyNormalMatrix(e),this.setXYZ(t,si.x,si.y,si.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)si.fromBufferAttribute(this,t),si.transformDirection(e),this.setXYZ(t,si.x,si.y,si.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=di(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Ht(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=Ht(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ht(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ht(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ht(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=di(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=di(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=di(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=di(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array),i=Ht(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ht(t,this.array),r=Ht(r,this.array),i=Ht(i,this.array),s=Ht(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new Fr(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ep(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class K1 extends Qr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new vt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Eu;const nf=new ee,Mu=new ee,Cu=new ee,Au=new je,rf=new je,H3=new Yt,Og=new ee,sf=new ee,Ug=new ee,iA=new je,$_=new je,sA=new je;class C9 extends er{constructor(e=new K1){if(super(),this.isSprite=!0,this.type="Sprite",Eu===void 0){Eu=new ei;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Y1(t,5);Eu.setIndex([0,1,2,0,2,3]),Eu.setAttribute("position",new Ep(r,3,0,!1)),Eu.setAttribute("uv",new Ep(r,2,3,!1))}this.geometry=Eu,this.material=e,this.center=new je(.5,.5),this.count=1}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Mu.setFromMatrixScale(this.matrixWorld),H3.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Cu.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Mu.multiplyScalar(-Cu.z);const r=this.material.rotation;let i,s;r!==0&&(s=Math.cos(r),i=Math.sin(r));const a=this.center;Bg(Og.set(-.5,-.5,0),Cu,a,Mu,i,s),Bg(sf.set(.5,-.5,0),Cu,a,Mu,i,s),Bg(Ug.set(.5,.5,0),Cu,a,Mu,i,s),iA.set(0,0),$_.set(1,0),sA.set(1,1);let o=e.ray.intersectTriangle(Og,sf,Ug,!1,nf);if(o===null&&(Bg(sf.set(-.5,.5,0),Cu,a,Mu,i,s),$_.set(0,1),o=e.ray.intersectTriangle(Og,Ug,sf,!1,nf),o===null))return;const l=e.ray.origin.distanceTo(nf);l<e.near||l>e.far||t.push({distance:l,point:nf.clone(),uv:ps.getInterpolation(nf,Og,sf,Ug,iA,$_,sA,new je),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Bg(n,e,t,r,i,s){Au.subVectors(n,t).addScalar(.5).multiply(r),i!==void 0?(rf.x=s*Au.x-i*Au.y,rf.y=i*Au.x+s*Au.y):rf.copy(Au),n.copy(e),n.x+=rf.x,n.y+=rf.y,n.applyMatrix4(H3)}class A9 extends Jn{constructor(e=null,t=1,r=1,i,s,a,o,l,u=An,h=An,p,m){super(null,a,o,l,u,h,i,s,p,m),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class R9 extends Fr{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const W_=new ee,P9=new ee,k9=new Ut;class js{constructor(e=new ee(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=W_.subVectors(r,t).cross(P9.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(W_),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||k9.getNormalMatrix(e),i=this.coplanarPoint(W_).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Wl=new Kp,L9=new je(.5,.5),zg=new ee;class Qp{constructor(e=new js,t=new js,r=new js,i=new js,s=new js,a=new js){this.planes=[e,t,r,i,s,a]}set(e,t,r,i,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=fi){const r=this.planes,i=e.elements,s=i[0],a=i[1],o=i[2],l=i[3],u=i[4],h=i[5],p=i[6],m=i[7],g=i[8],y=i[9],b=i[10],_=i[11],x=i[12],N=i[13],T=i[14],S=i[15];if(r[0].setComponents(l-s,m-u,_-g,S-x).normalize(),r[1].setComponents(l+s,m+u,_+g,S+x).normalize(),r[2].setComponents(l+a,m+h,_+y,S+N).normalize(),r[3].setComponents(l-a,m-h,_-y,S-N).normalize(),r[4].setComponents(l-o,m-p,_-b,S-T).normalize(),t===fi)r[5].setComponents(l+o,m+p,_+b,S+T).normalize();else if(t===vl)r[5].setComponents(o,p,b,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Wl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Wl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Wl)}intersectsSprite(e){Wl.center.set(0,0,0);const t=L9.distanceTo(e.center);return Wl.radius=.7071067811865476+t,Wl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Wl)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(zg.x=i.normal.x>0?e.max.x:e.min.x,zg.y=i.normal.y>0?e.max.y:e.min.y,zg.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(zg)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const ea=new Yt,ta=new Qp;class Z1{constructor(){this.coordinateSystem=fi}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(ea.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ta.setFromProjectionMatrix(ea,this.coordinateSystem),ta.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(ea.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ta.setFromProjectionMatrix(ea,this.coordinateSystem),ta.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(ea.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ta.setFromProjectionMatrix(ea,this.coordinateSystem),ta.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(ea.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ta.setFromProjectionMatrix(ea,this.coordinateSystem),ta.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let r=0;r<t.cameras.length;r++){const i=t.cameras[r];if(ea.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ta.setFromProjectionMatrix(ea,this.coordinateSystem),ta.containsPoint(e))return!0}return!1}clone(){return new Z1}}class Zx extends Qr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new vt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ox=new ee,lx=new ee,aA=new Yt,af=new Yx,Vg=new Kp,q_=new ee,oA=new ee;class D9 extends er{constructor(e=new ei,t=new Zx){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,s=t.count;i<s;i++)ox.fromBufferAttribute(t,i-1),lx.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=ox.distanceTo(lx);e.setAttribute("lineDistance",new tr(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Vg.copy(r.boundingSphere),Vg.applyMatrix4(i),Vg.radius+=s,e.ray.intersectsSphere(Vg)===!1)return;aA.copy(i).invert(),af.copy(e.ray).applyMatrix4(aA);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=this.isLineSegments?2:1,h=r.index,m=r.attributes.position;if(h!==null){const g=Math.max(0,a.start),y=Math.min(h.count,a.start+a.count);for(let b=g,_=y-1;b<_;b+=u){const x=h.getX(b),N=h.getX(b+1),T=Gg(this,e,af,l,x,N,b);T&&t.push(T)}if(this.isLineLoop){const b=h.getX(y-1),_=h.getX(g),x=Gg(this,e,af,l,b,_,y-1);x&&t.push(x)}}else{const g=Math.max(0,a.start),y=Math.min(m.count,a.start+a.count);for(let b=g,_=y-1;b<_;b+=u){const x=Gg(this,e,af,l,b,b+1,b);x&&t.push(x)}if(this.isLineLoop){const b=Gg(this,e,af,l,y-1,g,y-1);b&&t.push(b)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function Gg(n,e,t,r,i,s,a){const o=n.geometry.attributes.position;if(ox.fromBufferAttribute(o,i),lx.fromBufferAttribute(o,s),t.distanceSqToSegment(ox,lx,q_,oA)>r)return;q_.applyMatrix4(n.matrixWorld);const u=e.ray.origin.distanceTo(q_);if(!(u<e.near||u>e.far))return{distance:u,point:oA.clone().applyMatrix4(n.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:n}}class I9 extends Qr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new vt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class j9 extends Jn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=An,this.minFilter=An,this.generateMipmaps=!1,this.needsUpdate=!0}}class F9 extends Jn{constructor(e,t,r,i,s,a,o,l,u){super(e,t,r,i,s,a,o,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class xs extends Jn{constructor(e,t,r=En,i,s,a,o=An,l=An,u,h=Zi,p=1){if(h!==Zi&&h!==Qi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const m={width:e,height:t,depth:p};super(m,i,s,a,o,l,h,r,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new G1(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Jp extends ei{constructor(e=1,t=1,r=1,i=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const u=this;i=Math.floor(i),s=Math.floor(s);const h=[],p=[],m=[],g=[];let y=0;const b=[],_=r/2;let x=0;N(),a===!1&&(e>0&&T(!0),t>0&&T(!1)),this.setIndex(h),this.setAttribute("position",new tr(p,3)),this.setAttribute("normal",new tr(m,3)),this.setAttribute("uv",new tr(g,2));function N(){const S=new ee,M=new ee;let C=0;const R=(t-e)/r;for(let F=0;F<=s;F++){const k=[],D=F/s,P=D*(t-e)+e;for(let G=0;G<=i;G++){const $=G/i,U=$*l+o,K=Math.sin(U),O=Math.cos(U);M.x=P*K,M.y=-D*r+_,M.z=P*O,p.push(M.x,M.y,M.z),S.set(K,R,O).normalize(),m.push(S.x,S.y,S.z),g.push($,1-D),k.push(y++)}b.push(k)}for(let F=0;F<i;F++)for(let k=0;k<s;k++){const D=b[k][F],P=b[k+1][F],G=b[k+1][F+1],$=b[k][F+1];(e>0||k!==0)&&(h.push(D,P,$),C+=3),(t>0||k!==s-1)&&(h.push(P,G,$),C+=3)}u.addGroup(x,C,0),x+=C}function T(S){const M=y,C=new je,R=new ee;let F=0;const k=S===!0?e:t,D=S===!0?1:-1;for(let G=1;G<=i;G++)p.push(0,_*D,0),m.push(0,D,0),g.push(.5,.5),y++;const P=y;for(let G=0;G<=i;G++){const U=G/i*l+o,K=Math.cos(U),O=Math.sin(U);R.x=k*O,R.y=_*D,R.z=k*K,p.push(R.x,R.y,R.z),m.push(0,D,0),C.x=K*.5+.5,C.y=O*.5*D+.5,g.push(C.x,C.y),y++}for(let G=0;G<i;G++){const $=M+G,U=P+G;S===!0?h.push(U,U+1,$):h.push(U+1,U,$),F+=3}u.addGroup(x,F,S===!0?1:2),x+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jp(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Q1 extends Jp{constructor(e=1,t=1,r=32,i=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,r,i,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new Q1(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class bo{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(i),t.push(s),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const r=this.getLengths();let i=0;const s=r.length;let a;t?a=t:a=e*r[s-1];let o=0,l=s-1,u;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),u=r[i]-a,u<0)o=i+1;else if(u>0)l=i-1;else{l=i;break}if(i=l,r[i]===a)return i/(s-1);const h=r[i],m=r[i+1]-h,g=(a-h)/m;return(i+g)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),o=this.getPoint(s),l=t||(a.isVector2?new je:new ee);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t=!1){const r=new ee,i=[],s=[],a=[],o=new ee,l=new Yt;for(let g=0;g<=e;g++){const y=g/e;i[g]=this.getTangentAt(y,new ee)}s[0]=new ee,a[0]=new ee;let u=Number.MAX_VALUE;const h=Math.abs(i[0].x),p=Math.abs(i[0].y),m=Math.abs(i[0].z);h<=u&&(u=h,r.set(1,0,0)),p<=u&&(u=p,r.set(0,1,0)),m<=u&&r.set(0,0,1),o.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],o),a[0].crossVectors(i[0],s[0]);for(let g=1;g<=e;g++){if(s[g]=s[g-1].clone(),a[g]=a[g-1].clone(),o.crossVectors(i[g-1],i[g]),o.length()>Number.EPSILON){o.normalize();const y=Math.acos($t(i[g-1].dot(i[g]),-1,1));s[g].applyMatrix4(l.makeRotationAxis(o,y))}a[g].crossVectors(i[g],s[g])}if(t===!0){let g=Math.acos($t(s[0].dot(s[e]),-1,1));g/=e,i[0].dot(o.crossVectors(s[0],s[e]))>0&&(g=-g);for(let y=1;y<=e;y++)s[y].applyMatrix4(l.makeRotationAxis(i[y],g*y)),a[y].crossVectors(i[y],s[y])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class $3 extends bo{constructor(e=0,t=0,r=1,i=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new je){const r=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),p=Math.sin(this.aRotation),m=l-this.aX,g=u-this.aY;l=m*h-g*p+this.aX,u=m*p+g*h+this.aY}return r.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class O9 extends $3{constructor(e,t,r,i,s,a){super(e,t,r,r,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function J1(){let n=0,e=0,t=0,r=0;function i(s,a,o,l){n=s,e=o,t=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,u){i(a,o,u*(o-s),u*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,u,h,p){let m=(a-s)/u-(o-s)/(u+h)+(o-a)/h,g=(o-a)/h-(l-a)/(h+p)+(l-o)/p;m*=h,g*=h,i(a,o,m,g)},calc:function(s){const a=s*s,o=a*s;return n+e*s+t*a+r*o}}}const Hg=new ee,X_=new J1,Y_=new J1,K_=new J1;class U9 extends bo{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new ee){const r=t,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let u,h;this.closed||o>0?u=i[(o-1)%s]:(Hg.subVectors(i[0],i[1]).add(i[0]),u=Hg);const p=i[o%s],m=i[(o+1)%s];if(this.closed||o+2<s?h=i[(o+2)%s]:(Hg.subVectors(i[s-1],i[s-2]).add(i[s-1]),h=Hg),this.curveType==="centripetal"||this.curveType==="chordal"){const g=this.curveType==="chordal"?.5:.25;let y=Math.pow(u.distanceToSquared(p),g),b=Math.pow(p.distanceToSquared(m),g),_=Math.pow(m.distanceToSquared(h),g);b<1e-4&&(b=1),y<1e-4&&(y=b),_<1e-4&&(_=b),X_.initNonuniformCatmullRom(u.x,p.x,m.x,h.x,y,b,_),Y_.initNonuniformCatmullRom(u.y,p.y,m.y,h.y,y,b,_),K_.initNonuniformCatmullRom(u.z,p.z,m.z,h.z,y,b,_)}else this.curveType==="catmullrom"&&(X_.initCatmullRom(u.x,p.x,m.x,h.x,this.tension),Y_.initCatmullRom(u.y,p.y,m.y,h.y,this.tension),K_.initCatmullRom(u.z,p.z,m.z,h.z,this.tension));return r.set(X_.calc(l),Y_.calc(l),K_.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new ee().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function lA(n,e,t,r,i){const s=(r-e)*.5,a=(i-t)*.5,o=n*n,l=n*o;return(2*t-2*r+s+a)*l+(-3*t+3*r-2*s-a)*o+s*n+t}function B9(n,e){const t=1-n;return t*t*e}function z9(n,e){return 2*(1-n)*n*e}function V9(n,e){return n*n*e}function zf(n,e,t,r){return B9(n,e)+z9(n,t)+V9(n,r)}function G9(n,e){const t=1-n;return t*t*t*e}function H9(n,e){const t=1-n;return 3*t*t*n*e}function $9(n,e){return 3*(1-n)*n*n*e}function W9(n,e){return n*n*n*e}function Vf(n,e,t,r,i){return G9(n,e)+H9(n,t)+$9(n,r)+W9(n,i)}class q9 extends bo{constructor(e=new je,t=new je,r=new je,i=new je){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new je){const r=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Vf(e,i.x,s.x,a.x,o.x),Vf(e,i.y,s.y,a.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class W3 extends bo{constructor(e=new ee,t=new ee,r=new ee,i=new ee){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new ee){const r=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Vf(e,i.x,s.x,a.x,o.x),Vf(e,i.y,s.y,a.y,o.y),Vf(e,i.z,s.z,a.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class X9 extends bo{constructor(e=new je,t=new je){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new je){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new je){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Y9 extends bo{constructor(e=new ee,t=new ee){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ee){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ee){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class K9 extends bo{constructor(e=new je,t=new je,r=new je){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new je){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(zf(e,i.x,s.x,a.x),zf(e,i.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class eT extends bo{constructor(e=new ee,t=new ee,r=new ee){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new ee){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(zf(e,i.x,s.x,a.x),zf(e,i.y,s.y,a.y),zf(e,i.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Z9 extends bo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new je){const r=t,i=this.points,s=(i.length-1)*e,a=Math.floor(s),o=s-a,l=i[a===0?a:a-1],u=i[a],h=i[a>i.length-2?i.length-1:a+1],p=i[a>i.length-3?i.length-1:a+2];return r.set(lA(o,l.x,u.x,h.x,p.x),lA(o,l.y,u.y,h.y,p.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new je().fromArray(i))}return this}}var Q9=Object.freeze({__proto__:null,ArcCurve:O9,CatmullRomCurve3:U9,CubicBezierCurve:q9,CubicBezierCurve3:W3,EllipseCurve:$3,LineCurve:X9,LineCurve3:Y9,QuadraticBezierCurve:K9,QuadraticBezierCurve3:eT,SplineCurve:Z9});class em extends ei{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,a=t/2,o=Math.floor(r),l=Math.floor(i),u=o+1,h=l+1,p=e/o,m=t/l,g=[],y=[],b=[],_=[];for(let x=0;x<h;x++){const N=x*m-a;for(let T=0;T<u;T++){const S=T*p-s;y.push(S,-N,0),b.push(0,0,1),_.push(T/o),_.push(1-x/l)}}for(let x=0;x<l;x++)for(let N=0;N<o;N++){const T=N+u*x,S=N+u*(x+1),M=N+1+u*(x+1),C=N+1+u*x;g.push(T,S,C),g.push(S,M,C)}this.setIndex(g),this.setAttribute("position",new tr(y,3)),this.setAttribute("normal",new tr(b,3)),this.setAttribute("uv",new tr(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new em(e.width,e.height,e.widthSegments,e.heightSegments)}}class ih extends ei{constructor(e=1,t=32,r=16,i=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let u=0;const h=[],p=new ee,m=new ee,g=[],y=[],b=[],_=[];for(let x=0;x<=r;x++){const N=[],T=x/r;let S=0;x===0&&a===0?S=.5/t:x===r&&l===Math.PI&&(S=-.5/t);for(let M=0;M<=t;M++){const C=M/t;p.x=-e*Math.cos(i+C*s)*Math.sin(a+T*o),p.y=e*Math.cos(a+T*o),p.z=e*Math.sin(i+C*s)*Math.sin(a+T*o),y.push(p.x,p.y,p.z),m.copy(p).normalize(),b.push(m.x,m.y,m.z),_.push(C+S,1-T),N.push(u++)}h.push(N)}for(let x=0;x<r;x++)for(let N=0;N<t;N++){const T=h[x][N+1],S=h[x][N],M=h[x+1][N],C=h[x+1][N+1];(x!==0||a>0)&&g.push(T,S,C),(x!==r-1||l<Math.PI)&&g.push(S,M,C)}this.setIndex(g),this.setAttribute("position",new tr(y,3)),this.setAttribute("normal",new tr(b,3)),this.setAttribute("uv",new tr(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ih(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class tT extends ei{constructor(e=new eT(new ee(-1,-1,0),new ee(-1,1,0),new ee(1,1,0)),t=64,r=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new ee,l=new ee,u=new je;let h=new ee;const p=[],m=[],g=[],y=[];b(),this.setIndex(y),this.setAttribute("position",new tr(p,3)),this.setAttribute("normal",new tr(m,3)),this.setAttribute("uv",new tr(g,2));function b(){for(let T=0;T<t;T++)_(T);_(s===!1?t:0),N(),x()}function _(T){h=e.getPointAt(T/t,h);const S=a.normals[T],M=a.binormals[T];for(let C=0;C<=i;C++){const R=C/i*Math.PI*2,F=Math.sin(R),k=-Math.cos(R);l.x=k*S.x+F*M.x,l.y=k*S.y+F*M.y,l.z=k*S.z+F*M.z,l.normalize(),m.push(l.x,l.y,l.z),o.x=h.x+r*l.x,o.y=h.y+r*l.y,o.z=h.z+r*l.z,p.push(o.x,o.y,o.z)}}function x(){for(let T=1;T<=t;T++)for(let S=1;S<=i;S++){const M=(i+1)*(T-1)+(S-1),C=(i+1)*T+(S-1),R=(i+1)*T+S,F=(i+1)*(T-1)+S;y.push(M,C,F),y.push(C,R,F)}}function N(){for(let T=0;T<=t;T++)for(let S=0;S<=i;S++)u.x=T/t,u.y=S/i,g.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new tT(new Q9[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class J9 extends Qr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new vt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class q3 extends Qr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new vt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ki,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eW extends q3{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new je(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return $t(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new vt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new vt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new vt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class tW extends Qr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new vt(16777215),this.specular=new vt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ki,this.combine=qp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nW extends Qr{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new vt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class rW extends Qr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class X3 extends Qr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ki,this.combine=qp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class iW extends Qr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=E$,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class sW extends Qr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class aW extends Qr{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new vt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oW extends Zx{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const Z_={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class lW{constructor(e,t,r){const i=this;let s=!1,a=0,o=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(h){o++,s===!1&&i.onStart!==void 0&&i.onStart(h,a,o),s=!0},this.itemEnd=function(h){a++,i.onProgress!==void 0&&i.onProgress(h,a,o),a===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,p){return u.push(h,p),this},this.removeHandler=function(h){const p=u.indexOf(h);return p!==-1&&u.splice(p,2),this},this.getHandler=function(h){for(let p=0,m=u.length;p<m;p+=2){const g=u[p],y=u[p+1];if(g.global&&(g.lastIndex=0),g.test(h))return y}return null}}}const cW=new lW;class nT{constructor(e){this.manager=e!==void 0?e:cW,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}nT.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ru=new WeakMap;class uW extends nT{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Z_.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0);else{let p=Ru.get(a);p===void 0&&(p=[],Ru.set(a,p)),p.push({onLoad:t,onError:i})}return a}const o=Np("img");function l(){h(),t&&t(this);const p=Ru.get(this)||[];for(let m=0;m<p.length;m++){const g=p[m];g.onLoad&&g.onLoad(this)}Ru.delete(this),s.manager.itemEnd(e)}function u(p){h(),i&&i(p),Z_.remove(`image:${e}`);const m=Ru.get(this)||[];for(let g=0;g<m.length;g++){const y=m[g];y.onError&&y.onError(p)}Ru.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function h(){o.removeEventListener("load",l,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Z_.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class dW extends nT{constructor(e){super(e)}load(e,t,r,i){const s=new Jn,a=new uW(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},r,i),s}}class Dc extends er{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new vt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class hW extends Dc{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(er.DEFAULT_UP),this.updateMatrix(),this.groundColor=new vt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Q_=new Yt,cA=new ee,uA=new ee;class rT{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new je(512,512),this.mapType=Hn,this.map=null,this.mapPass=null,this.matrix=new Yt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qp,this._frameExtents=new je(1,1),this._viewportCount=1,this._viewports=[new Lt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;cA.setFromMatrixPosition(e.matrixWorld),t.position.copy(cA),uA.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(uA),t.updateMatrixWorld(),Q_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Q_),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(Q_)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class fW extends rT{constructor(){super(new Mr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,r=Mc*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(r!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=r,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class iT extends Dc{constructor(e,t,r=0,i=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(er.DEFAULT_UP),this.updateMatrix(),this.target=new er,this.distance=r,this.angle=i,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new fW}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const dA=new Yt,of=new ee,J_=new ee;class pW extends rT{constructor(){super(new Mr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new je(4,2),this._viewportCount=6,this._viewports=[new Lt(2,1,1,1),new Lt(0,1,1,1),new Lt(3,1,1,1),new Lt(1,1,1,1),new Lt(3,0,1,1),new Lt(1,0,1,1)],this._cubeDirections=[new ee(1,0,0),new ee(-1,0,0),new ee(0,0,1),new ee(0,0,-1),new ee(0,1,0),new ee(0,-1,0)],this._cubeUps=[new ee(0,1,0),new ee(0,1,0),new ee(0,1,0),new ee(0,1,0),new ee(0,0,1),new ee(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),of.setFromMatrixPosition(e.matrixWorld),r.position.copy(of),J_.copy(r.position),J_.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(J_),r.updateMatrixWorld(),i.makeTranslation(-of.x,-of.y,-of.z),dA.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(dA)}}class mW extends Dc{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new pW}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class tm extends X1{constructor(e=-1,t=1,r=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,a=r+e,o=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,a=s+u*this.view.width,o-=h*this.view.offsetY,l=o-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class gW extends rT{constructor(){super(new tm(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Y3 extends Dc{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(er.DEFAULT_UP),this.updateMatrix(),this.target=new er,this.shadow=new gW}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class K3 extends Dc{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class xW extends Dc{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class yW{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ee)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*r),t.addScaledVector(a[4],1.092548*(r*i)),t.addScaledVector(a[5],1.092548*(i*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(r*s)),t.addScaledVector(a[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*r),t.addScaledVector(a[4],2*.429043*r*i),t.addScaledVector(a[5],2*.429043*i*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*r*s),t.addScaledVector(a[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const r=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*r*s,t[8]=.546274*(r*r-i*i)}}class vW extends Dc{constructor(e=new yW,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Z3 extends Mr{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class Q3{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}class _W extends Y1{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const hA=new Yt;class J3{constructor(e,t,r=0,i=1/0){this.ray=new Yx(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new $1,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return hA.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(hA),this}intersectObject(e,t=!0,r=[]){return rS(e,this,r,t),r.sort(fA),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)rS(e[i],this,r,t);return r.sort(fA),r}}function fA(n,e){return n.distance-e.distance}function rS(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const s=n.children;for(let a=0,o=s.length;a<o;a++)rS(s[a],e,t,!0)}}class pA{constructor(e=1,t=0,r=0){this.radius=e,this.phi=t,this.theta=r}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=$t(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos($t(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Qx{constructor(e,t,r,i){Qx.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,r,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let r=0;r<4;r++)this.elements[r]=e[r+t];return this}set(e,t,r,i){const s=this.elements;return s[0]=e,s[2]=t,s[1]=r,s[3]=i,this}}class Jx extends _o{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function mA(n,e,t,r){const i=bW(r);switch(t){case L1:return n*e;case Yp:return n*e/i.components*i.byteLength;case th:return n*e/i.components*i.byteLength;case no:return n*e*2/i.components*i.byteLength;case nh:return n*e*2/i.components*i.byteLength;case Xp:return n*e*3/i.components*i.byteLength;case qn:return n*e*4/i.components*i.byteLength;case rh:return n*e*4/i.components*i.byteLength;case vc:case dl:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case hl:case fl:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case yp:case _p:return Math.max(n,16)*Math.max(e,8)/4;case xp:case vp:return Math.max(n,8)*Math.max(e,8)/2;case bp:case Sd:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Td:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Nd:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Ed:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case Md:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case Cd:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Ad:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Rd:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Pd:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case kd:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case Ld:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case Dd:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Id:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case jd:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case Fd:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case Od:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case _c:case eS:case tS:return Math.ceil(n/4)*Math.ceil(e/4)*16;case D1:case wp:return Math.ceil(n/4)*Math.ceil(e/4)*8;case Sp:case Tp:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function bW(n){switch(n){case Hn:case xc:return{byteLength:1,components:1};case zs:case yc:case Cr:return{byteLength:2,components:1};case Hx:case $x:return{byteLength:2,components:4};case En:case Er:case Zn:return{byteLength:4,components:1};case Wx:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:eh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=eh);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function eD(){let n=null,e=!1,t=null,r=null;function i(s,a){t(s,a),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function wW(n){const e=new WeakMap;function t(o,l){const u=o.array,h=o.usage,p=u.byteLength,m=n.createBuffer();n.bindBuffer(l,m),n.bufferData(l,u,h),o.onUploadCallback();let g;if(u instanceof Float32Array)g=n.FLOAT;else if(typeof Float16Array<"u"&&u instanceof Float16Array)g=n.HALF_FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?g=n.HALF_FLOAT:g=n.UNSIGNED_SHORT;else if(u instanceof Int16Array)g=n.SHORT;else if(u instanceof Uint32Array)g=n.UNSIGNED_INT;else if(u instanceof Int32Array)g=n.INT;else if(u instanceof Int8Array)g=n.BYTE;else if(u instanceof Uint8Array)g=n.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)g=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:m,type:g,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:p}}function r(o,l,u){const h=l.array,p=l.updateRanges;if(n.bindBuffer(u,o),p.length===0)n.bufferSubData(u,0,h);else{p.sort((g,y)=>g.start-y.start);let m=0;for(let g=1;g<p.length;g++){const y=p[m],b=p[g];b.start<=y.start+y.count+1?y.count=Math.max(y.count,b.start+b.count-y.start):(++m,p[m]=b)}p.length=m+1;for(let g=0,y=p.length;g<y;g++){const b=p[g];n.bufferSubData(u,b.start*h.BYTES_PER_ELEMENT,h,b.start,b.count)}l.clearUpdateRanges()}l.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(n.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const h=e.get(o);(!h||h.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,t(o,l));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(u.buffer,o,l),u.version=o.version}}return{get:i,remove:s,update:a}}var SW=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,TW=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,NW=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,EW=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,MW=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,CW=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,AW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,RW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,PW=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,kW=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,LW=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,DW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,IW=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,jW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,FW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,OW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,UW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,BW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,zW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,VW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,GW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,HW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,$W=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,WW=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,qW=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,XW=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,YW=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,KW=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,ZW=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,QW=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,JW="gl_FragColor = linearToOutputTexel( gl_FragColor );",e7=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,t7=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,n7=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,r7=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,i7=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,s7=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,a7=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,o7=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,l7=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,c7=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,u7=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,d7=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,h7=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,f7=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,p7=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,m7=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,g7=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,x7=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,y7=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,v7=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,_7=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,b7=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,w7=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,S7=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,T7=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,N7=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,E7=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,M7=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,C7=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,A7=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,R7=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,P7=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,k7=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,L7=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,D7=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,I7=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,j7=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,F7=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,O7=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,U7=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,B7=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,z7=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,V7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,G7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,H7=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,$7=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,W7=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,q7=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,X7=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Y7=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,K7=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Z7=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Q7=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,J7=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,eq=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,tq=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,nq=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,rq=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,iq=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,sq=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,aq=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,oq=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,lq=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,cq=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,uq=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,dq=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,hq=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,fq=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,pq=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,mq=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,gq=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,xq=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,yq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,vq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,_q=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,bq=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const wq=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Sq=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Tq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Nq=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Eq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Mq=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Cq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Aq=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Rq=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Pq=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,kq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Lq=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Dq=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Iq=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,jq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Fq=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Oq=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Uq=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Bq=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zq=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vq=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Gq=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Hq=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$q=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Wq=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,qq=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Xq=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Yq=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Kq=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Zq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Qq=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Jq=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,eX=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,tX=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,qt={alphahash_fragment:SW,alphahash_pars_fragment:TW,alphamap_fragment:NW,alphamap_pars_fragment:EW,alphatest_fragment:MW,alphatest_pars_fragment:CW,aomap_fragment:AW,aomap_pars_fragment:RW,batching_pars_vertex:PW,batching_vertex:kW,begin_vertex:LW,beginnormal_vertex:DW,bsdfs:IW,iridescence_fragment:jW,bumpmap_pars_fragment:FW,clipping_planes_fragment:OW,clipping_planes_pars_fragment:UW,clipping_planes_pars_vertex:BW,clipping_planes_vertex:zW,color_fragment:VW,color_pars_fragment:GW,color_pars_vertex:HW,color_vertex:$W,common:WW,cube_uv_reflection_fragment:qW,defaultnormal_vertex:XW,displacementmap_pars_vertex:YW,displacementmap_vertex:KW,emissivemap_fragment:ZW,emissivemap_pars_fragment:QW,colorspace_fragment:JW,colorspace_pars_fragment:e7,envmap_fragment:t7,envmap_common_pars_fragment:n7,envmap_pars_fragment:r7,envmap_pars_vertex:i7,envmap_physical_pars_fragment:m7,envmap_vertex:s7,fog_vertex:a7,fog_pars_vertex:o7,fog_fragment:l7,fog_pars_fragment:c7,gradientmap_pars_fragment:u7,lightmap_pars_fragment:d7,lights_lambert_fragment:h7,lights_lambert_pars_fragment:f7,lights_pars_begin:p7,lights_toon_fragment:g7,lights_toon_pars_fragment:x7,lights_phong_fragment:y7,lights_phong_pars_fragment:v7,lights_physical_fragment:_7,lights_physical_pars_fragment:b7,lights_fragment_begin:w7,lights_fragment_maps:S7,lights_fragment_end:T7,logdepthbuf_fragment:N7,logdepthbuf_pars_fragment:E7,logdepthbuf_pars_vertex:M7,logdepthbuf_vertex:C7,map_fragment:A7,map_pars_fragment:R7,map_particle_fragment:P7,map_particle_pars_fragment:k7,metalnessmap_fragment:L7,metalnessmap_pars_fragment:D7,morphinstance_vertex:I7,morphcolor_vertex:j7,morphnormal_vertex:F7,morphtarget_pars_vertex:O7,morphtarget_vertex:U7,normal_fragment_begin:B7,normal_fragment_maps:z7,normal_pars_fragment:V7,normal_pars_vertex:G7,normal_vertex:H7,normalmap_pars_fragment:$7,clearcoat_normal_fragment_begin:W7,clearcoat_normal_fragment_maps:q7,clearcoat_pars_fragment:X7,iridescence_pars_fragment:Y7,opaque_fragment:K7,packing:Z7,premultiplied_alpha_fragment:Q7,project_vertex:J7,dithering_fragment:eq,dithering_pars_fragment:tq,roughnessmap_fragment:nq,roughnessmap_pars_fragment:rq,shadowmap_pars_fragment:iq,shadowmap_pars_vertex:sq,shadowmap_vertex:aq,shadowmask_pars_fragment:oq,skinbase_vertex:lq,skinning_pars_vertex:cq,skinning_vertex:uq,skinnormal_vertex:dq,specularmap_fragment:hq,specularmap_pars_fragment:fq,tonemapping_fragment:pq,tonemapping_pars_fragment:mq,transmission_fragment:gq,transmission_pars_fragment:xq,uv_pars_fragment:yq,uv_pars_vertex:vq,uv_vertex:_q,worldpos_vertex:bq,background_vert:wq,background_frag:Sq,backgroundCube_vert:Tq,backgroundCube_frag:Nq,cube_vert:Eq,cube_frag:Mq,depth_vert:Cq,depth_frag:Aq,distanceRGBA_vert:Rq,distanceRGBA_frag:Pq,equirect_vert:kq,equirect_frag:Lq,linedashed_vert:Dq,linedashed_frag:Iq,meshbasic_vert:jq,meshbasic_frag:Fq,meshlambert_vert:Oq,meshlambert_frag:Uq,meshmatcap_vert:Bq,meshmatcap_frag:zq,meshnormal_vert:Vq,meshnormal_frag:Gq,meshphong_vert:Hq,meshphong_frag:$q,meshphysical_vert:Wq,meshphysical_frag:qq,meshtoon_vert:Xq,meshtoon_frag:Yq,points_vert:Kq,points_frag:Zq,shadow_vert:Qq,shadow_frag:Jq,sprite_vert:eX,sprite_frag:tX},nt={common:{diffuse:{value:new vt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ut}},envmap:{envMap:{value:null},envMapRotation:{value:new Ut},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ut}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ut}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ut},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ut},normalScale:{value:new je(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ut},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ut}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ut}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ut}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new vt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new vt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0},uvTransform:{value:new Ut}},sprite:{diffuse:{value:new vt(16777215)},opacity:{value:1},center:{value:new je(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}}},sa={basic:{uniforms:ai([nt.common,nt.specularmap,nt.envmap,nt.aomap,nt.lightmap,nt.fog]),vertexShader:qt.meshbasic_vert,fragmentShader:qt.meshbasic_frag},lambert:{uniforms:ai([nt.common,nt.specularmap,nt.envmap,nt.aomap,nt.lightmap,nt.emissivemap,nt.bumpmap,nt.normalmap,nt.displacementmap,nt.fog,nt.lights,{emissive:{value:new vt(0)}}]),vertexShader:qt.meshlambert_vert,fragmentShader:qt.meshlambert_frag},phong:{uniforms:ai([nt.common,nt.specularmap,nt.envmap,nt.aomap,nt.lightmap,nt.emissivemap,nt.bumpmap,nt.normalmap,nt.displacementmap,nt.fog,nt.lights,{emissive:{value:new vt(0)},specular:{value:new vt(1118481)},shininess:{value:30}}]),vertexShader:qt.meshphong_vert,fragmentShader:qt.meshphong_frag},standard:{uniforms:ai([nt.common,nt.envmap,nt.aomap,nt.lightmap,nt.emissivemap,nt.bumpmap,nt.normalmap,nt.displacementmap,nt.roughnessmap,nt.metalnessmap,nt.fog,nt.lights,{emissive:{value:new vt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qt.meshphysical_vert,fragmentShader:qt.meshphysical_frag},toon:{uniforms:ai([nt.common,nt.aomap,nt.lightmap,nt.emissivemap,nt.bumpmap,nt.normalmap,nt.displacementmap,nt.gradientmap,nt.fog,nt.lights,{emissive:{value:new vt(0)}}]),vertexShader:qt.meshtoon_vert,fragmentShader:qt.meshtoon_frag},matcap:{uniforms:ai([nt.common,nt.bumpmap,nt.normalmap,nt.displacementmap,nt.fog,{matcap:{value:null}}]),vertexShader:qt.meshmatcap_vert,fragmentShader:qt.meshmatcap_frag},points:{uniforms:ai([nt.points,nt.fog]),vertexShader:qt.points_vert,fragmentShader:qt.points_frag},dashed:{uniforms:ai([nt.common,nt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qt.linedashed_vert,fragmentShader:qt.linedashed_frag},depth:{uniforms:ai([nt.common,nt.displacementmap]),vertexShader:qt.depth_vert,fragmentShader:qt.depth_frag},normal:{uniforms:ai([nt.common,nt.bumpmap,nt.normalmap,nt.displacementmap,{opacity:{value:1}}]),vertexShader:qt.meshnormal_vert,fragmentShader:qt.meshnormal_frag},sprite:{uniforms:ai([nt.sprite,nt.fog]),vertexShader:qt.sprite_vert,fragmentShader:qt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ut},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qt.background_vert,fragmentShader:qt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ut}},vertexShader:qt.backgroundCube_vert,fragmentShader:qt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qt.cube_vert,fragmentShader:qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qt.equirect_vert,fragmentShader:qt.equirect_frag},distanceRGBA:{uniforms:ai([nt.common,nt.displacementmap,{referencePosition:{value:new ee},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qt.distanceRGBA_vert,fragmentShader:qt.distanceRGBA_frag},shadow:{uniforms:ai([nt.lights,nt.fog,{color:{value:new vt(0)},opacity:{value:1}}]),vertexShader:qt.shadow_vert,fragmentShader:qt.shadow_frag}};sa.physical={uniforms:ai([sa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ut},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ut},clearcoatNormalScale:{value:new je(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ut},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ut},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ut},sheen:{value:0},sheenColor:{value:new vt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ut},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ut},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ut},transmissionSamplerSize:{value:new je},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ut},attenuationDistance:{value:0},attenuationColor:{value:new vt(0)},specularColor:{value:new vt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ut},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ut},anisotropyVector:{value:new je},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ut}}]),vertexShader:qt.meshphysical_vert,fragmentShader:qt.meshphysical_frag};const $g={r:0,b:0,g:0},ql=new ki,nX=new Yt;function rX(n,e,t,r,i,s,a){const o=new vt(0);let l=s===!0?0:1,u,h,p=null,m=0,g=null;function y(T){let S=T.isScene===!0?T.background:null;return S&&S.isTexture&&(S=(T.backgroundBlurriness>0?t:e).get(S)),S}function b(T){let S=!1;const M=y(T);M===null?x(o,l):M&&M.isColor&&(x(M,1),S=!0);const C=n.xr.getEnvironmentBlendMode();C==="additive"?r.buffers.color.setClear(0,0,0,1,a):C==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(n.autoClear||S)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function _(T,S){const M=y(S);M&&(M.isCubeTexture||M.mapping===Tc)?(h===void 0&&(h=new Xn(new Lc(1,1,1),new va({name:"BackgroundCubeMaterial",uniforms:Bd(sa.backgroundCube.uniforms),vertexShader:sa.backgroundCube.vertexShader,fragmentShader:sa.backgroundCube.fragmentShader,side:bn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(C,R,F){this.matrixWorld.copyPosition(F.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),ql.copy(S.backgroundRotation),ql.x*=-1,ql.y*=-1,ql.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(ql.y*=-1,ql.z*=-1),h.material.uniforms.envMap.value=M,h.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=S.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(nX.makeRotationFromEuler(ql)),h.material.toneMapped=Ot.getTransfer(M.colorSpace)!==st,(p!==M||m!==M.version||g!==n.toneMapping)&&(h.material.needsUpdate=!0,p=M,m=M.version,g=n.toneMapping),h.layers.enableAll(),T.unshift(h,h.geometry,h.material,0,0,null)):M&&M.isTexture&&(u===void 0&&(u=new Xn(new em(2,2),new va({name:"BackgroundMaterial",uniforms:Bd(sa.background.uniforms),vertexShader:sa.background.vertexShader,fragmentShader:sa.background.fragmentShader,side:Ai,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=M,u.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,u.material.toneMapped=Ot.getTransfer(M.colorSpace)!==st,M.matrixAutoUpdate===!0&&M.updateMatrix(),u.material.uniforms.uvTransform.value.copy(M.matrix),(p!==M||m!==M.version||g!==n.toneMapping)&&(u.material.needsUpdate=!0,p=M,m=M.version,g=n.toneMapping),u.layers.enableAll(),T.unshift(u,u.geometry,u.material,0,0,null))}function x(T,S){T.getRGB($g,B3(n)),r.buffers.color.setClear($g.r,$g.g,$g.b,S,a)}function N(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return o},setClearColor:function(T,S=1){o.set(T),l=S,x(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(T){l=T,x(o,l)},render:b,addToRenderList:_,dispose:N}}function iX(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=m(null);let s=i,a=!1;function o(D,P,G,$,U){let K=!1;const O=p($,G,P);s!==O&&(s=O,u(s.object)),K=g(D,$,G,U),K&&y(D,$,G,U),U!==null&&e.update(U,n.ELEMENT_ARRAY_BUFFER),(K||a)&&(a=!1,S(D,P,G,$),U!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(U).buffer))}function l(){return n.createVertexArray()}function u(D){return n.bindVertexArray(D)}function h(D){return n.deleteVertexArray(D)}function p(D,P,G){const $=G.wireframe===!0;let U=r[D.id];U===void 0&&(U={},r[D.id]=U);let K=U[P.id];K===void 0&&(K={},U[P.id]=K);let O=K[$];return O===void 0&&(O=m(l()),K[$]=O),O}function m(D){const P=[],G=[],$=[];for(let U=0;U<t;U++)P[U]=0,G[U]=0,$[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:G,attributeDivisors:$,object:D,attributes:{},index:null}}function g(D,P,G,$){const U=s.attributes,K=P.attributes;let O=0;const j=G.getAttributes();for(const L in j)if(j[L].location>=0){const V=U[L];let z=K[L];if(z===void 0&&(L==="instanceMatrix"&&D.instanceMatrix&&(z=D.instanceMatrix),L==="instanceColor"&&D.instanceColor&&(z=D.instanceColor)),V===void 0||V.attribute!==z||z&&V.data!==z.data)return!0;O++}return s.attributesNum!==O||s.index!==$}function y(D,P,G,$){const U={},K=P.attributes;let O=0;const j=G.getAttributes();for(const L in j)if(j[L].location>=0){let V=K[L];V===void 0&&(L==="instanceMatrix"&&D.instanceMatrix&&(V=D.instanceMatrix),L==="instanceColor"&&D.instanceColor&&(V=D.instanceColor));const z={};z.attribute=V,V&&V.data&&(z.data=V.data),U[L]=z,O++}s.attributes=U,s.attributesNum=O,s.index=$}function b(){const D=s.newAttributes;for(let P=0,G=D.length;P<G;P++)D[P]=0}function _(D){x(D,0)}function x(D,P){const G=s.newAttributes,$=s.enabledAttributes,U=s.attributeDivisors;G[D]=1,$[D]===0&&(n.enableVertexAttribArray(D),$[D]=1),U[D]!==P&&(n.vertexAttribDivisor(D,P),U[D]=P)}function N(){const D=s.newAttributes,P=s.enabledAttributes;for(let G=0,$=P.length;G<$;G++)P[G]!==D[G]&&(n.disableVertexAttribArray(G),P[G]=0)}function T(D,P,G,$,U,K,O){O===!0?n.vertexAttribIPointer(D,P,G,U,K):n.vertexAttribPointer(D,P,G,$,U,K)}function S(D,P,G,$){b();const U=$.attributes,K=G.getAttributes(),O=P.defaultAttributeValues;for(const j in K){const L=K[j];if(L.location>=0){let B=U[j];if(B===void 0&&(j==="instanceMatrix"&&D.instanceMatrix&&(B=D.instanceMatrix),j==="instanceColor"&&D.instanceColor&&(B=D.instanceColor)),B!==void 0){const V=B.normalized,z=B.itemSize,Y=e.get(B);if(Y===void 0)continue;const se=Y.buffer,J=Y.type,q=Y.bytesPerElement,Q=J===n.INT||J===n.UNSIGNED_INT||B.gpuType===Er;if(B.isInterleavedBufferAttribute){const te=B.data,X=te.stride,ce=B.offset;if(te.isInstancedInterleavedBuffer){for(let me=0;me<L.locationSize;me++)x(L.location+me,te.meshPerAttribute);D.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let me=0;me<L.locationSize;me++)_(L.location+me);n.bindBuffer(n.ARRAY_BUFFER,se);for(let me=0;me<L.locationSize;me++)T(L.location+me,z/L.locationSize,J,V,X*q,(ce+z/L.locationSize*me)*q,Q)}else{if(B.isInstancedBufferAttribute){for(let te=0;te<L.locationSize;te++)x(L.location+te,B.meshPerAttribute);D.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=B.meshPerAttribute*B.count)}else for(let te=0;te<L.locationSize;te++)_(L.location+te);n.bindBuffer(n.ARRAY_BUFFER,se);for(let te=0;te<L.locationSize;te++)T(L.location+te,z/L.locationSize,J,V,z*q,z/L.locationSize*te*q,Q)}}else if(O!==void 0){const V=O[j];if(V!==void 0)switch(V.length){case 2:n.vertexAttrib2fv(L.location,V);break;case 3:n.vertexAttrib3fv(L.location,V);break;case 4:n.vertexAttrib4fv(L.location,V);break;default:n.vertexAttrib1fv(L.location,V)}}}}N()}function M(){F();for(const D in r){const P=r[D];for(const G in P){const $=P[G];for(const U in $)h($[U].object),delete $[U];delete P[G]}delete r[D]}}function C(D){if(r[D.id]===void 0)return;const P=r[D.id];for(const G in P){const $=P[G];for(const U in $)h($[U].object),delete $[U];delete P[G]}delete r[D.id]}function R(D){for(const P in r){const G=r[P];if(G[D.id]===void 0)continue;const $=G[D.id];for(const U in $)h($[U].object),delete $[U];delete G[D.id]}}function F(){k(),a=!0,s!==i&&(s=i,u(s.object))}function k(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:F,resetDefaultState:k,dispose:M,releaseStatesOfGeometry:C,releaseStatesOfProgram:R,initAttributes:b,enableAttribute:_,disableUnusedAttributes:N}}function sX(n,e,t){let r;function i(u){r=u}function s(u,h){n.drawArrays(r,u,h),t.update(h,r,1)}function a(u,h,p){p!==0&&(n.drawArraysInstanced(r,u,h,p),t.update(h,r,p))}function o(u,h,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,u,0,h,0,p);let g=0;for(let y=0;y<p;y++)g+=h[y];t.update(g,r,1)}function l(u,h,p,m){if(p===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let y=0;y<u.length;y++)a(u[y],h[y],m[y]);else{g.multiDrawArraysInstancedWEBGL(r,u,0,h,0,m,0,p);let y=0;for(let b=0;b<p;b++)y+=h[b]*m[b];t.update(y,r,1)}}this.setMode=i,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function aX(n,e,t,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(R){return!(R!==qn&&r.convert(R)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(R){const F=R===Cr&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(R!==Hn&&r.convert(R)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&R!==Zn&&!F)}function l(R){if(R==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const h=l(u);h!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",h,"instead."),u=h);const p=t.logarithmicDepthBuffer===!0,m=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),g=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),y=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),b=n.getParameter(n.MAX_TEXTURE_SIZE),_=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),x=n.getParameter(n.MAX_VERTEX_ATTRIBS),N=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),T=n.getParameter(n.MAX_VARYING_VECTORS),S=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),M=y>0,C=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:p,reverseDepthBuffer:m,maxTextures:g,maxVertexTextures:y,maxTextureSize:b,maxCubemapSize:_,maxAttributes:x,maxVertexUniforms:N,maxVaryings:T,maxFragmentUniforms:S,vertexTextures:M,maxSamples:C}}function oX(n){const e=this;let t=null,r=0,i=!1,s=!1;const a=new js,o=new Ut,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(p,m){const g=p.length!==0||m||r!==0||i;return i=m,r=p.length,g},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(p,m){t=h(p,m,0)},this.setState=function(p,m,g){const y=p.clippingPlanes,b=p.clipIntersection,_=p.clipShadows,x=n.get(p);if(!i||y===null||y.length===0||s&&!_)s?h(null):u();else{const N=s?0:r,T=N*4;let S=x.clippingState||null;l.value=S,S=h(y,m,T,g);for(let M=0;M!==T;++M)S[M]=t[M];x.clippingState=S,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=N}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function h(p,m,g,y){const b=p!==null?p.length:0;let _=null;if(b!==0){if(_=l.value,y!==!0||_===null){const x=g+b*4,N=m.matrixWorldInverse;o.getNormalMatrix(N),(_===null||_.length<x)&&(_=new Float32Array(x));for(let T=0,S=g;T!==b;++T,S+=4)a.copy(p[T]).applyMatrix4(N,o),a.normal.toArray(_,S),_[S+3]=a.constant}l.value=_,l.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,_}}function lX(n){let e=new WeakMap;function t(a,o){return o===bd?a.mapping=xa:o===wd&&(a.mapping=ya),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===bd||o===wd)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const u=new G3(l.height);return u.fromEquirectangularTexture(n,a),e.set(a,u),a.addEventListener("dispose",i),t(u.texture,a.mapping)}else return null}}return a}function i(a){const o=a.target;o.removeEventListener("dispose",i);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const Ku=4,gA=[.125,.215,.35,.446,.526,.582],ac=20,eb=new tm,xA=new vt;let tb=null,nb=0,rb=0,ib=!1;const nc=(1+Math.sqrt(5))/2,Pu=1/nc,yA=[new ee(-nc,Pu,0),new ee(nc,Pu,0),new ee(-Pu,0,nc),new ee(Pu,0,nc),new ee(0,nc,-Pu),new ee(0,nc,Pu),new ee(-1,1,-1),new ee(1,1,-1),new ee(-1,1,1),new ee(1,1,1)],cX=new ee;let vA=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100,s={}){const{size:a=256,position:o=cX}=s;tb=this._renderer.getRenderTarget(),nb=this._renderer.getActiveCubeFace(),rb=this._renderer.getActiveMipmapLevel(),ib=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,r,i,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wA(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=bA(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(tb,nb,rb),this._renderer.xr.enabled=ib,e.scissorTest=!1,Wg(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===xa||e.mapping===ya?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),tb=this._renderer.getRenderTarget(),nb=this._renderer.getActiveCubeFace(),rb=this._renderer.getActiveMipmapLevel(),ib=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:pr,minFilter:pr,generateMipmaps:!1,type:Cr,format:qn,colorSpace:pa,depthBuffer:!1},i=_A(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_A(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=uX(s)),this._blurMaterial=dX(s,e,t)}return i}_compileMaterial(e){const t=new Xn(this._lodPlanes[0],e);this._renderer.compile(t,eb)}_sceneToCubeUV(e,t,r,i,s){const l=new Mr(90,1,t,r),u=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],p=this._renderer,m=p.autoClear,g=p.toneMapping;p.getClearColor(xA),p.toneMapping=Pi,p.autoClear=!1;const y=new Us({name:"PMREM.Background",side:bn,depthWrite:!1,depthTest:!1}),b=new Xn(new Lc,y);let _=!1;const x=e.background;x?x.isColor&&(y.color.copy(x),e.background=null,_=!0):(y.color.copy(xA),_=!0);for(let N=0;N<6;N++){const T=N%3;T===0?(l.up.set(0,u[N],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+h[N],s.y,s.z)):T===1?(l.up.set(0,0,u[N]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+h[N],s.z)):(l.up.set(0,u[N],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+h[N]));const S=this._cubeSize;Wg(i,T*S,N>2?S:0,S,S),p.setRenderTarget(i),_&&p.render(b,l),p.render(e,l)}b.geometry.dispose(),b.material.dispose(),p.toneMapping=g,p.autoClear=m,e.background=x}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===xa||e.mapping===ya;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=wA()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=bA());const s=i?this._cubemapMaterial:this._equirectMaterial,a=new Xn(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;Wg(t,0,0,3*l,2*l),r.setRenderTarget(t),r.render(a,eb)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=yA[(i-s-1)%yA.length];this._blur(e,s-1,s,a,o)}t.autoClear=r}_blur(e,t,r,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",s),this._halfBlur(a,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,p=new Xn(this._lodPlanes[i],u),m=u.uniforms,g=this._sizeLods[r]-1,y=isFinite(s)?Math.PI/(2*g):2*Math.PI/(2*ac-1),b=s/y,_=isFinite(s)?1+Math.floor(h*b):ac;_>ac&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${ac}`);const x=[];let N=0;for(let R=0;R<ac;++R){const F=R/b,k=Math.exp(-F*F/2);x.push(k),R===0?N+=k:R<_&&(N+=2*k)}for(let R=0;R<x.length;R++)x[R]=x[R]/N;m.envMap.value=e.texture,m.samples.value=_,m.weights.value=x,m.latitudinal.value=a==="latitudinal",o&&(m.poleAxis.value=o);const{_lodMax:T}=this;m.dTheta.value=y,m.mipInt.value=T-r;const S=this._sizeLods[i],M=3*S*(i>T-Ku?i-T+Ku:0),C=4*(this._cubeSize-S);Wg(t,M,C,3*S,2*S),l.setRenderTarget(t),l.render(p,eb)}};function uX(n){const e=[],t=[],r=[];let i=n;const s=n-Ku+1+gA.length;for(let a=0;a<s;a++){const o=Math.pow(2,i);t.push(o);let l=1/o;a>n-Ku?l=gA[a-n+Ku-1]:a===0&&(l=0),r.push(l);const u=1/(o-2),h=-u,p=1+u,m=[h,h,p,h,p,p,h,h,p,p,h,p],g=6,y=6,b=3,_=2,x=1,N=new Float32Array(b*y*g),T=new Float32Array(_*y*g),S=new Float32Array(x*y*g);for(let C=0;C<g;C++){const R=C%3*2/3-1,F=C>2?0:-1,k=[R,F,0,R+2/3,F,0,R+2/3,F+1,0,R,F,0,R+2/3,F+1,0,R,F+1,0];N.set(k,b*y*C),T.set(m,_*y*C);const D=[C,C,C,C,C,C];S.set(D,x*y*C)}const M=new ei;M.setAttribute("position",new Fr(N,b)),M.setAttribute("uv",new Fr(T,_)),M.setAttribute("faceIndex",new Fr(S,x)),e.push(M),i>Ku&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function _A(n,e,t){const r=new _l(n,e,t);return r.texture.mapping=Tc,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Wg(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function dX(n,e,t){const r=new Float32Array(ac),i=new ee(0,1,0);return new va({name:"SphericalGaussianBlur",defines:{n:ac,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:sT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ri,depthTest:!1,depthWrite:!1})}function bA(){return new va({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:sT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ri,depthTest:!1,depthWrite:!1})}function wA(){return new va({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:sT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ri,depthTest:!1,depthWrite:!1})}function sT(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function hX(n){let e=new WeakMap,t=null;function r(o){if(o&&o.isTexture){const l=o.mapping,u=l===bd||l===wd,h=l===xa||l===ya;if(u||h){let p=e.get(o);const m=p!==void 0?p.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==m)return t===null&&(t=new vA(n)),p=u?t.fromEquirectangular(o,p):t.fromCubemap(o,p),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),p.texture;if(p!==void 0)return p.texture;{const g=o.image;return u&&g&&g.height>0||h&&g&&i(g)?(t===null&&(t=new vA(n)),p=u?t.fromEquirectangular(o):t.fromCubemap(o),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),o.addEventListener("dispose",s),p.texture):null}}}return o}function i(o){let l=0;const u=6;for(let h=0;h<u;h++)o[h]!==void 0&&l++;return l===u}function s(o){const l=o.target;l.removeEventListener("dispose",s);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:a}}function fX(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&Ji("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function pX(n,e,t,r){const i={},s=new WeakMap;function a(p){const m=p.target;m.index!==null&&e.remove(m.index);for(const y in m.attributes)e.remove(m.attributes[y]);m.removeEventListener("dispose",a),delete i[m.id];const g=s.get(m);g&&(e.remove(g),s.delete(m)),r.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function o(p,m){return i[m.id]===!0||(m.addEventListener("dispose",a),i[m.id]=!0,t.memory.geometries++),m}function l(p){const m=p.attributes;for(const g in m)e.update(m[g],n.ARRAY_BUFFER)}function u(p){const m=[],g=p.index,y=p.attributes.position;let b=0;if(g!==null){const N=g.array;b=g.version;for(let T=0,S=N.length;T<S;T+=3){const M=N[T+0],C=N[T+1],R=N[T+2];m.push(M,C,C,R,R,M)}}else if(y!==void 0){const N=y.array;b=y.version;for(let T=0,S=N.length/3-1;T<S;T+=3){const M=T+0,C=T+1,R=T+2;m.push(M,C,C,R,R,M)}}else return;const _=new(V1(m)?q1:W1)(m,1);_.version=b;const x=s.get(p);x&&e.remove(x),s.set(p,_)}function h(p){const m=s.get(p);if(m){const g=p.index;g!==null&&m.version<g.version&&u(p)}else u(p);return s.get(p)}return{get:o,update:l,getWireframeAttribute:h}}function mX(n,e,t){let r;function i(m){r=m}let s,a;function o(m){s=m.type,a=m.bytesPerElement}function l(m,g){n.drawElements(r,g,s,m*a),t.update(g,r,1)}function u(m,g,y){y!==0&&(n.drawElementsInstanced(r,g,s,m*a,y),t.update(g,r,y))}function h(m,g,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,g,0,s,m,0,y);let _=0;for(let x=0;x<y;x++)_+=g[x];t.update(_,r,1)}function p(m,g,y,b){if(y===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let x=0;x<m.length;x++)u(m[x]/a,g[x],b[x]);else{_.multiDrawElementsInstancedWEBGL(r,g,0,s,m,0,b,0,y);let x=0;for(let N=0;N<y;N++)x+=g[N]*b[N];t.update(x,r,1)}}this.setMode=i,this.setIndex=o,this.render=l,this.renderInstances=u,this.renderMultiDraw=h,this.renderMultiDrawInstances=p}function gX(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=o*(s/3);break;case n.LINES:t.lines+=o*(s/2);break;case n.LINE_STRIP:t.lines+=o*(s-1);break;case n.LINE_LOOP:t.lines+=o*s;break;case n.POINTS:t.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function xX(n,e,t){const r=new WeakMap,i=new Lt;function s(a,o,l){const u=a.morphTargetInfluences,h=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,p=h!==void 0?h.length:0;let m=r.get(o);if(m===void 0||m.count!==p){let k=function(){R.dispose(),r.delete(o),o.removeEventListener("dispose",k)};m!==void 0&&m.texture.dispose();const g=o.morphAttributes.position!==void 0,y=o.morphAttributes.normal!==void 0,b=o.morphAttributes.color!==void 0,_=o.morphAttributes.position||[],x=o.morphAttributes.normal||[],N=o.morphAttributes.color||[];let T=0;g===!0&&(T=1),y===!0&&(T=2),b===!0&&(T=3);let S=o.attributes.position.count*T,M=1;S>e.maxTextureSize&&(M=Math.ceil(S/e.maxTextureSize),S=e.maxTextureSize);const C=new Float32Array(S*M*4*p),R=new H1(C,S,M,p);R.type=Zn,R.needsUpdate=!0;const F=T*4;for(let D=0;D<p;D++){const P=_[D],G=x[D],$=N[D],U=S*M*4*D;for(let K=0;K<P.count;K++){const O=K*F;g===!0&&(i.fromBufferAttribute(P,K),C[U+O+0]=i.x,C[U+O+1]=i.y,C[U+O+2]=i.z,C[U+O+3]=0),y===!0&&(i.fromBufferAttribute(G,K),C[U+O+4]=i.x,C[U+O+5]=i.y,C[U+O+6]=i.z,C[U+O+7]=0),b===!0&&(i.fromBufferAttribute($,K),C[U+O+8]=i.x,C[U+O+9]=i.y,C[U+O+10]=i.z,C[U+O+11]=$.itemSize===4?i.w:1)}}m={count:p,texture:R,size:new je(S,M)},r.set(o,m),o.addEventListener("dispose",k)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let g=0;for(let b=0;b<u.length;b++)g+=u[b];const y=o.morphTargetsRelative?1:1-g;l.getUniforms().setValue(n,"morphTargetBaseInfluence",y),l.getUniforms().setValue(n,"morphTargetInfluences",u)}l.getUniforms().setValue(n,"morphTargetsTexture",m.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",m.size)}return{update:s}}function yX(n,e,t,r){let i=new WeakMap;function s(l){const u=r.render.frame,h=l.geometry,p=e.get(l,h);if(i.get(p)!==u&&(e.update(p),i.set(p,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.get(l)!==u&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),i.set(l,u))),l.isSkinnedMesh){const m=l.skeleton;i.get(m)!==u&&(m.update(),i.set(m,u))}return p}function a(){i=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:a}}const tD=new Jn,SA=new xs(1,1),nD=new H1,rD=new d9,iD=new Zp,TA=[],NA=[],EA=new Float32Array(16),MA=new Float32Array(9),CA=new Float32Array(4);function sh(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=TA[i];if(s===void 0&&(s=new Float32Array(i),TA[i]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(s,o)}return s}function gr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function xr(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function ey(n,e){let t=NA[e];t===void 0&&(t=new Int32Array(e),NA[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function vX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function _X(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gr(t,e))return;n.uniform2fv(this.addr,e),xr(t,e)}}function bX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(gr(t,e))return;n.uniform3fv(this.addr,e),xr(t,e)}}function wX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gr(t,e))return;n.uniform4fv(this.addr,e),xr(t,e)}}function SX(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(gr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),xr(t,e)}else{if(gr(t,r))return;CA.set(r),n.uniformMatrix2fv(this.addr,!1,CA),xr(t,r)}}function TX(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(gr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),xr(t,e)}else{if(gr(t,r))return;MA.set(r),n.uniformMatrix3fv(this.addr,!1,MA),xr(t,r)}}function NX(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(gr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),xr(t,e)}else{if(gr(t,r))return;EA.set(r),n.uniformMatrix4fv(this.addr,!1,EA),xr(t,r)}}function EX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function MX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gr(t,e))return;n.uniform2iv(this.addr,e),xr(t,e)}}function CX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(gr(t,e))return;n.uniform3iv(this.addr,e),xr(t,e)}}function AX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gr(t,e))return;n.uniform4iv(this.addr,e),xr(t,e)}}function RX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function PX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gr(t,e))return;n.uniform2uiv(this.addr,e),xr(t,e)}}function kX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(gr(t,e))return;n.uniform3uiv(this.addr,e),xr(t,e)}}function LX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gr(t,e))return;n.uniform4uiv(this.addr,e),xr(t,e)}}function DX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let s;this.type===n.SAMPLER_2D_SHADOW?(SA.compareFunction=Xx,s=SA):s=tD,t.setTexture2D(e||s,i)}function IX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||rD,i)}function jX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||iD,i)}function FX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||nD,i)}function OX(n){switch(n){case 5126:return vX;case 35664:return _X;case 35665:return bX;case 35666:return wX;case 35674:return SX;case 35675:return TX;case 35676:return NX;case 5124:case 35670:return EX;case 35667:case 35671:return MX;case 35668:case 35672:return CX;case 35669:case 35673:return AX;case 5125:return RX;case 36294:return PX;case 36295:return kX;case 36296:return LX;case 35678:case 36198:case 36298:case 36306:case 35682:return DX;case 35679:case 36299:case 36307:return IX;case 35680:case 36300:case 36308:case 36293:return jX;case 36289:case 36303:case 36311:case 36292:return FX}}function UX(n,e){n.uniform1fv(this.addr,e)}function BX(n,e){const t=sh(e,this.size,2);n.uniform2fv(this.addr,t)}function zX(n,e){const t=sh(e,this.size,3);n.uniform3fv(this.addr,t)}function VX(n,e){const t=sh(e,this.size,4);n.uniform4fv(this.addr,t)}function GX(n,e){const t=sh(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function HX(n,e){const t=sh(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function $X(n,e){const t=sh(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function WX(n,e){n.uniform1iv(this.addr,e)}function qX(n,e){n.uniform2iv(this.addr,e)}function XX(n,e){n.uniform3iv(this.addr,e)}function YX(n,e){n.uniform4iv(this.addr,e)}function KX(n,e){n.uniform1uiv(this.addr,e)}function ZX(n,e){n.uniform2uiv(this.addr,e)}function QX(n,e){n.uniform3uiv(this.addr,e)}function JX(n,e){n.uniform4uiv(this.addr,e)}function eY(n,e,t){const r=this.cache,i=e.length,s=ey(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||tD,s[a])}function tY(n,e,t){const r=this.cache,i=e.length,s=ey(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||rD,s[a])}function nY(n,e,t){const r=this.cache,i=e.length,s=ey(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||iD,s[a])}function rY(n,e,t){const r=this.cache,i=e.length,s=ey(t,i);gr(r,s)||(n.uniform1iv(this.addr,s),xr(r,s));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||nD,s[a])}function iY(n){switch(n){case 5126:return UX;case 35664:return BX;case 35665:return zX;case 35666:return VX;case 35674:return GX;case 35675:return HX;case 35676:return $X;case 5124:case 35670:return WX;case 35667:case 35671:return qX;case 35668:case 35672:return XX;case 35669:case 35673:return YX;case 5125:return KX;case 36294:return ZX;case 36295:return QX;case 36296:return JX;case 35678:case 36198:case 36298:case 36306:case 35682:return eY;case 35679:case 36299:case 36307:return tY;case 35680:case 36300:case 36308:case 36293:return nY;case 36289:case 36303:case 36311:case 36292:return rY}}class sY{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=OX(t.type)}}class aY{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=iY(t.type)}}class oY{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,a=i.length;s!==a;++s){const o=i[s];o.setValue(e,t[o.id],r)}}}const sb=/(\w+)(\])?(\[|\.)?/g;function AA(n,e){n.seq.push(e),n.map[e.id]=e}function lY(n,e,t){const r=n.name,i=r.length;for(sb.lastIndex=0;;){const s=sb.exec(r),a=sb.lastIndex;let o=s[1];const l=s[2]==="]",u=s[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===i){AA(t,u===void 0?new sY(o,n,e):new aY(o,n,e));break}else{let p=t.map[o];p===void 0&&(p=new oY(o),AA(t,p)),t=p}}}class j0{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i),a=e.getUniformLocation(t,s.name);lY(s,a,this)}}setValue(e,t,r,i){const s=this.map[t];s!==void 0&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,a=t.length;s!==a;++s){const o=t[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const a=e[i];a.id in t&&r.push(a)}return r}}function RA(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const cY=37297;let uY=0;function dY(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=i;a<s;a++){const o=a+1;r.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return r.join(`
`)}const PA=new Ut;function hY(n){Ot._getMatrix(PA,Ot.workingColorSpace,n);const e=`mat3( ${PA.elements.map(t=>t.toFixed(4))} )`;switch(Ot.getTransfer(n)){case Ud:return[e,"LinearTransferOETF"];case st:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function kA(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+dY(n.getShaderSource(e),a)}else return i}function fY(n,e){const t=hY(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function pY(n,e){let t;switch(e){case R3:t="Linear";break;case P3:t="Reinhard";break;case k3:t="Cineon";break;case L3:t="ACESFilmic";break;case D3:t="AgX";break;case I3:t="Neutral";break;case T$:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const qg=new ee;function mY(){Ot.getLuminanceCoefficients(qg);const n=qg.x.toFixed(4),e=qg.y.toFixed(4),t=qg.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function gY(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Pf).join(`
`)}function xY(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function yY(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),a=s.name;let o=1;s.type===n.FLOAT_MAT2&&(o=2),s.type===n.FLOAT_MAT3&&(o=3),s.type===n.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function Pf(n){return n!==""}function LA(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function DA(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const vY=/^[ \t]*#include +<([\w\d./]+)>/gm;function iS(n){return n.replace(vY,bY)}const _Y=new Map;function bY(n,e){let t=qt[e];if(t===void 0){const r=_Y.get(e);if(r!==void 0)t=qt[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return iS(t)}const wY=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function IA(n){return n.replace(wY,SY)}function SY(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function jA(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function TY(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===_1?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===v$?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Wi&&(e="SHADOWMAP_TYPE_VSM"),e}function NY(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case xa:case ya:e="ENVMAP_TYPE_CUBE";break;case Tc:e="ENVMAP_TYPE_CUBE_UV";break}return e}function EY(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case ya:e="ENVMAP_MODE_REFRACTION";break}return e}function MY(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case qp:e="ENVMAP_BLENDING_MULTIPLY";break;case C3:e="ENVMAP_BLENDING_MIX";break;case A3:e="ENVMAP_BLENDING_ADD";break}return e}function CY(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}function AY(n,e,t,r){const i=n.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=TY(t),u=NY(t),h=EY(t),p=MY(t),m=CY(t),g=gY(t),y=xY(s),b=i.createProgram();let _,x,N=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Pf).join(`
`),_.length>0&&(_+=`
`),x=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Pf).join(`
`),x.length>0&&(x+=`
`)):(_=[jA(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Pf).join(`
`),x=[jA(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.envMap?"#define "+p:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Pi?"#define TONE_MAPPING":"",t.toneMapping!==Pi?qt.tonemapping_pars_fragment:"",t.toneMapping!==Pi?pY("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",qt.colorspace_pars_fragment,fY("linearToOutputTexel",t.outputColorSpace),mY(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Pf).join(`
`)),a=iS(a),a=LA(a,t),a=DA(a,t),o=iS(o),o=LA(o,t),o=DA(o,t),a=IA(a),o=IA(o),t.isRawShaderMaterial!==!0&&(N=`#version 300 es
`,_=[g,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+_,x=["#define varying in",t.glslVersion===UC?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===UC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const T=N+_+a,S=N+x+o,M=RA(i,i.VERTEX_SHADER,T),C=RA(i,i.FRAGMENT_SHADER,S);i.attachShader(b,M),i.attachShader(b,C),t.index0AttributeName!==void 0?i.bindAttribLocation(b,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(b,0,"position"),i.linkProgram(b);function R(P){if(n.debug.checkShaderErrors){const G=i.getProgramInfoLog(b).trim(),$=i.getShaderInfoLog(M).trim(),U=i.getShaderInfoLog(C).trim();let K=!0,O=!0;if(i.getProgramParameter(b,i.LINK_STATUS)===!1)if(K=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,b,M,C);else{const j=kA(i,M,"vertex"),L=kA(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(b,i.VALIDATE_STATUS)+`

Material Name: `+P.name+`
Material Type: `+P.type+`

Program Info Log: `+G+`
`+j+`
`+L)}else G!==""?console.warn("THREE.WebGLProgram: Program Info Log:",G):($===""||U==="")&&(O=!1);O&&(P.diagnostics={runnable:K,programLog:G,vertexShader:{log:$,prefix:_},fragmentShader:{log:U,prefix:x}})}i.deleteShader(M),i.deleteShader(C),F=new j0(i,b),k=yY(i,b)}let F;this.getUniforms=function(){return F===void 0&&R(this),F};let k;this.getAttributes=function(){return k===void 0&&R(this),k};let D=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return D===!1&&(D=i.getProgramParameter(b,cY)),D},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(b),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=uY++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=M,this.fragmentShader=C,this}let RY=0;class PY{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new kY(e),t.set(e,r)),r}}class kY{constructor(e){this.id=RY++,this.code=e,this.usedTimes=0}}function LY(n,e,t,r,i,s,a){const o=new $1,l=new PY,u=new Set,h=[],p=i.logarithmicDepthBuffer,m=i.vertexTextures;let g=i.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(k){return u.add(k),k===0?"uv":`uv${k}`}function _(k,D,P,G,$){const U=G.fog,K=$.geometry,O=k.isMeshStandardMaterial?G.environment:null,j=(k.isMeshStandardMaterial?t:e).get(k.envMap||O),L=j&&j.mapping===Tc?j.image.height:null,B=y[k.type];k.precision!==null&&(g=i.getMaxPrecision(k.precision),g!==k.precision&&console.warn("THREE.WebGLProgram.getParameters:",k.precision,"not supported, using",g,"instead."));const V=K.morphAttributes.position||K.morphAttributes.normal||K.morphAttributes.color,z=V!==void 0?V.length:0;let Y=0;K.morphAttributes.position!==void 0&&(Y=1),K.morphAttributes.normal!==void 0&&(Y=2),K.morphAttributes.color!==void 0&&(Y=3);let se,J,q,Q;if(B){const nn=sa[B];se=nn.vertexShader,J=nn.fragmentShader}else se=k.vertexShader,J=k.fragmentShader,l.update(k),q=l.getVertexShaderID(k),Q=l.getFragmentShaderID(k);const te=n.getRenderTarget(),X=n.state.buffers.depth.getReversed(),ce=$.isInstancedMesh===!0,me=$.isBatchedMesh===!0,Re=!!k.map,He=!!k.matcap,Qe=!!j,ie=!!k.aoMap,Et=!!k.lightMap,yt=!!k.bumpMap,tt=!!k.normalMap,Ne=!!k.displacementMap,_t=!!k.emissiveMap,it=!!k.metalnessMap,wt=!!k.roughnessMap,fn=k.anisotropy>0,ne=k.clearcoat>0,W=k.dispersion>0,ye=k.iridescence>0,Ce=k.sheen>0,Pe=k.transmission>0,Te=fn&&!!k.anisotropyMap,ut=ne&&!!k.clearcoatMap,qe=ne&&!!k.clearcoatNormalMap,Ke=ne&&!!k.clearcoatRoughnessMap,lt=ye&&!!k.iridescenceMap,De=ye&&!!k.iridescenceThicknessMap,et=Ce&&!!k.sheenColorMap,St=Ce&&!!k.sheenRoughnessMap,pt=!!k.specularMap,We=!!k.specularColorMap,Mt=!!k.specularIntensityMap,le=Pe&&!!k.transmissionMap,Ze=Pe&&!!k.thicknessMap,Ie=!!k.gradientMap,rt=!!k.alphaMap,Be=k.alphaTest>0,Le=!!k.alphaHash,dt=!!k.extensions;let Dt=Pi;k.toneMapped&&(te===null||te.isXRRenderTarget===!0)&&(Dt=n.toneMapping);const pn={shaderID:B,shaderType:k.type,shaderName:k.name,vertexShader:se,fragmentShader:J,defines:k.defines,customVertexShaderID:q,customFragmentShaderID:Q,isRawShaderMaterial:k.isRawShaderMaterial===!0,glslVersion:k.glslVersion,precision:g,batching:me,batchingColor:me&&$._colorsTexture!==null,instancing:ce,instancingColor:ce&&$.instanceColor!==null,instancingMorph:ce&&$.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:te===null?n.outputColorSpace:te.isXRRenderTarget===!0?te.texture.colorSpace:pa,alphaToCoverage:!!k.alphaToCoverage,map:Re,matcap:He,envMap:Qe,envMapMode:Qe&&j.mapping,envMapCubeUVHeight:L,aoMap:ie,lightMap:Et,bumpMap:yt,normalMap:tt,displacementMap:m&&Ne,emissiveMap:_t,normalMapObjectSpace:tt&&k.normalMapType===j3,normalMapTangentSpace:tt&&k.normalMapType===xo,metalnessMap:it,roughnessMap:wt,anisotropy:fn,anisotropyMap:Te,clearcoat:ne,clearcoatMap:ut,clearcoatNormalMap:qe,clearcoatRoughnessMap:Ke,dispersion:W,iridescence:ye,iridescenceMap:lt,iridescenceThicknessMap:De,sheen:Ce,sheenColorMap:et,sheenRoughnessMap:St,specularMap:pt,specularColorMap:We,specularIntensityMap:Mt,transmission:Pe,transmissionMap:le,thicknessMap:Ze,gradientMap:Ie,opaque:k.transparent===!1&&k.blending===Yi&&k.alphaToCoverage===!1,alphaMap:rt,alphaTest:Be,alphaHash:Le,combine:k.combine,mapUv:Re&&b(k.map.channel),aoMapUv:ie&&b(k.aoMap.channel),lightMapUv:Et&&b(k.lightMap.channel),bumpMapUv:yt&&b(k.bumpMap.channel),normalMapUv:tt&&b(k.normalMap.channel),displacementMapUv:Ne&&b(k.displacementMap.channel),emissiveMapUv:_t&&b(k.emissiveMap.channel),metalnessMapUv:it&&b(k.metalnessMap.channel),roughnessMapUv:wt&&b(k.roughnessMap.channel),anisotropyMapUv:Te&&b(k.anisotropyMap.channel),clearcoatMapUv:ut&&b(k.clearcoatMap.channel),clearcoatNormalMapUv:qe&&b(k.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ke&&b(k.clearcoatRoughnessMap.channel),iridescenceMapUv:lt&&b(k.iridescenceMap.channel),iridescenceThicknessMapUv:De&&b(k.iridescenceThicknessMap.channel),sheenColorMapUv:et&&b(k.sheenColorMap.channel),sheenRoughnessMapUv:St&&b(k.sheenRoughnessMap.channel),specularMapUv:pt&&b(k.specularMap.channel),specularColorMapUv:We&&b(k.specularColorMap.channel),specularIntensityMapUv:Mt&&b(k.specularIntensityMap.channel),transmissionMapUv:le&&b(k.transmissionMap.channel),thicknessMapUv:Ze&&b(k.thicknessMap.channel),alphaMapUv:rt&&b(k.alphaMap.channel),vertexTangents:!!K.attributes.tangent&&(tt||fn),vertexColors:k.vertexColors,vertexAlphas:k.vertexColors===!0&&!!K.attributes.color&&K.attributes.color.itemSize===4,pointsUvs:$.isPoints===!0&&!!K.attributes.uv&&(Re||rt),fog:!!U,useFog:k.fog===!0,fogExp2:!!U&&U.isFogExp2,flatShading:k.flatShading===!0&&k.wireframe===!1,sizeAttenuation:k.sizeAttenuation===!0,logarithmicDepthBuffer:p,reverseDepthBuffer:X,skinning:$.isSkinnedMesh===!0,morphTargets:K.morphAttributes.position!==void 0,morphNormals:K.morphAttributes.normal!==void 0,morphColors:K.morphAttributes.color!==void 0,morphTargetsCount:z,morphTextureStride:Y,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numLightProbes:D.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:k.dithering,shadowMapEnabled:n.shadowMap.enabled&&P.length>0,shadowMapType:n.shadowMap.type,toneMapping:Dt,decodeVideoTexture:Re&&k.map.isVideoTexture===!0&&Ot.getTransfer(k.map.colorSpace)===st,decodeVideoTextureEmissive:_t&&k.emissiveMap.isVideoTexture===!0&&Ot.getTransfer(k.emissiveMap.colorSpace)===st,premultipliedAlpha:k.premultipliedAlpha,doubleSided:k.side===Yr,flipSided:k.side===bn,useDepthPacking:k.depthPacking>=0,depthPacking:k.depthPacking||0,index0AttributeName:k.index0AttributeName,extensionClipCullDistance:dt&&k.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(dt&&k.extensions.multiDraw===!0||me)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:k.customProgramCacheKey()};return pn.vertexUv1s=u.has(1),pn.vertexUv2s=u.has(2),pn.vertexUv3s=u.has(3),u.clear(),pn}function x(k){const D=[];if(k.shaderID?D.push(k.shaderID):(D.push(k.customVertexShaderID),D.push(k.customFragmentShaderID)),k.defines!==void 0)for(const P in k.defines)D.push(P),D.push(k.defines[P]);return k.isRawShaderMaterial===!1&&(N(D,k),T(D,k),D.push(n.outputColorSpace)),D.push(k.customProgramCacheKey),D.join()}function N(k,D){k.push(D.precision),k.push(D.outputColorSpace),k.push(D.envMapMode),k.push(D.envMapCubeUVHeight),k.push(D.mapUv),k.push(D.alphaMapUv),k.push(D.lightMapUv),k.push(D.aoMapUv),k.push(D.bumpMapUv),k.push(D.normalMapUv),k.push(D.displacementMapUv),k.push(D.emissiveMapUv),k.push(D.metalnessMapUv),k.push(D.roughnessMapUv),k.push(D.anisotropyMapUv),k.push(D.clearcoatMapUv),k.push(D.clearcoatNormalMapUv),k.push(D.clearcoatRoughnessMapUv),k.push(D.iridescenceMapUv),k.push(D.iridescenceThicknessMapUv),k.push(D.sheenColorMapUv),k.push(D.sheenRoughnessMapUv),k.push(D.specularMapUv),k.push(D.specularColorMapUv),k.push(D.specularIntensityMapUv),k.push(D.transmissionMapUv),k.push(D.thicknessMapUv),k.push(D.combine),k.push(D.fogExp2),k.push(D.sizeAttenuation),k.push(D.morphTargetsCount),k.push(D.morphAttributeCount),k.push(D.numDirLights),k.push(D.numPointLights),k.push(D.numSpotLights),k.push(D.numSpotLightMaps),k.push(D.numHemiLights),k.push(D.numRectAreaLights),k.push(D.numDirLightShadows),k.push(D.numPointLightShadows),k.push(D.numSpotLightShadows),k.push(D.numSpotLightShadowsWithMaps),k.push(D.numLightProbes),k.push(D.shadowMapType),k.push(D.toneMapping),k.push(D.numClippingPlanes),k.push(D.numClipIntersection),k.push(D.depthPacking)}function T(k,D){o.disableAll(),D.supportsVertexTextures&&o.enable(0),D.instancing&&o.enable(1),D.instancingColor&&o.enable(2),D.instancingMorph&&o.enable(3),D.matcap&&o.enable(4),D.envMap&&o.enable(5),D.normalMapObjectSpace&&o.enable(6),D.normalMapTangentSpace&&o.enable(7),D.clearcoat&&o.enable(8),D.iridescence&&o.enable(9),D.alphaTest&&o.enable(10),D.vertexColors&&o.enable(11),D.vertexAlphas&&o.enable(12),D.vertexUv1s&&o.enable(13),D.vertexUv2s&&o.enable(14),D.vertexUv3s&&o.enable(15),D.vertexTangents&&o.enable(16),D.anisotropy&&o.enable(17),D.alphaHash&&o.enable(18),D.batching&&o.enable(19),D.dispersion&&o.enable(20),D.batchingColor&&o.enable(21),D.gradientMap&&o.enable(22),k.push(o.mask),o.disableAll(),D.fog&&o.enable(0),D.useFog&&o.enable(1),D.flatShading&&o.enable(2),D.logarithmicDepthBuffer&&o.enable(3),D.reverseDepthBuffer&&o.enable(4),D.skinning&&o.enable(5),D.morphTargets&&o.enable(6),D.morphNormals&&o.enable(7),D.morphColors&&o.enable(8),D.premultipliedAlpha&&o.enable(9),D.shadowMapEnabled&&o.enable(10),D.doubleSided&&o.enable(11),D.flipSided&&o.enable(12),D.useDepthPacking&&o.enable(13),D.dithering&&o.enable(14),D.transmission&&o.enable(15),D.sheen&&o.enable(16),D.opaque&&o.enable(17),D.pointsUvs&&o.enable(18),D.decodeVideoTexture&&o.enable(19),D.decodeVideoTextureEmissive&&o.enable(20),D.alphaToCoverage&&o.enable(21),k.push(o.mask)}function S(k){const D=y[k.type];let P;if(D){const G=sa[D];P=z3.clone(G.uniforms)}else P=k.uniforms;return P}function M(k,D){let P;for(let G=0,$=h.length;G<$;G++){const U=h[G];if(U.cacheKey===D){P=U,++P.usedTimes;break}}return P===void 0&&(P=new AY(n,D,k,s),h.push(P)),P}function C(k){if(--k.usedTimes===0){const D=h.indexOf(k);h[D]=h[h.length-1],h.pop(),k.destroy()}}function R(k){l.remove(k)}function F(){l.dispose()}return{getParameters:_,getProgramCacheKey:x,getUniforms:S,acquireProgram:M,releaseProgram:C,releaseShaderCache:R,programs:h,dispose:F}}function DY(){let n=new WeakMap;function e(a){return n.has(a)}function t(a){let o=n.get(a);return o===void 0&&(o={},n.set(a,o)),o}function r(a){n.delete(a)}function i(a,o,l){n.get(a)[o]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:s}}function IY(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function FA(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function OA(){const n=[];let e=0;const t=[],r=[],i=[];function s(){e=0,t.length=0,r.length=0,i.length=0}function a(p,m,g,y,b,_){let x=n[e];return x===void 0?(x={id:p.id,object:p,geometry:m,material:g,groupOrder:y,renderOrder:p.renderOrder,z:b,group:_},n[e]=x):(x.id=p.id,x.object=p,x.geometry=m,x.material=g,x.groupOrder=y,x.renderOrder=p.renderOrder,x.z=b,x.group=_),e++,x}function o(p,m,g,y,b,_){const x=a(p,m,g,y,b,_);g.transmission>0?r.push(x):g.transparent===!0?i.push(x):t.push(x)}function l(p,m,g,y,b,_){const x=a(p,m,g,y,b,_);g.transmission>0?r.unshift(x):g.transparent===!0?i.unshift(x):t.unshift(x)}function u(p,m){t.length>1&&t.sort(p||IY),r.length>1&&r.sort(m||FA),i.length>1&&i.sort(m||FA)}function h(){for(let p=e,m=n.length;p<m;p++){const g=n[p];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.group=null}}return{opaque:t,transmissive:r,transparent:i,init:s,push:o,unshift:l,finish:h,sort:u}}function jY(){let n=new WeakMap;function e(r,i){const s=n.get(r);let a;return s===void 0?(a=new OA,n.set(r,[a])):i>=s.length?(a=new OA,s.push(a)):a=s[i],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function FY(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ee,color:new vt};break;case"SpotLight":t={position:new ee,direction:new ee,color:new vt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ee,color:new vt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ee,skyColor:new vt,groundColor:new vt};break;case"RectAreaLight":t={color:new vt,position:new ee,halfWidth:new ee,halfHeight:new ee};break}return n[e.id]=t,t}}}function OY(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let UY=0;function BY(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function zY(n){const e=new FY,t=OY(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new ee);const i=new ee,s=new Yt,a=new Yt;function o(u){let h=0,p=0,m=0;for(let k=0;k<9;k++)r.probe[k].set(0,0,0);let g=0,y=0,b=0,_=0,x=0,N=0,T=0,S=0,M=0,C=0,R=0;u.sort(BY);for(let k=0,D=u.length;k<D;k++){const P=u[k],G=P.color,$=P.intensity,U=P.distance,K=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)h+=G.r*$,p+=G.g*$,m+=G.b*$;else if(P.isLightProbe){for(let O=0;O<9;O++)r.probe[O].addScaledVector(P.sh.coefficients[O],$);R++}else if(P.isDirectionalLight){const O=e.get(P);if(O.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const j=P.shadow,L=t.get(P);L.shadowIntensity=j.intensity,L.shadowBias=j.bias,L.shadowNormalBias=j.normalBias,L.shadowRadius=j.radius,L.shadowMapSize=j.mapSize,r.directionalShadow[g]=L,r.directionalShadowMap[g]=K,r.directionalShadowMatrix[g]=P.shadow.matrix,N++}r.directional[g]=O,g++}else if(P.isSpotLight){const O=e.get(P);O.position.setFromMatrixPosition(P.matrixWorld),O.color.copy(G).multiplyScalar($),O.distance=U,O.coneCos=Math.cos(P.angle),O.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),O.decay=P.decay,r.spot[b]=O;const j=P.shadow;if(P.map&&(r.spotLightMap[M]=P.map,M++,j.updateMatrices(P),P.castShadow&&C++),r.spotLightMatrix[b]=j.matrix,P.castShadow){const L=t.get(P);L.shadowIntensity=j.intensity,L.shadowBias=j.bias,L.shadowNormalBias=j.normalBias,L.shadowRadius=j.radius,L.shadowMapSize=j.mapSize,r.spotShadow[b]=L,r.spotShadowMap[b]=K,S++}b++}else if(P.isRectAreaLight){const O=e.get(P);O.color.copy(G).multiplyScalar($),O.halfWidth.set(P.width*.5,0,0),O.halfHeight.set(0,P.height*.5,0),r.rectArea[_]=O,_++}else if(P.isPointLight){const O=e.get(P);if(O.color.copy(P.color).multiplyScalar(P.intensity),O.distance=P.distance,O.decay=P.decay,P.castShadow){const j=P.shadow,L=t.get(P);L.shadowIntensity=j.intensity,L.shadowBias=j.bias,L.shadowNormalBias=j.normalBias,L.shadowRadius=j.radius,L.shadowMapSize=j.mapSize,L.shadowCameraNear=j.camera.near,L.shadowCameraFar=j.camera.far,r.pointShadow[y]=L,r.pointShadowMap[y]=K,r.pointShadowMatrix[y]=P.shadow.matrix,T++}r.point[y]=O,y++}else if(P.isHemisphereLight){const O=e.get(P);O.skyColor.copy(P.color).multiplyScalar($),O.groundColor.copy(P.groundColor).multiplyScalar($),r.hemi[x]=O,x++}}_>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=nt.LTC_FLOAT_1,r.rectAreaLTC2=nt.LTC_FLOAT_2):(r.rectAreaLTC1=nt.LTC_HALF_1,r.rectAreaLTC2=nt.LTC_HALF_2)),r.ambient[0]=h,r.ambient[1]=p,r.ambient[2]=m;const F=r.hash;(F.directionalLength!==g||F.pointLength!==y||F.spotLength!==b||F.rectAreaLength!==_||F.hemiLength!==x||F.numDirectionalShadows!==N||F.numPointShadows!==T||F.numSpotShadows!==S||F.numSpotMaps!==M||F.numLightProbes!==R)&&(r.directional.length=g,r.spot.length=b,r.rectArea.length=_,r.point.length=y,r.hemi.length=x,r.directionalShadow.length=N,r.directionalShadowMap.length=N,r.pointShadow.length=T,r.pointShadowMap.length=T,r.spotShadow.length=S,r.spotShadowMap.length=S,r.directionalShadowMatrix.length=N,r.pointShadowMatrix.length=T,r.spotLightMatrix.length=S+M-C,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=C,r.numLightProbes=R,F.directionalLength=g,F.pointLength=y,F.spotLength=b,F.rectAreaLength=_,F.hemiLength=x,F.numDirectionalShadows=N,F.numPointShadows=T,F.numSpotShadows=S,F.numSpotMaps=M,F.numLightProbes=R,r.version=UY++)}function l(u,h){let p=0,m=0,g=0,y=0,b=0;const _=h.matrixWorldInverse;for(let x=0,N=u.length;x<N;x++){const T=u[x];if(T.isDirectionalLight){const S=r.directional[p];S.direction.setFromMatrixPosition(T.matrixWorld),i.setFromMatrixPosition(T.target.matrixWorld),S.direction.sub(i),S.direction.transformDirection(_),p++}else if(T.isSpotLight){const S=r.spot[g];S.position.setFromMatrixPosition(T.matrixWorld),S.position.applyMatrix4(_),S.direction.setFromMatrixPosition(T.matrixWorld),i.setFromMatrixPosition(T.target.matrixWorld),S.direction.sub(i),S.direction.transformDirection(_),g++}else if(T.isRectAreaLight){const S=r.rectArea[y];S.position.setFromMatrixPosition(T.matrixWorld),S.position.applyMatrix4(_),a.identity(),s.copy(T.matrixWorld),s.premultiply(_),a.extractRotation(s),S.halfWidth.set(T.width*.5,0,0),S.halfHeight.set(0,T.height*.5,0),S.halfWidth.applyMatrix4(a),S.halfHeight.applyMatrix4(a),y++}else if(T.isPointLight){const S=r.point[m];S.position.setFromMatrixPosition(T.matrixWorld),S.position.applyMatrix4(_),m++}else if(T.isHemisphereLight){const S=r.hemi[b];S.direction.setFromMatrixPosition(T.matrixWorld),S.direction.transformDirection(_),b++}}}return{setup:o,setupView:l,state:r}}function UA(n){const e=new zY(n),t=[],r=[];function i(h){u.camera=h,t.length=0,r.length=0}function s(h){t.push(h)}function a(h){r.push(h)}function o(){e.setup(t)}function l(h){e.setupView(t,h)}const u={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function VY(n){let e=new WeakMap;function t(i,s=0){const a=e.get(i);let o;return a===void 0?(o=new UA(n),e.set(i,[o])):s>=a.length?(o=new UA(n),a.push(o)):o=a[s],o}function r(){e=new WeakMap}return{get:t,dispose:r}}const GY=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,HY=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function $Y(n,e,t){let r=new Qp;const i=new je,s=new je,a=new Lt,o=new iW({depthPacking:M$}),l=new sW,u={},h=t.maxTextureSize,p={[Ai]:bn,[bn]:Ai,[Yr]:Yr},m=new va({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new je},radius:{value:4}},vertexShader:GY,fragmentShader:HY}),g=m.clone();g.defines.HORIZONTAL_PASS=1;const y=new ei;y.setAttribute("position",new Fr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new Xn(y,m),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_1;let x=this.type;this.render=function(C,R,F){if(_.enabled===!1||_.autoUpdate===!1&&_.needsUpdate===!1||C.length===0)return;const k=n.getRenderTarget(),D=n.getActiveCubeFace(),P=n.getActiveMipmapLevel(),G=n.state;G.setBlending(Ri),G.buffers.color.setClear(1,1,1,1),G.buffers.depth.setTest(!0),G.setScissorTest(!1);const $=x!==Wi&&this.type===Wi,U=x===Wi&&this.type!==Wi;for(let K=0,O=C.length;K<O;K++){const j=C[K],L=j.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",j,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;i.copy(L.mapSize);const B=L.getFrameExtents();if(i.multiply(B),s.copy(L.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(s.x=Math.floor(h/B.x),i.x=s.x*B.x,L.mapSize.x=s.x),i.y>h&&(s.y=Math.floor(h/B.y),i.y=s.y*B.y,L.mapSize.y=s.y)),L.map===null||$===!0||U===!0){const z=this.type!==Wi?{minFilter:An,magFilter:An}:{};L.map!==null&&L.map.dispose(),L.map=new _l(i.x,i.y,z),L.map.texture.name=j.name+".shadowMap",L.camera.updateProjectionMatrix()}n.setRenderTarget(L.map),n.clear();const V=L.getViewportCount();for(let z=0;z<V;z++){const Y=L.getViewport(z);a.set(s.x*Y.x,s.y*Y.y,s.x*Y.z,s.y*Y.w),G.viewport(a),L.updateMatrices(j,z),r=L.getFrustum(),S(R,F,L.camera,j,this.type)}L.isPointLightShadow!==!0&&this.type===Wi&&N(L,F),L.needsUpdate=!1}x=this.type,_.needsUpdate=!1,n.setRenderTarget(k,D,P)};function N(C,R){const F=e.update(b);m.defines.VSM_SAMPLES!==C.blurSamples&&(m.defines.VSM_SAMPLES=C.blurSamples,g.defines.VSM_SAMPLES=C.blurSamples,m.needsUpdate=!0,g.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new _l(i.x,i.y)),m.uniforms.shadow_pass.value=C.map.texture,m.uniforms.resolution.value=C.mapSize,m.uniforms.radius.value=C.radius,n.setRenderTarget(C.mapPass),n.clear(),n.renderBufferDirect(R,null,F,m,b,null),g.uniforms.shadow_pass.value=C.mapPass.texture,g.uniforms.resolution.value=C.mapSize,g.uniforms.radius.value=C.radius,n.setRenderTarget(C.map),n.clear(),n.renderBufferDirect(R,null,F,g,b,null)}function T(C,R,F,k){let D=null;const P=F.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(P!==void 0)D=P;else if(D=F.isPointLight===!0?l:o,n.localClippingEnabled&&R.clipShadows===!0&&Array.isArray(R.clippingPlanes)&&R.clippingPlanes.length!==0||R.displacementMap&&R.displacementScale!==0||R.alphaMap&&R.alphaTest>0||R.map&&R.alphaTest>0||R.alphaToCoverage===!0){const G=D.uuid,$=R.uuid;let U=u[G];U===void 0&&(U={},u[G]=U);let K=U[$];K===void 0&&(K=D.clone(),U[$]=K,R.addEventListener("dispose",M)),D=K}if(D.visible=R.visible,D.wireframe=R.wireframe,k===Wi?D.side=R.shadowSide!==null?R.shadowSide:R.side:D.side=R.shadowSide!==null?R.shadowSide:p[R.side],D.alphaMap=R.alphaMap,D.alphaTest=R.alphaToCoverage===!0?.5:R.alphaTest,D.map=R.map,D.clipShadows=R.clipShadows,D.clippingPlanes=R.clippingPlanes,D.clipIntersection=R.clipIntersection,D.displacementMap=R.displacementMap,D.displacementScale=R.displacementScale,D.displacementBias=R.displacementBias,D.wireframeLinewidth=R.wireframeLinewidth,D.linewidth=R.linewidth,F.isPointLight===!0&&D.isMeshDistanceMaterial===!0){const G=n.properties.get(D);G.light=F}return D}function S(C,R,F,k,D){if(C.visible===!1)return;if(C.layers.test(R.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&D===Wi)&&(!C.frustumCulled||r.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,C.matrixWorld);const $=e.update(C),U=C.material;if(Array.isArray(U)){const K=$.groups;for(let O=0,j=K.length;O<j;O++){const L=K[O],B=U[L.materialIndex];if(B&&B.visible){const V=T(C,B,k,D);C.onBeforeShadow(n,C,R,F,$,V,L),n.renderBufferDirect(F,null,$,V,C,L),C.onAfterShadow(n,C,R,F,$,V,L)}}}else if(U.visible){const K=T(C,U,k,D);C.onBeforeShadow(n,C,R,F,$,K,null),n.renderBufferDirect(F,null,$,K,C,null),C.onAfterShadow(n,C,R,F,$,K,null)}}const G=C.children;for(let $=0,U=G.length;$<U;$++)S(G[$],R,F,k,D)}function M(C){C.target.removeEventListener("dispose",M);for(const F in u){const k=u[F],D=C.target.uuid;D in k&&(k[D].dispose(),delete k[D])}}}const WY={[up]:dp,[hp]:mp,[fp]:gp,[yl]:pp,[dp]:up,[mp]:hp,[gp]:fp,[pp]:yl};function qY(n,e){function t(){let le=!1;const Ze=new Lt;let Ie=null;const rt=new Lt(0,0,0,0);return{setMask:function(Be){Ie!==Be&&!le&&(n.colorMask(Be,Be,Be,Be),Ie=Be)},setLocked:function(Be){le=Be},setClear:function(Be,Le,dt,Dt,pn){pn===!0&&(Be*=Dt,Le*=Dt,dt*=Dt),Ze.set(Be,Le,dt,Dt),rt.equals(Ze)===!1&&(n.clearColor(Be,Le,dt,Dt),rt.copy(Ze))},reset:function(){le=!1,Ie=null,rt.set(-1,0,0,0)}}}function r(){let le=!1,Ze=!1,Ie=null,rt=null,Be=null;return{setReversed:function(Le){if(Ze!==Le){const dt=e.get("EXT_clip_control");Le?dt.clipControlEXT(dt.LOWER_LEFT_EXT,dt.ZERO_TO_ONE_EXT):dt.clipControlEXT(dt.LOWER_LEFT_EXT,dt.NEGATIVE_ONE_TO_ONE_EXT),Ze=Le;const Dt=Be;Be=null,this.setClear(Dt)}},getReversed:function(){return Ze},setTest:function(Le){Le?te(n.DEPTH_TEST):X(n.DEPTH_TEST)},setMask:function(Le){Ie!==Le&&!le&&(n.depthMask(Le),Ie=Le)},setFunc:function(Le){if(Ze&&(Le=WY[Le]),rt!==Le){switch(Le){case up:n.depthFunc(n.NEVER);break;case dp:n.depthFunc(n.ALWAYS);break;case hp:n.depthFunc(n.LESS);break;case yl:n.depthFunc(n.LEQUAL);break;case fp:n.depthFunc(n.EQUAL);break;case pp:n.depthFunc(n.GEQUAL);break;case mp:n.depthFunc(n.GREATER);break;case gp:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}rt=Le}},setLocked:function(Le){le=Le},setClear:function(Le){Be!==Le&&(Ze&&(Le=1-Le),n.clearDepth(Le),Be=Le)},reset:function(){le=!1,Ie=null,rt=null,Be=null,Ze=!1}}}function i(){let le=!1,Ze=null,Ie=null,rt=null,Be=null,Le=null,dt=null,Dt=null,pn=null;return{setTest:function(nn){le||(nn?te(n.STENCIL_TEST):X(n.STENCIL_TEST))},setMask:function(nn){Ze!==nn&&!le&&(n.stencilMask(nn),Ze=nn)},setFunc:function(nn,Br,Pr){(Ie!==nn||rt!==Br||Be!==Pr)&&(n.stencilFunc(nn,Br,Pr),Ie=nn,rt=Br,Be=Pr)},setOp:function(nn,Br,Pr){(Le!==nn||dt!==Br||Dt!==Pr)&&(n.stencilOp(nn,Br,Pr),Le=nn,dt=Br,Dt=Pr)},setLocked:function(nn){le=nn},setClear:function(nn){pn!==nn&&(n.clearStencil(nn),pn=nn)},reset:function(){le=!1,Ze=null,Ie=null,rt=null,Be=null,Le=null,dt=null,Dt=null,pn=null}}}const s=new t,a=new r,o=new i,l=new WeakMap,u=new WeakMap;let h={},p={},m=new WeakMap,g=[],y=null,b=!1,_=null,x=null,N=null,T=null,S=null,M=null,C=null,R=new vt(0,0,0),F=0,k=!1,D=null,P=null,G=null,$=null,U=null;const K=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let O=!1,j=0;const L=n.getParameter(n.VERSION);L.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(L)[1]),O=j>=1):L.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),O=j>=2);let B=null,V={};const z=n.getParameter(n.SCISSOR_BOX),Y=n.getParameter(n.VIEWPORT),se=new Lt().fromArray(z),J=new Lt().fromArray(Y);function q(le,Ze,Ie,rt){const Be=new Uint8Array(4),Le=n.createTexture();n.bindTexture(le,Le),n.texParameteri(le,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(le,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let dt=0;dt<Ie;dt++)le===n.TEXTURE_3D||le===n.TEXTURE_2D_ARRAY?n.texImage3D(Ze,0,n.RGBA,1,1,rt,0,n.RGBA,n.UNSIGNED_BYTE,Be):n.texImage2D(Ze+dt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Be);return Le}const Q={};Q[n.TEXTURE_2D]=q(n.TEXTURE_2D,n.TEXTURE_2D,1),Q[n.TEXTURE_CUBE_MAP]=q(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Q[n.TEXTURE_2D_ARRAY]=q(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Q[n.TEXTURE_3D]=q(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),te(n.DEPTH_TEST),a.setFunc(yl),yt(!1),tt(Jw),te(n.CULL_FACE),ie(Ri);function te(le){h[le]!==!0&&(n.enable(le),h[le]=!0)}function X(le){h[le]!==!1&&(n.disable(le),h[le]=!1)}function ce(le,Ze){return p[le]!==Ze?(n.bindFramebuffer(le,Ze),p[le]=Ze,le===n.DRAW_FRAMEBUFFER&&(p[n.FRAMEBUFFER]=Ze),le===n.FRAMEBUFFER&&(p[n.DRAW_FRAMEBUFFER]=Ze),!0):!1}function me(le,Ze){let Ie=g,rt=!1;if(le){Ie=m.get(Ze),Ie===void 0&&(Ie=[],m.set(Ze,Ie));const Be=le.textures;if(Ie.length!==Be.length||Ie[0]!==n.COLOR_ATTACHMENT0){for(let Le=0,dt=Be.length;Le<dt;Le++)Ie[Le]=n.COLOR_ATTACHMENT0+Le;Ie.length=Be.length,rt=!0}}else Ie[0]!==n.BACK&&(Ie[0]=n.BACK,rt=!0);rt&&n.drawBuffers(Ie)}function Re(le){return y!==le?(n.useProgram(le),y=le,!0):!1}const He={[Kr]:n.FUNC_ADD,[b1]:n.FUNC_SUBTRACT,[w1]:n.FUNC_REVERSE_SUBTRACT};He[E3]=n.MIN,He[M3]=n.MAX;const Qe={[Wa]:n.ZERO,[S1]:n.ONE,[T1]:n.SRC_COLOR,[lp]:n.SRC_ALPHA,[R1]:n.SRC_ALPHA_SATURATE,[C1]:n.DST_COLOR,[E1]:n.DST_ALPHA,[N1]:n.ONE_MINUS_SRC_COLOR,[cp]:n.ONE_MINUS_SRC_ALPHA,[A1]:n.ONE_MINUS_DST_COLOR,[M1]:n.ONE_MINUS_DST_ALPHA,[_$]:n.CONSTANT_COLOR,[b$]:n.ONE_MINUS_CONSTANT_COLOR,[w$]:n.CONSTANT_ALPHA,[S$]:n.ONE_MINUS_CONSTANT_ALPHA};function ie(le,Ze,Ie,rt,Be,Le,dt,Dt,pn,nn){if(le===Ri){b===!0&&(X(n.BLEND),b=!1);return}if(b===!1&&(te(n.BLEND),b=!0),le!==ad){if(le!==_||nn!==k){if((x!==Kr||S!==Kr)&&(n.blendEquation(n.FUNC_ADD),x=Kr,S=Kr),nn)switch(le){case Yi:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case yd:n.blendFunc(n.ONE,n.ONE);break;case vd:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case _d:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}else switch(le){case Yi:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case yd:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case vd:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case _d:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}N=null,T=null,M=null,C=null,R.set(0,0,0),F=0,_=le,k=nn}return}Be=Be||Ze,Le=Le||Ie,dt=dt||rt,(Ze!==x||Be!==S)&&(n.blendEquationSeparate(He[Ze],He[Be]),x=Ze,S=Be),(Ie!==N||rt!==T||Le!==M||dt!==C)&&(n.blendFuncSeparate(Qe[Ie],Qe[rt],Qe[Le],Qe[dt]),N=Ie,T=rt,M=Le,C=dt),(Dt.equals(R)===!1||pn!==F)&&(n.blendColor(Dt.r,Dt.g,Dt.b,pn),R.copy(Dt),F=pn),_=le,k=!1}function Et(le,Ze){le.side===Yr?X(n.CULL_FACE):te(n.CULL_FACE);let Ie=le.side===bn;Ze&&(Ie=!Ie),yt(Ie),le.blending===Yi&&le.transparent===!1?ie(Ri):ie(le.blending,le.blendEquation,le.blendSrc,le.blendDst,le.blendEquationAlpha,le.blendSrcAlpha,le.blendDstAlpha,le.blendColor,le.blendAlpha,le.premultipliedAlpha),a.setFunc(le.depthFunc),a.setTest(le.depthTest),a.setMask(le.depthWrite),s.setMask(le.colorWrite);const rt=le.stencilWrite;o.setTest(rt),rt&&(o.setMask(le.stencilWriteMask),o.setFunc(le.stencilFunc,le.stencilRef,le.stencilFuncMask),o.setOp(le.stencilFail,le.stencilZFail,le.stencilZPass)),_t(le.polygonOffset,le.polygonOffsetFactor,le.polygonOffsetUnits),le.alphaToCoverage===!0?te(n.SAMPLE_ALPHA_TO_COVERAGE):X(n.SAMPLE_ALPHA_TO_COVERAGE)}function yt(le){D!==le&&(le?n.frontFace(n.CW):n.frontFace(n.CCW),D=le)}function tt(le){le!==T3?(te(n.CULL_FACE),le!==P&&(le===Jw?n.cullFace(n.BACK):le===N3?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):X(n.CULL_FACE),P=le}function Ne(le){le!==G&&(O&&n.lineWidth(le),G=le)}function _t(le,Ze,Ie){le?(te(n.POLYGON_OFFSET_FILL),($!==Ze||U!==Ie)&&(n.polygonOffset(Ze,Ie),$=Ze,U=Ie)):X(n.POLYGON_OFFSET_FILL)}function it(le){le?te(n.SCISSOR_TEST):X(n.SCISSOR_TEST)}function wt(le){le===void 0&&(le=n.TEXTURE0+K-1),B!==le&&(n.activeTexture(le),B=le)}function fn(le,Ze,Ie){Ie===void 0&&(B===null?Ie=n.TEXTURE0+K-1:Ie=B);let rt=V[Ie];rt===void 0&&(rt={type:void 0,texture:void 0},V[Ie]=rt),(rt.type!==le||rt.texture!==Ze)&&(B!==Ie&&(n.activeTexture(Ie),B=Ie),n.bindTexture(le,Ze||Q[le]),rt.type=le,rt.texture=Ze)}function ne(){const le=V[B];le!==void 0&&le.type!==void 0&&(n.bindTexture(le.type,null),le.type=void 0,le.texture=void 0)}function W(){try{n.compressedTexImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function ye(){try{n.compressedTexImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ce(){try{n.texSubImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Pe(){try{n.texSubImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Te(){try{n.compressedTexSubImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function ut(){try{n.compressedTexSubImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function qe(){try{n.texStorage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ke(){try{n.texStorage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function lt(){try{n.texImage2D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function De(){try{n.texImage3D(...arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function et(le){se.equals(le)===!1&&(n.scissor(le.x,le.y,le.z,le.w),se.copy(le))}function St(le){J.equals(le)===!1&&(n.viewport(le.x,le.y,le.z,le.w),J.copy(le))}function pt(le,Ze){let Ie=u.get(Ze);Ie===void 0&&(Ie=new WeakMap,u.set(Ze,Ie));let rt=Ie.get(le);rt===void 0&&(rt=n.getUniformBlockIndex(Ze,le.name),Ie.set(le,rt))}function We(le,Ze){const rt=u.get(Ze).get(le);l.get(Ze)!==rt&&(n.uniformBlockBinding(Ze,rt,le.__bindingPointIndex),l.set(Ze,rt))}function Mt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),a.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},B=null,V={},p={},m=new WeakMap,g=[],y=null,b=!1,_=null,x=null,N=null,T=null,S=null,M=null,C=null,R=new vt(0,0,0),F=0,k=!1,D=null,P=null,G=null,$=null,U=null,se.set(0,0,n.canvas.width,n.canvas.height),J.set(0,0,n.canvas.width,n.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:te,disable:X,bindFramebuffer:ce,drawBuffers:me,useProgram:Re,setBlending:ie,setMaterial:Et,setFlipSided:yt,setCullFace:tt,setLineWidth:Ne,setPolygonOffset:_t,setScissorTest:it,activeTexture:wt,bindTexture:fn,unbindTexture:ne,compressedTexImage2D:W,compressedTexImage3D:ye,texImage2D:lt,texImage3D:De,updateUBOMapping:pt,uniformBlockBinding:We,texStorage2D:qe,texStorage3D:Ke,texSubImage2D:Ce,texSubImage3D:Pe,compressedTexSubImage2D:Te,compressedTexSubImage3D:ut,scissor:et,viewport:St,reset:Mt}}function XY(n,e,t,r,i,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new je,h=new WeakMap;let p;const m=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(ne,W){return g?new OffscreenCanvas(ne,W):Np("canvas")}function b(ne,W,ye){let Ce=1;const Pe=fn(ne);if((Pe.width>ye||Pe.height>ye)&&(Ce=ye/Math.max(Pe.width,Pe.height)),Ce<1)if(typeof HTMLImageElement<"u"&&ne instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ne instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ne instanceof ImageBitmap||typeof VideoFrame<"u"&&ne instanceof VideoFrame){const Te=Math.floor(Ce*Pe.width),ut=Math.floor(Ce*Pe.height);p===void 0&&(p=y(Te,ut));const qe=W?y(Te,ut):p;return qe.width=Te,qe.height=ut,qe.getContext("2d").drawImage(ne,0,0,Te,ut),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+Te+"x"+ut+")."),qe}else return"data"in ne&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),ne;return ne}function _(ne){return ne.generateMipmaps}function x(ne){n.generateMipmap(ne)}function N(ne){return ne.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:ne.isWebGL3DRenderTarget?n.TEXTURE_3D:ne.isWebGLArrayRenderTarget||ne.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function T(ne,W,ye,Ce,Pe=!1){if(ne!==null){if(n[ne]!==void 0)return n[ne];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ne+"'")}let Te=W;if(W===n.RED&&(ye===n.FLOAT&&(Te=n.R32F),ye===n.HALF_FLOAT&&(Te=n.R16F),ye===n.UNSIGNED_BYTE&&(Te=n.R8)),W===n.RED_INTEGER&&(ye===n.UNSIGNED_BYTE&&(Te=n.R8UI),ye===n.UNSIGNED_SHORT&&(Te=n.R16UI),ye===n.UNSIGNED_INT&&(Te=n.R32UI),ye===n.BYTE&&(Te=n.R8I),ye===n.SHORT&&(Te=n.R16I),ye===n.INT&&(Te=n.R32I)),W===n.RG&&(ye===n.FLOAT&&(Te=n.RG32F),ye===n.HALF_FLOAT&&(Te=n.RG16F),ye===n.UNSIGNED_BYTE&&(Te=n.RG8)),W===n.RG_INTEGER&&(ye===n.UNSIGNED_BYTE&&(Te=n.RG8UI),ye===n.UNSIGNED_SHORT&&(Te=n.RG16UI),ye===n.UNSIGNED_INT&&(Te=n.RG32UI),ye===n.BYTE&&(Te=n.RG8I),ye===n.SHORT&&(Te=n.RG16I),ye===n.INT&&(Te=n.RG32I)),W===n.RGB_INTEGER&&(ye===n.UNSIGNED_BYTE&&(Te=n.RGB8UI),ye===n.UNSIGNED_SHORT&&(Te=n.RGB16UI),ye===n.UNSIGNED_INT&&(Te=n.RGB32UI),ye===n.BYTE&&(Te=n.RGB8I),ye===n.SHORT&&(Te=n.RGB16I),ye===n.INT&&(Te=n.RGB32I)),W===n.RGBA_INTEGER&&(ye===n.UNSIGNED_BYTE&&(Te=n.RGBA8UI),ye===n.UNSIGNED_SHORT&&(Te=n.RGBA16UI),ye===n.UNSIGNED_INT&&(Te=n.RGBA32UI),ye===n.BYTE&&(Te=n.RGBA8I),ye===n.SHORT&&(Te=n.RGBA16I),ye===n.INT&&(Te=n.RGBA32I)),W===n.RGB&&ye===n.UNSIGNED_INT_5_9_9_9_REV&&(Te=n.RGB9_E5),W===n.RGBA){const ut=Pe?Ud:Ot.getTransfer(Ce);ye===n.FLOAT&&(Te=n.RGBA32F),ye===n.HALF_FLOAT&&(Te=n.RGBA16F),ye===n.UNSIGNED_BYTE&&(Te=ut===st?n.SRGB8_ALPHA8:n.RGBA8),ye===n.UNSIGNED_SHORT_4_4_4_4&&(Te=n.RGBA4),ye===n.UNSIGNED_SHORT_5_5_5_1&&(Te=n.RGB5_A1)}return(Te===n.R16F||Te===n.R32F||Te===n.RG16F||Te===n.RG32F||Te===n.RGBA16F||Te===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Te}function S(ne,W){let ye;return ne?W===null||W===En||W===Ki?ye=n.DEPTH24_STENCIL8:W===Zn?ye=n.DEPTH32F_STENCIL8:W===zs&&(ye=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):W===null||W===En||W===Ki?ye=n.DEPTH_COMPONENT24:W===Zn?ye=n.DEPTH_COMPONENT32F:W===zs&&(ye=n.DEPTH_COMPONENT16),ye}function M(ne,W){return _(ne)===!0||ne.isFramebufferTexture&&ne.minFilter!==An&&ne.minFilter!==pr?Math.log2(Math.max(W.width,W.height))+1:ne.mipmaps!==void 0&&ne.mipmaps.length>0?ne.mipmaps.length:ne.isCompressedTexture&&Array.isArray(ne.image)?W.mipmaps.length:1}function C(ne){const W=ne.target;W.removeEventListener("dispose",C),F(W),W.isVideoTexture&&h.delete(W)}function R(ne){const W=ne.target;W.removeEventListener("dispose",R),D(W)}function F(ne){const W=r.get(ne);if(W.__webglInit===void 0)return;const ye=ne.source,Ce=m.get(ye);if(Ce){const Pe=Ce[W.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&k(ne),Object.keys(Ce).length===0&&m.delete(ye)}r.remove(ne)}function k(ne){const W=r.get(ne);n.deleteTexture(W.__webglTexture);const ye=ne.source,Ce=m.get(ye);delete Ce[W.__cacheKey],a.memory.textures--}function D(ne){const W=r.get(ne);if(ne.depthTexture&&(ne.depthTexture.dispose(),r.remove(ne.depthTexture)),ne.isWebGLCubeRenderTarget)for(let Ce=0;Ce<6;Ce++){if(Array.isArray(W.__webglFramebuffer[Ce]))for(let Pe=0;Pe<W.__webglFramebuffer[Ce].length;Pe++)n.deleteFramebuffer(W.__webglFramebuffer[Ce][Pe]);else n.deleteFramebuffer(W.__webglFramebuffer[Ce]);W.__webglDepthbuffer&&n.deleteRenderbuffer(W.__webglDepthbuffer[Ce])}else{if(Array.isArray(W.__webglFramebuffer))for(let Ce=0;Ce<W.__webglFramebuffer.length;Ce++)n.deleteFramebuffer(W.__webglFramebuffer[Ce]);else n.deleteFramebuffer(W.__webglFramebuffer);if(W.__webglDepthbuffer&&n.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&n.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer)for(let Ce=0;Ce<W.__webglColorRenderbuffer.length;Ce++)W.__webglColorRenderbuffer[Ce]&&n.deleteRenderbuffer(W.__webglColorRenderbuffer[Ce]);W.__webglDepthRenderbuffer&&n.deleteRenderbuffer(W.__webglDepthRenderbuffer)}const ye=ne.textures;for(let Ce=0,Pe=ye.length;Ce<Pe;Ce++){const Te=r.get(ye[Ce]);Te.__webglTexture&&(n.deleteTexture(Te.__webglTexture),a.memory.textures--),r.remove(ye[Ce])}r.remove(ne)}let P=0;function G(){P=0}function $(){const ne=P;return ne>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ne+" texture units while this GPU supports only "+i.maxTextures),P+=1,ne}function U(ne){const W=[];return W.push(ne.wrapS),W.push(ne.wrapT),W.push(ne.wrapR||0),W.push(ne.magFilter),W.push(ne.minFilter),W.push(ne.anisotropy),W.push(ne.internalFormat),W.push(ne.format),W.push(ne.type),W.push(ne.generateMipmaps),W.push(ne.premultiplyAlpha),W.push(ne.flipY),W.push(ne.unpackAlignment),W.push(ne.colorSpace),W.join()}function K(ne,W){const ye=r.get(ne);if(ne.isVideoTexture&&it(ne),ne.isRenderTargetTexture===!1&&ne.version>0&&ye.__version!==ne.version){const Ce=ne.image;if(Ce===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ce.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(ye,ne,W);return}}t.bindTexture(n.TEXTURE_2D,ye.__webglTexture,n.TEXTURE0+W)}function O(ne,W){const ye=r.get(ne);if(ne.version>0&&ye.__version!==ne.version){Q(ye,ne,W);return}t.bindTexture(n.TEXTURE_2D_ARRAY,ye.__webglTexture,n.TEXTURE0+W)}function j(ne,W){const ye=r.get(ne);if(ne.version>0&&ye.__version!==ne.version){Q(ye,ne,W);return}t.bindTexture(n.TEXTURE_3D,ye.__webglTexture,n.TEXTURE0+W)}function L(ne,W){const ye=r.get(ne);if(ne.version>0&&ye.__version!==ne.version){te(ye,ne,W);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ye.__webglTexture,n.TEXTURE0+W)}const B={[Nc]:n.REPEAT,[oa]:n.CLAMP_TO_EDGE,[Ec]:n.MIRRORED_REPEAT},V={[An]:n.NEAREST,[k1]:n.NEAREST_MIPMAP_NEAREST,[to]:n.NEAREST_MIPMAP_LINEAR,[pr]:n.LINEAR,[od]:n.LINEAR_MIPMAP_NEAREST,[Ei]:n.LINEAR_MIPMAP_LINEAR},z={[I1]:n.NEVER,[B1]:n.ALWAYS,[qx]:n.LESS,[Xx]:n.LEQUAL,[j1]:n.EQUAL,[U1]:n.GEQUAL,[F1]:n.GREATER,[O1]:n.NOTEQUAL};function Y(ne,W){if(W.type===Zn&&e.has("OES_texture_float_linear")===!1&&(W.magFilter===pr||W.magFilter===od||W.magFilter===to||W.magFilter===Ei||W.minFilter===pr||W.minFilter===od||W.minFilter===to||W.minFilter===Ei)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(ne,n.TEXTURE_WRAP_S,B[W.wrapS]),n.texParameteri(ne,n.TEXTURE_WRAP_T,B[W.wrapT]),(ne===n.TEXTURE_3D||ne===n.TEXTURE_2D_ARRAY)&&n.texParameteri(ne,n.TEXTURE_WRAP_R,B[W.wrapR]),n.texParameteri(ne,n.TEXTURE_MAG_FILTER,V[W.magFilter]),n.texParameteri(ne,n.TEXTURE_MIN_FILTER,V[W.minFilter]),W.compareFunction&&(n.texParameteri(ne,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(ne,n.TEXTURE_COMPARE_FUNC,z[W.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(W.magFilter===An||W.minFilter!==to&&W.minFilter!==Ei||W.type===Zn&&e.has("OES_texture_float_linear")===!1)return;if(W.anisotropy>1||r.get(W).__currentAnisotropy){const ye=e.get("EXT_texture_filter_anisotropic");n.texParameterf(ne,ye.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(W.anisotropy,i.getMaxAnisotropy())),r.get(W).__currentAnisotropy=W.anisotropy}}}function se(ne,W){let ye=!1;ne.__webglInit===void 0&&(ne.__webglInit=!0,W.addEventListener("dispose",C));const Ce=W.source;let Pe=m.get(Ce);Pe===void 0&&(Pe={},m.set(Ce,Pe));const Te=U(W);if(Te!==ne.__cacheKey){Pe[Te]===void 0&&(Pe[Te]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,ye=!0),Pe[Te].usedTimes++;const ut=Pe[ne.__cacheKey];ut!==void 0&&(Pe[ne.__cacheKey].usedTimes--,ut.usedTimes===0&&k(W)),ne.__cacheKey=Te,ne.__webglTexture=Pe[Te].texture}return ye}function J(ne,W,ye){return Math.floor(Math.floor(ne/ye)/W)}function q(ne,W,ye,Ce){const Te=ne.updateRanges;if(Te.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,W.width,W.height,ye,Ce,W.data);else{Te.sort((De,et)=>De.start-et.start);let ut=0;for(let De=1;De<Te.length;De++){const et=Te[ut],St=Te[De],pt=et.start+et.count,We=J(St.start,W.width,4),Mt=J(et.start,W.width,4);St.start<=pt+1&&We===Mt&&J(St.start+St.count-1,W.width,4)===We?et.count=Math.max(et.count,St.start+St.count-et.start):(++ut,Te[ut]=St)}Te.length=ut+1;const qe=n.getParameter(n.UNPACK_ROW_LENGTH),Ke=n.getParameter(n.UNPACK_SKIP_PIXELS),lt=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,W.width);for(let De=0,et=Te.length;De<et;De++){const St=Te[De],pt=Math.floor(St.start/4),We=Math.ceil(St.count/4),Mt=pt%W.width,le=Math.floor(pt/W.width),Ze=We,Ie=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,Mt),n.pixelStorei(n.UNPACK_SKIP_ROWS,le),t.texSubImage2D(n.TEXTURE_2D,0,Mt,le,Ze,Ie,ye,Ce,W.data)}ne.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,qe),n.pixelStorei(n.UNPACK_SKIP_PIXELS,Ke),n.pixelStorei(n.UNPACK_SKIP_ROWS,lt)}}function Q(ne,W,ye){let Ce=n.TEXTURE_2D;(W.isDataArrayTexture||W.isCompressedArrayTexture)&&(Ce=n.TEXTURE_2D_ARRAY),W.isData3DTexture&&(Ce=n.TEXTURE_3D);const Pe=se(ne,W),Te=W.source;t.bindTexture(Ce,ne.__webglTexture,n.TEXTURE0+ye);const ut=r.get(Te);if(Te.version!==ut.__version||Pe===!0){t.activeTexture(n.TEXTURE0+ye);const qe=Ot.getPrimaries(Ot.workingColorSpace),Ke=W.colorSpace===ui?null:Ot.getPrimaries(W.colorSpace),lt=W.colorSpace===ui||qe===Ke?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,W.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,W.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,lt);let De=b(W.image,!1,i.maxTextureSize);De=wt(W,De);const et=s.convert(W.format,W.colorSpace),St=s.convert(W.type);let pt=T(W.internalFormat,et,St,W.colorSpace,W.isVideoTexture);Y(Ce,W);let We;const Mt=W.mipmaps,le=W.isVideoTexture!==!0,Ze=ut.__version===void 0||Pe===!0,Ie=Te.dataReady,rt=M(W,De);if(W.isDepthTexture)pt=S(W.format===Qi,W.type),Ze&&(le?t.texStorage2D(n.TEXTURE_2D,1,pt,De.width,De.height):t.texImage2D(n.TEXTURE_2D,0,pt,De.width,De.height,0,et,St,null));else if(W.isDataTexture)if(Mt.length>0){le&&Ze&&t.texStorage2D(n.TEXTURE_2D,rt,pt,Mt[0].width,Mt[0].height);for(let Be=0,Le=Mt.length;Be<Le;Be++)We=Mt[Be],le?Ie&&t.texSubImage2D(n.TEXTURE_2D,Be,0,0,We.width,We.height,et,St,We.data):t.texImage2D(n.TEXTURE_2D,Be,pt,We.width,We.height,0,et,St,We.data);W.generateMipmaps=!1}else le?(Ze&&t.texStorage2D(n.TEXTURE_2D,rt,pt,De.width,De.height),Ie&&q(W,De,et,St)):t.texImage2D(n.TEXTURE_2D,0,pt,De.width,De.height,0,et,St,De.data);else if(W.isCompressedTexture)if(W.isCompressedArrayTexture){le&&Ze&&t.texStorage3D(n.TEXTURE_2D_ARRAY,rt,pt,Mt[0].width,Mt[0].height,De.depth);for(let Be=0,Le=Mt.length;Be<Le;Be++)if(We=Mt[Be],W.format!==qn)if(et!==null)if(le){if(Ie)if(W.layerUpdates.size>0){const dt=mA(We.width,We.height,W.format,W.type);for(const Dt of W.layerUpdates){const pn=We.data.subarray(Dt*dt/We.data.BYTES_PER_ELEMENT,(Dt+1)*dt/We.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Be,0,0,Dt,We.width,We.height,1,et,pn)}W.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Be,0,0,0,We.width,We.height,De.depth,et,We.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Be,pt,We.width,We.height,De.depth,0,We.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else le?Ie&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Be,0,0,0,We.width,We.height,De.depth,et,St,We.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Be,pt,We.width,We.height,De.depth,0,et,St,We.data)}else{le&&Ze&&t.texStorage2D(n.TEXTURE_2D,rt,pt,Mt[0].width,Mt[0].height);for(let Be=0,Le=Mt.length;Be<Le;Be++)We=Mt[Be],W.format!==qn?et!==null?le?Ie&&t.compressedTexSubImage2D(n.TEXTURE_2D,Be,0,0,We.width,We.height,et,We.data):t.compressedTexImage2D(n.TEXTURE_2D,Be,pt,We.width,We.height,0,We.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):le?Ie&&t.texSubImage2D(n.TEXTURE_2D,Be,0,0,We.width,We.height,et,St,We.data):t.texImage2D(n.TEXTURE_2D,Be,pt,We.width,We.height,0,et,St,We.data)}else if(W.isDataArrayTexture)if(le){if(Ze&&t.texStorage3D(n.TEXTURE_2D_ARRAY,rt,pt,De.width,De.height,De.depth),Ie)if(W.layerUpdates.size>0){const Be=mA(De.width,De.height,W.format,W.type);for(const Le of W.layerUpdates){const dt=De.data.subarray(Le*Be/De.data.BYTES_PER_ELEMENT,(Le+1)*Be/De.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Le,De.width,De.height,1,et,St,dt)}W.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,De.width,De.height,De.depth,et,St,De.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,pt,De.width,De.height,De.depth,0,et,St,De.data);else if(W.isData3DTexture)le?(Ze&&t.texStorage3D(n.TEXTURE_3D,rt,pt,De.width,De.height,De.depth),Ie&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,De.width,De.height,De.depth,et,St,De.data)):t.texImage3D(n.TEXTURE_3D,0,pt,De.width,De.height,De.depth,0,et,St,De.data);else if(W.isFramebufferTexture){if(Ze)if(le)t.texStorage2D(n.TEXTURE_2D,rt,pt,De.width,De.height);else{let Be=De.width,Le=De.height;for(let dt=0;dt<rt;dt++)t.texImage2D(n.TEXTURE_2D,dt,pt,Be,Le,0,et,St,null),Be>>=1,Le>>=1}}else if(Mt.length>0){if(le&&Ze){const Be=fn(Mt[0]);t.texStorage2D(n.TEXTURE_2D,rt,pt,Be.width,Be.height)}for(let Be=0,Le=Mt.length;Be<Le;Be++)We=Mt[Be],le?Ie&&t.texSubImage2D(n.TEXTURE_2D,Be,0,0,et,St,We):t.texImage2D(n.TEXTURE_2D,Be,pt,et,St,We);W.generateMipmaps=!1}else if(le){if(Ze){const Be=fn(De);t.texStorage2D(n.TEXTURE_2D,rt,pt,Be.width,Be.height)}Ie&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,et,St,De)}else t.texImage2D(n.TEXTURE_2D,0,pt,et,St,De);_(W)&&x(Ce),ut.__version=Te.version,W.onUpdate&&W.onUpdate(W)}ne.__version=W.version}function te(ne,W,ye){if(W.image.length!==6)return;const Ce=se(ne,W),Pe=W.source;t.bindTexture(n.TEXTURE_CUBE_MAP,ne.__webglTexture,n.TEXTURE0+ye);const Te=r.get(Pe);if(Pe.version!==Te.__version||Ce===!0){t.activeTexture(n.TEXTURE0+ye);const ut=Ot.getPrimaries(Ot.workingColorSpace),qe=W.colorSpace===ui?null:Ot.getPrimaries(W.colorSpace),Ke=W.colorSpace===ui||ut===qe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,W.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,W.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ke);const lt=W.isCompressedTexture||W.image[0].isCompressedTexture,De=W.image[0]&&W.image[0].isDataTexture,et=[];for(let Le=0;Le<6;Le++)!lt&&!De?et[Le]=b(W.image[Le],!0,i.maxCubemapSize):et[Le]=De?W.image[Le].image:W.image[Le],et[Le]=wt(W,et[Le]);const St=et[0],pt=s.convert(W.format,W.colorSpace),We=s.convert(W.type),Mt=T(W.internalFormat,pt,We,W.colorSpace),le=W.isVideoTexture!==!0,Ze=Te.__version===void 0||Ce===!0,Ie=Pe.dataReady;let rt=M(W,St);Y(n.TEXTURE_CUBE_MAP,W);let Be;if(lt){le&&Ze&&t.texStorage2D(n.TEXTURE_CUBE_MAP,rt,Mt,St.width,St.height);for(let Le=0;Le<6;Le++){Be=et[Le].mipmaps;for(let dt=0;dt<Be.length;dt++){const Dt=Be[dt];W.format!==qn?pt!==null?le?Ie&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt,0,0,Dt.width,Dt.height,pt,Dt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt,Mt,Dt.width,Dt.height,0,Dt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):le?Ie&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt,0,0,Dt.width,Dt.height,pt,We,Dt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt,Mt,Dt.width,Dt.height,0,pt,We,Dt.data)}}}else{if(Be=W.mipmaps,le&&Ze){Be.length>0&&rt++;const Le=fn(et[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,rt,Mt,Le.width,Le.height)}for(let Le=0;Le<6;Le++)if(De){le?Ie&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,0,0,et[Le].width,et[Le].height,pt,We,et[Le].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,Mt,et[Le].width,et[Le].height,0,pt,We,et[Le].data);for(let dt=0;dt<Be.length;dt++){const pn=Be[dt].image[Le].image;le?Ie&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt+1,0,0,pn.width,pn.height,pt,We,pn.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt+1,Mt,pn.width,pn.height,0,pt,We,pn.data)}}else{le?Ie&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,0,0,pt,We,et[Le]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,Mt,pt,We,et[Le]);for(let dt=0;dt<Be.length;dt++){const Dt=Be[dt];le?Ie&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt+1,0,0,pt,We,Dt.image[Le]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,dt+1,Mt,pt,We,Dt.image[Le])}}}_(W)&&x(n.TEXTURE_CUBE_MAP),Te.__version=Pe.version,W.onUpdate&&W.onUpdate(W)}ne.__version=W.version}function X(ne,W,ye,Ce,Pe,Te){const ut=s.convert(ye.format,ye.colorSpace),qe=s.convert(ye.type),Ke=T(ye.internalFormat,ut,qe,ye.colorSpace),lt=r.get(W),De=r.get(ye);if(De.__renderTarget=W,!lt.__hasExternalTextures){const et=Math.max(1,W.width>>Te),St=Math.max(1,W.height>>Te);Pe===n.TEXTURE_3D||Pe===n.TEXTURE_2D_ARRAY?t.texImage3D(Pe,Te,Ke,et,St,W.depth,0,ut,qe,null):t.texImage2D(Pe,Te,Ke,et,St,0,ut,qe,null)}t.bindFramebuffer(n.FRAMEBUFFER,ne),_t(W)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ce,Pe,De.__webglTexture,0,Ne(W)):(Pe===n.TEXTURE_2D||Pe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Ce,Pe,De.__webglTexture,Te),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ce(ne,W,ye){if(n.bindRenderbuffer(n.RENDERBUFFER,ne),W.depthBuffer){const Ce=W.depthTexture,Pe=Ce&&Ce.isDepthTexture?Ce.type:null,Te=S(W.stencilBuffer,Pe),ut=W.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,qe=Ne(W);_t(W)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,qe,Te,W.width,W.height):ye?n.renderbufferStorageMultisample(n.RENDERBUFFER,qe,Te,W.width,W.height):n.renderbufferStorage(n.RENDERBUFFER,Te,W.width,W.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,ut,n.RENDERBUFFER,ne)}else{const Ce=W.textures;for(let Pe=0;Pe<Ce.length;Pe++){const Te=Ce[Pe],ut=s.convert(Te.format,Te.colorSpace),qe=s.convert(Te.type),Ke=T(Te.internalFormat,ut,qe,Te.colorSpace),lt=Ne(W);ye&&_t(W)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,lt,Ke,W.width,W.height):_t(W)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,lt,Ke,W.width,W.height):n.renderbufferStorage(n.RENDERBUFFER,Ke,W.width,W.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function me(ne,W){if(W&&W.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,ne),!(W.depthTexture&&W.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ce=r.get(W.depthTexture);Ce.__renderTarget=W,(!Ce.__webglTexture||W.depthTexture.image.width!==W.width||W.depthTexture.image.height!==W.height)&&(W.depthTexture.image.width=W.width,W.depthTexture.image.height=W.height,W.depthTexture.needsUpdate=!0),K(W.depthTexture,0);const Pe=Ce.__webglTexture,Te=Ne(W);if(W.depthTexture.format===Zi)_t(W)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Pe,0,Te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Pe,0);else if(W.depthTexture.format===Qi)_t(W)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Pe,0,Te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Pe,0);else throw new Error("Unknown depthTexture format")}function Re(ne){const W=r.get(ne),ye=ne.isWebGLCubeRenderTarget===!0;if(W.__boundDepthTexture!==ne.depthTexture){const Ce=ne.depthTexture;if(W.__depthDisposeCallback&&W.__depthDisposeCallback(),Ce){const Pe=()=>{delete W.__boundDepthTexture,delete W.__depthDisposeCallback,Ce.removeEventListener("dispose",Pe)};Ce.addEventListener("dispose",Pe),W.__depthDisposeCallback=Pe}W.__boundDepthTexture=Ce}if(ne.depthTexture&&!W.__autoAllocateDepthBuffer){if(ye)throw new Error("target.depthTexture not supported in Cube render targets");const Ce=ne.texture.mipmaps;Ce&&Ce.length>0?me(W.__webglFramebuffer[0],ne):me(W.__webglFramebuffer,ne)}else if(ye){W.__webglDepthbuffer=[];for(let Ce=0;Ce<6;Ce++)if(t.bindFramebuffer(n.FRAMEBUFFER,W.__webglFramebuffer[Ce]),W.__webglDepthbuffer[Ce]===void 0)W.__webglDepthbuffer[Ce]=n.createRenderbuffer(),ce(W.__webglDepthbuffer[Ce],ne,!1);else{const Pe=ne.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Te=W.__webglDepthbuffer[Ce];n.bindRenderbuffer(n.RENDERBUFFER,Te),n.framebufferRenderbuffer(n.FRAMEBUFFER,Pe,n.RENDERBUFFER,Te)}}else{const Ce=ne.texture.mipmaps;if(Ce&&Ce.length>0?t.bindFramebuffer(n.FRAMEBUFFER,W.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,W.__webglFramebuffer),W.__webglDepthbuffer===void 0)W.__webglDepthbuffer=n.createRenderbuffer(),ce(W.__webglDepthbuffer,ne,!1);else{const Pe=ne.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Te=W.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,Te),n.framebufferRenderbuffer(n.FRAMEBUFFER,Pe,n.RENDERBUFFER,Te)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function He(ne,W,ye){const Ce=r.get(ne);W!==void 0&&X(Ce.__webglFramebuffer,ne,ne.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ye!==void 0&&Re(ne)}function Qe(ne){const W=ne.texture,ye=r.get(ne),Ce=r.get(W);ne.addEventListener("dispose",R);const Pe=ne.textures,Te=ne.isWebGLCubeRenderTarget===!0,ut=Pe.length>1;if(ut||(Ce.__webglTexture===void 0&&(Ce.__webglTexture=n.createTexture()),Ce.__version=W.version,a.memory.textures++),Te){ye.__webglFramebuffer=[];for(let qe=0;qe<6;qe++)if(W.mipmaps&&W.mipmaps.length>0){ye.__webglFramebuffer[qe]=[];for(let Ke=0;Ke<W.mipmaps.length;Ke++)ye.__webglFramebuffer[qe][Ke]=n.createFramebuffer()}else ye.__webglFramebuffer[qe]=n.createFramebuffer()}else{if(W.mipmaps&&W.mipmaps.length>0){ye.__webglFramebuffer=[];for(let qe=0;qe<W.mipmaps.length;qe++)ye.__webglFramebuffer[qe]=n.createFramebuffer()}else ye.__webglFramebuffer=n.createFramebuffer();if(ut)for(let qe=0,Ke=Pe.length;qe<Ke;qe++){const lt=r.get(Pe[qe]);lt.__webglTexture===void 0&&(lt.__webglTexture=n.createTexture(),a.memory.textures++)}if(ne.samples>0&&_t(ne)===!1){ye.__webglMultisampledFramebuffer=n.createFramebuffer(),ye.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ye.__webglMultisampledFramebuffer);for(let qe=0;qe<Pe.length;qe++){const Ke=Pe[qe];ye.__webglColorRenderbuffer[qe]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ye.__webglColorRenderbuffer[qe]);const lt=s.convert(Ke.format,Ke.colorSpace),De=s.convert(Ke.type),et=T(Ke.internalFormat,lt,De,Ke.colorSpace,ne.isXRRenderTarget===!0),St=Ne(ne);n.renderbufferStorageMultisample(n.RENDERBUFFER,St,et,ne.width,ne.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+qe,n.RENDERBUFFER,ye.__webglColorRenderbuffer[qe])}n.bindRenderbuffer(n.RENDERBUFFER,null),ne.depthBuffer&&(ye.__webglDepthRenderbuffer=n.createRenderbuffer(),ce(ye.__webglDepthRenderbuffer,ne,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Te){t.bindTexture(n.TEXTURE_CUBE_MAP,Ce.__webglTexture),Y(n.TEXTURE_CUBE_MAP,W);for(let qe=0;qe<6;qe++)if(W.mipmaps&&W.mipmaps.length>0)for(let Ke=0;Ke<W.mipmaps.length;Ke++)X(ye.__webglFramebuffer[qe][Ke],ne,W,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+qe,Ke);else X(ye.__webglFramebuffer[qe],ne,W,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+qe,0);_(W)&&x(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ut){for(let qe=0,Ke=Pe.length;qe<Ke;qe++){const lt=Pe[qe],De=r.get(lt);t.bindTexture(n.TEXTURE_2D,De.__webglTexture),Y(n.TEXTURE_2D,lt),X(ye.__webglFramebuffer,ne,lt,n.COLOR_ATTACHMENT0+qe,n.TEXTURE_2D,0),_(lt)&&x(n.TEXTURE_2D)}t.unbindTexture()}else{let qe=n.TEXTURE_2D;if((ne.isWebGL3DRenderTarget||ne.isWebGLArrayRenderTarget)&&(qe=ne.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(qe,Ce.__webglTexture),Y(qe,W),W.mipmaps&&W.mipmaps.length>0)for(let Ke=0;Ke<W.mipmaps.length;Ke++)X(ye.__webglFramebuffer[Ke],ne,W,n.COLOR_ATTACHMENT0,qe,Ke);else X(ye.__webglFramebuffer,ne,W,n.COLOR_ATTACHMENT0,qe,0);_(W)&&x(qe),t.unbindTexture()}ne.depthBuffer&&Re(ne)}function ie(ne){const W=ne.textures;for(let ye=0,Ce=W.length;ye<Ce;ye++){const Pe=W[ye];if(_(Pe)){const Te=N(ne),ut=r.get(Pe).__webglTexture;t.bindTexture(Te,ut),x(Te),t.unbindTexture()}}}const Et=[],yt=[];function tt(ne){if(ne.samples>0){if(_t(ne)===!1){const W=ne.textures,ye=ne.width,Ce=ne.height;let Pe=n.COLOR_BUFFER_BIT;const Te=ne.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ut=r.get(ne),qe=W.length>1;if(qe)for(let lt=0;lt<W.length;lt++)t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+lt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+lt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ut.__webglMultisampledFramebuffer);const Ke=ne.texture.mipmaps;Ke&&Ke.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ut.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ut.__webglFramebuffer);for(let lt=0;lt<W.length;lt++){if(ne.resolveDepthBuffer&&(ne.depthBuffer&&(Pe|=n.DEPTH_BUFFER_BIT),ne.stencilBuffer&&ne.resolveStencilBuffer&&(Pe|=n.STENCIL_BUFFER_BIT)),qe){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ut.__webglColorRenderbuffer[lt]);const De=r.get(W[lt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,De,0)}n.blitFramebuffer(0,0,ye,Ce,0,0,ye,Ce,Pe,n.NEAREST),l===!0&&(Et.length=0,yt.length=0,Et.push(n.COLOR_ATTACHMENT0+lt),ne.depthBuffer&&ne.resolveDepthBuffer===!1&&(Et.push(Te),yt.push(Te),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,yt)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Et))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),qe)for(let lt=0;lt<W.length;lt++){t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+lt,n.RENDERBUFFER,ut.__webglColorRenderbuffer[lt]);const De=r.get(W[lt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ut.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+lt,n.TEXTURE_2D,De,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ut.__webglMultisampledFramebuffer)}else if(ne.depthBuffer&&ne.resolveDepthBuffer===!1&&l){const W=ne.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[W])}}}function Ne(ne){return Math.min(i.maxSamples,ne.samples)}function _t(ne){const W=r.get(ne);return ne.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&W.__useRenderToTexture!==!1}function it(ne){const W=a.render.frame;h.get(ne)!==W&&(h.set(ne,W),ne.update())}function wt(ne,W){const ye=ne.colorSpace,Ce=ne.format,Pe=ne.type;return ne.isCompressedTexture===!0||ne.isVideoTexture===!0||ye!==pa&&ye!==ui&&(Ot.getTransfer(ye)===st?(Ce!==qn||Pe!==Hn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ye)),W}function fn(ne){return typeof HTMLImageElement<"u"&&ne instanceof HTMLImageElement?(u.width=ne.naturalWidth||ne.width,u.height=ne.naturalHeight||ne.height):typeof VideoFrame<"u"&&ne instanceof VideoFrame?(u.width=ne.displayWidth,u.height=ne.displayHeight):(u.width=ne.width,u.height=ne.height),u}this.allocateTextureUnit=$,this.resetTextureUnits=G,this.setTexture2D=K,this.setTexture2DArray=O,this.setTexture3D=j,this.setTextureCube=L,this.rebindTextures=He,this.setupRenderTarget=Qe,this.updateRenderTargetMipmap=ie,this.updateMultisampleRenderTarget=tt,this.setupDepthRenderbuffer=Re,this.setupFrameBufferTexture=X,this.useMultisampledRTT=_t}function YY(n,e){function t(r,i=ui){let s;const a=Ot.getTransfer(i);if(r===Hn)return n.UNSIGNED_BYTE;if(r===Hx)return n.UNSIGNED_SHORT_4_4_4_4;if(r===$x)return n.UNSIGNED_SHORT_5_5_5_1;if(r===Wx)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===xc)return n.BYTE;if(r===yc)return n.SHORT;if(r===zs)return n.UNSIGNED_SHORT;if(r===Er)return n.INT;if(r===En)return n.UNSIGNED_INT;if(r===Zn)return n.FLOAT;if(r===Cr)return n.HALF_FLOAT;if(r===L1)return n.ALPHA;if(r===Xp)return n.RGB;if(r===qn)return n.RGBA;if(r===Zi)return n.DEPTH_COMPONENT;if(r===Qi)return n.DEPTH_STENCIL;if(r===Yp)return n.RED;if(r===th)return n.RED_INTEGER;if(r===no)return n.RG;if(r===nh)return n.RG_INTEGER;if(r===rh)return n.RGBA_INTEGER;if(r===vc||r===dl||r===hl||r===fl)if(a===st)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===vc)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===dl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===hl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===fl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===vc)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===dl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===hl)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===fl)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===xp||r===yp||r===vp||r===_p)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===xp)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===yp)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===vp)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===_p)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===bp||r===Sd||r===Td)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===bp||r===Sd)return a===st?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===Td)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===Nd||r===Ed||r===Md||r===Cd||r===Ad||r===Rd||r===Pd||r===kd||r===Ld||r===Dd||r===Id||r===jd||r===Fd||r===Od)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===Nd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===Ed)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===Md)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===Cd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Ad)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===Rd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===Pd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===kd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===Ld)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===Dd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===Id)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===jd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===Fd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===Od)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===_c||r===eS||r===tS)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===_c)return a===st?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===eS)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===tS)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===D1||r===wp||r===Sp||r===Tp)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===_c)return s.COMPRESSED_RED_RGTC1_EXT;if(r===wp)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===Sp)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===Tp)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Ki?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}const KY=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,ZY=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class QY{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new Jn,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!==r.depthNear||t.depthFar!==r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new va({vertexShader:KY,fragmentShader:ZY,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Xn(new em(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class JY extends _o{constructor(e,t){super();const r=this;let i=null,s=1,a=null,o="local-floor",l=1,u=null,h=null,p=null,m=null,g=null,y=null;const b=new QY,_=t.getContextAttributes();let x=null,N=null;const T=[],S=[],M=new je;let C=null;const R=new Mr;R.viewport=new Lt;const F=new Mr;F.viewport=new Lt;const k=[R,F],D=new Z3;let P=null,G=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(J){let q=T[J];return q===void 0&&(q=new I0,T[J]=q),q.getTargetRaySpace()},this.getControllerGrip=function(J){let q=T[J];return q===void 0&&(q=new I0,T[J]=q),q.getGripSpace()},this.getHand=function(J){let q=T[J];return q===void 0&&(q=new I0,T[J]=q),q.getHandSpace()};function $(J){const q=S.indexOf(J.inputSource);if(q===-1)return;const Q=T[q];Q!==void 0&&(Q.update(J.inputSource,J.frame,u||a),Q.dispatchEvent({type:J.type,data:J.inputSource}))}function U(){i.removeEventListener("select",$),i.removeEventListener("selectstart",$),i.removeEventListener("selectend",$),i.removeEventListener("squeeze",$),i.removeEventListener("squeezestart",$),i.removeEventListener("squeezeend",$),i.removeEventListener("end",U),i.removeEventListener("inputsourceschange",K);for(let J=0;J<T.length;J++){const q=S[J];q!==null&&(S[J]=null,T[J].disconnect(q))}P=null,G=null,b.reset(),e.setRenderTarget(x),g=null,m=null,p=null,i=null,N=null,se.stop(),r.isPresenting=!1,e.setPixelRatio(C),e.setSize(M.width,M.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(J){s=J,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(J){o=J,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(J){u=J},this.getBaseLayer=function(){return m!==null?m:g},this.getBinding=function(){return p},this.getFrame=function(){return y},this.getSession=function(){return i},this.setSession=async function(J){if(i=J,i!==null){if(x=e.getRenderTarget(),i.addEventListener("select",$),i.addEventListener("selectstart",$),i.addEventListener("selectend",$),i.addEventListener("squeeze",$),i.addEventListener("squeezestart",$),i.addEventListener("squeezeend",$),i.addEventListener("end",U),i.addEventListener("inputsourceschange",K),_.xrCompatible!==!0&&await t.makeXRCompatible(),C=e.getPixelRatio(),e.getSize(M),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Q=null,te=null,X=null;_.depth&&(X=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Q=_.stencil?Qi:Zi,te=_.stencil?Ki:En);const ce={colorFormat:t.RGBA8,depthFormat:X,scaleFactor:s};p=new XRWebGLBinding(i,t),m=p.createProjectionLayer(ce),i.updateRenderState({layers:[m]}),e.setPixelRatio(1),e.setSize(m.textureWidth,m.textureHeight,!1),N=new _l(m.textureWidth,m.textureHeight,{format:qn,type:Hn,depthTexture:new xs(m.textureWidth,m.textureHeight,te,void 0,void 0,void 0,void 0,void 0,void 0,Q),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}else{const Q={antialias:_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};g=new XRWebGLLayer(i,t,Q),i.updateRenderState({baseLayer:g}),e.setPixelRatio(1),e.setSize(g.framebufferWidth,g.framebufferHeight,!1),N=new _l(g.framebufferWidth,g.framebufferHeight,{format:qn,type:Hn,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil,resolveDepthBuffer:g.ignoreDepthValues===!1,resolveStencilBuffer:g.ignoreDepthValues===!1})}N.isXRRenderTarget=!0,this.setFoveation(l),u=null,a=await i.requestReferenceSpace(o),se.setContext(i),se.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return b.getDepthTexture()};function K(J){for(let q=0;q<J.removed.length;q++){const Q=J.removed[q],te=S.indexOf(Q);te>=0&&(S[te]=null,T[te].disconnect(Q))}for(let q=0;q<J.added.length;q++){const Q=J.added[q];let te=S.indexOf(Q);if(te===-1){for(let ce=0;ce<T.length;ce++)if(ce>=S.length){S.push(Q),te=ce;break}else if(S[ce]===null){S[ce]=Q,te=ce;break}if(te===-1)break}const X=T[te];X&&X.connect(Q)}}const O=new ee,j=new ee;function L(J,q,Q){O.setFromMatrixPosition(q.matrixWorld),j.setFromMatrixPosition(Q.matrixWorld);const te=O.distanceTo(j),X=q.projectionMatrix.elements,ce=Q.projectionMatrix.elements,me=X[14]/(X[10]-1),Re=X[14]/(X[10]+1),He=(X[9]+1)/X[5],Qe=(X[9]-1)/X[5],ie=(X[8]-1)/X[0],Et=(ce[8]+1)/ce[0],yt=me*ie,tt=me*Et,Ne=te/(-ie+Et),_t=Ne*-ie;if(q.matrixWorld.decompose(J.position,J.quaternion,J.scale),J.translateX(_t),J.translateZ(Ne),J.matrixWorld.compose(J.position,J.quaternion,J.scale),J.matrixWorldInverse.copy(J.matrixWorld).invert(),X[10]===-1)J.projectionMatrix.copy(q.projectionMatrix),J.projectionMatrixInverse.copy(q.projectionMatrixInverse);else{const it=me+Ne,wt=Re+Ne,fn=yt-_t,ne=tt+(te-_t),W=He*Re/wt*it,ye=Qe*Re/wt*it;J.projectionMatrix.makePerspective(fn,ne,W,ye,it,wt),J.projectionMatrixInverse.copy(J.projectionMatrix).invert()}}function B(J,q){q===null?J.matrixWorld.copy(J.matrix):J.matrixWorld.multiplyMatrices(q.matrixWorld,J.matrix),J.matrixWorldInverse.copy(J.matrixWorld).invert()}this.updateCamera=function(J){if(i===null)return;let q=J.near,Q=J.far;b.texture!==null&&(b.depthNear>0&&(q=b.depthNear),b.depthFar>0&&(Q=b.depthFar)),D.near=F.near=R.near=q,D.far=F.far=R.far=Q,(P!==D.near||G!==D.far)&&(i.updateRenderState({depthNear:D.near,depthFar:D.far}),P=D.near,G=D.far),R.layers.mask=J.layers.mask|2,F.layers.mask=J.layers.mask|4,D.layers.mask=R.layers.mask|F.layers.mask;const te=J.parent,X=D.cameras;B(D,te);for(let ce=0;ce<X.length;ce++)B(X[ce],te);X.length===2?L(D,R,F):D.projectionMatrix.copy(R.projectionMatrix),V(J,D,te)};function V(J,q,Q){Q===null?J.matrix.copy(q.matrixWorld):(J.matrix.copy(Q.matrixWorld),J.matrix.invert(),J.matrix.multiply(q.matrixWorld)),J.matrix.decompose(J.position,J.quaternion,J.scale),J.updateMatrixWorld(!0),J.projectionMatrix.copy(q.projectionMatrix),J.projectionMatrixInverse.copy(q.projectionMatrixInverse),J.isPerspectiveCamera&&(J.fov=Mc*2*Math.atan(1/J.projectionMatrix.elements[5]),J.zoom=1)}this.getCamera=function(){return D},this.getFoveation=function(){if(!(m===null&&g===null))return l},this.setFoveation=function(J){l=J,m!==null&&(m.fixedFoveation=J),g!==null&&g.fixedFoveation!==void 0&&(g.fixedFoveation=J)},this.hasDepthSensing=function(){return b.texture!==null},this.getDepthSensingMesh=function(){return b.getMesh(D)};let z=null;function Y(J,q){if(h=q.getViewerPose(u||a),y=q,h!==null){const Q=h.views;g!==null&&(e.setRenderTargetFramebuffer(N,g.framebuffer),e.setRenderTarget(N));let te=!1;Q.length!==D.cameras.length&&(D.cameras.length=0,te=!0);for(let me=0;me<Q.length;me++){const Re=Q[me];let He=null;if(g!==null)He=g.getViewport(Re);else{const ie=p.getViewSubImage(m,Re);He=ie.viewport,me===0&&(e.setRenderTargetTextures(N,ie.colorTexture,ie.depthStencilTexture),e.setRenderTarget(N))}let Qe=k[me];Qe===void 0&&(Qe=new Mr,Qe.layers.enable(me),Qe.viewport=new Lt,k[me]=Qe),Qe.matrix.fromArray(Re.transform.matrix),Qe.matrix.decompose(Qe.position,Qe.quaternion,Qe.scale),Qe.projectionMatrix.fromArray(Re.projectionMatrix),Qe.projectionMatrixInverse.copy(Qe.projectionMatrix).invert(),Qe.viewport.set(He.x,He.y,He.width,He.height),me===0&&(D.matrix.copy(Qe.matrix),D.matrix.decompose(D.position,D.quaternion,D.scale)),te===!0&&D.cameras.push(Qe)}const X=i.enabledFeatures;if(X&&X.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&p){const me=p.getDepthInformation(Q[0]);me&&me.isValid&&me.texture&&b.init(e,me,i.renderState)}}for(let Q=0;Q<T.length;Q++){const te=S[Q],X=T[Q];te!==null&&X!==void 0&&X.update(te,q,u||a)}z&&z(J,q),q.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:q}),y=null}const se=new eD;se.setAnimationLoop(Y),this.setAnimationLoop=function(J){z=J},this.dispose=function(){}}}const Xl=new ki,eK=new Yt;function tK(n,e){function t(_,x){_.matrixAutoUpdate===!0&&_.updateMatrix(),x.value.copy(_.matrix)}function r(_,x){x.color.getRGB(_.fogColor.value,B3(n)),x.isFog?(_.fogNear.value=x.near,_.fogFar.value=x.far):x.isFogExp2&&(_.fogDensity.value=x.density)}function i(_,x,N,T,S){x.isMeshBasicMaterial||x.isMeshLambertMaterial?s(_,x):x.isMeshToonMaterial?(s(_,x),p(_,x)):x.isMeshPhongMaterial?(s(_,x),h(_,x)):x.isMeshStandardMaterial?(s(_,x),m(_,x),x.isMeshPhysicalMaterial&&g(_,x,S)):x.isMeshMatcapMaterial?(s(_,x),y(_,x)):x.isMeshDepthMaterial?s(_,x):x.isMeshDistanceMaterial?(s(_,x),b(_,x)):x.isMeshNormalMaterial?s(_,x):x.isLineBasicMaterial?(a(_,x),x.isLineDashedMaterial&&o(_,x)):x.isPointsMaterial?l(_,x,N,T):x.isSpriteMaterial?u(_,x):x.isShadowMaterial?(_.color.value.copy(x.color),_.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function s(_,x){_.opacity.value=x.opacity,x.color&&_.diffuse.value.copy(x.color),x.emissive&&_.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(_.map.value=x.map,t(x.map,_.mapTransform)),x.alphaMap&&(_.alphaMap.value=x.alphaMap,t(x.alphaMap,_.alphaMapTransform)),x.bumpMap&&(_.bumpMap.value=x.bumpMap,t(x.bumpMap,_.bumpMapTransform),_.bumpScale.value=x.bumpScale,x.side===bn&&(_.bumpScale.value*=-1)),x.normalMap&&(_.normalMap.value=x.normalMap,t(x.normalMap,_.normalMapTransform),_.normalScale.value.copy(x.normalScale),x.side===bn&&_.normalScale.value.negate()),x.displacementMap&&(_.displacementMap.value=x.displacementMap,t(x.displacementMap,_.displacementMapTransform),_.displacementScale.value=x.displacementScale,_.displacementBias.value=x.displacementBias),x.emissiveMap&&(_.emissiveMap.value=x.emissiveMap,t(x.emissiveMap,_.emissiveMapTransform)),x.specularMap&&(_.specularMap.value=x.specularMap,t(x.specularMap,_.specularMapTransform)),x.alphaTest>0&&(_.alphaTest.value=x.alphaTest);const N=e.get(x),T=N.envMap,S=N.envMapRotation;T&&(_.envMap.value=T,Xl.copy(S),Xl.x*=-1,Xl.y*=-1,Xl.z*=-1,T.isCubeTexture&&T.isRenderTargetTexture===!1&&(Xl.y*=-1,Xl.z*=-1),_.envMapRotation.value.setFromMatrix4(eK.makeRotationFromEuler(Xl)),_.flipEnvMap.value=T.isCubeTexture&&T.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=x.reflectivity,_.ior.value=x.ior,_.refractionRatio.value=x.refractionRatio),x.lightMap&&(_.lightMap.value=x.lightMap,_.lightMapIntensity.value=x.lightMapIntensity,t(x.lightMap,_.lightMapTransform)),x.aoMap&&(_.aoMap.value=x.aoMap,_.aoMapIntensity.value=x.aoMapIntensity,t(x.aoMap,_.aoMapTransform))}function a(_,x){_.diffuse.value.copy(x.color),_.opacity.value=x.opacity,x.map&&(_.map.value=x.map,t(x.map,_.mapTransform))}function o(_,x){_.dashSize.value=x.dashSize,_.totalSize.value=x.dashSize+x.gapSize,_.scale.value=x.scale}function l(_,x,N,T){_.diffuse.value.copy(x.color),_.opacity.value=x.opacity,_.size.value=x.size*N,_.scale.value=T*.5,x.map&&(_.map.value=x.map,t(x.map,_.uvTransform)),x.alphaMap&&(_.alphaMap.value=x.alphaMap,t(x.alphaMap,_.alphaMapTransform)),x.alphaTest>0&&(_.alphaTest.value=x.alphaTest)}function u(_,x){_.diffuse.value.copy(x.color),_.opacity.value=x.opacity,_.rotation.value=x.rotation,x.map&&(_.map.value=x.map,t(x.map,_.mapTransform)),x.alphaMap&&(_.alphaMap.value=x.alphaMap,t(x.alphaMap,_.alphaMapTransform)),x.alphaTest>0&&(_.alphaTest.value=x.alphaTest)}function h(_,x){_.specular.value.copy(x.specular),_.shininess.value=Math.max(x.shininess,1e-4)}function p(_,x){x.gradientMap&&(_.gradientMap.value=x.gradientMap)}function m(_,x){_.metalness.value=x.metalness,x.metalnessMap&&(_.metalnessMap.value=x.metalnessMap,t(x.metalnessMap,_.metalnessMapTransform)),_.roughness.value=x.roughness,x.roughnessMap&&(_.roughnessMap.value=x.roughnessMap,t(x.roughnessMap,_.roughnessMapTransform)),x.envMap&&(_.envMapIntensity.value=x.envMapIntensity)}function g(_,x,N){_.ior.value=x.ior,x.sheen>0&&(_.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),_.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(_.sheenColorMap.value=x.sheenColorMap,t(x.sheenColorMap,_.sheenColorMapTransform)),x.sheenRoughnessMap&&(_.sheenRoughnessMap.value=x.sheenRoughnessMap,t(x.sheenRoughnessMap,_.sheenRoughnessMapTransform))),x.clearcoat>0&&(_.clearcoat.value=x.clearcoat,_.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(_.clearcoatMap.value=x.clearcoatMap,t(x.clearcoatMap,_.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,t(x.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(_.clearcoatNormalMap.value=x.clearcoatNormalMap,t(x.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===bn&&_.clearcoatNormalScale.value.negate())),x.dispersion>0&&(_.dispersion.value=x.dispersion),x.iridescence>0&&(_.iridescence.value=x.iridescence,_.iridescenceIOR.value=x.iridescenceIOR,_.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(_.iridescenceMap.value=x.iridescenceMap,t(x.iridescenceMap,_.iridescenceMapTransform)),x.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=x.iridescenceThicknessMap,t(x.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),x.transmission>0&&(_.transmission.value=x.transmission,_.transmissionSamplerMap.value=N.texture,_.transmissionSamplerSize.value.set(N.width,N.height),x.transmissionMap&&(_.transmissionMap.value=x.transmissionMap,t(x.transmissionMap,_.transmissionMapTransform)),_.thickness.value=x.thickness,x.thicknessMap&&(_.thicknessMap.value=x.thicknessMap,t(x.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=x.attenuationDistance,_.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(_.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(_.anisotropyMap.value=x.anisotropyMap,t(x.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=x.specularIntensity,_.specularColor.value.copy(x.specularColor),x.specularColorMap&&(_.specularColorMap.value=x.specularColorMap,t(x.specularColorMap,_.specularColorMapTransform)),x.specularIntensityMap&&(_.specularIntensityMap.value=x.specularIntensityMap,t(x.specularIntensityMap,_.specularIntensityMapTransform))}function y(_,x){x.matcap&&(_.matcap.value=x.matcap)}function b(_,x){const N=e.get(x).light;_.referencePosition.value.setFromMatrixPosition(N.matrixWorld),_.nearDistance.value=N.shadow.camera.near,_.farDistance.value=N.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function nK(n,e,t,r){let i={},s={},a=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(N,T){const S=T.program;r.uniformBlockBinding(N,S)}function u(N,T){let S=i[N.id];S===void 0&&(y(N),S=h(N),i[N.id]=S,N.addEventListener("dispose",_));const M=T.program;r.updateUBOMapping(N,M);const C=e.render.frame;s[N.id]!==C&&(m(N),s[N.id]=C)}function h(N){const T=p();N.__bindingPointIndex=T;const S=n.createBuffer(),M=N.__size,C=N.usage;return n.bindBuffer(n.UNIFORM_BUFFER,S),n.bufferData(n.UNIFORM_BUFFER,M,C),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,T,S),S}function p(){for(let N=0;N<o;N++)if(a.indexOf(N)===-1)return a.push(N),N;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(N){const T=i[N.id],S=N.uniforms,M=N.__cache;n.bindBuffer(n.UNIFORM_BUFFER,T);for(let C=0,R=S.length;C<R;C++){const F=Array.isArray(S[C])?S[C]:[S[C]];for(let k=0,D=F.length;k<D;k++){const P=F[k];if(g(P,C,k,M)===!0){const G=P.__offset,$=Array.isArray(P.value)?P.value:[P.value];let U=0;for(let K=0;K<$.length;K++){const O=$[K],j=b(O);typeof O=="number"||typeof O=="boolean"?(P.__data[0]=O,n.bufferSubData(n.UNIFORM_BUFFER,G+U,P.__data)):O.isMatrix3?(P.__data[0]=O.elements[0],P.__data[1]=O.elements[1],P.__data[2]=O.elements[2],P.__data[3]=0,P.__data[4]=O.elements[3],P.__data[5]=O.elements[4],P.__data[6]=O.elements[5],P.__data[7]=0,P.__data[8]=O.elements[6],P.__data[9]=O.elements[7],P.__data[10]=O.elements[8],P.__data[11]=0):(O.toArray(P.__data,U),U+=j.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,G,P.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function g(N,T,S,M){const C=N.value,R=T+"_"+S;if(M[R]===void 0)return typeof C=="number"||typeof C=="boolean"?M[R]=C:M[R]=C.clone(),!0;{const F=M[R];if(typeof C=="number"||typeof C=="boolean"){if(F!==C)return M[R]=C,!0}else if(F.equals(C)===!1)return F.copy(C),!0}return!1}function y(N){const T=N.uniforms;let S=0;const M=16;for(let R=0,F=T.length;R<F;R++){const k=Array.isArray(T[R])?T[R]:[T[R]];for(let D=0,P=k.length;D<P;D++){const G=k[D],$=Array.isArray(G.value)?G.value:[G.value];for(let U=0,K=$.length;U<K;U++){const O=$[U],j=b(O),L=S%M,B=L%j.boundary,V=L+B;S+=B,V!==0&&M-V<j.storage&&(S+=M-V),G.__data=new Float32Array(j.storage/Float32Array.BYTES_PER_ELEMENT),G.__offset=S,S+=j.storage}}}const C=S%M;return C>0&&(S+=M-C),N.__size=S,N.__cache={},this}function b(N){const T={boundary:0,storage:0};return typeof N=="number"||typeof N=="boolean"?(T.boundary=4,T.storage=4):N.isVector2?(T.boundary=8,T.storage=8):N.isVector3||N.isColor?(T.boundary=16,T.storage=12):N.isVector4?(T.boundary=16,T.storage=16):N.isMatrix3?(T.boundary=48,T.storage=48):N.isMatrix4?(T.boundary=64,T.storage=64):N.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",N),T}function _(N){const T=N.target;T.removeEventListener("dispose",_);const S=a.indexOf(T.__bindingPointIndex);a.splice(S,1),n.deleteBuffer(i[T.id]),delete i[T.id],delete s[T.id]}function x(){for(const N in i)n.deleteBuffer(i[N]);a=[],i={},s={}}return{bind:l,update:u,dispose:x}}class rK{constructor(e={}){const{canvas:t=F3(),context:r=null,depth:i=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:p=!1,reverseDepthBuffer:m=!1}=e;this.isWebGLRenderer=!0;let g;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");g=r.getContextAttributes().alpha}else g=a;const y=new Uint32Array(4),b=new Int32Array(4);let _=null,x=null;const N=[],T=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Pi,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const S=this;let M=!1;this._outputColorSpace=li;let C=0,R=0,F=null,k=-1,D=null;const P=new Lt,G=new Lt;let $=null;const U=new vt(0);let K=0,O=t.width,j=t.height,L=1,B=null,V=null;const z=new Lt(0,0,O,j),Y=new Lt(0,0,O,j);let se=!1;const J=new Qp;let q=!1,Q=!1;const te=new Yt,X=new Yt,ce=new ee,me=new Lt,Re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let He=!1;function Qe(){return F===null?L:1}let ie=r;function Et(Z,he){return t.getContext(Z,he)}try{const Z={alpha:!0,depth:i,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:h,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${eh}`),t.addEventListener("webglcontextlost",rt,!1),t.addEventListener("webglcontextrestored",Be,!1),t.addEventListener("webglcontextcreationerror",Le,!1),ie===null){const he="webgl2";if(ie=Et(he,Z),ie===null)throw Et(he)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Z){throw console.error("THREE.WebGLRenderer: "+Z.message),Z}let yt,tt,Ne,_t,it,wt,fn,ne,W,ye,Ce,Pe,Te,ut,qe,Ke,lt,De,et,St,pt,We,Mt,le;function Ze(){yt=new fX(ie),yt.init(),We=new YY(ie,yt),tt=new aX(ie,yt,e,We),Ne=new qY(ie,yt),tt.reverseDepthBuffer&&m&&Ne.buffers.depth.setReversed(!0),_t=new gX(ie),it=new DY,wt=new XY(ie,yt,Ne,it,tt,We,_t),fn=new lX(S),ne=new hX(S),W=new wW(ie),Mt=new iX(ie,W),ye=new pX(ie,W,_t,Mt),Ce=new yX(ie,ye,W,_t),et=new xX(ie,tt,wt),Ke=new oX(it),Pe=new LY(S,fn,ne,yt,tt,Mt,Ke),Te=new tK(S,it),ut=new jY,qe=new VY(yt),De=new rX(S,fn,ne,Ne,Ce,g,l),lt=new $Y(S,Ce,tt),le=new nK(ie,_t,tt,Ne),St=new sX(ie,yt,_t),pt=new mX(ie,yt,_t),_t.programs=Pe.programs,S.capabilities=tt,S.extensions=yt,S.properties=it,S.renderLists=ut,S.shadowMap=lt,S.state=Ne,S.info=_t}Ze();const Ie=new JY(S,ie);this.xr=Ie,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){const Z=yt.get("WEBGL_lose_context");Z&&Z.loseContext()},this.forceContextRestore=function(){const Z=yt.get("WEBGL_lose_context");Z&&Z.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(Z){Z!==void 0&&(L=Z,this.setSize(O,j,!1))},this.getSize=function(Z){return Z.set(O,j)},this.setSize=function(Z,he,_e=!0){if(Ie.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}O=Z,j=he,t.width=Math.floor(Z*L),t.height=Math.floor(he*L),_e===!0&&(t.style.width=Z+"px",t.style.height=he+"px"),this.setViewport(0,0,Z,he)},this.getDrawingBufferSize=function(Z){return Z.set(O*L,j*L).floor()},this.setDrawingBufferSize=function(Z,he,_e){O=Z,j=he,L=_e,t.width=Math.floor(Z*_e),t.height=Math.floor(he*_e),this.setViewport(0,0,Z,he)},this.getCurrentViewport=function(Z){return Z.copy(P)},this.getViewport=function(Z){return Z.copy(z)},this.setViewport=function(Z,he,_e,ge){Z.isVector4?z.set(Z.x,Z.y,Z.z,Z.w):z.set(Z,he,_e,ge),Ne.viewport(P.copy(z).multiplyScalar(L).round())},this.getScissor=function(Z){return Z.copy(Y)},this.setScissor=function(Z,he,_e,ge){Z.isVector4?Y.set(Z.x,Z.y,Z.z,Z.w):Y.set(Z,he,_e,ge),Ne.scissor(G.copy(Y).multiplyScalar(L).round())},this.getScissorTest=function(){return se},this.setScissorTest=function(Z){Ne.setScissorTest(se=Z)},this.setOpaqueSort=function(Z){B=Z},this.setTransparentSort=function(Z){V=Z},this.getClearColor=function(Z){return Z.copy(De.getClearColor())},this.setClearColor=function(){De.setClearColor(...arguments)},this.getClearAlpha=function(){return De.getClearAlpha()},this.setClearAlpha=function(){De.setClearAlpha(...arguments)},this.clear=function(Z=!0,he=!0,_e=!0){let ge=0;if(Z){let fe=!1;if(F!==null){const Ve=F.texture.format;fe=Ve===rh||Ve===nh||Ve===th}if(fe){const Ve=F.texture.type,Je=Ve===Hn||Ve===En||Ve===zs||Ve===Ki||Ve===Hx||Ve===$x,ct=De.getClearColor(),at=De.getClearAlpha(),Pt=ct.r,Ct=ct.g,ht=ct.b;Je?(y[0]=Pt,y[1]=Ct,y[2]=ht,y[3]=at,ie.clearBufferuiv(ie.COLOR,0,y)):(b[0]=Pt,b[1]=Ct,b[2]=ht,b[3]=at,ie.clearBufferiv(ie.COLOR,0,b))}else ge|=ie.COLOR_BUFFER_BIT}he&&(ge|=ie.DEPTH_BUFFER_BIT),_e&&(ge|=ie.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ie.clear(ge)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",rt,!1),t.removeEventListener("webglcontextrestored",Be,!1),t.removeEventListener("webglcontextcreationerror",Le,!1),De.dispose(),ut.dispose(),qe.dispose(),it.dispose(),fn.dispose(),ne.dispose(),Ce.dispose(),Mt.dispose(),le.dispose(),Pe.dispose(),Ie.dispose(),Ie.removeEventListener("sessionstart",To),Ie.removeEventListener("sessionend",qs),_s.stop()};function rt(Z){Z.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function Be(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const Z=_t.autoReset,he=lt.enabled,_e=lt.autoUpdate,ge=lt.needsUpdate,fe=lt.type;Ze(),_t.autoReset=Z,lt.enabled=he,lt.autoUpdate=_e,lt.needsUpdate=ge,lt.type=fe}function Le(Z){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Z.statusMessage)}function dt(Z){const he=Z.target;he.removeEventListener("dispose",dt),Dt(he)}function Dt(Z){pn(Z),it.remove(Z)}function pn(Z){const he=it.get(Z).programs;he!==void 0&&(he.forEach(function(_e){Pe.releaseProgram(_e)}),Z.isShaderMaterial&&Pe.releaseShaderCache(Z))}this.renderBufferDirect=function(Z,he,_e,ge,fe,Ve){he===null&&(he=Re);const Je=fe.isMesh&&fe.matrixWorld.determinant()<0,ct=Fc(Z,he,_e,ge,fe);Ne.setMaterial(ge,Je);let at=_e.index,Pt=1;if(ge.wireframe===!0){if(at=ye.getWireframeAttribute(_e),at===void 0)return;Pt=2}const Ct=_e.drawRange,ht=_e.attributes.position;let Gt=Ct.start*Pt,Wt=(Ct.start+Ct.count)*Pt;Ve!==null&&(Gt=Math.max(Gt,Ve.start*Pt),Wt=Math.min(Wt,(Ve.start+Ve.count)*Pt)),at!==null?(Gt=Math.max(Gt,0),Wt=Math.min(Wt,at.count)):ht!=null&&(Gt=Math.max(Gt,0),Wt=Math.min(Wt,ht.count));const In=Wt-Gt;if(In<0||In===1/0)return;Mt.setup(fe,ge,ct,_e,at);let wn,gn=St;if(at!==null&&(wn=W.get(at),gn=pt,gn.setIndex(wn)),fe.isMesh)ge.wireframe===!0?(Ne.setLineWidth(ge.wireframeLinewidth*Qe()),gn.setMode(ie.LINES)):gn.setMode(ie.TRIANGLES);else if(fe.isLine){let Tt=ge.linewidth;Tt===void 0&&(Tt=1),Ne.setLineWidth(Tt*Qe()),fe.isLineSegments?gn.setMode(ie.LINES):fe.isLineLoop?gn.setMode(ie.LINE_LOOP):gn.setMode(ie.LINE_STRIP)}else fe.isPoints?gn.setMode(ie.POINTS):fe.isSprite&&gn.setMode(ie.TRIANGLES);if(fe.isBatchedMesh)if(fe._multiDrawInstances!==null)Ji("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),gn.renderMultiDrawInstances(fe._multiDrawStarts,fe._multiDrawCounts,fe._multiDrawCount,fe._multiDrawInstances);else if(yt.get("WEBGL_multi_draw"))gn.renderMultiDraw(fe._multiDrawStarts,fe._multiDrawCounts,fe._multiDrawCount);else{const Tt=fe._multiDrawStarts,yn=fe._multiDrawCounts,Kt=fe._multiDrawCount,vr=at?W.get(at).bytesPerElement:1,Eo=it.get(ge).currentProgram.getUniforms();for(let ni=0;ni<Kt;ni++)Eo.setValue(ie,"_gl_DrawID",ni),gn.render(Tt[ni]/vr,yn[ni])}else if(fe.isInstancedMesh)gn.renderInstances(Gt,In,fe.count);else if(_e.isInstancedBufferGeometry){const Tt=_e._maxInstanceCount!==void 0?_e._maxInstanceCount:1/0,yn=Math.min(_e.instanceCount,Tt);gn.renderInstances(Gt,In,yn)}else gn.render(Gt,In)};function nn(Z,he,_e){Z.transparent===!0&&Z.side===Yr&&Z.forceSinglePass===!1?(Z.side=bn,Z.needsUpdate=!0,No(Z,he,_e),Z.side=Ai,Z.needsUpdate=!0,No(Z,he,_e),Z.side=Yr):No(Z,he,_e)}this.compile=function(Z,he,_e=null){_e===null&&(_e=Z),x=qe.get(_e),x.init(he),T.push(x),_e.traverseVisible(function(fe){fe.isLight&&fe.layers.test(he.layers)&&(x.pushLight(fe),fe.castShadow&&x.pushShadow(fe))}),Z!==_e&&Z.traverseVisible(function(fe){fe.isLight&&fe.layers.test(he.layers)&&(x.pushLight(fe),fe.castShadow&&x.pushShadow(fe))}),x.setupLights();const ge=new Set;return Z.traverse(function(fe){if(!(fe.isMesh||fe.isPoints||fe.isLine||fe.isSprite))return;const Ve=fe.material;if(Ve)if(Array.isArray(Ve))for(let Je=0;Je<Ve.length;Je++){const ct=Ve[Je];nn(ct,_e,fe),ge.add(ct)}else nn(Ve,_e,fe),ge.add(Ve)}),x=T.pop(),ge},this.compileAsync=function(Z,he,_e=null){const ge=this.compile(Z,he,_e);return new Promise(fe=>{function Ve(){if(ge.forEach(function(Je){it.get(Je).currentProgram.isReady()&&ge.delete(Je)}),ge.size===0){fe(Z);return}setTimeout(Ve,10)}yt.get("KHR_parallel_shader_compile")!==null?Ve():setTimeout(Ve,10)})};let Br=null;function Pr(Z){Br&&Br(Z)}function To(){_s.stop()}function qs(){_s.start()}const _s=new eD;_s.setAnimationLoop(Pr),typeof self<"u"&&_s.setContext(self),this.setAnimationLoop=function(Z){Br=Z,Ie.setAnimationLoop(Z),Z===null?_s.stop():_s.start()},Ie.addEventListener("sessionstart",To),Ie.addEventListener("sessionend",qs),this.render=function(Z,he){if(he!==void 0&&he.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;if(Z.matrixWorldAutoUpdate===!0&&Z.updateMatrixWorld(),he.parent===null&&he.matrixWorldAutoUpdate===!0&&he.updateMatrixWorld(),Ie.enabled===!0&&Ie.isPresenting===!0&&(Ie.cameraAutoUpdate===!0&&Ie.updateCamera(he),he=Ie.getCamera()),Z.isScene===!0&&Z.onBeforeRender(S,Z,he,F),x=qe.get(Z,T.length),x.init(he),T.push(x),X.multiplyMatrices(he.projectionMatrix,he.matrixWorldInverse),J.setFromProjectionMatrix(X),Q=this.localClippingEnabled,q=Ke.init(this.clippingPlanes,Q),_=ut.get(Z,N.length),_.init(),N.push(_),Ie.enabled===!0&&Ie.isPresenting===!0){const Ve=S.xr.getDepthSensingMesh();Ve!==null&&bs(Ve,he,-1/0,S.sortObjects)}bs(Z,he,0,S.sortObjects),_.finish(),S.sortObjects===!0&&_.sort(B,V),He=Ie.enabled===!1||Ie.isPresenting===!1||Ie.hasDepthSensing()===!1,He&&De.addToRenderList(_,Z),this.info.render.frame++,q===!0&&Ke.beginShadows();const _e=x.state.shadowsArray;lt.render(_e,Z,he),q===!0&&Ke.endShadows(),this.info.autoReset===!0&&this.info.reset();const ge=_.opaque,fe=_.transmissive;if(x.setupLights(),he.isArrayCamera){const Ve=he.cameras;if(fe.length>0)for(let Je=0,ct=Ve.length;Je<ct;Je++){const at=Ve[Je];Ma(ge,fe,Z,at)}He&&De.render(Z);for(let Je=0,ct=Ve.length;Je<ct;Je++){const at=Ve[Je];Ea(_,Z,at,at.viewport)}}else fe.length>0&&Ma(ge,fe,Z,he),He&&De.render(Z),Ea(_,Z,he);F!==null&&R===0&&(wt.updateMultisampleRenderTarget(F),wt.updateRenderTargetMipmap(F)),Z.isScene===!0&&Z.onAfterRender(S,Z,he),Mt.resetDefaultState(),k=-1,D=null,T.pop(),T.length>0?(x=T[T.length-1],q===!0&&Ke.setGlobalState(S.clippingPlanes,x.state.camera)):x=null,N.pop(),N.length>0?_=N[N.length-1]:_=null};function bs(Z,he,_e,ge){if(Z.visible===!1)return;if(Z.layers.test(he.layers)){if(Z.isGroup)_e=Z.renderOrder;else if(Z.isLOD)Z.autoUpdate===!0&&Z.update(he);else if(Z.isLight)x.pushLight(Z),Z.castShadow&&x.pushShadow(Z);else if(Z.isSprite){if(!Z.frustumCulled||J.intersectsSprite(Z)){ge&&me.setFromMatrixPosition(Z.matrixWorld).applyMatrix4(X);const Je=Ce.update(Z),ct=Z.material;ct.visible&&_.push(Z,Je,ct,_e,me.z,null)}}else if((Z.isMesh||Z.isLine||Z.isPoints)&&(!Z.frustumCulled||J.intersectsObject(Z))){const Je=Ce.update(Z),ct=Z.material;if(ge&&(Z.boundingSphere!==void 0?(Z.boundingSphere===null&&Z.computeBoundingSphere(),me.copy(Z.boundingSphere.center)):(Je.boundingSphere===null&&Je.computeBoundingSphere(),me.copy(Je.boundingSphere.center)),me.applyMatrix4(Z.matrixWorld).applyMatrix4(X)),Array.isArray(ct)){const at=Je.groups;for(let Pt=0,Ct=at.length;Pt<Ct;Pt++){const ht=at[Pt],Gt=ct[ht.materialIndex];Gt&&Gt.visible&&_.push(Z,Je,Gt,_e,me.z,ht)}}else ct.visible&&_.push(Z,Je,ct,_e,me.z,null)}}const Ve=Z.children;for(let Je=0,ct=Ve.length;Je<ct;Je++)bs(Ve[Je],he,_e,ge)}function Ea(Z,he,_e,ge){const fe=Z.opaque,Ve=Z.transmissive,Je=Z.transparent;x.setupLightsView(_e),q===!0&&Ke.setGlobalState(S.clippingPlanes,_e),ge&&Ne.viewport(P.copy(ge)),fe.length>0&&Xs(fe,he,_e),Ve.length>0&&Xs(Ve,he,_e),Je.length>0&&Xs(Je,he,_e),Ne.buffers.depth.setTest(!0),Ne.buffers.depth.setMask(!0),Ne.buffers.color.setMask(!0),Ne.setPolygonOffset(!1)}function Ma(Z,he,_e,ge){if((_e.isScene===!0?_e.overrideMaterial:null)!==null)return;x.state.transmissionRenderTarget[ge.id]===void 0&&(x.state.transmissionRenderTarget[ge.id]=new _l(1,1,{generateMipmaps:!0,type:yt.has("EXT_color_buffer_half_float")||yt.has("EXT_color_buffer_float")?Cr:Hn,minFilter:Ei,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Ot.workingColorSpace}));const Ve=x.state.transmissionRenderTarget[ge.id],Je=ge.viewport||P;Ve.setSize(Je.z*S.transmissionResolutionScale,Je.w*S.transmissionResolutionScale);const ct=S.getRenderTarget(),at=S.getActiveCubeFace(),Pt=S.getActiveMipmapLevel();S.setRenderTarget(Ve),S.getClearColor(U),K=S.getClearAlpha(),K<1&&S.setClearColor(16777215,.5),S.clear(),He&&De.render(_e);const Ct=S.toneMapping;S.toneMapping=Pi;const ht=ge.viewport;if(ge.viewport!==void 0&&(ge.viewport=void 0),x.setupLightsView(ge),q===!0&&Ke.setGlobalState(S.clippingPlanes,ge),Xs(Z,_e,ge),wt.updateMultisampleRenderTarget(Ve),wt.updateRenderTargetMipmap(Ve),yt.has("WEBGL_multisampled_render_to_texture")===!1){let Gt=!1;for(let Wt=0,In=he.length;Wt<In;Wt++){const wn=he[Wt],gn=wn.object,Tt=wn.geometry,yn=wn.material,Kt=wn.group;if(yn.side===Yr&&gn.layers.test(ge.layers)){const vr=yn.side;yn.side=bn,yn.needsUpdate=!0,jc(gn,_e,ge,Tt,yn,Kt),yn.side=vr,yn.needsUpdate=!0,Gt=!0}}Gt===!0&&(wt.updateMultisampleRenderTarget(Ve),wt.updateRenderTargetMipmap(Ve))}S.setRenderTarget(ct,at,Pt),S.setClearColor(U,K),ht!==void 0&&(ge.viewport=ht),S.toneMapping=Ct}function Xs(Z,he,_e){const ge=he.isScene===!0?he.overrideMaterial:null;for(let fe=0,Ve=Z.length;fe<Ve;fe++){const Je=Z[fe],ct=Je.object,at=Je.geometry,Pt=Je.group;let Ct=Je.material;Ct.allowOverride===!0&&ge!==null&&(Ct=ge),ct.layers.test(_e.layers)&&jc(ct,he,_e,at,Ct,Pt)}}function jc(Z,he,_e,ge,fe,Ve){Z.onBeforeRender(S,he,_e,ge,fe,Ve),Z.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,Z.matrixWorld),Z.normalMatrix.getNormalMatrix(Z.modelViewMatrix),fe.onBeforeRender(S,he,_e,ge,Z,Ve),fe.transparent===!0&&fe.side===Yr&&fe.forceSinglePass===!1?(fe.side=bn,fe.needsUpdate=!0,S.renderBufferDirect(_e,he,ge,fe,Z,Ve),fe.side=Ai,fe.needsUpdate=!0,S.renderBufferDirect(_e,he,ge,fe,Z,Ve),fe.side=Yr):S.renderBufferDirect(_e,he,ge,fe,Z,Ve),Z.onAfterRender(S,he,_e,ge,fe,Ve)}function No(Z,he,_e){he.isScene!==!0&&(he=Re);const ge=it.get(Z),fe=x.state.lights,Ve=x.state.shadowsArray,Je=fe.state.version,ct=Pe.getParameters(Z,fe.state,Ve,he,_e),at=Pe.getProgramCacheKey(ct);let Pt=ge.programs;ge.environment=Z.isMeshStandardMaterial?he.environment:null,ge.fog=he.fog,ge.envMap=(Z.isMeshStandardMaterial?ne:fn).get(Z.envMap||ge.environment),ge.envMapRotation=ge.environment!==null&&Z.envMap===null?he.environmentRotation:Z.envMapRotation,Pt===void 0&&(Z.addEventListener("dispose",dt),Pt=new Map,ge.programs=Pt);let Ct=Pt.get(at);if(Ct!==void 0){if(ge.currentProgram===Ct&&ge.lightsStateVersion===Je)return ns(Z,ct),Ct}else ct.uniforms=Pe.getUniforms(Z),Z.onBeforeCompile(ct,S),Ct=Pe.acquireProgram(ct,at),Pt.set(at,Ct),ge.uniforms=ct.uniforms;const ht=ge.uniforms;return(!Z.isShaderMaterial&&!Z.isRawShaderMaterial||Z.clipping===!0)&&(ht.clippingPlanes=Ke.uniform),ns(Z,ct),ge.needsLights=hh(Z),ge.lightsStateVersion=Je,ge.needsLights&&(ht.ambientLightColor.value=fe.state.ambient,ht.lightProbe.value=fe.state.probe,ht.directionalLights.value=fe.state.directional,ht.directionalLightShadows.value=fe.state.directionalShadow,ht.spotLights.value=fe.state.spot,ht.spotLightShadows.value=fe.state.spotShadow,ht.rectAreaLights.value=fe.state.rectArea,ht.ltc_1.value=fe.state.rectAreaLTC1,ht.ltc_2.value=fe.state.rectAreaLTC2,ht.pointLights.value=fe.state.point,ht.pointLightShadows.value=fe.state.pointShadow,ht.hemisphereLights.value=fe.state.hemi,ht.directionalShadowMap.value=fe.state.directionalShadowMap,ht.directionalShadowMatrix.value=fe.state.directionalShadowMatrix,ht.spotShadowMap.value=fe.state.spotShadowMap,ht.spotLightMatrix.value=fe.state.spotLightMatrix,ht.spotLightMap.value=fe.state.spotLightMap,ht.pointShadowMap.value=fe.state.pointShadowMap,ht.pointShadowMatrix.value=fe.state.pointShadowMatrix),ge.currentProgram=Ct,ge.uniformsList=null,Ct}function Rl(Z){if(Z.uniformsList===null){const he=Z.currentProgram.getUniforms();Z.uniformsList=j0.seqWithValue(he.seq,Z.uniforms)}return Z.uniformsList}function ns(Z,he){const _e=it.get(Z);_e.outputColorSpace=he.outputColorSpace,_e.batching=he.batching,_e.batchingColor=he.batchingColor,_e.instancing=he.instancing,_e.instancingColor=he.instancingColor,_e.instancingMorph=he.instancingMorph,_e.skinning=he.skinning,_e.morphTargets=he.morphTargets,_e.morphNormals=he.morphNormals,_e.morphColors=he.morphColors,_e.morphTargetsCount=he.morphTargetsCount,_e.numClippingPlanes=he.numClippingPlanes,_e.numIntersection=he.numClipIntersection,_e.vertexAlphas=he.vertexAlphas,_e.vertexTangents=he.vertexTangents,_e.toneMapping=he.toneMapping}function Fc(Z,he,_e,ge,fe){he.isScene!==!0&&(he=Re),wt.resetTextureUnits();const Ve=he.fog,Je=ge.isMeshStandardMaterial?he.environment:null,ct=F===null?S.outputColorSpace:F.isXRRenderTarget===!0?F.texture.colorSpace:pa,at=(ge.isMeshStandardMaterial?ne:fn).get(ge.envMap||Je),Pt=ge.vertexColors===!0&&!!_e.attributes.color&&_e.attributes.color.itemSize===4,Ct=!!_e.attributes.tangent&&(!!ge.normalMap||ge.anisotropy>0),ht=!!_e.morphAttributes.position,Gt=!!_e.morphAttributes.normal,Wt=!!_e.morphAttributes.color;let In=Pi;ge.toneMapped&&(F===null||F.isXRRenderTarget===!0)&&(In=S.toneMapping);const wn=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,gn=wn!==void 0?wn.length:0,Tt=it.get(ge),yn=x.state.lights;if(q===!0&&(Q===!0||Z!==D)){const kr=Z===D&&ge.id===k;Ke.setState(ge,Z,kr)}let Kt=!1;ge.version===Tt.__version?(Tt.needsLights&&Tt.lightsStateVersion!==yn.state.version||Tt.outputColorSpace!==ct||fe.isBatchedMesh&&Tt.batching===!1||!fe.isBatchedMesh&&Tt.batching===!0||fe.isBatchedMesh&&Tt.batchingColor===!0&&fe.colorTexture===null||fe.isBatchedMesh&&Tt.batchingColor===!1&&fe.colorTexture!==null||fe.isInstancedMesh&&Tt.instancing===!1||!fe.isInstancedMesh&&Tt.instancing===!0||fe.isSkinnedMesh&&Tt.skinning===!1||!fe.isSkinnedMesh&&Tt.skinning===!0||fe.isInstancedMesh&&Tt.instancingColor===!0&&fe.instanceColor===null||fe.isInstancedMesh&&Tt.instancingColor===!1&&fe.instanceColor!==null||fe.isInstancedMesh&&Tt.instancingMorph===!0&&fe.morphTexture===null||fe.isInstancedMesh&&Tt.instancingMorph===!1&&fe.morphTexture!==null||Tt.envMap!==at||ge.fog===!0&&Tt.fog!==Ve||Tt.numClippingPlanes!==void 0&&(Tt.numClippingPlanes!==Ke.numPlanes||Tt.numIntersection!==Ke.numIntersection)||Tt.vertexAlphas!==Pt||Tt.vertexTangents!==Ct||Tt.morphTargets!==ht||Tt.morphNormals!==Gt||Tt.morphColors!==Wt||Tt.toneMapping!==In||Tt.morphTargetsCount!==gn)&&(Kt=!0):(Kt=!0,Tt.__version=ge.version);let vr=Tt.currentProgram;Kt===!0&&(vr=No(ge,he,fe));let Eo=!1,ni=!1,Ca=!1;const Sn=vr.getUniforms(),zr=Tt.uniforms;if(Ne.useProgram(vr.program)&&(Eo=!0,ni=!0,Ca=!0),ge.id!==k&&(k=ge.id,ni=!0),Eo||D!==Z){Ne.buffers.depth.getReversed()?(te.copy(Z.projectionMatrix),s9(te),a9(te),Sn.setValue(ie,"projectionMatrix",te)):Sn.setValue(ie,"projectionMatrix",Z.projectionMatrix),Sn.setValue(ie,"viewMatrix",Z.matrixWorldInverse);const br=Sn.map.cameraPosition;br!==void 0&&br.setValue(ie,ce.setFromMatrixPosition(Z.matrixWorld)),tt.logarithmicDepthBuffer&&Sn.setValue(ie,"logDepthBufFC",2/(Math.log(Z.far+1)/Math.LN2)),(ge.isMeshPhongMaterial||ge.isMeshToonMaterial||ge.isMeshLambertMaterial||ge.isMeshBasicMaterial||ge.isMeshStandardMaterial||ge.isShaderMaterial)&&Sn.setValue(ie,"isOrthographic",Z.isOrthographicCamera===!0),D!==Z&&(D=Z,ni=!0,Ca=!0)}if(fe.isSkinnedMesh){Sn.setOptional(ie,fe,"bindMatrix"),Sn.setOptional(ie,fe,"bindMatrixInverse");const kr=fe.skeleton;kr&&(kr.boneTexture===null&&kr.computeBoneTexture(),Sn.setValue(ie,"boneTexture",kr.boneTexture,wt))}fe.isBatchedMesh&&(Sn.setOptional(ie,fe,"batchingTexture"),Sn.setValue(ie,"batchingTexture",fe._matricesTexture,wt),Sn.setOptional(ie,fe,"batchingIdTexture"),Sn.setValue(ie,"batchingIdTexture",fe._indirectTexture,wt),Sn.setOptional(ie,fe,"batchingColorTexture"),fe._colorsTexture!==null&&Sn.setValue(ie,"batchingColorTexture",fe._colorsTexture,wt));const _r=_e.morphAttributes;if((_r.position!==void 0||_r.normal!==void 0||_r.color!==void 0)&&et.update(fe,_e,vr),(ni||Tt.receiveShadow!==fe.receiveShadow)&&(Tt.receiveShadow=fe.receiveShadow,Sn.setValue(ie,"receiveShadow",fe.receiveShadow)),ge.isMeshGouraudMaterial&&ge.envMap!==null&&(zr.envMap.value=at,zr.flipEnvMap.value=at.isCubeTexture&&at.isRenderTargetTexture===!1?-1:1),ge.isMeshStandardMaterial&&ge.envMap===null&&he.environment!==null&&(zr.envMapIntensity.value=he.environmentIntensity),ni&&(Sn.setValue(ie,"toneMappingExposure",S.toneMappingExposure),Tt.needsLights&&Oc(zr,Ca),Ve&&ge.fog===!0&&Te.refreshFogUniforms(zr,Ve),Te.refreshMaterialUniforms(zr,ge,L,j,x.state.transmissionRenderTarget[Z.id]),j0.upload(ie,Rl(Tt),zr,wt)),ge.isShaderMaterial&&ge.uniformsNeedUpdate===!0&&(j0.upload(ie,Rl(Tt),zr,wt),ge.uniformsNeedUpdate=!1),ge.isSpriteMaterial&&Sn.setValue(ie,"center",fe.center),Sn.setValue(ie,"modelViewMatrix",fe.modelViewMatrix),Sn.setValue(ie,"normalMatrix",fe.normalMatrix),Sn.setValue(ie,"modelMatrix",fe.matrixWorld),ge.isShaderMaterial||ge.isRawShaderMaterial){const kr=ge.uniformsGroups;for(let br=0,sn=kr.length;br<sn;br++){const Ys=kr[br];le.update(Ys,vr),le.bind(Ys,vr)}}return vr}function Oc(Z,he){Z.ambientLightColor.needsUpdate=he,Z.lightProbe.needsUpdate=he,Z.directionalLights.needsUpdate=he,Z.directionalLightShadows.needsUpdate=he,Z.pointLights.needsUpdate=he,Z.pointLightShadows.needsUpdate=he,Z.spotLights.needsUpdate=he,Z.spotLightShadows.needsUpdate=he,Z.rectAreaLights.needsUpdate=he,Z.hemisphereLights.needsUpdate=he}function hh(Z){return Z.isMeshLambertMaterial||Z.isMeshToonMaterial||Z.isMeshPhongMaterial||Z.isMeshStandardMaterial||Z.isShadowMaterial||Z.isShaderMaterial&&Z.lights===!0}this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return F},this.setRenderTargetTextures=function(Z,he,_e){const ge=it.get(Z);ge.__autoAllocateDepthBuffer=Z.resolveDepthBuffer===!1,ge.__autoAllocateDepthBuffer===!1&&(ge.__useRenderToTexture=!1),it.get(Z.texture).__webglTexture=he,it.get(Z.depthTexture).__webglTexture=ge.__autoAllocateDepthBuffer?void 0:_e,ge.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(Z,he){const _e=it.get(Z);_e.__webglFramebuffer=he,_e.__useDefaultFramebuffer=he===void 0};const Uc=ie.createFramebuffer();this.setRenderTarget=function(Z,he=0,_e=0){F=Z,C=he,R=_e;let ge=!0,fe=null,Ve=!1,Je=!1;if(Z){const at=it.get(Z);if(at.__useDefaultFramebuffer!==void 0)Ne.bindFramebuffer(ie.FRAMEBUFFER,null),ge=!1;else if(at.__webglFramebuffer===void 0)wt.setupRenderTarget(Z);else if(at.__hasExternalTextures)wt.rebindTextures(Z,it.get(Z.texture).__webglTexture,it.get(Z.depthTexture).__webglTexture);else if(Z.depthBuffer){const ht=Z.depthTexture;if(at.__boundDepthTexture!==ht){if(ht!==null&&it.has(ht)&&(Z.width!==ht.image.width||Z.height!==ht.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");wt.setupDepthRenderbuffer(Z)}}const Pt=Z.texture;(Pt.isData3DTexture||Pt.isDataArrayTexture||Pt.isCompressedArrayTexture)&&(Je=!0);const Ct=it.get(Z).__webglFramebuffer;Z.isWebGLCubeRenderTarget?(Array.isArray(Ct[he])?fe=Ct[he][_e]:fe=Ct[he],Ve=!0):Z.samples>0&&wt.useMultisampledRTT(Z)===!1?fe=it.get(Z).__webglMultisampledFramebuffer:Array.isArray(Ct)?fe=Ct[_e]:fe=Ct,P.copy(Z.viewport),G.copy(Z.scissor),$=Z.scissorTest}else P.copy(z).multiplyScalar(L).floor(),G.copy(Y).multiplyScalar(L).floor(),$=se;if(_e!==0&&(fe=Uc),Ne.bindFramebuffer(ie.FRAMEBUFFER,fe)&&ge&&Ne.drawBuffers(Z,fe),Ne.viewport(P),Ne.scissor(G),Ne.setScissorTest($),Ve){const at=it.get(Z.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_CUBE_MAP_POSITIVE_X+he,at.__webglTexture,_e)}else if(Je){const at=it.get(Z.texture),Pt=he;ie.framebufferTextureLayer(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,at.__webglTexture,_e,Pt)}else if(Z!==null&&_e!==0){const at=it.get(Z.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,at.__webglTexture,_e)}k=-1},this.readRenderTargetPixels=function(Z,he,_e,ge,fe,Ve,Je,ct=0){if(!(Z&&Z.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let at=it.get(Z).__webglFramebuffer;if(Z.isWebGLCubeRenderTarget&&Je!==void 0&&(at=at[Je]),at){Ne.bindFramebuffer(ie.FRAMEBUFFER,at);try{const Pt=Z.textures[ct],Ct=Pt.format,ht=Pt.type;if(!tt.textureFormatReadable(Ct)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!tt.textureTypeReadable(ht)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}he>=0&&he<=Z.width-ge&&_e>=0&&_e<=Z.height-fe&&(Z.textures.length>1&&ie.readBuffer(ie.COLOR_ATTACHMENT0+ct),ie.readPixels(he,_e,ge,fe,We.convert(Ct),We.convert(ht),Ve))}finally{const Pt=F!==null?it.get(F).__webglFramebuffer:null;Ne.bindFramebuffer(ie.FRAMEBUFFER,Pt)}}},this.readRenderTargetPixelsAsync=async function(Z,he,_e,ge,fe,Ve,Je,ct=0){if(!(Z&&Z.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let at=it.get(Z).__webglFramebuffer;if(Z.isWebGLCubeRenderTarget&&Je!==void 0&&(at=at[Je]),at)if(he>=0&&he<=Z.width-ge&&_e>=0&&_e<=Z.height-fe){Ne.bindFramebuffer(ie.FRAMEBUFFER,at);const Pt=Z.textures[ct],Ct=Pt.format,ht=Pt.type;if(!tt.textureFormatReadable(Ct))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!tt.textureTypeReadable(ht))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Gt=ie.createBuffer();ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Gt),ie.bufferData(ie.PIXEL_PACK_BUFFER,Ve.byteLength,ie.STREAM_READ),Z.textures.length>1&&ie.readBuffer(ie.COLOR_ATTACHMENT0+ct),ie.readPixels(he,_e,ge,fe,We.convert(Ct),We.convert(ht),0);const Wt=F!==null?it.get(F).__webglFramebuffer:null;Ne.bindFramebuffer(ie.FRAMEBUFFER,Wt);const In=ie.fenceSync(ie.SYNC_GPU_COMMANDS_COMPLETE,0);return ie.flush(),await i9(ie,In,4),ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Gt),ie.getBufferSubData(ie.PIXEL_PACK_BUFFER,0,Ve),ie.deleteBuffer(Gt),ie.deleteSync(In),Ve}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(Z,he=null,_e=0){const ge=Math.pow(2,-_e),fe=Math.floor(Z.image.width*ge),Ve=Math.floor(Z.image.height*ge),Je=he!==null?he.x:0,ct=he!==null?he.y:0;wt.setTexture2D(Z,0),ie.copyTexSubImage2D(ie.TEXTURE_2D,_e,0,0,Je,ct,fe,Ve),Ne.unbindTexture()};const Bc=ie.createFramebuffer(),zc=ie.createFramebuffer();this.copyTextureToTexture=function(Z,he,_e=null,ge=null,fe=0,Ve=null){Ve===null&&(fe!==0?(Ji("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Ve=fe,fe=0):Ve=0);let Je,ct,at,Pt,Ct,ht,Gt,Wt,In;const wn=Z.isCompressedTexture?Z.mipmaps[Ve]:Z.image;if(_e!==null)Je=_e.max.x-_e.min.x,ct=_e.max.y-_e.min.y,at=_e.isBox3?_e.max.z-_e.min.z:1,Pt=_e.min.x,Ct=_e.min.y,ht=_e.isBox3?_e.min.z:0;else{const _r=Math.pow(2,-fe);Je=Math.floor(wn.width*_r),ct=Math.floor(wn.height*_r),Z.isDataArrayTexture?at=wn.depth:Z.isData3DTexture?at=Math.floor(wn.depth*_r):at=1,Pt=0,Ct=0,ht=0}ge!==null?(Gt=ge.x,Wt=ge.y,In=ge.z):(Gt=0,Wt=0,In=0);const gn=We.convert(he.format),Tt=We.convert(he.type);let yn;he.isData3DTexture?(wt.setTexture3D(he,0),yn=ie.TEXTURE_3D):he.isDataArrayTexture||he.isCompressedArrayTexture?(wt.setTexture2DArray(he,0),yn=ie.TEXTURE_2D_ARRAY):(wt.setTexture2D(he,0),yn=ie.TEXTURE_2D),ie.pixelStorei(ie.UNPACK_FLIP_Y_WEBGL,he.flipY),ie.pixelStorei(ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),ie.pixelStorei(ie.UNPACK_ALIGNMENT,he.unpackAlignment);const Kt=ie.getParameter(ie.UNPACK_ROW_LENGTH),vr=ie.getParameter(ie.UNPACK_IMAGE_HEIGHT),Eo=ie.getParameter(ie.UNPACK_SKIP_PIXELS),ni=ie.getParameter(ie.UNPACK_SKIP_ROWS),Ca=ie.getParameter(ie.UNPACK_SKIP_IMAGES);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,wn.width),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,wn.height),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,Pt),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,Ct),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,ht);const Sn=Z.isDataArrayTexture||Z.isData3DTexture,zr=he.isDataArrayTexture||he.isData3DTexture;if(Z.isDepthTexture){const _r=it.get(Z),kr=it.get(he),br=it.get(_r.__renderTarget),sn=it.get(kr.__renderTarget);Ne.bindFramebuffer(ie.READ_FRAMEBUFFER,br.__webglFramebuffer),Ne.bindFramebuffer(ie.DRAW_FRAMEBUFFER,sn.__webglFramebuffer);for(let Ys=0;Ys<at;Ys++)Sn&&(ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,it.get(Z).__webglTexture,fe,ht+Ys),ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,it.get(he).__webglTexture,Ve,In+Ys)),ie.blitFramebuffer(Pt,Ct,Je,ct,Gt,Wt,Je,ct,ie.DEPTH_BUFFER_BIT,ie.NEAREST);Ne.bindFramebuffer(ie.READ_FRAMEBUFFER,null),Ne.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else if(fe!==0||Z.isRenderTargetTexture||it.has(Z)){const _r=it.get(Z),kr=it.get(he);Ne.bindFramebuffer(ie.READ_FRAMEBUFFER,Bc),Ne.bindFramebuffer(ie.DRAW_FRAMEBUFFER,zc);for(let br=0;br<at;br++)Sn?ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,_r.__webglTexture,fe,ht+br):ie.framebufferTexture2D(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,_r.__webglTexture,fe),zr?ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,kr.__webglTexture,Ve,In+br):ie.framebufferTexture2D(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,kr.__webglTexture,Ve),fe!==0?ie.blitFramebuffer(Pt,Ct,Je,ct,Gt,Wt,Je,ct,ie.COLOR_BUFFER_BIT,ie.NEAREST):zr?ie.copyTexSubImage3D(yn,Ve,Gt,Wt,In+br,Pt,Ct,Je,ct):ie.copyTexSubImage2D(yn,Ve,Gt,Wt,Pt,Ct,Je,ct);Ne.bindFramebuffer(ie.READ_FRAMEBUFFER,null),Ne.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else zr?Z.isDataTexture||Z.isData3DTexture?ie.texSubImage3D(yn,Ve,Gt,Wt,In,Je,ct,at,gn,Tt,wn.data):he.isCompressedArrayTexture?ie.compressedTexSubImage3D(yn,Ve,Gt,Wt,In,Je,ct,at,gn,wn.data):ie.texSubImage3D(yn,Ve,Gt,Wt,In,Je,ct,at,gn,Tt,wn):Z.isDataTexture?ie.texSubImage2D(ie.TEXTURE_2D,Ve,Gt,Wt,Je,ct,gn,Tt,wn.data):Z.isCompressedTexture?ie.compressedTexSubImage2D(ie.TEXTURE_2D,Ve,Gt,Wt,wn.width,wn.height,gn,wn.data):ie.texSubImage2D(ie.TEXTURE_2D,Ve,Gt,Wt,Je,ct,gn,Tt,wn);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,Kt),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,vr),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,Eo),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,ni),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,Ca),Ve===0&&he.generateMipmaps&&ie.generateMipmap(yn),Ne.unbindTexture()},this.copyTextureToTexture3D=function(Z,he,_e=null,ge=null,fe=0){return Ji('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Z,he,_e,ge,fe)},this.initRenderTarget=function(Z){it.get(Z).__webglFramebuffer===void 0&&wt.setupRenderTarget(Z)},this.initTexture=function(Z){Z.isCubeTexture?wt.setTextureCube(Z,0):Z.isData3DTexture?wt.setTexture3D(Z,0):Z.isDataArrayTexture||Z.isCompressedArrayTexture?wt.setTexture2DArray(Z,0):wt.setTexture2D(Z,0),Ne.unbindTexture()},this.resetState=function(){C=0,R=0,F=null,Ne.reset(),Mt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return fi}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Ot._getDrawingBufferColorSpace(e),t.unpackColorSpace=Ot._getUnpackColorSpace()}}const cd=new js,Ka=new je,sD=new ee,ab=new je,F0=new je,cx=new ee,sS=new ee,aD=new Yt,oD=new ee,lD=new ee;let Ti=null,ra=null;const Za=[],pl={NONE:-1,PAN:0,ROTATE:1};class iK extends Jx{constructor(e,t,r=null){super(t,r),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new J3,this.mouseButtons={LEFT:jr.PAN,MIDDLE:jr.PAN,RIGHT:jr.ROTATE},this.touches={ONE:eo.PAN},this._onPointerMove=sK.bind(this),this._onPointerDown=aK.bind(this),this._onPointerCancel=oK.bind(this),this._onContextMenu=lK.bind(this),r!==null&&this.connect(r)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Ka.x=(e.clientX-t.left)/t.width*2-1,Ka.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case jr.PAN:case eo.PAN:this.state=pl.PAN;break;case jr.ROTATE:case eo.ROTATE:this.state=pl.ROTATE;break;default:this.state=pl.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function sK(n){const e=this.object,t=this.domElement,r=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),r.setFromCamera(Ka,e),Ti)this.state===pl.PAN?r.ray.intersectPlane(cd,cx)&&Ti.position.copy(cx.sub(sD).applyMatrix4(aD)):this.state===pl.ROTATE&&(ab.subVectors(Ka,F0).multiplyScalar(this.rotateSpeed),Ti.rotateOnWorldAxis(oD,ab.x),Ti.rotateOnWorldAxis(lD.normalize(),-ab.y)),this.dispatchEvent({type:"drag",object:Ti}),F0.copy(Ka);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(Za.length=0,r.setFromCamera(Ka,e),r.intersectObjects(this.objects,this.recursive,Za),Za.length>0){const i=Za[0].object;cd.setFromNormalAndCoplanarPoint(e.getWorldDirection(cd.normal),sS.setFromMatrixPosition(i.matrixWorld)),ra!==i&&ra!==null&&(this.dispatchEvent({type:"hoveroff",object:ra}),t.style.cursor="auto",ra=null),ra!==i&&(this.dispatchEvent({type:"hoveron",object:i}),t.style.cursor="pointer",ra=i)}else ra!==null&&(this.dispatchEvent({type:"hoveroff",object:ra}),t.style.cursor="auto",ra=null);F0.copy(Ka)}}function aK(n){const e=this.object,t=this.domElement,r=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),Za.length=0,r.setFromCamera(Ka,e),r.intersectObjects(this.objects,this.recursive,Za),Za.length>0&&(this.transformGroup===!0?Ti=cD(Za[0].object):Ti=Za[0].object,cd.setFromNormalAndCoplanarPoint(e.getWorldDirection(cd.normal),sS.setFromMatrixPosition(Ti.matrixWorld)),r.ray.intersectPlane(cd,cx)&&(this.state===pl.PAN?(aD.copy(Ti.parent.matrixWorld).invert(),sD.copy(cx).sub(sS.setFromMatrixPosition(Ti.matrixWorld))):this.state===pl.ROTATE&&(oD.set(0,1,0).applyQuaternion(e.quaternion).normalize(),lD.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Ti})),F0.copy(Ka))}function oK(){this.enabled!==!1&&(Ti&&(this.dispatchEvent({type:"dragend",object:Ti}),Ti=null),this.domElement.style.cursor=ra?"pointer":"auto",this.state=pl.NONE)}function lK(n){this.enabled!==!1&&n.preventDefault()}function cD(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:cD(n.parent,e)}function cK(n,e,t){var r,i=1;n==null&&(n=0),e==null&&(e=0),t==null&&(t=0);function s(){var a,o=r.length,l,u=0,h=0,p=0;for(a=0;a<o;++a)l=r[a],u+=l.x||0,h+=l.y||0,p+=l.z||0;for(u=(u/o-n)*i,h=(h/o-e)*i,p=(p/o-t)*i,a=0;a<o;++a)l=r[a],u&&(l.x-=u),h&&(l.y-=h),p&&(l.z-=p)}return s.initialize=function(a){r=a},s.x=function(a){return arguments.length?(n=+a,s):n},s.y=function(a){return arguments.length?(e=+a,s):e},s.z=function(a){return arguments.length?(t=+a,s):t},s.strength=function(a){return arguments.length?(i=+a,s):i},s}function uK(n){const e=+this._x.call(null,n);return uD(this.cover(e),e,n)}function uD(n,e,t){if(isNaN(e))return n;var r,i=n._root,s={data:t},a=n._x0,o=n._x1,l,u,h,p,m;if(!i)return n._root=s,n;for(;i.length;)if((h=e>=(l=(a+o)/2))?a=l:o=l,r=i,!(i=i[p=+h]))return r[p]=s,n;if(u=+n._x.call(null,i.data),e===u)return s.next=i,r?r[p]=s:n._root=s,n;do r=r?r[p]=new Array(2):n._root=new Array(2),(h=e>=(l=(a+o)/2))?a=l:o=l;while((p=+h)==(m=+(u>=l)));return r[m]=i,r[p]=s,n}function dK(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e);let r=1/0,i=-1/0;for(let s=0,a;s<e;++s)isNaN(a=+this._x.call(null,n[s]))||(t[s]=a,a<r&&(r=a),a>i&&(i=a));if(r>i)return this;this.cover(r).cover(i);for(let s=0;s<e;++s)uD(this,t[s],n[s]);return this}function hK(n){if(isNaN(n=+n))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(n))+1;else{for(var r=t-e||1,i=this._root,s,a;e>n||n>=t;)switch(a=+(n<e),s=new Array(2),s[a]=i,i=s,r*=2,a){case 0:t=e+r;break;case 1:e=t-r;break}this._root&&this._root.length&&(this._root=i)}return this._x0=e,this._x1=t,this}function fK(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function pK(n){return arguments.length?this.cover(+n[0][0]).cover(+n[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function co(n,e,t){this.node=n,this.x0=e,this.x1=t}function mK(n,e){var t,r=this._x0,i,s,a=this._x1,o=[],l=this._root,u,h;for(l&&o.push(new co(l,r,a)),e==null?e=1/0:(r=n-e,a=n+e);u=o.pop();)if(!(!(l=u.node)||(i=u.x0)>a||(s=u.x1)<r))if(l.length){var p=(i+s)/2;o.push(new co(l[1],p,s),new co(l[0],i,p)),(h=+(n>=p))&&(u=o[o.length-1],o[o.length-1]=o[o.length-1-h],o[o.length-1-h]=u)}else{var m=Math.abs(n-+this._x.call(null,l.data));m<e&&(e=m,r=n-m,a=n+m,t=l.data)}return t}function gK(n){if(isNaN(l=+this._x.call(null,n)))return this;var e,t=this._root,r,i,s,a=this._x0,o=this._x1,l,u,h,p,m;if(!t)return this;if(t.length)for(;;){if((h=l>=(u=(a+o)/2))?a=u:o=u,e=t,!(t=t[p=+h]))return this;if(!t.length)break;e[p+1&1]&&(r=e,m=p)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[p]=s:delete e[p],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(r?r[m]=t:this._root=t),this):(this._root=s,this)}function xK(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function yK(){return this._root}function vK(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function _K(n){var e=[],t,r=this._root,i,s,a;for(r&&e.push(new co(r,this._x0,this._x1));t=e.pop();)if(!n(r=t.node,s=t.x0,a=t.x1)&&r.length){var o=(s+a)/2;(i=r[1])&&e.push(new co(i,o,a)),(i=r[0])&&e.push(new co(i,s,o))}return this}function bK(n){var e=[],t=[],r;for(this._root&&e.push(new co(this._root,this._x0,this._x1));r=e.pop();){var i=r.node;if(i.length){var s,a=r.x0,o=r.x1,l=(a+o)/2;(s=i[0])&&e.push(new co(s,a,l)),(s=i[1])&&e.push(new co(s,l,o))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.x1);return this}function wK(n){return n[0]}function SK(n){return arguments.length?(this._x=n,this):this._x}function dD(n,e){var t=new aT(e??wK,NaN,NaN);return n==null?t:t.addAll(n)}function aT(n,e,t){this._x=n,this._x0=e,this._x1=t,this._root=void 0}function BA(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Ii=dD.prototype=aT.prototype;Ii.copy=function(){var n=new aT(this._x,this._x0,this._x1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=BA(e),n;for(t=[{source:e,target:n._root=new Array(2)}];e=t.pop();)for(var i=0;i<2;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(2)}):e.target[i]=BA(r));return n};Ii.add=uK;Ii.addAll=dK;Ii.cover=hK;Ii.data=fK;Ii.extent=pK;Ii.find=mK;Ii.remove=gK;Ii.removeAll=xK;Ii.root=yK;Ii.size=vK;Ii.visit=_K;Ii.visitAfter=bK;Ii.x=SK;function TK(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return hD(this.cover(e,t),e,t,n)}function hD(n,e,t,r){if(isNaN(e)||isNaN(t))return n;var i,s=n._root,a={data:r},o=n._x0,l=n._y0,u=n._x1,h=n._y1,p,m,g,y,b,_,x,N;if(!s)return n._root=a,n;for(;s.length;)if((b=e>=(p=(o+u)/2))?o=p:u=p,(_=t>=(m=(l+h)/2))?l=m:h=m,i=s,!(s=s[x=_<<1|b]))return i[x]=a,n;if(g=+n._x.call(null,s.data),y=+n._y.call(null,s.data),e===g&&t===y)return a.next=s,i?i[x]=a:n._root=a,n;do i=i?i[x]=new Array(4):n._root=new Array(4),(b=e>=(p=(o+u)/2))?o=p:u=p,(_=t>=(m=(l+h)/2))?l=m:h=m;while((x=_<<1|b)===(N=(y>=m)<<1|g>=p));return i[N]=s,i[x]=a,n}function NK(n){var e,t,r=n.length,i,s,a=new Array(r),o=new Array(r),l=1/0,u=1/0,h=-1/0,p=-1/0;for(t=0;t<r;++t)isNaN(i=+this._x.call(null,e=n[t]))||isNaN(s=+this._y.call(null,e))||(a[t]=i,o[t]=s,i<l&&(l=i),i>h&&(h=i),s<u&&(u=s),s>p&&(p=s));if(l>h||u>p)return this;for(this.cover(l,u).cover(h,p),t=0;t<r;++t)hD(this,a[t],o[t],n[t]);return this}function EK(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(t))i=(t=Math.floor(n))+1,s=(r=Math.floor(e))+1;else{for(var a=i-t||1,o=this._root,l,u;t>n||n>=i||r>e||e>=s;)switch(u=(e<r)<<1|n<t,l=new Array(4),l[u]=o,o=l,a*=2,u){case 0:i=t+a,s=r+a;break;case 1:t=i-a,s=r+a;break;case 2:i=t+a,r=s-a;break;case 3:t=i-a,r=s-a;break}this._root&&this._root.length&&(this._root=o)}return this._x0=t,this._y0=r,this._x1=i,this._y1=s,this}function MK(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function CK(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function hi(n,e,t,r,i){this.node=n,this.x0=e,this.y0=t,this.x1=r,this.y1=i}function AK(n,e,t){var r,i=this._x0,s=this._y0,a,o,l,u,h=this._x1,p=this._y1,m=[],g=this._root,y,b;for(g&&m.push(new hi(g,i,s,h,p)),t==null?t=1/0:(i=n-t,s=e-t,h=n+t,p=e+t,t*=t);y=m.pop();)if(!(!(g=y.node)||(a=y.x0)>h||(o=y.y0)>p||(l=y.x1)<i||(u=y.y1)<s))if(g.length){var _=(a+l)/2,x=(o+u)/2;m.push(new hi(g[3],_,x,l,u),new hi(g[2],a,x,_,u),new hi(g[1],_,o,l,x),new hi(g[0],a,o,_,x)),(b=(e>=x)<<1|n>=_)&&(y=m[m.length-1],m[m.length-1]=m[m.length-1-b],m[m.length-1-b]=y)}else{var N=n-+this._x.call(null,g.data),T=e-+this._y.call(null,g.data),S=N*N+T*T;if(S<t){var M=Math.sqrt(t=S);i=n-M,s=e-M,h=n+M,p=e+M,r=g.data}}return r}function RK(n){if(isNaN(h=+this._x.call(null,n))||isNaN(p=+this._y.call(null,n)))return this;var e,t=this._root,r,i,s,a=this._x0,o=this._y0,l=this._x1,u=this._y1,h,p,m,g,y,b,_,x;if(!t)return this;if(t.length)for(;;){if((y=h>=(m=(a+l)/2))?a=m:l=m,(b=p>=(g=(o+u)/2))?o=g:u=g,e=t,!(t=t[_=b<<1|y]))return this;if(!t.length)break;(e[_+1&3]||e[_+2&3]||e[_+3&3])&&(r=e,x=_)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[_]=s:delete e[_],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[x]=t:this._root=t),this):(this._root=s,this)}function PK(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function kK(){return this._root}function LK(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function DK(n){var e=[],t,r=this._root,i,s,a,o,l;for(r&&e.push(new hi(r,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(r=t.node,s=t.x0,a=t.y0,o=t.x1,l=t.y1)&&r.length){var u=(s+o)/2,h=(a+l)/2;(i=r[3])&&e.push(new hi(i,u,h,o,l)),(i=r[2])&&e.push(new hi(i,s,h,u,l)),(i=r[1])&&e.push(new hi(i,u,a,o,h)),(i=r[0])&&e.push(new hi(i,s,a,u,h))}return this}function IK(n){var e=[],t=[],r;for(this._root&&e.push(new hi(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,a=r.x0,o=r.y0,l=r.x1,u=r.y1,h=(a+l)/2,p=(o+u)/2;(s=i[0])&&e.push(new hi(s,a,o,h,p)),(s=i[1])&&e.push(new hi(s,h,o,l,p)),(s=i[2])&&e.push(new hi(s,a,p,h,u)),(s=i[3])&&e.push(new hi(s,h,p,l,u))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.x1,r.y1);return this}function jK(n){return n[0]}function FK(n){return arguments.length?(this._x=n,this):this._x}function OK(n){return n[1]}function UK(n){return arguments.length?(this._y=n,this):this._y}function fD(n,e,t){var r=new oT(e??jK,t??OK,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function oT(n,e,t,r,i,s){this._x=n,this._y=e,this._x0=t,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function zA(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var gi=fD.prototype=oT.prototype;gi.copy=function(){var n=new oT(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=zA(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=zA(r));return n};gi.add=TK;gi.addAll=NK;gi.cover=EK;gi.data=MK;gi.extent=CK;gi.find=AK;gi.remove=RK;gi.removeAll=PK;gi.root=kK;gi.size=LK;gi.visit=DK;gi.visitAfter=IK;gi.x=FK;gi.y=UK;function BK(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),r=+this._z.call(null,n);return pD(this.cover(e,t,r),e,t,r,n)}function pD(n,e,t,r,i){if(isNaN(e)||isNaN(t)||isNaN(r))return n;var s,a=n._root,o={data:i},l=n._x0,u=n._y0,h=n._z0,p=n._x1,m=n._y1,g=n._z1,y,b,_,x,N,T,S,M,C,R,F;if(!a)return n._root=o,n;for(;a.length;)if((S=e>=(y=(l+p)/2))?l=y:p=y,(M=t>=(b=(u+m)/2))?u=b:m=b,(C=r>=(_=(h+g)/2))?h=_:g=_,s=a,!(a=a[R=C<<2|M<<1|S]))return s[R]=o,n;if(x=+n._x.call(null,a.data),N=+n._y.call(null,a.data),T=+n._z.call(null,a.data),e===x&&t===N&&r===T)return o.next=a,s?s[R]=o:n._root=o,n;do s=s?s[R]=new Array(8):n._root=new Array(8),(S=e>=(y=(l+p)/2))?l=y:p=y,(M=t>=(b=(u+m)/2))?u=b:m=b,(C=r>=(_=(h+g)/2))?h=_:g=_;while((R=C<<2|M<<1|S)===(F=(T>=_)<<2|(N>=b)<<1|x>=y));return s[F]=a,s[R]=o,n}function zK(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,h=-1/0;for(let p=0,m,g,y,b;p<e;++p)isNaN(g=+this._x.call(null,m=n[p]))||isNaN(y=+this._y.call(null,m))||isNaN(b=+this._z.call(null,m))||(t[p]=g,r[p]=y,i[p]=b,g<s&&(s=g),g>l&&(l=g),y<a&&(a=y),y>u&&(u=y),b<o&&(o=b),b>h&&(h=b));if(s>l||a>u||o>h)return this;this.cover(s,a,o).cover(l,u,h);for(let p=0;p<e;++p)pD(this,t[p],r[p],i[p],n[p]);return this}function VK(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,i=this._y0,s=this._z0,a=this._x1,o=this._y1,l=this._z1;if(isNaN(r))a=(r=Math.floor(n))+1,o=(i=Math.floor(e))+1,l=(s=Math.floor(t))+1;else{for(var u=a-r||1,h=this._root,p,m;r>n||n>=a||i>e||e>=o||s>t||t>=l;)switch(m=(t<s)<<2|(e<i)<<1|n<r,p=new Array(8),p[m]=h,h=p,u*=2,m){case 0:a=r+u,o=i+u,l=s+u;break;case 1:r=a-u,o=i+u,l=s+u;break;case 2:a=r+u,i=o-u,l=s+u;break;case 3:r=a-u,i=o-u,l=s+u;break;case 4:a=r+u,o=i+u,s=l-u;break;case 5:r=a-u,o=i+u,s=l-u;break;case 6:a=r+u,i=o-u,s=l-u;break;case 7:r=a-u,i=o-u,s=l-u;break}this._root&&this._root.length&&(this._root=h)}return this._x0=r,this._y0=i,this._z0=s,this._x1=a,this._y1=o,this._z1=l,this}function GK(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function HK(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function Tn(n,e,t,r,i,s,a){this.node=n,this.x0=e,this.y0=t,this.z0=r,this.x1=i,this.y1=s,this.z1=a}function $K(n,e,t,r){var i,s=this._x0,a=this._y0,o=this._z0,l,u,h,p,m,g,y=this._x1,b=this._y1,_=this._z1,x=[],N=this._root,T,S;for(N&&x.push(new Tn(N,s,a,o,y,b,_)),r==null?r=1/0:(s=n-r,a=e-r,o=t-r,y=n+r,b=e+r,_=t+r,r*=r);T=x.pop();)if(!(!(N=T.node)||(l=T.x0)>y||(u=T.y0)>b||(h=T.z0)>_||(p=T.x1)<s||(m=T.y1)<a||(g=T.z1)<o))if(N.length){var M=(l+p)/2,C=(u+m)/2,R=(h+g)/2;x.push(new Tn(N[7],M,C,R,p,m,g),new Tn(N[6],l,C,R,M,m,g),new Tn(N[5],M,u,R,p,C,g),new Tn(N[4],l,u,R,M,C,g),new Tn(N[3],M,C,h,p,m,R),new Tn(N[2],l,C,h,M,m,R),new Tn(N[1],M,u,h,p,C,R),new Tn(N[0],l,u,h,M,C,R)),(S=(t>=R)<<2|(e>=C)<<1|n>=M)&&(T=x[x.length-1],x[x.length-1]=x[x.length-1-S],x[x.length-1-S]=T)}else{var F=n-+this._x.call(null,N.data),k=e-+this._y.call(null,N.data),D=t-+this._z.call(null,N.data),P=F*F+k*k+D*D;if(P<r){var G=Math.sqrt(r=P);s=n-G,a=e-G,o=t-G,y=n+G,b=e+G,_=t+G,i=N.data}}return i}const WK=(n,e,t,r,i,s)=>Math.sqrt((n-r)**2+(e-i)**2+(t-s)**2);function qK(n,e,t,r){const i=[],s=n-r,a=e-r,o=t-r,l=n+r,u=e+r,h=t+r;return this.visit((p,m,g,y,b,_,x)=>{if(!p.length)do{const N=p.data;WK(n,e,t,this._x(N),this._y(N),this._z(N))<=r&&i.push(N)}while(p=p.next);return m>l||g>u||y>h||b<s||_<a||x<o}),i}function XK(n){if(isNaN(m=+this._x.call(null,n))||isNaN(g=+this._y.call(null,n))||isNaN(y=+this._z.call(null,n)))return this;var e,t=this._root,r,i,s,a=this._x0,o=this._y0,l=this._z0,u=this._x1,h=this._y1,p=this._z1,m,g,y,b,_,x,N,T,S,M,C;if(!t)return this;if(t.length)for(;;){if((N=m>=(b=(a+u)/2))?a=b:u=b,(T=g>=(_=(o+h)/2))?o=_:h=_,(S=y>=(x=(l+p)/2))?l=x:p=x,e=t,!(t=t[M=S<<2|T<<1|N]))return this;if(!t.length)break;(e[M+1&7]||e[M+2&7]||e[M+3&7]||e[M+4&7]||e[M+5&7]||e[M+6&7]||e[M+7&7])&&(r=e,C=M)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[M]=s:delete e[M],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[C]=t:this._root=t),this):(this._root=s,this)}function YK(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function KK(){return this._root}function ZK(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function QK(n){var e=[],t,r=this._root,i,s,a,o,l,u,h;for(r&&e.push(new Tn(r,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(r=t.node,s=t.x0,a=t.y0,o=t.z0,l=t.x1,u=t.y1,h=t.z1)&&r.length){var p=(s+l)/2,m=(a+u)/2,g=(o+h)/2;(i=r[7])&&e.push(new Tn(i,p,m,g,l,u,h)),(i=r[6])&&e.push(new Tn(i,s,m,g,p,u,h)),(i=r[5])&&e.push(new Tn(i,p,a,g,l,m,h)),(i=r[4])&&e.push(new Tn(i,s,a,g,p,m,h)),(i=r[3])&&e.push(new Tn(i,p,m,o,l,u,g)),(i=r[2])&&e.push(new Tn(i,s,m,o,p,u,g)),(i=r[1])&&e.push(new Tn(i,p,a,o,l,m,g)),(i=r[0])&&e.push(new Tn(i,s,a,o,p,m,g))}return this}function JK(n){var e=[],t=[],r;for(this._root&&e.push(new Tn(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=e.pop();){var i=r.node;if(i.length){var s,a=r.x0,o=r.y0,l=r.z0,u=r.x1,h=r.y1,p=r.z1,m=(a+u)/2,g=(o+h)/2,y=(l+p)/2;(s=i[0])&&e.push(new Tn(s,a,o,l,m,g,y)),(s=i[1])&&e.push(new Tn(s,m,o,l,u,g,y)),(s=i[2])&&e.push(new Tn(s,a,g,l,m,h,y)),(s=i[3])&&e.push(new Tn(s,m,g,l,u,h,y)),(s=i[4])&&e.push(new Tn(s,a,o,y,m,g,p)),(s=i[5])&&e.push(new Tn(s,m,o,y,u,g,p)),(s=i[6])&&e.push(new Tn(s,a,g,y,m,h,p)),(s=i[7])&&e.push(new Tn(s,m,g,y,u,h,p))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.z0,r.x1,r.y1,r.z1);return this}function eZ(n){return n[0]}function tZ(n){return arguments.length?(this._x=n,this):this._x}function nZ(n){return n[1]}function rZ(n){return arguments.length?(this._y=n,this):this._y}function iZ(n){return n[2]}function sZ(n){return arguments.length?(this._z=n,this):this._z}function mD(n,e,t,r){var i=new lT(e??eZ,t??nZ,r??iZ,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function lT(n,e,t,r,i,s,a,o,l){this._x=n,this._y=e,this._z=t,this._x0=r,this._y0=i,this._z0=s,this._x1=a,this._y1=o,this._z1=l,this._root=void 0}function VA(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Ur=mD.prototype=lT.prototype;Ur.copy=function(){var n=new lT(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=VA(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var i=0;i<8;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(8)}):e.target[i]=VA(r));return n};Ur.add=BK;Ur.addAll=zK;Ur.cover=VK;Ur.data=GK;Ur.extent=HK;Ur.find=$K;Ur.findAllWithinRadius=qK;Ur.remove=XK;Ur.removeAll=YK;Ur.root=KK;Ur.size=ZK;Ur.visit=QK;Ur.visitAfter=JK;Ur.x=tZ;Ur.y=rZ;Ur.z=sZ;function ro(n){return function(){return n}}function qa(n){return(n()-.5)*1e-6}function aZ(n){return n.index}function GA(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function oZ(n){var e=aZ,t=m,r,i=ro(30),s,a,o,l,u,h,p=1;n==null&&(n=[]);function m(x){return 1/Math.min(l[x.source.index],l[x.target.index])}function g(x){for(var N=0,T=n.length;N<p;++N)for(var S=0,M,C,R,F=0,k=0,D=0,P,G;S<T;++S)M=n[S],C=M.source,R=M.target,F=R.x+R.vx-C.x-C.vx||qa(h),o>1&&(k=R.y+R.vy-C.y-C.vy||qa(h)),o>2&&(D=R.z+R.vz-C.z-C.vz||qa(h)),P=Math.sqrt(F*F+k*k+D*D),P=(P-s[S])/P*x*r[S],F*=P,k*=P,D*=P,R.vx-=F*(G=u[S]),o>1&&(R.vy-=k*G),o>2&&(R.vz-=D*G),C.vx+=F*(G=1-G),o>1&&(C.vy+=k*G),o>2&&(C.vz+=D*G)}function y(){if(a){var x,N=a.length,T=n.length,S=new Map(a.map((C,R)=>[e(C,R,a),C])),M;for(x=0,l=new Array(N);x<T;++x)M=n[x],M.index=x,typeof M.source!="object"&&(M.source=GA(S,M.source)),typeof M.target!="object"&&(M.target=GA(S,M.target)),l[M.source.index]=(l[M.source.index]||0)+1,l[M.target.index]=(l[M.target.index]||0)+1;for(x=0,u=new Array(T);x<T;++x)M=n[x],u[x]=l[M.source.index]/(l[M.source.index]+l[M.target.index]);r=new Array(T),b(),s=new Array(T),_()}}function b(){if(a)for(var x=0,N=n.length;x<N;++x)r[x]=+t(n[x],x,n)}function _(){if(a)for(var x=0,N=n.length;x<N;++x)s[x]=+i(n[x],x,n)}return g.initialize=function(x,...N){a=x,h=N.find(T=>typeof T=="function")||Math.random,o=N.find(T=>[1,2,3].includes(T))||2,y()},g.links=function(x){return arguments.length?(n=x,y(),g):n},g.id=function(x){return arguments.length?(e=x,g):e},g.iterations=function(x){return arguments.length?(p=+x,g):p},g.strength=function(x){return arguments.length?(t=typeof x=="function"?x:ro(+x),b(),g):t},g.distance=function(x){return arguments.length?(i=typeof x=="function"?x:ro(+x),_(),g):i},g}const lZ=1664525,cZ=1013904223,HA=4294967296;function uZ(){let n=1;return()=>(n=(lZ*n+cZ)%HA)/HA}var $A=3;function ob(n){return n.x}function WA(n){return n.y}function dZ(n){return n.z}var hZ=10,fZ=Math.PI*(3-Math.sqrt(5)),pZ=Math.PI*20/(9+Math.sqrt(221));function mZ(n,e){e=e||2;var t=Math.min($A,Math.max(1,Math.round(e))),r,i=1,s=.001,a=1-Math.pow(s,1/300),o=0,l=.6,u=new Map,h=o1(g),p=Gp("tick","end"),m=uZ();n==null&&(n=[]);function g(){y(),p.call("tick",r),i<s&&(h.stop(),p.call("end",r))}function y(x){var N,T=n.length,S;x===void 0&&(x=1);for(var M=0;M<x;++M)for(i+=(o-i)*a,u.forEach(function(C){C(i)}),N=0;N<T;++N)S=n[N],S.fx==null?S.x+=S.vx*=l:(S.x=S.fx,S.vx=0),t>1&&(S.fy==null?S.y+=S.vy*=l:(S.y=S.fy,S.vy=0)),t>2&&(S.fz==null?S.z+=S.vz*=l:(S.z=S.fz,S.vz=0));return r}function b(){for(var x=0,N=n.length,T;x<N;++x){if(T=n[x],T.index=x,T.fx!=null&&(T.x=T.fx),T.fy!=null&&(T.y=T.fy),T.fz!=null&&(T.z=T.fz),isNaN(T.x)||t>1&&isNaN(T.y)||t>2&&isNaN(T.z)){var S=hZ*(t>2?Math.cbrt(.5+x):t>1?Math.sqrt(.5+x):x),M=x*fZ,C=x*pZ;t===1?T.x=S:t===2?(T.x=S*Math.cos(M),T.y=S*Math.sin(M)):(T.x=S*Math.sin(M)*Math.cos(C),T.y=S*Math.cos(M),T.z=S*Math.sin(M)*Math.sin(C))}(isNaN(T.vx)||t>1&&isNaN(T.vy)||t>2&&isNaN(T.vz))&&(T.vx=0,t>1&&(T.vy=0),t>2&&(T.vz=0))}}function _(x){return x.initialize&&x.initialize(n,m,t),x}return b(),r={tick:y,restart:function(){return h.restart(g),r},stop:function(){return h.stop(),r},numDimensions:function(x){return arguments.length?(t=Math.min($A,Math.max(1,Math.round(x))),u.forEach(_),r):t},nodes:function(x){return arguments.length?(n=x,b(),u.forEach(_),r):n},alpha:function(x){return arguments.length?(i=+x,r):i},alphaMin:function(x){return arguments.length?(s=+x,r):s},alphaDecay:function(x){return arguments.length?(a=+x,r):+a},alphaTarget:function(x){return arguments.length?(o=+x,r):o},velocityDecay:function(x){return arguments.length?(l=1-x,r):1-l},randomSource:function(x){return arguments.length?(m=x,u.forEach(_),r):m},force:function(x,N){return arguments.length>1?(N==null?u.delete(x):u.set(x,_(N)),r):u.get(x)},find:function(){var x=Array.prototype.slice.call(arguments),N=x.shift()||0,T=(t>1?x.shift():null)||0,S=(t>2?x.shift():null)||0,M=x.shift()||1/0,C=0,R=n.length,F,k,D,P,G,$;for(M*=M,C=0;C<R;++C)G=n[C],F=N-G.x,k=T-(G.y||0),D=S-(G.z||0),P=F*F+k*k+D*D,P<M&&($=G,M=P);return $},on:function(x,N){return arguments.length>1?(p.on(x,N),r):p.on(x)}}}function gZ(){var n,e,t,r,i,s=ro(-30),a,o=1,l=1/0,u=.81;function h(y){var b,_=n.length,x=(e===1?dD(n,ob):e===2?fD(n,ob,WA):e===3?mD(n,ob,WA,dZ):null).visitAfter(m);for(i=y,b=0;b<_;++b)t=n[b],x.visit(g)}function p(){if(n){var y,b=n.length,_;for(a=new Array(b),y=0;y<b;++y)_=n[y],a[_.index]=+s(_,y,n)}}function m(y){var b=0,_,x,N=0,T,S,M,C,R=y.length;if(R){for(T=S=M=C=0;C<R;++C)(_=y[C])&&(x=Math.abs(_.value))&&(b+=_.value,N+=x,T+=x*(_.x||0),S+=x*(_.y||0),M+=x*(_.z||0));b*=Math.sqrt(4/R),y.x=T/N,e>1&&(y.y=S/N),e>2&&(y.z=M/N)}else{_=y,_.x=_.data.x,e>1&&(_.y=_.data.y),e>2&&(_.z=_.data.z);do b+=a[_.data.index];while(_=_.next)}y.value=b}function g(y,b,_,x,N){if(!y.value)return!0;var T=[_,x,N][e-1],S=y.x-t.x,M=e>1?y.y-t.y:0,C=e>2?y.z-t.z:0,R=T-b,F=S*S+M*M+C*C;if(R*R/u<F)return F<l&&(S===0&&(S=qa(r),F+=S*S),e>1&&M===0&&(M=qa(r),F+=M*M),e>2&&C===0&&(C=qa(r),F+=C*C),F<o&&(F=Math.sqrt(o*F)),t.vx+=S*y.value*i/F,e>1&&(t.vy+=M*y.value*i/F),e>2&&(t.vz+=C*y.value*i/F)),!0;if(y.length||F>=l)return;(y.data!==t||y.next)&&(S===0&&(S=qa(r),F+=S*S),e>1&&M===0&&(M=qa(r),F+=M*M),e>2&&C===0&&(C=qa(r),F+=C*C),F<o&&(F=Math.sqrt(o*F)));do y.data!==t&&(R=a[y.data.index]*i/F,t.vx+=S*R,e>1&&(t.vy+=M*R),e>2&&(t.vz+=C*R));while(y=y.next)}return h.initialize=function(y,...b){n=y,r=b.find(_=>typeof _=="function")||Math.random,e=b.find(_=>[1,2,3].includes(_))||2,p()},h.strength=function(y){return arguments.length?(s=typeof y=="function"?y:ro(+y),p(),h):s},h.distanceMin=function(y){return arguments.length?(o=y*y,h):Math.sqrt(o)},h.distanceMax=function(y){return arguments.length?(l=y*y,h):Math.sqrt(l)},h.theta=function(y){return arguments.length?(u=y*y,h):Math.sqrt(u)},h}function xZ(n,e,t,r){var i,s,a=ro(.1),o,l;typeof n!="function"&&(n=ro(+n)),e==null&&(e=0),t==null&&(t=0),r==null&&(r=0);function u(p){for(var m=0,g=i.length;m<g;++m){var y=i[m],b=y.x-e||1e-6,_=(y.y||0)-t||1e-6,x=(y.z||0)-r||1e-6,N=Math.sqrt(b*b+_*_+x*x),T=(l[m]-N)*o[m]*p/N;y.vx+=b*T,s>1&&(y.vy+=_*T),s>2&&(y.vz+=x*T)}}function h(){if(i){var p,m=i.length;for(o=new Array(m),l=new Array(m),p=0;p<m;++p)l[p]=+n(i[p],p,i),o[p]=isNaN(l[p])?0:+a(i[p],p,i)}}return u.initialize=function(p,...m){i=p,s=m.find(g=>[1,2,3].includes(g))||2,h()},u.strength=function(p){return arguments.length?(a=typeof p=="function"?p:ro(+p),h(),u):a},u.radius=function(p){return arguments.length?(n=typeof p=="function"?p:ro(+p),h(),u):n},u.x=function(p){return arguments.length?(e=+p,u):e},u.y=function(p){return arguments.length?(t=+p,u):t},u.z=function(p){return arguments.length?(r=+p,u):r},u}var lb,qA;function cT(){if(qA)return lb;qA=1,lb=function(r){e(r);var i=n(r);return r.on=i.on,r.off=i.off,r.fire=i.fire,r};function n(t){var r=Object.create(null);return{on:function(i,s,a){if(typeof s!="function")throw new Error("callback is expected to be a function");var o=r[i];return o||(o=r[i]=[]),o.push({callback:s,ctx:a}),t},off:function(i,s){var a=typeof i>"u";if(a)return r=Object.create(null),t;if(r[i]){var o=typeof s!="function";if(o)delete r[i];else for(var l=r[i],u=0;u<l.length;++u)l[u].callback===s&&l.splice(u,1)}return t},fire:function(i){var s=r[i];if(!s)return t;var a;arguments.length>1&&(a=Array.prototype.splice.call(arguments,1));for(var o=0;o<s.length;++o){var l=s[o];l.callback.apply(l.ctx,a)}return t}}}function e(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var r=["on","fire","off"],i=0;i<r.length;++i)if(t.hasOwnProperty(r[i]))throw new Error("Subject cannot be eventified, since it already has property '"+r[i]+"'")}return lb}var cb,XA;function yZ(){if(XA)return cb;XA=1,cb=e;var n=cT();function e(a){if(a=a||{},"uniqueLinkId"in a&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),a.multigraph=a.uniqueLinkId),a.multigraph===void 0&&(a.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var o=new Map,l=new Map,u={},h=0,p=a.multigraph?D:k,m=[],g=Y,y=Y,b=Y,_=Y,x={version:20,addNode:M,addLink:F,removeLink:U,removeNode:R,getNode:C,getNodeCount:P,getLinkCount:G,getEdgeCount:G,getLinksCount:G,getNodesCount:P,getLinks:$,forEachNode:q,forEachLinkedNode:B,forEachLink:L,beginUpdate:b,endUpdate:_,clear:j,hasLink:O,hasNode:C,getLink:O};return n(x),N(),x;function N(){var Q=x.on;x.on=te;function te(){return x.beginUpdate=b=se,x.endUpdate=_=J,g=T,y=S,x.on=Q,Q.apply(x,arguments)}}function T(Q,te){m.push({link:Q,changeType:te})}function S(Q,te){m.push({node:Q,changeType:te})}function M(Q,te){if(Q===void 0)throw new Error("Invalid node identifier");b();var X=C(Q);return X?(X.data=te,y(X,"update")):(X=new t(Q,te),y(X,"add")),o.set(Q,X),_(),X}function C(Q){return o.get(Q)}function R(Q){var te=C(Q);if(!te)return!1;b();var X=te.links;return X&&(X.forEach(K),te.links=null),o.delete(Q),y(te,"remove"),_(),!0}function F(Q,te,X){b();var ce=C(Q)||M(Q),me=C(te)||M(te),Re=p(Q,te,X),He=l.has(Re.id);return l.set(Re.id,Re),r(ce,Re),Q!==te&&r(me,Re),g(Re,He?"update":"add"),_(),Re}function k(Q,te,X){var ce=s(Q,te),me=l.get(ce);return me?(me.data=X,me):new i(Q,te,X,ce)}function D(Q,te,X){var ce=s(Q,te),me=u.hasOwnProperty(ce);if(me||O(Q,te)){me||(u[ce]=0);var Re="@"+ ++u[ce];ce=s(Q+Re,te+Re)}return new i(Q,te,X,ce)}function P(){return o.size}function G(){return l.size}function $(Q){var te=C(Q);return te?te.links:null}function U(Q,te){return te!==void 0&&(Q=O(Q,te)),K(Q)}function K(Q){if(!Q||!l.get(Q.id))return!1;b(),l.delete(Q.id);var te=C(Q.fromId),X=C(Q.toId);return te&&te.links.delete(Q),X&&X.links.delete(Q),g(Q,"remove"),_(),!0}function O(Q,te){if(!(Q===void 0||te===void 0))return l.get(s(Q,te))}function j(){b(),q(function(Q){R(Q.id)}),_()}function L(Q){if(typeof Q=="function")for(var te=l.values(),X=te.next();!X.done;){if(Q(X.value))return!0;X=te.next()}}function B(Q,te,X){var ce=C(Q);if(ce&&ce.links&&typeof te=="function")return X?z(ce.links,Q,te):V(ce.links,Q,te)}function V(Q,te,X){for(var ce,me=Q.values(),Re=me.next();!Re.done;){var He=Re.value,Qe=He.fromId===te?He.toId:He.fromId;if(ce=X(o.get(Qe),He),ce)return!0;Re=me.next()}}function z(Q,te,X){for(var ce,me=Q.values(),Re=me.next();!Re.done;){var He=Re.value;if(He.fromId===te&&(ce=X(o.get(He.toId),He),ce))return!0;Re=me.next()}}function Y(){}function se(){h+=1}function J(){h-=1,h===0&&m.length>0&&(x.fire("changed",m),m.length=0)}function q(Q){if(typeof Q!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+Q);for(var te=o.values(),X=te.next();!X.done;){if(Q(X.value))return!0;X=te.next()}}}function t(a,o){this.id=a,this.links=null,this.data=o}function r(a,o){a.links?a.links.add(o):a.links=new Set([o])}function i(a,o,l,u){this.fromId=a,this.toId=o,this.data=l,this.id=u}function s(a,o){return a.toString()+" "+o.toString()}return cb}var vZ=yZ();const _Z=Kd(vZ);var Xg={exports:{}},ku={exports:{}},ub,YA;function gD(){return YA||(YA=1,ub=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)}),ub}var db,KA;function ah(){if(KA)return db;KA=1;const n=gD();return db=function(t){return r;function r(i,s){let a=s&&s.indent||0,o=s&&s.join!==void 0?s.join:`
`,l=Array(a+1).join(" "),u=[];for(let h=0;h<t;++h){let p=n(h),m=h===0?"":l;u.push(m+i.replace(/{var}/g,p))}return u.join(o)}},db}var ZA;function bZ(){if(ZA)return ku.exports;ZA=1;const n=ah();ku.exports=e,ku.exports.generateCreateBodyFunctionBody=t,ku.exports.getVectorCode=i,ku.exports.getBodyCode=r;function e(s,a){let o=t(s,a),{Body:l}=new Function(o)();return l}function t(s,a){return`
${i(s,a)}
${r(s)}
return {Body: Body, Vector: Vector};
`}function r(s){let a=n(s),o=a("{var}",{join:", "});return`
function Body(${o}) {
  this.isPinned = false;
  this.pos = new Vector(${o});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${o}) {
  ${a("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function i(s,a){let o=n(s),l="";return a&&(l=`${o(`
	   var v{var};
	Object.defineProperty(this, '{var}', {
	  set: function(v) { 
	    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
	    v{var} = v; 
	  },
	  get: function() { return v{var}; }
	});`)}`),`function Vector(${o("{var}",{join:", "})}) {
  ${l}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${o('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${o("this.{var} = v.{var};",{indent:4})}
    } else {
      ${o('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${o("this.{var} = ",{join:""})}0;
  };`}return ku.exports}var Ga={exports:{}},QA;function wZ(){if(QA)return Ga.exports;QA=1;const n=ah(),e=gD();Ga.exports=t,Ga.exports.generateQuadTreeFunctionBody=r,Ga.exports.getInsertStackCode=l,Ga.exports.getQuadNodeCode=o,Ga.exports.isSamePosition=i,Ga.exports.getChildBodyCode=a,Ga.exports.setChildBodyCode=s;function t(u){let h=r(u);return new Function(h)()}function r(u){let h=n(u),p=Math.pow(2,u);return`
${l()}
${o(u)}
${i(u)}
${a(u)}
${s(u)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${b("      node.")}
      node.body = null;
      node.mass = ${h("node.mass_{var} = ",{join:""})}0;
      ${h("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${h("var d{var};",{indent:4})}
    var r; 
    ${h("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${h("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${h("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${h("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${h("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${h("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${h("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${h("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${h("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${h("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < , treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${h("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${y()}
        }
      }
    }

    ${h("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${h("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${h("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${h("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${h("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${h("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${h("root.min_{var} = {var}min;",{indent:4})}
    ${h("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${h("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${h("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${h("var min_{var} = node.min_{var};",{indent:8})}
        ${h("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${g(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${h("child.min_{var} = min_{var};",{indent:10})}
          ${h("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${h("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${h("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function g(_){let x=[],N=Array(_+1).join(" ");for(let T=0;T<u;++T)x.push(N+`if (${e(T)} > max_${e(T)}) {`),x.push(N+`  quadIdx = quadIdx + ${Math.pow(2,T)};`),x.push(N+`  min_${e(T)} = max_${e(T)};`),x.push(N+`  max_${e(T)} = node.max_${e(T)};`),x.push(N+"}");return x.join(`
`)}function y(){let _=Array(11).join(" "),x=[];for(let N=0;N<p;++N)x.push(_+`if (node.quad${N}) {`),x.push(_+`  queue[pushIdx] = node.quad${N};`),x.push(_+"  queueLength += 1;"),x.push(_+"  pushIdx += 1;"),x.push(_+"}");return x.join(`
`)}function b(_){let x=[];for(let N=0;N<p;++N)x.push(`${_}quad${N} = null;`);return x.join(`
`)}}function i(u){let h=n(u);return`
  function isSamePosition(point1, point2) {
    ${h("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${h("d{var} < 1e-8",{join:" && "})};
  }  
`}function s(u){var h=Math.pow(2,u);return`
function setChild(node, idx, child) {
  ${p()}
}`;function p(){let m=[];for(let g=0;g<h;++g){let y=g===0?"  ":"  else ";m.push(`${y}if (idx === ${g}) node.quad${g} = child;`)}return m.join(`
`)}}function a(u){return`function getChild(node, idx) {
${h()}
  return null;
}`;function h(){let p=[],m=Math.pow(2,u);for(let g=0;g<m;++g)p.push(`  if (idx === ${g}) return node.quad${g};`);return p.join(`
`)}}function o(u){let h=n(u),p=Math.pow(2,u);var m=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${g("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${h("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${h("this.min_{var} = 0;",{indent:2})}
  ${h("this.max_{var} = 0;",{indent:2})}
}
`;return m;function g(y){let b=[];for(let _=0;_<p;++_)b.push(`${y}quad${_} = null;`);return b.join(`
`)}}function l(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}return Ga.exports}var Yg={exports:{}},JA;function SZ(){if(JA)return Yg.exports;JA=1,Yg.exports=e,Yg.exports.generateFunctionBody=t;const n=ah();function e(r){let i=t(r);return new Function("bodies","settings","random",i)}function t(r){let i=n(r);return`
  var boundingBox = {
    ${i("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${i("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${i("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${i("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${i("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${i("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${i("var max_{var} = -Infinity;",{indent:4})}
    ${i("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${i("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${i("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${i("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${i("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${i("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}return Yg.exports}var Kg={exports:{}},e2;function TZ(){if(e2)return Kg.exports;e2=1;const n=ah();Kg.exports=e,Kg.exports.generateCreateDragForceFunctionBody=t;function e(r){let i=t(r);return new Function("options",i)}function t(r){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${n(r)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}return Kg.exports}var Zg={exports:{}},t2;function NZ(){if(t2)return Zg.exports;t2=1;const n=ah();Zg.exports=e,Zg.exports.generateCreateSpringForceFunctionBody=t;function e(r){let i=t(r);return new Function("options","random",i)}function t(r){let i=n(r);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${i("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${i("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${i("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${i("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${i("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}return Zg.exports}var Qg={exports:{}},n2;function EZ(){if(n2)return Qg.exports;n2=1;const n=ah();Qg.exports=e,Qg.exports.generateIntegratorFunctionBody=t;function e(r){let i=t(r);return new Function("bodies","timeStep","adaptiveTimeStepWeight",i)}function t(r){let i=n(r);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${i("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${i("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${i("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${i("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${i("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${i("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${i("body.pos.{var} += d{var};",{indent:4})}

    ${i("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${i("t{var} * t{var}",{join:" + "})})/length;
`}return Qg.exports}var hb,r2;function MZ(){if(r2)return hb;r2=1,hb=n;function n(e,t,r,i){this.from=e,this.to=t,this.length=r,this.coefficient=i}return hb}var fb,i2;function CZ(){if(i2)return fb;i2=1,fb=n;function n(e,t){var r;if(e||(e={}),t){for(r in t)if(t.hasOwnProperty(r)){var i=e.hasOwnProperty(r),s=typeof t[r],a=!i||typeof e[r]!==s;a?e[r]=t[r]:s==="object"&&(e[r]=n(e[r],t[r]))}}return e}return fb}var lf={exports:{}},s2;function AZ(){if(s2)return lf.exports;s2=1,lf.exports=n,lf.exports.random=n,lf.exports.randomIterator=o;function n(l){var u=typeof l=="number"?l:+new Date;return new e(u)}function e(l){this.seed=l}e.prototype.next=a,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t,e.prototype.random=s;function t(){var l,u,h;do u=this.nextDouble()*2-1,h=this.nextDouble()*2-1,l=u*u+h*h;while(l>=1||l===0);return u*Math.sqrt(-2*Math.log(l)/l)}e.prototype.levy=r;function r(){var l=1.5,u=Math.pow(i(1+l)*Math.sin(Math.PI*l/2)/(i((1+l)/2)*l*Math.pow(2,(l-1)/2)),1/l);return this.gaussian()*u/Math.pow(Math.abs(this.gaussian()),1/l)}function i(l){return Math.sqrt(2*Math.PI/l)*Math.pow(1/Math.E*(l+1/(12*l-1/(10*l))),l)}function s(){var l=this.seed;return l=l+2127912214+(l<<12)&4294967295,l=(l^3345072700^l>>>19)&4294967295,l=l+374761393+(l<<5)&4294967295,l=(l+3550635116^l<<9)&4294967295,l=l+4251993797+(l<<3)&4294967295,l=(l^3042594569^l>>>16)&4294967295,this.seed=l,(l&268435455)/268435456}function a(l){return Math.floor(this.nextDouble()*l)}function o(l,u){var h=u||n();if(typeof h.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:m,shuffle:p};function p(){var g,y,b;for(g=l.length-1;g>0;--g)y=h.next(g+1),b=l[y],l[y]=l[g],l[g]=b;return l}function m(g){var y,b,_;for(y=l.length-1;y>0;--y)b=h.next(y+1),_=l[b],l[b]=l[y],l[y]=_,g(_);l.length&&g(l[0])}}return lf.exports}var pb,a2;function o2(){if(a2)return pb;a2=1,pb=o;var n=bZ(),e=wZ(),t=SZ(),r=TZ(),i=NZ(),s=EZ(),a={};function o(h){var p=MZ(),m=CZ(),g=cT();if(h){if(h.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(h.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}h=m(h,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var y=a[h.dimensions];if(!y){var b=h.dimensions;y={Body:n(b,h.debug),createQuadTree:e(b),createBounds:t(b),createDragForce:r(b),createSpringForce:i(b),integrate:s(b)},a[b]=y}var _=y.Body,x=y.createQuadTree,N=y.createBounds,T=y.createDragForce,S=y.createSpringForce,M=y.integrate,C=q=>new _(q),R=AZ().random(42),F=[],k=[],D=x(h,R),P=N(F,h,R),G=S(h,R),$=T(h),U=0,K=[],O=new Map,j=0;V("nbody",se),V("spring",J);var L={bodies:F,quadTree:D,springs:k,settings:h,addForce:V,removeForce:z,getForces:Y,step:function(){for(var q=0;q<K.length;++q)K[q](j);var Q=M(F,h.timeStep,h.adaptiveTimeStepWeight);return j+=1,Q},addBody:function(q){if(!q)throw new Error("Body is required");return F.push(q),q},addBodyAt:function(q){if(!q)throw new Error("Body position is required");var Q=C(q);return F.push(Q),Q},removeBody:function(q){if(q){var Q=F.indexOf(q);if(!(Q<0))return F.splice(Q,1),F.length===0&&P.reset(),!0}},addSpring:function(q,Q,te,X){if(!q||!Q)throw new Error("Cannot add null spring to force simulator");typeof te!="number"&&(te=-1);var ce=new p(q,Q,te,X>=0?X:-1);return k.push(ce),ce},getTotalMovement:function(){return U},removeSpring:function(q){if(q){var Q=k.indexOf(q);if(Q>-1)return k.splice(Q,1),!0}},getBestNewBodyPosition:function(q){return P.getBestNewPosition(q)},getBBox:B,getBoundingBox:B,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(q){return q!==void 0?(h.gravity=q,D.options({gravity:q}),this):h.gravity},theta:function(q){return q!==void 0?(h.theta=q,D.options({theta:q}),this):h.theta},random:R};return l(h,L),g(L),L;function B(){return P.update(),P.box}function V(q,Q){if(O.has(q))throw new Error("Force "+q+" is already added");O.set(q,Q),K.push(Q)}function z(q){var Q=K.indexOf(O.get(q));Q<0||(K.splice(Q,1),O.delete(q))}function Y(){return O}function se(){if(F.length!==0){D.insertBodies(F);for(var q=F.length;q--;){var Q=F[q];Q.isPinned||(Q.reset(),D.updateBodyForce(Q),$.update(Q))}}}function J(){for(var q=k.length;q--;)G.update(k[q])}}function l(h,p){for(var m in h)u(h,p,m)}function u(h,p,m){if(h.hasOwnProperty(m)&&typeof p[m]!="function"){var g=Number.isFinite(h[m]);g?p[m]=function(y){if(y!==void 0){if(!Number.isFinite(y))throw new Error("Value of "+m+" should be a valid number.");return h[m]=y,p}return h[m]}:p[m]=function(y){return y!==void 0?(h[m]=y,p):h[m]}}}return pb}var l2;function RZ(){if(l2)return Xg.exports;l2=1,Xg.exports=e,Xg.exports.simulator=o2();var n=cT();function e(r,i){if(!r)throw new Error("Graph structure cannot be undefined");var s=i&&i.createSimulator||o2(),a=s(i);if(Array.isArray(i))throw new Error("Physics settings is expected to be an object");var o=r.version>19?O:K;i&&typeof i.nodeMass=="function"&&(o=i.nodeMass);var l=new Map,u={},h=0,p=a.settings.springTransform||t;C(),T();var m=!1,g={step:function(){if(h===0)return y(!0),!0;var j=a.step();g.lastMove=j,g.fire("step");var L=j/h,B=L<=.01;return y(B),B},getNodePosition:function(j){return U(j).pos},setNodePosition:function(j){var L=U(j);L.setPosition.apply(L,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(j){var L=u[j];if(L)return{from:L.from.pos,to:L.to.pos}},getGraphRect:function(){return a.getBBox()},forEachBody:b,pinNode:function(j,L){var B=U(j.id);B.isPinned=!!L},isNodePinned:function(j){return U(j.id).isPinned},dispose:function(){r.off("changed",M),g.fire("disposed")},getBody:N,getSpring:x,getForceVectorLength:_,simulator:a,graph:r,lastMove:0};return n(g),g;function y(j){m!==j&&(m=j,S(j))}function b(j){l.forEach(j)}function _(){var j=0,L=0;return b(function(B){j+=Math.abs(B.force.x),L+=Math.abs(B.force.y)}),Math.sqrt(j*j+L*L)}function x(j,L){var B;if(L===void 0)typeof j!="object"?B=j:B=j.id;else{var V=r.hasLink(j,L);if(!V)return;B=V.id}return u[B]}function N(j){return l.get(j)}function T(){r.on("changed",M)}function S(j){g.fire("stable",j)}function M(j){for(var L=0;L<j.length;++L){var B=j[L];B.changeType==="add"?(B.node&&R(B.node.id),B.link&&k(B.link)):B.changeType==="remove"&&(B.node&&F(B.node),B.link&&D(B.link))}h=r.getNodesCount()}function C(){h=0,r.forEachNode(function(j){R(j.id),h+=1}),r.forEachLink(k)}function R(j){var L=l.get(j);if(!L){var B=r.getNode(j);if(!B)throw new Error("initBody() was called with unknown node id");var V=B.position;if(!V){var z=P(B);V=a.getBestNewBodyPosition(z)}L=a.addBodyAt(V),L.id=j,l.set(j,L),G(j),$(B)&&(L.isPinned=!0)}}function F(j){var L=j.id,B=l.get(L);B&&(l.delete(L),a.removeBody(B))}function k(j){G(j.fromId),G(j.toId);var L=l.get(j.fromId),B=l.get(j.toId),V=a.addSpring(L,B,j.length);p(j,V),u[j.id]=V}function D(j){var L=u[j.id];if(L){var B=r.getNode(j.fromId),V=r.getNode(j.toId);B&&G(B.id),V&&G(V.id),delete u[j.id],a.removeSpring(L)}}function P(j){var L=[];if(!j.links)return L;for(var B=Math.min(j.links.length,2),V=0;V<B;++V){var z=j.links[V],Y=z.fromId!==j.id?l.get(z.fromId):l.get(z.toId);Y&&Y.pos&&L.push(Y)}return L}function G(j){var L=l.get(j);if(L.mass=o(j),Number.isNaN(L.mass))throw new Error("Node mass should be a number")}function $(j){return j&&(j.isPinned||j.data&&j.data.isPinned)}function U(j){var L=l.get(j);return L||(R(j),L=l.get(j)),L}function K(j){var L=r.getLinks(j);return L?1+L.length/3:1}function O(j){var L=r.getLinks(j);return L?1+L.size/3:1}}function t(){}return Xg.exports}var PZ=RZ();const kZ=Kd(PZ);function aS(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var LZ=typeof global=="object"&&global&&global.Object===Object&&global,DZ=typeof self=="object"&&self&&self.Object===Object&&self,xD=LZ||DZ||Function("return this")(),mb=function(){return xD.Date.now()},IZ=/\s/;function jZ(n){for(var e=n.length;e--&&IZ.test(n.charAt(e)););return e}var FZ=/^\s+/;function OZ(n){return n&&n.slice(0,jZ(n)+1).replace(FZ,"")}var ux=xD.Symbol,yD=Object.prototype,UZ=yD.hasOwnProperty,BZ=yD.toString,cf=ux?ux.toStringTag:void 0;function zZ(n){var e=UZ.call(n,cf),t=n[cf];try{n[cf]=void 0;var r=!0}catch{}var i=BZ.call(n);return r&&(e?n[cf]=t:delete n[cf]),i}var VZ=Object.prototype,GZ=VZ.toString;function HZ(n){return GZ.call(n)}var $Z="[object Null]",WZ="[object Undefined]",c2=ux?ux.toStringTag:void 0;function qZ(n){return n==null?n===void 0?WZ:$Z:c2&&c2 in Object(n)?zZ(n):HZ(n)}function XZ(n){return n!=null&&typeof n=="object"}var YZ="[object Symbol]";function KZ(n){return typeof n=="symbol"||XZ(n)&&qZ(n)==YZ}var u2=NaN,ZZ=/^[-+]0x[0-9a-f]+$/i,QZ=/^0b[01]+$/i,JZ=/^0o[0-7]+$/i,eQ=parseInt;function d2(n){if(typeof n=="number")return n;if(KZ(n))return u2;if(aS(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=aS(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=OZ(n);var t=QZ.test(n);return t||JZ.test(n)?eQ(n.slice(2),t?2:8):ZZ.test(n)?u2:+n}var tQ="Expected a function",nQ=Math.max,rQ=Math.min;function iQ(n,e,t){var r,i,s,a,o,l,u=0,h=!1,p=!1,m=!0;if(typeof n!="function")throw new TypeError(tQ);e=d2(e)||0,aS(t)&&(h=!!t.leading,p="maxWait"in t,s=p?nQ(d2(t.maxWait)||0,e):s,m="trailing"in t?!!t.trailing:m);function g(C){var R=r,F=i;return r=i=void 0,u=C,a=n.apply(F,R),a}function y(C){return u=C,o=setTimeout(x,e),h?g(C):a}function b(C){var R=C-l,F=C-u,k=e-R;return p?rQ(k,s-F):k}function _(C){var R=C-l,F=C-u;return l===void 0||R>=e||R<0||p&&F>=s}function x(){var C=mb();if(_(C))return N(C);o=setTimeout(x,b(C))}function N(C){return o=void 0,m&&r?g(C):(r=i=void 0,a)}function T(){o!==void 0&&clearTimeout(o),u=0,r=l=i=o=void 0}function S(){return o===void 0?a:N(mb())}function M(){var C=mb(),R=_(C);if(r=arguments,i=this,l=C,R){if(o===void 0)return y(l);if(p)return clearTimeout(o),o=setTimeout(x,e),g(l)}return o===void 0&&(o=setTimeout(x,e)),a}return M.cancel=T,M.flush=S,M}function h2(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function sQ(n){if(Array.isArray(n))return n}function aQ(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function oQ(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function lQ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(h){u=!0,i=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}function cQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uQ(n,e){return sQ(n)||lQ(n,e)||dQ(n,e)||cQ()}function dQ(n,e){if(n){if(typeof n=="string")return h2(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?h2(n,e):void 0}}var hQ=oQ(function n(e,t){var r=t.default,i=r===void 0?null:r,s=t.triggerUpdate,a=s===void 0?!0:s,o=t.onChange,l=o===void 0?function(u,h){}:o;aQ(this,n),this.name=e,this.defaultVal=i,this.triggerUpdate=a,this.onChange=l});function ty(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,r=n.props,i=r===void 0?{}:r,s=n.methods,a=s===void 0?{}:s,o=n.aliases,l=o===void 0?{}:o,u=n.init,h=u===void 0?function(){}:u,p=n.update,m=p===void 0?function(){}:p,g=Object.keys(i).map(function(y){return new hQ(y,i[y])});return function y(){for(var b=arguments.length,_=new Array(b),x=0;x<b;x++)_[x]=arguments[x];var N=!!(this instanceof y&&this.constructor),T=N?_.shift():void 0,S=_[0],M=S===void 0?{}:S,C=Object.assign({},t instanceof Function?t(M):t,{initialised:!1}),R={};function F(P){return k(P,M),D(),F}var k=function(G,$){h.call(F,G,C,$),C.initialised=!0},D=iQ(function(){C.initialised&&(m.call(F,C,R),R={})},1);return g.forEach(function(P){F[P.name]=G(P);function G($){var U=$.name,K=$.triggerUpdate,O=K===void 0?!1:K,j=$.onChange,L=j===void 0?function(z,Y){}:j,B=$.defaultVal,V=B===void 0?null:B;return function(z){var Y=C[U];if(!arguments.length)return Y;var se=z===void 0?V:z;return C[U]=se,L.call(F,se,C,Y),!R.hasOwnProperty(U)&&(R[U]=Y),O&&D(),F}}}),Object.keys(a).forEach(function(P){F[P]=function(){for(var G,$=arguments.length,U=new Array($),K=0;K<$;K++)U[K]=arguments[K];return(G=a[P]).call.apply(G,[F,C].concat(U))}}),Object.entries(l).forEach(function(P){var G=uQ(P,2),$=G[0],U=G[1];return F[$]=F[U]}),F.resetProps=function(){return g.forEach(function(P){F[P.name](P.defaultVal)}),F},F.resetProps(),C._rerender=D,N&&T&&F(T),F}}var tn=function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}};class f2 extends Map{constructor(e,t=mQ){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(p2(this,e))}has(e){return super.has(p2(this,e))}set(e,t){return super.set(fQ(this,e),t)}delete(e){return super.delete(pQ(this,e))}}function p2({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):t}function fQ({_intern:n,_key:e},t){const r=e(t);return n.has(r)?n.get(r):(n.set(r,t),t)}function pQ({_intern:n,_key:e},t){const r=e(t);return n.has(r)&&(t=n.get(r),n.delete(r)),t}function mQ(n){return n!==null&&typeof n=="object"?n.valueOf():n}function gQ(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t<i||t===void 0&&i>=i)&&(t=i)}return t}function xQ(n,e){let t;if(e===void 0)for(const r of n)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t>i||t===void 0&&i>=i)&&(t=i)}return t}function oS(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function yQ(n){if(Array.isArray(n))return n}function vQ(n){if(Array.isArray(n))return oS(n)}function vD(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function _Q(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function bQ(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Xr(n,e){return n.get(vD(n,e))}function Lu(n,e,t){_Q(n,e),e.set(n,t)}function Jg(n,e,t){return n.set(vD(n,e),t),t}function wQ(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,PQ(r.key),r)}}function SQ(n,e,t){return e&&wQ(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function TQ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function NQ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(h){u=!0,i=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}function EQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CQ(n,e){return yQ(n)||NQ(n,e)||_D(n,e)||EQ()}function AQ(n){return vQ(n)||TQ(n)||_D(n)||MQ()}function RQ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function PQ(n){var e=RQ(n,"string");return typeof e=="symbol"?e:e+""}function _D(n,e){if(n){if(typeof n=="string")return oS(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?oS(n,e):void 0}}var Du=new WeakMap,uf=new WeakMap,Iu=new WeakMap,gb=new WeakMap,xb=new WeakMap,yb=new WeakMap,kQ=function(){function n(){bQ(this,n),Lu(this,Du,new Map),Lu(this,uf,new Map),Lu(this,Iu,function(e){return e}),Lu(this,gb,function(){return{}}),Lu(this,xb,function(){}),Lu(this,yb,function(){})}return SQ(n,[{key:"getObj",value:function(t){return Xr(Du,this).get(Xr(Iu,this).call(this,t))}},{key:"getData",value:function(t){return Xr(uf,this).get(t)}},{key:"entries",value:function(){return AQ(Xr(uf,this).entries()).map(function(t){var r=CQ(t,2),i=r[0],s=r[1];return[s,i]})}},{key:"id",value:function(t){return Jg(Iu,this,tn(t)),this}},{key:"onCreateObj",value:function(t){return Jg(gb,this,t),this}},{key:"onUpdateObj",value:function(t){return Jg(xb,this,t),this}},{key:"onRemoveObj",value:function(t){return Jg(yb,this,t),this}},{key:"digest",value:function(t){var r=this;t.filter(function(s){return!Xr(Du,r).has(Xr(Iu,r).call(r,s))}).forEach(function(s){var a=Xr(gb,r).call(r,s);Xr(Du,r).set(Xr(Iu,r).call(r,s),a),Xr(uf,r).set(a,s)});var i=new Map(t.map(function(s){return[Xr(Iu,r).call(r,s),s]}));return Xr(Du,this).forEach(function(s,a){i.has(a)?Xr(xb,r).call(r,s,i.get(a)):(Xr(yb,r).call(r,s,a),Xr(Du,r).delete(a),Xr(uf,r).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function LQ(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const m2=Symbol("implicit");function bD(){var n=new f2,e=[],t=[],r=m2;function i(s){let a=n.get(s);if(a===void 0){if(r!==m2)return r;n.set(s,a=e.push(s)-1)}return t[a%t.length]}return i.domain=function(s){if(!arguments.length)return e.slice();e=[],n=new f2;for(const a of s)n.has(a)||n.set(a,e.push(a)-1);return i},i.range=function(s){return arguments.length?(t=Array.from(s),i):t.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return bD(e,t).unknown(r)},LQ.apply(i,arguments),i}function DQ(n){for(var e=n.length/6|0,t=new Array(e),r=0;r<e;)t[r]="#"+n.slice(r*6,++r*6);return t}const IQ=DQ("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function dx(n){"@babel/helpers - typeof";return dx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dx(n)}var jQ=/^\s+/,FQ=/\s+$/;function bt(n,e){if(n=n||"",e=e||{},n instanceof bt)return n;if(!(this instanceof bt))return new bt(n,e);var t=OQ(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}bt.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,r,i,s,a,o;return t=e.r/255,r=e.g/255,i=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),.2126*s+.7152*a+.0722*o},setAlpha:function(e){return this._a=wD(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=x2(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=x2(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+r+"%, "+i+"%)":"hsva("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=g2(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=g2(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+r+"%, "+i+"%)":"hsla("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return y2(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return VQ(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(On(this._r,255)*100)+"%",g:Math.round(On(this._g,255)*100)+"%",b:Math.round(On(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(On(this._r,255)*100)+"%, "+Math.round(On(this._g,255)*100)+"%, "+Math.round(On(this._b,255)*100)+"%)":"rgba("+Math.round(On(this._r,255)*100)+"%, "+Math.round(On(this._g,255)*100)+"%, "+Math.round(On(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:eJ[y2(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+v2(this._r,this._g,this._b,this._a),r=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var s=bt(e);r="#"+v2(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,i=this._a<1&&this._a>=0,s=!t&&i&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return bt(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(WQ,arguments)},brighten:function(){return this._applyModification(qQ,arguments)},darken:function(){return this._applyModification(XQ,arguments)},desaturate:function(){return this._applyModification(GQ,arguments)},saturate:function(){return this._applyModification(HQ,arguments)},greyscale:function(){return this._applyModification($Q,arguments)},spin:function(){return this._applyModification(YQ,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(QQ,arguments)},complement:function(){return this._applyCombination(KQ,arguments)},monochromatic:function(){return this._applyCombination(JQ,arguments)},splitcomplement:function(){return this._applyCombination(ZQ,arguments)},triad:function(){return this._applyCombination(_2,[3])},tetrad:function(){return this._applyCombination(_2,[4])}};bt.fromRatio=function(n,e){if(dx(n)=="object"){var t={};for(var r in n)n.hasOwnProperty(r)&&(r==="a"?t[r]=n[r]:t[r]=kf(n[r]));n=t}return bt(n,e)};function OQ(n){var e={r:0,g:0,b:0},t=1,r=null,i=null,s=null,a=!1,o=!1;return typeof n=="string"&&(n=iJ(n)),dx(n)=="object"&&(Ha(n.r)&&Ha(n.g)&&Ha(n.b)?(e=UQ(n.r,n.g,n.b),a=!0,o=String(n.r).substr(-1)==="%"?"prgb":"rgb"):Ha(n.h)&&Ha(n.s)&&Ha(n.v)?(r=kf(n.s),i=kf(n.v),e=zQ(n.h,r,i),a=!0,o="hsv"):Ha(n.h)&&Ha(n.s)&&Ha(n.l)&&(r=kf(n.s),s=kf(n.l),e=BQ(n.h,r,s),a=!0,o="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=wD(t),{ok:a,format:n.format||o,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function UQ(n,e,t){return{r:On(n,255)*255,g:On(e,255)*255,b:On(t,255)*255}}function g2(n,e,t){n=On(n,255),e=On(e,255),t=On(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,a,o=(r+i)/2;if(r==i)s=a=0;else{var l=r-i;switch(a=o>.5?l/(2-r-i):l/(r+i),r){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:a,l:o}}function BQ(n,e,t){var r,i,s;n=On(n,360),e=On(e,100),t=On(t,100);function a(u,h,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?u+(h-u)*6*p:p<1/2?h:p<2/3?u+(h-u)*(2/3-p)*6:u}if(e===0)r=i=s=t;else{var o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;r=a(l,o,n+1/3),i=a(l,o,n),s=a(l,o,n-1/3)}return{r:r*255,g:i*255,b:s*255}}function x2(n,e,t){n=On(n,255),e=On(e,255),t=On(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,a,o=r,l=r-i;if(a=r===0?0:l/r,r==i)s=0;else{switch(r){case n:s=(e-t)/l+(e<t?6:0);break;case e:s=(t-n)/l+2;break;case t:s=(n-e)/l+4;break}s/=6}return{h:s,s:a,v:o}}function zQ(n,e,t){n=On(n,360)*6,e=On(e,100),t=On(t,100);var r=Math.floor(n),i=n-r,s=t*(1-e),a=t*(1-i*e),o=t*(1-(1-i)*e),l=r%6,u=[t,a,s,s,o,t][l],h=[o,t,t,a,s,s][l],p=[s,s,o,t,t,a][l];return{r:u*255,g:h*255,b:p*255}}function y2(n,e,t,r){var i=[Vs(Math.round(n).toString(16)),Vs(Math.round(e).toString(16)),Vs(Math.round(t).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function VQ(n,e,t,r,i){var s=[Vs(Math.round(n).toString(16)),Vs(Math.round(e).toString(16)),Vs(Math.round(t).toString(16)),Vs(SD(r))];return i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function v2(n,e,t,r){var i=[Vs(SD(r)),Vs(Math.round(n).toString(16)),Vs(Math.round(e).toString(16)),Vs(Math.round(t).toString(16))];return i.join("")}bt.equals=function(n,e){return!n||!e?!1:bt(n).toRgbString()==bt(e).toRgbString()};bt.random=function(){return bt.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function GQ(n,e){e=e===0?0:e||10;var t=bt(n).toHsl();return t.s-=e/100,t.s=ny(t.s),bt(t)}function HQ(n,e){e=e===0?0:e||10;var t=bt(n).toHsl();return t.s+=e/100,t.s=ny(t.s),bt(t)}function $Q(n){return bt(n).desaturate(100)}function WQ(n,e){e=e===0?0:e||10;var t=bt(n).toHsl();return t.l+=e/100,t.l=ny(t.l),bt(t)}function qQ(n,e){e=e===0?0:e||10;var t=bt(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),bt(t)}function XQ(n,e){e=e===0?0:e||10;var t=bt(n).toHsl();return t.l-=e/100,t.l=ny(t.l),bt(t)}function YQ(n,e){var t=bt(n).toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,bt(t)}function KQ(n){var e=bt(n).toHsl();return e.h=(e.h+180)%360,bt(e)}function _2(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=bt(n).toHsl(),r=[bt(n)],i=360/e,s=1;s<e;s++)r.push(bt({h:(t.h+s*i)%360,s:t.s,l:t.l}));return r}function ZQ(n){var e=bt(n).toHsl(),t=e.h;return[bt(n),bt({h:(t+72)%360,s:e.s,l:e.l}),bt({h:(t+216)%360,s:e.s,l:e.l})]}function QQ(n,e,t){e=e||6,t=t||30;var r=bt(n).toHsl(),i=360/t,s=[bt(n)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(bt(r));return s}function JQ(n,e){e=e||6;for(var t=bt(n).toHsv(),r=t.h,i=t.s,s=t.v,a=[],o=1/e;e--;)a.push(bt({h:r,s:i,v:s})),s=(s+o)%1;return a}bt.mix=function(n,e,t){t=t===0?0:t||50;var r=bt(n).toRgb(),i=bt(e).toRgb(),s=t/100,a={r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a};return bt(a)};bt.readability=function(n,e){var t=bt(n),r=bt(e);return(Math.max(t.getLuminance(),r.getLuminance())+.05)/(Math.min(t.getLuminance(),r.getLuminance())+.05)};bt.isReadable=function(n,e,t){var r=bt.readability(n,e),i,s;switch(s=!1,i=sJ(t),i.level+i.size){case"AAsmall":case"AAAlarge":s=r>=4.5;break;case"AAlarge":s=r>=3;break;case"AAAsmall":s=r>=7;break}return s};bt.mostReadable=function(n,e,t){var r=null,i=0,s,a,o,l;t=t||{},a=t.includeFallbackColors,o=t.level,l=t.size;for(var u=0;u<e.length;u++)s=bt.readability(n,e[u]),s>i&&(i=s,r=bt(e[u]));return bt.isReadable(n,r,{level:o,size:l})||!a?r:(t.includeFallbackColors=!1,bt.mostReadable(n,["#fff","#000"],t))};var lS=bt.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},eJ=bt.hexNames=tJ(lS);function tJ(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function wD(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function On(n,e){nJ(n)&&(n="100%");var t=rJ(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function ny(n){return Math.min(1,Math.max(0,n))}function Hi(n){return parseInt(n,16)}function nJ(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function rJ(n){return typeof n=="string"&&n.indexOf("%")!=-1}function Vs(n){return n.length==1?"0"+n:""+n}function kf(n){return n<=1&&(n=n*100+"%"),n}function SD(n){return Math.round(parseFloat(n)*255).toString(16)}function b2(n){return Hi(n)/255}var ks=function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Ha(n){return!!ks.CSS_UNIT.exec(n)}function iJ(n){n=n.replace(jQ,"").replace(FQ,"").toLowerCase();var e=!1;if(lS[n])n=lS[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=ks.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=ks.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=ks.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=ks.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=ks.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=ks.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=ks.hex8.exec(n))?{r:Hi(t[1]),g:Hi(t[2]),b:Hi(t[3]),a:b2(t[4]),format:e?"name":"hex8"}:(t=ks.hex6.exec(n))?{r:Hi(t[1]),g:Hi(t[2]),b:Hi(t[3]),format:e?"name":"hex"}:(t=ks.hex4.exec(n))?{r:Hi(t[1]+""+t[1]),g:Hi(t[2]+""+t[2]),b:Hi(t[3]+""+t[3]),a:b2(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=ks.hex3.exec(n))?{r:Hi(t[1]+""+t[1]),g:Hi(t[2]+""+t[2]),b:Hi(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function sJ(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function cS(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function aJ(n){if(Array.isArray(n))return n}function oJ(n){if(Array.isArray(n))return cS(n)}function TD(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function lJ(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ND(n,e,t){return e=zd(e),gJ(n,uT()?Reflect.construct(e,t||[],zd(n).constructor):e.apply(n,t))}function cJ(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ED(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function vb(n,e){return n.get(TD(n,e))}function w2(n,e,t){cJ(n,e),e.set(n,t)}function S2(n,e,t){return n.set(TD(n,e),t),t}function MD(n,e,t){if(uT())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return i}function uJ(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,RD(r.key),r)}}function CD(n,e,t){return e&&uJ(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function ry(n,e,t){return(e=RD(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function uS(){return uS=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=xJ(n,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?n:t):i.value}},uS.apply(null,arguments)}function zd(n){return zd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zd(n)}function AD(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&dS(n,e)}function uT(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uT=function(){return!!n})()}function dJ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function hJ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(h){u=!0,i=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}function fJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function mJ(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?T2(Object(t),!0).forEach(function(r){ry(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):T2(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function gJ(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lJ(n)}function dS(n,e){return dS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},dS(n,e)}function Gf(n,e){return aJ(n)||hJ(n,e)||PD(n,e)||fJ()}function xJ(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=zd(n))!==null;);return n}function _b(n,e,t,r){var i=uS(zd(n.prototype),e,t);return typeof i=="function"?function(s){return i.apply(t,s)}:i}function Is(n){return oJ(n)||dJ(n)||PD(n)||pJ()}function yJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function RD(n){var e=yJ(n,"string");return typeof e=="symbol"?e:e+""}function hS(n){"@babel/helpers - typeof";return hS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hS(n)}function PD(n,e){if(n){if(typeof n=="string")return cS(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?cS(n,e):void 0}}var kD=function(e){e instanceof Array?e.forEach(kD):(e.map&&e.map.dispose(),e.dispose())},LD=function(e){e.geometry&&e.geometry.dispose(),e.material&&kD(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(LD)},fS=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),LD(t)}},bb=new WeakMap,e0=new WeakMap,df=function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.dataBindAttr,a=s===void 0?"__data":s,o=i.objBindAttr,l=o===void 0?"__threeObj":o;return ED(this,e),r=ND(this,e),ry(r,"scene",void 0),w2(r,bb,void 0),w2(r,e0,void 0),r.scene=t,S2(bb,r,a),S2(e0,r,l),r.onRemoveObj(function(){}),r}return AD(e,n),CD(e,[{key:"onCreateObj",value:function(r){var i=this;return _b(e,"onCreateObj",this)([function(s){var a=r(s);return s[vb(e0,i)]=a,a[vb(bb,i)]=s,i.scene.add(a),a}]),this}},{key:"onRemoveObj",value:function(r){var i=this;return _b(e,"onRemoveObj",this)([function(s,a){var o=_b(e,"getData",i)([s]);r(s,a),i.scene.remove(s),fS(s),delete o[vb(e0,i)]}]),this}}])}(kQ),hf=function(e){return isNaN(e)?parseInt(bt(e).toHex(),16):e},wb=function(e){return isNaN(e)?bt(e).getAlpha():1},vJ=bD(IQ);function N2(n,e,t){!e||typeof t!="string"||n.filter(function(r){return!r[t]}).forEach(function(r){r[t]=vJ(e(r))})}function _J(n,e){var t=n.nodes,r=n.links,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.nodeFilter,a=s===void 0?function(){return!0}:s,o=i.onLoopError,l=o===void 0?function(g){throw"Invalid DAG structure! Found cycle in node path: ".concat(g.join(" -> "),".")}:o,u={};t.forEach(function(g){return u[e(g)]={data:g,out:[],depth:-1,skip:!a(g)}}),r.forEach(function(g){var y=g.source,b=g.target,_=S(y),x=S(b);if(!u.hasOwnProperty(_))throw"Missing source node with id: ".concat(_);if(!u.hasOwnProperty(x))throw"Missing target node with id: ".concat(x);var N=u[_],T=u[x];N.out.push(T);function S(M){return hS(M)==="object"?e(M):M}});var h=[];m(Object.values(u));var p=Object.assign.apply(Object,[{}].concat(Is(Object.entries(u).filter(function(g){var y=Gf(g,2),b=y[1];return!b.skip}).map(function(g){var y=Gf(g,2),b=y[0],_=y[1];return ry({},b,_.depth)}))));return p;function m(g){for(var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,_=function(){var S=g[x];if(y.indexOf(S)!==-1){var M=[].concat(Is(y.slice(y.indexOf(S))),[S]).map(function(C){return e(C.data)});return h.some(function(C){return C.length===M.length&&C.every(function(R,F){return R===M[F]})})||(h.push(M),l(M)),1}b>S.depth&&(S.depth=b,m(S.out,[].concat(Is(y),[S]),b+(S.skip?0:1)))},x=0,N=g.length;x<N;x++)_()}}var kt=window.THREE?window.THREE:{Group:Yu,Mesh:Xn,MeshLambertMaterial:X3,Color:vt,BufferGeometry:ei,BufferAttribute:Fr,Matrix4:Yt,Vector3:ee,SphereGeometry:ih,CylinderGeometry:Jp,TubeGeometry:tT,ConeGeometry:Q1,Line:D9,LineBasicMaterial:Zx,QuadraticBezierCurve3:eT,CubicBezierCurve3:W3,Box3:kc},E2={graph:_Z,forcelayout:kZ},bJ=2,Sb=new kt.BufferGeometry().setAttribute?"setAttribute":"addAttribute",t0=new kt.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",wJ=ty({props:{jsonUrl:{onChange:function(e,t){var r=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(i){return i.json()}).then(function(i){t.fetchingJson=!1,t.onFinishLoading(i),r.graphData(i)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var r=t.d3ForceLayout.force("charge");r&&r.strength(e>2?-60:-30),e<3&&i(t.graphData.nodes,"z"),e<2&&i(t.graphData.nodes,"y");function i(s,a){s.forEach(function(o){delete o[a],delete o["v".concat(a)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(r){return r.fx=r.fy=r.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},linkDirectionalParticleThreeObject:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,r){return r===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,r),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&r(),i(),s(),this;function r(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var a=tn(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(m){var g=Gf(m,2),y=g[0],b=g[1];if(b){var _=t?y:e.layout.getNodePosition(y[e.nodeId]),x=a(y);(!e.nodePositionUpdate||!e.nodePositionUpdate(x?b.children[0]:b,{x:_.x,y:_.y,z:_.z},y)||x)&&(b.position.x=_.x,b.position.y=_.y||0,b.position.z=_.z||0)}});var o=tn(e.linkWidth),l=tn(e.linkCurvature),u=tn(e.linkCurveRotation),h=tn(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(m){var g=Gf(m,2),y=g[0],b=g[1];if(b){var _=t?y:e.layout.getLinkPosition(e.layout.graph.getLink(y.source,y.target).id),x=_[t?"source":"from"],N=_[t?"target":"to"];if(!(!x||!N||!x.hasOwnProperty("x")||!N.hasOwnProperty("x"))){p(y);var T=h(y);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(T?b.children[1]:b,{start:{x:x.x,y:x.y,z:x.z},end:{x:N.x,y:N.y,z:N.z}},y)&&!T)){var S=30,M=y.__curve,C=b.children.length?b.children[0]:b;if(C.type==="Line"){if(M){var F=M.getPoints(S);C.geometry.getAttribute("position").array.length!==F.length*3&&C.geometry[Sb]("position",new kt.BufferAttribute(new Float32Array(F.length*3),3)),C.geometry.setFromPoints(F)}else{var R=C.geometry.getAttribute("position");(!R||!R.array||R.array.length!==6)&&C.geometry[Sb]("position",R=new kt.BufferAttribute(new Float32Array(6),3)),R.array[0]=x.x,R.array[1]=x.y||0,R.array[2]=x.z||0,R.array[3]=N.x,R.array[4]=N.y||0,R.array[5]=N.z||0,R.needsUpdate=!0}C.geometry.computeBoundingSphere()}else if(C.type==="Mesh")if(M){C.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(C.position.set(0,0,0),C.rotation.set(0,0,0),C.scale.set(1,1,1));var K=Math.ceil(o(y)*10)/10,O=K/2,j=new kt.TubeGeometry(M,S,O,e.linkResolution,!1);C.geometry.dispose(),C.geometry=j}else{if(!C.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var k=Math.ceil(o(y)*10)/10,D=k/2,P=new kt.CylinderGeometry(D,D,1,e.linkResolution,1,!1);P[t0](new kt.Matrix4().makeTranslation(0,1/2,0)),P[t0](new kt.Matrix4().makeRotationX(Math.PI/2)),C.geometry.dispose(),C.geometry=P}var G=new kt.Vector3(x.x,x.y||0,x.z||0),$=new kt.Vector3(N.x,N.y||0,N.z||0),U=G.distanceTo($);C.position.x=G.x,C.position.y=G.y,C.position.z=G.z,C.scale.z=U,C.parent.localToWorld($),C.lookAt($)}}}}});function p(m){var g=t?m:e.layout.getLinkPosition(e.layout.graph.getLink(m.source,m.target).id),y=g[t?"source":"from"],b=g[t?"target":"to"];if(!(!y||!b||!y.hasOwnProperty("x")||!b.hasOwnProperty("x"))){var _=l(m);if(!_)m.__curve=null;else{var x=new kt.Vector3(y.x,y.y||0,y.z||0),N=new kt.Vector3(b.x,b.y||0,b.z||0),T=x.distanceTo(N),S,M=u(m);if(T>0){var C=b.x-y.x,R=b.y-y.y||0,F=new kt.Vector3().subVectors(N,x),k=F.clone().multiplyScalar(_).cross(C!==0||R!==0?new kt.Vector3(0,0,1):new kt.Vector3(0,1,0)).applyAxisAngle(F.normalize(),M).add(new kt.Vector3().addVectors(x,N).divideScalar(2));S=new kt.QuadraticBezierCurve3(x,k,N)}else{var D=_*70,P=-M,G=P+Math.PI/2;S=new kt.CubicBezierCurve3(x,new kt.Vector3(D*Math.cos(G),D*Math.sin(G),0).add(x),new kt.Vector3(D*Math.cos(P),D*Math.sin(P),0).add(x),N)}m.__curve=S}}}}function i(){var a=tn(e.linkDirectionalArrowRelPos),o=tn(e.linkDirectionalArrowLength),l=tn(e.nodeVal);e.arrowDataMapper.entries().forEach(function(u){var h=Gf(u,2),p=h[0],m=h[1];if(m){var g=t?p:e.layout.getLinkPosition(e.layout.graph.getLink(p.source,p.target).id),y=g[t?"source":"from"],b=g[t?"target":"to"];if(!(!y||!b||!y.hasOwnProperty("x")||!b.hasOwnProperty("x"))){var _=Math.cbrt(Math.max(0,l(y)||1))*e.nodeRelSize,x=Math.cbrt(Math.max(0,l(b)||1))*e.nodeRelSize,N=o(p),T=a(p),S=p.__curve?function(D){return p.__curve.getPoint(D)}:function(D){var P=function($,U,K,O){return U[$]+(K[$]-U[$])*O||0};return{x:P("x",y,b,D),y:P("y",y,b,D),z:P("z",y,b,D)}},M=p.__curve?p.__curve.getLength():Math.sqrt(["x","y","z"].map(function(D){return Math.pow((b[D]||0)-(y[D]||0),2)}).reduce(function(D,P){return D+P},0)),C=_+N+(M-_-x-N)*T,R=S(C/M),F=S((C-N)/M);["x","y","z"].forEach(function(D){return m.position[D]=F[D]});var k=MD(kt.Vector3,Is(["x","y","z"].map(function(D){return R[D]})));m.parent.localToWorld(k),m.lookAt(k)}}})}function s(){var a=tn(e.linkDirectionalParticleSpeed),o=tn(e.linkDirectionalParticleOffset);e.graphData.links.forEach(function(l){var u=e.particlesDataMapper.getObj(l),h=u&&u.children,p=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!p||!p.length)&&(!h||!h.length))){var m=t?l:e.layout.getLinkPosition(e.layout.graph.getLink(l.source,l.target).id),g=m[t?"source":"from"],y=m[t?"target":"to"];if(!(!g||!y||!g.hasOwnProperty("x")||!y.hasOwnProperty("x"))){var b=a(l),_=Math.abs(o(l)),x=l.__curve?function(T){return l.__curve.getPoint(T)}:function(T){var S=function(C,R,F,k){return R[C]+(F[C]-R[C])*k||0};return{x:S("x",g,y,T),y:S("y",g,y,T),z:S("z",g,y,T)}},N=[].concat(Is(h||[]),Is(p||[]));N.forEach(function(T,S){var M=T.parent.__linkThreeObjType==="singleHopPhotons";if(T.hasOwnProperty("__progressRatio")||(T.__progressRatio=M?0:(S+_)/h.length),T.__progressRatio+=b,T.__progressRatio>=1)if(!M)T.__progressRatio=T.__progressRatio%1;else{T.parent.remove(T),fS(T);return}var C=T.__progressRatio,R=x(C);T.geometry.type!=="SphereGeometry"&&T.lookAt(R.x,R.y,R.z),["x","y","z"].forEach(function(F){return T.position[F]=R[F]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var r=new kt.Group;r.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=r,e.graphScene.add(r)}var i=tn(e.linkDirectionalParticleThreeObject)(t);if(i&&e.linkDirectionalParticleThreeObject===i&&(i=i.clone()),!i){var s=tn(e.linkDirectionalParticleWidth),a=Math.ceil(s(t)*10)/10/2,o=e.linkDirectionalParticleResolution,l=new kt.SphereGeometry(a,o,o),u=tn(e.linkColor),h=tn(e.linkDirectionalParticleColor),p=h(t)||u(t)||"#f0f0f0",m=new kt.Color(hf(p)),g=e.linkOpacity*3,y=new kt.MeshLambertMaterial({color:m,transparent:!0,opacity:g});i=new kt.Mesh(l,y)}t.__singleHopPhotonsObj.add(i)}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var r=function i(s){var a=[];if(s.geometry){s.geometry.computeBoundingBox();var o=new kt.Box3;o.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),a.push(o)}return a.concat.apply(a,Is((s.children||[]).filter(function(l){return!l.hasOwnProperty("__graphObjType")||l.__graphObjType==="node"&&t(l.__data)}).map(i)))}(e.graphScene);return r.length?Object.assign.apply(Object,Is(["x","y","z"].map(function(i){return ry({},i,[xQ(r,function(s){return s.min[i]}),gQ(r,function(s){return s.max[i]})])}))):null}},stateInit:function(){return{d3ForceLayout:mZ().force("link",oZ()).force("charge",gZ()).force("center",cK()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new df(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new df(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new df(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new df(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var r=function(Q){return Q.some(function(te){return t.hasOwnProperty(te)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&r(["nodeAutoColorBy","graphData","nodeColor"])&&N2(e.graphData.nodes,tn(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&r(["linkAutoColorBy","graphData","linkColor"])&&N2(e.graphData.links,tn(e.linkAutoColorBy),e.linkColor),e._flushObjects||r(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var i=tn(e.nodeThreeObject),s=tn(e.nodeThreeObjectExtend),a=tn(e.nodeVal),o=tn(e.nodeColor),l=tn(e.nodeVisibility),u={},h={};(e._flushObjects||r(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(q){var Q=i(q),te=s(q);Q&&e.nodeThreeObject===Q&&(Q=Q.clone());var X;return Q&&!te?X=Q:(X=new kt.Mesh,X.__graphDefaultObj=!0,Q&&te&&X.add(Q)),X.__graphObjType="node",X}).onUpdateObj(function(q,Q){if(q.__graphDefaultObj){var te=a(Q)||1,X=Math.cbrt(te)*e.nodeRelSize,ce=e.nodeResolution;(!q.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||q.geometry.parameters.radius!==X||q.geometry.parameters.widthSegments!==ce)&&(u.hasOwnProperty(te)||(u[te]=new kt.SphereGeometry(X,ce,ce)),q.geometry.dispose(),q.geometry=u[te]);var me=o(Q),Re=new kt.Color(hf(me||"#ffffaa")),He=e.nodeOpacity*wb(me);(q.material.type!=="MeshLambertMaterial"||!q.material.color.equals(Re)||q.material.opacity!==He)&&(h.hasOwnProperty(me)||(h[me]=new kt.MeshLambertMaterial({color:Re,transparent:!0,opacity:He})),q.material.dispose(),q.material=h[me])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||r(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject"])){var p=tn(e.linkThreeObject),m=tn(e.linkThreeObjectExtend),g=tn(e.linkMaterial),y=tn(e.linkVisibility),b=tn(e.linkColor),_=tn(e.linkWidth),x={},N={},T={},S=e.graphData.links.filter(y);if((e._flushObjects||r(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(q){var Q=q.__data&&q.__data.__singleHopPhotonsObj;Q&&(Q.parent.remove(Q),fS(Q),delete q.__data.__singleHopPhotonsObj)}).onCreateObj(function(q){var Q=p(q),te=m(q);Q&&e.linkThreeObject===Q&&(Q=Q.clone());var X;if(!Q||te){var ce=!!_(q);if(ce)X=new kt.Mesh;else{var me=new kt.BufferGeometry;me[Sb]("position",new kt.BufferAttribute(new Float32Array(6),3)),X=new kt.Line(me)}}var Re;return Q?te?(Re=new kt.Group,Re.__graphDefaultObj=!0,Re.add(X),Re.add(Q)):Re=Q:(Re=X,Re.__graphDefaultObj=!0),Re.renderOrder=10,Re.__graphObjType="link",Re}).onUpdateObj(function(q,Q){if(q.__graphDefaultObj){var te=q.children.length?q.children[0]:q,X=Math.ceil(_(Q)*10)/10,ce=!!X;if(ce){var me=X/2,Re=e.linkResolution;if(!te.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||te.geometry.parameters.radiusTop!==me||te.geometry.parameters.radialSegments!==Re){if(!x.hasOwnProperty(X)){var He=new kt.CylinderGeometry(me,me,1,Re,1,!1);He[t0](new kt.Matrix4().makeTranslation(0,1/2,0)),He[t0](new kt.Matrix4().makeRotationX(Math.PI/2)),x[X]=He}te.geometry.dispose(),te.geometry=x[X]}}var Qe=g(Q);if(Qe)te.material=Qe;else{var ie=b(Q),Et=new kt.Color(hf(ie||"#f0f0f0")),yt=e.linkOpacity*wb(ie),tt=ce?"MeshLambertMaterial":"LineBasicMaterial";if(te.material.type!==tt||!te.material.color.equals(Et)||te.material.opacity!==yt){var Ne=ce?N:T;Ne.hasOwnProperty(ie)||(Ne[ie]=new kt[tt]({color:Et,transparent:yt<1,opacity:yt,depthWrite:yt>=1})),te.material.dispose(),te.material=Ne[ie]}}}}).digest(S),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var M=tn(e.linkDirectionalArrowLength),C=tn(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var q=new kt.Mesh(void 0,new kt.MeshLambertMaterial({transparent:!0}));return q.__linkThreeObjType="arrow",q}).onUpdateObj(function(q,Q){var te=M(Q),X=e.linkDirectionalArrowResolution;if(!q.geometry.type.match(/^Cone(Buffer)?Geometry$/)||q.geometry.parameters.height!==te||q.geometry.parameters.radialSegments!==X){var ce=new kt.ConeGeometry(te*.25,te,X);ce.translate(0,te/2,0),ce.rotateX(Math.PI/2),q.geometry.dispose(),q.geometry=ce}var me=C(Q)||b(Q)||"#f0f0f0";q.material.color=new kt.Color(hf(me)),q.material.opacity=e.linkOpacity*3*wb(me)}).digest(S.filter(M))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var R=tn(e.linkDirectionalParticles),F=tn(e.linkDirectionalParticleWidth),k=tn(e.linkDirectionalParticleColor),D=tn(e.linkDirectionalParticleThreeObject),P={},G={};e.particlesDataMapper.onCreateObj(function(){var q=new kt.Group;return q.__linkThreeObjType="photons",q.__photonDataMapper=new df(q),q}).onUpdateObj(function(q,Q){var te=!!q.children.length&&q.children[0],X=D(Q),ce,me;if(X)ce=X.geometry,me=X.material;else{var Re=Math.ceil(F(Q)*10)/10/2,He=e.linkDirectionalParticleResolution;te&&te.geometry.parameters.radius===Re&&te.geometry.parameters.widthSegments===He?ce=te.geometry:(G.hasOwnProperty(Re)||(G[Re]=new kt.SphereGeometry(Re,He,He)),ce=G[Re]);var Qe=k(Q)||b(Q)||"#f0f0f0",ie=new kt.Color(hf(Qe)),Et=e.linkOpacity*3;te&&te.material.color.equals(ie)&&te.material.opacity===Et?me=te.material:(P.hasOwnProperty(Qe)||(P[Qe]=new kt.MeshLambertMaterial({color:ie,transparent:!0,opacity:Et})),me=P[Qe])}te&&(te.geometry!==ce&&te.geometry.dispose(),te.material!==me&&te.material.dispose());var yt=Math.round(Math.abs(R(Q)));q.__photonDataMapper.id(function(tt){return tt.idx}).onCreateObj(function(){return new kt.Mesh(ce,me)}).onUpdateObj(function(tt){tt.geometry=ce,tt.material=me}).digest(Is(new Array(yt)).map(function(tt,Ne){return{idx:Ne}}))}).digest(S.filter(R))}}if(e._flushObjects=!1,r(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(q){q.source=q[e.linkSource],q.target=q[e.linkTarget]});var $=e.forceEngine!=="ngraph",U;if($){(U=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var K=e.d3ForceLayout.force("link");K&&K.id(function(q){return q[e.nodeId]}).links(e.graphData.links);var O=e.dagMode&&_J(e.graphData,function(q){return q[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),j=Math.max.apply(Math,Is(Object.values(O||[]))),L=e.dagLevelDistance||e.graphData.nodes.length/(j||1)*bJ*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var B=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(q){return delete q[B]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var V=["rl","td","zout"].includes(e.dagMode),z=function(Q){return(O[Q[e.nodeId]]-j/2)*L*(V?-1:1)},Y=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(q){return q[Y]=z(q)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?xZ(function(q){var Q=O[q[e.nodeId]]||-1;return(e.dagMode==="radialin"?j-Q:Q)*L}).strength(function(q){return e.dagNodeFilter(q)?1:0}):null)}else{var se=E2.graph();e.graphData.nodes.forEach(function(q){se.addNode(q[e.nodeId])}),e.graphData.links.forEach(function(q){se.addLink(q.source,q.target)}),U=E2.forcelayout(se,mJ({dimensions:e.numDimensions},e.ngraphPhysics)),U.graph=se}for(var J=0;J<e.warmupTicks&&!($&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);J++)U[$?"tick":"step"]();e.layout=U,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function SJ(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=function(i){function s(){var a;ED(this,s);for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];return a=ND(this,s,[].concat(l)),a.__kapsuleInstance=MD(n,[].concat(Is(t?[a]:[]),l)),a}return AD(s,i),CD(s)}(e);return Object.keys(n()).forEach(function(i){return r.prototype[i]=function(){var s,a=(s=this.__kapsuleInstance)[i].apply(s,arguments);return a===this.__kapsuleInstance?this:a}}),r}var TJ=window.THREE?window.THREE:{Group:Yu},DD=SJ(wJ,TJ.Group,!0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const NJ=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class EJ{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=NJ,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:r,material:i,object:s}=e;if(t={material:this.getMaterialData(i),geometry:{id:r.id,attributes:this.getAttributesData(r.attributes),indexVersion:r.index?r.index.version:null,drawRange:{start:r.drawRange.start,count:r.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:a,height:o}=e.context;t.bufferWidth=a,t.bufferHeight=o}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const r in e){const i=e[r];t[r]={version:i.version}}return t}containsNode(e){const t=e.material;for(const r in t)if(t[r]&&t[r].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const r of this.refreshUniforms){const i=e[r];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[r]={id:i.id,version:i.version}:t[r]=i.clone():t[r]=i)}return t}equals(e){const{object:t,material:r,geometry:i}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const a=s.material;for(const b in a){const _=a[b],x=r[b];if(_.equals!==void 0){if(_.equals(x)===!1)return _.copy(x),!1}else if(x.isTexture===!0){if(_.id!==x.id||_.version!==x.version)return _.id=x.id,_.version=x.version,!1}else if(_!==x)return a[b]=x,!1}if(a.transmission>0){const{width:b,height:_}=e.context;if(s.bufferWidth!==b||s.bufferHeight!==_)return s.bufferWidth=b,s.bufferHeight=_,!1}const o=s.geometry,l=i.attributes,u=o.attributes,h=Object.keys(u),p=Object.keys(l);if(o.id!==i.id)return o.id=i.id,!1;if(h.length!==p.length)return s.geometry.attributes=this.getAttributesData(l),!1;for(const b of h){const _=u[b],x=l[b];if(x===void 0)return delete u[b],!1;if(_.version!==x.version)return _.version=x.version,!1}const m=i.index,g=o.indexVersion,y=m?m.version:null;if(g!==y)return o.indexVersion=y,!1;if(o.drawRange.start!==i.drawRange.start||o.drawRange.count!==i.drawRange.count)return o.drawRange.start=i.drawRange.start,o.drawRange.count=i.drawRange.count,!1;if(s.morphTargetInfluences){let b=!1;for(let _=0;_<s.morphTargetInfluences.length;_++)s.morphTargetInfluences[_]!==t.morphTargetInfluences[_]&&(b=!0);if(b)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:r}=t;if(this.renderId!==r)return this.renderId=r,!0;const i=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return i||s?!1:this.equals(e)!==!0}}function Mp(n,e=0){let t=3735928559^e,r=1103547991^e;if(n instanceof Array)for(let i=0,s;i<n.length;i++)s=n[i],t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);else for(let i=0,s;i<n.length;i++)s=n.charCodeAt(i),t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&r)+(t>>>0)}const MJ=n=>Mp(n),dT=n=>Mp(n),hx=(...n)=>Mp(n);function ID(n,e=!1){const t=[];n.isNode===!0&&(t.push(n.id),n=n.getSelf());for(const{property:r,childNode:i}of fx(n))t.push(Mp(r.slice(0,-4)),i.getCacheKey(e));return Mp(t)}function*fx(n,e=!1){for(const t in n){if(t.startsWith("_")===!0)continue;const r=n[t];if(Array.isArray(r)===!0)for(let i=0;i<r.length;i++){const s=r[i];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:i,childNode:s})}else if(r&&r.isNode===!0)yield{property:t,childNode:r};else if(typeof r=="object")for(const i in r){const s=r[i];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:i,childNode:s})}}}const CJ=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),M2=new WeakMap;function AJ(n){return CJ.get(n)}function px(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function jD(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new vt(...e):t==="vec2"?new je(...e):t==="vec3"?new ee(...e):t==="vec4"?new Lt(...e):t==="mat2"?new Qx(...e):t==="mat3"?new Ut(...e):t==="mat4"?new Yt(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?PJ(e[0]):null}function FD(n){let e=M2.get(n);return e===void 0&&(e={},M2.set(n,e)),e}function RJ(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function PJ(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const n0={VERTEX:"vertex"},Xt={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},io={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},kJ=["fragment","vertex"],C2=["setup","analyze","generate"],A2=[...kJ,"compute"],oh=["x","y","z","w"],LJ={analyze:"setup",generate:"analyze"};let DJ=0;class Vt extends _o{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Xt.NONE,this.updateBeforeType=Xt.NONE,this.updateAfterType=Xt.NONE,this.uuid=ax.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:DJ++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,Xt.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Xt.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Xt.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of fx(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=hx(ID(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())t["node"+r++]=i;return t.outputNode||null}analyze(e,t=null){const r=e.increaseUsage(this);if(this.parents===!0){const i=e.getDataFromNode(this,"any");i.stages=i.stages||{},i.stages[e.shaderStage]=i.stages[e.shaderStage]||[],i.stages[e.shaderStage].push(t)}if(r===1){const i=e.getNodeProperties(this);for(const s of Object.values(i))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);const i=e.getDataFromNode(this);i.buildStages=i.buildStages||{},i.buildStages[e.buildStage]=!0;const s=LJ[e.buildStage];if(s&&i.buildStages[s]!==!0){const l=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(l)}e.addNode(this),e.addChain(this);let a=null;const o=e.getBuildStage();if(o==="setup"){this.updateReference(e);const l=e.getNodeProperties(this);if(l.initialized!==!0){l.initialized=!0,l.outputNode=this.setup(e)||l.outputNode||null;for(const u of Object.values(l))if(u&&u.isNode===!0){if(u.parents===!0){const h=e.getNodeProperties(u);h.parents=h.parents||[],h.parents.push(this)}u.build(e)}}a=l.outputNode}else if(o==="analyze")this.analyze(e,t);else if(o==="generate")if(this.generate.length===1){const u=this.getNodeType(e),h=e.getDataFromNode(this);a=h.snippet,a===void 0?h.generated===void 0?(h.generated=!0,a=this.generate(e)||"",h.snippet=a):(console.warn("THREE.Node: Recursion detected.",this),a="/* Recursion detected. */"):h.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,u,t)}else a=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return fx(this)}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:i,index:s,childNode:a}of t)s!==void 0?(r[i]===void 0&&(r[i]=Number.isInteger(s)?[]:{}),r[i][s]=a.toJSON(e.meta).uuid):r[i]=a.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const i=[];for(const s of e.inputNodes[r])i.push(t[s]);this[r]=i}else if(typeof e.inputNodes[r]=="object"){const i={};for(const s in e.inputNodes[r]){const a=e.inputNodes[r][s];i[s]=t[a]}this[r]=i}else{const i=e.inputNodes[r];this[r]=t[i]}}}toJSON(e){const{uuid:t,type:r}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:r,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function a(o){const l=[];for(const u in o){const h=o[u];delete h.metadata,l.push(h)}return l}if(i){const o=a(e.textures),l=a(e.images),u=a(e.nodes);o.length>0&&(s.textures=o),l.length>0&&(s.images=l),u.length>0&&(s.nodes=u)}return s}}class nm extends Vt{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),r=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${r}[ ${i} ]`}}class OD extends Vt{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const i of this.convertTo.split("|"))(r===null||e.getTypeLength(t)===e.getTypeLength(i))&&(r=i);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,i=this.getNodeType(e),s=r.build(e,i);return e.format(s,i,t)}}class Rr extends Vt{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const a=super.build(e,i),o=e.getVarFromNode(this,null,i),l=e.getPropertyName(o);return e.addLineFlowCode(`${l} = ${a}`,this),s.snippet=a,s.propertyName=l,e.format(s.propertyName,i,t)}}return super.build(e,t)}}class IJ extends Rr{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),i=e.getTypeLength(r),s=this.nodes,a=e.getComponentType(r),o=[];let l=0;for(const h of s){if(l>=i){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${r}()' type.`);break}let p=h.getNodeType(e),m=e.getTypeLength(p),g;l+m>i&&(console.error(`THREE.TSL: Length of '${r}()' data exceeds maximum length of output type.`),m=i-l,p=e.getTypeFromLength(m)),l+=m,g=h.build(e,p);const y=e.getComponentType(p);y!==a&&(g=e.format(g,y,a)),o.push(g)}const u=`${e.getType(r)}( ${o.join(", ")} )`;return e.format(u,r,t)}}const jJ=oh.join("");class R2 extends Vt{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(oh.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const r=this.node,i=e.getTypeLength(r.getNodeType(e));let s=null;if(i>1){let a=null;this.getVectorLength()>=i&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=r.build(e,a);this.components.length===i&&this.components===jJ.slice(0,this.components.length)?s=e.format(l,a,t):s=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else s=r.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class FJ extends Rr{static get type(){return"SetNode"}constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:i}=this,s=this.getNodeType(e),a=e.getComponentType(i.getNodeType(e)),o=e.getTypeFromLength(r.length,a),l=i.build(e,o),u=t.build(e,s),h=e.getTypeLength(s),p=[];for(let m=0;m<h;m++){const g=oh[m];g===r[0]?(p.push(l),m+=r.length-1):p.push(u+"."+g)}return`${e.getType(s)}( ${p.join(", ")} )`}}class OJ extends Rr{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:r}=this,i=this.getNodeType(e),s=r.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+" = "+s,this);const l=e.getTypeLength(i),u=[];let h=0;for(let p=0;p<l;p++){const m=oh[p];m===t[h]?(u.push("1.0 - "+(o+"."+m)),h++):u.push(o+"."+m)}return`${e.getType(i)}( ${u.join(", ")} )`}}class hT extends Vt{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?px(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=px(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=RJ(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?jD(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const P2=/float|u?int/;class wo extends hT{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return P2.test(r)&&P2.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),r,t)}}class UJ extends Vt{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let Vd=null;const Zu=new Map;function Ee(n,e){if(Zu.has(n)){console.warn(`THREE.TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);Zu.set(n,e)}const UD=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),k2=n=>UD(n).split("").sort().join(""),BD={setup(n,e){const t=e.shift();return n(ay(t),...e)},get(n,e,t){if(typeof e=="string"&&n[e]===void 0){if(n.isStackNode!==!0&&e==="assign")return(...r)=>(Vd.assign(t,...r),t);if(Zu.has(e)){const r=Zu.get(e);return n.isStackNode?(...i)=>t.add(r(...i)):(...i)=>r(t,...i)}else{if(e==="self")return n;if(e.endsWith("Assign")&&Zu.has(e.slice(0,e.length-6))){const r=Zu.get(e.slice(0,e.length-6));return n.isStackNode?(...i)=>t.assign(i[0],r(...i)):(...i)=>t.assign(r(t,...i))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=UD(e),Fe(new R2(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=k2(e.slice(3).toLowerCase()),r=>Fe(new FJ(n,e,Fe(r)));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=k2(e.slice(4).toLowerCase()),()=>Fe(new OJ(Fe(n),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),Fe(new R2(n,e));if(/^\d+$/.test(e)===!0)return Fe(new nm(t,new wo(Number(e),"uint")));if(/^get$/.test(e)===!0)return r=>Fe(new UJ(t,r))}}}return Reflect.get(n,e,t)},set(n,e,t,r){return typeof e=="string"&&n[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(r[e].assign(t),!0):Reflect.set(n,e,t,r)}},Tb=new WeakMap,L2=new WeakMap,BJ=function(n,e=null){const t=px(n);if(t==="node"){let r=Tb.get(n);return r===void 0&&(r=new Proxy(n,BD),Tb.set(n,r),Tb.set(r,r)),r}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return Fe(pS(n,e));if(t==="shader")return n.isFn?n:ke(n)}return n},zJ=function(n,e=null){for(const t in n)n[t]=Fe(n[t],e);return n},VJ=function(n,e=null){const t=n.length;for(let r=0;r<t;r++)n[r]=Fe(n[r],e);return n},GJ=function(n,e=null,t=null,r=null){const i=h=>Fe(r!==null?Object.assign(h,r):h);let s,a=e,o,l;function u(h){let p;return a?p=/[a-z]/i.test(a)?a+"()":a:p=n.type,o!==void 0&&h.length<o?(console.error(`THREE.TSL: "${p}" parameter length is less than minimum required.`),h.concat(new Array(o-h.length).fill(0))):l!==void 0&&h.length>l?(console.error(`THREE.TSL: "${p}" parameter length exceeds limit.`),h.slice(0,l)):h}return e===null?s=(...h)=>i(new n(...ud(u(h)))):t!==null?(t=Fe(t),s=(...h)=>i(new n(e,...ud(u(h)),t))):s=(...h)=>i(new n(e,...ud(u(h)))),s.setParameterLength=(...h)=>(h.length===1?o=l=h[0]:h.length===2&&([o,l]=h),s),s.setName=h=>(a=h,s),s},HJ=function(n,...e){return Fe(new n(...ud(e)))};class $J extends Vt{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:r}=this,i=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",a=s||"default";if(i[a])return i[a];const o=e.subBuildFn;e.subBuildFn=s;let l=null;if(t.layout){let u=L2.get(e.constructor);u===void 0&&(u=new WeakMap,L2.set(e.constructor,u));let h=u.get(t);h===void 0&&(h=Fe(e.buildFunctionNode(t)),u.set(t,h)),e.addInclude(h),l=Fe(h.call(r))}else{const u=t.jsFunc,h=r!==null||u.length>1?u(r||[],e):u(e);l=Fe(h)}return e.subBuildFn=o,t.once&&(i[a]=l),l}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),r=e.getSubBuildOutput(this);return t[r]=t[r]||this.setupOutput(e),t[r].subBuild=e.getClosestSubBuild(this),t[r]}build(e,t=null){let r=null;const i=e.getBuildStage(),s=e.getNodeProperties(this),a=e.getSubBuildOutput(this),o=this.getOutputNode(e);if(i==="setup"){const l=e.getSubBuildProperty("initialized",this);if(s[l]!==!0&&(s[l]=!0,s[a]=this.getOutputNode(e),s[a].build(e),this.shaderNode.subBuilds))for(const u of e.chaining){const h=e.getDataFromNode(u,"any");h.subBuilds=h.subBuilds||new Set;for(const p of this.shaderNode.subBuilds)h.subBuilds.add(p)}r=s[a]}else i==="analyze"?o.build(e,t):i==="generate"&&(r=o.build(e,t)||"");return r}}class WJ extends Vt{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return ay(e),Fe(new $J(this,e))}setup(){return this.call()}}const qJ=[!1,!0],XJ=[0,1,2,3],YJ=[-1,-2],zD=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],fT=new Map;for(const n of qJ)fT.set(n,new wo(n));const pT=new Map;for(const n of XJ)pT.set(n,new wo(n,"uint"));const mT=new Map([...pT].map(n=>new wo(n.value,"int")));for(const n of YJ)mT.set(n,new wo(n,"int"));const iy=new Map([...mT].map(n=>new wo(n.value)));for(const n of zD)iy.set(n,new wo(n));for(const n of zD)iy.set(-n,new wo(-n));const sy={bool:fT,uint:pT,ints:mT,float:iy},D2=new Map([...fT,...iy]),pS=(n,e)=>D2.has(n)?D2.get(n):n.isNode===!0?n:new wo(n,e),cr=function(n,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(i=>typeof i!="object"))&&(t=[jD(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Fe(e.get(t[0]));if(t.length===1){const i=pS(t[0],n);return i.nodeType===n?Fe(i):Fe(new OD(i,n))}const r=t.map(i=>pS(i));return Fe(new IJ(r,n))}},I2=n=>typeof n=="object"&&n!==null?n.value:n,KJ=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function Lf(n,e){return new Proxy(new WJ(n,e),BD)}const Fe=(n,e=null)=>BJ(n,e),ay=(n,e=null)=>new zJ(n,e),ud=(n,e=null)=>new VJ(n,e),Ue=(...n)=>new GJ(...n),Ye=(...n)=>new HJ(...n);let ZJ=0;const ke=(n,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const r=new Lf(n,t),i=(...s)=>{let a;ay(s),s[0]&&(s[0].isNode||Object.getPrototypeOf(s[0])!==Object.prototype)?a=[...s]:a=s[0];const l=r.call(a);return t==="void"&&l.toStack(),l};if(i.shaderNode=r,i.id=r.id,i.isFn=!0,i.getNodeType=(...s)=>r.getNodeType(...s),i.getCacheKey=(...s)=>r.getCacheKey(...s),i.setLayout=s=>(r.setLayout(s),i),i.once=(s=null)=>(r.once=!0,r.subBuilds=s,i),e!==null){if(typeof e.inputs!="object"){const s={name:"fn"+ZJ++,type:t,inputs:[]};for(const a in e)a!=="return"&&s.inputs.push({name:a,type:e[a]});e=s}i.setLayout(e)}return i},mx=n=>{Vd=n},VD=()=>Vd,nr=(...n)=>Vd.If(...n);function GD(n){return Vd&&Vd.add(n),n}Ee("toStack",GD);const QJ=new cr("color"),Me=new cr("float",sy.float),Cn=new cr("int",sy.ints),JJ=new cr("uint",sy.uint),gT=new cr("bool",sy.bool),Xe=new cr("vec2"),Xa=new cr("ivec2"),eee=new cr("uvec2"),tee=new cr("bvec2"),Ae=new cr("vec3"),nee=new cr("ivec3"),ree=new cr("uvec3"),iee=new cr("bvec3"),zt=new cr("vec4"),see=new cr("ivec4"),aee=new cr("uvec4"),oee=new cr("bvec4"),xT=new cr("mat2"),mi=new cr("mat3"),dd=new cr("mat4");Ee("toColor",QJ);Ee("toFloat",Me);Ee("toInt",Cn);Ee("toUint",JJ);Ee("toBool",gT);Ee("toVec2",Xe);Ee("toIVec2",Xa);Ee("toUVec2",eee);Ee("toBVec2",tee);Ee("toVec3",Ae);Ee("toIVec3",nee);Ee("toUVec3",ree);Ee("toBVec3",iee);Ee("toVec4",zt);Ee("toIVec4",see);Ee("toUVec4",aee);Ee("toBVec4",oee);Ee("toMat2",xT);Ee("toMat3",mi);Ee("toMat4",dd);const lee=Ue(nm).setParameterLength(2),cee=(n,e)=>Fe(new OD(Fe(n),e));Ee("element",lee);Ee("convert",cee);Ee("append",n=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),GD(n)));class mn extends Vt{static get type(){return"PropertyNode"}constructor(e,t=null,r=!1){super(e),this.name=t,this.varying=r,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const ml=(n,e)=>Fe(new mn(n,e)),gx=(n,e)=>Fe(new mn(n,e,!0)),un=Ye(mn,"vec4","DiffuseColor"),j2=Ye(mn,"vec3","EmissiveColor"),Qa=Ye(mn,"float","Roughness"),xx=Ye(mn,"float","Metalness"),mS=Ye(mn,"float","Clearcoat"),yx=Ye(mn,"float","ClearcoatRoughness"),Qu=Ye(mn,"vec3","Sheen"),yT=Ye(mn,"float","SheenRoughness"),vT=Ye(mn,"float","Iridescence"),HD=Ye(mn,"float","IridescenceIOR"),$D=Ye(mn,"float","IridescenceThickness"),gS=Ye(mn,"float","AlphaT"),rc=Ye(mn,"float","Anisotropy"),O0=Ye(mn,"vec3","AnisotropyT"),hd=Ye(mn,"vec3","AnisotropyB"),$i=Ye(mn,"color","SpecularColor"),vx=Ye(mn,"float","SpecularF90"),xS=Ye(mn,"float","Shininess"),Hf=Ye(mn,"vec4","Output"),Nb=Ye(mn,"float","dashSize"),F2=Ye(mn,"float","gapSize"),U0=Ye(mn,"float","IOR"),yS=Ye(mn,"float","Transmission"),WD=Ye(mn,"float","Thickness"),qD=Ye(mn,"float","AttenuationDistance"),XD=Ye(mn,"color","AttenuationColor"),YD=Ye(mn,"float","Dispersion");class KD extends Vt{static get type(){return"UniformGroupNode"}constructor(e,t=!1,r=1){super("string"),this.name=e,this.shared=t,this.order=r,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const uee=n=>new KD(n),_T=(n,e=0)=>new KD(n,!0,e),dee=_T("frame"),It=_T("render"),ZD=uee("object");class rm extends hT{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=ZD}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const r=this.getSelf();return e=e.bind(r),super.onUpdate(i=>{const s=e(i,r);s!==void 0&&(this.value=s)},t)}generate(e,t){const r=this.getNodeType(e),i=this.getUniformHash(e);let s=e.getNodeFromHash(i);s===void 0&&(e.setHashNode(this,i),s=this);const a=s.getInputType(e),o=e.getUniformFromNode(s,a,e.shaderStage,this.name||e.context.label),l=e.getPropertyName(o);return e.context.label!==void 0&&delete e.context.label,e.format(l,r,t)}}const jt=(n,e)=>{const t=KJ(e||n),r=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return Fe(new rm(r,t))};class O2 extends Rr{static get type(){return"ArrayNode"}constructor(e,t,r=null){super(e),this.count=t,this.values=r,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const hee=(...n)=>{let e;if(n.length===1){const t=n[0];e=new O2(null,t.length,t)}else{const t=n[0],r=n[1];e=new O2(t,r)}return Fe(e)};Ee("toArray",(n,e)=>hee(Array(e).fill(n)));class fee extends Rr{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const r=e.getTypeLength(t.node.getNodeType(e));return oh.join("").slice(0,r)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:r}=this,i=e.getNodeProperties(this);i.sourceNode=r,i.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:r,sourceNode:i}=e.getNodeProperties(this),s=this.needsSplitAssign(e),a=r.getNodeType(e),o=r.build(e),l=i.build(e,a),u=i.getNodeType(e),h=e.getDataFromNode(this);let p;if(h.initialized===!0)t!=="void"&&(p=o);else if(s){const m=e.getVarFromNode(this,null,a),g=e.getPropertyName(m);e.addLineFlowCode(`${g} = ${l}`,this);const y=r.node,_=y.node.context({assign:!0}).build(e);for(let x=0;x<y.components.length;x++){const N=y.components[x];e.addLineFlowCode(`${_}.${N} = ${g}[ ${x} ]`,this)}t!=="void"&&(p=o)}else p=`${o} = ${l}`,(t==="void"||u==="void")&&(e.addLineFlowCode(p,this),t!=="void"&&(p=o));return h.initialized=!0,e.format(p,a,t)}}const pee=Ue(fee).setParameterLength(2);Ee("assign",pee);class mee extends Rr{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],r=this.functionNode,i=r.getInputs(e),s=this.parameters,a=(l,u)=>{const h=u.type,p=h==="pointer";let m;return p?m="&"+l.build(e):m=l.build(e,h),m};if(Array.isArray(s)){if(s.length>i.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=i.length;else if(s.length<i.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<i.length;)s.push(Me(0));for(let l=0;l<s.length;l++)t.push(a(s[l],i[l]))}else for(const l of i){const u=s[l.name];u!==void 0?t.push(a(u,l)):(console.error(`THREE.TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(a(Me(0),l)))}return`${r.build(e,"property")}( ${t.join(", ")} )`}}const gee=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?ud(e):ay(e[0]),Fe(new mee(Fe(n),e)));Ee("call",gee);const xee={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Bn extends Rr{static get type(){return"OperatorNode"}constructor(e,t,r,...i){if(super(),i.length>0){let s=new Bn(e,t,r);for(let a=0;a<i.length-1;a++)s=new Bn(e,s,i[a]);t=s,r=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(xee[this.op],t)}getNodeType(e){const t=this.op,r=this.aNode,i=this.bNode,s=r.getNodeType(e),a=i?i.getNodeType(e):null;if(s==="void"||a==="void")return"void";if(t==="%")return s;if(t==="~"||t==="&"||t==="|"||t==="^"||t===">>"||t==="<<")return e.getIntegerType(s);if(t==="!"||t==="&&"||t==="||"||t==="^^")return"bool";if(t==="=="||t==="!="||t==="<"||t===">"||t==="<="||t===">="){const o=Math.max(e.getTypeLength(s),e.getTypeLength(a));return o>1?`bvec${o}`:"bool"}else{if(e.isMatrix(s)){if(a==="float")return s;if(e.isVector(a))return e.getVectorFromMatrix(s);if(e.isMatrix(a))return s}else if(e.isMatrix(a)){if(s==="float")return a;if(e.isVector(s))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(s)?a:s}}generate(e,t){const r=this.op,{aNode:i,bNode:s}=this,a=this.getNodeType(e);let o=null,l=null;a!=="void"?(o=i.getNodeType(e),l=s?s.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="||r==="!="?e.isVector(o)?l=o:e.isVector(l)?o=l:o!==l&&(o=l="float"):r===">>"||r==="<<"?(o=a,l=e.changeComponentType(l,"uint")):r==="%"?(o=a,l=e.isInteger(o)&&e.isInteger(l)?l:o):e.isMatrix(o)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(o):e.isMatrix(l)||(o=l=a):e.isMatrix(l)?o==="float"?o="float":e.isVector(o)?o=e.getVectorFromMatrix(l):o=l=a:o=l=a):o=l=a;const u=i.build(e,o),h=s?s.build(e,l):null,p=e.getFunctionOperator(r);if(t!=="void"){const m=e.renderer.coordinateSystem===fi;if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">=")return m?e.isVector(o)?e.format(`${this.getOperatorMethod(e,t)}( ${u}, ${h} )`,a,t):e.format(`( ${u} ${r} ${h} )`,a,t):e.format(`( ${u} ${r} ${h} )`,a,t);if(r==="%")return e.isInteger(l)?e.format(`( ${u} % ${h} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${u}, ${h} )`,a,t);if(r==="!"||r==="~")return e.format(`(${r}${u})`,o,t);if(p)return e.format(`${p}( ${u}, ${h} )`,a,t);if(e.isMatrix(o)&&l==="float")return e.format(`( ${h} ${r} ${u} )`,a,t);if(o==="float"&&e.isMatrix(l))return e.format(`${u} ${r} ${h}`,a,t);{let g=`( ${u} ${r} ${h} )`;return!m&&a==="bool"&&e.isVector(o)&&e.isVector(l)&&(g=`all${g}`),e.format(g,a,t)}}else if(o!=="void")return p?e.format(`${p}( ${u}, ${h} )`,a,t):e.isMatrix(o)&&l==="float"?e.format(`${h} ${r} ${u}`,a,t):e.format(`${u} ${r} ${h}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Li=Ue(Bn,"+").setParameterLength(2,1/0).setName("add"),ci=Ue(Bn,"-").setParameterLength(2,1/0).setName("sub"),Jt=Ue(Bn,"*").setParameterLength(2,1/0).setName("mul"),_a=Ue(Bn,"/").setParameterLength(2,1/0).setName("div"),bT=Ue(Bn,"%").setParameterLength(2).setName("mod"),QD=Ue(Bn,"==").setParameterLength(2).setName("equal"),yee=Ue(Bn,"!=").setParameterLength(2).setName("notEqual"),vee=Ue(Bn,"<").setParameterLength(2).setName("lessThan"),_ee=Ue(Bn,">").setParameterLength(2).setName("greaterThan"),bee=Ue(Bn,"<=").setParameterLength(2).setName("lessThanEqual"),wee=Ue(Bn,">=").setParameterLength(2).setName("greaterThanEqual"),See=Ue(Bn,"&&").setParameterLength(2,1/0).setName("and"),Tee=Ue(Bn,"||").setParameterLength(2,1/0).setName("or"),Nee=Ue(Bn,"!").setParameterLength(1).setName("not"),Eee=Ue(Bn,"^^").setParameterLength(2).setName("xor"),Mee=Ue(Bn,"&").setParameterLength(2).setName("bitAnd"),Cee=Ue(Bn,"~").setParameterLength(2).setName("bitNot"),Aee=Ue(Bn,"|").setParameterLength(2).setName("bitOr"),Ree=Ue(Bn,"^").setParameterLength(2).setName("bitXor"),Pee=Ue(Bn,"<<").setParameterLength(2).setName("shiftLeft"),kee=Ue(Bn,">>").setParameterLength(2).setName("shiftRight"),Lee=ke(([n])=>(n.addAssign(1),n)),Dee=ke(([n])=>(n.subAssign(1),n)),Iee=ke(([n])=>{const e=Cn(n).toConst();return n.addAssign(1),e}),jee=ke(([n])=>{const e=Cn(n).toConst();return n.subAssign(1),e});Ee("add",Li);Ee("sub",ci);Ee("mul",Jt);Ee("div",_a);Ee("mod",bT);Ee("equal",QD);Ee("notEqual",yee);Ee("lessThan",vee);Ee("greaterThan",_ee);Ee("lessThanEqual",bee);Ee("greaterThanEqual",wee);Ee("and",See);Ee("or",Tee);Ee("not",Nee);Ee("xor",Eee);Ee("bitAnd",Mee);Ee("bitNot",Cee);Ee("bitOr",Aee);Ee("bitXor",Ree);Ee("shiftLeft",Pee);Ee("shiftRight",kee);Ee("incrementBefore",Lee);Ee("decrementBefore",Dee);Ee("increment",Iee);Ee("decrement",jee);const Fee=(n,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),bT(Cn(n),Cn(e)));Ee("modInt",Fee);class pe extends Rr{static get type(){return"MathNode"}constructor(e,t,r=null,i=null){if(super(),(e===pe.MAX||e===pe.MIN)&&arguments.length>3){let s=new pe(e,t,r);for(let a=2;a<arguments.length-1;a++)s=new pe(e,s,arguments[a]);t=s,r=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=r,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(r)?0:e.getTypeLength(r),o=e.isMatrix(i)?0:e.getTypeLength(i);return s>a&&s>o?t:a>o?r:o>s?i:t}getNodeType(e){const t=this.method;return t===pe.LENGTH||t===pe.DISTANCE||t===pe.DOT?"float":t===pe.CROSS?"vec3":t===pe.ALL||t===pe.ANY?"bool":t===pe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:r,method:i}=this;let s=null;if(i===pe.ONE_MINUS)s=ci(1,t);else if(i===pe.RECIPROCAL)s=_a(1,t);else if(i===pe.DIFFERENCE)s=fs(ci(t,r));else if(i===pe.TRANSFORM_DIRECTION){let a=t,o=r;e.isMatrix(a.getNodeType(e))?o=zt(Ae(o),0):a=zt(Ae(a),0);const l=Jt(a,o).xyz;s=Ap(l)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let i=this.method;const s=this.getNodeType(e),a=this.getInputType(e),o=this.aNode,l=this.bNode,u=this.cNode,h=e.renderer.coordinateSystem;if(i===pe.NEGATE)return e.format("( - "+o.build(e,a)+" )",s,t);{const p=[];return i===pe.CROSS?p.push(o.build(e,s),l.build(e,s)):h===fi&&i===pe.STEP?p.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":a),l.build(e,a)):h===fi&&(i===pe.MIN||i===pe.MAX)?p.push(o.build(e,a),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":a)):i===pe.REFRACT?p.push(o.build(e,a),l.build(e,a),u.build(e,"float")):i===pe.MIX?p.push(o.build(e,a),l.build(e,a),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":a)):(h===vl&&i===pe.ATAN&&l!==null&&(i="atan2"),e.shaderStage!=="fragment"&&(i===pe.DFDX||i===pe.DFDY)&&(console.warn(`THREE.TSL: '${i}' is not supported in the ${e.shaderStage} stage.`),i="/*"+i+"*/"),p.push(o.build(e,a)),l!==null&&p.push(l.build(e,a)),u!==null&&p.push(u.build(e,a))),e.format(`${e.getMethod(i,s)}( ${p.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}pe.ALL="all";pe.ANY="any";pe.RADIANS="radians";pe.DEGREES="degrees";pe.EXP="exp";pe.EXP2="exp2";pe.LOG="log";pe.LOG2="log2";pe.SQRT="sqrt";pe.INVERSE_SQRT="inversesqrt";pe.FLOOR="floor";pe.CEIL="ceil";pe.NORMALIZE="normalize";pe.FRACT="fract";pe.SIN="sin";pe.COS="cos";pe.TAN="tan";pe.ASIN="asin";pe.ACOS="acos";pe.ATAN="atan";pe.ABS="abs";pe.SIGN="sign";pe.LENGTH="length";pe.NEGATE="negate";pe.ONE_MINUS="oneMinus";pe.DFDX="dFdx";pe.DFDY="dFdy";pe.ROUND="round";pe.RECIPROCAL="reciprocal";pe.TRUNC="trunc";pe.FWIDTH="fwidth";pe.TRANSPOSE="transpose";pe.BITCAST="bitcast";pe.EQUALS="equals";pe.MIN="min";pe.MAX="max";pe.STEP="step";pe.REFLECT="reflect";pe.DISTANCE="distance";pe.DIFFERENCE="difference";pe.DOT="dot";pe.CROSS="cross";pe.POW="pow";pe.TRANSFORM_DIRECTION="transformDirection";pe.MIX="mix";pe.CLAMP="clamp";pe.REFRACT="refract";pe.SMOOTHSTEP="smoothstep";pe.FACEFORWARD="faceforward";const Oee=Me(1e-6),Uee=Me(Math.PI),Bee=Ue(pe,pe.ALL).setParameterLength(1),zee=Ue(pe,pe.ANY).setParameterLength(1),Vee=Ue(pe,pe.RADIANS).setParameterLength(1),Gee=Ue(pe,pe.DEGREES).setParameterLength(1),JD=Ue(pe,pe.EXP).setParameterLength(1),Cp=Ue(pe,pe.EXP2).setParameterLength(1),eI=Ue(pe,pe.LOG).setParameterLength(1),uo=Ue(pe,pe.LOG2).setParameterLength(1),wT=Ue(pe,pe.SQRT).setParameterLength(1),Hee=Ue(pe,pe.INVERSE_SQRT).setParameterLength(1),bc=Ue(pe,pe.FLOOR).setParameterLength(1),ST=Ue(pe,pe.CEIL).setParameterLength(1),Ap=Ue(pe,pe.NORMALIZE).setParameterLength(1),Tl=Ue(pe,pe.FRACT).setParameterLength(1),Fs=Ue(pe,pe.SIN).setParameterLength(1),sl=Ue(pe,pe.COS).setParameterLength(1),$ee=Ue(pe,pe.TAN).setParameterLength(1),Wee=Ue(pe,pe.ASIN).setParameterLength(1),tI=Ue(pe,pe.ACOS).setParameterLength(1),nI=Ue(pe,pe.ATAN).setParameterLength(1,2),fs=Ue(pe,pe.ABS).setParameterLength(1),_x=Ue(pe,pe.SIGN).setParameterLength(1),ho=Ue(pe,pe.LENGTH).setParameterLength(1),qee=Ue(pe,pe.NEGATE).setParameterLength(1),Xee=Ue(pe,pe.ONE_MINUS).setParameterLength(1),rI=Ue(pe,pe.DFDX).setParameterLength(1),iI=Ue(pe,pe.DFDY).setParameterLength(1),Yee=Ue(pe,pe.ROUND).setParameterLength(1),Kee=Ue(pe,pe.RECIPROCAL).setParameterLength(1),Zee=Ue(pe,pe.TRUNC).setParameterLength(1),Qee=Ue(pe,pe.FWIDTH).setParameterLength(1),Jee=Ue(pe,pe.TRANSPOSE).setParameterLength(1),ete=(n,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),QD(n,e)),Gd=Ue(pe,pe.MIN).setParameterLength(2,1/0),Jr=Ue(pe,pe.MAX).setParameterLength(2,1/0),sI=Ue(pe,pe.STEP).setParameterLength(2),tte=Ue(pe,pe.REFLECT).setParameterLength(2),nte=Ue(pe,pe.DISTANCE).setParameterLength(2),rte=Ue(pe,pe.DIFFERENCE).setParameterLength(2),TT=Ue(pe,pe.DOT).setParameterLength(2),aI=Ue(pe,pe.CROSS).setParameterLength(2),oy=Ue(pe,pe.POW).setParameterLength(2),oI=Ue(pe,pe.POW,2).setParameterLength(1),ite=Ue(pe,pe.POW,3).setParameterLength(1),ste=Ue(pe,pe.POW,4).setParameterLength(1),ate=Ue(pe,pe.TRANSFORM_DIRECTION).setParameterLength(2),ote=n=>Jt(_x(n),oy(fs(n),1/3)),lI=n=>TT(n,n),Ln=Ue(pe,pe.MIX).setParameterLength(3),yo=(n,e=0,t=1)=>Fe(new pe(pe.CLAMP,Fe(n),Fe(e),Fe(t))),cI=n=>yo(n),uI=Ue(pe,pe.REFRACT).setParameterLength(3),bl=Ue(pe,pe.SMOOTHSTEP).setParameterLength(3),lte=Ue(pe,pe.FACEFORWARD).setParameterLength(3),cte=ke(([n])=>{const r=43758.5453,i=TT(n.xy,Xe(12.9898,78.233)),s=bT(i,Uee);return Tl(Fs(s).mul(r))}),ute=(n,e,t)=>Ln(e,t,n),dte=(n,e,t)=>bl(e,t,n),hte=(n,e)=>sI(e,n),fte=(n,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),nI(n,e));Ee("all",Bee);Ee("any",zee);Ee("equals",ete);Ee("radians",Vee);Ee("degrees",Gee);Ee("exp",JD);Ee("exp2",Cp);Ee("log",eI);Ee("log2",uo);Ee("sqrt",wT);Ee("inverseSqrt",Hee);Ee("floor",bc);Ee("ceil",ST);Ee("normalize",Ap);Ee("fract",Tl);Ee("sin",Fs);Ee("cos",sl);Ee("tan",$ee);Ee("asin",Wee);Ee("acos",tI);Ee("atan",nI);Ee("abs",fs);Ee("sign",_x);Ee("length",ho);Ee("lengthSq",lI);Ee("negate",qee);Ee("oneMinus",Xee);Ee("dFdx",rI);Ee("dFdy",iI);Ee("round",Yee);Ee("reciprocal",Kee);Ee("trunc",Zee);Ee("fwidth",Qee);Ee("atan2",fte);Ee("min",Gd);Ee("max",Jr);Ee("step",hte);Ee("reflect",tte);Ee("distance",nte);Ee("dot",TT);Ee("cross",aI);Ee("pow",oy);Ee("pow2",oI);Ee("pow3",ite);Ee("pow4",ste);Ee("transformDirection",ate);Ee("mix",ute);Ee("clamp",yo);Ee("refract",uI);Ee("smoothstep",dte);Ee("faceForward",lte);Ee("difference",rte);Ee("saturate",cI);Ee("cbrt",ote);Ee("transpose",Jee);Ee("rand",cte);class pte extends Vt{static get type(){return"ConditionalNode"}constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){const{ifNode:t,elseNode:r}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const i=t.getNodeType(e);if(r!==null){const s=r.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(i))return s}return i}setup(e){const t=this.condNode.cache(),r=this.ifNode.cache(),i=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(r).parentNodeBlock=s,i!==null&&(e.getDataFromNode(i).parentNodeBlock=s);const a=e.getNodeProperties(this);a.condNode=t,a.ifNode=r.context({nodeBlock:r}),a.elseNode=i?i.context({nodeBlock:i}):null}generate(e,t){const r=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:s,ifNode:a,elseNode:o}=e.getNodeProperties(this),l=e.currentFunctionNode,u=t!=="void",h=u?ml(r).build(e):"";i.nodeProperty=h;const p=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let m=a.build(e,r);if(m&&(u?m=h+" = "+m+";":(m="return "+m+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),m="// "+m))),e.removeFlowTab().addFlowCode(e.tab+"	"+m+`

`+e.tab+"}"),o!==null){e.addFlowCode(` else {

`).addFlowTab();let g=o.build(e,r);g&&(u?g=h+" = "+g+";":(g="return "+g+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),g="// "+g))),e.removeFlowTab().addFlowCode(e.tab+"	"+g+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(h,r,t)}}const pi=Ue(pte).setParameterLength(2,3);Ee("select",pi);class dI extends Vt{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const r=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e,t);return e.setContext(r),i}}const NT=Ue(dI).setParameterLength(1,2),mte=(n,e)=>NT(n,{label:e});Ee("context",NT);Ee("label",mte);class B0 extends Vt{static get type(){return"VarNode"}constructor(e,t=null,r=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=r,this.parents=!0}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:r,readOnly:i}=this,{renderer:s}=e,a=s.backend.isWebGPUBackend===!0;let o=!1,l=!1;i&&(o=e.isDeterministic(t),l=a?i:o);const u=e.getVectorType(this.getNodeType(e)),h=t.build(e,u),p=e.getVarFromNode(this,r,u,void 0,l),m=e.getPropertyName(p);let g=m;if(l)if(a)g=o?`const ${m}`:`let ${m}`;else{const y=e.getArrayCount(t);g=`const ${e.getVar(p.type,m,y)}`}return e.addLineFlowCode(`${g} = ${h}`,this),m}}const ET=Ue(B0),gte=(n,e=null)=>ET(n,e).toStack(),xte=(n,e=null)=>ET(n,e,!0).toStack();Ee("toVar",gte);Ee("toConst",xte);const yte=n=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),ET(n));Ee("temp",yte);class vte extends Vt{static get type(){return"SubBuild"}constructor(e,t,r=null){super(r),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const r=this.node.build(e,...t);return e.removeSubBuild(),r}}const $f=(n,e,t=null)=>Fe(new vte(Fe(n),e,t));class _te extends Vt{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let r=t.varying;if(r===void 0){const i=this.name,s=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=r=e.getVaryingFromNode(this,i,s,a,o),t.node=$f(this.node,"VERTEX")}return r.needsInterpolation||(r.needsInterpolation=e.shaderStage==="fragment"),r}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(n0.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(n0.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),r=e.getNodeProperties(this),i=this.setupVarying(e);if(r[t]===void 0){const s=this.getNodeType(e),a=e.getPropertyName(i,n0.VERTEX);e.flowNodeFromShaderStage(n0.VERTEX,r.node,s,a),r[t]=a}return e.getPropertyName(i)}}const Nl=Ue(_te).setParameterLength(1,2),bte=n=>Nl(n);Ee("toVarying",Nl);Ee("toVertexStage",bte);Ee("varying",(...n)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),Nl(...n)));Ee("vertexStage",(...n)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),Nl(...n)));const wte=ke(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),r=n.lessThanEqual(.04045);return Ln(e,t,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Ste=ke(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),r=n.lessThanEqual(.0031308);return Ln(e,t,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),MT="WorkingColorSpace",Tte="OutputColorSpace";class hI extends Rr{static get type(){return"ColorSpaceNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.source=t,this.target=r}resolveColorSpace(e,t){return t===MT?Ot.workingColorSpace:t===Tte?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,r=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let s=t;return Ot.enabled===!1||r===i||!r||!i||(Ot.getTransfer(r)===st&&(s=zt(wte(s.rgb),s.a)),Ot.getPrimaries(r)!==Ot.getPrimaries(i)&&(s=zt(mi(Ot._getMatrix(new Ut,r,i)).mul(s.rgb),s.a)),Ot.getTransfer(i)===st&&(s=zt(Ste(s.rgb),s.a))),s}}const Nte=(n,e)=>Fe(new hI(Fe(n),MT,e)),CT=(n,e)=>Fe(new hI(Fe(n),e,MT));Ee("workingToColorSpace",Nte);Ee("colorSpaceToWorking",CT);let Ete=class extends nm{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}};class fI extends Vt{static get type(){return"ReferenceBaseNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.updateType=Xt.OBJECT}setGroup(e){return this.group=e,this}element(e){return Fe(new Ete(this,Fe(e)))}setNodeType(e){const t=jt(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Mte=(n,e,t)=>Fe(new fI(n,e,t));class Cte extends fI{static get type(){return"RendererReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.renderer=r,this.setGroup(It)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const Ate=(n,e,t=null)=>Fe(new Cte(n,e,t));class Rte extends Rr{static get type(){return"ToneMappingNode"}constructor(e,t=kte,r=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=r}customCacheKey(){return hx(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,r=this.toneMapping;if(r===Pi)return t;let i=null;const s=e.renderer.library.getToneMappingFunction(r);return s!==null?i=zt(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",r),i=t),i}}const Pte=(n,e,t)=>Fe(new Rte(n,Fe(e),Fe(t))),kte=Ate("toneMappingExposure","float");Ee("toneMapping",(n,e,t)=>Pte(e,t,n));class Lte extends hT{static get type(){return"BufferAttributeNode"}constructor(e,t=null,r=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=i,this.usage=sx,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),r=this.value,i=e.getTypeLength(t),s=this.bufferStride||i,a=this.bufferOffset,o=r.isInterleavedBuffer===!0?r:new Y1(r,s),l=new Ep(o,i,a);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(r);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,s=i):s=Nl(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const AT=(n,e=null,t=0,r=0)=>Fe(new Lte(n,e,t,r)),Dte=(n,e=null,t=0,r=0)=>AT(n,e,t,r).setUsage(Xu),U2=(n,e=null,t=0,r=0)=>AT(n,e,t,r).setInstanced(!0),B2=(n,e=null,t=0,r=0)=>Dte(n,e,t,r).setInstanced(!0);Ee("toAttribute",n=>AT(n.value));class Ite extends Vt{static get type(){return"ComputeNode"}constructor(e,t,r=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=r,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=Xt.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let r=t[0];for(let i=1;i<t.length;i++)r*=t[i];this.dispatchCount=Math.ceil(e/r)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const r=e.getNodeProperties(this);r.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:r}=e;if(r==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const jte=(n,e,t)=>Fe(new Ite(Fe(n),e,t));Ee("compute",jte);class Fte extends Vt{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const r=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const s=this.node.build(e,...t);return e.setCache(r),s}}const z0=(n,e)=>Fe(new Fte(Fe(n),e));Ee("cache",z0);class Ote extends Vt{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const Ute=Ue(Ote).setParameterLength(2);Ee("bypass",Ute);class pI extends Vt{static get type(){return"RemapNode"}constructor(e,t,r,i=Me(0),s=Me(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=i,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:r,outLowNode:i,outHighNode:s,doClamp:a}=this;let o=e.sub(t).div(r.sub(t));return a===!0&&(o=o.clamp()),o.mul(s.sub(i)).add(i)}}const Bte=Ue(pI,null,null,{doClamp:!1}).setParameterLength(3,5),zte=Ue(pI).setParameterLength(3,5);Ee("remap",Bte);Ee("remapClamp",zte);class V0 extends Vt{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const r=this.getNodeType(e),i=this.snippet;if(r==="void")e.addLineFlowCode(i,this);else return e.format(i,r,t)}}const Hd=Ue(V0).setParameterLength(1,2),Vte=n=>(n?pi(n,Hd("discard")):Hd("discard")).toStack();Ee("discard",Vte);class Gte extends Rr{static get type(){return"RenderOutputNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=r,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const r=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Pi,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||ui;return r!==Pi&&(t=t.toneMapping(r)),i!==ui&&i!==Ot.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const Hte=(n,e=null,t=null)=>Fe(new Gte(Fe(n),e,t));Ee("renderOutput",Hte);class $te extends Rr{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,r=this.node.build(e),i="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(i.length);let a="";return a+="// #"+i+`#
`,a+=e.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+r+` /* ... */
`,a+="// #"+s+`#
`,t!==null?t(e,a):console.log(a),r}}const Wte=(n,e=null)=>Fe(new $te(Fe(n),e));Ee("debug",Wte);class mI extends Vt{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const i=e.geometry.getAttribute(r);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),r=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),a=e.getTypeFromAttribute(s),o=e.getAttribute(t,a);return e.shaderStage==="vertex"?e.format(o.name,a,r):Nl(this).build(e,r)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const wl=(n,e=null)=>Fe(new mI(n,e)),im=(n=0)=>wl("uv"+(n>0?n:""),"vec2");class qte extends Vt{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const r=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${i} )`,this.getNodeType(e),t)}}const fd=Ue(qte).setParameterLength(1,2);class Xte extends rm{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Xt.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,r=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(r&&r.width!==void 0){const{width:i,height:s}=r;this.value=Math.log2(Math.max(i,s))}}}const Yte=Ue(Xte).setParameterLength(1),gI=new Jn;class lh extends rm{static get type(){return"TextureNode"}constructor(e=gI,t=null,r=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Xt.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===En?"uvec4":this.value.type===Er?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return im(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=jt(this.value.matrix)),this._matrixUniform.mul(Ae(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Xt.OBJECT:Xt.NONE,this}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.image instanceof ImageBitmap&&r.flipY===!0||r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0||r.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Cn(fd(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const r=this.value;if(!r||r.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let i=this.uvNode;(i===null||e.context.forceUVContext===!0)&&e.context.getUV&&(i=e.context.getUV(this,e)),i||(i=this.getDefaultUV()),this.updateMatrix===!0&&(i=this.getTransformedUV(i)),i=this.setupUV(e,i);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,r,i,s,a,o,l){const u=this.value;let h;return i?h=e.generateTextureLevel(u,t,r,i,a):s?h=e.generateTextureBias(u,t,r,s,a):l?h=e.generateTextureGrad(u,t,r,l,a):o?h=e.generateTextureCompare(u,t,r,o,a):this.sampler===!1?h=e.generateTextureLoad(u,t,r,a):h=e.generateTexture(u,t,r,a),h}generate(e,t){const r=this.value,i=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const a=e.getDataFromNode(this);let o=a.propertyName;if(o===void 0){const{uvNode:h,levelNode:p,biasNode:m,compareNode:g,depthNode:y,gradNode:b}=i,_=this.generateUV(e,h),x=p?p.build(e,"float"):null,N=m?m.build(e,"float"):null,T=y?y.build(e,"int"):null,S=g?g.build(e,"float"):null,M=b?[b[0].build(e,"vec2"),b[1].build(e,"vec2")]:null,C=e.getVarFromNode(this);o=e.getPropertyName(C);const R=this.generateSnippet(e,s,_,x,N,T,S,M);e.addLineFlowCode(`${o} = ${R}`,this),a.snippet=R,a.propertyName=o}let l=o;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(l=CT(Hd(l,u),r.colorSpace).setup(e).build(e,u)),e.format(l,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}blur(e){const t=this.clone();t.biasNode=Fe(e).mul(Yte(t)),t.referenceNode=this.getSelf();const r=t.value;return t.generateMipmaps===!1&&(r&&r.generateMipmaps===!1||r.minFilter===An||r.magFilter===An)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Fe(t)}level(e){const t=this.clone();return t.levelNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}size(e){return fd(this,e)}bias(e){const t=this.clone();return t.biasNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}compare(e){const t=this.clone();return t.compareNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}grad(e,t){const r=this.clone();return r.gradNode=[Fe(e),Fe(t)],r.referenceNode=this.getSelf(),Fe(r)}depth(e){const t=this.clone();return t.depthNode=Fe(e),t.referenceNode=this.getSelf(),Fe(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}const Kte=Ue(lh).setParameterLength(1,4).setName("texture"),ln=(n=gI,e=null,t=null,r=null)=>{let i;return n&&n.isTextureNode===!0?(i=Fe(n.clone()),i.referenceNode=n.getSelf(),e!==null&&(i.uvNode=Fe(e)),t!==null&&(i.levelNode=Fe(t)),r!==null&&(i.biasNode=Fe(r))):i=Kte(n,e,t,r),i},Ls=(...n)=>ln(...n).setSampler(!1);class xI extends rm{static get type(){return"BufferNode"}constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const yI=(n,e,t)=>Fe(new xI(n,e,t));class Zte extends nm{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),r=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,r)}}class Qte extends xI{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?px(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Xt.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,r=this.elementType;if(r==="float"||r==="int"||r==="uint")for(let i=0;i<e.length;i++){const s=i*4;t[s]=e[i]}else if(r==="color")for(let i=0;i<e.length;i++){const s=i*4,a=e[i];t[s]=a.r,t[s+1]=a.g,t[s+2]=a.b||0}else if(r==="mat2")for(let i=0;i<e.length;i++){const s=i*4,a=e[i];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+3]=a.elements[3]}else if(r==="mat3")for(let i=0;i<e.length;i++){const s=i*16,a=e[i];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+4]=a.elements[3],t[s+5]=a.elements[4],t[s+6]=a.elements[5],t[s+8]=a.elements[6],t[s+9]=a.elements[7],t[s+10]=a.elements[8],t[s+15]=1}else if(r==="mat4")for(let i=0;i<e.length;i++){const s=i*16,a=e[i];for(let o=0;o<a.elements.length;o++)t[s+o]=a.elements[o]}else for(let i=0;i<e.length;i++){const s=i*4,a=e[i];t[s]=a.x,t[s+1]=a.y,t[s+2]=a.z||0,t[s+3]=a.w||0}}setup(e){const t=this.array.length,r=this.elementType;let i=Float32Array;const s=this.paddedType,a=e.getTypeLength(s);return r.charAt(0)==="i"&&(i=Int32Array),r.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*a),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return Fe(new Zte(this,Fe(e)))}}const aa=(n,e)=>Fe(new Qte(n,e));class Jte extends Vt{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const ly=Ue(Jte).setParameterLength(1),vI=jt(0,"uint").label("u_cameraIndex").setGroup(_T("cameraIndex")).toVarying("v_cameraIndex"),oc=jt("float").label("cameraNear").setGroup(It).onRenderUpdate(({camera:n})=>n.near),lc=jt("float").label("cameraFar").setGroup(It).onRenderUpdate(({camera:n})=>n.far),RT=ke(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrix);e=aa(t).setGroup(It).label("cameraProjectionMatrices").element(n.isMultiViewCamera?ly("gl_ViewID_OVR"):vI).toVar("cameraProjectionMatrix")}else e=jt("mat4").label("cameraProjectionMatrix").setGroup(It).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),So=ke(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorldInverse);e=aa(t).setGroup(It).label("cameraViewMatrices").element(n.isMultiViewCamera?ly("gl_ViewID_OVR"):vI).toVar("cameraViewMatrix")}else e=jt("mat4").label("cameraViewMatrix").setGroup(It).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),ene=jt(new ee).label("cameraPosition").setGroup(It).onRenderUpdate(({camera:n},e)=>e.value.setFromMatrixPosition(n.matrixWorld)),z2=new Kp;class vn extends Vt{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Xt.OBJECT,this.uniformNode=new rm(null)}getNodeType(){const e=this.scope;if(e===vn.WORLD_MATRIX)return"mat4";if(e===vn.POSITION||e===vn.VIEW_POSITION||e===vn.DIRECTION||e===vn.SCALE)return"vec3";if(e===vn.RADIUS)return"float"}update(e){const t=this.object3d,r=this.uniformNode,i=this.scope;if(i===vn.WORLD_MATRIX)r.value=t.matrixWorld;else if(i===vn.POSITION)r.value=r.value||new ee,r.value.setFromMatrixPosition(t.matrixWorld);else if(i===vn.SCALE)r.value=r.value||new ee,r.value.setFromMatrixScale(t.matrixWorld);else if(i===vn.DIRECTION)r.value=r.value||new ee,t.getWorldDirection(r.value);else if(i===vn.VIEW_POSITION){const s=e.camera;r.value=r.value||new ee,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(s.matrixWorldInverse)}else if(i===vn.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),z2.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),r.value=z2.radius}}generate(e){const t=this.scope;return t===vn.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===vn.POSITION||t===vn.VIEW_POSITION||t===vn.DIRECTION||t===vn.SCALE?this.uniformNode.nodeType="vec3":t===vn.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}vn.WORLD_MATRIX="worldMatrix";vn.POSITION="position";vn.SCALE="scale";vn.VIEW_POSITION="viewPosition";vn.DIRECTION="direction";vn.RADIUS="radius";const tne=Ue(vn,vn.POSITION).setParameterLength(1);class vs extends vn{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}vs.DIRECTION;const Cc=Ye(vs,vs.WORLD_MATRIX);vs.POSITION;vs.SCALE;vs.VIEW_POSITION;vs.RADIUS;const nne=jt(new Ut).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),cy=ke(n=>n.renderer.overrideNodes.modelViewMatrix||rne).once()().toVar("modelViewMatrix"),rne=So.mul(Cc),V2=ke(n=>(n.context.isHighPrecisionModelViewMatrix=!0,jt("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),G2=ke(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return jt("mat3").onObjectUpdate(({object:t,camera:r})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),uy=wl("position","vec3"),Zr=uy.toVarying("positionLocal"),H2=uy.toVarying("positionPrevious"),Rp=ke(n=>Cc.mul(Zr).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),_I=ke(()=>Zr.transformDirection(Cc).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),Qn=ke(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Gn=Qn.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class ine extends Vt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{renderer:t,material:r}=e;return t.coordinateSystem===fi&&r.side===bn?"false":e.getFrontFacing()}}const sne=Ye(ine),bI=Me(sne).mul(2).sub(1),sm=ke(([n],{material:e})=>{const t=e.side;return t===bn?n=n.mul(-1):t===Yr&&(n=n.mul(bI)),n}),wI=wl("normal","vec3"),ba=ke(n=>n.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),Ae(0,1,0)):wI,"vec3").once()().toVar("normalLocal"),ane=Qn.dFdx().cross(Qn.dFdy()).normalize().toVar("normalFlat"),Pp=ke(n=>{let e;return n.material.flatShading===!0?e=ane:e=SI(ba).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),one=ke(n=>{let e=Pp.transformDirection(So);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),xn=ke(({subBuildFn:n,material:e,context:t})=>{let r;return n==="NORMAL"||n==="VERTEX"?(r=Pp,e.flatShading!==!0&&(r=sm(r))):r=t.setupNormal().context({getUV:null}),r},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),ch=xn.transformDirection(So).toVar("normalWorld"),Ju=ke(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=xn:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),lne=ke(([n,e=Cc])=>{const t=mi(e),r=n.div(Ae(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(r).xyz}),SI=ke(([n],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(n);const r=nne.mul(n);return So.transformDirection(r)});ke(()=>(console.warn('THREE.TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),xn)).once(["NORMAL","VERTEX"])();ke(()=>(console.warn('THREE.TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),ch)).once(["NORMAL","VERTEX"])();ke(()=>(console.warn('THREE.TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Ju)).once(["NORMAL","VERTEX"])();const $2=new ki,Eb=new Yt,cne=jt(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),Mb=jt(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),TI=jt(new Yt).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?($2.copy(t),Eb.makeRotationFromEuler($2)):Eb.identity(),Eb}),une=Gn.negate().reflect(xn),dne=Gn.negate().refract(xn,cne),hne=une.transformDirection(So).toVar("reflectVector"),fne=dne.transformDirection(So).toVar("reflectVector"),pne=new Zp;class mne extends lh{static get type(){return"CubeTextureNode"}constructor(e,t=null,r=null,i=null){super(e,t,r,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===xa?hne:e.mapping===ya?fne:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),Ae(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return(e.renderer.coordinateSystem===vl||!r.isRenderTargetTexture)&&(t=Ae(t.x.negate(),t.yz)),TI.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const gne=Ue(mne).setParameterLength(1,4).setName("cubeTexture"),kp=(n=pne,e=null,t=null,r=null)=>{let i;return n&&n.isCubeTextureNode===!0?(i=Fe(n.clone()),i.referenceNode=n.getSelf(),e!==null&&(i.uvNode=Fe(e)),t!==null&&(i.levelNode=Fe(t)),r!==null&&(i.biasNode=Fe(r))):i=gne(n,e,t,r),i};class xne extends nm{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}}class PT extends Vt{static get type(){return"ReferenceNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=Xt.OBJECT}element(e){return Fe(new xne(this,Fe(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=yI(null,e,this.count):Array.isArray(this.getValueFromReference())?t=aa(null,e):e==="texture"?t=ln(null):e==="cubeTexture"?t=kp(null):t=jt(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Nn=(n,e,t)=>Fe(new PT(n,e,t)),W2=(n,e,t,r)=>Fe(new PT(n,e,r,t));class yne extends PT{static get type(){return"MaterialReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.material=r,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const ol=(n,e,t=null)=>Fe(new yne(n,e,t)),NI=im(),vne=Qn.dFdx(),_ne=Qn.dFdy(),EI=NI.dFdx(),MI=NI.dFdy(),CI=xn,AI=_ne.cross(CI),RI=CI.cross(vne),vS=AI.mul(EI.x).add(RI.mul(MI.x)),_S=AI.mul(EI.y).add(RI.mul(MI.y)),q2=vS.dot(vS).max(_S.dot(_S)),PI=q2.equal(0).select(0,q2.inverseSqrt()),bne=vS.mul(PI).toVar("tangentViewFrame"),wne=_S.mul(PI).toVar("bitangentViewFrame"),kI=ke(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),wl("tangent","vec4")))(),kT=kI.xyz.toVar("tangentLocal"),LI=ke(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=cy.mul(zt(kT,0)).xyz.toVarying("v_tangentView").normalize():r=bne,t.flatShading!==!0&&(r=sm(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),Sne=ke(([n,e],{subBuildFn:t,material:r})=>{let i=n.mul(kI.w).xyz;return t==="NORMAL"&&r.flatShading!==!0&&(i=i.toVarying(e)),i}).once(["NORMAL"]),Tne=ke(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=Sne(xn.cross(LI),"v_bitangentView").normalize():r=wne,t.flatShading!==!0&&(r=sm(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),Df=mi(LI,Tne,xn).toVar("TBNViewMatrix"),Nne=ke(()=>{let n=hd.cross(Gn);return n=n.cross(hd).normalize(),n=Ln(n,xn,rc.mul(Qa.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()();class Ene extends Rr{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=xo}setup({material:e}){const{normalMapType:t,scaleNode:r}=this;let i=this.node.mul(2).sub(1);if(r!==null){let a=r;e.flatShading===!0&&(a=sm(a)),i=Ae(i.xy.mul(a),i.z)}let s=null;return t===j3?s=SI(i):t===xo?s=Df.mul(i).normalize():(console.error(`THREE.NodeMaterial: Unsupported normal map type: ${t}`),s=xn),s}}const X2=Ue(Ene).setParameterLength(1,2),Mne=ke(({textureNode:n,bumpScale:e})=>{const t=i=>n.cache().context({getUV:s=>i(s.uvNode||im()),forceUVContext:!0}),r=Me(t(i=>i));return Xe(Me(t(i=>i.add(i.dFdx()))).sub(r),Me(t(i=>i.add(i.dFdy()))).sub(r)).mul(e)}),Cne=ke(n=>{const{surf_pos:e,surf_norm:t,dHdxy:r}=n,i=e.dFdx().normalize(),s=e.dFdy().normalize(),a=t,o=s.cross(a),l=a.cross(i),u=i.dot(o).mul(bI),h=u.sign().mul(r.x.mul(o).add(r.y.mul(l)));return u.abs().mul(t).sub(h).normalize()});class Ane extends Rr{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Mne({textureNode:this.textureNode,bumpScale:e});return Cne({surf_pos:Qn,surf_norm:xn,dHdxy:t})}}const Rne=Ue(Ane).setParameterLength(1,2),Y2=new Map;class Se extends Vt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let r=Y2.get(e);return r===void 0&&(r=ol(e,t),Y2.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,r=this.scope;let i=null;if(r===Se.COLOR){const s=t.color!==void 0?this.getColor(r):Ae();t.map&&t.map.isTexture===!0?i=s.mul(this.getTexture("map")):i=s}else if(r===Se.OPACITY){const s=this.getFloat(r);t.alphaMap&&t.alphaMap.isTexture===!0?i=s.mul(this.getTexture("alpha")):i=s}else if(r===Se.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=Me(1);else if(r===Se.SPECULAR_INTENSITY){const s=this.getFloat(r);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s}else if(r===Se.SPECULAR_COLOR){const s=this.getColor(r);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=s.mul(this.getTexture(r).rgb):i=s}else if(r===Se.ROUGHNESS){const s=this.getFloat(r);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).g):i=s}else if(r===Se.METALNESS){const s=this.getFloat(r);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=s.mul(this.getTexture(r).b):i=s}else if(r===Se.EMISSIVE){const s=this.getFloat("emissiveIntensity"),a=this.getColor(r).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=a.mul(this.getTexture(r)):i=a}else if(r===Se.NORMAL)t.normalMap?(i=X2(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType):t.bumpMap?i=Rne(this.getTexture("bump").r,this.getFloat("bumpScale")):i=xn;else if(r===Se.CLEARCOAT){const s=this.getFloat(r);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===Se.CLEARCOAT_ROUGHNESS){const s=this.getFloat(r);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===Se.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=X2(this.getTexture(r),this.getCache(r+"Scale","vec2")):i=xn;else if(r===Se.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=s.mul(this.getTexture("sheenColor").rgb):i=s}else if(r===Se.SHEEN_ROUGHNESS){const s=this.getFloat(r);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s,i=i.clamp(.07,1)}else if(r===Se.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(r);i=xT(ff.x,ff.y,ff.y.negate(),ff.x).mul(s.rg.mul(2).sub(Xe(1)).normalize().mul(s.b))}else i=ff;else if(r===Se.IRIDESCENCE_THICKNESS){const s=Nn("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const a=Nn("0","float",t.iridescenceThicknessRange);i=s.sub(a).mul(this.getTexture(r).g).add(a)}else i=s}else if(r===Se.TRANSMISSION){const s=this.getFloat(r);t.transmissionMap?i=s.mul(this.getTexture(r).r):i=s}else if(r===Se.THICKNESS){const s=this.getFloat(r);t.thicknessMap?i=s.mul(this.getTexture(r).g):i=s}else if(r===Se.IOR)i=this.getFloat(r);else if(r===Se.LIGHT_MAP)i=this.getTexture(r).rgb.mul(this.getFloat("lightMapIntensity"));else if(r===Se.AO)i=this.getTexture(r).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(r===Se.LINE_DASH_OFFSET)i=t.dashOffset?this.getFloat(r):Me(0);else{const s=this.getNodeType(e);i=this.getCache(r,s)}return i}}Se.ALPHA_TEST="alphaTest";Se.COLOR="color";Se.OPACITY="opacity";Se.SHININESS="shininess";Se.SPECULAR="specular";Se.SPECULAR_STRENGTH="specularStrength";Se.SPECULAR_INTENSITY="specularIntensity";Se.SPECULAR_COLOR="specularColor";Se.REFLECTIVITY="reflectivity";Se.ROUGHNESS="roughness";Se.METALNESS="metalness";Se.NORMAL="normal";Se.CLEARCOAT="clearcoat";Se.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Se.CLEARCOAT_NORMAL="clearcoatNormal";Se.EMISSIVE="emissive";Se.ROTATION="rotation";Se.SHEEN="sheen";Se.SHEEN_ROUGHNESS="sheenRoughness";Se.ANISOTROPY="anisotropy";Se.IRIDESCENCE="iridescence";Se.IRIDESCENCE_IOR="iridescenceIOR";Se.IRIDESCENCE_THICKNESS="iridescenceThickness";Se.IOR="ior";Se.TRANSMISSION="transmission";Se.THICKNESS="thickness";Se.ATTENUATION_DISTANCE="attenuationDistance";Se.ATTENUATION_COLOR="attenuationColor";Se.LINE_SCALE="scale";Se.LINE_DASH_SIZE="dashSize";Se.LINE_GAP_SIZE="gapSize";Se.LINE_WIDTH="linewidth";Se.LINE_DASH_OFFSET="dashOffset";Se.POINT_SIZE="size";Se.DISPERSION="dispersion";Se.LIGHT_MAP="light";Se.AO="ao";const Pne=Ye(Se,Se.ALPHA_TEST),kne=Ye(Se,Se.COLOR),Lne=Ye(Se,Se.SHININESS),Dne=Ye(Se,Se.EMISSIVE),DI=Ye(Se,Se.OPACITY),Ine=Ye(Se,Se.SPECULAR),K2=Ye(Se,Se.SPECULAR_INTENSITY),jne=Ye(Se,Se.SPECULAR_COLOR),G0=Ye(Se,Se.SPECULAR_STRENGTH),Cb=Ye(Se,Se.REFLECTIVITY),Fne=Ye(Se,Se.ROUGHNESS),One=Ye(Se,Se.METALNESS),Une=Ye(Se,Se.NORMAL),Bne=Ye(Se,Se.CLEARCOAT),zne=Ye(Se,Se.CLEARCOAT_ROUGHNESS),Vne=Ye(Se,Se.CLEARCOAT_NORMAL),Gne=Ye(Se,Se.ROTATION),Hne=Ye(Se,Se.SHEEN),$ne=Ye(Se,Se.SHEEN_ROUGHNESS),Wne=Ye(Se,Se.ANISOTROPY),qne=Ye(Se,Se.IRIDESCENCE),Xne=Ye(Se,Se.IRIDESCENCE_IOR),Yne=Ye(Se,Se.IRIDESCENCE_THICKNESS),Kne=Ye(Se,Se.TRANSMISSION),Zne=Ye(Se,Se.THICKNESS),Qne=Ye(Se,Se.IOR),Jne=Ye(Se,Se.ATTENUATION_DISTANCE),ere=Ye(Se,Se.ATTENUATION_COLOR),tre=Ye(Se,Se.LINE_SCALE),nre=Ye(Se,Se.LINE_DASH_SIZE),rre=Ye(Se,Se.LINE_GAP_SIZE);Se.LINE_WIDTH;const ire=Ye(Se,Se.LINE_DASH_OFFSET),sre=Ye(Se,Se.POINT_SIZE),are=Ye(Se,Se.DISPERSION),II=Ye(Se,Se.LIGHT_MAP),ore=Ye(Se,Se.AO),ff=jt(new je).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),jI=ke(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Dn extends Vt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),r=this.scope;let i;if(r===Dn.VERTEX)i=e.getVertexIndex();else if(r===Dn.INSTANCE)i=e.getInstanceIndex();else if(r===Dn.DRAW)i=e.getDrawIndex();else if(r===Dn.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(r===Dn.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(r===Dn.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+r);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=i:s=Nl(this).build(e,t),s}}Dn.VERTEX="vertex";Dn.INSTANCE="instance";Dn.SUBGROUP="subgroup";Dn.INVOCATION_LOCAL="invocationLocal";Dn.INVOCATION_SUBGROUP="invocationSubgroup";Dn.DRAW="draw";const lre=Ye(Dn,Dn.VERTEX),LT=Ye(Dn,Dn.INSTANCE);Dn.SUBGROUP;Dn.INVOCATION_SUBGROUP;Dn.INVOCATION_LOCAL;const cre=Ye(Dn,Dn.DRAW);class ure extends Vt{static get type(){return"InstanceNode"}constructor(e,t,r=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=r,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Xt.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:r,instanceColor:i}=this;let{instanceMatrixNode:s,instanceColorNode:a}=this;if(s===null){if(t<=1e3)s=yI(r.array,"mat4",Math.max(t,1)).element(LT);else{const l=new _W(r.array,16,1);this.buffer=l;const u=r.usage===Xu?B2:U2,h=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];s=dd(...h)}this.instanceMatrixNode=s}if(i&&a===null){const l=new R9(i.array,3),u=i.usage===Xu?B2:U2;this.bufferColor=l,a=Ae(u(l,"vec3",3,0)),this.instanceColorNode=a}const o=s.mul(Zr).xyz;if(Zr.assign(o),e.hasGeometryAttribute("normal")){const l=lne(ba,s);ba.assign(l)}this.instanceColorNode!==null&&gx("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==Xu&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==Xu&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class dre extends ure{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:r,instanceColor:i}=e;super(t,r,i),this.instancedMesh=e}}const hre=Ue(dre).setParameterLength(1);class fre extends Vt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=LT:this.batchingIdNode=cre);const r=ke(([y])=>{const b=Cn(fd(Ls(this.batchMesh._indirectTexture),0).x),_=Cn(y).mod(b),x=Cn(y).div(b);return Ls(this.batchMesh._indirectTexture,Xa(_,x)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Cn(this.batchingIdNode)),i=this.batchMesh._matricesTexture,s=Cn(fd(Ls(i),0).x),a=Me(r).mul(4).toInt().toVar(),o=a.mod(s),l=a.div(s),u=dd(Ls(i,Xa(o,l)),Ls(i,Xa(o.add(1),l)),Ls(i,Xa(o.add(2),l)),Ls(i,Xa(o.add(3),l))),h=this.batchMesh._colorsTexture;if(h!==null){const b=ke(([_])=>{const x=Cn(fd(Ls(h),0).x),N=_,T=N.mod(x),S=N.div(x);return Ls(h,Xa(T,S)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(r);gx("vec3","vBatchColor").assign(b)}const p=mi(u);Zr.assign(u.mul(Zr));const m=ba.div(Ae(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),g=p.mul(m).xyz;ba.assign(g),e.hasGeometryAttribute("tangent")&&kT.mulAssign(p)}}const pre=Ue(fre).setParameterLength(1),Z2=new WeakMap;class mre extends Vt{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Xt.OBJECT,this.skinIndexNode=wl("skinIndex","uvec4"),this.skinWeightNode=wl("skinWeight","vec4"),this.bindMatrixNode=Nn("bindMatrix","mat4"),this.bindMatrixInverseNode=Nn("bindMatrixInverse","mat4"),this.boneMatricesNode=W2("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Zr,this.toPositionNode=Zr,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(r.x),l=e.element(r.y),u=e.element(r.z),h=e.element(r.w),p=s.mul(t),m=Li(o.mul(i.x).mul(p),l.mul(i.y).mul(p),u.mul(i.z).mul(p),h.mul(i.w).mul(p));return a.mul(m).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=ba){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:a}=this,o=e.element(r.x),l=e.element(r.y),u=e.element(r.z),h=e.element(r.w);let p=Li(i.x.mul(o),i.y.mul(l),i.z.mul(u),i.w.mul(h));return p=a.mul(p).mul(s),p.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=W2("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,H2)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||FD(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&H2.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const r=this.getSkinnedNormal();ba.assign(r),e.hasGeometryAttribute("tangent")&&kT.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Z2.get(t)!==e.frameId&&(Z2.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const gre=n=>Fe(new mre(n));class xre extends Vt{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const r={};for(let a=0,o=this.params.length-1;a<o;a++){const l=this.params[a],u=l.isNode!==!0&&l.name||this.getVarName(a),h=l.isNode!==!0&&l.type||"int";r[u]=Hd(u,h)}const i=e.addStack();t.returnsNode=this.params[this.params.length-1](r,e),t.stackNode=i;const s=this.params[0];return s.isNode!==!0&&typeof s.update=="function"&&(t.updateNode=ke(this.params[0].update)(r)),e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),r=this.params,i=t.stackNode;for(let o=0,l=r.length-1;o<l;o++){const u=r[o];let h=!1,p=null,m=null,g=null,y=null,b=null,_=null;u.isNode?u.getNodeType(e)==="bool"?(h=!0,y="bool",m=u.build(e,y)):(y="int",g=this.getVarName(o),p="0",m=u.build(e,y),b="<"):(y=u.type||"int",g=u.name||this.getVarName(o),p=u.start,m=u.end,b=u.condition,_=u.update,typeof p=="number"?p=e.generateConst(y,p):p&&p.isNode&&(p=p.build(e,y)),typeof m=="number"?m=e.generateConst(y,m):m&&m.isNode&&(m=m.build(e,y)),p!==void 0&&m===void 0?(p=p+" - 1",m="0",b=">="):m!==void 0&&p===void 0&&(p="0",b="<"),b===void 0&&(Number(p)>Number(m)?b=">=":b="<"));let x;if(h)x=`while ( ${m} )`;else{const N={start:p,end:m},T=N.start,S=N.end;let M;const C=()=>b.includes("<")?"+=":"-=";if(_!=null)switch(typeof _){case"function":M=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":M=g+" "+C()+" "+e.generateConst(y,_);break;case"string":M=g+" "+_;break;default:_.isNode?M=g+" "+C()+" "+_.build(e):(console.error("THREE.TSL: 'Loop( { update: ... } )' is not a function, string or number."),M="break /* invalid update */")}else y==="int"||y==="uint"?_=b.includes("<")?"++":"--":_=C()+" 1.",M=g+" "+_;const R=e.getVar(y,g)+" = "+T,F=g+" "+b+" "+S;x=`for ( ${R}; ${F}; ${M} )`}e.addFlowCode((o===0?`
`:"")+e.tab+x+` {

`).addFlowTab()}const s=i.build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let o=0,l=this.params.length-1;o<l;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const Bs=(...n)=>Fe(new xre(ud(n,"int"))).toStack(),yre=()=>Hd("break").toStack(),Ab=new WeakMap,Gi=new Lt,Q2=ke(({bufferMap:n,influence:e,stride:t,width:r,depth:i,offset:s})=>{const a=Cn(lre).mul(t).add(s),o=a.div(r),l=a.sub(o.mul(r));return Ls(n,Xa(l,o)).depth(i).xyz.mul(e)});function vre(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,r=n.morphAttributes.color!==void 0,i=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=i!==void 0?i.length:0;let a=Ab.get(n);if(a===void 0||a.count!==s){let x=function(){b.dispose(),Ab.delete(n),n.removeEventListener("dispose",x)};a!==void 0&&a.texture.dispose();const o=n.morphAttributes.position||[],l=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let h=0;e===!0&&(h=1),t===!0&&(h=2),r===!0&&(h=3);let p=n.attributes.position.count*h,m=1;const g=4096;p>g&&(m=Math.ceil(p/g),p=g);const y=new Float32Array(p*m*4*s),b=new H1(y,p,m,s);b.type=Zn,b.needsUpdate=!0;const _=h*4;for(let N=0;N<s;N++){const T=o[N],S=l[N],M=u[N],C=p*m*4*N;for(let R=0;R<T.count;R++){const F=R*_;e===!0&&(Gi.fromBufferAttribute(T,R),y[C+F+0]=Gi.x,y[C+F+1]=Gi.y,y[C+F+2]=Gi.z,y[C+F+3]=0),t===!0&&(Gi.fromBufferAttribute(S,R),y[C+F+4]=Gi.x,y[C+F+5]=Gi.y,y[C+F+6]=Gi.z,y[C+F+7]=0),r===!0&&(Gi.fromBufferAttribute(M,R),y[C+F+8]=Gi.x,y[C+F+9]=Gi.y,y[C+F+10]=Gi.z,y[C+F+11]=M.itemSize===4?Gi.w:1)}}a={count:s,texture:b,stride:h,size:new je(p,m)},Ab.set(n,a),n.addEventListener("dispose",x)}return a}class _re extends Vt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=jt(1),this.updateType=Xt.OBJECT}setup(e){const{geometry:t}=e,r=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=s!==void 0?s.length:0,{texture:o,stride:l,size:u}=vre(t);r===!0&&Zr.mulAssign(this.morphBaseInfluence),i===!0&&ba.mulAssign(this.morphBaseInfluence);const h=Cn(u.width);Bs(a,({i:p})=>{const m=Me(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?m.assign(Ls(this.mesh.morphTexture,Xa(Cn(p).add(1),Cn(LT))).r):m.assign(Nn("morphTargetInfluences","float").element(p).toVar()),nr(m.notEqual(0),()=>{r===!0&&Zr.addAssign(Q2({bufferMap:o,influence:m,stride:l,width:h,depth:p,offset:Cn(0)})),i===!0&&ba.addAssign(Q2({bufferMap:o,influence:m,stride:l,width:h,depth:p,offset:Cn(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,r)=>t+r,0)}}const bre=Ue(_re).setParameterLength(1);class uh extends Vt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class wre extends uh{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Sre extends dI{static get type(){return"LightingContextNode"}constructor(e,t=null,r=null,i=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,r=Ae().toVar("directDiffuse"),i=Ae().toVar("directSpecular"),s=Ae().toVar("indirectDiffuse"),a=Ae().toVar("indirectSpecular"),o={directDiffuse:r,directSpecular:i,indirectDiffuse:s,indirectSpecular:a};return{radiance:Ae().toVar("radiance"),irradiance:Ae().toVar("irradiance"),iblIrradiance:Ae().toVar("iblIrradiance"),ambientOcclusion:Me(1).toVar("ambientOcclusion"),reflectedLight:o,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Tre=Ue(Sre);class Nre extends uh{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let pf,mf;class ar extends Vt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===ar.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Xt.NONE;return(this.scope===ar.SIZE||this.scope===ar.VIEWPORT)&&(e=Xt.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===ar.VIEWPORT?t!==null?mf.copy(t.viewport):(e.getViewport(mf),mf.multiplyScalar(e.getPixelRatio())):t!==null?(pf.width=t.width,pf.height=t.height):e.getDrawingBufferSize(pf)}setup(){const e=this.scope;let t=null;return e===ar.SIZE?t=jt(pf||(pf=new je)):e===ar.VIEWPORT?t=jt(mf||(mf=new Lt)):t=Xe(dy.div(bS)),t}generate(e){if(this.scope===ar.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(bS).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${r}.y - ${t}.y )`}return t}return super.generate(e)}}ar.COORDINATE="coordinate";ar.VIEWPORT="viewport";ar.SIZE="size";ar.UV="uv";const pd=Ye(ar,ar.UV),bS=Ye(ar,ar.SIZE),dy=Ye(ar,ar.COORDINATE),Wf=Ye(ar,ar.VIEWPORT);Wf.zw;Wf.xy;const gf=new je;class FI extends lh{static get type(){return"ViewportTextureNode"}constructor(e=pd,t=null,r=null){r===null&&(r=new j9,r.minFilter=Ei),super(r,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Xt.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(gf);const r=this.value;(r.image.width!==gf.width||r.image.height!==gf.height)&&(r.image.width=gf.width,r.image.height=gf.height,r.needsUpdate=!0);const i=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const OI=Ue(FI,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Rb=null;class Ere extends FI{static get type(){return"ViewportDepthTextureNode"}constructor(e=pd,t=null){Rb===null&&(Rb=new xs),super(e,t,Rb)}}const Mre=Ue(Ere).setParameterLength(0,2);class Mi extends Vt{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Mi.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,r=this.valueNode;let i=null;if(t===Mi.DEPTH_BASE)r!==null&&(i=zI().assign(r));else if(t===Mi.DEPTH)e.isPerspectiveCamera?i=Cre(Qn.z,oc,lc):i=qf(Qn.z,oc,lc);else if(t===Mi.LINEAR_DEPTH)if(r!==null)if(e.isPerspectiveCamera){const s=UI(r,oc,lc);i=qf(s,oc,lc)}else i=r;else i=qf(Qn.z,oc,lc);return i}}Mi.DEPTH_BASE="depthBase";Mi.DEPTH="depth";Mi.LINEAR_DEPTH="linearDepth";const qf=(n,e,t)=>n.add(e).div(e.sub(t)),Cre=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),UI=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),BI=(n,e,t)=>{e=e.max(1e-6).toVar();const r=uo(n.negate().div(e)),i=uo(t.div(e));return r.div(i)},zI=Ue(Mi,Mi.DEPTH_BASE),VI=Ye(Mi,Mi.DEPTH),Are=Ue(Mi,Mi.LINEAR_DEPTH).setParameterLength(0,1);Mre();VI.assign=n=>zI(n);class ys extends Vt{static get type(){return"ClippingNode"}constructor(e=ys.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:r,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===ys.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(r,i):this.scope===ys.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(r,i)}setupAlphaToCoverage(e,t){return ke(()=>{const r=Me().toVar("distanceToPlane"),i=Me().toVar("distanceToGradient"),s=Me(1).toVar("clipOpacity"),a=t.length;if(this.hardwareClipping===!1&&a>0){const l=aa(t);Bs(a,({i:u})=>{const h=l.element(u);r.assign(Qn.dot(h.xyz).negate().add(h.w)),i.assign(r.fwidth().div(2)),s.mulAssign(bl(i.negate(),i,r))})}const o=e.length;if(o>0){const l=aa(e),u=Me(1).toVar("intersectionClipOpacity");Bs(o,({i:h})=>{const p=l.element(h);r.assign(Qn.dot(p.xyz).negate().add(p.w)),i.assign(r.fwidth().div(2)),u.mulAssign(bl(i.negate(),i,r).oneMinus())}),s.mulAssign(u.oneMinus())}un.a.mulAssign(s),un.a.equal(0).discard()})()}setupDefault(e,t){return ke(()=>{const r=t.length;if(this.hardwareClipping===!1&&r>0){const s=aa(t);Bs(r,({i:a})=>{const o=s.element(a);Qn.dot(o.xyz).greaterThan(o.w).discard()})}const i=e.length;if(i>0){const s=aa(e),a=gT(!0).toVar("clipped");Bs(i,({i:o})=>{const l=s.element(o);a.assign(Qn.dot(l.xyz).greaterThan(l.w).and(a))}),a.discard()}})()}setupHardwareClipping(e,t){const r=e.length;return t.enableHardwareClipping(r),ke(()=>{const i=aa(e),s=ly(t.getClipDistance());Bs(r,({i:a})=>{const o=i.element(a),l=Qn.dot(o.xyz).sub(o.w).negate();s.element(a).assign(l)})})()}}ys.ALPHA_TO_COVERAGE="alphaToCoverage";ys.DEFAULT="default";ys.HARDWARE="hardware";const Rre=()=>Fe(new ys),Pre=()=>Fe(new ys(ys.ALPHA_TO_COVERAGE)),kre=()=>Fe(new ys(ys.HARDWARE)),Lre=.05,J2=ke(([n])=>Tl(Jt(1e4,Fs(Jt(17,n.x).add(Jt(.1,n.y)))).mul(Li(.1,fs(Fs(Jt(13,n.y).add(n.x))))))),eR=ke(([n])=>J2(Xe(J2(n.xy),n.z))),Dre=ke(([n])=>{const e=Jr(ho(rI(n.xyz)),ho(iI(n.xyz))),t=Me(1).div(Me(Lre).mul(e)).toVar("pixScale"),r=Xe(Cp(bc(uo(t))),Cp(ST(uo(t)))),i=Xe(eR(bc(r.x.mul(n.xyz))),eR(bc(r.y.mul(n.xyz)))),s=Tl(uo(t)),a=Li(Jt(s.oneMinus(),i.x),Jt(s,i.y)),o=Gd(s,s.oneMinus()),l=Ae(a.mul(a).div(Jt(2,o).mul(ci(1,o))),a.sub(Jt(.5,o)).div(ci(1,o)),ci(1,ci(1,a).mul(ci(1,a)).div(Jt(2,o).mul(ci(1,o))))),u=a.lessThan(o.oneMinus()).select(a.lessThan(o).select(l.x,l.y),l.z);return yo(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Ire extends mI{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),r=e.hasGeometryAttribute(t);let i;return r===!0?i=super.generate(e):i=e.generateConst(this.nodeType,new Lt(1,1,1,1)),i}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const jre=(n=0)=>Fe(new Ire(n)),Fre=ke(([n])=>zt(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"});class lr extends Qr{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{console.warn('THREE.NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}customProgramCacheKey(){return this.type+ID(this)}build(e){this.setup(e)}setupObserver(e){return new EJ(e)}setup(e){e.context.setupNormal=()=>$f(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,r=t.getRenderTarget();e.addStack();const i=$f(this.setupVertex(e),"VERTEX"),s=this.vertexNode||i;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a;const o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(r!==null?r.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);o!==null&&e.stack.add(o);const u=zt(l,un.a).max(0);a=this.setupOutput(e,u),Hf.assign(a);const h=this.outputNode!==null;if(h&&(a=this.outputNode),r!==null){const p=t.getMRT(),m=this.mrtNode;p!==null?(h&&Hf.assign(a),a=p,m!==null&&(a=p.merge(m))):m!==null&&(a=m)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=zt(l)),a=this.setupOutput(e,l)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:r}=e.clippingContext;let i=null;if(t.length>0||r.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?i=Pre():e.stack.add(Rre())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(kre()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:r}=e;let i=this.depthNode;if(i===null){const s=t.getMRT();s&&s.has("depth")?i=s.get("depth"):t.logarithmicDepthBuffer===!0&&(r.isPerspectiveCamera?i=BI(Qn.z,oc,lc):i=qf(Qn.z,oc,lc))}i!==null&&VI.assign(i).toStack()}setupPositionView(){return cy.mul(Zr).xyz}setupModelViewProjection(){return RT.mul(Qn)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),jI}setupPosition(e){const{object:t,geometry:r}=e;if((r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&bre(t).toStack(),t.isSkinnedMesh===!0&&gre(t).toStack(),this.displacementMap){const i=ol("displacementMap","texture"),s=ol("displacementScale","float"),a=ol("displacementBias","float");Zr.addAssign(ba.normalize().mul(i.x.mul(s).add(a)))}return t.isBatchedMesh&&pre(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&hre(t).toStack(),this.positionNode!==null&&Zr.assign($f(this.positionNode,"POSITION","vec3")),Zr}setupDiffuseColor({object:e,geometry:t}){this.maskNode!==null&&gT(this.maskNode).not().discard();let r=this.colorNode?zt(this.colorNode):kne;this.vertexColors===!0&&t.hasAttribute("color")&&(r=r.mul(jre())),e.instanceColor&&(r=gx("vec3","vInstanceColor").mul(r)),e.isBatchedMesh&&e._colorsTexture&&(r=gx("vec3","vBatchColor").mul(r)),un.assign(r);const i=this.opacityNode?Me(this.opacityNode):DI;un.a.assign(un.a.mul(i));let s=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(s=this.alphaTestNode!==null?Me(this.alphaTestNode):Pne,un.a.lessThanEqual(s).discard()),this.alphaHash===!0&&un.a.lessThan(Dre(Zr)).discard(),this.transparent===!1&&this.blending===Yi&&this.alphaToCoverage===!1?un.a.assign(1):s===null&&un.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Ae(0):un.rgb}setupNormal(){return this.normalNode?Ae(this.normalNode):Une}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?ol("envMap","cubeTexture"):ol("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Nre(II)),t}setupLights(e){const t=[],r=this.setupEnvironment(e);r&&r.isLightingNode&&t.push(r);const i=this.setupLightMap(e);if(i&&i.isLightingNode&&t.push(i),this.aoNode!==null||e.material.aoMap){const a=this.aoNode!==null?this.aoNode:ore;t.push(new wre(a))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:r,backdropAlphaNode:i,emissiveNode:s}=this,o=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const u=this.setupLightingModel(e)||null;l=Tre(o,u,r,i)}else r!==null&&(l=Ae(i!==null?Ln(l,r,i):r));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(j2.assign(Ae(s||Dne)),l=l.add(j2)),l}setupFog(e,t){const r=e.fogNode;return r&&(Hf.assign(t),t=zt(r)),t}setupPremultipliedAlpha(e,t){return Fre(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const r in e){const i=e[r];this[r]===void 0&&(this[r]=i,i&&i.clone&&(this[r]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,r)===void 0&&t[r].get!==void 0&&Object.defineProperty(this.constructor.prototype,r,t[r])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const r=Qr.prototype.toJSON.call(this,e),i=fx(this);r.inputNodes={};for(const{property:a,childNode:o}of i)r.inputNodes[a]=o.toJSON(e).uuid;function s(a){const o=[];for(const l in a){const u=a[l];delete u.metadata,o.push(u)}return o}if(t){const a=s(e.textures),o=s(e.images),l=s(e.nodes);a.length>0&&(r.textures=a),o.length>0&&(r.images=o),l.length>0&&(r.nodes=l)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const Ore=new Zx;class Ure extends lr{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(Ore),this.setValues(e)}}const Bre=new oW;class zre extends lr{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(Bre),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Me(this.offsetNode):ire,t=this.dashScaleNode?Me(this.dashScaleNode):tre,r=this.dashSizeNode?Me(this.dashSizeNode):nre,i=this.gapSizeNode?Me(this.gapSizeNode):rre;Nb.assign(r),F2.assign(i);const s=Nl(wl("lineDistance").mul(t));(e?s.add(e):s).mod(Nb.add(F2)).greaterThan(Nb).discard()}}const Vre=n=>Fe(n).mul(.5).add(.5),Gre=new rW;class Hre extends lr{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Gre),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Me(this.opacityNode):DI;un.assign(CT(zt(Vre(xn),e),li))}}const GI=ke(([n=_I])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Xe(e,t)});class HI extends G3{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const r=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Lc(5,5,5),a=GI(_I),o=new lr;o.colorNode=ln(t,a,0),o.side=bn,o.blending=Ri;const l=new Xn(s,o),u=new Kx;u.add(l),t.minFilter===Ei&&(t.minFilter=pr);const h=new V3(1,10,this),p=e.getMRT();return e.setMRT(null),h.update(e,u),e.setMRT(p),t.minFilter=r,t.currentGenerateMipmaps=i,l.geometry.dispose(),l.material.dispose(),this}}const Xf=new WeakMap;class $re extends Rr{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=kp(null);const t=new Zp;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Xt.RENDER}updateBefore(e){const{renderer:t,material:r}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const s=i.isTextureNode?i.value:r[i.property];if(s&&s.isTexture){const a=s.mapping;if(a===bd||a===wd){if(Xf.has(s)){const o=Xf.get(s);tR(o,s.mapping),this._cubeTexture=o}else{const o=s.image;if(Wre(o)){const l=new HI(o.height);l.fromEquirectangularTexture(t,s),tR(l.texture,s.mapping),this._cubeTexture=l.texture,Xf.set(s,l.texture),s.addEventListener("dispose",$I)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Wre(n){return n==null?!1:n.height>0}function $I(n){const e=n.target;e.removeEventListener("dispose",$I);const t=Xf.get(e);t!==void 0&&(Xf.delete(e),t.dispose())}function tR(n,e){e===bd?n.mapping=xa:e===wd&&(n.mapping=ya)}const WI=Ue($re).setParameterLength(1);class DT extends uh{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=WI(this.envNode)}}class qre extends uh{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Me(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class hy{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class qI extends hy{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,r=e.reflectedLight,i=e.irradianceLightMap;r.indirectDiffuse.assign(zt(0)),i?r.indirectDiffuse.addAssign(i):r.indirectDiffuse.addAssign(zt(1,1,1,0)),r.indirectDiffuse.mulAssign(t),r.indirectDiffuse.mulAssign(un.rgb)}finish(e){const{material:t,context:r}=e,i=r.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case qp:i.rgb.assign(Ln(i.rgb,i.rgb.mul(s.rgb),G0.mul(Cb)));break;case C3:i.rgb.assign(Ln(i.rgb,s.rgb,G0.mul(Cb)));break;case A3:i.rgb.addAssign(s.rgb.mul(G0.mul(Cb)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const Xre=new Us;class Yre extends lr{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Xre),this.setValues(e)}setupNormal(){return sm(Pp)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new DT(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new qre(II)),t}setupOutgoingLight(){return un.rgb}setupLightingModel(){return new qI}}const Lp=ke(({f0:n,f90:e,dotVH:t})=>{const r=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(r.oneMinus()).add(e.mul(r))}),$d=ke(n=>n.diffuseColor.mul(1/Math.PI)),Kre=()=>Me(.25),Zre=ke(({dotNH:n})=>xS.mul(Me(.5)).add(1).mul(Me(1/Math.PI)).mul(n.pow(xS))),Qre=ke(({lightDirection:n})=>{const e=n.add(Gn).normalize(),t=xn.dot(e).clamp(),r=Gn.dot(e).clamp(),i=Lp({f0:$i,f90:1,dotVH:r}),s=Kre(),a=Zre({dotNH:t});return i.mul(s).mul(a)});class XI extends qI{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=xn.dot(e).clamp().mul(t);r.directDiffuse.addAssign(s.mul($d({diffuseColor:un.rgb}))),this.specular===!0&&r.directSpecular.addAssign(s.mul(Qre({lightDirection:e})).mul(G0))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul($d({diffuseColor:un}))),i.indirectDiffuse.mulAssign(t)}}const Jre=new X3;class eie extends lr{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Jre),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new DT(t):null}setupLightingModel(){return new XI(!1)}}const tie=new tW;class nie extends lr{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(tie),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new DT(t):null}setupLightingModel(){return new XI}setupVariants(){const e=(this.shininessNode?Me(this.shininessNode):Lne).max(1e-4);xS.assign(e);const t=this.specularNode||Ine;$i.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const rie=ke(n=>{if(n.geometry.hasAttribute("normal")===!1)return Me(0);const e=Pp.dFdx().abs().max(Pp.dFdy().abs());return e.x.max(e.y).max(e.z)}),YI=ke(n=>{const{roughness:e}=n,t=rie();let r=e.max(.0525);return r=r.add(t),r=r.min(1),r}),iie=ke(({alpha:n,dotNL:e,dotNV:t})=>{const r=n.pow2(),i=e.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return _a(.5,i.add(s).max(Oee))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),sie=ke(({alphaT:n,alphaB:e,dotTV:t,dotBV:r,dotTL:i,dotBL:s,dotNV:a,dotNL:o})=>{const l=o.mul(Ae(n.mul(t),e.mul(r),a).length()),u=a.mul(Ae(n.mul(i),e.mul(s),o).length());return _a(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),aie=ke(({alpha:n,dotNH:e})=>{const t=n.pow2(),r=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),oie=Me(1/Math.PI),lie=ke(({alphaT:n,alphaB:e,dotNH:t,dotTH:r,dotBH:i})=>{const s=n.mul(e),a=Ae(e.mul(r),n.mul(i),s.mul(t)),o=a.dot(a),l=s.div(o);return oie.mul(s.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),nR=ke(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,normalView:s=xn,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{const l=r.pow2(),u=n.add(Gn).normalize(),h=s.dot(n).clamp(),p=s.dot(Gn).clamp(),m=s.dot(u).clamp(),g=Gn.dot(u).clamp();let y=Lp({f0:e,f90:t,dotVH:g}),b,_;if(I2(a)&&(y=vT.mix(y,i)),I2(o)){const x=O0.dot(n),N=O0.dot(Gn),T=O0.dot(u),S=hd.dot(n),M=hd.dot(Gn),C=hd.dot(u);b=sie({alphaT:gS,alphaB:l,dotTV:N,dotBV:M,dotTL:x,dotBL:S,dotNV:p,dotNL:h}),_=lie({alphaT:gS,alphaB:l,dotNH:m,dotTH:T,dotBH:C})}else b=iie({alpha:l,dotNL:h,dotNV:p}),_=aie({alpha:l,dotNH:m});return y.mul(b).mul(_)}),KI=ke(({roughness:n,dotNV:e})=>{const t=zt(-1,-.0275,-.572,.022),r=zt(1,.0425,1.04,-.04),i=n.mul(t).add(r),s=i.x.mul(i.x).min(e.mul(-9.28).exp2()).mul(i.x).add(i.y);return Xe(-1.04,1.04).mul(s).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),ZI=ke(n=>{const{dotNV:e,specularColor:t,specularF90:r,roughness:i}=n,s=KI({dotNV:e,roughness:i});return t.mul(s.x).add(r.mul(s.y))}),cie=ke(({f:n,f90:e,dotVH:t})=>{const r=t.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return n.sub(Ae(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),uie=ke(({roughness:n,dotNH:e})=>{const t=n.pow2(),r=Me(1).div(t),s=e.pow2().oneMinus().max(.0078125);return Me(2).add(r).mul(s.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),die=ke(({dotNV:n,dotNL:e})=>Me(1).div(Me(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),hie=ke(({lightDirection:n})=>{const e=n.add(Gn).normalize(),t=xn.dot(n).clamp(),r=xn.dot(Gn).clamp(),i=xn.dot(e).clamp(),s=uie({roughness:yT,dotNH:i}),a=die({dotNV:r,dotNL:t});return Qu.mul(s).mul(a)}),fie=ke(({N:n,V:e,roughness:t})=>{const s=.0078125,a=n.dot(e).saturate(),o=Xe(t,a.oneMinus().sqrt());return o.assign(o.mul(.984375).add(s)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),pie=ke(({f:n})=>{const e=n.length();return Jr(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),r0=ke(({v1:n,v2:e})=>{const t=n.dot(e),r=t.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),a=i.div(s),o=t.greaterThan(0).select(a,Jr(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return n.cross(e).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),rR=ke(({N:n,V:e,P:t,mInv:r,p0:i,p1:s,p2:a,p3:o})=>{const l=s.sub(i).toVar(),u=o.sub(i).toVar(),h=l.cross(u),p=Ae().toVar();return nr(h.dot(t.sub(i)).greaterThanEqual(0),()=>{const m=e.sub(n.mul(e.dot(n))).normalize(),g=n.cross(m).negate(),y=r.mul(mi(m,g,n).transpose()).toVar(),b=y.mul(i.sub(t)).normalize().toVar(),_=y.mul(s.sub(t)).normalize().toVar(),x=y.mul(a.sub(t)).normalize().toVar(),N=y.mul(o.sub(t)).normalize().toVar(),T=Ae(0).toVar();T.addAssign(r0({v1:b,v2:_})),T.addAssign(r0({v1:_,v2:x})),T.addAssign(r0({v1:x,v2:N})),T.addAssign(r0({v1:N,v2:b})),p.assign(Ae(pie({f:T})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),fy=1/6,QI=n=>Jt(fy,Jt(n,Jt(n,n.negate().add(3)).sub(3)).add(1)),wS=n=>Jt(fy,Jt(n,Jt(n,Jt(3,n).sub(6))).add(4)),JI=n=>Jt(fy,Jt(n,Jt(n,Jt(-3,n).add(3)).add(3)).add(1)),SS=n=>Jt(fy,oy(n,3)),iR=n=>QI(n).add(wS(n)),sR=n=>JI(n).add(SS(n)),aR=n=>Li(-1,wS(n).div(QI(n).add(wS(n)))),oR=n=>Li(1,SS(n).div(JI(n).add(SS(n)))),lR=(n,e,t)=>{const r=n.uvNode,i=Jt(r,e.zw).add(.5),s=bc(i),a=Tl(i),o=iR(a.x),l=sR(a.x),u=aR(a.x),h=oR(a.x),p=aR(a.y),m=oR(a.y),g=Xe(s.x.add(u),s.y.add(p)).sub(.5).mul(e.xy),y=Xe(s.x.add(h),s.y.add(p)).sub(.5).mul(e.xy),b=Xe(s.x.add(u),s.y.add(m)).sub(.5).mul(e.xy),_=Xe(s.x.add(h),s.y.add(m)).sub(.5).mul(e.xy),x=iR(a.y).mul(Li(o.mul(n.sample(g).level(t)),l.mul(n.sample(y).level(t)))),N=sR(a.y).mul(Li(o.mul(n.sample(b).level(t)),l.mul(n.sample(_).level(t))));return x.add(N)},mie=ke(([n,e])=>{const t=Xe(n.size(Cn(e))),r=Xe(n.size(Cn(e.add(1)))),i=_a(1,t),s=_a(1,r),a=lR(n,zt(i,t),bc(e)),o=lR(n,zt(s,r),ST(e));return Tl(e).mix(a,o)}),cR=ke(([n,e,t,r,i])=>{const s=Ae(uI(e.negate(),Ap(n),_a(1,r))),a=Ae(ho(i[0].xyz),ho(i[1].xyz),ho(i[2].xyz));return Ap(s).mul(t.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),gie=ke(([n,e])=>n.mul(yo(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),xie=OI(),yie=OI(),uR=ke(([n,e,t],{material:r})=>{const s=(r.side===bn?xie:yie).sample(n),a=uo(bS.x).mul(gie(e,t));return mie(s,a)}),dR=ke(([n,e,t])=>(nr(t.notEqual(0),()=>{const r=eI(e).negate().div(t);return JD(r.negate().mul(n))}),Ae(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),vie=ke(([n,e,t,r,i,s,a,o,l,u,h,p,m,g,y])=>{let b,_;if(y){b=zt().toVar(),_=Ae().toVar();const M=h.sub(1).mul(y.mul(.025)),C=Ae(h.sub(M),h,h.add(M));Bs({start:0,end:3},({i:R})=>{const F=C.element(R),k=cR(n,e,p,F,o),D=a.add(k),P=u.mul(l.mul(zt(D,1))),G=Xe(P.xy.div(P.w)).toVar();G.addAssign(1),G.divAssign(2),G.assign(Xe(G.x,G.y.oneMinus()));const $=uR(G,t,F);b.element(R).assign($.element(R)),b.a.addAssign($.a),_.element(R).assign(r.element(R).mul(dR(ho(k),m,g).element(R)))}),b.a.divAssign(3)}else{const M=cR(n,e,p,h,o),C=a.add(M),R=u.mul(l.mul(zt(C,1))),F=Xe(R.xy.div(R.w)).toVar();F.addAssign(1),F.divAssign(2),F.assign(Xe(F.x,F.y.oneMinus())),b=uR(F,t,h),_=r.mul(dR(ho(M),m,g))}const x=_.rgb.mul(b.rgb),N=n.dot(e).clamp(),T=Ae(ZI({dotNV:N,specularColor:i,specularF90:s,roughness:t})),S=_.r.add(_.g,_.b).div(3);return zt(T.oneMinus().mul(x),b.a.oneMinus().mul(S).oneMinus())}),_ie=mi(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),bie=n=>{const e=n.sqrt();return Ae(1).add(e).div(Ae(1).sub(e))},hR=(n,e)=>n.sub(e).div(n.add(e)).pow2(),wie=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),r=Ae(54856e-17,44201e-17,52481e-17),i=Ae(1681e3,1795300,2208400),s=Ae(43278e5,93046e5,66121e5),a=Me(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let o=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return o=Ae(o.x.add(a),o.y,o.z).div(10685e-11),_ie.mul(o)},Sie=ke(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:r,baseF0:i})=>{const s=Ln(n,e,bl(0,.03,r)),o=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();nr(o.lessThan(0),()=>Ae(1));const l=o.sqrt(),u=hR(s,n),h=Lp({f0:u,f90:1,dotVH:t}),p=h.oneMinus(),m=s.lessThan(n).select(Math.PI,0),g=Me(Math.PI).sub(m),y=bie(i.clamp(0,.9999)),b=hR(y,s.toVec3()),_=Lp({f0:b,f90:1,dotVH:l}),x=Ae(y.x.lessThan(s).select(Math.PI,0),y.y.lessThan(s).select(Math.PI,0),y.z.lessThan(s).select(Math.PI,0)),N=s.mul(r,l,2),T=Ae(g).add(x),S=h.mul(_).clamp(1e-5,.9999),M=S.sqrt(),C=p.pow2().mul(_).div(Ae(1).sub(S)),F=h.add(C).toVar(),k=C.sub(p).toVar();return Bs({start:1,end:2,condition:"<=",name:"m"},({m:D})=>{k.mulAssign(M);const P=wie(Me(D).mul(N),Me(D).mul(T)).mul(2);F.addAssign(k.mul(P))}),F.max(Ae(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Tie=ke(({normal:n,viewDir:e,roughness:t})=>{const r=n.dot(e).saturate(),i=t.pow2(),s=pi(t.lessThan(.25),Me(-339.2).mul(i).add(Me(161.4).mul(t)).sub(25.9),Me(-8.48).mul(i).add(Me(14.3).mul(t)).sub(9.95)),a=pi(t.lessThan(.25),Me(44).mul(i).sub(Me(23.7).mul(t)).add(3.26),Me(1.97).mul(i).sub(Me(3.27).mul(t)).add(.72));return pi(t.lessThan(.25),0,Me(.1).mul(t).sub(.025)).add(s.mul(r).add(a).exp()).mul(1/Math.PI).saturate()}),Pb=Ae(.04),kb=Me(1);class ej extends hy{constructor(e=!1,t=!1,r=!1,i=!1,s=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.anisotropy=i,this.transmission=s,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Ae().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Ae().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Ae().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Ae().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Ae().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=xn.dot(Gn).clamp();this.iridescenceFresnel=Sie({outsideIOR:Me(1),eta2:HD,cosTheta1:t,thinFilmThickness:$D,baseF0:$i}),this.iridescenceF0=cie({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=Rp,r=ene.sub(Rp).normalize(),i=ch,s=e.context;s.backdrop=vie(i,r,Qa,un,$i,vx,t,Cc,So,RT,U0,WD,XD,qD,this.dispersion?YD:null),s.backdropAlpha=yS,un.a.mulAssign(Ln(1,s.backdrop.a,yS))}super.start(e)}computeMultiscattering(e,t,r){const i=xn.dot(Gn).clamp(),s=KI({roughness:Qa,dotNV:i}),o=(this.iridescenceF0?vT.mix($i,this.iridescenceF0):$i).mul(s.x).add(r.mul(s.y)),u=s.x.add(s.y).oneMinus(),h=$i.add($i.oneMinus().mul(.047619)),p=o.mul(h).div(u.mul(h).oneMinus());e.addAssign(o),t.addAssign(p.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=xn.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(hie({lightDirection:e}))),this.clearcoat===!0){const o=Ju.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(o.mul(nR({lightDirection:e,f0:Pb,f90:kb,roughness:yx,normalView:Ju})))}r.directDiffuse.addAssign(s.mul($d({diffuseColor:un.rgb}))),r.directSpecular.addAssign(s.mul(nR({lightDirection:e,f0:$i,f90:1,roughness:Qa,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:r,halfHeight:i,reflectedLight:s,ltc_1:a,ltc_2:o}){const l=t.add(r).sub(i),u=t.sub(r).sub(i),h=t.sub(r).add(i),p=t.add(r).add(i),m=xn,g=Gn,y=Qn.toVar(),b=fie({N:m,V:g,roughness:Qa}),_=a.sample(b).toVar(),x=o.sample(b).toVar(),N=mi(Ae(_.x,0,_.y),Ae(0,1,0),Ae(_.z,0,_.w)).toVar(),T=$i.mul(x.x).add($i.oneMinus().mul(x.y)).toVar();s.directSpecular.addAssign(e.mul(T).mul(rR({N:m,V:g,P:y,mInv:N,p0:l,p1:u,p2:h,p3:p}))),s.directDiffuse.addAssign(e.mul(un).mul(rR({N:m,V:g,P:y,mInv:mi(1,0,0,0,1,0,0,0,1),p0:l,p1:u,p2:h,p3:p})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(t.mul($d({diffuseColor:un})))}indirectSpecular(e){const{radiance:t,iblIrradiance:r,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(r.mul(Qu,Tie({normal:xn,viewDir:Gn,roughness:yT}))),this.clearcoat===!0){const h=Ju.dot(Gn).clamp(),p=ZI({dotNV:h,specularColor:Pb,specularF90:kb,roughness:yx});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(p))}const s=Ae().toVar("singleScattering"),a=Ae().toVar("multiScattering"),o=r.mul(1/Math.PI);this.computeMultiscattering(s,a,vx);const l=s.add(a),u=un.mul(l.r.max(l.g).max(l.b).oneMinus());i.indirectSpecular.addAssign(t.mul(s)),i.indirectSpecular.addAssign(a.mul(o)),i.indirectDiffuse.addAssign(u.mul(o))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:r}=e.context,s=xn.dot(Gn).clamp().add(t),a=Qa.mul(-16).oneMinus().negate().exp2(),o=t.sub(s.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),r.indirectDiffuse.mulAssign(t),r.indirectSpecular.mulAssign(o)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const r=Ju.dot(Gn).clamp(),i=Lp({dotVH:r,f0:Pb,f90:kb}),s=t.mul(mS.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(mS));t.assign(s)}if(this.sheen===!0){const r=Qu.r.max(Qu.g).max(Qu.b).mul(.157).oneMinus(),i=t.mul(r).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(i)}}}const fR=Me(1),TS=Me(-2),i0=Me(.8),Lb=Me(-1),s0=Me(.4),Db=Me(2),a0=Me(.305),Ib=Me(3),pR=Me(.21),Nie=Me(4),mR=Me(4),Eie=Me(16),Mie=ke(([n])=>{const e=Ae(fs(n)).toVar(),t=Me(-1).toVar();return nr(e.x.greaterThan(e.z),()=>{nr(e.x.greaterThan(e.y),()=>{t.assign(pi(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(pi(n.y.greaterThan(0),1,4))})}).Else(()=>{nr(e.z.greaterThan(e.y),()=>{t.assign(pi(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(pi(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Cie=ke(([n,e])=>{const t=Xe().toVar();return nr(e.equal(0),()=>{t.assign(Xe(n.z,n.y).div(fs(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(Xe(n.x.negate(),n.z.negate()).div(fs(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(Xe(n.x.negate(),n.y).div(fs(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(Xe(n.z.negate(),n.y).div(fs(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(Xe(n.x.negate(),n.z).div(fs(n.y)))}).Else(()=>{t.assign(Xe(n.x,n.y).div(fs(n.z)))}),Jt(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Aie=ke(([n])=>{const e=Me(0).toVar();return nr(n.greaterThanEqual(i0),()=>{e.assign(fR.sub(n).mul(Lb.sub(TS)).div(fR.sub(i0)).add(TS))}).ElseIf(n.greaterThanEqual(s0),()=>{e.assign(i0.sub(n).mul(Db.sub(Lb)).div(i0.sub(s0)).add(Lb))}).ElseIf(n.greaterThanEqual(a0),()=>{e.assign(s0.sub(n).mul(Ib.sub(Db)).div(s0.sub(a0)).add(Db))}).ElseIf(n.greaterThanEqual(pR),()=>{e.assign(a0.sub(n).mul(Nie.sub(Ib)).div(a0.sub(pR)).add(Ib))}).Else(()=>{e.assign(Me(-2).mul(uo(Jt(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),Rie=ke(([n,e])=>{const t=n.toVar();t.assign(Jt(2,t).sub(1));const r=Ae(t,1).toVar();return nr(e.equal(0),()=>{r.assign(r.zyx)}).ElseIf(e.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),Pie=ke(([n,e,t,r,i,s])=>{const a=Me(t),o=Ae(e),l=yo(Aie(a),TS,s),u=Tl(l),h=bc(l),p=Ae(NS(n,o,h,r,i,s)).toVar();return nr(u.notEqual(0),()=>{const m=Ae(NS(n,o,h.add(1),r,i,s)).toVar();p.assign(Ln(p,m,u))}),p}),NS=ke(([n,e,t,r,i,s])=>{const a=Me(t).toVar(),o=Ae(e),l=Me(Mie(o)).toVar(),u=Me(Jr(mR.sub(a),0)).toVar();a.assign(Jr(a,mR));const h=Me(Cp(a)).toVar(),p=Xe(Cie(o,l).mul(h.sub(2)).add(1)).toVar();return nr(l.greaterThan(2),()=>{p.y.addAssign(h),l.subAssign(3)}),p.x.addAssign(l.mul(h)),p.x.addAssign(u.mul(Jt(3,Eie))),p.y.addAssign(Jt(4,Cp(s).sub(h))),p.x.mulAssign(r),p.y.mulAssign(i),n.sample(p).grad(Xe(),Xe())}),jb=ke(({envMap:n,mipInt:e,outputDirection:t,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=sl(r),u=t.mul(l).add(i.cross(t).mul(Fs(r))).add(i.mul(i.dot(t).mul(l.oneMinus())));return NS(n,u,e,s,a,o)}),kie=ke(({n,latitudinal:e,poleAxis:t,outputDirection:r,weights:i,samples:s,dTheta:a,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:p})=>{const m=Ae(pi(e,t,aI(t,r))).toVar();nr(m.equal(Ae(0)),()=>{m.assign(Ae(r.z,0,r.x.negate()))}),m.assign(Ap(m));const g=Ae().toVar();return g.addAssign(i.element(0).mul(jb({theta:0,axis:m,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:p}))),Bs({start:Cn(1),end:n},({i:y})=>{nr(y.greaterThanEqual(s),()=>{yre()});const b=Me(a.mul(Me(y))).toVar();g.addAssign(i.element(y).mul(jb({theta:b.mul(-1),axis:m,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:p}))),g.addAssign(i.element(y).mul(jb({theta:b,axis:m,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:p})))}),zt(g,1)}),ed=4,gR=[.125,.215,.35,.446,.526,.582],cc=20,Fb=new tm(-1,1,1,-1,0,1),Lie=new Mr(90,1),xR=new vt;let Ob=null,Ub=0,Bb=0;const ic=(1+Math.sqrt(5))/2,ju=1/ic,yR=[new ee(-ic,ju,0),new ee(ic,ju,0),new ee(-ju,0,ic),new ee(ju,0,ic),new ee(0,ic,-ju),new ee(0,ic,ju),new ee(-1,1,-1),new ee(1,1,-1),new ee(-1,1,1),new ee(1,1,1)],Die=new ee,tj=new WeakMap,Iie=[3,1,5,0,4,2],zb=Rie(im(),wl("faceIndex")).normalize(),IT=Ae(zb.x,zb.y,zb.z);class jie{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,r=.1,i=100,s={}){const{size:a=256,position:o=Die,renderTarget:l=null}=s;if(this._setSize(a),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const h=l||this._allocateTarget();return s.renderTarget=h,this.fromSceneAsync(e,t,r,i,s),h}Ob=this._renderer.getRenderTarget(),Ub=this._renderer.getActiveCubeFace(),Bb=this._renderer.getActiveMipmapLevel();const u=l||this._allocateTarget();return u.depthBuffer=!0,this._init(u),this._sceneToCubeUV(e,r,i,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e,t=0,r=.1,i=100,s={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,r,i,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromEquirectangularAsync(e,r),r}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromCubemapAsync(e,t),r}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_R(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=bR(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===xa||e.mapping===ya?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ob,Ub,Bb),e.scissorTest=!1,o0(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),Ob=this._renderer.getRenderTarget(),Ub=this._renderer.getActiveCubeFace(),Bb=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTarget();return this._init(r),this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return vR(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=vR(e.width,e.height);const{_lodMax:t}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=Fie(t)),this._blurMaterial=Oie(t,e.width,e.height)}}async _compileMaterial(e){const t=new Xn(this._lodPlanes[0],e);await this._renderer.compile(t,Fb)}_sceneToCubeUV(e,t,r,i,s){const a=Lie;a.near=t,a.far=r;const o=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],u=this._renderer,h=u.autoClear;u.getClearColor(xR),u.autoClear=!1;let p=this._backgroundBox;if(p===null){const y=new Us({name:"PMREM.Background",side:bn,depthWrite:!1,depthTest:!1});p=new Xn(new Lc,y)}let m=!1;const g=e.background;g?g.isColor&&(p.material.color.copy(g),e.background=null,m=!0):(p.material.color.copy(xR),m=!0),u.setRenderTarget(i),u.clear(),m&&u.render(p,a);for(let y=0;y<6;y++){const b=y%3;b===0?(a.up.set(0,o[y],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x+l[y],s.y,s.z)):b===1?(a.up.set(0,0,o[y]),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y+l[y],s.z)):(a.up.set(0,o[y],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y,s.z+l[y]));const _=this._cubeSize;o0(i,b*_,y>2?_:0,_,_),u.render(e,a)}u.autoClear=h,e.background=g}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===xa||e.mapping===ya;i?this._cubemapMaterial===null&&(this._cubemapMaterial=_R(e)):this._equirectMaterial===null&&(this._equirectMaterial=bR(e));const s=i?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=s;const o=this._cubeSize;o0(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(a,Fb)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=yR[(i-s-1)%yR.length];this._blur(e,s-1,s,a,o)}t.autoClear=r}_blur(e,t,r,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",s),this._halfBlur(a,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,a,o){const l=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,p=this._lodMeshes[i];p.material=u;const m=tj.get(u),g=this._sizeLods[r]-1,y=isFinite(s)?Math.PI/(2*g):2*Math.PI/(2*cc-1),b=s/y,_=isFinite(s)?1+Math.floor(h*b):cc;_>cc&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${cc}`);const x=[];let N=0;for(let R=0;R<cc;++R){const F=R/b,k=Math.exp(-F*F/2);x.push(k),R===0?N+=k:R<_&&(N+=2*k)}for(let R=0;R<x.length;R++)x[R]=x[R]/N;e.texture.frame=(e.texture.frame||0)+1,m.envMap.value=e.texture,m.samples.value=_,m.weights.array=x,m.latitudinal.value=a==="latitudinal"?1:0,o&&(m.poleAxis.value=o);const{_lodMax:T}=this;m.dTheta.value=y,m.mipInt.value=T-r;const S=this._sizeLods[i],M=3*S*(i>T-ed?i-T+ed:0),C=4*(this._cubeSize-S);o0(t,M,C,3*S,2*S),l.setRenderTarget(t),l.render(p,Fb)}}function Fie(n){const e=[],t=[],r=[],i=[];let s=n;const a=n-ed+1+gR.length;for(let o=0;o<a;o++){const l=Math.pow(2,s);t.push(l);let u=1/l;o>n-ed?u=gR[o-n+ed-1]:o===0&&(u=0),r.push(u);const h=1/(l-2),p=-h,m=1+h,g=[p,p,m,p,m,m,p,p,m,m,p,m],y=6,b=6,_=3,x=2,N=1,T=new Float32Array(_*b*y),S=new Float32Array(x*b*y),M=new Float32Array(N*b*y);for(let R=0;R<y;R++){const F=R%3*2/3-1,k=R>2?0:-1,D=[F,k,0,F+2/3,k,0,F+2/3,k+1,0,F,k,0,F+2/3,k+1,0,F,k+1,0],P=Iie[R];T.set(D,_*b*P),S.set(g,x*b*P);const G=[P,P,P,P,P,P];M.set(G,N*b*P)}const C=new ei;C.setAttribute("position",new Fr(T,_)),C.setAttribute("uv",new Fr(S,x)),C.setAttribute("faceIndex",new Fr(M,N)),e.push(C),i.push(new Xn(C,null)),s>ed&&s--}return{lodPlanes:e,sizeLods:t,sigmas:r,lodMeshes:i}}function vR(n,e){const t={magFilter:pr,minFilter:pr,generateMipmaps:!1,type:Cr,format:qn,colorSpace:pa},r=new Pc(n,e,t);return r.texture.mapping=Tc,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function o0(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function jT(n){const e=new lr;return e.depthTest=!1,e.depthWrite=!1,e.blending=Ri,e.name=`PMREM_${n}`,e}function Oie(n,e,t){const r=aa(new Array(cc).fill(0)),i=jt(new ee(0,1,0)),s=jt(0),a=Me(cc),o=jt(0),l=jt(1),u=ln(null),h=jt(0),p=Me(1/e),m=Me(1/t),g=Me(n),y={n:a,latitudinal:o,weights:r,poleAxis:i,outputDirection:IT,dTheta:s,samples:l,envMap:u,mipInt:h,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:g},b=jT("blur");return b.fragmentNode=kie({...y,latitudinal:o.equal(1)}),tj.set(b,y),b}function _R(n){const e=jT("cubemap");return e.fragmentNode=kp(n,IT),e}function bR(n){const e=jT("equirect");return e.fragmentNode=ln(n,GI(IT),0),e}const wR=new WeakMap;function Uie(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function Bie(n,e,t){const r=zie(e);let i=r.get(n);if((i!==void 0?i.pmremVersion:-1)!==n.pmremVersion){const a=n.image;if(n.isCubeTexture)if(Gie(a))i=t.fromCubemap(n,i);else return null;else if(Hie(a))i=t.fromEquirectangular(n,i);else return null;i.pmremVersion=n.pmremVersion,r.set(n,i)}return i.texture}function zie(n){let e=wR.get(n);return e===void 0&&(e=new WeakMap,wR.set(n,e)),e}class Vie extends Rr{static get type(){return"PMREMNode"}constructor(e,t=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=r,this._generator=null;const i=new Jn;i.isRenderTargetTexture=!0,this._texture=ln(i),this._width=jt(0),this._height=jt(0),this._maxMip=jt(0),this.updateBeforeType=Xt.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=Uie(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const r=t?t.pmremVersion:-1,i=this._value;r!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=Bie(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new jie(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=TI.mul(Ae(t.x,t.y.negate(),t.z));let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),Pie(this._texture,t,r,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function Gie(n){if(n==null)return!1;let e=0;const t=6;for(let r=0;r<t;r++)n[r]!==void 0&&e++;return e===t}function Hie(n){return n==null?!1:n.height>0}const nj=Ue(Vie).setParameterLength(1,3),SR=new WeakMap;class $ie extends uh{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const p=r.isTextureNode?r.value:t[r.property];let m=SR.get(p);m===void 0&&(m=nj(p),SR.set(p,m)),r=m}const s=t.useAnisotropy===!0||t.anisotropy>0?Nne:xn,a=r.context(TR(Qa,s)).mul(Mb),o=r.context(Wie(ch)).mul(Math.PI).mul(Mb),l=z0(a),u=z0(o);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(u);const h=e.context.lightingModel.clearcoatRadiance;if(h){const p=r.context(TR(yx,Ju)).mul(Mb),m=z0(p);h.addAssign(m)}}}const TR=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Gn.negate().reflect(e),t=n.mul(n).mix(t,e).normalize(),t=t.transformDirection(So)),t),getTextureLevel:()=>n}},Wie=n=>({getUV:()=>n,getTextureLevel:()=>Me(1)}),qie=new q3;class rj extends lr{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(qie),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new $ie(t):null}setupLightingModel(){return new ej}setupSpecular(){const e=Ln(Ae(.04),un.rgb,xx);$i.assign(e),vx.assign(1)}setupVariants(){const e=this.metalnessNode?Me(this.metalnessNode):One;xx.assign(e);let t=this.roughnessNode?Me(this.roughnessNode):Fne;t=YI({roughness:t}),Qa.assign(t),this.setupSpecular(),un.assign(zt(un.rgb.mul(e.oneMinus()),un.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const Xie=new eW;class Yie extends rj{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Xie),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?Me(this.iorNode):Qne;U0.assign(e),$i.assign(Ln(Gd(oI(U0.sub(1).div(U0.add(1))).mul(jne),Ae(1)).mul(K2),un.rgb,xx)),vx.assign(Ln(K2,1,xx))}setupLightingModel(){return new ej(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?Me(this.clearcoatNode):Bne,r=this.clearcoatRoughnessNode?Me(this.clearcoatRoughnessNode):zne;mS.assign(t),yx.assign(YI({roughness:r}))}if(this.useSheen){const t=this.sheenNode?Ae(this.sheenNode):Hne,r=this.sheenRoughnessNode?Me(this.sheenRoughnessNode):$ne;Qu.assign(t),yT.assign(r)}if(this.useIridescence){const t=this.iridescenceNode?Me(this.iridescenceNode):qne,r=this.iridescenceIORNode?Me(this.iridescenceIORNode):Xne,i=this.iridescenceThicknessNode?Me(this.iridescenceThicknessNode):Yne;vT.assign(t),HD.assign(r),$D.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?Xe(this.anisotropyNode):Wne).toVar();rc.assign(t.length()),nr(rc.equal(0),()=>{t.assign(Xe(1,0))}).Else(()=>{t.divAssign(Xe(rc)),rc.assign(rc.saturate())}),gS.assign(rc.pow2().mix(Qa.pow2(),1)),O0.assign(Df[0].mul(t.x).add(Df[1].mul(t.y))),hd.assign(Df[1].mul(t.x).sub(Df[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?Me(this.transmissionNode):Kne,r=this.thicknessNode?Me(this.thicknessNode):Zne,i=this.attenuationDistanceNode?Me(this.attenuationDistanceNode):Jne,s=this.attenuationColorNode?Ae(this.attenuationColorNode):ere;if(yS.assign(t),WD.assign(r),qD.assign(i),XD.assign(s),this.useDispersion){const a=this.dispersionNode?Me(this.dispersionNode):are;YD.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Ae(this.clearcoatNormalNode):Vne}setup(e){e.context.setupClearcoatNormal=()=>$f(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const Kie=ke(({normal:n,lightDirection:e,builder:t})=>{const r=n.dot(e),i=Xe(r.mul(.5).add(.5),0);if(t.material.gradientMap){const s=ol("gradientMap","texture").context({getUV:()=>i});return Ae(s.r)}else{const s=i.fwidth().mul(.5);return Ln(Ae(.7),Ae(1),bl(Me(.7).sub(s.x),Me(.7).add(s.x),i.x))}});class Zie extends hy{direct({lightDirection:e,lightColor:t,reflectedLight:r},i){const s=Kie({normal:wI,lightDirection:e,builder:i}).mul(t);r.directDiffuse.addAssign(s.mul($d({diffuseColor:un.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul($d({diffuseColor:un}))),i.indirectDiffuse.mulAssign(t)}}const Qie=new nW;class Jie extends lr{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Qie),this.setValues(e)}setupLightingModel(){return new Zie}}const ese=ke(()=>{const n=Ae(Gn.z,0,Gn.x.negate()).normalize(),e=Gn.cross(n);return Xe(n.dot(xn),e.dot(xn)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),tse=new aW;class nse extends lr{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(tse),this.setValues(e)}setupVariants(e){const t=ese;let r;e.material.matcap?r=ol("matcap","texture").context({getUV:()=>t}):r=Ae(Ln(.2,.8,t.y)),un.rgb.mulAssign(r.rgb)}}class rse extends Rr{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:r}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),a=t.sin();return xT(s,a,a.negate(),s).mul(r)}else{const s=t,a=dd(zt(1,0,0,0),zt(0,sl(s.x),Fs(s.x).negate(),0),zt(0,Fs(s.x),sl(s.x),0),zt(0,0,0,1)),o=dd(zt(sl(s.y),0,Fs(s.y),0),zt(0,1,0,0),zt(Fs(s.y).negate(),0,sl(s.y),0),zt(0,0,0,1)),l=dd(zt(sl(s.z),Fs(s.z).negate(),0,0),zt(Fs(s.z),sl(s.z),0,0),zt(0,0,1,0),zt(0,0,0,1));return a.mul(o).mul(l).mul(zt(r,1)).xyz}}}const ij=Ue(rse).setParameterLength(2),ise=new K1;class sj extends lr{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(ise),this.setValues(e)}setupPositionView(e){const{object:t,camera:r}=e,i=this.sizeAttenuation,{positionNode:s,rotationNode:a,scaleNode:o}=this,l=cy.mul(Ae(s||0));let u=Xe(Cc[0].xyz.length(),Cc[1].xyz.length());if(o!==null&&(u=u.mul(Xe(o))),i===!1)if(r.isPerspectiveCamera)u=u.mul(l.z.negate());else{const g=Me(2).div(RT.element(1).element(1));u=u.mul(g.mul(2))}let h=uy.xy;if(t.center&&t.center.isVector2===!0){const g=Mte("center","vec2",t);h=h.sub(g.sub(.5))}h=h.mul(u);const p=Me(a||Gne),m=ij(h,p);return zt(l.xy.add(m),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const sse=new I9;class ase extends sj{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(sse),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return cy.mul(Ae(e||Zr)).xyz}setupVertex(e){const t=super.setupVertex(e);if(e.material.isNodeMaterial!==!0)return t;const{rotationNode:r,scaleNode:i,sizeNode:s}=this,a=uy.xy.toVar(),o=Wf.z.div(Wf.w);if(r&&r.isNode){const u=Me(r);a.assign(ij(a,u))}let l=s!==null?Xe(s):sre;return this.sizeAttenuation===!0&&(l=l.mul(l.div(Qn.z.negate()))),i&&i.isNode&&(l=l.mul(Xe(i))),a.mulAssign(l.mul(2)),a.assign(a.div(Wf.z)),a.y.assign(a.y.mul(o)),a.assign(a.mul(t.w)),t.addAssign(zt(a,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class ose extends hy{constructor(){super(),this.shadowNode=Me(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){un.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(un.rgb)}}const lse=new J9;class cse extends lr{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(lse),this.setValues(e)}setupLightingModel(){return new ose}}ml("vec3");ml("vec3");ml("vec3");class use{constructor(e,t){this.nodes=e,this.info=t,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,r)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,r)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class $s{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let r=this.weakMap;for(let i=0;i<e.length-1;i++){const s=e[i];r.has(s)===!1&&r.set(s,new WeakMap),r=r.get(s)}return r.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return!1;return t.delete(e[e.length-1])}}let dse=0;function hse(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const r=Object.getOwnPropertyDescriptors(t);for(const i in r)if(r[i]!==void 0){const s=r[i];s&&typeof s.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class fse{constructor(e,t,r,i,s,a,o,l,u,h){this.id=dse++,this._nodes=e,this._geometries=t,this.renderer=r,this.object=i,this.material=s,this.scene=a,this.camera=o,this.lightsNode=l,this.context=u,this.geometry=i.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=h,this.clippingContextCacheKey=h!==null?h.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,r=[],i=new Set,s={};for(const a of e){let o;if(a.node&&a.node.attribute?o=a.node.attribute:(o=t.getAttribute(a.name),s[a.name]=o.version),o===void 0)continue;r.push(o);const l=o.isInterleavedBufferAttribute?o.data:o;i.add(l)}return this.attributes=r,this.attributesId=s,this.vertexBuffers=Array.from(i.values()),r}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:r,group:i,drawRange:s}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),l=o!==null;let u=1;if(r.isInstancedBufferGeometry===!0?u=r.instanceCount:e.count!==void 0&&(u=Math.max(0,e.count)),u===0)return null;if(a.instanceCount=u,e.isBatchedMesh===!0)return a;let h=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(h=2);let p=s.start*h,m=(s.start+s.count)*h;i!==null&&(p=Math.max(p,i.start*h),m=Math.min(m,(i.start+i.count)*h));const g=r.attributes.position;let y=1/0;l?y=o.count:g!=null&&(y=g.count),p=Math.max(p,0),m=Math.min(m,y);const b=m-p;return b<0||b===1/0?null:(a.vertexCount=b,a.firstVertex=p,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const r of Object.keys(e.attributes).sort()){const i=e.attributes[r];t+=r+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const r of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[r];t+="morph-"+r+",";for(let s=0,a=i.length;s<a;s++){const o=i[s];t+=o.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let r=t.customProgramCacheKey();for(const i of hse(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const s=t[i];let a;if(s!==null){const o=typeof s;o==="number"?a=s!==0?"1":"0":o==="object"?(a="{",s.isTexture&&(a+=s.mapping),a+="}"):a=String(s)}else a=String(s);r+=a+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+",")),e.count>1&&(r+=e.uuid+","),r+=e.receiveShadow+",",MJ(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const r=this.geometry.getAttribute(t);if(r===void 0||e[t]!==r.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=hx(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=hx(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Yl=[];class pse{constructor(e,t,r,i,s,a){this.renderer=e,this.nodes=t,this.geometries=r,this.pipelines=i,this.bindings=s,this.info=a,this.chainMaps={}}get(e,t,r,i,s,a,o,l){const u=this.getChainMap(l);Yl[0]=e,Yl[1]=t,Yl[2]=a,Yl[3]=s;let h=u.get(Yl);return h===void 0?(h=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,r,i,s,a,o,l),u.set(Yl,h)):(h.updateClipping(o),h.needsGeometryUpdate&&h.setGeometry(e.geometry),(h.version!==t.version||h.needsUpdate)&&(h.initialCacheKey!==h.getCacheKey()?(h.dispose(),h=this.get(e,t,r,i,s,a,o,l)):h.version=t.version)),Yl.length=0,h}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new $s)}dispose(){this.chainMaps={}}createRenderObject(e,t,r,i,s,a,o,l,u,h,p){const m=this.getChainMap(p),g=new fse(e,t,r,i,s,a,o,l,u,h);return g.onDispose=()=>{this.pipelines.delete(g),this.bindings.delete(g),this.nodes.delete(g),m.delete(g.getChainArray())},g}}class El{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const gs={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},ll=16,mse=211,gse=212;class xse extends El{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const r=this.get(e);if(r.version===void 0)t===gs.VERTEX?this.backend.createAttribute(e):t===gs.INDEX?this.backend.createIndexAttribute(e):t===gs.STORAGE?this.backend.createStorageAttribute(e):t===gs.INDIRECT&&this.backend.createIndirectStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(r.version<i.version||i.usage===Xu)&&(this.backend.updateAttribute(e),r.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function aj(n){return n.index!==null?n.index.version:n.attributes.position.version}function NR(n){const e=[],t=n.index,r=n.attributes.position;if(t!==null){const s=t.array;for(let a=0,o=s.length;a<o;a+=3){const l=s[a+0],u=s[a+1],h=s[a+2];e.push(l,u,u,h,h,l)}}else{const s=r.array;for(let a=0,o=s.length/3-1;a<o;a+=3){const l=a+0,u=a+1,h=a+2;e.push(l,u,u,h,h,l)}}const i=new(V1(e)?q1:W1)(e,1);return i.version=aj(n),i}class yse extends El{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,r=this.get(t);r.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const s=t.index,a=e.getAttributes();s!==null&&this.attributes.delete(s);for(const l of a)this.attributes.delete(l);const o=this.wireframes.get(t);o!==void 0&&this.attributes.delete(o),t.removeEventListener("dispose",i)};t.addEventListener("dispose",i)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,gs.STORAGE):this.updateAttribute(s,gs.VERTEX);const r=this.getIndex(e);r!==null&&this.updateAttribute(r,gs.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,gs.INDIRECT)}updateAttribute(e,t){const r=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,r)):this.attributeCall.get(e.data)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e.data,r),this.attributeCall.set(e,r)):this.attributeCall.get(e)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e,r))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:r}=e;let i=t.index;if(r.wireframe===!0){const s=this.wireframes;let a=s.get(t);a===void 0?(a=NR(t),s.set(t,a)):a.version!==aj(t)&&(this.attributes.delete(a),a=NR(t),s.set(t,a)),i=a}return i}}class vse{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(t/3):e.isPoints?this.render.points+=r*t:e.isLineSegments?this.render.lines+=r*(t/2):e.isLine?this.render.lines+=r*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class oj{constructor(e){this.cacheKey=e,this.usedTimes=0}}class _se extends oj{constructor(e,t,r){super(e),this.vertexProgram=t,this.fragmentProgram=r}}class bse extends oj{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let wse=0;class Vb{constructor(e,t,r,i=null,s=null){this.id=wse++,this.code=e,this.stage=t,this.name=r,this.transforms=i,this.attributes=s,this.usedTimes=0}}class Sse extends El{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:r}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let o=this.programs.compute.get(a.computeShader);o===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),o=new Vb(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),r.createProgram(o));const l=this._getComputeCacheKey(e,o);let u=this.caches.get(l);u===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),u=this._getComputePipeline(e,o,l,t)),u.usedTimes++,o.usedTimes++,i.version=e.version,i.pipeline=u}return i.pipeline}getForRender(e,t=null){const{backend:r}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),o=e.material?e.material.name:"";let l=this.programs.vertex.get(a.vertexShader);l===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),l=new Vb(a.vertexShader,"vertex",o),this.programs.vertex.set(a.vertexShader,l),r.createProgram(l));let u=this.programs.fragment.get(a.fragmentShader);u===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),u=new Vb(a.fragmentShader,"fragment",o),this.programs.fragment.set(a.fragmentShader,u),r.createProgram(u));const h=this._getRenderCacheKey(e,l,u);let p=this.caches.get(h);p===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),p=this._getRenderPipeline(e,l,u,h,t)):e.pipeline=p,p.usedTimes++,l.usedTimes++,u.usedTimes++,i.pipeline=p}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,r,i){r=r||this._getComputeCacheKey(e,t);let s=this.caches.get(r);return s===void 0&&(s=new bse(r,t),this.caches.set(r,s),this.backend.createComputePipeline(s,i)),s}_getRenderPipeline(e,t,r,i,s){i=i||this._getRenderCacheKey(e,t,r);let a=this.caches.get(i);return a===void 0&&(a=new _se(i,t,r),this.caches.set(i,a),e.pipeline=a,this.backend.createRenderPipeline(e,s)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,r){return t.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,r=e.stage;this.programs[r].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class Tse extends El{constructor(e,t,r,i,s,a){super(),this.backend=e,this.textures=r,this.pipelines=s,this.attributes=i,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const r=t.attribute,i=r.isIndirectStorageBufferAttribute?gs.INDIRECT:gs.STORAGE;this.attributes.update(r,i)}}_update(e,t){const{backend:r}=this;let i=!1,s=!0,a=0,o=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isStorageBuffer){const u=l.attribute,h=u.isIndirectStorageBufferAttribute?gs.INDIRECT:gs.STORAGE;this.attributes.update(u,h)}if(l.isUniformBuffer)l.update()&&r.updateBinding(l);else if(l.isSampler)l.update();else if(l.isSampledTexture){const u=this.textures.get(l.texture);l.needsBindingsUpdate(u.generation)&&(i=!0);const h=l.update(),p=l.texture;h&&this.textures.updateTexture(p);const m=r.get(p);if(m.externalTexture!==void 0||u.isDefaultTexture?s=!1:(a=a*10+p.id,o+=p.version),r.isWebGPUBackend===!0&&m.texture===void 0&&m.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",l,h,p,l.textureNode.value,i),this.textures.updateTexture(p),i=!0),p.isStorageTexture===!0){const g=this.get(p);l.store===!0?g.needsMipmap=!0:this.textures.needsMipmaps(p)&&g.needsMipmap===!0&&(this.backend.generateMipmaps(p),g.needsMipmap=!1)}}}i===!0&&this.backend.updateBindings(e,t,s?a:0,o)}}function Nse(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function ER(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function MR(n){return(n.transmission>0||n.transmissionNode)&&n.side===Yr&&n.forceSinglePass===!1}class Ese{constructor(e,t,r){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,r),this.lightsArray=[],this.scene=t,this.camera=r,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,r,i,s,a,o){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:r,groupOrder:i,renderOrder:e.renderOrder,z:s,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=r,l.groupOrder=i,l.renderOrder=e.renderOrder,l.z=s,l.group=a,l.clippingContext=o),this.renderItemsIndex++,l}push(e,t,r,i,s,a,o){const l=this.getNextRenderItem(e,t,r,i,s,a,o);e.occlusionTest===!0&&this.occlusionQueryCount++,r.transparent===!0||r.transmission>0?(MR(r)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,r,i,s,a,o){const l=this.getNextRenderItem(e,t,r,i,s,a,o);r.transparent===!0||r.transmission>0?(MR(r)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Nse),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||ER),this.transparent.length>1&&this.transparent.sort(t||ER)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const r=this.renderItems[e];if(r.id===null)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null,r.clippingContext=null}}}const xf=[];class Mse{constructor(e){this.lighting=e,this.lists=new $s}get(e,t){const r=this.lists;xf[0]=e,xf[1]=t;let i=r.get(xf);return i===void 0&&(i=new Ese(this.lighting,e,t),r.set(xf,i)),xf.length=0,i}dispose(){this.lists=new $s}}let Cse=0;class Ase{constructor(){this.id=Cse++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Lt,this.scissor=!1,this.scissorValue=new Lt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return lj(this)}}function lj(n){const{textures:e,activeCubeFace:t}=n,r=[t];for(const i of e)r.push(i.id);return dT(r)}const yf=[],Rse=new Kx,Pse=new X1;class kse{constructor(){this.chainMaps={}}get(e,t,r=null){yf[0]=e,yf[1]=t;let i;if(r===null)i="default";else{const o=r.texture.format;i=`${r.textures.length}:${o}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const s=this._getChainMap(i);let a=s.get(yf);return a===void 0&&(a=new Ase,s.set(yf,a)),yf.length=0,r!==null&&(a.sampleCount=r.samples===0?1:r.samples),a}getForClear(e=null){return this.get(Rse,Pse,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new $s)}dispose(){this.chainMaps={}}}const Lse=new ee;class Dse extends El{constructor(e,t,r){super(),this.renderer=e,this.backend=t,this.info=r}updateRenderTarget(e,t=0){const r=this.get(e),i=e.samples===0?1:e.samples,s=r.depthTextureMips||(r.depthTextureMips={}),a=e.textures,o=this.getSize(a[0]),l=o.width>>t,u=o.height>>t;let h=e.depthTexture||s[t];const p=e.depthBuffer===!0||e.stencilBuffer===!0;let m=!1;h===void 0&&p&&(h=new xs,h.format=e.stencilBuffer?Qi:Zi,h.type=e.stencilBuffer?Ki:En,h.image.width=l,h.image.height=u,h.image.depth=o.depth,h.isArrayTexture=e.multiview===!0&&o.depth>1,s[t]=h),(r.width!==o.width||o.height!==r.height)&&(m=!0,h&&(h.needsUpdate=!0,h.image.width=l,h.image.height=u,h.image.depth=h.isArrayTexture?h.image.depth:1)),r.width=o.width,r.height=o.height,r.textures=a,r.depthTexture=h||null,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==i&&(m=!0,h&&(h.needsUpdate=!0),r.sampleCount=i);const g={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let y=0;y<a.length;y++){const b=a[y];m&&(b.needsUpdate=!0),this.updateTexture(b,g)}h&&this.updateTexture(h,g)}if(r.initialized!==!0){r.initialized=!0;const y=()=>{e.removeEventListener("dispose",y);for(let b=0;b<a.length;b++)this._destroyTexture(a[b]);h&&this._destroyTexture(h),this.delete(e)};e.addEventListener("dispose",y)}}updateTexture(e,t={}){const r=this.get(e);if(r.initialized===!0&&r.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(i&&r.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=Hn}const{width:a,height:o,depth:l}=this.getSize(e);if(t.width=a,t.height=o,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,i||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),r.generation=e.version;else if(r.initialized!==!0&&s.createSampler(e),e.version>0){const h=e.image;if(h===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(h.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const m of e.images)p.push(m);t.images=p}else t.image=h;(r.isDefaultTexture===void 0||r.isDefaultTexture===!0)&&(s.createTexture(e,t),r.isDefaultTexture=!1,r.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),r.isDefaultTexture=!0,r.generation=e.version;if(r.initialized!==!0){r.initialized=!0,r.generation=e.version,this.info.memory.textures++;const u=()=>{e.removeEventListener("dispose",u),this._destroyTexture(e)};e.addEventListener("dispose",u)}r.version=e.version}getSize(e,t=Lse){let r=e.images?e.images[0]:e.image;return r?(r.image!==void 0&&(r=r.image),t.width=r.width||1,t.height=r.height||1,t.depth=e.isCubeTexture?6:r.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,r){let i;return e.isCompressedTexture?e.mipmaps?i=e.mipmaps.length:i=1:i=Math.floor(Math.log2(Math.max(t,r)))+1,i}needsMipmaps(e){return e.isCompressedTexture===!0||e.generateMipmaps}_destroyTexture(e){this.has(e)===!0&&(this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e),this.info.memory.textures--)}}class FT extends vt{constructor(e,t,r,i=1){super(e,t,r),this.a=i}set(e,t,r,i=1){return this.a=i,super.set(e,t,r)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class Ise extends mn{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class jse extends Vt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const r=new Lf(t);return this._currentCond=pi(e,r),this.add(this._currentCond)}ElseIf(e,t){const r=new Lf(t),i=pi(e,r);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new Lf(e),this}Switch(e){return this._expressionNode=Fe(e),this}Case(...e){const t=[];if(e.length>=2)for(let o=0;o<e.length-1;o++)t.push(this._expressionNode.equal(Fe(e[o])));else throw new Error("TSL: Invalid parameter length. Case() requires at least two parameters.");const r=e[e.length-1],i=new Lf(r);let s=t[0];for(let o=1;o<t.length;o++)s=s.or(t[o]);const a=pi(s,i);return this._currentCond===null?(this._currentCond=a,this.add(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(e){return this.Else(e),this}build(e,...t){const r=e.currentStack,i=VD();mx(this),e.currentStack=this;const s=e.buildStage;for(const o of this.nodes)if(s==="setup")o.build(e);else if(s==="analyze")o.build(e,this);else if(s==="generate"){const l=e.getDataFromNode(o,"any").stages,u=l&&l[e.shaderStage];if(o.isVarNode&&u&&u.length===1&&u[0]&&u[0].isStackNode)continue;o.build(e,"void")}const a=this.outputNode?this.outputNode.build(e,...t):super.build(e,...t);return mx(i),e.currentStack=r,a}}const Gb=Ue(jse).setParameterLength(0,1);new js;new ee;new ee;new ee;new Yt;new ee(0,0,-1);new Lt;new ee;new ee;new Lt;new je;const Fse=new Pc;pd.flipX();Fse.depthTexture=new xs(1,1);const Hb=new tm(-1,1,1,-1,0,1);class Ose extends ei{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new tr([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new tr(t,2))}}const Use=new Ose;class OT extends Xn{constructor(e=null){super(Use,e),this.camera=Hb,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,Hb)}render(e){e.render(this,Hb)}}const vf=new ki,$b=new Yt;class Ci extends Vt{static get type(){return"SceneNode"}constructor(e=Ci.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,r=this.scene!==null?this.scene:e.scene;let i;return t===Ci.BACKGROUND_BLURRINESS?i=Nn("backgroundBlurriness","float",r):t===Ci.BACKGROUND_INTENSITY?i=Nn("backgroundIntensity","float",r):t===Ci.BACKGROUND_ROTATION?i=jt("mat4").label("backgroundRotation").setGroup(It).onRenderUpdate(()=>{const s=r.background;return s!==null&&s.isTexture&&s.mapping!==P1?(vf.copy(r.backgroundRotation),vf.x*=-1,vf.y*=-1,vf.z*=-1,$b.makeRotationFromEuler(vf)):$b.identity(),$b}):console.error("THREE.SceneNode: Unknown scope:",t),i}}Ci.BACKGROUND_BLURRINESS="backgroundBlurriness";Ci.BACKGROUND_INTENSITY="backgroundIntensity";Ci.BACKGROUND_ROTATION="backgroundRotation";const Bse=Ye(Ci,Ci.BACKGROUND_BLURRINESS),CR=Ye(Ci,Ci.BACKGROUND_INTENSITY),zse=Ye(Ci,Ci.BACKGROUND_ROTATION),Vse=ke(({texture:n,uv:e})=>{const r=Ae().toVar();return nr(e.x.lessThan(1e-4),()=>{r.assign(Ae(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{r.assign(Ae(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{r.assign(Ae(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{r.assign(Ae(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{r.assign(Ae(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{r.assign(Ae(0,0,-1))}).Else(()=>{const s=n.sample(e.add(Ae(-.01,0,0))).r.sub(n.sample(e.add(Ae(.01,0,0))).r),a=n.sample(e.add(Ae(0,-.01,0))).r.sub(n.sample(e.add(Ae(0,.01,0))).r),o=n.sample(e.add(Ae(0,0,-.01))).r.sub(n.sample(e.add(Ae(0,0,.01))).r);r.assign(Ae(s,a,o))}),r.normalize()});class Gse extends lh{static get type(){return"Texture3DNode"}constructor(e,t=null,r=null){super(e,t,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Ae(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Cn(fd(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return Vse({texture:this,uv:e})}}const Hse=Ue(Gse).setParameterLength(1,3),l0=new je;class $se extends lh{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class AR extends $se{static get type(){return"PassMultipleTextureNode"}constructor(e,t,r=!1){super(e,null),this.textureName=t,this.previousTexture=r}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}class py extends Rr{static get type(){return"PassNode"}constructor(e,t,r,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=r,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const s=new xs;s.isRenderTargetTexture=!0,s.name="depth";const a=new Pc(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Cr,...i});a.texture.name="output",a.depthTexture=s,this.renderTarget=a,this._textures={output:a.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=jt(0),this._cameraFar=jt(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=Xt.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const r=this._textures[e],i=this.renderTarget.textures.indexOf(r);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=r,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=Fe(new AR(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=Fe(new AR(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=UI(this.getTextureNode(e),r,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=qf(s,r,i)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getColorBufferType(),this.scope===py.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:r}=this;let i,s;const a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(s=1,i=t.xr.getCamera(),t.xr.updateCamera(i),l0.set(a.width,a.height)):(i=this.camera,s=t.getPixelRatio(),t.getSize(l0)),this._pixelRatio=s,this.setSize(l0.width,l0.height);const o=t.getRenderTarget(),l=t.getMRT(),u=i.layers.mask;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const h in this._previousTextures)this.toggleTexture(h);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(r,i),t.setRenderTarget(o),t.setMRT(l),i.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio*this._resolution,i=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}py.COLOR="color";py.DEPTH="depth";const Wse=ke(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),qse=ke(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Xse=ke(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),r=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Yse=ke(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Kse=ke(([n,e])=>{const t=mi(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=mi(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=Yse(n),n=r.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Zse=mi(Ae(1.6605,-.1246,-.0182),Ae(-.5876,1.1329,-.1006),Ae(-.0728,-.0083,1.1187)),Qse=mi(Ae(.6274,.0691,.0164),Ae(.3293,.9195,.088),Ae(.0433,.0113,.8956)),Jse=ke(([n])=>{const e=Ae(n).toVar(),t=Ae(e.mul(e)).toVar(),r=Ae(t.mul(t)).toVar();return Me(15.5).mul(r.mul(t)).sub(Jt(40.14,r.mul(e))).add(Jt(31.96,r).sub(Jt(6.868,t.mul(e))).add(Jt(.4298,t).add(Jt(.1191,e).sub(.00232))))}),eae=ke(([n,e])=>{const t=Ae(n).toVar(),r=mi(Ae(.856627153315983,.137318972929847,.11189821299995),Ae(.0951212405381588,.761241990602591,.0767994186031903),Ae(.0482516061458583,.101439036467562,.811302368396859)),i=mi(Ae(1.1271005818144368,-.1413297634984383,-.14132976349843826),Ae(-.11060664309660323,1.157823702216272,-.11060664309660294),Ae(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=Me(-12.47393),a=Me(4.026069);return t.mulAssign(e),t.assign(Qse.mul(t)),t.assign(r.mul(t)),t.assign(Jr(t,1e-10)),t.assign(uo(t)),t.assign(t.sub(s).div(a.sub(s))),t.assign(yo(t,0,1)),t.assign(Jse(t)),t.assign(i.mul(t)),t.assign(oy(Jr(Ae(0),t),Ae(2.2))),t.assign(Zse.mul(t)),t.assign(yo(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),tae=ke(([n,e])=>{const t=Me(.76),r=Me(.15);n=n.mul(e);const i=Gd(n.r,Gd(n.g,n.b)),s=pi(i.lessThan(.08),i.sub(Jt(6.25,i.mul(i))),.04);n.subAssign(s);const a=Jr(n.r,Jr(n.g,n.b));nr(a.lessThan(t),()=>n);const o=ci(1,t),l=ci(1,o.mul(o).div(a.add(o.sub(t))));n.mulAssign(l.div(a));const u=ci(1,_a(1,r.mul(a.sub(l)).add(1)));return Ln(n,Ae(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class fr extends Vt{static get type(){return"CodeNode"}constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=r}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class nae extends fr{static get type(){return"FunctionNode"}constructor(e="",t=[],r=""){super(e,t,r)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let r=t.nodeFunction;return r===void 0&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);const r=this.getNodeFunction(e),i=r.name,s=r.type,a=e.getCodeFromNode(this,s);i!==""&&(a.name=i);const o=e.getPropertyName(a),l=this.getNodeFunction(e).getCode(o);return a.code=l+`
`,t==="property"?o:e.format(`${o}()`,s,t)}}function cj(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||Qn.z).negate()}const rae=ke(([n,e],t)=>{const r=cj(t);return bl(n,e,r)}),iae=ke(([n],e)=>{const t=cj(e);return n.mul(n,t,t).negate().exp().oneMinus()}),RR=ke(([n,e])=>zt(e.toFloat().mix(Hf.rgb,n.toVec3()),Hf.a));class sae extends Vt{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:r}=e;r.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Ue(sae);class Na extends Vt{static get type(){return"AtomicFunctionNode"}constructor(e,t,r){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=r,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),r=t.parents,i=this.method,s=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,l=this.valueNode,u=[];u.push(`&${o.build(e,a)}`),l!==null&&u.push(l.build(e,a));const h=`${e.getMethod(i,s)}( ${u.join(", ")} )`;if(r.length===1&&r[0].isStackNode===!0)e.addLineFlowCode(h,this);else return t.constNode===void 0&&(t.constNode=Hd(h,s).toConst()),t.constNode.build(e)}}Na.ATOMIC_LOAD="atomicLoad";Na.ATOMIC_STORE="atomicStore";Na.ATOMIC_ADD="atomicAdd";Na.ATOMIC_SUB="atomicSub";Na.ATOMIC_MAX="atomicMax";Na.ATOMIC_MIN="atomicMin";Na.ATOMIC_AND="atomicAnd";Na.ATOMIC_OR="atomicOr";Na.ATOMIC_XOR="atomicXor";Ue(Na);let c0;function my(n){c0=c0||new WeakMap;let e=c0.get(n);return e===void 0&&c0.set(n,e={}),e}function uj(n){const e=my(n);return e.shadowMatrix||(e.shadowMatrix=jt("mat4").setGroup(It).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&n.shadow.updateMatrices(n),n.shadow.matrix)))}function aae(n,e=Rp){const t=uj(n).mul(e);return t.xyz.div(t.w)}function dj(n){const e=my(n);return e.position||(e.position=jt(new ee).setGroup(It).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.matrixWorld)))}function oae(n){const e=my(n);return e.targetPosition||(e.targetPosition=jt(new ee).setGroup(It).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.target.matrixWorld)))}function hj(n){const e=my(n);return e.viewPosition||(e.viewPosition=jt(new ee).setGroup(It).onRenderUpdate(({camera:t},r)=>{r.value=r.value||new ee,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(t.matrixWorldInverse)}))}const fj=n=>So.transformDirection(dj(n).sub(oae(n))),lae=n=>n.sort((e,t)=>e.id-t.id),cae=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},Wb=new WeakMap,_f=[];class pj extends Vt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ml("vec3","totalDiffuse"),this.totalSpecularNode=ml("vec3","totalSpecular"),this.outgoingLightNode=ml("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let r=0;r<e.length;r++){const i=e[r];if(_f.push(i.id),_f.push(i.castShadow?1:0),i.isSpotLight===!0){const s=i.map!==null?i.map.id:-1,a=i.colorNode?i.colorNode.getCacheKey():-1;_f.push(s,a)}}const t=dT(_f);return _f.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const r of this._lightNodes)t.push(r.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const r of t.nodes)r.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],r=this._lightNodes,i=lae(this._lights),s=e.renderer.library;for(const a of i)if(a.isNode)t.push(Fe(a));else{let o=null;if(r!==null&&(o=cae(a.id,r)),o===null){const l=s.getLightNodeClass(a.constructor);if(l===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let u=null;Wb.has(a)?u=Wb.get(a):(u=Fe(new l(a)),Wb.set(a,u)),t.push(u)}}this._lightNodes=t}setupDirectLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.direct({...r,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.directRectArea({...r,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const r of t)r.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let r=this.outgoingLightNode;const i=e.context,s=i.lightingModel,a=e.getNodeProperties(this);if(s){const{totalDiffuseNode:o,totalSpecularNode:l}=this;i.outgoingLight=r;const u=e.addStack();a.nodes=u.nodes,s.start(e);const{backdrop:h,backdropAlpha:p}=i,{directDiffuse:m,directSpecular:g,indirectDiffuse:y,indirectSpecular:b}=i.reflectedLight;let _=m.add(y);h!==null&&(p!==null?_=Ae(p.mix(_,h)):_=Ae(h),i.material.transparent=!0),o.assign(_),l.assign(g.add(b)),r.assign(o.add(l)),s.finish(e),r=r.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class uae extends Vt{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Xt.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){mj.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Rp)}}const mj=ml("vec3","shadowPositionWorld");function dae(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new vt),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function hae(n,e){return e=dae(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function fae(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function pae(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function mae(n,e){return e=pae(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function gae(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function xae(n,e,t){return t=hae(n,t),t=mae(e,t),t}function yae(n,e,t){fae(n,t),gae(e,t)}const PR=new WeakMap,vae=ke(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=ln(n,e.xy).label("t_basic");return n.isArrayTexture&&(r=r.depth(t)),r.compare(e.z)}),_ae=ke(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(_,x)=>{let N=ln(n,_);return n.isArrayTexture&&(N=N.depth(r)),N.compare(x)},s=Nn("mapSize","vec2",t).setGroup(It),a=Nn("radius","float",t).setGroup(It),o=Xe(1).div(s),l=o.x.negate().mul(a),u=o.y.negate().mul(a),h=o.x.mul(a),p=o.y.mul(a),m=l.div(2),g=u.div(2),y=h.div(2),b=p.div(2);return Li(i(e.xy.add(Xe(l,u)),e.z),i(e.xy.add(Xe(0,u)),e.z),i(e.xy.add(Xe(h,u)),e.z),i(e.xy.add(Xe(m,g)),e.z),i(e.xy.add(Xe(0,g)),e.z),i(e.xy.add(Xe(y,g)),e.z),i(e.xy.add(Xe(l,0)),e.z),i(e.xy.add(Xe(m,0)),e.z),i(e.xy,e.z),i(e.xy.add(Xe(y,0)),e.z),i(e.xy.add(Xe(h,0)),e.z),i(e.xy.add(Xe(m,b)),e.z),i(e.xy.add(Xe(0,b)),e.z),i(e.xy.add(Xe(y,b)),e.z),i(e.xy.add(Xe(l,p)),e.z),i(e.xy.add(Xe(0,p)),e.z),i(e.xy.add(Xe(h,p)),e.z)).mul(1/17)}),bae=ke(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(p,m)=>{let g=ln(n,p);return n.isArrayTexture&&(g=g.depth(r)),g.compare(m)},s=Nn("mapSize","vec2",t).setGroup(It),a=Xe(1).div(s),o=a.x,l=a.y,u=e.xy,h=Tl(u.mul(s).add(.5));return u.subAssign(h.mul(a)),Li(i(u,e.z),i(u.add(Xe(o,0)),e.z),i(u.add(Xe(0,l)),e.z),i(u.add(a),e.z),Ln(i(u.add(Xe(o.negate(),0)),e.z),i(u.add(Xe(o.mul(2),0)),e.z),h.x),Ln(i(u.add(Xe(o.negate(),l)),e.z),i(u.add(Xe(o.mul(2),l)),e.z),h.x),Ln(i(u.add(Xe(0,l.negate())),e.z),i(u.add(Xe(0,l.mul(2))),e.z),h.y),Ln(i(u.add(Xe(o,l.negate())),e.z),i(u.add(Xe(o,l.mul(2))),e.z),h.y),Ln(Ln(i(u.add(Xe(o.negate(),l.negate())),e.z),i(u.add(Xe(o.mul(2),l.negate())),e.z),h.x),Ln(i(u.add(Xe(o.negate(),l.mul(2))),e.z),i(u.add(Xe(o.mul(2),l.mul(2))),e.z),h.x),h.y)).mul(1/9)}),wae=ke(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{const r=Me(1).toVar();let i=ln(n).sample(e.xy);n.isArrayTexture&&(i=i.depth(t)),i=i.rg;const s=sI(e.z,i.x);return nr(s.notEqual(Me(1)),()=>{const a=e.z.sub(i.x),o=Jr(0,i.y.mul(i.y));let l=o.div(o.add(a.mul(a)));l=yo(ci(l,.3).div(.95-.3)),r.assign(yo(Jr(s,l)))}),r}),Sae=ke(([n,e,t])=>{let r=Rp.sub(n).length();return r=r.sub(e).div(t.sub(e)),r=r.saturate(),r}),Tae=n=>{const e=n.shadow.camera,t=Nn("near","float",e).setGroup(It),r=Nn("far","float",e).setGroup(It),i=tne(n);return Sae(i,t,r)},Nae=n=>{let e=PR.get(n);if(e===void 0){const t=n.isPointLight?Tae(n):null;e=new lr,e.colorNode=zt(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,PR.set(n,e)}return e},kR=new $s,Fu=[],Eae=(n,e,t,r)=>{Fu[0]=n,Fu[1]=e;let i=kR.get(Fu);return(i===void 0||i.shadowType!==t||i.useVelocity!==r)&&(i=(s,a,o,l,u,h,...p)=>{(s.castShadow===!0||s.receiveShadow&&t===Wi)&&(r&&(FD(s).useVelocity=!0),s.onBeforeShadow(n,s,o,e.camera,l,a.overrideMaterial,h),n.renderObject(s,a,o,l,u,h,...p),s.onAfterShadow(n,s,o,e.camera,l,a.overrideMaterial,h))},i.shadowType=t,i.useVelocity=r,kR.set(Fu,i)),Fu[0]=null,Fu[1]=null,i},Mae=ke(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=Me(0).toVar("meanVertical"),a=Me(0).toVar("squareMeanVertical"),o=n.lessThanEqual(Me(1)).select(Me(0),Me(2).div(n.sub(1))),l=n.lessThanEqual(Me(1)).select(Me(0),Me(-1));Bs({start:Cn(0),end:Cn(n),type:"int",condition:"<"},({i:h})=>{const p=l.add(Me(h).mul(o));let m=r.sample(Li(dy.xy,Xe(0,p).mul(e)).div(t));r.value.isArrayTexture&&(m=m.depth(i)),m=m.x,s.addAssign(m),a.addAssign(m.mul(m))}),s.divAssign(n),a.divAssign(n);const u=wT(a.sub(s.mul(s)));return Xe(s,u)}),Cae=ke(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=Me(0).toVar("meanHorizontal"),a=Me(0).toVar("squareMeanHorizontal"),o=n.lessThanEqual(Me(1)).select(Me(0),Me(2).div(n.sub(1))),l=n.lessThanEqual(Me(1)).select(Me(0),Me(-1));Bs({start:Cn(0),end:Cn(n),type:"int",condition:"<"},({i:h})=>{const p=l.add(Me(h).mul(o));let m=r.sample(Li(dy.xy,Xe(p,0).mul(e)).div(t));r.value.isArrayTexture&&(m=m.depth(i)),s.addAssign(m.x),a.addAssign(Li(m.y.mul(m.y),m.x.mul(m.x)))}),s.divAssign(n),a.divAssign(n);const u=wT(a.sub(s.mul(s)));return Xe(s,u)}),Aae=[vae,_ae,bae,wae];let qb;const u0=new OT;class gj extends uae{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s,depthLayer:a}){const o=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),l=t({depthTexture:r,shadowCoord:i,shadow:s,depthLayer:a});return o.select(l,Me(1))}setupShadowCoord(e,t){const{shadow:r}=this,{renderer:i}=e,s=Nn("bias","float",r).setGroup(It);let a=t,o;if(r.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),o=a.z,i.coordinateSystem===vl&&(o=o.mul(2).sub(1));else{const l=a.w;a=a.xy.div(l);const u=Nn("near","float",r.camera).setGroup(It),h=Nn("far","float",r.camera).setGroup(It);o=BI(l.negate(),u,h)}return a=Ae(a.x,a.y.oneMinus(),o.add(s)),a}getShadowFilterFn(e){return Aae[e]}setupRenderTarget(e,t){const r=new xs(e.mapSize.width,e.mapSize.height);r.name="ShadowDepthTexture",r.compareFunction=qx;const i=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return i.texture.name="ShadowMap",i.texture.type=e.mapType,i.depthTexture=r,{shadowMap:i,depthTexture:r}}setupShadow(e){const{renderer:t}=e,{light:r,shadow:i}=this,s=t.shadowMap.type,{depthTexture:a,shadowMap:o}=this.setupRenderTarget(i,e);if(i.camera.updateProjectionMatrix(),s===Wi&&i.isPointLightShadow!==!0){a.compareFunction=null,o.depth>1?(o._vsmShadowMapVertical||(o._vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:no,type:Cr,depth:o.depth,depthBuffer:!1}),o._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=o._vsmShadowMapVertical,o._vsmShadowMapHorizontal||(o._vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:no,type:Cr,depth:o.depth,depthBuffer:!1}),o._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=o._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:no,type:Cr,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:no,type:Cr,depthBuffer:!1}));let x=ln(a);a.isArrayTexture&&(x=x.depth(this.depthLayer));let N=ln(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(N=N.depth(this.depthLayer));const T=Nn("blurSamples","float",i).setGroup(It),S=Nn("radius","float",i).setGroup(It),M=Nn("mapSize","vec2",i).setGroup(It);let C=this.vsmMaterialVertical||(this.vsmMaterialVertical=new lr);C.fragmentNode=Mae({samples:T,radius:S,size:M,shadowPass:x,depthLayer:this.depthLayer}).context(e.getSharedContext()),C.name="VSMVertical",C=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new lr),C.fragmentNode=Cae({samples:T,radius:S,size:M,shadowPass:N,depthLayer:this.depthLayer}).context(e.getSharedContext()),C.name="VSMHorizontal"}const l=Nn("intensity","float",i).setGroup(It),u=Nn("normalBias","float",i).setGroup(It),h=uj(r).mul(mj.add(ch.mul(u))),p=this.setupShadowCoord(e,h),m=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(m===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const g=s===Wi&&i.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,y=this.setupShadowFilter(e,{filterFn:m,shadowTexture:o.texture,depthTexture:g,shadowCoord:p,shadow:i,depthLayer:this.depthLayer});let b=ln(o.texture,p);a.isArrayTexture&&(b=b.depth(this.depthLayer));const _=Ln(1,y.rgb.mix(b,1),l.mul(b.a)).toVar();return this.shadowMap=o,this.shadow.map=o,_}setup(e){if(e.renderer.shadowMap.enabled!==!1)return ke(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:a}=e;t.updateMatrices(i),r.setSize(t.mapSize.width,t.mapSize.height,r.depth),s.render(a,t.camera)}updateShadow(e){const{shadowMap:t,light:r,shadow:i}=this,{renderer:s,scene:a,camera:o}=e,l=s.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;const h=i.camera.layers.mask;(i.camera.layers.mask&4294967294)===0&&(i.camera.layers.mask=o.layers.mask);const p=s.getRenderObjectFunction(),m=s.getMRT(),g=m?m.has("velocity"):!1;qb=xae(s,a,qb),a.overrideMaterial=Nae(r),s.setRenderObjectFunction(Eae(s,i,l,g)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(p),l===Wi&&i.isPointLightShadow!==!0&&this.vsmPass(s),i.camera.layers.mask=h,yae(s,a,qb)}vsmPass(e){const{shadow:t}=this,r=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,r),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,r),e.setRenderTarget(this.vsmShadowMapVertical),u0.material=this.vsmMaterialVertical,u0.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),u0.material=this.vsmMaterialHorizontal,u0.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let r=t.needsUpdate||t.autoUpdate;r&&(this._cameraFrameId[e.camera]===e.frameId&&(r=!1),this._cameraFrameId[e.camera]=e.frameId),r&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const Rae=(n,e)=>Fe(new gj(n,e)),Pae=new vt,ia=ke(([n,e])=>{const t=n.toVar(),r=fs(t),i=_a(1,Jr(r.x,Jr(r.y,r.z)));r.mulAssign(i),t.mulAssign(i.mul(e.mul(2).oneMinus()));const s=Xe(t.xy).toVar(),o=e.mul(1.5).oneMinus();return nr(r.z.greaterThanEqual(o),()=>{nr(t.z.greaterThan(0),()=>{s.x.assign(ci(4,t.x))})}).ElseIf(r.x.greaterThanEqual(o),()=>{const l=_x(t.x);s.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(r.y.greaterThanEqual(o),()=>{const l=_x(t.y);s.x.assign(t.x.add(l.mul(2)).add(2)),s.y.assign(t.z.mul(l).sub(2))}),Xe(.125,.25).mul(s).add(Xe(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),kae=ke(({depthTexture:n,bd3D:e,dp:t,texelSize:r})=>ln(n,ia(e,r.y)).compare(t)),Lae=ke(({depthTexture:n,bd3D:e,dp:t,texelSize:r,shadow:i})=>{const s=Nn("radius","float",i).setGroup(It),a=Xe(-1,1).mul(s).mul(r.y);return ln(n,ia(e.add(a.xyy),r.y)).compare(t).add(ln(n,ia(e.add(a.yyy),r.y)).compare(t)).add(ln(n,ia(e.add(a.xyx),r.y)).compare(t)).add(ln(n,ia(e.add(a.yyx),r.y)).compare(t)).add(ln(n,ia(e,r.y)).compare(t)).add(ln(n,ia(e.add(a.xxy),r.y)).compare(t)).add(ln(n,ia(e.add(a.yxy),r.y)).compare(t)).add(ln(n,ia(e.add(a.xxx),r.y)).compare(t)).add(ln(n,ia(e.add(a.yxx),r.y)).compare(t)).mul(1/9)}),Dae=ke(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:r})=>{const i=t.xyz.toVar(),s=i.length(),a=jt("float").setGroup(It).onRenderUpdate(()=>r.camera.near),o=jt("float").setGroup(It).onRenderUpdate(()=>r.camera.far),l=Nn("bias","float",r).setGroup(It),u=jt(r.mapSize).setGroup(It),h=Me(1).toVar();return nr(s.sub(o).lessThanEqual(0).and(s.sub(a).greaterThanEqual(0)),()=>{const p=s.sub(a).div(o.sub(a)).toVar();p.addAssign(l);const m=i.normalize(),g=Xe(1).div(u.mul(Xe(4,2)));h.assign(n({depthTexture:e,bd3D:m,dp:p,texelSize:g,shadow:r}))}),h}),LR=new Lt,Ou=new je,bf=new je;class Iae extends gj{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===y$?kae:Lae}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:r,depthTexture:i,shadowCoord:s,shadow:a}){return Dae({filterFn:t,shadowTexture:r,depthTexture:i,shadowCoord:s,shadow:a})}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:a}=e,o=t.getFrameExtents();bf.copy(t.mapSize),bf.multiply(o),r.setSize(bf.width,bf.height),Ou.copy(t.mapSize);const l=s.autoClear,u=s.getClearColor(Pae),h=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const p=t.getViewportCount();for(let m=0;m<p;m++){const g=t.getViewport(m),y=Ou.x*g.x,b=bf.y-Ou.y-Ou.y*g.y;LR.set(y,b,Ou.x*g.z,Ou.y*g.w),r.viewport.copy(LR),t.updateMatrices(i,m),s.render(a,t.camera)}s.autoClear=l,s.setClearColor(u,h)}}const jae=(n,e)=>Fe(new Iae(n,e));class Ic extends uh{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new vt,this.colorNode=e&&e.colorNode||jt(this.color).setGroup(It),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Xt.FRAME}getHash(){return this.light.uuid}getLightVector(e){return hj(this.light).sub(e.context.positionView||Qn)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return Rae(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let r=this.shadowColorNode;if(r===null){const i=this.light.shadow.shadowNode;let s;i!==void 0?s=Fe(i):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=r=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=r}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),r=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),r&&e.lightsNode.setupDirectRectAreaLight(e,this,r)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const xj=ke(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const r=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(r.mul(n.div(e).pow4().oneMinus().clamp().pow2()),r)}),Fae=({color:n,lightVector:e,cutoffDistance:t,decayExponent:r})=>{const i=e.normalize(),s=e.length(),a=xj({lightDistance:s,cutoffDistance:t,decayExponent:r}),o=n.mul(a);return{lightDirection:i,lightColor:o}};class Oae extends Ic{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=jt(0).setGroup(It),this.decayExponentNode=jt(2).setGroup(It)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return jae(this.light)}setupDirect(e){return Fae({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}ke(([n=im()],{renderer:e,material:t})=>{const r=lI(n.mul(2).sub(1));let i;if(t.alphaToCoverage&&e.samples>1){const s=Me(r.fwidth()).toVar();i=bl(s.oneMinus(),s.add(1),r).oneMinus()}else i=pi(r.greaterThan(1),0,1);return i});const Uae=ke(([n,e])=>{const t=n.x,r=n.y,i=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(r)),s=s.add(e.element(2).mul(2*.511664).mul(i)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(5).mul(2*.429043).mul(r).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(8).mul(.429043).mul(Jt(t,t).sub(Jt(r,r)))),s}),Ps=new FT;class Bae extends El{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,r){const i=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(s===null)i._clearColor.getRGB(Ps),Ps.a=i._clearColor.a;else if(s.isColor===!0)s.getRGB(Ps),Ps.a=1,a=!0;else if(s.isNode===!0){const l=this.get(e),u=s;Ps.copy(i._clearColor);let h=l.backgroundMesh;if(h===void 0){let b=function(){s.removeEventListener("dispose",b),h.material.dispose(),h.geometry.dispose()};const m=NT(zt(u).mul(CR),{getUV:()=>zse.mul(one),getTextureLevel:()=>Bse});let g=jI;g=g.setZ(g.w);const y=new lr;y.name="Background.material",y.side=bn,y.depthTest=!1,y.depthWrite=!1,y.allowOverride=!1,y.fog=!1,y.lights=!1,y.vertexNode=g,y.colorNode=m,l.backgroundMeshNode=m,l.backgroundMesh=h=new Xn(new ih(1,32,32),y),h.frustumCulled=!1,h.name="Background.mesh",h.onBeforeRender=function(_,x,N){this.matrixWorld.copyPosition(N.matrixWorld)},s.addEventListener("dispose",b)}const p=u.getCacheKey();l.backgroundCacheKey!==p&&(l.backgroundMeshNode.node=zt(u).mul(CR),l.backgroundMeshNode.needsUpdate=!0,h.material.needsUpdate=!0,l.backgroundCacheKey=p),t.unshift(h,h.geometry,h.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);const o=i.xr.getEnvironmentBlendMode();if(o==="additive"?Ps.set(0,0,0,1):o==="alpha-blend"&&Ps.set(0,0,0,0),i.autoClear===!0||a===!0){const l=r.clearColorValue;l.r=Ps.r,l.g=Ps.g,l.b=Ps.b,l.a=Ps.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(l.r*=l.a,l.g*=l.a,l.b*=l.a),r.depthClearValue=i._clearDepth,r.stencilClearValue=i._clearStencil,r.clearColor=i.autoClearColor===!0,r.clearDepth=i.autoClearDepth===!0,r.clearStencil=i.autoClearStencil===!0}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}let zae=0;class ES{constructor(e="",t=[],r=0,i=[]){this.name=e,this.bindings=t,this.index=r,this.bindingsReference=i,this.id=zae++}}class Vae{constructor(e,t,r,i,s,a,o,l,u,h=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=r,this.transforms=h,this.nodeAttributes=i,this.bindings=s,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=l,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new ES(t.name,[],t.index,t);e.push(i);for(const s of t.bindings)i.bindings.push(s.clone())}else e.push(t);return e}}class DR{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class Gae{constructor(e,t,r){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class yj{constructor(e,t,r=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=r,this.count=i}}class Hae extends yj{constructor(e,t,r=null,i=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=r,this.interpolationSampling=i}}class $ae{constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}let Wae=0;class Xb{constructor(e=null){this.id=Wae++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class qae{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class Ml{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Xae extends Ml{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class Yae extends Ml{constructor(e,t=new je){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class Kae extends Ml{constructor(e,t=new ee){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class Zae extends Ml{constructor(e,t=new Lt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class Qae extends Ml{constructor(e,t=new vt){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class Jae extends Ml{constructor(e,t=new Qx){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class eoe extends Ml{constructor(e,t=new Ut){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class toe extends Ml{constructor(e,t=new Yt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class noe extends Xae{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class roe extends Yae{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ioe extends Kae{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class soe extends Zae{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class aoe extends Qae{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ooe extends Jae{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class loe extends eoe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class coe extends toe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const IR=new WeakMap,uoe=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),d0=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class vj{constructor(e,t,r){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Gb(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Xb,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.currentStack=null,this.subBuildFn=null}getBindGroupsCache(){let e=IR.get(this.renderer);return e===void 0&&(e=new $s,IR.set(this.renderer,e)),e}createRenderTarget(e,t,r){return new Pc(e,t,r)}createCubeRenderTarget(e,t){return new HI(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const r=this.getBindGroupsCache(),i=[];let s=!0;for(const o of t)i.push(o),s=s&&o.groupNode.shared!==!0;let a;return s?(a=r.get(i),a===void 0&&(a=new ES(e,i,this.bindingsIndexes[e].group,i),r.set(i,a))):a=new ES(e,i,this.bindingsIndexes[e].group,i),a}getBindGroupArray(e,t){const r=this.bindings[t];let i=r[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),r[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},r=this.bindings;for(const i of A2)for(const s in r[i]){const a=r[i][s];(t[s]||(t[s]=[])).push(...a)}e=[];for(const i in t){const s=t[i],a=this._getBindGroup(i,s);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,r)=>t.bindings[0].groupNode.order-r.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const r=e[t];this.bindingsIndexes[r.name].group=t,r.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Xt.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),r=e.getUpdateAfterType();t!==Xt.NONE&&this.updateBeforeNodes.push(e.getSelf()),r!==Xt.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===pr||e.magFilter===od||e.magFilter===to||e.magFilter===Ei||e.minFilter===pr||e.minFilter===od||e.minFilter===to||e.minFilter===Ei}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const r=this.getDataFromNode(e);return r.cache===void 0&&(r.cache=new Xb(t?this.getCache():null)),r.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,r=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const a=r?r[s]:null;a!==null?i+=a.build(this,e):i+=this.generateConst(e),s<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,r=null){const i=[];for(const s of t){const{name:a,type:o}=s;r&&r[a]&&r[a].isNode?i.push(r[a].build(this,o)):i.push(this.generateConst(o))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new vt:e==="vec2"?t=new je:e==="vec3"?t=new ee:e==="vec4"&&(t=new Lt)),e==="float")return d0(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${d0(t.r)}, ${d0(t.g)}, ${d0(t.b)} )`;const r=this.getTypeLength(e),i=this.getComponentType(e),s=a=>this.generateConst(i,a);if(r===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(r===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(r===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(r>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const r=this.attributes;for(const s of r)if(s.name===e)return s;const i=new DR(e,t);return this.registerDeclaration(i),r.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Er)return"int";if(t===En)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let r=AJ(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(r=r.replace("vec","mat")),i+r}getTypeFromArray(e){return uoe.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const r=t.array,i=e.itemSize,s=e.normalized;let a;return!(e instanceof U3)&&s!==!0&&(a=this.getTypeFromArray(r)),this.getTypeFromLength(i,a)}getTypeLength(e){const t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return r!==null?Number(r[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=Gb(this.stack),this.stacks.push(VD()||this.stack),mx(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,mx(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,r=null){r=r===null?e.isGlobal(this)?this.globalCache:this.cache:r;let i=r.getData(e);i===void 0&&(i={},r.setData(e,i)),i[t]===void 0&&(i[t]={});let s=i[t];const a=i.any?i.any.subBuilds:null,o=this.getClosestSubBuild(a);return o&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[o]||(s.subBuildsCache[o]={}),s.subBuilds=a),s}getNodeProperties(e,t="any"){const r=this.getDataFromNode(e,t);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const r=this.getDataFromNode(e);let i=r.bufferAttribute;if(i===void 0){const s=this.uniforms.index++;i=new DR("nodeAttribute"+s,t,e),this.bufferAttributes.push(i),r.bufferAttribute=i}return i}getStructTypeFromNode(e,t,r=null,i=this.shaderStage){const s=this.getDataFromNode(e,i,this.globalCache);let a=s.structType;if(a===void 0){const o=this.structs.index++;r===null&&(r="StructType"+o),a=new qae(r,t),this.structs[i].push(a),s.structType=a}return a}getOutputStructTypeFromNode(e,t){const r=this.getStructTypeFromNode(e,t,"OutputType","fragment");return r.output=!0,r}getUniformFromNode(e,t,r=this.shaderStage,i=null){const s=this.getDataFromNode(e,r,this.globalCache);let a=s.uniform;if(a===void 0){const o=this.uniforms.index++;a=new Gae(i||"nodeUniform"+o,t,e),this.uniforms[r].push(a),this.registerDeclaration(a),s.uniform=a}return a}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,r=e.getNodeType(this),i=this.shaderStage,s=!1){const a=this.getDataFromNode(e,i),o=this.getSubBuildProperty("variable",a.subBuilds);let l=a[o];if(l===void 0){const u=s?"_const":"_var",h=this.vars[i]||(this.vars[i]=[]),p=this.vars[u]||(this.vars[u]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+p,this.vars[u]++),o!=="variable"&&(t=this.getSubBuildProperty(t,a.subBuilds));const m=this.getArrayCount(e);l=new yj(t,r,s,m),s||h.push(l),this.registerDeclaration(l),a[o]=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,r=e.getNodeType(this),i=null,s=null){const a=this.getDataFromNode(e,"any"),o=this.getSubBuildProperty("varying",a.subBuilds);let l=a[o];if(l===void 0){const u=this.varyings,h=u.length;t===null&&(t="nodeVarying"+h),o!=="varying"&&(t=this.getSubBuildProperty(t,a.subBuilds)),l=new Hae(t,r,i,s),u.push(l),this.registerDeclaration(l),a[o]=l}return l}registerDeclaration(e){const t=this.shaderStage,r=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let s=1,a=i;for(;r[a]!==void 0;)a=i+"_"+s++;s>1&&(e.name=a,console.warn(`THREE.TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${a}'.`)),r[a]=e}getCodeFromNode(e,t,r=this.shaderStage){const i=this.getDataFromNode(e);let s=i.code;if(s===void 0){const a=this.codes[r]||(this.codes[r]=[]),o=a.length;s=new $ae("nodeCode"+o,t),a.push(s),i.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:r,flowCodeBlock:i}=this.getDataFromNode(e);let s=!0,a=t;for(;a;){if(i.get(a)===!0){s=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(s)for(const o of r)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,r){const i=this.getDataFromNode(e),s=i.flowCodes||(i.flowCodes=[]),a=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);s.push(t),a.set(r,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),r=this.flowChildNode(e,t);return this.flowsData.set(e,r),r}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new nae,r=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=r,t}flowShaderNode(e){const t=e.layout,r={[Symbol.iterator](){let a=0;const o=Object.values(this);return{next:()=>({value:o[a],done:a++>=o.length})}}};for(const a of t.inputs)r[a.name]=new Ise(a.type,a.name);e.layout=null;const i=e.call(r),s=this.flowStagesNode(i,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const r=this.flow,i=this.vars,s=this.declarations,a=this.cache,o=this.buildStage,l=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new Xb,this.stack=Gb();for(const h of C2)this.setBuildStage(h),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=i,this.declarations=s,this.cache=a,this.stack=l,this.setBuildStage(o),u}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const r=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=r,i}flowNodeFromShaderStage(e,t,r=null,i=null){const s=this.tab,a=this.cache,o=this.shaderStage,l=this.context;this.setShaderStage(e);const u={...this.context};delete u.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=u;let h=null;if(this.buildStage==="generate"){const p=this.flowChildNode(t,r);i!==null&&(p.code+=`${this.tab+i} = ${p.result};
`),this.flowCode[e]=this.flowCode[e]+p.code,h=p}else h=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=s,this.context=l,h}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,r=null){return`${r!==null?this.generateArrayDeclaration(e,r):this.getType(e)} ${t}`}getVars(e){let t="";const r=this.vars[e];if(r!==void 0)for(const i of r)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let r="";if(t!==void 0)for(const i of t)r+=i.code+`
`;return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const r=this.subBuildLayers;for(let i=t.length-1;i>=0;i--){const s=t[i];if(r.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let r;t!==null?r=this.getClosestSubBuild(t):r=this.subBuildFn;let i;return r?i=e?r+"_"+e:r:i=e,i}build(){const{object:e,material:t,renderer:r}=this;if(t!==null){let i=r.library.fromMaterial(t);i===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new lr),i.build(this)}else this.addFlow("compute",e);for(const i of C2){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of A2){this.setShaderStage(s);const a=this.flowNodes[s];for(const o of a)i==="generate"?this.flowNode(o):o.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new noe(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new roe(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new ioe(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new soe(e);if(t==="color")return new aoe(e);if(t==="mat2")return new ooe(e);if(t==="mat3")return new loe(e);if(t==="mat4")return new coe(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,r){if(t=this.getVectorType(t),r=this.getVectorType(r),t===r||r===null||this.isReference(r))return e;const i=this.getTypeLength(t),s=this.getTypeLength(r);return i===16&&s===9?`${this.getType(r)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&s===4?`${this.getType(r)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||s>4||s===0?e:i===s?`${this.getType(r)}( ${e} )`:i>s?(e=r==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),r)):s===4&&i>1?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&s>1&&t!==this.getComponentType(r)&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${eh} - Node System
`}*[Symbol.iterator](){}}class jR{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let r=e.get(t);return r===void 0&&(r={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,r)),r}updateBeforeNode(e){const t=e.getUpdateBeforeType(),r=e.updateReference(this);if(t===Xt.FRAME){const{frameMap:i}=this._getMaps(this.updateBeforeMap,r);i.get(r)!==this.frameId&&e.updateBefore(this)!==!1&&i.set(r,this.frameId)}else if(t===Xt.RENDER){const{renderMap:i}=this._getMaps(this.updateBeforeMap,r);i.get(r)!==this.renderId&&e.updateBefore(this)!==!1&&i.set(r,this.renderId)}else t===Xt.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),r=e.updateReference(this);if(t===Xt.FRAME){const{frameMap:i}=this._getMaps(this.updateAfterMap,r);i.get(r)!==this.frameId&&e.updateAfter(this)!==!1&&i.set(r,this.frameId)}else if(t===Xt.RENDER){const{renderMap:i}=this._getMaps(this.updateAfterMap,r);i.get(r)!==this.renderId&&e.updateAfter(this)!==!1&&i.set(r,this.renderId)}else t===Xt.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),r=e.updateReference(this);if(t===Xt.FRAME){const{frameMap:i}=this._getMaps(this.updateMap,r);i.get(r)!==this.frameId&&e.update(this)!==!1&&i.set(r,this.frameId)}else if(t===Xt.RENDER){const{renderMap:i}=this._getMaps(this.updateMap,r);i.get(r)!==this.renderId&&e.update(this)!==!1&&i.set(r,this.renderId)}else t===Xt.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class UT{constructor(e,t,r=null,i="",s=!1){this.type=e,this.name=t,this.count=r,this.qualifier=i,this.isConst=s}}UT.isNodeFunctionInput=!0;class doe extends Ic{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:fj(this.light),lightColor:e}}}const Yb=new Yt,h0=new Yt;let wf=null;class hoe extends Ic{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=jt(new ee).setGroup(It),this.halfWidth=jt(new ee).setGroup(It),this.updateType=Xt.RENDER}update(e){super.update(e);const{light:t}=this,r=e.camera.matrixWorldInverse;h0.identity(),Yb.copy(t.matrixWorld),Yb.premultiply(r),h0.extractRotation(Yb),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(h0),this.halfHeight.value.applyMatrix4(h0)}setupDirectRectArea(e){let t,r;e.isAvailable("float32Filterable")?(t=ln(wf.LTC_FLOAT_1),r=ln(wf.LTC_FLOAT_2)):(t=ln(wf.LTC_HALF_1),r=ln(wf.LTC_HALF_2));const{colorNode:i,light:s}=this,a=hj(s);return{lightColor:i,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:r}}static setLTC(e){wf=e}}class BT extends Ic{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=jt(0).setGroup(It),this.penumbraCosNode=jt(0).setGroup(It),this.cutoffDistanceNode=jt(0).setGroup(It),this.decayExponentNode=jt(0).setGroup(It),this.colorNode=jt(this.color).setGroup(It)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:r,penumbraCosNode:i}=this;return bl(r,i,t)}getLightCoord(e){const t=e.getNodeProperties(this);let r=t.projectionUV;return r===void 0&&(r=aae(this.light,e.context.positionWorld),t.projectionUV=r),r}setupDirect(e){const{colorNode:t,cutoffDistanceNode:r,decayExponentNode:i,light:s}=this,a=this.getLightVector(e),o=a.normalize(),l=o.dot(fj(s)),u=this.getSpotAttenuation(e,l),h=a.length(),p=xj({lightDistance:h,cutoffDistance:r,decayExponent:i});let m=t.mul(u).mul(p),g,y;return s.colorNode?(y=this.getLightCoord(e),g=s.colorNode(y)):s.map&&(y=this.getLightCoord(e),g=ln(s.map,y.xy).onRenderUpdate(()=>s.map)),g&&(m=y.mul(2).sub(1).abs().lessThan(1).all().select(m.mul(g),m)),{lightColor:m,lightDirection:o}}}class foe extends BT{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const r=this.light.iesMap;let i=null;if(r&&r.isTexture===!0){const s=t.acos().mul(1/Math.PI);i=ln(r,Xe(s,0),0).r}else i=super.getSpotAttenuation(t);return i}}const poe=ke(([n,e])=>{const t=n.abs().sub(e);return ho(Jr(t,0)).add(Gd(Jr(t.x,t.y),0))});class moe extends BT{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let r=1;t.map!==null&&(r=t.map.width/t.map.height),t.shadow.aspect=r}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=this.penumbraCosNode,r=this.getLightCoord(e),i=r.xyz.div(r.w),s=poe(i.xy.sub(Xe(.5)),Xe(.5)),a=_a(-1,ci(1,tI(t)).sub(1));return cI(s.mul(-2).mul(a))}}class goe extends Ic{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class xoe extends Ic{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=dj(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=jt(new vt).setGroup(It)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:r,lightDirectionNode:i}=this,a=ch.dot(i).mul(.5).add(.5),o=Ln(r,t,a);e.context.irradiance.addAssign(o)}}class yoe extends Ic{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let r=0;r<9;r++)t.push(new ee);this.lightProbe=aa(t)}update(e){const{light:t}=this;super.update(e);for(let r=0;r<9;r++)this.lightProbe.array[r].copy(t.sh.coefficients[r]).multiplyScalar(t.intensity)}setup(e){const t=Uae(ch,this.lightProbe);e.context.irradiance.addAssign(t)}}class _j{parseFunction(){console.warn("Abstract function.")}}class zT{constructor(e,t,r="",i=""){this.type=e,this.inputs=t,this.name=r,this.precision=i}getCode(){console.warn("Abstract function.")}}zT.isNodeFunction=!0;const voe=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,_oe=/[a-z_0-9]+/ig,FR="#pragma main",boe=n=>{n=n.trim();const e=n.indexOf(FR),t=e!==-1?n.slice(e+FR.length):n,r=t.match(voe);if(r!==null&&r.length===5){const i=r[4],s=[];let a=null;for(;(a=_oe.exec(i))!==null;)s.push(a);const o=[];let l=0;for(;l<s.length;){const y=s[l][0]==="const";y===!0&&l++;let b=s[l][0];b==="in"||b==="out"||b==="inout"?l++:b="";const _=s[l++][0];let x=Number.parseInt(s[l][0]);Number.isNaN(x)===!1?l++:x=null;const N=s[l++][0];o.push(new UT(_,N,x,b,y))}const u=t.substring(r[0].length),h=r[3]!==void 0?r[3]:"",p=r[2],m=r[1]!==void 0?r[1]:"",g=e!==-1?n.slice(0,e):"";return{type:p,inputs:o,name:h,precision:m,inputsCode:i,blockCode:u,headerCode:g}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class woe extends zT{constructor(e){const{type:t,inputs:r,name:i,precision:s,inputsCode:a,blockCode:o,headerCode:l}=boe(e);super(t,r,i,s),this.inputsCode=a,this.blockCode=o,this.headerCode=l}getCode(e=this.name){let t;const r=this.blockCode;if(r!==""){const{type:i,inputsCode:s,headerCode:a,precision:o}=this;let l=`${i} ${e} ( ${s.trim()} )`;o!==""&&(l=`${o} ${l}`),t=a+l+r}else t="";return t}}class Soe extends _j{parseFunction(e){return new woe(e)}}const OR=new WeakMap,na=[],Kl=[];class Toe extends El{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new jR,this.nodeBuilderCache=new Map,this.callHashCache=new $s,this.groupsData=new $s,this.cacheLib={}}updateGroup(e){const t=e.groupNode,r=t.name;if(r===ZD.name)return!0;if(r===It.name){const s=this.get(e),a=this.nodeFrame.renderId;return s.renderId!==a?(s.renderId=a,!0):!1}if(r===dee.name){const s=this.get(e),a=this.nodeFrame.frameId;return s.frameId!==a?(s.frameId=a,!0):!1}na[0]=t,na[1]=e;let i=this.groupsData.get(na);return i===void 0&&this.groupsData.set(na,i={}),na.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const{nodeBuilderCache:i}=this,s=this.getForRenderCacheKey(e);if(r=i.get(s),r===void 0){const a=this.backend.createNodeBuilder(e.object,this.renderer);a.scene=e.scene,a.material=e.material,a.camera=e.camera,a.context.material=e.material,a.lightsNode=e.lightsNode,a.environmentNode=this.getEnvironmentNode(e.scene),a.fogNode=this.getFogNode(e.scene),a.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&a.enableMultiview(),a.build(),r=this._createNodeBuilderState(a),i.set(s,r)}r.usedTimes++,t.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),r=this._createNodeBuilderState(i),t.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new Vae(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const r=this.get(e);r.environmentNode&&(t=r.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const r=this.get(e);r.backgroundNode&&(t=r.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){na[0]=e,na[1]=t;const r=this.renderer.info.calls,i=this.callHashCache.get(na)||{};if(i.callId!==r){const s=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&Kl.push(t.getCacheKey(!0)),s&&Kl.push(s.getCacheKey()),a&&Kl.push(a.getCacheKey()),Kl.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Kl.push(this.renderer.shadowMap.enabled?1:0),i.callId=r,i.cacheKey=dT(Kl),this.callHashCache.set(na,i),Kl.length=0}return na.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),r=e.background;if(r){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==r||i){const s=this.getCacheNode("background",r,()=>{if(r.isCubeTexture===!0||r.mapping===bd||r.mapping===wd||r.mapping===Tc){if(e.backgroundBlurriness>0||r.mapping===Tc)return nj(r);{let a;return r.isCubeTexture===!0?a=kp(r):a=ln(r),WI(a)}}else{if(r.isTexture===!0)return ln(r,pd.flipY()).setUpdateMatrix(!0);r.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",r)}},i);t.backgroundNode=s,t.background=r,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,r,i=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=s.get(t);return(a===void 0||i)&&(a=r(),s.set(t,a)),a}updateFog(e){const t=this.get(e),r=e.fog;if(r){if(t.fog!==r){const i=this.getCacheNode("fog",r,()=>{if(r.isFogExp2){const s=Nn("color","color",r).setGroup(It),a=Nn("density","float",r).setGroup(It);return RR(s,iae(a))}else if(r.isFog){const s=Nn("color","color",r).setGroup(It),a=Nn("near","float",r).setGroup(It),o=Nn("far","float",r).setGroup(It);return RR(s,rae(a,o))}else console.error("THREE.Renderer: Unsupported fog configuration.",r)});t.fogNode=i,t.fog=r}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),r=e.environment;if(r){if(t.environment!==r){const i=this.getCacheNode("environment",r,()=>{if(r.isCubeTexture===!0)return kp(r);if(r.isTexture===!0)return ln(r);console.error("Nodes: Unsupported environment configuration.",r)});t.environmentNode=i,t.environment=r}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,r=null,i=null,s=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=r,a.camera=i,a.material=s,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return OR.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,r=this.getOutputCacheKey(),i=e.isArrayTexture?Hse(e,Ae(pd,ly("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):ln(e,pd).renderOutput(t.toneMapping,t.currentColorSpace);return OR.set(e,r),i}updateBefore(e){const t=e.getNodeBuilderState();for(const r of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(r)}updateAfter(e){const t=e.getNodeBuilderState();for(const r of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(r)}updateForCompute(e){const t=this.getNodeFrame(),r=this.getForCompute(e);for(const i of r.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const i of r.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new jR,this.nodeBuilderCache=new Map,this.cacheLib={}}}const Kb=new js;class bx{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Ut,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,r){const i=e.length;for(let s=0;s<i;s++){Kb.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=t[r+s],o=Kb.normal;a.x=-o.x,a.y=-o.y,a.z=-o.z,a.w=Kb.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let r=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,s=i.length;let a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+s){a.length=o+s;for(let l=0;l<s;l++)a[o+l]=new Lt;r=!0}this.projectPlanes(i,a,o),r&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new bx(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class Noe{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Sf=[];class Eoe{constructor(){this.bundles=new $s}get(e,t){const r=this.bundles;Sf[0]=e,Sf[1]=t;let i=r.get(Sf);return i===void 0&&(i=new Noe(e,t),r.set(Sf,i)),Sf.length=0,i}dispose(){this.bundles=new $s}}class bj{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const r=this.getMaterialNodeClass(e.type);if(r!==null){t=new r;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,r){if(r.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);r.set(t,e)}addClass(e,t,r){if(r.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);r.set(t,e)}}const Moe=new pj,Tf=[];class Coe extends $s{constructor(){super()}createNode(e=[]){return new pj().setLights(e)}getNode(e,t){if(e.isQuadMesh)return Moe;Tf[0]=e,Tf[1]=t;let r=this.get(Tf);return r===void 0&&(r=this.createNode(),this.set(Tf,r)),Tf.length=0,r}}class If extends Pc{constructor(e=1,t=1,r={}){super(e,t,r),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const UR=new ee,BR=new ee;class Aoe extends _o{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Mr,this._cameraL.viewport=new Lt,this._cameraR=new Mr,this._cameraR.viewport=new Lt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new Z3,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._frameBufferTargets=null,this._createXRLayer=Ioe.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new je,this._onSessionEvent=koe.bind(this),this._onSessionEnd=Loe.bind(this),this._onInputSourcesChange=Doe.bind(this),this._onAnimationFrame=joe.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers=typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,r,i,s,a,o,l={}){const u=new em(e,t),h=new If(s,a,{format:qn,type:Hn,depthTexture:new xs(s,a,l.stencil?Ki:En,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?Qi:Zi),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});h._autoAllocateDepthBuffer=!0;const p=new Us({color:16777215,side:Ai});p.map=h.texture,p.map.offset.y=1,p.map.repeat.y=-1;const m=new Xn(u,p);m.position.copy(r),m.quaternion.copy(i);const g={type:"quad",width:e,height:t,translation:r,quaternion:i,pixelwidth:s,pixelheight:a,plane:m,material:p,rendercall:o,renderTarget:h};if(this._layers.push(g),this._session!==null){g.plane.material=new Us({color:16777215,side:Ai}),g.plane.material.blending=ad,g.plane.material.blendEquation=Kr,g.plane.material.blendSrc=Wa,g.plane.material.blendDst=Wa,g.xrlayer=this._createXRLayer(g);const y=this._session.renderState.layers;y.unshift(g.xrlayer),this._session.updateRenderState({layers:y})}else h.isXRRenderTarget=!1;return m}createCylinderLayer(e,t,r,i,s,a,o,l,u={}){const h=new Jp(e,e,e*t/r,64,64,!0,Math.PI-t/2,t),p=new If(a,o,{format:qn,type:Hn,depthTexture:new xs(a,o,u.stencil?Ki:En,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?Qi:Zi),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const m=new Us({color:16777215,side:bn});m.map=p.texture,m.map.offset.y=1,m.map.repeat.y=-1;const g=new Xn(h,m);g.position.copy(i),g.quaternion.copy(s);const y={type:"cylinder",radius:e,centralAngle:t,aspectratio:r,translation:i,quaternion:s,pixelwidth:a,pixelheight:o,plane:g,material:m,rendercall:l,renderTarget:p};if(this._layers.push(y),this._session!==null){y.plane.material=new Us({color:16777215,side:bn}),y.plane.material.blending=ad,y.plane.material.blendEquation=Kr,y.plane.material.blendSrc=Wa,y.plane.material.blendDst=Wa,y.xrlayer=this._createXRLayer(y);const b=this._session.renderState.layers;b.unshift(y.xrlayer),this._session.updateRenderState({layers:b})}else p.isXRRenderTarget=!1;return g}renderLayers(){const e=new ee,t=new Hs,r=this._renderer,i=this.isPresenting,s=r.getOutputRenderTarget(),a=r._frameBufferTarget;this.isPresenting=!1;const o=new je;r.getSize(o);const l=r._quad;for(const u of this._layers)if(u.renderTarget.isXRRenderTarget=this._session!==null,u.renderTarget._hasExternalTextures=u.renderTarget.isXRRenderTarget,u.renderTarget.isXRRenderTarget&&this._supportsLayers){u.xrlayer.transform=new XRRigidTransform(u.plane.getWorldPosition(e),u.plane.getWorldQuaternion(t));const h=this._glBinding.getSubImage(u.xrlayer,this._xrFrame);r.backend.setXRRenderTargetTextures(u.renderTarget,h.colorTexture,void 0),r._setXRLayerSize(u.renderTarget.width,u.renderTarget.height),r.setOutputRenderTarget(u.renderTarget),r.setRenderTarget(null),r._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:p,quad:m}=this._frameBufferTargets.get(u.renderTarget)||{frameBufferTarget:null,quad:null};p?(r._frameBufferTarget=p,r._quad=m):(r._quad=new OT(new lr),this._frameBufferTargets.set(u.renderTarget,{frameBufferTarget:r._getFrameBufferTarget(),quad:r._quad})),u.rendercall(),r._frameBufferTarget=null}else r.setRenderTarget(u.renderTarget),u.rendercall();r.setRenderTarget(null),r.setOutputRenderTarget(s),r._frameBufferTarget=a,r._setXRLayerSize(o.x,o.y),r._quad=l,this.isPresenting=i}getSession(){return this._session}async setSession(e){const t=this._renderer,r=t.backend;this._gl=t.getContext();const i=this._gl,s=i.getContextAttributes();if(this._session=e,e!==null){if(r.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await r.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._useLayers===!0){let a=null,o=null,l=null;t.depth&&(l=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,a=t.stencil?Qi:Zi,o=t.stencil?Ki:En);const u={colorFormat:i.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(u.textureType="texture-array",this._useMultiview=!0);const h=new XRWebGLBinding(e,i),p=h.createProjectionLayer(u),m=[p];this._glBinding=h,this._glProjLayer=p,t.setPixelRatio(1),t._setXRLayerSize(p.textureWidth,p.textureHeight);const g=this._useMultiview?2:1,y=new xs(p.textureWidth,p.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,a,g);if(this._xrRenderTarget=new If(p.textureWidth,p.textureHeight,{format:qn,type:Hn,colorSpace:t.outputColorSpace,depthTexture:y,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._supportsLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers)for(const b of this._layers)b.plane.material=new Us({color:16777215,side:b.type==="cylinder"?bn:Ai}),b.plane.material.blending=ad,b.plane.material.blendEquation=Kr,b.plane.material.blendSrc=Wa,b.plane.material.blendDst=Wa,b.xrlayer=this._createXRLayer(b),m.unshift(b.xrlayer);e.updateRenderState({layers:m})}else{const a={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},o=new XRWebGLLayer(e,i,a);this._glBaseLayer=o,e.updateRenderState({baseLayer:o}),t.setPixelRatio(1),t._setXRLayerSize(o.framebufferWidth,o.framebufferHeight),this._xrRenderTarget=new If(o.framebufferWidth,o.framebufferHeight,{format:qn,type:Hn,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:o.ignoreDepthValues===!1,resolveStencilBuffer:o.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const r=e.near,i=e.far,s=this._cameraXR,a=this._cameraL,o=this._cameraR;s.near=o.near=a.near=r,s.far=o.far=a.far=i,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),a.layers.mask=e.layers.mask|2,o.layers.mask=e.layers.mask|4,s.layers.mask=a.layers.mask|o.layers.mask;const l=e.parent,u=s.cameras;zR(s,l);for(let h=0;h<u.length;h++)zR(u[h],l);u.length===2?Roe(s,a,o):s.projectionMatrix.copy(a.projectionMatrix),Poe(e,s,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new I0,this._controllers[e]=t),t}}function Roe(n,e,t){UR.setFromMatrixPosition(e.matrixWorld),BR.setFromMatrixPosition(t.matrixWorld);const r=UR.distanceTo(BR),i=e.projectionMatrix.elements,s=t.projectionMatrix.elements,a=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],h=(i[8]-1)/i[0],p=(s[8]+1)/s[0],m=a*h,g=a*p,y=r/(-h+p),b=y*-h;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(b),n.translateZ(y),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),i[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const _=a+y,x=o+y,N=m-b,T=g+(r-b),S=l*o/x*_,M=u*o/x*_;n.projectionMatrix.makePerspective(N,T,S,M,_,x),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function zR(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function Poe(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=Mc*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function koe(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const r=this.getReferenceSpace();t.update(n.inputSource,n.frame,r),t.dispatchEvent({type:n.type,data:n.inputSource})}}function Loe(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const r=this._controllerInputSources[t];r!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(r))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._supportsLayers===!0)for(const t of this._layers)t.renderTarget=new If(t.pixelwidth,t.pixelheight,{format:qn,type:Hn,depthTexture:new xs(t.pixelwidth,t.pixelheight,t.stencilBuffer?Ki:En,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?Qi:Zi),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function Doe(n){const e=this._controllers,t=this._controllerInputSources;for(let r=0;r<n.removed.length;r++){const i=n.removed[r],s=t.indexOf(i);s>=0&&(t[s]=null,e[s].disconnect(i))}for(let r=0;r<n.added.length;r++){const i=n.added[r];let s=t.indexOf(i);if(s===-1){for(let o=0;o<e.length;o++)if(o>=t.length){t.push(i),s=o;break}else if(t[o]===null){t[o]=i,s=o;break}if(s===-1)break}const a=e[s];a&&a.connect(i)}}function Ioe(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function joe(n,e){if(e===void 0)return;const t=this._cameraXR,r=this._renderer,i=r.backend,s=this._glBaseLayer,a=this.getReferenceSpace(),o=e.getViewerPose(a);if(this._xrFrame=e,o!==null){const l=o.views;this._glBaseLayer!==null&&i.setXRTarget(s.framebuffer);let u=!1;l.length!==t.cameras.length&&(t.cameras.length=0,u=!0);for(let h=0;h<l.length;h++){const p=l[h];let m;if(this._useLayers===!0){const y=this._glBinding.getViewSubImage(this._glProjLayer,p);m=y.viewport,h===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,y.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:y.depthStencilTexture)}else m=s.getViewport(p);let g=this._cameras[h];g===void 0&&(g=new Mr,g.layers.enable(h),g.viewport=new Lt,this._cameras[h]=g),g.matrix.fromArray(p.transform.matrix),g.matrix.decompose(g.position,g.quaternion,g.scale),g.projectionMatrix.fromArray(p.projectionMatrix),g.projectionMatrixInverse.copy(g.projectionMatrix).invert(),g.viewport.set(m.x,m.y,m.width,m.height),h===0&&(t.matrix.copy(g.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),u===!0&&t.cameras.push(g)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const u=this._controllerInputSources[l],h=this._controllers[l];u!==null&&h!==void 0&&h.update(u,e,a)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const VR=new Kx,f0=new je,Zb=new Lt,Qb=new Qp,Jb=new Z1,p0=new Yt,Jo=new Lt;class Foe{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:i=!0,depth:s=!0,stencil:a=!1,antialias:o=!1,samples:l=0,getFallback:u=null,colorBufferType:h=Cr,multiview:p=!1}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=l||o===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=r,this.outputColorSpace=li,this.toneMapping=Pi,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=a,this.info=new vse,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new bj,this.lighting=new Coe,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Lt(0,0,this._width,this._height),this._scissor=new Lt(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new OT(new lr),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const m=this.alpha===!0?0:1;this._clearColor=new FT(0,0,0,m),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=h,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:_1},this.xr=new Aoe(this,p),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(g,y,b)=>{await this.compileAsync(g,y);const _=this._renderLists.get(g,y),x=this._renderContexts.get(g,y,this._renderTarget),N=g.overrideMaterial||b.material,T=this._objects.get(b,N,g,y,_.lightsNode,x,x.clippingContext),{fragmentShader:S,vertexShader:M}=T.getNodeBuilderState();return{fragmentShader:S,vertexShader:M}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let r=this.backend;try{await r.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=r=this._getFallback(i),await r.init(this)}catch(s){t(s);return}else{t(i);return}}this._nodes=new Toe(this,r),this._animation=new use(this._nodes,this.info),this._attributes=new xse(r),this._background=new Bae(this,this._nodes),this._geometries=new yse(this._attributes,this.info),this._textures=new Dse(this,r,this.info),this._pipelines=new Sse(r,this._nodes),this._bindings=new Tse(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new pse(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Mse(this.lighting),this._bundles=new Eoe,this._renderContexts=new kse,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,r=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,s=i.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,l=this._compilationPromises,u=e.isScene===!0?e:VR;r===null&&(r=e);const h=this._renderTarget,p=this._renderContexts.get(r,t,h),m=this._activeMipmapLevel,g=[];this._currentRenderContext=p,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=g,i.renderId++,i.update(),p.depth=this.depth,p.stencil=this.stencil,p.clippingContext||(p.clippingContext=new bx),p.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,h);const y=this._renderLists.get(e,t);if(y.begin(),this._projectObject(e,t,0,y,p.clippingContext),r!==e&&r.traverseVisible(function(T){T.isLight&&T.layers.test(t.layers)&&y.pushLight(T)}),y.finish(),h!==null){this._textures.updateRenderTarget(h,m);const T=this._textures.get(h);p.textures=T.textures,p.depthTexture=T.depthTexture}else p.textures=null,p.depthTexture=null;this._background.update(u,y,p);const b=y.opaque,_=y.transparent,x=y.transparentDoublePass,N=y.lightsNode;this.opaque===!0&&b.length>0&&this._renderObjects(b,t,u,N),this.transparent===!0&&_.length>0&&this._renderTransparents(_,x,t,u,N),i.renderId=s,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(g)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=V2,this.overrideNodes.modelNormalViewMatrix=G2):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===V2&&this.overrideNodes.modelNormalViewMatrix===G2}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,r){const{bundleGroup:i,camera:s,renderList:a}=e,o=this._currentRenderContext,l=this._bundles.get(i,s),u=this.backend.get(l);u.renderContexts===void 0&&(u.renderContexts=new Set);const h=i.version!==u.version,p=u.renderContexts.has(o)===!1||h;if(u.renderContexts.add(o),p){this.backend.beginBundle(o),(u.renderObjects===void 0||h)&&(u.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:m,transparent:g,opaque:y}=a;this.opaque===!0&&y.length>0&&this._renderObjects(y,s,t,r),this.transparent===!0&&g.length>0&&this._renderTransparents(g,m,s,t,r),this._currentRenderBundle=null,this.backend.finishBundle(o,l),u.version=i.version}else{const{renderObjects:m}=u;for(let g=0,y=m.length;g<y;g++){const b=m[g];this._nodes.needsRefresh(b)&&(this._nodes.updateBefore(b),this._nodes.updateForRender(b),this._bindings.updateForRender(b),this._nodes.updateAfter(b))}}this.backend.addBundle(o,l)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==Pi===!1&&t!==pa===!1)return null;const{width:s,height:a}=this.getDrawingBufferSize(f0),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;u===null&&(u=new Pc(s,a,{depthBuffer:o,stencilBuffer:l,type:this._colorBufferType,format:qn,colorSpace:pa,generateMipmaps:!1,minFilter:pr,magFilter:pr,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u);const h=this.getOutputRenderTarget();return u.depthBuffer=o,u.stencilBuffer=l,h!==null?u.setSize(h.width,h.height,h.depth):u.setSize(s,a,1),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u.multiview=h!==null?h.multiview:!1,u.resolveDepthBuffer=h!==null?h.resolveDepthBuffer:!0,u._autoAllocateDepthBuffer=h!==null?h._autoAllocateDepthBuffer:!1,u}_renderScene(e,t,r=!0){if(this._isDeviceLost===!0)return;const i=r?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,a=s.renderId,o=this._currentRenderContext,l=this._currentRenderObjectFunction,u=e.isScene===!0?e:VR,h=this._renderTarget||this._outputRenderTarget,p=this._activeCubeFace,m=this._activeMipmapLevel;let g;i!==null?(g=i,this.setRenderTarget(g)):g=h;const y=this._renderContexts.get(e,t,g);this._currentRenderContext=y,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const b=this.coordinateSystem,_=this.xr;if(t.coordinateSystem!==b&&_.isPresenting===!1&&(t.coordinateSystem=b,t.updateProjectionMatrix(),t.isArrayCamera))for(const $ of t.cameras)$.coordinateSystem=b,$.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),_.enabled===!0&&_.isPresenting===!0&&(_.cameraAutoUpdate===!0&&_.updateCamera(t),t=_.getCamera());let x=this._viewport,N=this._scissor,T=this._pixelRatio;g!==null&&(x=g.viewport,N=g.scissor,T=1),this.getDrawingBufferSize(f0),Zb.set(0,0,f0.width,f0.height);const S=x.minDepth===void 0?0:x.minDepth,M=x.maxDepth===void 0?1:x.maxDepth;y.viewportValue.copy(x).multiplyScalar(T).floor(),y.viewportValue.width>>=m,y.viewportValue.height>>=m,y.viewportValue.minDepth=S,y.viewportValue.maxDepth=M,y.viewport=y.viewportValue.equals(Zb)===!1,y.scissorValue.copy(N).multiplyScalar(T).floor(),y.scissor=this._scissorTest&&y.scissorValue.equals(Zb)===!1,y.scissorValue.width>>=m,y.scissorValue.height>>=m,y.clippingContext||(y.clippingContext=new bx),y.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,g);const C=t.isArrayCamera?Jb:Qb;t.isArrayCamera||(p0.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),C.setFromProjectionMatrix(p0,b));const R=this._renderLists.get(e,t);if(R.begin(),this._projectObject(e,t,0,R,y.clippingContext),R.finish(),this.sortObjects===!0&&R.sort(this._opaqueSort,this._transparentSort),g!==null){this._textures.updateRenderTarget(g,m);const $=this._textures.get(g);y.textures=$.textures,y.depthTexture=$.depthTexture,y.width=$.width,y.height=$.height,y.renderTarget=g,y.depth=g.depthBuffer,y.stencil=g.stencilBuffer}else y.textures=null,y.depthTexture=null,y.width=this.domElement.width,y.height=this.domElement.height,y.depth=this.depth,y.stencil=this.stencil;y.width>>=m,y.height>>=m,y.activeCubeFace=p,y.activeMipmapLevel=m,y.occlusionQueryCount=R.occlusionQueryCount,this._background.update(u,R,y),y.camera=t,this.backend.beginRender(y);const{bundles:F,lightsNode:k,transparentDoublePass:D,transparent:P,opaque:G}=R;return F.length>0&&this._renderBundles(F,u,k),this.opaque===!0&&G.length>0&&this._renderObjects(G,t,u,k),this.transparent===!0&&P.length>0&&this._renderTransparents(P,D,t,u,k),this.backend.finishRender(y),s.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=l,i!==null&&(this.setRenderTarget(h,p,m),this._renderOutput(g)),u.onAfterRender(this,e,t,g),y}_setXRLayerSize(e,t){this._width=e,this._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const r=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=r,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(t*r),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),r===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,r,i){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,r,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,r,i,s=0,a=1){const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,r,i),o.minDepth=s,o.maxDepth=a}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,r=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,r);const i=this._renderTarget||this._getFrameBufferTarget();let s=null;if(i!==null){this._textures.updateRenderTarget(i);const a=this._textures.get(i);s=this._renderContexts.getForClear(i),s.textures=a.textures,s.depthTexture=a.depthTexture,s.width=a.width,s.height=a.height,s.renderTarget=i,s.depth=i.depthBuffer,s.stencil=i.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,r,s),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,r=!0){this._initialized===!1&&await this.init(),this.clear(e,t,r)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Pi}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:pa}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,r=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,r=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const i=this.backend,s=this._pipelines,a=this._bindings,o=this._nodes,l=Array.isArray(e)?e:[e];if(l[0]===void 0||l[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const u of l){if(s.has(u)===!1){const m=()=>{u.removeEventListener("dispose",m),s.delete(u),a.delete(u),o.delete(u)};u.addEventListener("dispose",m);const g=u.onInitFunction;g!==null&&g.call(u,{renderer:this})}o.updateForCompute(u),a.updateForCompute(u);const h=a.getForCompute(u),p=s.getForCompute(u,h);i.compute(e,u,h,p)}i.finishCompute(e),t.renderId=r}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Jo.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Jo.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Jo.set(0,0,e.image.width,e.image.height);let r=this._currentRenderContext,i;r!==null?i=r.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),r=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,r,t)}copyTextureToTexture(e,t,r=null,i=null,s=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,r,i,s,a)}async readRenderTargetPixelsAsync(e,t,r,i,s,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],t,r,i,s,o)}_projectObject(e,t,r,i,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)r=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){const l=t.isArrayCamera?Jb:Qb;if(!e.frustumCulled||l.intersectsSprite(e,t)){this.sortObjects===!0&&Jo.setFromMatrixPosition(e.matrixWorld).applyMatrix4(p0);const{geometry:u,material:h}=e;h.visible&&i.push(e,u,h,r,Jo.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const l=t.isArrayCamera?Jb:Qb;if(!e.frustumCulled||l.intersectsObject(e,t)){const{geometry:u,material:h}=e;if(this.sortObjects===!0&&(u.boundingSphere===null&&u.computeBoundingSphere(),Jo.copy(u.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(p0)),Array.isArray(h)){const p=u.groups;for(let m=0,g=p.length;m<g;m++){const y=p[m],b=h[y.materialIndex];b&&b.visible&&i.push(e,u,b,r,Jo.z,y,s)}}else h.visible&&i.push(e,u,h,r,Jo.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=i;i=this._renderLists.get(e,t),i.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],t,r,i,s)}_renderBundles(e,t,r){for(const i of e)this._renderBundle(i,t,r)}_renderTransparents(e,t,r,i,s){if(t.length>0){for(const{material:a}of t)a.side=bn;this._renderObjects(t,r,i,s,"backSide");for(const{material:a}of t)a.side=Ai;this._renderObjects(e,r,i,s);for(const{material:a}of t)a.side=Yr}else this._renderObjects(e,r,i,s)}_renderObjects(e,t,r,i,s=null){for(let a=0,o=e.length;a<o;a++){const{object:l,geometry:u,material:h,group:p,clippingContext:m}=e[a];this._currentRenderObjectFunction(l,r,t,u,h,p,i,m,s)}}renderObject(e,t,r,i,s,a,o,l=null,u=null){let h,p,m;if(e.onBeforeRender(this,t,r,i,s,a),s.allowOverride===!0&&t.overrideMaterial!==null){const g=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(h=g.positionNode,g.positionNode=s.positionNode),g.alphaTest=s.alphaTest,g.alphaMap=s.alphaMap,g.transparent=s.transparent||s.transmission>0,g.isShadowPassMaterial&&(g.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(m=g.depthNode,g.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(p=g.colorNode,g.colorNode=s.castShadowNode),s.castShadowPositionNode&&s.castShadowPositionNode.isNode&&(h=g.positionNode,g.positionNode=s.castShadowPositionNode)),s=g}s.transparent===!0&&s.side===Yr&&s.forceSinglePass===!1?(s.side=bn,this._handleObjectFunction(e,s,t,r,o,a,l,"backSide"),s.side=Ai,this._handleObjectFunction(e,s,t,r,o,a,l,u),s.side=Yr):this._handleObjectFunction(e,s,t,r,o,a,l,u),h!==void 0&&(t.overrideMaterial.positionNode=h),m!==void 0&&(t.overrideMaterial.depthNode=m),p!==void 0&&(t.overrideMaterial.colorNode=p),e.onAfterRender(this,t,r,i,s,a)}_renderObjectDirect(e,t,r,i,s,a,o,l){const u=this._objects.get(e,t,r,i,s,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a;const h=this._nodes.needsRefresh(u);h&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),h&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,r,i,s,a,o,l){const u=this._objects.get(e,t,r,i,s,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=a,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class VT{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function Ooe(n){return n+(ll-n%ll)%ll}class wj extends VT{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return Ooe(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class Sj extends wj{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let Uoe=0;class Tj extends Sj{constructor(e,t){super("UniformBuffer_"+Uoe++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Boe extends Sj{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let r=0,i=this.uniforms.length;r<i;r++){const s=this.uniforms[r],a=s.boundary,o=s.itemSize*e,l=t%ll,u=l%a,h=l+u;t+=u,h!==0&&ll-h<o&&(t+=ll-h),s.offset=t/e,t+=o}return Math.ceil(t/ll)*ll}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(r[s]!==i){const o=this._getBufferForType(a);o[s]=r[s]=i,t=!0}return t}updateVector2(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y){const o=this._getBufferForType(a);o[s+0]=r[s+0]=i.x,o[s+1]=r[s+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z){const o=this._getBufferForType(a);o[s+0]=r[s+0]=i.x,o[s+1]=r[s+1]=i.y,o[s+2]=r[s+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z||r[s+4]!==i.w){const o=this._getBufferForType(a);o[s+0]=r[s+0]=i.x,o[s+1]=r[s+1]=i.y,o[s+2]=r[s+2]=i.z,o[s+3]=r[s+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset;if(r[s+0]!==i.r||r[s+1]!==i.g||r[s+2]!==i.b){const a=this.buffer;a[s+0]=r[s+0]=i.r,a[s+1]=r[s+1]=i.g,a[s+2]=r[s+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;if(r[s+0]!==i[0]||r[s+1]!==i[1]||r[s+2]!==i[2]||r[s+4]!==i[3]||r[s+5]!==i[4]||r[s+6]!==i[5]||r[s+8]!==i[6]||r[s+9]!==i[7]||r[s+10]!==i[8]){const a=this.buffer;a[s+0]=r[s+0]=i[0],a[s+1]=r[s+1]=i[1],a[s+2]=r[s+2]=i[2],a[s+4]=r[s+4]=i[3],a[s+5]=r[s+5]=i[4],a[s+6]=r[s+6]=i[5],a[s+8]=r[s+8]=i[6],a[s+9]=r[s+9]=i[7],a[s+10]=r[s+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;return Voe(r,i,s)===!1&&(this.buffer.set(i,s),zoe(r,i,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function zoe(n,e,t){for(let r=0,i=e.length;r<i;r++)n[t+r]=e[r]}function Voe(n,e,t){for(let r=0,i=e.length;r<i;r++)if(n[t+r]!==e[r])return!1;return!0}let Goe=0;class Nj extends Boe{constructor(e,t){super(e),this.id=Goe++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let Hoe=0;class $oe extends VT{constructor(e,t){super(e),this.id=Hoe++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class gy extends $oe{constructor(e,t,r,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r,this.access=i}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Ej extends gy{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledCubeTexture=!0}}class Mj extends gy{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledTexture3D=!0}}const Woe={textureDimensions:"textureSize",equals:"equal"},qoe={low:"lowp",medium:"mediump",high:"highp"},GR={swizzleAssign:!0,storageBuffer:!1},HR={perspective:"smooth",linear:"noperspective"},$R={centroid:"centroid"},WR=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class Xoe extends vj{constructor(e,t){super(e,t,new Soe),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==ui}getMethod(e){return Woe[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const a of t.inputs)i.push(this.getType(a.type)+" "+a.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${r.vars}

${r.code}
	return ${r.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const r=t.array,i=t.count*t.itemSize,{itemSize:s}=t,a=t.array.constructor.name.toLowerCase().includes("int");let o=a?th:Yp;s===2?o=a?nh:no:s===3?o=a?N$:Xp:s===4&&(o=a?rh:qn);const l={Float32Array:Zn,Uint8Array:Hn,Uint16Array:zs,Uint32Array:En,Int8Array:xc,Int16Array:yc,Int32Array:Er,Uint8ClampedArray:Hn},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/s))));let h=Math.ceil(i/s/u);u*h*s<i&&h++;const p=u*h*s,m=new r.constructor(p);m.set(r,0),t.array=m;const g=new A9(t.array,u,h,o,l[t.array.constructor.name]||Zn);g.needsUpdate=!0,g.isPBOTexture=!0;const y=new lh(g,null,null);y.setPrecision("high"),t.pboNode=y,t.pbo=y.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:r}=e,i=t.value;if(this.renderer.backend.has(i)){const h=this.renderer.backend.get(i);h.pbo=i.pbo}const s=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label),a=this.getPropertyName(s);this.increaseUsage(r);const o=r.build(this,"uint"),l=this.getDataFromNode(e);let u=l.propertyName;if(u===void 0){const h=this.getVarFromNode(e);u=this.getPropertyName(h);const p=this.getDataFromNode(t);let m=p.propertySizeName;m===void 0&&(m=u+"Size",this.getVarFromNode(t,m,"uint"),this.addLineFlowCode(`${m} = uint( textureSize( ${a}, 0 ).x )`,e),p.propertySizeName=m);const{itemSize:g}=i,y="."+oh.join("").slice(0,g),b=`ivec2(${o} % ${m}, ${o} / ${m})`,_=this.generateTextureLoad(null,a,b,null,"0");let x="vec4";i.pbo.type===En?x="uvec4":i.pbo.type===Er&&(x="ivec4"),this.addLineFlowCode(`${u} = ${x}(${_})${y}`,e),l.propertyName=u}return u}generateTextureLoad(e,t,r,i,s="0"){return i?`texelFetch( ${t}, ivec3( ${r}, ${i} ), ${s} )`:`texelFetch( ${t}, ${r}, ${s} )`}generateTexture(e,t,r,i){return e.isDepthTexture?(i&&(r=`vec4( ${r}, ${i} )`),`texture( ${t}, ${r} ).x`):(i&&(r=`vec3( ${r}, ${i} )`),`texture( ${t}, ${r} )`)}generateTextureLevel(e,t,r,i){return`textureLod( ${t}, ${r}, ${i} )`}generateTextureBias(e,t,r,i){return`texture( ${t}, ${r}, ${i} )`}generateTextureGrad(e,t,r,i){return`textureGrad( ${t}, ${r}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,r,i,s,a=this.shaderStage){if(a==="fragment")return s?`texture( ${t}, vec4( ${r}, ${s}, ${i} ) )`:`texture( ${t}, vec3( ${r}, ${i} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],r=[],i={};for(const a of t){let o=null,l=!1;if(a.type==="texture"||a.type==="texture3D"){const h=a.node.value;let p="";(h.isDataTexture===!0||h.isData3DTexture===!0)&&(h.type===En?p="u":h.type===Er&&(p="i")),a.type==="texture3D"&&h.isArrayTexture===!1?o=`${p}sampler3D ${a.name};`:h.compareFunction?h.isArrayTexture===!0?o=`sampler2DArrayShadow ${a.name};`:o=`sampler2DShadow ${a.name};`:h.isArrayTexture===!0||h.isDataArrayTexture===!0||h.isCompressedArrayTexture===!0?o=`${p}sampler2DArray ${a.name};`:o=`${p}sampler2D ${a.name};`}else if(a.type==="cubeTexture")o=`samplerCube ${a.name};`;else if(a.type==="buffer"){const h=a.node,p=this.getType(h.bufferType),m=h.bufferCount,g=m>0?m:"";o=`${h.name} {
	${p} ${a.name}[${g}];
};
`}else o=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,l=!0;const u=a.node.precision;if(u!==null&&(o=qoe[u]+" "+o),l){o="	"+o;const h=a.groupNode.name;(i[h]||(i[h]=[])).push(o)}else o="uniform "+o,r.push(o)}let s="";for(const a in i){const o=i[a];s+=this._getGLSLUniformStruct(e+"_"+a,o.join(`
`))+`
`}return s+=r.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Er){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const i=r.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const r=this.getAttributesArray();let i=0;for(const s of r)t+=`layout( location = ${i++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const r of e.members)t.push(`	${r.type} ${r.name};`);return t.join(`
`)}getStructs(e){const t=[],r=this.structs[e],i=[];for(const s of r)if(s.output)for(const a of s.members)i.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+s.name+` {
`;a+=this.getStructMembers(s),a+=`
};
`,t.push(a)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const r=this.varyings;if(e==="vertex"||e==="compute")for(const i of r){e==="compute"&&(i.needsInterpolation=!0);const s=this.getType(i.type);if(i.needsInterpolation)if(i.interpolationType){const a=HR[i.interpolationType]||i.interpolationType,o=$R[i.interpolationSampling]||"";t+=`${a} ${o} out ${s} ${i.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}out ${s} ${i.name};
`}else t+=`${s} ${i.name};
`}else if(e==="fragment"){for(const i of r)if(i.needsInterpolation){const s=this.getType(i.type);if(i.interpolationType){const a=HR[i.interpolationType]||i.interpolationType,o=$R[i.interpolationSampling]||"";t+=`${a} ${o} in ${s} ${i.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}in ${s} ${i.name};
`}}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((r,i)=>r*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,r=this.shaderStage){const i=this.extensions[r]||(this.extensions[r]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const r=this.extensions[e];if(r!==void 0)for(const{name:i,behavior:s}of r.values())t.push(`#extension ${i} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=GR[e];if(t===void 0){let r;switch(t=!1,e){case"float32Filterable":r="OES_texture_float_linear";break;case"clipDistance":r="WEBGL_clip_cull_distance";break}if(r!==void 0){const i=this.renderer.backend.extensions;i.has(r)&&(i.get(r),t=!0)}GR[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let r=0;r<e.length;r++){const i=e[r],s=this.getPropertyName(i.attributeNode);s&&(t+=`${i.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${WR}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${WR}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let r=`// code

`;r+=this.flowCode[t];const i=this.flowNodes[t],s=i[i.length-1];for(const o of i){const l=this.getFlowData(o),u=o.name;u&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${u}
	`),r+=`${l.code}
	`,o===s&&t!=="compute"&&(r+=`// result
	`,t==="vertex"?(r+="gl_Position = ",r+=`${l.result};`):t==="fragment"&&(o.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${l.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=r}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),a=this.getDataFromNode(e,r,this.globalCache);let o=a.uniformGPU;if(o===void 0){const l=e.groupNode,u=l.name,h=this.getBindGroupArray(u,r);if(t==="texture")o=new gy(s.name,s.node,l),h.push(o);else if(t==="cubeTexture")o=new Ej(s.name,s.node,l),h.push(o);else if(t==="texture3D")o=new Mj(s.name,s.node,l),h.push(o);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const p=new Tj(e,l);p.name=e.name,h.push(p),o=p}else{const p=this.uniformGroups[r]||(this.uniformGroups[r]={});let m=p[u];m===void 0&&(m=new Nj(r+"_"+u,l),p[u]=m,h.push(m)),o=this.getNodeUniform(s,t),m.addUniform(o)}a.uniformGPU=o}return s}}let ew=null,Uu=null,Cj=class{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){Ji("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){Ji(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const r=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=r,r}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return ew=ew||new je,this.renderer.getDrawingBufferSize(ew)}setScissorTest(){}getClearColor(){const e=this.renderer;return Uu=Uu||new FT,e.getClearColor(Uu),Uu.getRGB(Uu),Uu}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:F3(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${eh} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}},Yoe=0;class Koe{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class Zoe{constructor(e){this.backend=e}createAttribute(e,t){const r=this.backend,{gl:i}=r,s=e.array,a=e.usage||i.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,l=r.get(o);let u=l.bufferGPU;u===void 0&&(u=this._createBuffer(i,t,s,a),l.bufferGPU=u,l.bufferType=t,l.version=o.version);let h;if(s instanceof Float32Array)h=i.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)h=i.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?h=i.HALF_FLOAT:h=i.UNSIGNED_SHORT;else if(s instanceof Int16Array)h=i.SHORT;else if(s instanceof Uint32Array)h=i.UNSIGNED_INT;else if(s instanceof Int32Array)h=i.INT;else if(s instanceof Int8Array)h=i.BYTE;else if(s instanceof Uint8Array)h=i.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)h=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let p={bufferGPU:u,bufferType:t,type:h,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:h===i.INT||h===i.UNSIGNED_INT||e.gpuType===Er,id:Yoe++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const m=this._createBuffer(i,t,s,a);p=new Koe(p,m)}r.set(e,p)}updateAttribute(e){const t=this.backend,{gl:r}=t,i=e.array,s=e.isInterleavedBufferAttribute?e.data:e,a=t.get(s),o=a.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(o,a.bufferGPU),l.length===0)r.bufferSubData(o,0,i);else{for(let u=0,h=l.length;u<h;u++){const p=l[u];r.bufferSubData(o,p.start*i.BYTES_PER_ELEMENT,i,p.start,p.count)}s.clearUpdateRanges()}r.bindBuffer(o,null),a.version=s.version}destroyAttribute(e){const t=this.backend,{gl:r}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);r.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:r}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(i),a=e.array,o=a.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,s);const l=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,l),r.bufferData(r.COPY_WRITE_BUFFER,o,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const u=new e.array.constructor(a.length);return r.bindBuffer(r.COPY_WRITE_BUFFER,l),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,u),r.deleteBuffer(l),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,r,i){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,r,i),e.bindBuffer(t,null),s}}let tw,Nf;class Qoe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;tw={[Kr]:e.FUNC_ADD,[b1]:e.FUNC_SUBTRACT,[w1]:e.FUNC_REVERSE_SUBTRACT},Nf={[Wa]:e.ZERO,[S1]:e.ONE,[T1]:e.SRC_COLOR,[lp]:e.SRC_ALPHA,[R1]:e.SRC_ALPHA_SATURATE,[C1]:e.DST_COLOR,[E1]:e.DST_ALPHA,[N1]:e.ONE_MINUS_SRC_COLOR,[cp]:e.ONE_MINUS_SRC_ALPHA,[A1]:e.ONE_MINUS_DST_COLOR,[M1]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),r=e.getParameter(e.VIEWPORT);this.currentScissor=new Lt().fromArray(t),this.currentViewport=new Lt().fromArray(r),this._tempVec4=new Lt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==T3?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===Jw?t.cullFace(t.BACK):e===N3?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:r}=this;e!==t&&(r.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,r,i,s,a,o,l){const{gl:u}=this;if(e===Ri){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==ad){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==Kr||this.currentBlendEquationAlpha!==Kr)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=Kr,this.currentBlendEquationAlpha=Kr),l)switch(e){case Yi:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case yd:u.blendFunc(u.ONE,u.ONE);break;case vd:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case _d:u.blendFuncSeparate(u.DST_COLOR,u.ONE_MINUS_SRC_ALPHA,u.ZERO,u.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case Yi:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case yd:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE,u.ONE,u.ONE);break;case vd:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case _d:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}s=s||t,a=a||r,o=o||i,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(tw[t],tw[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(r!==this.currentBlendSrc||i!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(Nf[r],Nf[i],Nf[a],Nf[o]),this.currentBlendSrc=r,this.currentBlendDst=i,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case up:t.depthFunc(t.NEVER);break;case dp:t.depthFunc(t.ALWAYS);break;case hp:t.depthFunc(t.LESS);break;case yl:t.depthFunc(t.LEQUAL);break;case fp:t.depthFunc(t.EQUAL);break;case pp:t.depthFunc(t.GEQUAL);break;case mp:t.depthFunc(t.GREATER);break;case gp:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentScissor.equals(s)===!1){const{gl:a}=this;a.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentViewport.equals(s)===!1){const{gl:a}=this;a.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,r){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==r)&&(this.gl.stencilFunc(e,t,r),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=r)}setStencilOp(e,t,r){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==r)&&(this.gl.stencilOp(e,t,r),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=r)}setMaterial(e,t,r){const{gl:i}=this;e.side===Yr?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let s=e.side===bn;t&&(s=!s),this.setFlipSided(s),e.blending===Yi&&e.transparent===!1?this.setBlending(Ri):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),r>0&&this.currentClippingPlanes!==r)for(let l=0;l<8;l++)l<r?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,r){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==r)&&(i.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const r=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(r.bindVertexArray(e),t!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:r,currentBoundFramebuffers:i}=this;return i[e]!==t?(r.bindFramebuffer(e,t),i[e]=t,e===r.DRAW_FRAMEBUFFER&&(i[r.FRAMEBUFFER]=t),e===r.FRAMEBUFFER&&(i[r.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:r}=this;let i=[],s=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const a=e.textures;if(i.length!==a.length||i[0]!==r.COLOR_ATTACHMENT0){for(let o=0,l=a.length;o<l;o++)i[o]=r.COLOR_ATTACHMENT0+o;i.length=a.length,s=!0}}else i[0]!==r.BACK&&(i[0]=r.BACK,s=!0);s&&r.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:r,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),r!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,r){const{gl:i,currentTextureSlot:s,currentBoundTextures:a,maxTextures:o}=this;r===void 0&&(s===null?r=i.TEXTURE0+o-1:r=s);let l=a[r];l===void 0&&(l={type:void 0,texture:void 0},a[r]=l),(l.type!==e||l.texture!==t)&&(s!==r&&(i.activeTexture(r),this.currentTextureSlot=r),i.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,r){const{gl:i}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==r?(i.bindBufferBase(e,t,r),this.currentBoundBufferBases[s]=r,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:r}=this,i=r[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class Joe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=ui){const{gl:r,extensions:i}=this;let s;const a=Ot.getTransfer(t);if(e===Hn)return r.UNSIGNED_BYTE;if(e===Hx)return r.UNSIGNED_SHORT_4_4_4_4;if(e===$x)return r.UNSIGNED_SHORT_5_5_5_1;if(e===Wx)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===xc)return r.BYTE;if(e===yc)return r.SHORT;if(e===zs)return r.UNSIGNED_SHORT;if(e===Er)return r.INT;if(e===En)return r.UNSIGNED_INT;if(e===Zn)return r.FLOAT;if(e===Cr)return r.HALF_FLOAT;if(e===L1)return r.ALPHA;if(e===Xp)return r.RGB;if(e===qn)return r.RGBA;if(e===Zi)return r.DEPTH_COMPONENT;if(e===Qi)return r.DEPTH_STENCIL;if(e===Yp)return r.RED;if(e===th)return r.RED_INTEGER;if(e===no)return r.RG;if(e===nh)return r.RG_INTEGER;if(e===rh)return r.RGBA_INTEGER;if(e===vc||e===dl||e===hl||e===fl)if(a===st)if(s=i.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===vc)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===dl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===hl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===fl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=i.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===vc)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===dl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===hl)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===fl)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===xp||e===yp||e===vp||e===_p)if(s=i.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===xp)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===yp)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===vp)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===_p)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===bp||e===Sd||e===Td)if(s=i.get("WEBGL_compressed_texture_etc"),s!==null){if(e===bp||e===Sd)return a===st?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===Td)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Nd||e===Ed||e===Md||e===Cd||e===Ad||e===Rd||e===Pd||e===kd||e===Ld||e===Dd||e===Id||e===jd||e===Fd||e===Od)if(s=i.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Nd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Ed)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Md)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Cd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Ad)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Rd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Pd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===kd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Ld)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Dd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Id)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===jd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Fd)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Od)return a===st?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===_c)if(s=i.get("EXT_texture_compression_bptc"),s!==null){if(e===_c)return a===st?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===D1||e===wp||e===Sp||e===Tp)if(s=i.get("EXT_texture_compression_rgtc"),s!==null){if(e===_c)return s.COMPRESSED_RED_RGTC1_EXT;if(e===wp)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Sp)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Tp)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Ki?r.UNSIGNED_INT_24_8:r[e]!==void 0?r[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,i)=>{function s(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),i();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),r()}s()})}}let qR=!1,m0,nw,XR;class ele{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},qR===!1&&(this._init(),qR=!0)}_init(){const e=this.gl;m0={[Nc]:e.REPEAT,[oa]:e.CLAMP_TO_EDGE,[Ec]:e.MIRRORED_REPEAT},nw={[An]:e.NEAREST,[k1]:e.NEAREST_MIPMAP_NEAREST,[to]:e.NEAREST_MIPMAP_LINEAR,[pr]:e.LINEAR,[od]:e.LINEAR_MIPMAP_NEAREST,[Ei]:e.LINEAR_MIPMAP_LINEAR},XR={[I1]:e.NEVER,[B1]:e.ALWAYS,[qx]:e.LESS,[Xx]:e.LEQUAL,[j1]:e.EQUAL,[U1]:e.GEQUAL,[F1]:e.GREATER,[O1]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let r;return e.isCubeTexture===!0?r=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?r=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?r=t.TEXTURE_3D:r=t.TEXTURE_2D,r}getInternalFormat(e,t,r,i,s=!1){const{gl:a,extensions:o}=this;if(e!==null){if(a[e]!==void 0)return a[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;if(t===a.RED&&(r===a.FLOAT&&(l=a.R32F),r===a.HALF_FLOAT&&(l=a.R16F),r===a.UNSIGNED_BYTE&&(l=a.R8),r===a.UNSIGNED_SHORT&&(l=a.R16),r===a.UNSIGNED_INT&&(l=a.R32UI),r===a.BYTE&&(l=a.R8I),r===a.SHORT&&(l=a.R16I),r===a.INT&&(l=a.R32I)),t===a.RED_INTEGER&&(r===a.UNSIGNED_BYTE&&(l=a.R8UI),r===a.UNSIGNED_SHORT&&(l=a.R16UI),r===a.UNSIGNED_INT&&(l=a.R32UI),r===a.BYTE&&(l=a.R8I),r===a.SHORT&&(l=a.R16I),r===a.INT&&(l=a.R32I)),t===a.RG&&(r===a.FLOAT&&(l=a.RG32F),r===a.HALF_FLOAT&&(l=a.RG16F),r===a.UNSIGNED_BYTE&&(l=a.RG8),r===a.UNSIGNED_SHORT&&(l=a.RG16),r===a.UNSIGNED_INT&&(l=a.RG32UI),r===a.BYTE&&(l=a.RG8I),r===a.SHORT&&(l=a.RG16I),r===a.INT&&(l=a.RG32I)),t===a.RG_INTEGER&&(r===a.UNSIGNED_BYTE&&(l=a.RG8UI),r===a.UNSIGNED_SHORT&&(l=a.RG16UI),r===a.UNSIGNED_INT&&(l=a.RG32UI),r===a.BYTE&&(l=a.RG8I),r===a.SHORT&&(l=a.RG16I),r===a.INT&&(l=a.RG32I)),t===a.RGB){const u=s?Ud:Ot.getTransfer(i);r===a.FLOAT&&(l=a.RGB32F),r===a.HALF_FLOAT&&(l=a.RGB16F),r===a.UNSIGNED_BYTE&&(l=a.RGB8),r===a.UNSIGNED_SHORT&&(l=a.RGB16),r===a.UNSIGNED_INT&&(l=a.RGB32UI),r===a.BYTE&&(l=a.RGB8I),r===a.SHORT&&(l=a.RGB16I),r===a.INT&&(l=a.RGB32I),r===a.UNSIGNED_BYTE&&(l=u===st?a.SRGB8:a.RGB8),r===a.UNSIGNED_SHORT_5_6_5&&(l=a.RGB565),r===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1),r===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGB4),r===a.UNSIGNED_INT_5_9_9_9_REV&&(l=a.RGB9_E5)}if(t===a.RGB_INTEGER&&(r===a.UNSIGNED_BYTE&&(l=a.RGB8UI),r===a.UNSIGNED_SHORT&&(l=a.RGB16UI),r===a.UNSIGNED_INT&&(l=a.RGB32UI),r===a.BYTE&&(l=a.RGB8I),r===a.SHORT&&(l=a.RGB16I),r===a.INT&&(l=a.RGB32I)),t===a.RGBA){const u=s?Ud:Ot.getTransfer(i);r===a.FLOAT&&(l=a.RGBA32F),r===a.HALF_FLOAT&&(l=a.RGBA16F),r===a.UNSIGNED_BYTE&&(l=a.RGBA8),r===a.UNSIGNED_SHORT&&(l=a.RGBA16),r===a.UNSIGNED_INT&&(l=a.RGBA32UI),r===a.BYTE&&(l=a.RGBA8I),r===a.SHORT&&(l=a.RGBA16I),r===a.INT&&(l=a.RGBA32I),r===a.UNSIGNED_BYTE&&(l=u===st?a.SRGB8_ALPHA8:a.RGBA8),r===a.UNSIGNED_SHORT_4_4_4_4&&(l=a.RGBA4),r===a.UNSIGNED_SHORT_5_5_5_1&&(l=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(r===a.UNSIGNED_BYTE&&(l=a.RGBA8UI),r===a.UNSIGNED_SHORT&&(l=a.RGBA16UI),r===a.UNSIGNED_INT&&(l=a.RGBA32UI),r===a.BYTE&&(l=a.RGBA8I),r===a.SHORT&&(l=a.RGBA16I),r===a.INT&&(l=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(r===a.UNSIGNED_SHORT&&(l=a.DEPTH_COMPONENT16),r===a.UNSIGNED_INT&&(l=a.DEPTH_COMPONENT24),r===a.FLOAT&&(l=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&r===a.UNSIGNED_INT_24_8&&(l=a.DEPTH24_STENCIL8),(l===a.R16F||l===a.R32F||l===a.RG16F||l===a.RG32F||l===a.RGBA16F||l===a.RGBA32F)&&o.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:r,extensions:i,backend:s}=this,a=Ot.getPrimaries(Ot.workingColorSpace),o=t.colorSpace===ui?null:Ot.getPrimaries(t.colorSpace),l=t.colorSpace===ui||a===o?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,t.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,l),r.texParameteri(e,r.TEXTURE_WRAP_S,m0[t.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,m0[t.wrapT]),(e===r.TEXTURE_3D||e===r.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||r.texParameteri(e,r.TEXTURE_WRAP_R,m0[t.wrapR])),r.texParameteri(e,r.TEXTURE_MAG_FILTER,nw[t.magFilter]);const u=t.mipmaps!==void 0&&t.mipmaps.length>0,h=t.minFilter===pr&&u?Ei:t.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,nw[h]),t.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,XR[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===An||t.minFilter!==to&&t.minFilter!==Ei||t.type===Zn&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const p=i.get("EXT_texture_filter_anisotropic");r.texParameterf(e,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:r,defaultTextures:i}=this,s=this.getGLTextureType(e);let a=i[s];a===void 0&&(a=t.createTexture(),r.state.bindTexture(s,a),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),i[s]=a),r.set(e,{textureGPU:a,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:r,backend:i}=this,{levels:s,width:a,height:o,depth:l}=t,u=i.utils.convert(e.format,e.colorSpace),h=i.utils.convert(e.type),p=this.getInternalFormat(e.internalFormat,u,h,e.colorSpace,e.isVideoTexture),m=r.createTexture(),g=this.getGLTextureType(e);i.state.bindTexture(g,m),this.setTextureParameters(g,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,s,p,a,o,l):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,s,p,a,o,l):e.isVideoTexture||r.texStorage2D(g,s,p,a,o),i.set(e,{textureGPU:m,glTextureType:g,glFormat:u,glType:h,glInternalFormat:p})}copyBufferToTexture(e,t){const{gl:r,backend:i}=this,{textureGPU:s,glTextureType:a,glFormat:o,glType:l}=i.get(t),{width:u,height:h}=t.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(a,s),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(a,0,0,0,u,h,o,l,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:r}=this,{width:i,height:s}=t,{textureGPU:a,glTextureType:o,glFormat:l,glType:u,glInternalFormat:h}=this.backend.get(e);if(!(e.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){const p=e.mipmaps,m=t.image;for(let g=0;g<p.length;g++){const y=p[g];e.isCompressedArrayTexture?e.format!==r.RGBA?l!==null?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,g,0,0,0,y.width,y.height,m.depth,l,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,g,0,0,0,y.width,y.height,m.depth,l,u,y.data):l!==null?r.compressedTexSubImage2D(r.TEXTURE_2D,g,0,0,y.width,y.height,l,y.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const p=t.images;for(let m=0;m<6;m++){const g=YR(p[m]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,0,0,i,s,l,u,g)}}else if(e.isDataArrayTexture||e.isArrayTexture){const p=t.image;r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,l,u,p.data)}else if(e.isData3DTexture){const p=t.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,l,u,p.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(o,0,h,l,u,t.image);else{const p=YR(t.image);r.texSubImage2D(o,0,0,0,i,s,l,u,p)}}generateMipmaps(e){const{gl:t,backend:r}=this,{textureGPU:i,glTextureType:s}=r.get(e);r.state.bindTexture(s,i),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:r}=this;if(e){const i=r.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const s in i.framebuffers)t.deleteFramebuffer(i.framebuffers[s]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let s=0;s<i.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(i.msaaRenderbuffers[s]);delete i.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:r}=this,{textureGPU:i,renderTarget:s}=r.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(i),r.delete(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,a=0){const{gl:o,backend:l}=this,{state:u}=this.backend,{textureGPU:h,glTextureType:p,glType:m,glFormat:g}=l.get(t);u.bindTexture(p,h);let y,b,_,x,N,T,S,M,C;const R=e.isCompressedTexture?e.mipmaps[a]:e.image;if(r!==null)y=r.max.x-r.min.x,b=r.max.y-r.min.y,_=r.isBox3?r.max.z-r.min.z:1,x=r.min.x,N=r.min.y,T=r.isBox3?r.min.z:0;else{const U=Math.pow(2,-s);y=Math.floor(R.width*U),b=Math.floor(R.height*U),e.isDataArrayTexture||e.isArrayTexture?_=R.depth:e.isData3DTexture?_=Math.floor(R.depth*U):_=1,x=0,N=0,T=0}i!==null?(S=i.x,M=i.y,C=i.z):(S=0,M=0,C=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const F=o.getParameter(o.UNPACK_ROW_LENGTH),k=o.getParameter(o.UNPACK_IMAGE_HEIGHT),D=o.getParameter(o.UNPACK_SKIP_PIXELS),P=o.getParameter(o.UNPACK_SKIP_ROWS),G=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,R.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,R.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,x),o.pixelStorei(o.UNPACK_SKIP_ROWS,N),o.pixelStorei(o.UNPACK_SKIP_IMAGES,T);const $=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const U=l.get(e),K=l.get(t),O=l.get(U.renderTarget),j=l.get(K.renderTarget),L=O.framebuffers[U.cacheKey],B=j.framebuffers[K.cacheKey];u.bindFramebuffer(o.READ_FRAMEBUFFER,L),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,B);let V=o.COLOR_BUFFER_BIT;e.isDepthTexture&&(V=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(x,N,y,b,S,M,y,b,V,o.NEAREST),u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else $?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(p,a,S,M,C,y,b,_,g,m,R.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(p,a,S,M,C,y,b,_,g,R.data):o.texSubImage3D(p,a,S,M,C,y,b,_,g,m,R):e.isDataTexture?o.texSubImage2D(p,a,S,M,y,b,g,m,R.data):e.isCompressedTexture?o.compressedTexSubImage2D(p,a,S,M,R.width,R.height,g,R.data):o.texSubImage2D(p,a,S,M,y,b,g,m,R);o.pixelStorei(o.UNPACK_ROW_LENGTH,F),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,k),o.pixelStorei(o.UNPACK_SKIP_PIXELS,D),o.pixelStorei(o.UNPACK_SKIP_ROWS,P),o.pixelStorei(o.UNPACK_SKIP_IMAGES,G),a===0&&t.generateMipmaps&&o.generateMipmap(p),u.unbindTexture()}copyFramebufferToTexture(e,t,r){const{gl:i}=this,{state:s}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:l,z:u,w:h}=r,p=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,m=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(p){const g=o!==0||l!==0;let y,b;if(e.isDepthTexture===!0?(y=i.DEPTH_BUFFER_BIT,b=i.DEPTH_ATTACHMENT,t.stencil&&(y|=i.STENCIL_BUFFER_BIT)):(y=i.COLOR_BUFFER_BIT,b=i.COLOR_ATTACHMENT0),g){const _=this.backend.get(t.renderTarget),x=_.framebuffers[t.getCacheKey()],N=_.msaaFrameBuffer;s.bindFramebuffer(i.DRAW_FRAMEBUFFER,x),s.bindFramebuffer(i.READ_FRAMEBUFFER,N);const T=m-l-h;i.blitFramebuffer(o,T,o+u,T+h,o,T,o+u,T+h,y,i.NEAREST),s.bindFramebuffer(i.READ_FRAMEBUFFER,x),s.bindTexture(i.TEXTURE_2D,a),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,o,T,u,h),s.unbindTexture()}else{const _=i.createFramebuffer();s.bindFramebuffer(i.DRAW_FRAMEBUFFER,_),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,b,i.TEXTURE_2D,a,0),i.blitFramebuffer(0,0,u,h,0,0,u,h,y,i.NEAREST),i.deleteFramebuffer(_)}}else s.bindTexture(i.TEXTURE_2D,a),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,o,m-h-l,u,h),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,r,i=!1){const{gl:s}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:l,stencilBuffer:u,width:h,height:p}=a;if(s.bindRenderbuffer(s.RENDERBUFFER,e),l&&!u){let m=s.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,a.samples,m,h,p):r>0?(o&&o.isDepthTexture&&o.type===s.FLOAT&&(m=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,r,m,h,p)):s.renderbufferStorage(s.RENDERBUFFER,m,h,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else l&&u&&(r>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,r,s.DEPTH24_STENCIL8,h,p):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,h,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,r,i,s,a){const{backend:o,gl:l}=this,{textureGPU:u,glFormat:h,glType:p}=this.backend.get(e),m=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,m);const g=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+a:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,g,u,0);const y=this._getTypedArrayType(p),b=this._getBytesPerTexel(p,h),x=i*s*b,N=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,N),l.bufferData(l.PIXEL_PACK_BUFFER,x,l.STREAM_READ),l.readPixels(t,r,i,s,h,p,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const T=new y(x/y.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,N),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,T),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(m),T}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:r}=this;let i=0;if(e===r.UNSIGNED_BYTE&&(i=1),(e===r.UNSIGNED_SHORT_4_4_4_4||e===r.UNSIGNED_SHORT_5_5_5_1||e===r.UNSIGNED_SHORT_5_6_5||e===r.UNSIGNED_SHORT||e===r.HALF_FLOAT)&&(i=2),(e===r.UNSIGNED_INT||e===r.FLOAT)&&(i=4),t===r.RGBA)return i*4;if(t===r.RGB)return i*3;if(t===r.ALPHA)return i}}function YR(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class tle{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class nle{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const r=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const KR={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class rle{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:r,mode:i,object:s,type:a,info:o,index:l}=this;l!==0?r.drawElements(i,t,a,e):r.drawArrays(i,e,t),o.update(s,t,1)}renderInstances(e,t,r){const{gl:i,mode:s,type:a,index:o,object:l,info:u}=this;r!==0&&(o!==0?i.drawElementsInstanced(s,t,a,e,r):i.drawArraysInstanced(s,e,t,r),u.update(l,t,r))}renderMultiDraw(e,t,r){const{extensions:i,mode:s,object:a,info:o}=this;if(r===0)return;const l=i.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<r;u++)this.render(e[u],t[u]);else{this.index!==0?l.multiDrawElementsWEBGL(s,t,0,this.type,e,0,r):l.multiDrawArraysWEBGL(s,e,0,t,0,r);let u=0;for(let h=0;h<r;h++)u+=t[h];o.update(a,u,1)}}renderMultiDrawInstances(e,t,r,i){const{extensions:s,mode:a,object:o,info:l}=this;if(r===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let h=0;h<r;h++)this.renderInstances(e[h],t[h],i[h]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,i,0,r):u.multiDrawArraysInstancedWEBGL(a,e,0,t,0,i,0,r);let h=0;for(let p=0;p<r;p++)h+=t[p]*i[p];l.update(o,h,1)}}}class Aj{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class ile extends Aj{constructor(e,t,r=2048){if(super(r),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return Ji(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t==null||this.activeQuery!==null)return;const r=this.queries[t];if(r)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,r),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){console.error("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(r){console.error("Error in endQuery:",r),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[i,s]of this.queryStates)if(s==="ended"){const a=this.queries[i];e.push(this.resolveQuery(a))}if(e.length===0)return this.lastValue;const r=(await Promise.all(e)).reduce((i,s)=>i+s,0);return this.lastValue=r,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,r}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let r,i=!1;const s=()=>{r&&(clearTimeout(r),r=null)},a=l=>{i||(i=!0,s(),t(l))},o=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){r=setTimeout(o,1);return}const h=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(h)/1e6)}catch(l){console.error("Error checking query:",l),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}const ZR=new je;class QR extends Cj{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,r={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",r);function s(a){a.preventDefault();const o={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};e.onDeviceLost(o)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=i,this.extensions=new tle(this),this.capabilities=new nle(this),this.attributeUtils=new Zoe(this),this.textureUtils=new ele(this),this.bufferRenderer=new rle(this),this.state=new Qoe(this),this.utils=new Joe(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return fi}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,r=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),r!==null){const s=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:r,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new ile(this.gl,t,2048));const r=this.timestampQueryPool[t];r.allocateQueriesForContext(e)!==null&&r.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t}=this,r=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:a}=this.getDrawingBufferSize(ZR);t.viewport(0,0,s,a)}if(e.scissor){const{x:s,y:a,width:o,height:l}=e.scissorValue;t.scissor(s,e.height-l-a,o,l)}this.initTimestampQuery(e),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const i=e.occlusionQueryCount;i>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(i),r.occlusionQueryObjects=new Array(i),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:r}=this,i=this.get(e),s=i.previousContext;r.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(o!==null)for(let u=0;u<o.length;u++){const h=o[u];h.generateMipmaps&&this.generateMipmaps(h)}this._currentContext=s;const l=e.renderTarget;if(e.textures!==null&&l){const u=this.get(l);if(l.samples>0&&this._useMultisampledExtension(l)===!1){const h=u.framebuffers[e.getCacheKey()];let p=t.COLOR_BUFFER_BIT;l.resolveDepthBuffer&&(l.depthBuffer&&(p|=t.DEPTH_BUFFER_BIT),l.stencilBuffer&&l.resolveStencilBuffer&&(p|=t.STENCIL_BUFFER_BIT));const m=u.msaaFrameBuffer,g=u.msaaRenderbuffers,y=e.textures,b=y.length>1;if(r.bindFramebuffer(t.READ_FRAMEBUFFER,m),r.bindFramebuffer(t.DRAW_FRAMEBUFFER,h),b)for(let _=0;_<y.length;_++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+_,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+_,t.TEXTURE_2D,null,0);for(let _=0;_<y.length;_++){if(b){const{textureGPU:x}=this.get(y[_]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,g[_]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,x,0)}if(e.scissor){const{x,y:N,width:T,height:S}=e.scissorValue,M=e.height-S-N;t.blitFramebuffer(x,M,x+T,M+S,x,M,x+T,M+S,p,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,p,t.NEAREST)}if(b)for(let _=0;_<y.length;_++){const{textureGPU:x}=this.get(y[_]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+_,t.RENDERBUFFER,g[_]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+_,t.TEXTURE_2D,x,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,u.invalidationArray)}else if(l.resolveDepthBuffer===!1&&u.framebuffers){const h=u.framebuffers[e.getCacheKey()];r.bindFramebuffer(t.DRAW_FRAMEBUFFER,h),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,u.depthInvalidationArray)}}if(s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:u,height:h}=this.getDrawingBufferSize(ZR);r.viewport(0,0,u,h)}this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet,{gl:a}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let l=0;for(let u=0;u<r.length;u++){const h=r[u];h!==null&&a.getQueryParameter(h,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(h,a.QUERY_RESULT)===0&&s.add(i[u]),r[u]=null,a.deleteQuery(h),l++)}l<r.length?requestAnimationFrame(o):t.occluded=s};o()}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:r,y:i,width:s,height:a}=e.viewportValue;t.viewport(r,e.height-a-i,s,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,r,i=null,s=!0){const{gl:a,renderer:o}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let l=0;if(e&&(l|=a.COLOR_BUFFER_BIT),t&&(l|=a.DEPTH_BUFFER_BIT),r&&(l|=a.STENCIL_BUFFER_BIT),l!==0){let u;i.clearColorValue?u=i.clearColorValue:u=this.getClearColor();const h=o.getClearDepth(),p=o.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)a.clearColor(u.r,u.g,u.b,u.a),a.clear(l);else{if(s&&this._setFramebuffer(i),e)for(let m=0;m<i.textures.length;m++)m===0?a.clearBufferfv(a.COLOR,m,[u.r,u.g,u.b,u.a]):a.clearBufferfv(a.COLOR,m,[0,0,0,1]);t&&r?a.clearBufferfi(a.DEPTH_STENCIL,0,h,p):t?a.clearBufferfv(a.DEPTH,0,[h]):r&&a.clearBufferiv(a.STENCIL,0,[p])}}}beginCompute(e){const{state:t,gl:r}=this;t.bindFramebuffer(r.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,r,i){const{state:s,gl:a}=this;this.discard===!1&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:o,transformBuffers:l,attributes:u}=this.get(i),h=this._getVaoKey(u),p=this.vaoCache[h];p===void 0?this.vaoCache[h]=this._createVao(u):s.setVertexState(p),s.useProgram(o),this._bindUniforms(r);const m=this._getTransformFeedback(l);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,m),a.beginTransformFeedback(a.POINTS),u[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,t.count):a.drawArrays(a.POINTS,0,t.count),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let g=0;g<l.length;g++){const y=l[g];y.pbo&&this.has(y.pbo)&&this.textureUtils.copyBufferToTexture(y.transformBuffer,y.pbo),y.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:r,material:i,context:s,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(r),{gl:l,state:u}=this,h=this.get(s),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const m=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(i,m,a),u.useProgram(o);const g=e.getAttributes(),y=this.get(g);let b=y.vaoGPU;if(b===void 0){const F=this._getVaoKey(g);b=this.vaoCache[F],b===void 0&&(b=this._createVao(g),this.vaoCache[F]=b,y.vaoGPU=b)}const _=e.getIndex(),x=_!==null?this.get(_).bufferGPU:null;u.setVertexState(b,x);const N=h.lastOcclusionObject;if(N!==t&&N!==void 0){if(N!==null&&N.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),h.occlusionQueryIndex++),t.occlusionTest===!0){const F=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,F),h.occlusionQueries[h.occlusionQueryIndex]=F,h.occlusionQueryObjects[h.occlusionQueryIndex]=t}h.lastOcclusionObject=t}const T=this.bufferRenderer;t.isPoints?T.mode=l.POINTS:t.isLineSegments?T.mode=l.LINES:t.isLine?T.mode=l.LINE_STRIP:t.isLineLoop?T.mode=l.LINE_LOOP:i.wireframe===!0?(u.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),T.mode=l.LINES):T.mode=l.TRIANGLES;const{vertexCount:S,instanceCount:M}=p;let{firstVertex:C}=p;if(T.object=t,_!==null){C*=_.array.BYTES_PER_ELEMENT;const F=this.get(_);T.index=_.count,T.type=F.type}else T.index=0;const R=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(Ji("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),T.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?T.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Ji("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):M>1?T.renderInstances(C,S,M):T.render(C,S)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const F=this.get(e.camera),k=e.camera.cameras,D=e.getBindingGroup("cameraIndex").bindings[0];if(F.indexesGPU===void 0||F.indexesGPU.length!==k.length){const O=new Uint32Array([0,0,0,0]),j=[];for(let L=0,B=k.length;L<B;L++){const V=l.createBuffer();O[0]=L,l.bindBuffer(l.UNIFORM_BUFFER,V),l.bufferData(l.UNIFORM_BUFFER,O,l.STATIC_DRAW),j.push(V)}F.indexesGPU=j}const P=this.get(D),G=this.renderer.getPixelRatio(),$=this._currentContext.renderTarget,U=this._isRenderCameraDepthArray(this._currentContext),K=this._currentContext.activeCubeFace;if(U){const O=this.get($.depthTexture);if(O.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){O.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:j}=$;for(let L=0,B=k.length;L<B;L++)this.renderer._activeCubeFace=L,this._currentContext.activeCubeFace=L,this._setFramebuffer(this._currentContext),this.clear(!1,!0,j,this._currentContext,!1);this.renderer._activeCubeFace=K,this._currentContext.activeCubeFace=K}}for(let O=0,j=k.length;O<j;O++){const L=k[O];if(t.layers.test(L.layers)){U&&(this.renderer._activeCubeFace=O,this._currentContext.activeCubeFace=O,this._setFramebuffer(this._currentContext));const B=L.viewport;if(B!==void 0){const V=B.x*G,z=B.y*G,Y=B.width*G,se=B.height*G;u.viewport(Math.floor(V),Math.floor(e.context.height-se-z),Math.floor(Y),Math.floor(se))}u.bindBufferBase(l.UNIFORM_BUFFER,P.index,F.indexesGPU[O]),R()}this._currentContext.activeCubeFace=K,this.renderer._activeCubeFace=K}}else R()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,r,i,s,a){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,a)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new Xoe(e,t)}createProgram(e){const t=this.gl,{stage:r,code:i}=e,s=r==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const r=this.gl,i=e.pipeline,{fragmentProgram:s,vertexProgram:a}=i,o=r.createProgram(),l=this.get(s).shaderGPU,u=this.get(a).shaderGPU;if(r.attachShader(o,l),r.attachShader(o,u),r.linkProgram(o),this.set(i,{programGPU:o,fragmentShader:l,vertexShader:u}),t!==null&&this.parallel){const h=new Promise(p=>{const m=this.parallel,g=()=>{r.getProgramParameter(o,m.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),p()):requestAnimationFrame(g)};g()});t.push(h);return}this._completeCompile(e,i)}_handleSource(e,t){const r=e.split(`
`),i=[],s=Math.max(t-6,0),a=Math.min(t+6,r.length);for(let o=s;o<a;o++){const l=o+1;i.push(`${l===t?">":" "} ${l}: ${r[o]}`)}return i.join(`
`)}_getShaderErrors(e,t,r){const i=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(i&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return r.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),o)}else return s}_logProgramError(e,t,r){if(this.renderer.debug.checkShaderErrors){const i=this.gl,s=i.getProgramInfoLog(e).trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,r,t);else{const a=this._getShaderErrors(i,r,"vertex"),o=this._getShaderErrors(i,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+a+`
`+o)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:r,gl:i}=this,s=this.get(t),{programGPU:a,fragmentShader:o,vertexShader:l}=s;i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,o,l),r.useProgram(a);const u=e.getBindings();this._setupBindings(u,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:r,gl:i}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:a}=e,o=i.createProgram(),l=this.get(s).shaderGPU,u=this.get(a).shaderGPU,h=a.transforms,p=[],m=[];for(let _=0;_<h.length;_++){const x=h[_];p.push(x.varyingName),m.push(x.attributeNode)}i.attachShader(o,l),i.attachShader(o,u),i.transformFeedbackVaryings(o,p,i.SEPARATE_ATTRIBS),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,l,u),r.useProgram(o),this._setupBindings(t,o);const g=a.attributes,y=[],b=[];for(let _=0;_<g.length;_++){const x=g[_].node.attribute;y.push(x),this.has(x)||this.attributeUtils.createAttribute(x,i.ARRAY_BUFFER)}for(let _=0;_<m.length;_++){const x=m[_].attribute;this.has(x)||this.attributeUtils.createAttribute(x,i.ARRAY_BUFFER);const N=this.get(x);b.push(N)}this.set(e,{programGPU:o,transformBuffers:b,attributes:y})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let r=0,i=0;for(const s of t){this.set(s,{textures:i,uniformBuffers:r});for(const a of s.bindings)a.isUniformBuffer&&r++,a.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,r=this.get(e);let i=r.uniformBuffers,s=r.textures;for(const a of e.bindings)if(a.isUniformsGroup||a.isUniformBuffer){const o=a.buffer,l=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,l),t.bufferData(t.UNIFORM_BUFFER,o,t.DYNAMIC_DRAW),this.set(a,{index:i++,bufferGPU:l})}else if(a.isSampledTexture){const{textureGPU:o,glTextureType:l}=this.get(a.texture);this.set(a,{index:s++,textureGPU:o,glTextureType:l})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(KR).filter(i=>KR[i]===e),r=this.extensions;for(let i=0;i<t.length;i++)if(r.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,r=null,i=null,s=0,a=0){this.textureUtils.copyTextureToTexture(e,t,r,i,s,a)}copyFramebufferToTexture(e,t,r){this.textureUtils.copyFramebufferToTexture(e,t,r)}_setFramebuffer(e){const{gl:t,state:r}=this;let i=null;if(e.textures!==null){const s=e.renderTarget,a=this.get(s),{samples:o,depthBuffer:l,stencilBuffer:u}=s,h=s.isWebGLCubeRenderTarget===!0,p=s.isRenderTarget3D===!0,m=s.depth>1,g=s.isXRRenderTarget===!0,y=g===!0&&s._hasExternalTextures===!0;let b=a.msaaFrameBuffer,_=a.depthRenderbuffer;const x=this.extensions.get("WEBGL_multisampled_render_to_texture"),N=this.extensions.get("OVR_multiview2"),T=this._useMultisampledExtension(s),S=lj(e);let M;if(h?(a.cubeFramebuffers||(a.cubeFramebuffers={}),M=a.cubeFramebuffers[S]):g&&y===!1?M=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),M=a.framebuffers[S]),M===void 0){M=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,M);const C=e.textures,R=[];if(h){a.cubeFramebuffers[S]=M;const{textureGPU:k}=this.get(C[0]),D=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+D,k,0)}else{a.framebuffers[S]=M;for(let k=0;k<C.length;k++){const D=C[k],P=this.get(D);P.renderTarget=e.renderTarget,P.cacheKey=S;const G=t.COLOR_ATTACHMENT0+k;if(s.multiview)N.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,G,P.textureGPU,0,o,0,2);else if(p||m){const $=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,G,P.textureGPU,0,$)}else T?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,G,t.TEXTURE_2D,P.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,G,t.TEXTURE_2D,P.textureGPU,0)}}const F=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const k=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(k,e,0,T),a.xrDepthRenderbuffer=k,R.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,k),t.framebufferRenderbuffer(t.FRAMEBUFFER,F,t.RENDERBUFFER,k)}else if(e.depthTexture!==null){R.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const k=this.get(e.depthTexture);if(k.renderTarget=e.renderTarget,k.cacheKey=S,s.multiview)N.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,F,k.textureGPU,0,o,0,2);else if(y&&T)x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,F,t.TEXTURE_2D,k.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){const D=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,F,k.textureGPU,0,D)}else t.framebufferTexture2D(t.FRAMEBUFFER,F,t.TEXTURE_2D,k.textureGPU,0)}a.depthInvalidationArray=R}else{if(this._isRenderCameraDepthArray(e)){r.bindFramebuffer(t.FRAMEBUFFER,M);const R=this.renderer._activeCubeFace,F=this.get(e.depthTexture),k=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,k,F.textureGPU,0,R)}if((g||T||s.multiview)&&s._isOpaqueFramebuffer!==!0){r.bindFramebuffer(t.FRAMEBUFFER,M);const R=this.get(e.textures[0]);s.multiview?N.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,R.textureGPU,0,o,0,2):T?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,R.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,R.textureGPU,0);const F=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const k=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,k),t.framebufferRenderbuffer(t.FRAMEBUFFER,F,t.RENDERBUFFER,k)}else{const k=this.get(e.depthTexture);s.multiview?N.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,F,k.textureGPU,0,o,0,2):T?x.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,F,t.TEXTURE_2D,k.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,F,t.TEXTURE_2D,k.textureGPU,0)}}}if(o>0&&T===!1&&!s.multiview){if(b===void 0){const C=[];b=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,b);const R=[],F=e.textures;for(let k=0;k<F.length;k++){R[k]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,R[k]),C.push(t.COLOR_ATTACHMENT0+k);const D=e.textures[k],P=this.get(D);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,P.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+k,t.RENDERBUFFER,R[k])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),a.msaaFrameBuffer=b,a.msaaRenderbuffers=R,l&&_===void 0){_=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(_,e,o),a.depthRenderbuffer=_;const k=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;C.push(k)}a.invalidationArray=C}i=a.msaaFrameBuffer}else i=M;r.drawBuffers(e,M)}r.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let r=0;r<e.length;r++){const i=this.get(e[r]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,r=t.createVertexArray();t.bindVertexArray(r);for(let i=0;i<e.length;i++){const s=e[i],a=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,a.bufferGPU),t.enableVertexAttribArray(i);let o,l;s.isInterleavedBufferAttribute===!0?(o=s.data.stride*a.bytesPerElement,l=s.offset*a.bytesPerElement):(o=0,l=0),a.isInteger?t.vertexAttribIPointer(i,s.itemSize,a.type,o,l):t.vertexAttribPointer(i,s.itemSize,a.type,s.normalized,o,l),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(i,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(i,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),r}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let r=this.transformFeedbackCache[t];if(r!==void 0)return r;const{gl:i}=this;r=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r);for(let s=0;s<e.length;s++){const a=e[s];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,s,a.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=r,r}_setupBindings(e,t){const r=this.gl;for(const i of e)for(const s of i.bindings){const o=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const l=r.getUniformBlockIndex(t,s.name);r.uniformBlockBinding(t,l,o)}else if(s.isSampledTexture){const l=r.getUniformLocation(t,s.name);r.uniform1i(l,o)}}}_bindUniforms(e){const{gl:t,state:r}=this;for(const i of e)for(const s of i.bindings){const a=this.get(s),o=a.index;s.isUniformsGroup||s.isUniformBuffer?r.bindBufferBase(t.UNIFORM_BUFFER,o,a.bufferGPU):s.isSampledTexture&&r.bindTexture(a.glTextureType,a.textureGPU,t.TEXTURE0+o)}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const td={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Ir={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},oi={Store:"store"},dn={Load:"load",Clear:"clear"},rw={CCW:"ccw"},iw={None:"none",Front:"front",Back:"back"},Wd={Uint16:"uint16",Uint32:"uint32"},ae={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},sw={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},uc={Linear:"linear",Nearest:"nearest"},en={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Zl={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},JR={None:0,All:15},el={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},aw={Storage:"storage",ReadOnlyStorage:"read-only-storage"},ow={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},eP={NonFiltering:"non-filtering",Comparison:"comparison"},Ql={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},tP={TwoD:"2d",ThreeD:"3d"},sr={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},sle={All:"all"},g0={Vertex:"vertex",Instance:"instance"},MS={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"};class ale extends VT{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class ole extends ale{constructor(e,t,r){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r}update(){this.texture=this.textureNode.value}}class lle extends wj{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let cle=0;class ule extends lle{constructor(e,t){super("StorageBuffer_"+cle++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:io.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class dle extends El{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:uc.Linear}),this.flipYSampler=e.createSampler({minFilter:uc.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:r}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:td.TriangleStrip,stripIndexFormat:Wd.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:td.TriangleStrip,stripIndexFormat:Wd.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,r=0){const i=t.format,{width:s,height:a}=t.size,o=this.getTransferPipeline(i),l=this.getFlipYPipeline(i),u=this.device.createTexture({size:{width:s,height:a,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),h=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:sr.TwoD,baseArrayLayer:r}),p=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:sr.TwoD,baseArrayLayer:0}),m=this.device.createCommandEncoder({}),g=(y,b,_)=>{const x=y.getBindGroupLayout(0),N=this.device.createBindGroup({layout:x,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:b}]}),T=m.beginRenderPass({colorAttachments:[{view:_,loadOp:dn.Clear,storeOp:oi.Store,clearValue:[0,0,0,0]}]});T.setPipeline(y),T.setBindGroup(0,N),T.draw(4,1,0,0),T.end()};g(o,h,p),g(l,p,h),this.device.queue.submit([m.finish()]),u.destroy()}generateMipmaps(e,t,r=0){const i=this.get(e);i.useCount===void 0&&(i.useCount=0,i.layers=[]);const s=i.layers[r]||this._mipmapCreateBundles(e,t,r),a=this.device.createCommandEncoder({});this._mipmapRunBundles(a,s),this.device.queue.submit([a.finish()]),i.useCount!==0&&(i.layers[r]=s),i.useCount++}_mipmapCreateBundles(e,t,r){const i=this.getTransferPipeline(t.format),s=i.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:sr.TwoD,baseArrayLayer:r});const o=[];for(let l=1;l<t.mipLevelCount;l++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),h=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:sr.TwoD,baseArrayLayer:r}),p={colorAttachments:[{view:h,loadOp:dn.Clear,storeOp:oi.Store,clearValue:[0,0,0,0]}]},m=this.device.createRenderBundleEncoder({colorFormats:[t.format]});m.setPipeline(i),m.setBindGroup(0,u),m.draw(4,1,0,0),o.push({renderBundles:[m.finish()],passDescriptor:p}),a=h}return o}_mipmapRunBundles(e,t){const r=t.length;for(let i=0;i<r;i++){const s=t[i],a=e.beginRenderPass(s.passDescriptor);a.executeBundles(s.renderBundles),a.end()}}}const hle={[I1]:"never",[qx]:"less",[j1]:"equal",[Xx]:"less-equal",[F1]:"greater",[U1]:"greater-equal",[B1]:"always",[O1]:"not-equal"},fle=[0,1,3,2,4,5];class ple{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new xs,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,r=t.device,i=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===uc.Linear&&s.minFilter===uc.Linear&&s.mipmapFilter===uc.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=hle[e.compareFunction]),i.sampler=r.createSampler(s)}createDefaultTexture(e){let t;const r=CS(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(r):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,i=r.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:a,depth:o,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),h=e.internalFormat||t.format||CS(e,r.device);i.format=h;const{samples:p,primarySamples:m,isMSAA:g}=r.utils.getTextureSampleData(e);let y=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(y|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(y|=GPUTextureUsage.RENDER_ATTACHMENT);const b={label:e.name,size:{width:s,height:a,depthOrArrayLayers:o},mipLevelCount:l,sampleCount:m,dimension:u,format:h,usage:y};if(e.isVideoTexture){const _=e.source.data,x=new VideoFrame(_);b.size.width=x.displayWidth,b.size.height=x.displayHeight,x.close(),i.externalTexture=_}else{if(h===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}e.isCubeTexture&&(b.textureBindingViewDimension=sr.Cube),i.texture=r.device.createTexture(b)}if(g){const _=Object.assign({},b);_.label=_.label+"-msaa",_.sampleCount=p,i.msaaTexture=r.device.createTexture(_)}i.initialized=!0,i.textureDescriptorGPU=b}destroyTexture(e){const t=this.backend,r=t.get(e);r.texture!==void 0&&r.texture.destroy(),r.msaaTexture!==void 0&&r.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const r=this.backend.get(e);delete r.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let r=0;r<6;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r);else{const r=e.image.depth||1;for(let i=0;i<r;i++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,i)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:r}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const r=this.backend,{width:i,height:s}=r.getDrawingBufferSize(),a=this.depthTexture,o=r.get(a).texture;let l,u;if(t?(l=Qi,u=Ki):e&&(l=Zi,u=En),o!==void 0){if(a.image.width===i&&a.image.height===s&&a.format===l&&a.type===u)return o;this.destroyTexture(a)}return a.name="depthBuffer",a.format=l,a.type=u,a.image.width=i,a.image.height=s,this.createTexture(a,{width:i,height:s}),r.get(a).texture}updateTexture(e,t){const r=this.backend.get(e),{textureDescriptorGPU:i}=r;if(!(e.isRenderTargetTexture||i===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,r.texture,i,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,r.texture,i,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,r.texture,i,e.flipY,e.premultiplyAlpha);else if(e.isVideoTexture){const s=e.source.data;r.externalTexture=s}else this._copyImageToTexture(t.image,r.texture,i,0,e.flipY,e.premultiplyAlpha);r.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,r,i,s,a){const o=this.backend.device,l=this.backend.get(e),u=l.texture,h=l.textureDescriptorGPU.format,p=this._getBytesPerTexel(h);let m=i*p;m=Math.ceil(m/256)*256;const g=o.createBuffer({size:i*s*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),y=o.createCommandEncoder();y.copyTextureToBuffer({texture:u,origin:{x:t,y:r,z:a}},{buffer:g,bytesPerRow:m},{width:i,height:s});const b=this._getTypedArrayType(h);o.queue.submit([y.finish()]),await g.mapAsync(GPUMapMode.READ);const _=g.getMappedRange();return new b(_)}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new Jn;r.minFilter=An,r.magFilter=An,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new Zp;r.minFilter=An,r.magFilter=An,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,r,i,s){for(let a=0;a<6;a++){const o=e[a],l=i===!0?fle[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,r,l,i):this._copyImageToTexture(o,t,r,l,i,s)}}_copyImageToTexture(e,t,r,i,s,a){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:0,origin:{x:0,y:0,z:i},premultipliedAlpha:a},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new dle(this.backend.device)),e}_generateMipmaps(e,t,r=0){this._getPassUtils().generateMipmaps(e,t,r)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,i,s,a=0){const o=this.backend.device,l=e.data,u=this._getBytesPerTexel(r.format),h=e.width*u;o.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:i}},l,{offset:e.width*e.height*u*a,bytesPerRow:h},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,r,i)}_copyCompressedBufferToTexture(e,t,r){const i=this.backend.device,s=this._getBlockData(r.format),a=r.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const l=e[o],u=l.width,h=l.height,p=a?r.size.depthOrArrayLayers:1,m=Math.ceil(u/s.width)*s.byteLength,g=m*Math.ceil(h/s.height);for(let y=0;y<p;y++)i.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:y}},l.data,{offset:y*g,bytesPerRow:m,rowsPerImage:Math.ceil(h/s.height)},{width:Math.ceil(u/s.width)*s.width,height:Math.ceil(h/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ae.BC1RGBAUnorm||e===ae.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ae.BC2RGBAUnorm||e===ae.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.BC3RGBAUnorm||e===ae.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.BC4RUnorm||e===ae.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===ae.BC5RGUnorm||e===ae.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ae.BC6HRGBUFloat||e===ae.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ae.BC7RGBAUnorm||e===ae.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.ETC2RGB8Unorm||e===ae.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ae.ETC2RGB8A1Unorm||e===ae.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ae.ETC2RGBA8Unorm||e===ae.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ae.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ae.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ae.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ae.ASTC4x4Unorm||e===ae.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ae.ASTC5x4Unorm||e===ae.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ae.ASTC5x5Unorm||e===ae.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ae.ASTC6x5Unorm||e===ae.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ae.ASTC6x6Unorm||e===ae.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ae.ASTC8x5Unorm||e===ae.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ae.ASTC8x6Unorm||e===ae.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ae.ASTC8x8Unorm||e===ae.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ae.ASTC10x5Unorm||e===ae.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ae.ASTC10x6Unorm||e===ae.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ae.ASTC10x8Unorm||e===ae.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ae.ASTC10x10Unorm||e===ae.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ae.ASTC12x10Unorm||e===ae.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ae.ASTC12x12Unorm||e===ae.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=sw.ClampToEdge;return e===Nc?t=sw.Repeat:e===Ec&&(t=sw.MirrorRepeat),t}_convertFilterMode(e){let t=uc.Linear;return(e===An||e===k1||e===to)&&(t=uc.Nearest),t}_getBytesPerTexel(e){if(e===ae.R8Unorm||e===ae.R8Snorm||e===ae.R8Uint||e===ae.R8Sint)return 1;if(e===ae.R16Uint||e===ae.R16Sint||e===ae.R16Float||e===ae.RG8Unorm||e===ae.RG8Snorm||e===ae.RG8Uint||e===ae.RG8Sint)return 2;if(e===ae.R32Uint||e===ae.R32Sint||e===ae.R32Float||e===ae.RG16Uint||e===ae.RG16Sint||e===ae.RG16Float||e===ae.RGBA8Unorm||e===ae.RGBA8UnormSRGB||e===ae.RGBA8Snorm||e===ae.RGBA8Uint||e===ae.RGBA8Sint||e===ae.BGRA8Unorm||e===ae.BGRA8UnormSRGB||e===ae.RGB9E5UFloat||e===ae.RGB10A2Unorm||e===ae.RG11B10UFloat||e===ae.Depth32Float||e===ae.Depth24Plus||e===ae.Depth24PlusStencil8||e===ae.Depth32FloatStencil8)return 4;if(e===ae.RG32Uint||e===ae.RG32Sint||e===ae.RG32Float||e===ae.RGBA16Uint||e===ae.RGBA16Sint||e===ae.RGBA16Float)return 8;if(e===ae.RGBA32Uint||e===ae.RGBA32Sint||e===ae.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ae.R8Uint)return Uint8Array;if(e===ae.R8Sint)return Int8Array;if(e===ae.R8Unorm)return Uint8Array;if(e===ae.R8Snorm)return Int8Array;if(e===ae.RG8Uint)return Uint8Array;if(e===ae.RG8Sint)return Int8Array;if(e===ae.RG8Unorm)return Uint8Array;if(e===ae.RG8Snorm)return Int8Array;if(e===ae.RGBA8Uint)return Uint8Array;if(e===ae.RGBA8Sint)return Int8Array;if(e===ae.RGBA8Unorm)return Uint8Array;if(e===ae.RGBA8Snorm)return Int8Array;if(e===ae.R16Uint)return Uint16Array;if(e===ae.R16Sint)return Int16Array;if(e===ae.RG16Uint)return Uint16Array;if(e===ae.RG16Sint)return Int16Array;if(e===ae.RGBA16Uint)return Uint16Array;if(e===ae.RGBA16Sint)return Int16Array;if(e===ae.R16Float||e===ae.RG16Float||e===ae.RGBA16Float)return Uint16Array;if(e===ae.R32Uint)return Uint32Array;if(e===ae.R32Sint)return Int32Array;if(e===ae.R32Float)return Float32Array;if(e===ae.RG32Uint)return Uint32Array;if(e===ae.RG32Sint)return Int32Array;if(e===ae.RG32Float)return Float32Array;if(e===ae.RGBA32Uint)return Uint32Array;if(e===ae.RGBA32Sint)return Int32Array;if(e===ae.RGBA32Float)return Float32Array;if(e===ae.BGRA8Unorm||e===ae.BGRA8UnormSRGB)return Uint8Array;if(e===ae.RGB10A2Unorm||e===ae.RGB9E5UFloat||e===ae.RG11B10UFloat)return Uint32Array;if(e===ae.Depth32Float)return Float32Array;if(e===ae.Depth24Plus||e===ae.Depth24PlusStencil8)return Uint32Array;if(e===ae.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=tP.ThreeD:t=tP.TwoD,t}}function CS(n,e=null){const t=n.format,r=n.type,i=n.colorSpace,s=Ot.getTransfer(i);let a;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case dl:a=s===st?ae.BC1RGBAUnormSRGB:ae.BC1RGBAUnorm;break;case hl:a=s===st?ae.BC2RGBAUnormSRGB:ae.BC2RGBAUnorm;break;case fl:a=s===st?ae.BC3RGBAUnormSRGB:ae.BC3RGBAUnorm;break;case Sd:a=s===st?ae.ETC2RGB8UnormSRGB:ae.ETC2RGB8Unorm;break;case Td:a=s===st?ae.ETC2RGBA8UnormSRGB:ae.ETC2RGBA8Unorm;break;case Nd:a=s===st?ae.ASTC4x4UnormSRGB:ae.ASTC4x4Unorm;break;case Ed:a=s===st?ae.ASTC5x4UnormSRGB:ae.ASTC5x4Unorm;break;case Md:a=s===st?ae.ASTC5x5UnormSRGB:ae.ASTC5x5Unorm;break;case Cd:a=s===st?ae.ASTC6x5UnormSRGB:ae.ASTC6x5Unorm;break;case Ad:a=s===st?ae.ASTC6x6UnormSRGB:ae.ASTC6x6Unorm;break;case Rd:a=s===st?ae.ASTC8x5UnormSRGB:ae.ASTC8x5Unorm;break;case Pd:a=s===st?ae.ASTC8x6UnormSRGB:ae.ASTC8x6Unorm;break;case kd:a=s===st?ae.ASTC8x8UnormSRGB:ae.ASTC8x8Unorm;break;case Ld:a=s===st?ae.ASTC10x5UnormSRGB:ae.ASTC10x5Unorm;break;case Dd:a=s===st?ae.ASTC10x6UnormSRGB:ae.ASTC10x6Unorm;break;case Id:a=s===st?ae.ASTC10x8UnormSRGB:ae.ASTC10x8Unorm;break;case jd:a=s===st?ae.ASTC10x10UnormSRGB:ae.ASTC10x10Unorm;break;case Fd:a=s===st?ae.ASTC12x10UnormSRGB:ae.ASTC12x10Unorm;break;case Od:a=s===st?ae.ASTC12x12UnormSRGB:ae.ASTC12x12Unorm;break;case qn:a=s===st?ae.RGBA8UnormSRGB:ae.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case qn:switch(r){case xc:a=ae.RGBA8Snorm;break;case yc:a=ae.RGBA16Sint;break;case zs:a=ae.RGBA16Uint;break;case En:a=ae.RGBA32Uint;break;case Er:a=ae.RGBA32Sint;break;case Hn:a=s===st?ae.RGBA8UnormSRGB:ae.RGBA8Unorm;break;case Cr:a=ae.RGBA16Float;break;case Zn:a=ae.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case Xp:switch(r){case Wx:a=ae.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case Yp:switch(r){case xc:a=ae.R8Snorm;break;case yc:a=ae.R16Sint;break;case zs:a=ae.R16Uint;break;case En:a=ae.R32Uint;break;case Er:a=ae.R32Sint;break;case Hn:a=ae.R8Unorm;break;case Cr:a=ae.R16Float;break;case Zn:a=ae.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case no:switch(r){case xc:a=ae.RG8Snorm;break;case yc:a=ae.RG16Sint;break;case zs:a=ae.RG16Uint;break;case En:a=ae.RG32Uint;break;case Er:a=ae.RG32Sint;break;case Hn:a=ae.RG8Unorm;break;case Cr:a=ae.RG16Float;break;case Zn:a=ae.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case Zi:switch(r){case zs:a=ae.Depth16Unorm;break;case En:a=ae.Depth24Plus;break;case Zn:a=ae.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case Qi:switch(r){case Ki:a=ae.Depth24PlusStencil8;break;case Zn:e&&e.features.has(MS.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=ae.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case th:switch(r){case Er:a=ae.R32Sint;break;case En:a=ae.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case nh:switch(r){case Er:a=ae.RG32Sint;break;case En:a=ae.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case rh:switch(r){case Er:a=ae.RGBA32Sint;break;case En:a=ae.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return a}const mle=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,gle=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,nP={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},xle=n=>{n=n.trim();const e=n.match(mle);if(e!==null&&e.length===4){const t=e[2],r=[];let i=null;for(;(i=gle.exec(t))!==null;)r.push({name:i[1],type:i[2]});const s=[];for(let h=0;h<r.length;h++){const{name:p,type:m}=r[h];let g=m;g.startsWith("ptr")?g="pointer":(g.startsWith("texture")&&(g=m.split("<")[0]),g=nP[g]),s.push(new UT(g,p))}const a=n.substring(e[0].length),o=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:nP[o]||o,inputs:s,name:l,inputsCode:t,blockCode:a,outputType:o}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class yle extends zT{constructor(e){const{type:t,inputs:r,name:i,inputsCode:s,blockCode:a,outputType:o}=xle(e);super(t,r,i),this.inputsCode=s,this.blockCode=a,this.outputType=o}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class vle extends _j{parseFunction(e){return new yle(e)}}const Bu=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},_le={[io.READ_ONLY]:"read",[io.WRITE_ONLY]:"write",[io.READ_WRITE]:"read_write"},rP={[Nc]:"repeat",[oa]:"clamp",[Ec]:"mirror"},x0={vertex:Bu?Bu.VERTEX:1,fragment:Bu?Bu.FRAGMENT:2,compute:Bu?Bu.COMPUTE:4},iP={instance:!0,swizzleAssign:!1,storageBuffer:!0},ble={"^^":"tsl_xor"},wle={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},sP={},ds={tsl_xor:new fr("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new fr("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new fr("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new fr("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new fr("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new fr("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new fr("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new fr("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new fr("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new fr("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new fr("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new fr("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new fr(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},jf={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(ds.pow_float=new fr("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),ds.pow_vec2=new fr("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[ds.pow_float]),ds.pow_vec3=new fr("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[ds.pow_float]),ds.pow_vec4=new fr("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[ds.pow_float]),jf.pow_float="tsl_pow_float",jf.pow_vec2="tsl_pow_vec2",jf.pow_vec3="tsl_pow_vec3",jf.pow_vec4="tsl_pow_vec4");let Rj="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(Rj+=`diagnostic( off, derivative_uniformity );
`);class Sle extends vj{constructor(e,t){super(e,t,new vle),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==ui}_generateTextureSample(e,t,r,i,s=this.shaderStage){return s==="fragment"?i?`textureSample( ${t}, ${t}_sampler, ${r}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${r} )`:this._generateTextureSampleLevel(e,t,r,"0",i)}_generateVideoSample(e,t,r=this.shaderStage){if(r==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${r} shader.`)}_generateTextureSampleLevel(e,t,r,i,s){return this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,i):this.generateTextureLod(e,t,r,s,i)}generateWrapFunction(e){const t=`tsl_coord_${rP[e.wrapS]}S_${rP[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let r=sP[t];if(r===void 0){const i=[],s=e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const o=(l,u)=>{l===Nc?(i.push(ds.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${u} )`):l===oa?(i.push(ds.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${u} )`):l===Ec?(i.push(ds.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${u} )`):(a+=`		coord.${u}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};o(e.wrapS,"x"),a+=`,
`,o(e.wrapT,"y"),e.isData3DTexture&&(a+=`,
`,o(e.wrapR,"z")),a+=`
	);

}
`,sP[t]=r=new fr(a,i)}return r.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,r){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let s=i.dimensionsSnippet[r];if(i.dimensionsSnippet[r]===void 0){let a,o;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),u=l>1;e.isData3DTexture?o="vec3<u32>":o="vec2<u32>",u||e.isVideoTexture||e.isStorageTexture?a=t:a=`${t}${r?`, u32( ${r} )`:""}`,s=new B0(new V0(`textureDimensions( ${a} )`,o)),i.dimensionsSnippet[r]=s,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(i.arrayLayerCount=new B0(new V0(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new B0(new V0("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,r,i="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,i);return`tsl_biquadraticTexture( ${t}, ${s}( ${r} ), ${a}, u32( ${i} ) )`}generateTextureLod(e,t,r,i,s="0u"){const a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,s),l=e.isData3DTexture?"vec3":"vec2",u=`${l}<u32>( ${a}( ${r} ) * ${l}<f32>( ${o} ) )`;return this.generateTextureLoad(e,t,u,i,s)}generateTextureLoad(e,t,r,i,s="0u"){let a;return e.isVideoTexture===!0?a=`textureLoad( ${t}, ${r} )`:i?a=`textureLoad( ${t}, ${r}, ${i}, u32( ${s} ) )`:(a=`textureLoad( ${t}, ${r}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,r,i,s){let a;return i?a=`textureStore( ${t}, ${r}, ${i}, ${s} )`:a=`textureStore( ${t}, ${r}, ${s} )`,a}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Zn||this.isSampleCompare(e)===!1&&e.minFilter===An&&e.magFilter===An||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,r,i,s=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(t,r,s):this.isUnfilterable(e)?a=this.generateTextureLod(e,t,r,i,"0",s):a=this._generateTextureSample(e,t,r,i,s),a}generateTextureGrad(e,t,r,i,s,a=this.shaderStage){if(a==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,r,i,s,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,r,i,s,a=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(t,r,a):o=this._generateTextureSampleLevel(e,t,r,i,s),o}generateTextureBias(e,t,r,i,s,a=this.shaderStage){if(a==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const r=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"?r:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?r:r+".value":e.groupNode.name+"."+r}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=ble[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?io.READ_ONLY:e.access}getStorageAccess(e,t){return _le[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),a=this.getDataFromNode(e,r,this.globalCache);if(a.uniformGPU===void 0){let o;const l=e.groupNode,u=l.name,h=this.getBindGroupArray(u,r);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let p=null;const m=this.getNodeAccess(e,r);if(t==="texture"||t==="storageTexture"?p=new gy(s.name,s.node,l,m):t==="cubeTexture"?p=new Ej(s.name,s.node,l,m):t==="texture3D"&&(p=new Mj(s.name,s.node,l,m)),p.store=e.isStorageTextureNode===!0,p.setVisibility(x0[r]),this.isUnfilterable(e.value)===!1&&p.store===!1){const g=new ole(`${s.name}_sampler`,s.node,l);g.setVisibility(x0[r]),h.push(g,p),o=[g,p]}else h.push(p),o=[p]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const p=t==="buffer"?Tj:ule,m=new p(e,l);m.setVisibility(x0[r]),h.push(m),o=m,s.name=i||"NodeBuffer_"+s.id}else{const p=this.uniformGroups[r]||(this.uniformGroups[r]={});let m=p[u];m===void 0&&(m=new Nj(u,l),m.setVisibility(x0[r]),p[u]=m,h.push(m)),o=this.getNodeUniform(s,t),m.addUniform(o)}a.uniformGPU=o}return s}getBuiltin(e,t,r,i=this.shaderStage){const s=this.builtins[i]||(this.builtins[i]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:r}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const a of t.inputs)i.push(a.name+" : "+this.getType(a.type));let s=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${r.vars}
${r.code}
`;return r.result&&(s+=`	return ${r.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],r=this.directives[e];if(r!==void 0)for(const i of r)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],r=this.builtins[e];if(r!==void 0)for(const{name:i,property:s,type:a}of r.values())t.push(`@builtin( ${i} ) ${s} : ${a}`);return t.join(`,
	`)}getScopedArray(e,t,r,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:r,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:r,scope:i,bufferType:s,bufferCount:a}of this.scopedArrays.values()){const o=this.getType(s);t.push(`var<${i}> ${r}: array< ${o}, ${a} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const r=this.getBuiltins("attribute");r&&t.push(r);const i=this.getAttributesArray();for(let s=0,a=i.length;s<a;s++){const o=i[s],l=o.name,u=this.getType(o.type);t.push(`@location( ${s} ) ${l} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const r of e.members){const i=e.output?"@location( "+r.index+" ) ":"";let s=this.getType(r.type);r.atomic&&(s="atomic< "+s+" >"),t.push(`	${i+r.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const r=this.structs[e];if(r.length>0){const i=[];for(const s of r){let a=`struct ${s.name} {
`;a+=this.getStructMembers(s),a+=`
};`,i.push(a)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,r=null){let i=`var ${t} : `;return r!==null?i+=this.generateArrayDeclaration(e,r):i+=this.getType(e),i}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,a=this.vars[e];for(let o=0;o<s.length;o++){const l=s[o];if(l.needsInterpolation){let u=`@location( ${o} )`;if(l.interpolationType){const h=l.interpolationSampling!==null?`, ${l.interpolationSampling} )`:" )";u+=` @interpolate( ${l.interpolationType}${h}`}else/^(int|uint|ivec|uvec)/.test(l.type)&&(u+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${u} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&a.includes(l)===!1&&a.push(l)}}const r=this.getBuiltins(e);r&&t.push(r);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){const t=e.value,r=e.node,i=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&r.structTypeNode!==null,s=r.value&&r.value.array&&typeof r.value.itemSize=="number"&&r.value.array.length>r.value.itemSize;return i&&!s}getUniforms(e){const t=this.uniforms[e],r=[],i=[],s=[],a={};for(const l of t){const u=l.groupNode.name,h=this.bindingsIndexes[u];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const p=l.node.value;this.isUnfilterable(p)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(p)?r.push(`@binding( ${h.binding++} ) @group( ${h.group} ) var ${l.name}_sampler : sampler_comparison;`):r.push(`@binding( ${h.binding++} ) @group( ${h.group} ) var ${l.name}_sampler : sampler;`));let m,g="";const{primarySamples:y}=this.renderer.backend.utils.getTextureSampleData(p);if(y>1&&(g="_multisampled"),p.isCubeTexture===!0)m="texture_cube<f32>";else if(p.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&p.compareFunction===null?m=`texture${g}_2d<f32>`:m=`texture_depth${g}_2d${p.isArrayTexture===!0?"_array":""}`;else if(l.node.isStorageTextureNode===!0){const b=CS(p),_=this.getStorageAccess(l.node,e),x=l.node.value.is3DTexture,N=l.node.value.isArrayTexture;m=`texture_storage_${x?"3d":`2d${N?"_array":""}`}<${b}, ${_}>`}else if(p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)m="texture_2d_array<f32>";else if(p.is3DTexture===!0||p.isData3DTexture===!0)m="texture_3d<f32>";else if(p.isVideoTexture===!0)m="texture_external";else{const b=this.getComponentTypeFromTexture(p).charAt(0);m=`texture${g}_2d<${b}32>`}r.push(`@binding( ${h.binding++} ) @group( ${h.group} ) var ${l.name} : ${m};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const p=l.node,m=this.getType(p.getNodeType(this)),g=p.bufferCount,y=g>0&&l.type==="buffer"?", "+g:"",b=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,e)}`:"uniform";if(this.isCustomStruct(l))i.push(`@binding( ${h.binding++} ) @group( ${h.group} ) var<${b}> ${l.name} : ${m};`);else{const x=`	value : array< ${p.isAtomic?`atomic<${m}>`:`${m}`}${y} >`;i.push(this._getWGSLStructBinding(l.name,x,b,h.binding++,h.group))}}else{const p=this.getType(this.getVectorType(l.type)),m=l.groupNode.name;(a[m]||(a[m]={index:h.binding++,id:h.group,snippets:[]})).snippets.push(`	${l.name} : ${p}`)}}for(const l in a){const u=a[l];s.push(this._getWGSLStructBinding(l,u.snippets.join(`,
`),"uniform",u.index,u.id))}let o=r.join(`
`);return o+=i.join(`
`),o+=s.join(`
`),o}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const r=e[t];r.uniforms=this.getUniforms(t),r.attributes=this.getAttributes(t),r.varyings=this.getVaryings(t),r.structs=this.getStructs(t),r.vars=this.getVars(t),r.codes=this.getCodes(t),r.directives=this.getDirectives(t),r.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const s=this.flowNodes[t],a=s[s.length-1],o=a.outputNode,l=o!==void 0&&o.isOutputStructNode===!0;for(const u of s){const h=this.getFlowData(u),p=u.name;if(p&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${p}
`),i+=`${h.code}
	`,u===a&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${h.result};`;else if(t==="fragment")if(l)r.returnType=o.getNodeType(this),r.structs+="var<private> output : "+r.returnType+";",i+=`return ${h.result};`;else{let m="	@location(0) color: vec4<f32>";const g=this.getBuiltins("output");g&&(m+=`,
	`+g),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",m),r.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${h.result};

	return output;`}}}r.flow=i}this.shaderStage=null,this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let r;return t!==null&&(r=this._getWGSLMethod(e+"_"+t)),r===void 0&&(r=this._getWGSLMethod(e)),r||e}getType(e){return wle[e]||e}isAvailable(e){let t=iP[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),iP[e]=t),t}_getWGSLMethod(e){return ds[e]!==void 0&&this._include(e),jf[e]}_include(e){const t=ds[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${Rj}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,r,i=0,s=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}
@binding( ${i} ) @group( ${s} )
var<${r}> ${e} : ${a};`}}class Tle{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=ae.Depth24PlusStencil8:e.depth&&(t=ae.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,a=s.getRenderTarget();t=a?a.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const r=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:r?1:t,isMSAA:r}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return td.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return td.LineList;if(e.isLine)return td.LineStrip;if(e.isMesh)return td.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===Hn)return ae.BGRA8Unorm;if(e===Cr)return ae.RGBA16Float;throw new Error("Unsupported outputType")}}const Pj=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&Pj.set(Float16Array,["float16"]);const Nle=new Map([[U3,["float16"]]]),Ele=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class Mle{constructor(e){this.backend=e}createAttribute(e,t){const r=this._getBufferAttribute(e),i=this.backend,s=i.get(r);let a=s.buffer;if(a===void 0){const o=i.device;let l=r.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let p=0;p<l.length;p++)l[p]===65535&&(l[p]=4294967295)}if(r.array=l,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&r.itemSize===3){l=new l.constructor(r.count*4);for(let p=0;p<r.count;p++)l.set(r.array.subarray(p*3,p*3+3),p*4);r.itemSize=4,r.array=l,s._force3to4BytesAlignment=!0}const u=l.byteLength,h=u+(4-u%4)%4;a=o.createBuffer({label:r.name,size:h,usage:t,mappedAtCreation:!0}),new l.constructor(a.getMappedRange()).set(l),a.unmap(),s.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),r=this.backend,i=r.device,s=r.get(t),a=r.get(t).buffer;let o=t.array;if(s._force3to4BytesAlignment===!0){o=new o.constructor(t.count*4);for(let h=0;h<t.count;h++)o.set(t.array.subarray(h*3,h*3+3),h*4);t.array=o}const l=this._isTypedArray(o),u=t.updateRanges;if(u.length===0)i.queue.writeBuffer(a,0,o,0);else{const h=l?1:o.BYTES_PER_ELEMENT;for(let p=0,m=u.length;p<m;p++){const g=u[p];let y,b;if(s._force3to4BytesAlignment===!0){const x=Math.floor(g.start/3),N=Math.ceil(g.count/3);y=x*4*h,b=N*4*h}else y=g.start*h,b=g.count*h;const _=y*(l?o.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(a,_,o,y,b)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),r=new Map;for(let i=0;i<t.length;i++){const s=t[i],a=s.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(s);let l=r.get(o);if(l===void 0){let p,m;s.isInterleavedBufferAttribute===!0?(p=s.data.stride*a,m=s.data.isInstancedInterleavedBuffer?g0.Instance:g0.Vertex):(p=s.itemSize*a,m=s.isInstancedBufferAttribute?g0.Instance:g0.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(p=4),l={arrayStride:p,attributes:[],stepMode:m},r.set(o,l)}const u=this._getVertexFormat(s),h=s.isInterleavedBufferAttribute===!0?s.offset*a:0;l.attributes.push({shaderLocation:i,offset:h,format:u})}return Array.from(r.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,r=t.device,s=t.get(this._getBufferAttribute(e)).buffer,a=s.size,o=r.createBuffer({label:`${e.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=r.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(s,0,o,0,a);const u=l.finish();r.queue.submit([u]),await o.mapAsync(GPUMapMode.READ);const h=o.getMappedRange(),p=new e.array.constructor(h.slice(0));return o.unmap(),p.buffer}_getVertexFormat(e){const{itemSize:t,normalized:r}=e,i=e.array.constructor,s=e.constructor;let a;if(t===1)a=Ele.get(i);else{const l=(Nle.get(s)||Pj.get(i))[r?1:0];if(l){const u=i.BYTES_PER_ELEMENT*t,p=Math.floor((u+3)/4)*4/i.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${l}x${p}`}}return a||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),a}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Cle{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,r=t.device,i=[];let s=0;for(const a of e.bindings){const o={binding:s++,visibility:a.visibility};if(a.isUniformBuffer||a.isStorageBuffer){const l={};a.isStorageBuffer&&(a.visibility&4&&(a.access===io.READ_WRITE||a.access===io.WRITE_ONLY)?l.type=aw.Storage:l.type=aw.ReadOnlyStorage),o.buffer=l}else if(a.isSampler){const l={};a.texture.isDepthTexture&&(a.texture.compareFunction!==null?l.type=eP.Comparison:t.compatibilityMode&&(l.type=eP.NonFiltering)),o.sampler=l}else if(a.isSampledTexture&&a.texture.isVideoTexture)o.externalTexture={};else if(a.isSampledTexture&&a.store){const l={};l.format=this.backend.get(a.texture).texture.format;const u=a.access;u===io.READ_WRITE?l.access=ow.ReadWrite:u===io.WRITE_ONLY?l.access=ow.WriteOnly:l.access=ow.ReadOnly,a.texture.isArrayTexture?l.viewDimension=sr.TwoDArray:a.texture.is3DTexture&&(l.viewDimension=sr.ThreeD),o.storageTexture=l}else if(a.isSampledTexture){const l={},{primarySamples:u}=t.utils.getTextureSampleData(a.texture);if(u>1&&(l.multisampled=!0,a.texture.isDepthTexture||(l.sampleType=Ql.UnfilterableFloat)),a.texture.isDepthTexture)t.compatibilityMode&&a.texture.compareFunction===null?l.sampleType=Ql.UnfilterableFloat:l.sampleType=Ql.Depth;else if(a.texture.isDataTexture||a.texture.isDataArrayTexture||a.texture.isData3DTexture){const h=a.texture.type;h===Er?l.sampleType=Ql.SInt:h===En?l.sampleType=Ql.UInt:h===Zn&&(this.backend.hasFeature("float32-filterable")?l.sampleType=Ql.Float:l.sampleType=Ql.UnfilterableFloat)}a.isSampledCubeTexture?l.viewDimension=sr.Cube:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?l.viewDimension=sr.TwoDArray:a.isSampledTexture3D&&(l.viewDimension=sr.ThreeD),o.texture=l}else console.error(`WebGPUBindingUtils: Unsupported binding "${a}".`);i.push(o)}return r.createBindGroupLayout({entries:i})}createBindings(e,t,r,i=0){const{backend:s,bindGroupLayoutCache:a}=this,o=s.get(e);let l=a.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),a.set(e.bindingsReference,l));let u;r>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[r]===i&&(u=o.groups[r])),u===void 0&&(u=this.createBindGroup(e,l),r>0&&(o.groups[r]=u,o.versions[r]=i)),o.group=u,o.layout=l}updateBinding(e){const t=this.backend,r=t.device,i=e.buffer,s=t.get(e).buffer;r.queue.writeBuffer(s,0,i,0)}createBindGroupIndex(e,t){const i=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=e[0],o=i.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:s});i.queue.writeBuffer(o,0,e,0);const l=[{binding:0,resource:{buffer:o}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:t,entries:l})}createBindGroup(e,t){const r=this.backend,i=r.device;let s=0;const a=[];for(const o of e.bindings){if(o.isUniformBuffer){const l=r.get(o);if(l.buffer===void 0){const u=o.byteLength,h=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=i.createBuffer({label:"bindingBuffer_"+o.name,size:u,usage:h});l.buffer=p}a.push({binding:s,resource:{buffer:l.buffer}})}else if(o.isStorageBuffer){const l=r.get(o);if(l.buffer===void 0){const u=o.attribute;l.buffer=r.get(u).buffer}a.push({binding:s,resource:{buffer:l.buffer}})}else if(o.isSampler){const l=r.get(o.texture);a.push({binding:s,resource:l.sampler})}else if(o.isSampledTexture){const l=r.get(o.texture);let u;if(l.externalTexture!==void 0)u=i.importExternalTexture({source:l.externalTexture});else{const h=o.store?1:l.texture.mipLevelCount,p=`view-${l.texture.width}-${l.texture.height}-${h}`;if(u=l[p],u===void 0){const m=sle.All;let g;o.isSampledCubeTexture?g=sr.Cube:o.isSampledTexture3D?g=sr.ThreeD:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?g=sr.TwoDArray:g=sr.TwoD,u=l[p]=l.texture.createView({aspect:m,dimension:g,mipLevelCount:h})}}a.push({binding:s,resource:u})}s++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}}class Ale{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:r,material:i,geometry:s,pipeline:a}=e,{vertexProgram:o,fragmentProgram:l}=a,u=this.backend,h=u.device,p=u.utils,m=u.get(a),g=[];for(const $ of e.getBindings()){const U=u.get($);g.push(U.layout)}const y=u.attributeUtils.createShaderVertexBuffers(e);let b;i.blending!==Ri&&(i.blending!==Yi||i.transparent!==!1)&&(b=this._getBlending(i));let _={};i.stencilWrite===!0&&(_={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const x=this._getColorWriteMask(i),N=[];if(e.context.textures!==null){const $=e.context.textures;for(let U=0;U<$.length;U++){const K=p.getTextureFormatGPU($[U]);N.push({format:K,blend:b,writeMask:x})}}else{const $=p.getCurrentColorFormat(e.context);N.push({format:$,blend:b,writeMask:x})}const T=u.get(o).module,S=u.get(l).module,M=this._getPrimitiveState(r,s,i),C=this._getDepthCompare(i),R=p.getCurrentDepthStencilFormat(e.context),F=this._getSampleCount(e.context),k={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},T,{buffers:y}),fragment:Object.assign({},S,{targets:N}),primitive:M,multisample:{count:F,alphaToCoverageEnabled:i.alphaToCoverage&&F>1},layout:h.createPipelineLayout({bindGroupLayouts:g})},D={},P=e.context.depth,G=e.context.stencil;if((P===!0||G===!0)&&(P===!0&&(D.format=R,D.depthWriteEnabled=i.depthWrite,D.depthCompare=C),G===!0&&(D.stencilFront=_,D.stencilBack={},D.stencilReadMask=i.stencilFuncMask,D.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(D.depthBias=i.polygonOffsetUnits,D.depthBiasSlopeScale=i.polygonOffsetFactor,D.depthBiasClamp=0),k.depthStencil=D),t===null)m.pipeline=h.createRenderPipeline(k);else{const $=new Promise(U=>{h.createRenderPipelineAsync(k).then(K=>{m.pipeline=K,U()})});t.push($)}}createBundleEncoder(e,t="renderBundleEncoder"){const r=this.backend,{utils:i,device:s}=r,a=i.getCurrentDepthStencilFormat(e),o=i.getCurrentColorFormat(e),l=this._getSampleCount(e),u={label:t,colorFormats:[o],depthStencilFormat:a,sampleCount:l};return s.createRenderBundleEncoder(u)}createComputePipeline(e,t){const r=this.backend,i=r.device,s=r.get(e.computeProgram).module,a=r.get(e),o=[];for(const l of t){const u=r.get(l);o.push(u.layout)}a.pipeline=i.createComputePipeline({compute:s,layout:i.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,r;const i=e.blending,s=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(i===ad){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,u=e.blendDstAlpha!==null?e.blendDstAlpha:a,h=e.blendEquationAlpha!==null?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},r={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(h)}}else{const l=e.premultipliedAlpha,u=(h,p,m,g)=>{t={srcFactor:h,dstFactor:p,operation:Zl.Add},r={srcFactor:m,dstFactor:g,operation:Zl.Add}};if(l)switch(i){case Yi:u(en.One,en.OneMinusSrcAlpha,en.One,en.OneMinusSrcAlpha);break;case yd:u(en.One,en.One,en.One,en.One);break;case vd:u(en.Zero,en.OneMinusSrc,en.Zero,en.One);break;case _d:u(en.Dst,en.OneMinusSrcAlpha,en.Zero,en.One);break}else switch(i){case Yi:u(en.SrcAlpha,en.OneMinusSrcAlpha,en.One,en.OneMinusSrcAlpha);break;case yd:u(en.SrcAlpha,en.One,en.One,en.One);break;case vd:console.error("THREE.WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case _d:console.error("THREE.WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&r!==void 0)return{color:t,alpha:r};console.error("THREE.WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case Wa:t=en.Zero;break;case S1:t=en.One;break;case T1:t=en.Src;break;case N1:t=en.OneMinusSrc;break;case lp:t=en.SrcAlpha;break;case cp:t=en.OneMinusSrcAlpha;break;case C1:t=en.Dst;break;case A1:t=en.OneMinusDst;break;case E1:t=en.DstAlpha;break;case M1:t=en.OneMinusDstAlpha;break;case R1:t=en.SrcAlphaSaturated;break;case mse:t=en.Constant;break;case gse:t=en.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const r=e.stencilFunc;switch(r){case I$:t=Ir.Never;break;case nS:t=Ir.Always;break;case j$:t=Ir.Less;break;case O$:t=Ir.LessEqual;break;case F$:t=Ir.Equal;break;case z$:t=Ir.GreaterEqual;break;case U$:t=Ir.Greater;break;case B$:t=Ir.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",r)}return t}_getStencilOperation(e){let t;switch(e){case tc:t=el.Keep;break;case C$:t=el.Zero;break;case A$:t=el.Replace;break;case D$:t=el.Invert;break;case R$:t=el.IncrementClamp;break;case P$:t=el.DecrementClamp;break;case k$:t=el.IncrementWrap;break;case L$:t=el.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case Kr:t=Zl.Add;break;case b1:t=Zl.Subtract;break;case w1:t=Zl.ReverseSubtract;break;case E3:t=Zl.Min;break;case M3:t=Zl.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,r){const i={},s=this.backend.utils;switch(i.topology=s.getPrimitiveTopology(e,r),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?Wd.Uint16:Wd.Uint32),r.side){case Ai:i.frontFace=rw.CCW,i.cullMode=iw.Back;break;case bn:i.frontFace=rw.CCW,i.cullMode=iw.Front;break;case Yr:i.frontFace=rw.CCW,i.cullMode=iw.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",r.side);break}return i}_getColorWriteMask(e){return e.colorWrite===!0?JR.All:JR.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Ir.Always;else{const r=e.depthFunc;switch(r){case up:t=Ir.Never;break;case dp:t=Ir.Always;break;case hp:t=Ir.Less;break;case yl:t=Ir.LessEqual;break;case fp:t=Ir.Equal;break;case pp:t=Ir.GreaterEqual;break;case mp:t=Ir.Greater;break;case gp:t=Ir.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",r)}}return t}}class Rle extends Aj{constructor(e,t,r=2048){super(r),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return Ji(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,r=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,r);const s=i.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,r),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,r));let o=0;for(const[,l]of e){const u=a[l],h=a[l+1],p=Number(h-u)/1e6;o+=p}return this.resultBuffer.unmap(),this.lastValue=o,o}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Ple extends Cj{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new Tle(this),this.attributeUtils=new Mle(this),this.bindingUtils=new Cle(this),this.pipelineUtils=new Ale(this),this.textureUtils=new ple(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let r;if(t.device===void 0){const a={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},o=typeof navigator<"u"?await navigator.gpu.requestAdapter(a):null;if(o===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const l=Object.values(MS),u=[];for(const p of l)o.features.has(p)&&u.push(p);const h={requiredFeatures:u,requiredLimits:t.requiredLimits};r=await o.requestDevice(h)}else r=t.device;r.lost.then(a=>{const o={api:"WebGPU",message:a.message||"Unknown reason",reason:a.reason||null,originalEvent:a};e.onDeviceLost(o)});const i=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=r,this.context=i;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(MS.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return vl}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const r=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(r.depth,r.stencil).createView()});const i=e.colorAttachments[0];this.renderer.samples>0?i.view=this.colorBuffer.createView():i.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const r=e.renderTarget,i=this.get(r);let s=i.descriptors;if(s===void 0||i.width!==r.width||i.height!==r.height||i.dimensions!==r.dimensions||i.activeMipmapLevel!==e.activeMipmapLevel||i.activeCubeFace!==e.activeCubeFace||i.samples!==r.samples){s={},i.descriptors=s;const u=()=>{r.removeEventListener("dispose",u),this.delete(r)};r.hasEventListener("dispose",u)===!1&&r.addEventListener("dispose",u)}const a=e.getCacheKey();let o=s[a];if(o===void 0){const u=e.textures,h=[];let p;const m=this._isRenderCameraDepthArray(e);for(let g=0;g<u.length;g++){const y=this.get(u[g]),b={label:`colorAttachment_${g}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:sr.TwoD};if(r.isRenderTarget3D)p=e.activeCubeFace,b.baseArrayLayer=0,b.dimension=sr.ThreeD,b.depthOrArrayLayers=u[g].image.depth;else if(r.isRenderTarget&&u[g].image.depth>1)if(m===!0){const _=e.camera.cameras;for(let x=0;x<_.length;x++){const N={...b,baseArrayLayer:x,arrayLayerCount:1,dimension:sr.TwoD},T=y.texture.createView(N);h.push({view:T,resolveTarget:void 0,depthSlice:void 0})}}else b.dimension=sr.TwoDArray,b.depthOrArrayLayers=u[g].image.depth;if(m!==!0){const _=y.texture.createView(b);let x,N;y.msaaTexture!==void 0?(x=y.msaaTexture.createView(),N=_):(x=_,N=void 0),h.push({view:x,resolveTarget:N,depthSlice:p})}}if(o={textureViews:h},e.depth){const g=this.get(e.depthTexture),y={};e.depthTexture.isArrayTexture&&(y.dimension=sr.TwoD,y.arrayLayerCount=1,y.baseArrayLayer=e.activeCubeFace),o.depthStencilView=g.texture.createView(y)}s[a]=o,i.width=r.width,i.height=r.height,i.samples=r.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace,i.dimensions=r.dimensions}const l={colorAttachments:[]};for(let u=0;u<o.textureViews.length;u++){const h=o.textureViews[u];let p={r:0,g:0,b:0,a:1};u===0&&t.clearValue&&(p=t.clearValue),l.colorAttachments.push({view:h.view,depthSlice:h.depthSlice,resolveTarget:h.resolveTarget,loadOp:t.loadOp||dn.Load,storeOp:t.storeOp||oi.Store,clearValue:p})}return o.depthStencilView&&(l.depthStencilAttachment={view:o.depthStencilView}),l}beginRender(e){const t=this.get(e),r=this.device,i=e.occlusionQueryCount;let s;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=r.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let a;e.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(e,{loadOp:dn.Load}),this.initTimestampQuery(e,a),a.occlusionQuerySet=s;const o=a.depthStencilAttachment;if(e.textures!==null){const u=a.colorAttachments;for(let h=0;h<u.length;h++){const p=u[h];e.clearColor?(p.clearValue=h===0?e.clearColorValue:{r:0,g:0,b:0,a:1},p.loadOp=dn.Clear):p.loadOp=dn.Load,p.storeOp=oi.Store}}else{const u=a.colorAttachments[0];e.clearColor?(u.clearValue=e.clearColorValue,u.loadOp=dn.Clear):u.loadOp=dn.Load,u.storeOp=oi.Store}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=dn.Clear):o.depthLoadOp=dn.Load,o.depthStoreOp=oi.Store),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=dn.Clear):o.stencilLoadOp=dn.Load,o.stencilStoreOp=oi.Store);const l=r.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const u=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==u.length?this._createDepthLayerDescriptors(e,t,a,u):this._updateDepthLayerDescriptors(e,t,u),t.bundleEncoders=[],t.bundleSets=[];for(let h=0;h<u.length;h++){const p=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+h),m={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(p),t.bundleSets.push(m)}t.currentPass=null}else{const u=l.beginRenderPass(a);if(t.currentPass=u,e.viewport&&this.updateViewport(e),e.scissor){const{x:h,y:p,width:m,height:g}=e.scissorValue;u.setScissorRect(h,p,m,g)}}t.descriptor=a,t.encoder=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,r,i){const s=r.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let o=0;o<i.length;o++){const l={...r,colorAttachments:[{...r.colorAttachments[0],view:r.colorAttachments[o].view}]};if(r.depthStencilAttachment){const u=o;a.viewCache[u]||(a.viewCache[u]=a.texture.createView({dimension:sr.TwoD,baseArrayLayer:o,arrayLayerCount:1})),l.depthStencilAttachment={view:a.viewCache[u],depthLoadOp:s.depthLoadOp||dn.Clear,depthStoreOp:s.depthStoreOp||oi.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(l.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,l.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,l.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else l.depthStencilAttachment={...s};t.layerDescriptors.push(l)}}_updateDepthLayerDescriptors(e,t,r){for(let i=0;i<r.length;i++){const s=t.layerDescriptors[i];if(s.depthStencilAttachment){const a=s.depthStencilAttachment;e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=dn.Clear):a.depthLoadOp=dn.Load),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=dn.Clear):a.stencilLoadOp=dn.Load)}}}finishRender(e){const t=this.get(e),r=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),r>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const i=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let a=0;a<t.bundleEncoders.length;a++){const o=t.bundleEncoders[a];s.push(o.finish())}for(let a=0;a<t.layerDescriptors.length;a++)if(a<s.length){const o=t.layerDescriptors[a],l=i.beginRenderPass(o);if(e.viewport){const{x:u,y:h,width:p,height:m,minDepth:g,maxDepth:y}=e.viewportValue;l.setViewport(u,h,p,m,g,y)}if(e.scissor){const{x:u,y:h,width:p,height:m}=e.scissorValue;l.setScissorRect(u,h,p,m)}l.executeBundles([s[a]]),l.end()}}else t.currentPass&&t.currentPass.end();if(r>0){const s=r*8;let a=this.occludedResolveCache.get(s);a===void 0&&(a=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,a));const o=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,r,a,0),t.encoder.copyBufferToBuffer(a,0,o,0,s),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let a=0;a<s.length;a++){const o=s[a];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const a=r.getMappedRange(),o=new BigUint64Array(a);for(let l=0;l<i.length;l++)o[l]===BigInt(0)&&s.add(i[l]);r.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:a,minDepth:o,maxDepth:l}=e.viewportValue;t.setViewport(r,i,s,a,o,l)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,r,i=null){const s=this.device,a=this.renderer;let o=[],l,u,h,p;if(e){const y=this.getClearColor();u={r:y.r,g:y.g,b:y.b,a:y.a}}if(i===null){h=a.depth,p=a.stencil;const y=this._getDefaultRenderPassDescriptor();if(e){o=y.colorAttachments;const b=o[0];b.clearValue=u,b.loadOp=dn.Clear,b.storeOp=oi.Store}(h||p)&&(l=y.depthStencilAttachment)}else{h=i.depth,p=i.stencil;const y={loadOp:e?dn.Clear:dn.Load,clearValue:e?u:void 0};h&&(y.depthLoadOp=t?dn.Clear:dn.Load,y.depthClearValue=t?a.getClearDepth():void 0,y.depthStoreOp=oi.Store),p&&(y.stencilLoadOp=r?dn.Clear:dn.Load,y.stencilClearValue=r?a.getClearStencil():void 0,y.stencilStoreOp=oi.Store);const b=this._getRenderPassDescriptor(i,y);o=b.colorAttachments,l=b.depthStencilAttachment}h&&l&&l.depthLoadOp===void 0&&(t?(l.depthLoadOp=dn.Clear,l.depthClearValue=a.getClearDepth(),l.depthStoreOp=oi.Store):(l.depthLoadOp=dn.Load,l.depthStoreOp=oi.Store)),p&&l&&l.stencilLoadOp===void 0&&(r?(l.stencilLoadOp=dn.Clear,l.stencilClearValue=a.getClearStencil(),l.stencilStoreOp=oi.Store):(l.stencilLoadOp=dn.Load,l.stencilStoreOp=oi.Store));const m=s.createCommandEncoder({label:"clear"});m.beginRenderPass({colorAttachments:o,depthStencilAttachment:l}).end(),s.queue.submit([m.finish()])}beginCompute(e){const t=this.get(e),r={label:"computeGroup_"+e.id};this.initTimestampQuery(e,r),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(r)}compute(e,t,r,i){const{passEncoderGPU:s}=this.get(e),a=this.get(i).pipeline;this.pipelineUtils.setPipeline(s,a);for(let h=0,p=r.length;h<p;h++){const m=r[h],g=this.get(m);s.setBindGroup(h,g.group)}const o=this.device.limits.maxComputeWorkgroupsPerDimension,l=this.get(t);l.dispatchSize===void 0&&(l.dispatchSize={x:0,y:1,z:1});const{dispatchSize:u}=l;t.dispatchCount>o?(u.x=Math.min(t.dispatchCount,o),u.y=Math.ceil(t.dispatchCount/o)):u.x=t.dispatchCount,s.dispatchWorkgroups(u.x,u.y,u.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:r,material:i,context:s,pipeline:a}=e,o=e.getBindings(),l=this.get(s),u=this.get(a).pipeline,h=e.getIndex(),p=h!==null,m=e.getDrawParameters();if(m===null)return;const g=(b,_)=>{this.pipelineUtils.setPipeline(b,u),_.pipeline=u;const x=_.bindingGroups;for(let T=0,S=o.length;T<S;T++){const M=o[T],C=this.get(M);x[M.index]!==M.id&&(b.setBindGroup(M.index,C.group),x[M.index]=M.id)}if(p===!0&&_.index!==h){const T=this.get(h).buffer,S=h.array instanceof Uint16Array?Wd.Uint16:Wd.Uint32;b.setIndexBuffer(T,S),_.index=h}const N=e.getVertexBuffers();for(let T=0,S=N.length;T<S;T++){const M=N[T];if(_.attributes[T]!==M){const C=this.get(M).buffer;b.setVertexBuffer(T,C),_.attributes[T]=M}}s.stencil===!0&&i.stencilWrite===!0&&l.currentStencilRef!==i.stencilRef&&(b.setStencilReference(i.stencilRef),l.currentStencilRef=i.stencilRef)},y=(b,_)=>{if(g(b,_),r.isBatchedMesh===!0){const x=r._multiDrawStarts,N=r._multiDrawCounts,T=r._multiDrawCount,S=r._multiDrawInstances;S!==null&&Ji("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let M=0;M<T;M++){const C=S?S[M]:1,R=C>1?0:M;p===!0?b.drawIndexed(N[M],C,x[M]/h.array.BYTES_PER_ELEMENT,0,R):b.draw(N[M],C,x[M],R),t.update(r,N[M],C)}}else if(p===!0){const{vertexCount:x,instanceCount:N,firstVertex:T}=m,S=e.getIndirect();if(S!==null){const M=this.get(S).buffer;b.drawIndexedIndirect(M,0)}else b.drawIndexed(x,N,T,0,0);t.update(r,x,N)}else{const{vertexCount:x,instanceCount:N,firstVertex:T}=m,S=e.getIndirect();if(S!==null){const M=this.get(S).buffer;b.drawIndirect(M,0)}else b.draw(x,N,T,0);t.update(r,x,N)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const b=this.get(e.camera),_=e.camera.cameras,x=e.getBindingGroup("cameraIndex");if(b.indexesGPU===void 0||b.indexesGPU.length!==_.length){const T=this.get(x),S=[],M=new Uint32Array([0,0,0,0]);for(let C=0,R=_.length;C<R;C++){M[0]=C;const F=this.bindingUtils.createBindGroupIndex(M,T.layout);S.push(F)}b.indexesGPU=S}const N=this.renderer.getPixelRatio();for(let T=0,S=_.length;T<S;T++){const M=_[T];if(r.layers.test(M.layers)){const C=M.viewport;let R=l.currentPass,F=l.currentSets;if(l.bundleEncoders){const k=l.bundleEncoders[T],D=l.bundleSets[T];R=k,F=D}C&&R.setViewport(Math.floor(C.x*N),Math.floor(C.y*N),Math.floor(C.width*N),Math.floor(C.height*N),s.viewportValue.minDepth,s.viewportValue.maxDepth),x&&b.indexesGPU&&(R.setBindGroup(x.index,b.indexesGPU[T]),F.bindingGroups[x.index]=x.id),y(R,F)}}}else if(l.currentPass){if(l.occlusionQuerySet!==void 0){const b=l.lastOcclusionObject;b!==r&&(b!==null&&b.occlusionTest===!0&&(l.currentPass.endOcclusionQuery(),l.occlusionQueryIndex++),r.occlusionTest===!0&&(l.currentPass.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=r),l.lastOcclusionObject=r)}y(l.currentPass,l.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:r,material:i}=e,s=this.utils,a=s.getSampleCountRenderContext(e.context),o=s.getCurrentColorSpace(e.context),l=s.getCurrentColorFormat(e.context),u=s.getCurrentDepthStencilFormat(e.context),h=s.getPrimitiveTopology(r,i);let p=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==o||t.colorFormat!==l||t.depthStencilFormat!==u||t.primitiveTopology!==h||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=l,t.depthStencilFormat=u,t.primitiveTopology=h,t.clippingContextCacheKey=e.clippingContextCacheKey,p=!0),p}getRenderCacheKey(e){const{object:t,material:r}=e,i=this.utils,s=e.context;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,i.getSampleCountRenderContext(s),i.getCurrentColorSpace(s),i.getCurrentColorFormat(s),i.getCurrentDepthStencilFormat(s),i.getPrimitiveTopology(t,r),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,r,i,s,a){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,a)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const r=e.isComputeNode?"compute":"render";this.timestampQueryPool[r]||(this.timestampQueryPool[r]=new Rle(this.device,r,2048));const i=this.timestampQueryPool[r],s=i.allocateQueriesForContext(e);t.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new Sle(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const r=this.get(e),s=r.currentPass.finish();this.get(t).bundleGPU=s,r.currentSets=r._currentSets,r.currentPass=r._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,a=0){let o=0,l=0,u=0,h=0,p=0,m=0,g=e.image.width,y=e.image.height,b=1;r!==null&&(r.isBox3===!0?(h=r.min.x,p=r.min.y,m=r.min.z,g=r.max.x-r.min.x,y=r.max.y-r.min.y,b=r.max.z-r.min.z):(h=r.min.x,p=r.min.y,g=r.max.x-r.min.x,y=r.max.y-r.min.y,b=1)),i!==null&&(o=i.x,l=i.y,u=i.z||0);const _=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),x=this.get(e).texture,N=this.get(t).texture;_.copyTextureToTexture({texture:x,mipLevel:s,origin:{x:h,y:p,z:m}},{texture:N,mipLevel:a,origin:{x:o,y:l,z:u}},[g,y,b]),this.device.queue.submit([_.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,r){const i=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const a=this.get(e).texture;if(s.format!==a.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,a.format);return}let o;if(i.currentPass?(i.currentPass.end(),o=i.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:s,origin:[r.x,r.y,0]},{texture:a},[r.z,r.w]),i.currentPass){const{descriptor:l}=i;for(let u=0;u<l.colorAttachments.length;u++)l.colorAttachments[u].loadOp=dn.Load;if(t.depth&&(l.depthStencilAttachment.depthLoadOp=dn.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=dn.Load),i.currentPass=o.beginRenderPass(l),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:h,width:p,height:m}=t.scissorValue;i.currentPass.setScissorRect(u,h,p,m)}}else this.device.queue.submit([o.finish()]);e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}}class kle extends iT{constructor(e,t,r,i,s,a){super(e,t,r,i,s,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Lle extends iT{constructor(e,t,r,i,s,a){super(e,t,r,i,s,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Dle extends bj{constructor(){super(),this.addMaterial(nie,"MeshPhongMaterial"),this.addMaterial(rj,"MeshStandardMaterial"),this.addMaterial(Yie,"MeshPhysicalMaterial"),this.addMaterial(Jie,"MeshToonMaterial"),this.addMaterial(Yre,"MeshBasicMaterial"),this.addMaterial(eie,"MeshLambertMaterial"),this.addMaterial(Hre,"MeshNormalMaterial"),this.addMaterial(nse,"MeshMatcapMaterial"),this.addMaterial(Ure,"LineBasicMaterial"),this.addMaterial(zre,"LineDashedMaterial"),this.addMaterial(ase,"PointsMaterial"),this.addMaterial(sj,"SpriteMaterial"),this.addMaterial(cse,"ShadowMaterial"),this.addLight(Oae,mW),this.addLight(doe,Y3),this.addLight(hoe,xW),this.addLight(BT,iT),this.addLight(goe,K3),this.addLight(xoe,hW),this.addLight(yoe,vW),this.addLight(foe,kle),this.addLight(moe,Lle),this.addToneMapping(Wse,R3),this.addToneMapping(qse,P3),this.addToneMapping(Xse,k3),this.addToneMapping(Kse,L3),this.addToneMapping(eae,D3),this.addToneMapping(tae,I3)}}class Ile extends Foe{constructor(e={}){let t;e.forceWebGL?t=QR:(t=Ple,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new QR(e)));const r=new t(e);super(r,e),this.library=new Dle,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const lw={type:"change"},GT={type:"start"},HT={type:"end"},aP=1e-6,hn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},y0=new je,tl=new je,jle=new ee,v0=new ee,cw=new ee,zu=new Hs,oP=new ee,_0=new ee,uw=new ee,b0=new ee;class Fle extends Jx{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:jr.ROTATE,MIDDLE:jr.DOLLY,RIGHT:jr.PAN},this.target=new ee,this.state=hn.NONE,this.keyState=hn.NONE,this._lastPosition=new ee,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ee,this._movePrev=new je,this._moveCurr=new je,this._lastAxis=new ee,this._zoomStart=new je,this._zoomEnd=new je,this._panStart=new je,this._panEnd=new je,this._pointers=[],this._pointerPositions={},this._onPointerMove=Ule.bind(this),this._onPointerDown=Ole.bind(this),this._onPointerUp=Ble.bind(this),this._onPointerCancel=zle.bind(this),this._onContextMenu=Xle.bind(this),this._onMouseWheel=qle.bind(this),this._onKeyDown=Gle.bind(this),this._onKeyUp=Vle.bind(this),this._onTouchStart=Yle.bind(this),this._onTouchMove=Kle.bind(this),this._onTouchEnd=Zle.bind(this),this._onMouseDown=Hle.bind(this),this._onMouseMove=$le.bind(this),this._onMouseUp=Wle.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>aP&&(this.dispatchEvent(lw),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>aP||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(lw),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=hn.NONE,this.keyState=hn.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(lw),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(tl.copy(this._panEnd).sub(this._panStart),tl.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;tl.x*=e,tl.y*=t}tl.multiplyScalar(this._eye.length()*this.panSpeed),v0.copy(this._eye).cross(this.object.up).setLength(tl.x),v0.add(jle.copy(this.object.up).setLength(tl.y)),this.object.position.add(v0),this.target.add(v0),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(tl.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){b0.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=b0.length();e?(this._eye.copy(this.object.position).sub(this.target),oP.copy(this._eye).normalize(),_0.copy(this.object.up).normalize(),uw.crossVectors(_0,oP).normalize(),_0.setLength(this._moveCurr.y-this._movePrev.y),uw.setLength(this._moveCurr.x-this._movePrev.x),b0.copy(_0.add(uw)),cw.crossVectors(b0,this._eye).normalize(),e*=this.rotateSpeed,zu.setFromAxisAngle(cw,e),this._eye.applyQuaternion(zu),this.object.up.applyQuaternion(zu),this._lastAxis.copy(cw),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),zu.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(zu),this.object.up.applyQuaternion(zu)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===hn.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=ax.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=ax.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return y0.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),y0}_getMouseOnCircle(e,t){return y0.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),y0}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new je,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function Ole(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function Ule(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function Ble(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function zle(n){this._removePointer(n)}function Vle(){this.enabled!==!1&&(this.keyState=hn.NONE,window.addEventListener("keydown",this._onKeyDown))}function Gle(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===hn.NONE&&(n.code===this.keys[hn.ROTATE]&&!this.noRotate?this.keyState=hn.ROTATE:n.code===this.keys[hn.ZOOM]&&!this.noZoom?this.keyState=hn.ZOOM:n.code===this.keys[hn.PAN]&&!this.noPan&&(this.keyState=hn.PAN)))}function Hle(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case jr.DOLLY:this.state=hn.ZOOM;break;case jr.ROTATE:this.state=hn.ROTATE;break;case jr.PAN:this.state=hn.PAN;break;default:this.state=hn.NONE}const t=this.keyState!==hn.NONE?this.keyState:this.state;t===hn.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===hn.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===hn.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(GT)}function $le(n){const e=this.keyState!==hn.NONE?this.keyState:this.state;e===hn.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===hn.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===hn.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function Wle(){this.state=hn.NONE,this.dispatchEvent(HT)}function qle(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(GT),this.dispatchEvent(HT)}}function Xle(n){this.enabled!==!1&&n.preventDefault()}function Yle(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=hn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=hn.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const r=(this._pointers[0].pageX+this._pointers[1].pageX)/2,i=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(r,i)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(GT)}function Kle(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,r=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);const i=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,s));break}}function Zle(n){switch(this._pointers.length){case 0:this.state=hn.NONE;break;case 1:this.state=hn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=hn.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(HT)}const lP={type:"change"},$T={type:"start"},kj={type:"end"},w0=new Yx,cP=new js,Qle=Math.cos(70*ax.DEG2RAD),hr=new ee,Si=2*Math.PI,_n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},dw=1e-6;class Jle extends Jx{constructor(e,t=null){super(e,t),this.state=_n.NONE,this.target=new ee,this.cursor=new ee,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:jr.ROTATE,MIDDLE:jr.DOLLY,RIGHT:jr.PAN},this.touches={ONE:eo.ROTATE,TWO:eo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ee,this._lastQuaternion=new Hs,this._lastTargetPosition=new ee,this._quat=new Hs().setFromUnitVectors(e.up,new ee(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new pA,this._sphericalDelta=new pA,this._scale=1,this._panOffset=new ee,this._rotateStart=new je,this._rotateEnd=new je,this._rotateDelta=new je,this._panStart=new je,this._panEnd=new je,this._panDelta=new je,this._dollyStart=new je,this._dollyEnd=new je,this._dollyDelta=new je,this._dollyDirection=new ee,this._mouse=new je,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=tce.bind(this),this._onPointerDown=ece.bind(this),this._onPointerUp=nce.bind(this),this._onContextMenu=cce.bind(this),this._onMouseWheel=sce.bind(this),this._onKeyDown=ace.bind(this),this._onTouchStart=oce.bind(this),this._onTouchMove=lce.bind(this),this._onMouseDown=rce.bind(this),this._onMouseMove=ice.bind(this),this._interceptControlDown=uce.bind(this),this._interceptControlUp=dce.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(lP),this.update(),this.state=_n.NONE}update(e=null){const t=this.object.position;hr.copy(t).sub(this.target),hr.applyQuaternion(this._quat),this._spherical.setFromVector3(hr),this.autoRotate&&this.state===_n.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=Si:r>Math.PI&&(r-=Si),i<-Math.PI?i+=Si:i>Math.PI&&(i-=Si),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=a!=this._spherical.radius}if(hr.setFromSpherical(this._spherical),hr.applyQuaternion(this._quatInverse),t.copy(this.target).add(hr),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const o=hr.length();a=this._clampDistance(o*this._scale);const l=o-a;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const o=new ee(this._mouse.x,this._mouse.y,0);o.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const u=new ee(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(o),this.object.updateMatrixWorld(),a=hr.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(w0.origin.copy(this.object.position),w0.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(w0.direction))<Qle?this.object.lookAt(this.target):(cP.setFromNormalAndCoplanarPoint(this.object.up,this.target),w0.intersectPlane(cP,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>dw||8*(1-this._lastQuaternion.dot(this.object.quaternion))>dw||this._lastTargetPosition.distanceToSquared(this.target)>dw?(this.dispatchEvent(lP),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Si/60*this.autoRotateSpeed*e:Si/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){hr.setFromMatrixColumn(t,0),hr.multiplyScalar(-e),this._panOffset.add(hr)}_panUp(e,t){this.screenSpacePanning===!0?hr.setFromMatrixColumn(t,1):(hr.setFromMatrixColumn(t,0),hr.crossVectors(this.object.up,hr)),hr.multiplyScalar(e),this._panOffset.add(hr)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;hr.copy(i).sub(this.target);let s=hr.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/r.clientHeight,this.object.matrix),this._panUp(2*t*s/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,s=t-r.top,a=r.width,o=r.height;this._mouse.x=i/a*2-1,this._mouse.y=-(s/o)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Si*this._rotateDelta.x/t.clientHeight),this._rotateUp(Si*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Si*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Si*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Si*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Si*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),s=.5*(e.pageY+r.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Si*this._rotateDelta.x/t.clientHeight),this._rotateUp(Si*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+t.x)*.5,o=(e.pageY+t.y)*.5;this._updateZoomParameters(a,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new je,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function ece(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function tce(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function nce(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(kj),this.state=_n.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function rce(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case jr.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=_n.DOLLY;break;case jr.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=_n.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=_n.ROTATE}break;case jr.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=_n.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=_n.PAN}break;default:this.state=_n.NONE}this.state!==_n.NONE&&this.dispatchEvent($T)}function ice(n){switch(this.state){case _n.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case _n.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case _n.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function sce(n){this.enabled===!1||this.enableZoom===!1||this.state!==_n.NONE||(n.preventDefault(),this.dispatchEvent($T),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(kj))}function ace(n){this.enabled!==!1&&this._handleKeyDown(n)}function oce(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case eo.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=_n.TOUCH_ROTATE;break;case eo.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=_n.TOUCH_PAN;break;default:this.state=_n.NONE}break;case 2:switch(this.touches.TWO){case eo.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=_n.TOUCH_DOLLY_PAN;break;case eo.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=_n.TOUCH_DOLLY_ROTATE;break;default:this.state=_n.NONE}break;default:this.state=_n.NONE}this.state!==_n.NONE&&this.dispatchEvent($T)}function lce(n){switch(this._trackPointer(n),this.state){case _n.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case _n.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case _n.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case _n.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=_n.NONE}}function cce(n){this.enabled!==!1&&n.preventDefault()}function uce(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function dce(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const hce={type:"change"},uP=1e-6,dP=new Hs;class fce extends Jx{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new ee(0,0,0),this._rotationVector=new ee(0,0,0),this._lastQuaternion=new Hs,this._lastPosition=new ee,this._status=0,this._onKeyDown=pce.bind(this),this._onKeyUp=mce.bind(this),this._onPointerMove=xce.bind(this),this._onPointerDown=gce.bind(this),this._onPointerUp=yce.bind(this),this._onPointerCancel=vce.bind(this),this._onContextMenu=_ce.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,r=e*this.movementSpeed,i=e*this.rollSpeed;t.translateX(this._moveVector.x*r),t.translateY(this._moveVector.y*r),t.translateZ(this._moveVector.z*r),dP.set(this._rotationVector.x*i,this._rotationVector.y*i,this._rotationVector.z*i,1).normalize(),t.quaternion.multiply(dP),(this._lastPosition.distanceToSquared(t.position)>uP||8*(1-this._lastQuaternion.dot(t.quaternion))>uP)&&(this.dispatchEvent(hce),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function pce(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function mce(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function gce(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function xce(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function yce(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function vce(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function _ce(n){this.enabled!==!1&&n.preventDefault()}const bce={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class xy{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const wce=new tm(-1,1,1,-1,0,1);class Sce extends ei{constructor(){super(),this.setAttribute("position",new tr([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new tr([0,2,0,0,2,0],2))}}const Tce=new Sce;class Nce{constructor(e){this._mesh=new Xn(Tce,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,wce)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Ece extends xy{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof va?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=z3.clone(e.uniforms),this.material=new va({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new Nce(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class hP extends xy{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,o;this.inverse?(a=0,o=1):(a=1,o=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),s.buffers.stencil.setClear(o),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class Mce extends xy{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Cce{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new je);this._width=r.width,this._height=r.height,t=new _l(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Cr}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Ece(bce),this.copyPass.material.blending=Ri,this.clock=new Q3}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const a=this.passes[i];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),a.needsSwap){if(r){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}hP!==void 0&&(a instanceof hP?r=!0:a instanceof Mce&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new je);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Ace extends xy{constructor(e,t,r=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new vt}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let s,a;this.overrideMaterial!==null&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=a),e.autoClear=i}}function Di(){return Di=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Di.apply(null,arguments)}function Rce(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Dp(n,e){return Dp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Dp(n,e)}function Pce(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Dp(n,e)}function AS(n){return AS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},AS(n)}function kce(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function Lj(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lj=function(){return!!n})()}function Lce(n,e,t){if(Lj())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return t&&Dp(i,t.prototype),i}function RS(n){var e=typeof Map=="function"?new Map:void 0;return RS=function(r){if(r===null||!kce(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return Lce(r,arguments,AS(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Dp(i,r)},RS(n)}var la=function(n){Pce(e,n);function e(t){var r;return r=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,Rce(r)}return e}(RS(Error));function hw(n){return Math.round(n*255)}function Dce(n,e,t){return hw(n)+","+hw(e)+","+hw(t)}function wx(n,e,t,r){if(r===void 0&&(r=Dce),e===0)return r(t,t,t);var i=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,a=s*(1-Math.abs(i%2-1)),o=0,l=0,u=0;i>=0&&i<1?(o=s,l=a):i>=1&&i<2?(o=a,l=s):i>=2&&i<3?(l=s,u=a):i>=3&&i<4?(l=a,u=s):i>=4&&i<5?(o=a,u=s):i>=5&&i<6&&(o=s,u=a);var h=t-s/2,p=o+h,m=l+h,g=u+h;return r(p,m,g)}var fP={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function Ice(n){if(typeof n!="string")return n;var e=n.toLowerCase();return fP[e]?"#"+fP[e]:n}var jce=/^#[a-fA-F0-9]{6}$/,Fce=/^#[a-fA-F0-9]{8}$/,Oce=/^#[a-fA-F0-9]{3}$/,Uce=/^#[a-fA-F0-9]{4}$/,fw=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Bce=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,zce=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Vce=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function qd(n){if(typeof n!="string")throw new la(3);var e=Ice(n);if(e.match(jce))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(Fce)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(Oce))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(Uce)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=fw.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=Bce.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var a=zce.exec(e);if(a){var o=parseInt(""+a[1],10),l=parseInt(""+a[2],10)/100,u=parseInt(""+a[3],10)/100,h="rgb("+wx(o,l,u)+")",p=fw.exec(h);if(!p)throw new la(4,e,h);return{red:parseInt(""+p[1],10),green:parseInt(""+p[2],10),blue:parseInt(""+p[3],10)}}var m=Vce.exec(e.substring(0,50));if(m){var g=parseInt(""+m[1],10),y=parseInt(""+m[2],10)/100,b=parseInt(""+m[3],10)/100,_="rgb("+wx(g,y,b)+")",x=fw.exec(_);if(!x)throw new la(4,e,_);return{red:parseInt(""+x[1],10),green:parseInt(""+x[2],10),blue:parseInt(""+x[3],10),alpha:parseFloat(""+m[4])>1?parseFloat(""+m[4])/100:parseFloat(""+m[4])}}throw new la(5)}function Gce(n){var e=n.red/255,t=n.green/255,r=n.blue/255,i=Math.max(e,t,r),s=Math.min(e,t,r),a=(i+s)/2;if(i===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:a,alpha:n.alpha}:{hue:0,saturation:0,lightness:a};var o,l=i-s,u=a>.5?l/(2-i-s):l/(i+s);switch(i){case e:o=(t-r)/l+(t<r?6:0);break;case t:o=(r-e)/l+2;break;default:o=(e-t)/l+4;break}return o*=60,n.alpha!==void 0?{hue:o,saturation:u,lightness:a,alpha:n.alpha}:{hue:o,saturation:u,lightness:a}}function Cl(n){return Gce(qd(n))}var Hce=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},PS=Hce;function sc(n){var e=n.toString(16);return e.length===1?"0"+e:e}function pw(n){return sc(Math.round(n*255))}function $ce(n,e,t){return PS("#"+pw(n)+pw(e)+pw(t))}function Dj(n,e,t){return wx(n,e,t,$ce)}function Wce(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return Dj(n.hue,n.saturation,n.lightness);throw new la(1)}function qce(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?Dj(n.hue,n.saturation,n.lightness):"rgba("+wx(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new la(2)}function Ij(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return PS("#"+sc(n)+sc(e)+sc(t));if(typeof n=="object"&&e===void 0&&t===void 0)return PS("#"+sc(n.red)+sc(n.green)+sc(n.blue));throw new la(6)}function yy(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?Ij(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new la(7)}var Xce=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},Yce=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},Kce=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},Zce=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function Al(n){if(typeof n!="object")throw new la(8);if(Yce(n))return yy(n);if(Xce(n))return Ij(n);if(Zce(n))return qce(n);if(Kce(n))return Wce(n);throw new la(8)}function jj(n,e,t){return function(){var i=t.concat(Array.prototype.slice.call(arguments));return i.length>=e?n.apply(this,i):jj(n,e,i)}}function ts(n){return jj(n,n.length,[])}function Qce(n,e){if(e==="transparent")return e;var t=Cl(e);return Al(Di({},t,{hue:t.hue+parseFloat(n)}))}ts(Qce);function dh(n,e,t){return Math.max(n,Math.min(e,t))}function Jce(n,e){if(e==="transparent")return e;var t=Cl(e);return Al(Di({},t,{lightness:dh(0,1,t.lightness-parseFloat(n))}))}ts(Jce);function eue(n,e){if(e==="transparent")return e;var t=Cl(e);return Al(Di({},t,{saturation:dh(0,1,t.saturation-parseFloat(n))}))}ts(eue);function tue(n,e){if(e==="transparent")return e;var t=Cl(e);return Al(Di({},t,{lightness:dh(0,1,t.lightness+parseFloat(n))}))}ts(tue);function nue(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var r=qd(e),i=Di({},r,{alpha:typeof r.alpha=="number"?r.alpha:1}),s=qd(t),a=Di({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),o=i.alpha-a.alpha,l=parseFloat(n)*2-1,u=l*o===-1?l:l+o,h=1+l*o,p=(u/h+1)/2,m=1-p,g={red:Math.floor(i.red*p+a.red*m),green:Math.floor(i.green*p+a.green*m),blue:Math.floor(i.blue*p+a.blue*m),alpha:i.alpha*parseFloat(n)+a.alpha*(1-parseFloat(n))};return yy(g)}var rue=ts(nue),Fj=rue;function iue(n,e){if(e==="transparent")return e;var t=qd(e),r=typeof t.alpha=="number"?t.alpha:1,i=Di({},t,{alpha:dh(0,1,(r*100+parseFloat(n)*100)/100)});return yy(i)}var sue=ts(iue),aue=sue;function oue(n,e){if(e==="transparent")return e;var t=Cl(e);return Al(Di({},t,{saturation:dh(0,1,t.saturation+parseFloat(n))}))}ts(oue);function lue(n,e){return e==="transparent"?e:Al(Di({},Cl(e),{hue:parseFloat(n)}))}ts(lue);function cue(n,e){return e==="transparent"?e:Al(Di({},Cl(e),{lightness:parseFloat(n)}))}ts(cue);function uue(n,e){return e==="transparent"?e:Al(Di({},Cl(e),{saturation:parseFloat(n)}))}ts(uue);function due(n,e){return e==="transparent"?e:Fj(parseFloat(n),"rgb(0, 0, 0)",e)}ts(due);function hue(n,e){return e==="transparent"?e:Fj(parseFloat(n),"rgb(255, 255, 255)",e)}ts(hue);function fue(n,e){if(e==="transparent")return e;var t=qd(e),r=typeof t.alpha=="number"?t.alpha:1,i=Di({},t,{alpha:dh(0,1,+(r*100-parseFloat(n)*100).toFixed(2)/100)});return yy(i)}ts(fue);var wc=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-wc.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?wc.Bounce.In(n*2)*.5:wc.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Ff=function(){return performance.now()},Oj=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=Ff()),t===void 0&&(t=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var s=this._tweens[r[i]],a=!t;s&&s.update(e,a)===!1&&!t&&delete this._tweens[r[i]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),kS={Linear:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=kS.Utils.Linear;return e<0?s(n[0],n[1],r):e>1?s(n[t],n[t-1],t-r):s(n[i],n[i+1>t?t:i+1],r-i)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},Uj=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),LS=new Oj,pP=function(){function n(e,t){t===void 0&&(t=LS),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=wc.Linear.None,this._interpolationFunction=kS.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Uj.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Ff()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var s in this._valuesEnd)i[s]=this._valuesEnd[s];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,i,s){for(var a in r){var o=e[a],l=Array.isArray(o),u=l?"array":typeof o,h=!l&&Array.isArray(r[a]);if(!(u==="undefined"||u==="function")){if(h){var p=r[a];if(p.length===0)continue;for(var m=[o],g=0,y=p.length;g<y;g+=1){var b=this._handleRelativeValue(o,p[g]);if(isNaN(b)){h=!1,console.warn("Found invalid interpolation list. Skipping.");break}m.push(b)}h&&(r[a]=m)}if((u==="object"||l)&&o&&!h){t[a]=l?[]:{};var _=o;for(var x in _)t[a][x]=_[x];i[a]=l?[]:{};var p=r[a];if(!this._isDynamic){var N={};for(var x in p)N[x]=p[x];r[a]=p=N}this._setupProperties(_,t[a],p,i[a],s)}else(typeof t[a]>"u"||s)&&(t[a]=o),l||(t[a]*=1),h?i[a]=r[a].slice().reverse():i[a]=t[a]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=Ff()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=Ff()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=LS),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=wc.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=kS.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,i;if(e===void 0&&(e=Ff()),t===void 0&&(t=!0),this._isPaused)return!0;var s,a=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>a)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,l=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),u=this._duration+this._repeat*l,h=function(){if(r._duration===0||o>u)return 1;var _=Math.trunc(o/l),x=o-_*l,N=Math.min(x/r._duration,1);return N===0&&o===r._duration?1:N},p=h(),m=this._easingFunction(p);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,m),this._onUpdateCallback&&this._onUpdateCallback(this._object,p),this._duration===0||o>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((o-this._duration)/l)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var y=0,b=this._chainedTweens.length;y<b;y++)this._chainedTweens[y].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,i){for(var s in r)if(t[s]!==void 0){var a=t[s]||0,o=r[s],l=Array.isArray(e[s]),u=Array.isArray(o),h=!l&&u;h?e[s]=this._interpolationFunction(o,i):typeof o=="object"&&o?this._updateProperties(e[s],a,o,i):(o=this._handleRelativeValue(a,o),typeof o=="number"&&(e[s]=a+(o-a)*i))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n}();Uj.nextId;var wa=LS;wa.getAll.bind(wa);wa.removeAll.bind(wa);wa.add.bind(wa);wa.remove.bind(wa);wa.update.bind(wa);var am,Un,Bj,zj,dc,mP,Vj,Gj,Hj,WT,DS,IS,Ip={},$j=[],pue=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,vy=Array.isArray;function ca(n,e){for(var t in e)n[t]=e[t];return n}function qT(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function mue(n,e,t){var r,i,s,a={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:a[s]=e[s];if(arguments.length>2&&(a.children=arguments.length>3?am.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)a[s]===void 0&&(a[s]=n.defaultProps[s]);return Yf(n,a,r,i,null)}function Yf(n,e,t,r,i){var s={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Bj,__i:-1,__u:0};return i==null&&Un.vnode!=null&&Un.vnode(s),s}function _y(n){return n.children}function H0(n,e){this.props=n,this.context=e}function Xd(n,e){if(e==null)return n.__?Xd(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?Xd(n):null}function Wj(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return Wj(n)}}function gP(n){(!n.__d&&(n.__d=!0)&&dc.push(n)&&!Sx.__r++||mP!=Un.debounceRendering)&&((mP=Un.debounceRendering)||Vj)(Sx)}function Sx(){for(var n,e,t,r,i,s,a,o=1;dc.length;)dc.length>o&&dc.sort(Gj),n=dc.shift(),o=dc.length,n.__d&&(t=void 0,i=(r=(e=n).__v).__e,s=[],a=[],e.__P&&((t=ca({},r)).__v=r.__v+1,Un.vnode&&Un.vnode(t),XT(e.__P,t,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??Xd(r),!!(32&r.__u),a),t.__v=r.__v,t.__.__k[t.__i]=t,Yj(s,t,a),t.__e!=i&&Wj(t)));Sx.__r=0}function qj(n,e,t,r,i,s,a,o,l,u,h){var p,m,g,y,b,_,x=r&&r.__k||$j,N=e.length;for(l=gue(t,e,x,l,N),p=0;p<N;p++)(g=t.__k[p])!=null&&(m=g.__i==-1?Ip:x[g.__i]||Ip,g.__i=p,_=XT(n,g,m,i,s,a,o,l,u,h),y=g.__e,g.ref&&m.ref!=g.ref&&(m.ref&&YT(m.ref,null,g),h.push(g.ref,g.__c||y,g)),b==null&&y!=null&&(b=y),4&g.__u||m.__k===g.__k?l=Xj(g,l,n):typeof g.type=="function"&&_!==void 0?l=_:y&&(l=y.nextSibling),g.__u&=-7);return t.__e=b,l}function gue(n,e,t,r,i){var s,a,o,l,u,h=t.length,p=h,m=0;for(n.__k=new Array(i),s=0;s<i;s++)(a=e[s])!=null&&typeof a!="boolean"&&typeof a!="function"?(l=s+m,(a=n.__k[s]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?Yf(null,a,null,null,null):vy(a)?Yf(_y,{children:a},null,null,null):a.constructor==null&&a.__b>0?Yf(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=n,a.__b=n.__b+1,o=null,(u=a.__i=xue(a,t,l,p))!=-1&&(p--,(o=t[u])&&(o.__u|=2)),o==null||o.__v==null?(u==-1&&(i>h?m--:i<h&&m++),typeof a.type!="function"&&(a.__u|=4)):u!=l&&(u==l-1?m--:u==l+1?m++:(u>l?m--:m++,a.__u|=4))):n.__k[s]=null;if(p)for(s=0;s<h;s++)(o=t[s])!=null&&(2&o.__u)==0&&(o.__e==r&&(r=Xd(o)),Zj(o,o));return r}function Xj(n,e,t){var r,i;if(typeof n.type=="function"){for(r=n.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=n,e=Xj(r[i],e,t));return e}n.__e!=e&&(e&&n.type&&!t.contains(e)&&(e=Xd(n)),t.insertBefore(n.__e,e||null),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function xue(n,e,t,r){var i,s,a,o=n.key,l=n.type,u=e[t],h=u!=null&&(2&u.__u)==0;if(u===null&&n.key==null||h&&o==u.key&&l==u.type)return t;if(r>(h?1:0)){for(i=t-1,s=t+1;i>=0||s<e.length;)if((u=e[a=i>=0?i--:s++])!=null&&(2&u.__u)==0&&o==u.key&&l==u.type)return a}return-1}function xP(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||pue.test(e)?t:t+"px"}function S0(n,e,t,r,i){var s,a;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||xP(n.style,e,"");if(t)for(e in t)r&&t[e]==r[e]||xP(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(Hj,"$1")),a=e.toLowerCase(),e=a in n||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?r?t.u=r.u:(t.u=WT,n.addEventListener(e,s?IS:DS,s)):n.removeEventListener(e,s?IS:DS,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function yP(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=WT++;else if(e.t<t.u)return;return t(Un.event?Un.event(e):e)}}}function XT(n,e,t,r,i,s,a,o,l,u){var h,p,m,g,y,b,_,x,N,T,S,M,C,R,F,k,D,P=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),s=[o=e.__e=t.__e]),(h=Un.__b)&&h(e);e:if(typeof P=="function")try{if(x=e.props,N="prototype"in P&&P.prototype.render,T=(h=P.contextType)&&r[h.__c],S=h?T?T.props.value:h.__:r,t.__c?_=(p=e.__c=t.__c).__=p.__E:(N?e.__c=p=new P(x,S):(e.__c=p=new H0(x,S),p.constructor=P,p.render=vue),T&&T.sub(p),p.props=x,p.state||(p.state={}),p.context=S,p.__n=r,m=p.__d=!0,p.__h=[],p._sb=[]),N&&p.__s==null&&(p.__s=p.state),N&&P.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=ca({},p.__s)),ca(p.__s,P.getDerivedStateFromProps(x,p.__s))),g=p.props,y=p.state,p.__v=e,m)N&&P.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),N&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(N&&P.getDerivedStateFromProps==null&&x!==g&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(x,S),!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(x,p.__s,S)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(p.props=x,p.state=p.__s,p.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(G){G&&(G.__=e)}),M=0;M<p._sb.length;M++)p.__h.push(p._sb[M]);p._sb=[],p.__h.length&&a.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(x,p.__s,S),N&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(g,y,b)})}if(p.context=S,p.props=x,p.__P=n,p.__e=!1,C=Un.__r,R=0,N){for(p.state=p.__s,p.__d=!1,C&&C(e),h=p.render(p.props,p.state,p.context),F=0;F<p._sb.length;F++)p.__h.push(p._sb[F]);p._sb=[]}else do p.__d=!1,C&&C(e),h=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++R<25);p.state=p.__s,p.getChildContext!=null&&(r=ca(ca({},r),p.getChildContext())),N&&!m&&p.getSnapshotBeforeUpdate!=null&&(b=p.getSnapshotBeforeUpdate(g,y)),k=h,h!=null&&h.type===_y&&h.key==null&&(k=Kj(h.props.children)),o=qj(n,vy(k)?k:[k],e,t,r,i,s,a,o,l,u),p.base=e.__e,e.__u&=-161,p.__h.length&&a.push(p),_&&(p.__E=p.__=null)}catch(G){if(e.__v=null,l||s!=null)if(G.then){for(e.__u|=l?160:128;o&&o.nodeType==8&&o.nextSibling;)o=o.nextSibling;s[s.indexOf(o)]=null,e.__e=o}else{for(D=s.length;D--;)qT(s[D]);jS(e)}else e.__e=t.__e,e.__k=t.__k,G.then||jS(e);Un.__e(G,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):o=e.__e=yue(t.__e,e,t,r,i,s,a,l,u);return(h=Un.diffed)&&h(e),128&e.__u?void 0:o}function jS(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(jS)}function Yj(n,e,t){for(var r=0;r<t.length;r++)YT(t[r],t[++r],t[++r]);Un.__c&&Un.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(s){s.call(i)})}catch(s){Un.__e(s,i.__v)}})}function Kj(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:vy(n)?n.map(Kj):ca({},n)}function yue(n,e,t,r,i,s,a,o,l){var u,h,p,m,g,y,b,_=t.props,x=e.props,N=e.type;if(N=="svg"?i="http://www.w3.org/2000/svg":N=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(u=0;u<s.length;u++)if((g=s[u])&&"setAttribute"in g==!!N&&(N?g.localName==N:g.nodeType==3)){n=g,s[u]=null;break}}if(n==null){if(N==null)return document.createTextNode(x);n=document.createElementNS(i,N,x.is&&x),o&&(Un.__m&&Un.__m(e,s),o=!1),s=null}if(N==null)_===x||o&&n.data==x||(n.data=x);else{if(s=s&&am.call(n.childNodes),_=t.props||Ip,!o&&s!=null)for(_={},u=0;u<n.attributes.length;u++)_[(g=n.attributes[u]).name]=g.value;for(u in _)if(g=_[u],u!="children"){if(u=="dangerouslySetInnerHTML")p=g;else if(!(u in x)){if(u=="value"&&"defaultValue"in x||u=="checked"&&"defaultChecked"in x)continue;S0(n,u,null,g,i)}}for(u in x)g=x[u],u=="children"?m=g:u=="dangerouslySetInnerHTML"?h=g:u=="value"?y=g:u=="checked"?b=g:o&&typeof g!="function"||_[u]===g||S0(n,u,g,_[u],i);if(h)o||p&&(h.__html==p.__html||h.__html==n.innerHTML)||(n.innerHTML=h.__html),e.__k=[];else if(p&&(n.innerHTML=""),qj(e.type=="template"?n.content:n,vy(m)?m:[m],e,t,r,N=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,a,s?s[0]:t.__k&&Xd(t,0),o,l),s!=null)for(u=s.length;u--;)qT(s[u]);o||(u="value",N=="progress"&&y==null?n.removeAttribute("value"):y!=null&&(y!==n[u]||N=="progress"&&!y||N=="option"&&y!=_[u])&&S0(n,u,y,_[u],i),u="checked",b!=null&&b!=n[u]&&S0(n,u,b,_[u],i))}return n}function YT(n,e,t){try{if(typeof n=="function"){var r=typeof n.__u=="function";r&&n.__u(),r&&e==null||(n.__u=n(e))}else n.current=e}catch(i){Un.__e(i,t)}}function Zj(n,e,t){var r,i;if(Un.unmount&&Un.unmount(n),(r=n.ref)&&(r.current&&r.current!=n.__e||YT(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){Un.__e(s,e)}r.base=r.__P=null}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&Zj(r[i],e,t||typeof n.type!="function");t||qT(n.__e),n.__c=n.__=n.__e=void 0}function vue(n,e,t){return this.constructor(n,t)}function _ue(n,e,t){var r,i,s,a;e==document&&(e=document.documentElement),Un.__&&Un.__(n,e),i=(r=!1)?null:e.__k,s=[],a=[],XT(e,n=e.__k=mue(_y,null,[n]),i||Ip,Ip,e.namespaceURI,i?null:e.firstChild?am.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,a),Yj(s,n,a)}function Qj(n,e,t){var r,i,s,a,o=ca({},n.props);for(s in n.type&&n.type.defaultProps&&(a=n.type.defaultProps),e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s]===void 0&&a!=null?a[s]:e[s];return arguments.length>2&&(o.children=arguments.length>3?am.call(arguments,2):t),Yf(n.type,o,r||n.key,i||n.ref,null)}am=$j.slice,Un={__e:function(n,e,t,r){for(var i,s,a;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(n)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),a=i.__d),a)return i.__E=i}catch(o){n=o}throw n}},Bj=0,zj=function(n){return n!=null&&n.constructor==null},H0.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ca({},this.state),typeof n=="function"&&(n=n(ca({},t),this.props)),n&&ca(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),gP(this))},H0.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),gP(this))},H0.prototype.render=_y,dc=[],Vj=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Gj=function(n,e){return n.__v.__b-e.__v.__b},Sx.__r=0,Hj=/(PointerCapture)$|Capture$/i,WT=0,DS=yP(!1),IS=yP(!0);function vP(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function bue(n){if(Array.isArray(n))return n}function wue(n,e,t){return(e=Cue(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Sue(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(h){u=!0,i=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}function Tue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _P(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Nue(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_P(Object(t),!0).forEach(function(r){wue(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_P(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Eue(n,e){return bue(n)||Sue(n,e)||Aue(n,e)||Tue()}function Mue(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Cue(n){var e=Mue(n,"string");return typeof e=="symbol"?e:e+""}function Tx(n){"@babel/helpers - typeof";return Tx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tx(n)}function Aue(n,e){if(n){if(typeof n=="string")return vP(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?vP(n,e):void 0}}var FS=function(e){if(Tx(e)!=="object")return e;var t=Qj(e);if(t.props){var r;t.props=Nue({},t.props),t!=null&&(r=t.props)!==null&&r!==void 0&&r.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(FS):FS(t.props.children))}return t},Rue=function(e){return zj(Qj(e))},Pue=function(e,t){delete t.__k,_ue(FS(e),t)};function kue(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var Lue=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;kue(Lue);var Due=ty({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.style,s=i===void 0?{}:i,a=!!e&&Tx(e)==="object"&&!!e.node&&typeof e.node=="function",o=qi(a?e.node():e);o.style("position")==="static"&&o.style("position","relative"),t.tooltipEl=o.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(u){var h=Eue(u,2),p=h[0],m=h[1];return t.tooltipEl.style(p,m)}),t.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,o.on("mousemove.".concat(l),function(u){t.mouseInside=!0;var h=us(u),p=o.node(),m=p.offsetWidth,g=p.offsetHeight,y=[t.offsetX===null||t.offsetX===void 0?"-".concat(h[0]/m*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?g>130&&g-h[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",h[0]+"px").style("top",h[1]+"px").style("transform","translate(".concat(y.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),o.on("mouseover.".concat(l),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),o.on("mouseout.".concat(l),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):Rue(e.content)?(e.tooltipEl.text(""),Pue(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function Iue(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var jue=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;Iue(jue);function OS(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function Fue(n){if(Array.isArray(n))return n}function Oue(n){if(Array.isArray(n))return OS(n)}function Uue(n,e,t){return(e=Wue(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Bue(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function zue(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,a,o=[],l=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(l=(r=s.call(t)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(h){u=!0,i=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}function Vue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hue(n,e){return Fue(n)||zue(n,e)||Jj(n,e)||Vue()}function Jl(n){return Oue(n)||Bue(n)||Jj(n)||Gue()}function $ue(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Wue(n){var e=$ue(n,"string");return typeof e=="symbol"?e:e+""}function Jj(n,e){if(n){if(typeof n=="string")return OS(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?OS(n,e):void 0}}var Fn=window.THREE?window.THREE:{WebGLRenderer:rK,Scene:Kx,PerspectiveCamera:Mr,Raycaster:J3,SRGBColorSpace:li,TextureLoader:dW,Vector2:je,Vector3:ee,Box3:kc,Color:vt,Mesh:Xn,SphereGeometry:ih,MeshBasicMaterial:Us,BackSide:bn,Clock:Q3},eF=ty({props:{width:{default:window.innerWidth,onChange:function(e,t,r){isNaN(e)&&(t.width=r)}},height:{default:window.innerHeight,onChange:function(e,t,r){isNaN(e)&&(t.height=r)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(a){return a.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var r=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(a,o){return e.hoverOrderComparator(a.object,o.object)});var s=i.find(function(a){return e.hoverFilter(a.object)})||null;r=s?s.object:null,e.intersection=s||null}r!==e.hoverObj&&(e.onHover(r,e.hoverObj,e.intersection),e.tooltip.content(r&&tn(e.tooltipContent)(r,e.intersection)||null),e.hoverObj=r)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,r=t.x,i=t.y;return{x:r,y:i}},cameraPosition:function(e,t,r,i){var s=e.camera;if(t&&e.initialised){var a=t,o=r||{x:0,y:0,z:0};if(!i)h(a),p(o);else{var l=Object.assign({},s.position),u=m();e.tweenGroup.add(new pP(l).to(a,i).easing(wc.Quadratic.Out).onUpdate(h).start()),e.tweenGroup.add(new pP(u).to(o,i/3).easing(wc.Quadratic.Out).onUpdate(p).start())}return this}return Object.assign({},s.position,{lookAt:m()});function h(g){var y=g.x,b=g.y,_=g.z;y!==void 0&&(s.position.x=y),b!==void 0&&(s.position.y=b),_!==void 0&&(s.position.z=_)}function p(g){var y=new Fn.Vector3(g.x,g.y,g.z);e.controls.enabled&&e.controls.target?e.controls.target=y:s.lookAt(y)}function m(){return Object.assign(new Fn.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,i=arguments.length,s=new Array(i>3?i-3:0),a=3;a<i;a++)s[a-3]=arguments[a];return this.fitToBbox(this.getBbox.apply(this,s),t,r)},fitToBbox:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var a=new Fn.Vector3(0,0,0),o=Math.max.apply(Math,Jl(Object.entries(t).map(function(g){var y=Hue(g,2),b=y[0],_=y[1];return Math.max.apply(Math,Jl(_.map(function(x){return Math.abs(a[b]-x)})))})))*2,l=(1-i*2/e.height)*s.fov,u=o/Math.atan(l*Math.PI/180),h=u/s.aspect,p=Math.max(u,h);if(p>0){var m=a.clone().sub(s.position).normalize().multiplyScalar(-p);this.cameraPosition(m,a,r)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},r=new Fn.Box3(new Fn.Vector3(0,0,0),new Fn.Vector3(0,0,0)),i=e.objects.filter(t);return i.length?(i.forEach(function(s){return r.expandByObject(s)}),Object.assign.apply(Object,Jl(["x","y","z"].map(function(s){return Uue({},s,[r.min[s],r.max[s]])})))):null},getScreenCoords:function(e,t,r,i){var s=new Fn.Vector3(t,r,i);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new Fn.Vector2(t/e.width*2-1,-(r/e.height)*2+1),a=new Fn.Raycaster;return a.setFromCamera(s,e.camera),Object.assign({},a.ray.at(i,new Fn.Vector3))},intersectingObjects:function(e,t,r){var i=new Fn.Vector2(t/e.width*2-1,-(r/e.height)*2+1),s=new Fn.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(i,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Fn.Scene,camera:new Fn.PerspectiveCamera,clock:new Fn.Clock,tweenGroup:new Oj,lastRaycasterCheck:0}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.controlType,s=i===void 0?"trackball":i,a=r.useWebGPU,o=a===void 0?!1:a,l=r.rendererConfig,u=l===void 0?{}:l,h=r.extraRenderers,p=h===void 0?[]:h,m=r.waitForLoadComplete,g=m===void 0?!0:m;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new Due(t.container),t.pointerPos=new Fn.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(y){return t.container.addEventListener(y,function(b){if(y==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&b.type==="pointermove"&&(b.pressure>0||t.isPointerPressed)&&(b.pointerType==="mouse"||b.movementX===void 0||[b.movementX,b.movementY].some(function(N){return Math.abs(N)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var _=x(t.container);t.pointerPos.x=b.pageX-_.left,t.pointerPos.y=b.pageY-_.top}function x(N){var T=N.getBoundingClientRect(),S=window.pageXOffset||document.documentElement.scrollLeft,M=window.pageYOffset||document.documentElement.scrollTop;return{top:T.top+M,left:T.left+S}}},{passive:!0})}),t.container.addEventListener("pointerup",function(y){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){y.button===0&&t.onClick(t.hoverObj||null,y,t.intersection),y.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,y,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(y){t.onRightClick&&y.preventDefault()}),t.renderer=new(o?Ile:Fn.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},u)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=p,t.extraRenderers.forEach(function(y){y.domElement.style.position="absolute",y.domElement.style.top="0px",y.domElement.style.pointerEvents="none",t.container.appendChild(y.domElement)}),t.postProcessingComposer=new Cce(t.renderer),t.postProcessingComposer.addPass(new Ace(t.scene,t.camera)),t.controls=new{trackball:Fle,orbit:Jle,fly:fce}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Jl(t.extraRenderers)).forEach(function(y){return y.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Fn.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!g,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var r,i=e.width,s=e.height;e.container.style.width="".concat(i,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(Jl(e.extraRenderers)).forEach(function(g){return g.setSize(i,s)}),e.camera.aspect=i/s;var a=e.viewOffset.slice(0,2);a.some(function(g){return g})&&(r=e.camera).setViewOffset.apply(r,[i,s].concat(Jl(a),[i,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var o,l=e.width,u=e.height,h=e.viewOffset.slice(0,2);h.some(function(g){return g})?(o=e.camera).setViewOffset.apply(o,[l,u].concat(Jl(h),[l,u])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Fn.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var p=qd(e.backgroundColor).alpha;p===void 0&&(p=1),e.renderer.setClearColor(new Fn.Color(aue(1,e.backgroundColor)),p)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Fn.TextureLoader().load(e.backgroundImageUrl,function(g){g.colorSpace=Fn.SRGBColorSpace,e.skysphere.material=new Fn.MeshBasicMaterial({map:g,side:Fn.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&m()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&m())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(g){return e.scene.remove(g)}),e.lights.forEach(function(g){return e.scene.add(g)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(g){return e.scene.remove(g)}),e.objects.forEach(function(g){return e.scene.add(g)}));function m(){e.loadComplete=e.scene.visible=!0}}});function que(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var Xue=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;que(Xue);function US(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function Yue(n){if(Array.isArray(n))return US(n)}function om(n,e,t){return(e=Jue(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Kue(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Zue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function T0(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bP(Object(t),!0).forEach(function(r){om(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):bP(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function by(n){return Yue(n)||Kue(n)||ede(n)||Zue()}function Que(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Jue(n){var e=Que(n,"string");return typeof e=="symbol"?e:e+""}function ede(n,e){if(n){if(typeof n=="string")return US(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?US(n,e):void 0}}function tF(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(i){return{default:t[i](),onChange:function(a,o){o[n][i](a)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var a=s[n],o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];var h=a[i].apply(a,l);return h===a?this:h}}}}var mw=window.THREE?window.THREE:{AmbientLight:K3,DirectionalLight:Y3,REVISION:eh},tde=170,nF=tF("forceGraph",DD),nde=Object.assign.apply(Object,by(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","linkDirectionalParticleThreeObject","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(n){return om({},n,nF.linkProp(n))}))),rde=Object.assign.apply(Object,by(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(n){return om({},n,nF.linkMethod(n))}))),$0=tF("renderObjs",eF),ide=Object.assign.apply(Object,by(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(n){return om({},n,$0.linkProp(n))}))),sde=Object.assign.apply(Object,by(["lights","cameraPosition","postProcessingComposer"].map(function(n){return om({},n,$0.linkMethod(n))})).concat([{graph2ScreenCoords:$0.linkMethod("getScreenCoords"),screen2GraphCoords:$0.linkMethod("getSceneCoords")}])),ade=ty({props:T0(T0({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var r=t.renderObjs.controls();r&&(r.enabled=e,e&&r.domElement&&r.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},nde),ide),methods:T0(T0({zoomToFit:function(e,t,r){for(var i,s=arguments.length,a=new Array(s>3?s-3:0),o=3;o<s;o++)a[o-3]=arguments[o];return e.renderObjs.fitToBbox((i=e.forceGraph).getGraphBbox.apply(i,a),t,r),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},rde),sde),stateInit:function(e){var t=e.controlType,r=e.rendererConfig,i=e.extraRenderers,s=new DD;return{forceGraph:s,renderObjs:eF({controlType:t,rendererConfig:r,extraRenderers:i}).objects([s]).lights([new mw.AmbientLight(13421772,Math.PI),new mw.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var r=document.createElement("div");t.container.appendChild(r),t.renderObjs(r);var i=t.renderObjs.camera(),s=t.renderObjs.renderer(),a=t.renderObjs.controls();a.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=i.position.z;var o;t.container.appendChild(o=document.createElement("div")),o.className="graph-info-msg",o.textContent="",t.forceGraph.onLoading(function(){o.textContent="Loading..."}).onFinishLoading(function(){o.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),i.position.x===0&&i.position.y===0&&i.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(i.lookAt(t.forceGraph.position),t.lastSetCameraZ=i.position.z=Math.cbrt(t.graphData.nodes.length)*tde)}).onFinishUpdate(function(){if(t._dragControls){var l=t.graphData.nodes.find(function(h){return h.__initialFixedPos&&!h.__disposeControlsAfterDrag});l?l.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var u=t._dragControls=new iK(t.graphData.nodes.map(function(h){return h.__threeObj}).filter(function(h){return h}),i,s.domElement);u.addEventListener("dragstart",function(h){var p=$a(h.object);if(p){a.enabled=!1,h.object.__initialPos=h.object.position.clone(),h.object.__prevPos=h.object.position.clone();var m=p.__data;!m.__initialFixedPos&&(m.__initialFixedPos={fx:m.fx,fy:m.fy,fz:m.fz}),!m.__initialPos&&(m.__initialPos={x:m.x,y:m.y,z:m.z}),["x","y","z"].forEach(function(g){return m["f".concat(g)]=m[g]}),s.domElement.classList.add("grabbable")}}),u.addEventListener("drag",function(h){var p=$a(h.object);if(p){if(!h.object.hasOwnProperty("__graphObjType")){var m=h.object.__initialPos,g=h.object.__prevPos,y=h.object.position;p.position.add(y.clone().sub(g)),g.copy(y),y.copy(m)}var b=p.__data,_=p.position,x={x:_.x-b.x,y:_.y-b.y,z:_.z-b.z};["x","y","z"].forEach(function(N){return b["f".concat(N)]=b[N]=_[N]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),b.__dragged=!0,t.onNodeDrag(b,x)}}),u.addEventListener("dragend",function(h){var p=$a(h.object);if(p){delete h.object.__initialPos,delete h.object.__prevPos;var m=p.__data;m.__disposeControlsAfterDrag&&(u.dispose(),delete m.__disposeControlsAfterDrag);var g=m.__initialFixedPos,y=m.__initialPos,b={x:y.x-m.x,y:y.y-m.y,z:y.z-m.z};if(g&&(["x","y","z"].forEach(function(x){var N="f".concat(x);g[N]===void 0&&delete m[N]}),delete m.__initialFixedPos,delete m.__initialPos,m.__dragged&&(delete m.__dragged,t.onNodeDragEnd(m,b))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls){var _;a.enabled=!0,a._status&&((_=a._onPointerCancel)===null||_===void 0||_.call(a)),a.domElement&&a.domElement.ownerDocument&&a.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))}s.domElement.classList.remove("grabbable")}})}}),mw.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(l,u){var h=$a(l);if(!h)return 1;var p=$a(u);if(!p)return-1;var m=function(y){return y.__graphObjType==="node"};return m(p)-m(h)}).tooltipContent(function(l){var u=$a(l);return u&&tn(t["".concat(u.__graphObjType,"Label")])(u.__data)||""}).hoverDuringDrag(!1).onHover(function(l){var u=$a(l);if(u!==t.hoverObj){var h=t.hoverObj?t.hoverObj.__graphObjType:null,p=t.hoverObj?t.hoverObj.__data:null,m=u?u.__graphObjType:null,g=u?u.__data:null;if(h&&h!==m){var y=t["on".concat(h==="node"?"Node":"Link","Hover")];y&&y(null,p)}if(m){var b=t["on".concat(m==="node"?"Node":"Link","Hover")];b&&b(g,h===m?p:null)}s.domElement.classList[u&&t["on".concat(m==="node"?"Node":"Link","Click")]||!u&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=u}}).clickAfterDrag(!1).onClick(function(l,u){var h=$a(l);if(h){var p=t["on".concat(h.__graphObjType==="node"?"Node":"Link","Click")];p&&p(h.__data,u)}else t.onBackgroundClick&&t.onBackgroundClick(u)}).onRightClick(function(l,u){var h=$a(l);if(h){var p=t["on".concat(h.__graphObjType==="node"?"Node":"Link","RightClick")];p&&p(h.__data,u)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(u)}),this._animationCycle()}});function $a(n){for(var e=n;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var gw={exports:{}},xw,wP;function ode(){if(wP)return xw;wP=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return xw=n,xw}var yw,SP;function lde(){if(SP)return yw;SP=1;var n=ode();function e(){}function t(){}return t.resetWarningCache=e,yw=function(){function r(a,o,l,u,h,p){if(p!==n){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},yw}var TP;function cde(){return TP||(TP=1,gw.exports=lde()()),gw.exports}var ude=cde();const de=Kd(ude),wy={width:de.number,height:de.number,graphData:de.shape({nodes:de.arrayOf(de.object).isRequired,links:de.arrayOf(de.object).isRequired}),backgroundColor:de.string,nodeRelSize:de.number,nodeId:de.string,nodeLabel:de.oneOfType([de.string,de.func]),nodeVal:de.oneOfType([de.number,de.string,de.func]),nodeVisibility:de.oneOfType([de.bool,de.string,de.func]),nodeColor:de.oneOfType([de.string,de.func]),nodeAutoColorBy:de.oneOfType([de.string,de.func]),onNodeHover:de.func,onNodeClick:de.func,linkSource:de.string,linkTarget:de.string,linkLabel:de.oneOfType([de.string,de.func]),linkVisibility:de.oneOfType([de.bool,de.string,de.func]),linkColor:de.oneOfType([de.string,de.func]),linkAutoColorBy:de.oneOfType([de.string,de.func]),linkWidth:de.oneOfType([de.number,de.string,de.func]),linkCurvature:de.oneOfType([de.number,de.string,de.func]),linkDirectionalArrowLength:de.oneOfType([de.number,de.string,de.func]),linkDirectionalArrowColor:de.oneOfType([de.string,de.func]),linkDirectionalArrowRelPos:de.oneOfType([de.number,de.string,de.func]),linkDirectionalParticles:de.oneOfType([de.number,de.string,de.func]),linkDirectionalParticleSpeed:de.oneOfType([de.number,de.string,de.func]),linkDirectionalParticleOffset:de.oneOfType([de.number,de.string,de.func]),linkDirectionalParticleWidth:de.oneOfType([de.number,de.string,de.func]),linkDirectionalParticleColor:de.oneOfType([de.string,de.func]),onLinkHover:de.func,onLinkClick:de.func,dagMode:de.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:de.number,dagNodeFilter:de.func,onDagError:de.func,d3AlphaMin:de.number,d3AlphaDecay:de.number,d3VelocityDecay:de.number,warmupTicks:de.number,cooldownTicks:de.number,cooldownTime:de.number,onEngineTick:de.func,onEngineStop:de.func,getGraphBbox:de.func},rF={zoomToFit:de.func,onNodeRightClick:de.func,onNodeDrag:de.func,onNodeDragEnd:de.func,onLinkRightClick:de.func,linkHoverPrecision:de.number,onBackgroundClick:de.func,onBackgroundRightClick:de.func,enablePointerInteraction:de.bool,enableNodeDrag:de.bool},KT={showNavInfo:de.bool,nodeOpacity:de.number,nodeResolution:de.number,nodeThreeObject:de.oneOfType([de.object,de.string,de.func]),nodeThreeObjectExtend:de.oneOfType([de.bool,de.string,de.func]),nodePositionUpdate:de.func,linkOpacity:de.number,linkResolution:de.number,linkCurveRotation:de.oneOfType([de.number,de.string,de.func]),linkMaterial:de.oneOfType([de.object,de.string,de.func]),linkThreeObject:de.oneOfType([de.object,de.string,de.func]),linkThreeObjectExtend:de.oneOfType([de.bool,de.string,de.func]),linkPositionUpdate:de.func,linkDirectionalArrowResolution:de.number,linkDirectionalParticleResolution:de.number,linkDirectionalParticleThreeObject:de.oneOfType([de.object,de.string,de.func]),forceEngine:de.oneOf(["d3","ngraph"]),ngraphPhysics:de.object,numDimensions:de.oneOf([1,2,3])};Object.assign({},wy,rF,{linkLineDash:de.oneOfType([de.arrayOf(de.number),de.string,de.func]),nodeCanvasObjectMode:de.oneOfType([de.string,de.func]),nodeCanvasObject:de.func,nodePointerAreaPaint:de.func,linkCanvasObjectMode:de.oneOfType([de.string,de.func]),linkCanvasObject:de.func,linkPointerAreaPaint:de.func,linkDirectionalParticleCanvasObject:de.func,autoPauseRedraw:de.bool,minZoom:de.number,maxZoom:de.number,enableZoomInteraction:de.oneOfType([de.bool,de.func]),enablePanInteraction:de.oneOfType([de.bool,de.func]),onZoom:de.func,onZoomEnd:de.func,onRenderFramePre:de.func,onRenderFramePost:de.func});const dde=Object.assign({},wy,rF,KT,{enableNavigationControls:de.bool,controlType:de.oneOf(["trackball","orbit","fly"]),rendererConfig:de.object,extraRenderers:de.arrayOf(de.shape({render:de.func.isRequired}))});Object.assign({},wy,KT,{nodeDesc:de.oneOfType([de.string,de.func]),linkDesc:de.oneOfType([de.string,de.func])});Object.assign({},wy,KT,{markerAttrs:de.object,yOffset:de.number,glScale:de.number});const ZT=x$(ade,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});ZT.displayName="ForceGraph3D";ZT.propTypes=dde;const hde=({token:n,onBack:e})=>{const t=n1(),[r,i]=E.useState("overview"),[s,a]=E.useState([]),[o,l]=E.useState([]),[u,h]=E.useState(null),[p,m]=E.useState(!0),[g,y]=E.useState(""),[b,_]=E.useState([]),[x,N]=E.useState(!1),[T,S]=E.useState({title:"",content:"",content_type:"text",category:"general",tags:[],importance_score:.5}),[M,C]=E.useState("all"),[R,F]=E.useState("all"),k=E.useRef();E.useEffect(()=>{D()},[n]);const D=async()=>{m(!0);try{const[L,B,V]=await Promise.all([fetch("/api/knowledge/entries",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/knowledge/clusters",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/knowledge/graph",{headers:{Authorization:`Bearer ${n}`}})]),[z,Y,se]=await Promise.all([L.json(),B.json(),V.json()]);z.success&&a(z.entries),Y.success&&l(Y.clusters),se.success&&h(P(se.graph))}catch(L){console.error("Error loading knowledge data:",L),t.error("Failed to load knowledge data","Please check your connection and try again")}finally{m(!1)}},P=L=>{const B=[],V=[];return L.nodes.forEach(z=>{B.push({id:`entry_${z.id}`,name:z.title,val:z.importance_score*10+5,color:G(z.content_type),group:z.category,type:"entry"})}),o.forEach(z=>{B.push({id:`cluster_${z.id}`,name:z.name,val:z.size*2+10,color:z.color,group:"cluster",type:"cluster"})}),L.edges.forEach(z=>{V.push({source:`entry_${z.source_entry_id}`,target:`entry_${z.target_entry_id}`,value:z.strength*5})}),{nodes:B,links:V}},G=L=>({text:on.accentBlue,code:on.success,image:on.warning,document:on.accentPurple,link:on.danger})[L]||on.gray400,$=async()=>{if(g.trim()){N(!0);try{const B=await(await fetch("/api/knowledge/search",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({query:g,limit:20,threshold:.6})})).json();B.success?(_(B.results),t.success(`Found ${B.results.length} results`,`Search completed for "${g}"`)):t.error("Search failed",B.error||"Unable to complete search")}catch(L){console.error("Error searching knowledge:",L),t.error("Search error","Please check your connection and try again")}finally{N(!1)}}},U=async()=>{try{const B=await(await fetch("/api/knowledge/entries",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(T)})).json();B.success?(S({title:"",content:"",content_type:"text",category:"general",tags:[],importance_score:.5}),i("entries"),D(),t.success("Knowledge entry created",`Successfully added "${T.title}"`)):t.error("Failed to create entry",B.error||"Unable to save knowledge entry")}catch(L){console.error("Error creating knowledge entry:",L),t.error("Creation failed","Please check your connection and try again")}},K=s.filter(L=>{const B=M==="all"||L.category===M,V=R==="all"||L.content_type===R;return B&&V}),O=[...new Set(s.map(L=>L.category))],j=[...new Set(s.map(L=>L.content_type))];return p?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),c.jsx("p",{className:"text-white text-xl mt-4",children:"Loading Knowledge Hub..."})]})}):c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-6",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50",children:" Back"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gradient",children:" AI Knowledge Hub"}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Your personal Memory Palace - Discover, connect, and explore knowledge"})]})]}),c.jsx("div",{className:"flex items-center space-x-4",children:c.jsxs("button",{onClick:()=>i("create"),className:"px-4 py-2 bg-gradient-purple rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Add Knowledge"})]})})]})}),c.jsx("div",{className:"bg-gray-800 border-b border-gray-700",children:c.jsx("div",{className:"max-w-7xl mx-auto px-6",children:c.jsx("nav",{className:"flex space-x-8",children:[{id:"overview",name:"Overview",icon:""},{id:"graph",name:"3D Knowledge Graph",icon:""},{id:"search",name:"Semantic Search",icon:""},{id:"entries",name:"All Entries",icon:""},{id:"create",name:"Create Entry",icon:""},{id:"categories",name:"Categories",icon:""}].map(L=>c.jsxs("button",{onClick:()=>i(L.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${r===L.id?"border-purple-500 text-purple-400":"border-transparent text-gray-400 hover:text-white hover:border-gray-300"}`,children:[c.jsx("span",{className:"mr-2",children:L.icon}),L.name]},L.id))})})}),c.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[r==="overview"&&c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[c.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-blue-100",children:"Total Entries"}),c.jsx("p",{className:"text-2xl font-bold",children:s.length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-purple-100",children:"Knowledge Clusters"}),c.jsx("p",{className:"text-2xl font-bold",children:o.length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-green-100",children:"Categories"}),c.jsx("p",{className:"text-2xl font-bold",children:O.length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-orange-100",children:"Avg. Importance"}),c.jsxs("p",{className:"text-2xl font-bold",children:[s.length>0?(s.reduce((L,B)=>L+B.importance_score,0)/s.length*100).toFixed(0):0,"%"]})]}),c.jsx("div",{className:"text-3xl",children:""})]})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Recent Entries"})]}),c.jsx("div",{className:"space-y-4",children:s.slice(0,5).map(L=>c.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-purple-500 transition-colors",children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-white",children:L.title}),c.jsx("p",{className:"text-gray-400 text-sm mt-1 line-clamp-2",children:L.content}),c.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[c.jsx("span",{children:L.content_type}),c.jsx("span",{children:L.category}),c.jsx("span",{children:new Date(L.created_at).toLocaleDateString()})]})]}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx("div",{className:"w-12 h-2 bg-gray-700 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-purple-500",style:{width:`${L.importance_score*100}%`}})})})]})},L.id))})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Knowledge Clusters"})]}),c.jsx("div",{className:"space-y-4",children:o.slice(0,5).map(L=>c.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-purple-500 transition-colors",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:L.color}}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-white",children:L.name}),c.jsx("p",{className:"text-gray-400 text-sm",children:L.description})]})]}),c.jsxs("div",{className:"text-right",children:[c.jsx("div",{className:"text-lg font-bold text-purple-400",children:L.entry_count||0}),c.jsx("div",{className:"text-xs text-gray-500",children:"entries"})]})]})},L.id))})]})]})]}),r==="graph"&&c.jsxs("div",{className:"h-screen bg-gray-800 rounded-xl overflow-hidden",children:[c.jsxs("div",{className:"p-4 border-b border-gray-700",children:[c.jsx("h2",{className:"text-xl font-bold",children:"3D Knowledge Graph"}),c.jsx("p",{className:"text-gray-400 text-sm",children:"Interactive visualization of your knowledge network"})]}),c.jsx("div",{className:"h-full",children:u&&c.jsx(ZT,{ref:k,graphData:u,nodeLabel:"name",nodeColor:"color",nodeVal:"val",linkWidth:"value",backgroundColor:nl.bgAlt,showNavInfo:!1,controlType:"orbit",onNodeClick:L=>{console.log("Node clicked:",L)},nodeThreeObject:L=>{try{const B=document.createElement("canvas"),V=B.getContext("2d");if(!V)return new Xn;B.width=256,B.height=256,V.fillStyle=L.color||on.accentBlue,V.beginPath(),V.arc(128,128,100,0,2*Math.PI),V.fill(),V.fillStyle="white",V.font="32px Arial",V.textAlign="center",V.fillText(L.type==="cluster"?"":"",128,140);const z=new F9(B),Y=new K1({map:z}),se=new C9(Y);return se.scale.set(L.val||1,L.val||1,1),se}catch(B){console.error("Error creating node sprite:",B);const V=new ih(L.val||1),z=new Us({color:L.color||on.accentBlue});return new Xn(V,z)}}})})]}),r==="search"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsx("h2",{className:"text-xl font-bold mb-4",children:"Semantic Search"}),c.jsxs("div",{className:"flex space-x-4",children:[c.jsx("input",{type:"text",placeholder:"Search your knowledge base...",value:g,onChange:L=>y(L.target.value),onKeyPress:L=>L.key==="Enter"&&$(),className:"flex-1 px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500"}),c.jsx("button",{onClick:$,disabled:x,className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 rounded-lg font-semibold transition-colors",children:x?" Searching...":" Search"})]})]}),b.length>0&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("h3",{className:"text-lg font-semibold",children:["Search Results (",b.length,")"]}),b.map(L=>c.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 hover:border-purple-500 transition-colors",children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsx("h3",{className:"text-lg font-semibold text-white",children:L.title}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsxs("div",{className:"px-2 py-1 bg-purple-600 text-white rounded text-xs",children:[(L.similarity*100).toFixed(0),"% match"]})})]}),c.jsx("p",{className:"text-gray-300 mb-3 line-clamp-3",children:L.content}),c.jsx("div",{className:"flex items-center space-x-2",children:L.cluster_names.map((B,V)=>c.jsx("span",{className:"px-2 py-1 bg-gray-700 text-gray-300 rounded text-xs",children:B},V))})]},L.id))]})]}),r==="entries"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsx("h2",{className:"text-xl font-bold mb-4",children:"All Knowledge Entries"}),c.jsxs("div",{className:"flex space-x-4",children:[c.jsxs("select",{value:M,onChange:L=>C(L.target.value),className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500",children:[c.jsx("option",{value:"all",children:"All Categories"}),O.map(L=>c.jsx("option",{value:L,children:L},L))]}),c.jsxs("select",{value:R,onChange:L=>F(L.target.value),className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500",children:[c.jsx("option",{value:"all",children:"All Types"}),j.map(L=>c.jsx("option",{value:L,children:L},L))]})]})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:K.map(L=>c.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6 hover:border-purple-500 transition-colors",children:[c.jsxs("div",{className:"flex items-start justify-between mb-3",children:[c.jsx("h3",{className:"font-semibold text-white text-lg",children:L.title}),c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx("span",{className:"text-yellow-400",children:""}),c.jsxs("span",{className:"text-sm text-gray-400",children:[(L.importance_score*100).toFixed(0),"%"]})]})]}),c.jsx("p",{className:"text-gray-300 text-sm mb-4 line-clamp-3",children:L.content}),c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[c.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded",children:L.content_type}),c.jsx("span",{className:"px-2 py-1 bg-gray-700 rounded",children:L.category}),c.jsxs("span",{children:[L.access_count," views"]})]}),c.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:L.tags.map((B,V)=>c.jsx("span",{className:"px-2 py-1 bg-purple-600 text-purple-100 rounded text-xs",children:B},V))}),c.jsxs("div",{className:"text-xs text-gray-500",children:["Created ",new Date(L.created_at).toLocaleDateString()]})]},L.id))})]}),r==="create"&&c.jsx("div",{className:"max-w-2xl mx-auto",children:c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsx("h2",{className:"text-xl font-bold mb-6",children:"Create New Knowledge Entry"}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title"}),c.jsx("input",{type:"text",value:T.title,onChange:L=>S({...T,title:L.target.value}),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500",placeholder:"Enter knowledge title..."})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Content"}),c.jsx("textarea",{value:T.content,onChange:L=>S({...T,content:L.target.value}),rows:8,className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500",placeholder:"Enter your knowledge content..."})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Content Type"}),c.jsxs("select",{value:T.content_type,onChange:L=>S({...T,content_type:L.target.value}),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500",children:[c.jsx("option",{value:"text",children:"Text"}),c.jsx("option",{value:"code",children:"Code"}),c.jsx("option",{value:"image",children:"Image"}),c.jsx("option",{value:"document",children:"Document"}),c.jsx("option",{value:"link",children:"Link"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),c.jsxs("select",{value:T.category,onChange:L=>S({...T,category:L.target.value}),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500",children:[c.jsx("option",{value:"general",children:"General"}),c.jsx("option",{value:"programming",children:"Programming"}),c.jsx("option",{value:"ai",children:"AI & ML"}),c.jsx("option",{value:"business",children:"Business"}),c.jsx("option",{value:"personal",children:"Personal"}),c.jsx("option",{value:"research",children:"Research"})]})]})]}),c.jsxs("div",{children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Importance Score:"," ",(T.importance_score*100).toFixed(0),"%"]}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:T.importance_score,onChange:L=>S({...T,importance_score:parseFloat(L.target.value)}),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tags (comma-separated)"}),c.jsx("input",{type:"text",onChange:L=>S({...T,tags:L.target.value.split(",").map(B=>B.trim()).filter(B=>B)}),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500",placeholder:"ai, machine learning, neural networks..."})]}),c.jsxs("div",{className:"flex space-x-4",children:[c.jsx("button",{onClick:U,className:"flex-1 px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-colors",children:"Create Knowledge Entry"}),c.jsx("button",{onClick:()=>i("entries"),className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold transition-colors",children:"Cancel"})]})]})]})}),r==="categories"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Category Management (Preview)"})]}),c.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Organize knowledge entries into hierarchical categories. Drag & drop reordering and bulk assignment will be added in a later iteration."}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[c.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h3",{className:"font-semibold text-gray-200",children:"Existing Categories"}),c.jsx("button",{className:"text-xs px-2 py-1 bg-purple-600/60 hover:bg-purple-600 rounded transition-colors",children:"Refresh"})]}),c.jsxs("ul",{className:"divide-y divide-gray-700 border border-gray-700 rounded-lg overflow-hidden",children:[O.map(L=>c.jsxs("li",{className:"flex items-center justify-between px-4 py-2 hover:bg-gray-700/40 text-sm",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"cursor-grab text-gray-500",children:""}),c.jsx("span",{className:"text-gray-200",children:L}),c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-700 text-gray-400",children:s.filter(B=>B.category===L).length})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{className:"text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded",children:"Rename"}),c.jsx("button",{className:"text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded",children:"Merge"}),c.jsx("button",{className:"text-xs px-2 py-1 bg-red-600/70 hover:bg-red-600 rounded",children:"Delete"})]})]},L)),O.length===0&&c.jsx("li",{className:"px-4 py-4 text-center text-xs text-gray-500",children:"No categories yet."})]})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-gray-700/40 p-4 rounded-lg",children:[c.jsx("h4",{className:"font-semibold mb-3 text-sm text-gray-200",children:"Create Category"}),c.jsx("input",{type:"text",placeholder:"e.g. research/ai",className:"w-full mb-3 px-3 py-2 bg-gray-800 border border-gray-600 rounded text-sm focus:outline-none focus:border-purple-500"}),c.jsx("button",{className:"w-full py-2 bg-purple-600 hover:bg-purple-700 rounded text-sm font-semibold",children:"Add"})]}),c.jsxs("div",{className:"bg-gray-700/40 p-4 rounded-lg",children:[c.jsx("h4",{className:"font-semibold mb-3 text-sm text-gray-200",children:"Bulk Assign (Coming Soon)"}),c.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Select entries and assign them to categories in bulk."}),c.jsx("button",{className:"w-full py-2 bg-gray-600 cursor-not-allowed rounded text-sm opacity-60",children:"Bulk Assign Disabled"})]}),c.jsxs("div",{className:"bg-gray-700/40 p-4 rounded-lg",children:[c.jsx("h4",{className:"font-semibold mb-3 text-sm text-gray-200",children:"Hierarchy (Planned)"}),c.jsxs("ul",{className:"text-xs text-gray-400 space-y-1 list-disc list-inside",children:[c.jsx("li",{children:"Parent / child nesting"}),c.jsx("li",{children:"Automatic inheritance"}),c.jsx("li",{children:"Aggregation analytics"})]})]})]})]})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Upcoming Category Features"})]}),c.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-300 space-y-1",children:[c.jsx("li",{children:"Drag-and-drop reorder & nested hierarchy editing"}),c.jsx("li",{children:"Color labels and icons per category"}),c.jsx("li",{children:"Semantic auto-suggested categories for new entries"}),c.jsx("li",{children:"Merge & split operations with preview impact"}),c.jsx("li",{children:"Category-level access control & sharing"}),c.jsx("li",{children:"Analytics: usage frequency, recency heat map"})]})]})]})]})]})},fde=({isOpen:n,onClose:e,onConfirm:t,title:r,message:i,confirmText:s="Confirm",cancelText:a="Cancel",destructive:o=!1,requireTextConfirmation:l=!1,textToConfirm:u=""})=>{const[h,p]=E.useState("");if(!n)return null;const m=l&&h.toLowerCase()!==u.toLowerCase(),g=()=>{m||(t(),p(""))},y=()=>{e(),p("")};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded-xl p-6 max-w-md w-full mx-4",children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[c.jsx("div",{className:`text-2xl ${o?"text-red-400":"text-yellow-400"}`,children:o?"":""}),c.jsx("h3",{className:"text-xl font-semibold text-white",children:r})]}),c.jsx("p",{className:"text-gray-300 mb-6",children:i}),l&&c.jsxs("div",{className:"mb-6",children:[c.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:['Type "',u,'" to confirm:']}),c.jsx("input",{type:"text",value:h,onChange:b=>p(b.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500",placeholder:u,autoFocus:!0})]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:a}),c.jsx("button",{onClick:g,disabled:m,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${o?"bg-red-600 hover:bg-red-700 disabled:bg-red-800":"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:s})]})]})})},Vu=[{id:"openai",name:"openai",displayName:"OpenAI",category:"ai",icon:"",description:"GPT models, DALL-E, and advanced AI capabilities",featured:!0,popular:!0,fields:[{name:"apiKey",type:"password",required:!0,pattern:"^sk-[A-Za-z0-9]{32,}$",placeholder:"sk-1234567890abcdef...",description:"Your OpenAI API key from platform.openai.com"}],documentationUrl:"https://platform.openai.com/docs"},{id:"huggingface",name:"huggingface",displayName:"HuggingFace",category:"ai",icon:"",description:"Open-source ML models and inference API",featured:!0,popular:!0,fields:[{name:"token",type:"password",required:!0,pattern:"^hf_[A-Za-z0-9]{30,}$",placeholder:"hf_1234567890abcdef...",description:"HuggingFace access token from your profile settings"}],documentationUrl:"https://huggingface.co/docs/api-inference"},{id:"anthropic",name:"anthropic",displayName:"Anthropic",category:"ai",icon:"",description:"Claude AI assistant and language models",popular:!0,fields:[{name:"apiKey",type:"password",required:!0,pattern:"^sk-ant-[A-Za-z0-9\\-_]{32,}$",placeholder:"sk-ant-api03-1234567890...",description:"Anthropic API key for Claude models"}],documentationUrl:"https://docs.anthropic.com"},{id:"replicate",name:"replicate",displayName:"Replicate",category:"ai",icon:"",description:"Run machine learning models in the cloud",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"r8_1234567890abcdef...",description:"Replicate API token"}]},{id:"stability",name:"stability",displayName:"Stability AI",category:"ai",icon:"",description:"Stable Diffusion and image generation models",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"sk-1234567890abcdef...",description:"Stability AI API key"}]},{id:"assemblyai",name:"assemblyai",displayName:"AssemblyAI",category:"ai",icon:"",description:"Speech-to-text and audio intelligence",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"1234567890abcdef...",description:"AssemblyAI API key"}]},{id:"deepgram",name:"deepgram",displayName:"Deepgram",category:"ai",icon:"",description:"Advanced speech recognition and audio analysis",popular:!0,fields:[{name:"apiKey",type:"password",required:!0,placeholder:"1234567890abcdef...",description:"Deepgram API key"}]},{id:"elevenlabs",name:"elevenlabs",displayName:"ElevenLabs",category:"ai",icon:"",description:"AI voice generation and text-to-speech",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"1234567890abcdef...",description:"ElevenLabs API key"}]},{id:"google",name:"google",displayName:"Google Cloud",category:"infrastructure",icon:"",description:"Google Cloud Platform services and APIs",popular:!0,fields:[{name:"serviceAccountJson",type:"json",required:!1,placeholder:'{"type": "service_account", ...}',description:"Service account JSON key file (preferred)"},{name:"apiKey",type:"password",required:!1,pattern:"^[A-Za-z0-9\\-_]{39}$",placeholder:"AIzaSyDp-cMne4eJ-EtV68iNlypHdssyZ76cFb4",description:"Google Cloud API key (alternative)"}]},{id:"aws",name:"aws",displayName:"Amazon Web Services",category:"infrastructure",icon:"",description:"AWS cloud services and APIs",featured:!0,fields:[{name:"accessKeyId",type:"text",required:!0,pattern:"^AKIA[0-9A-Z]{16}$",placeholder:"AKIA1234567890123456",description:"AWS Access Key ID"},{name:"secretAccessKey",type:"password",required:!0,pattern:"^[A-Za-z0-9/+=]{40}$",placeholder:"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",description:"AWS Secret Access Key"},{name:"region",type:"text",required:!0,pattern:"^[a-z]{2}-[a-z]+-\\d$",placeholder:"us-east-1",description:"AWS region"}]},{id:"azure",name:"azure",displayName:"Microsoft Azure",category:"infrastructure",icon:"",description:"Microsoft Azure cloud platform",fields:[{name:"tenantId",type:"text",required:!0,placeholder:"12345678-1234-1234-1234-123456789012",description:"Azure AD tenant ID"},{name:"clientId",type:"text",required:!0,placeholder:"12345678-1234-1234-1234-123456789012",description:"Azure AD application (client) ID"},{name:"clientSecret",type:"password",required:!0,placeholder:"client-secret-value",description:"Azure AD client secret"},{name:"subscriptionId",type:"text",required:!0,placeholder:"12345678-1234-1234-1234-123456789012",description:"Azure subscription ID"}]},{id:"cloudflare",name:"cloudflare",displayName:"Cloudflare",category:"infrastructure",icon:"",description:"CDN, security, and performance optimization",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"api-token-value",description:"Cloudflare API token"},{name:"accountId",type:"text",required:!0,placeholder:"account-id-value",description:"Cloudflare account ID"}]},{id:"vercel",name:"vercel",displayName:"Vercel",category:"infrastructure",icon:"",description:"Frontend deployment and hosting platform",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"vercel-api-token",description:"Vercel API token"}]},{id:"netlify",name:"netlify",displayName:"Netlify",category:"infrastructure",icon:"",description:"Static site hosting and deployment",fields:[{name:"accessToken",type:"password",required:!0,placeholder:"netlify-access-token",description:"Netlify access token"}]},{id:"stripe",name:"stripe",displayName:"Stripe",category:"payments",icon:"",description:"Payment processing and financial services",popular:!0,fields:[{name:"secretKey",type:"password",required:!0,pattern:"^sk_(live|test)_[A-Za-z0-9]{24,}$",placeholder:"sk_test_1234567890abcdef...",description:"Stripe secret key"}]},{id:"paypal",name:"paypal",displayName:"PayPal",category:"payments",icon:"",description:"PayPal payment processing",fields:[{name:"clientId",type:"text",required:!0,placeholder:"paypal-client-id",description:"PayPal client ID"},{name:"clientSecret",type:"password",required:!0,placeholder:"paypal-client-secret",description:"PayPal client secret"}]},{id:"plaid",name:"plaid",displayName:"Plaid",category:"payments",icon:"",description:"Banking and financial data connectivity",fields:[{name:"clientId",type:"text",required:!0,placeholder:"plaid-client-id",description:"Plaid client ID"},{name:"secret",type:"password",required:!0,placeholder:"plaid-secret-key",description:"Plaid secret key"},{name:"env",type:"text",required:!0,placeholder:"sandbox",description:"Environment (sandbox/development/production)"}]},{id:"twilio",name:"twilio",displayName:"Twilio",category:"communication",icon:"",description:"SMS, voice, and communication APIs",popular:!0,fields:[{name:"accountSid",type:"text",required:!0,pattern:"^AC[0-9a-fA-F]{32}$",placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",description:"Twilio Account SID"},{name:"authToken",type:"password",required:!0,pattern:"^[0-9a-fA-F]{32}$",placeholder:"1234567890abcdef1234567890abcdef",description:"Twilio Auth Token"}]},{id:"slack",name:"slack",displayName:"Slack",category:"communication",icon:"",description:"Slack workspace integration",fields:[{name:"botToken",type:"password",required:!0,pattern:"^xox[baprs]-[A-Za-z0-9-]{10,}",placeholder:"xoxb-1234567890-1234567890-abcdef",description:"Slack bot token"}]},{id:"discord",name:"discord",displayName:"Discord",category:"communication",icon:"",description:"Discord bot and server integration",fields:[{name:"botToken",type:"password",required:!0,placeholder:"discord-bot-token",description:"Discord bot token"}]},{id:"sendgrid",name:"sendgrid",displayName:"SendGrid",category:"communication",icon:"",description:"Email delivery service",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"SG.1234567890abcdef...",description:"SendGrid API key"}]},{id:"mailgun",name:"mailgun",displayName:"Mailgun",category:"communication",icon:"",description:"Email service for developers",fields:[{name:"domain",type:"text",required:!0,placeholder:"mg.example.com",description:"Mailgun domain"},{name:"apiKey",type:"password",required:!0,placeholder:"key-1234567890abcdef",description:"Mailgun API key"}]},{id:"postmark",name:"postmark",displayName:"Postmark",category:"communication",icon:"",description:"Reliable email delivery",fields:[{name:"serverToken",type:"password",required:!0,placeholder:"postmark-server-token",description:"Postmark server token"}]},{id:"notion",name:"notion",displayName:"Notion",category:"productivity",icon:"",description:"Notion workspace and database integration",popular:!0,fields:[{name:"integrationToken",type:"password",required:!0,placeholder:"secret_1234567890abcdef",description:"Notion integration token"}]},{id:"jira",name:"jira",displayName:"Jira",category:"productivity",icon:"",description:"Project management and issue tracking",fields:[{name:"email",type:"text",required:!0,placeholder:"user@example.com",description:"Jira account email"},{name:"apiToken",type:"password",required:!0,placeholder:"jira-api-token",description:"Jira API token"},{name:"siteDomain",type:"text",required:!0,placeholder:"yourcompany.atlassian.net",description:"Jira site domain"}]},{id:"linear",name:"linear",displayName:"Linear",category:"productivity",icon:"",description:"Modern issue tracking and project management",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"lin_api_1234567890abcdef",description:"Linear API key"}]},{id:"confluence",name:"confluence",displayName:"Confluence",category:"productivity",icon:"",description:"Team collaboration and documentation",fields:[{name:"email",type:"text",required:!0,placeholder:"user@example.com",description:"Confluence account email"},{name:"apiToken",type:"password",required:!0,placeholder:"confluence-api-token",description:"Confluence API token"},{name:"siteDomain",type:"text",required:!0,placeholder:"yourcompany.atlassian.net",description:"Confluence site domain"}]},{id:"airtable",name:"airtable",displayName:"Airtable",category:"productivity",icon:"",description:"Spreadsheet-database hybrid platform",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"key1234567890abcdef",description:"Airtable API key"}]},{id:"clickup",name:"clickup",displayName:"ClickUp",category:"productivity",icon:"",description:"All-in-one productivity workspace",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"pk_1234567890abcdef",description:"ClickUp API key"}]},{id:"asana",name:"asana",displayName:"Asana",category:"productivity",icon:"",description:"Work management and team collaboration",fields:[{name:"personalAccessToken",type:"password",required:!0,placeholder:"1/1234567890:abcdef1234567890",description:"Asana personal access token"}]},{id:"trello",name:"trello",displayName:"Trello",category:"productivity",icon:"",description:"Visual project management boards",fields:[{name:"apiKey",type:"text",required:!0,placeholder:"trello-api-key",description:"Trello API key"},{name:"apiToken",type:"password",required:!0,placeholder:"trello-api-token",description:"Trello API token"}]},{id:"pinecone",name:"pinecone",displayName:"Pinecone",category:"vector-db",icon:"",description:"Vector database for ML applications",popular:!0,fields:[{name:"apiKey",type:"password",required:!0,pattern:"^[a-f0-9-]{32,}$",placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee",description:"Pinecone API key"},{name:"environment",type:"text",required:!0,placeholder:"us-east-1-aws",description:"Pinecone environment"}]},{id:"weaviate",name:"weaviate",displayName:"Weaviate",category:"vector-db",icon:"",description:"Open-source vector database",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"weaviate-api-key",description:"Weaviate API key"},{name:"host",type:"url",required:!0,placeholder:"https://your-cluster.weaviate.network",description:"Weaviate cluster URL"}]},{id:"algolia",name:"algolia",displayName:"Algolia",category:"search-index",icon:"",description:"Search and discovery API platform",fields:[{name:"appId",type:"text",required:!0,placeholder:"YourApplicationID",description:"Algolia application ID"},{name:"apiKey",type:"password",required:!0,placeholder:"your-api-key",description:"Algolia API key"}]},{id:"meilisearch",name:"meilisearch",displayName:"MeiliSearch",category:"search-index",icon:"",description:"Fast, open-source search engine",fields:[{name:"host",type:"url",required:!0,placeholder:"http://localhost:7700",description:"MeiliSearch host URL"},{name:"masterKey",type:"password",required:!0,placeholder:"master-key-value",description:"MeiliSearch master key"}]},{id:"redis",name:"redis",displayName:"Redis",category:"datastores",icon:"",description:"In-memory data structure store",fields:[{name:"host",type:"text",required:!0,placeholder:"localhost",description:"Redis host"},{name:"port",type:"text",required:!0,pattern:"^\\d{2,5}$",placeholder:"6379",description:"Redis port"},{name:"password",type:"password",required:!1,placeholder:"redis-password",description:"Redis password (optional)"}]},{id:"postgres",name:"postgres",displayName:"PostgreSQL",category:"datastores",icon:"",description:"Open-source relational database",fields:[{name:"host",type:"text",required:!0,pattern:"^[A-Za-z0-9_.-]+$",placeholder:"localhost",description:"PostgreSQL host"},{name:"port",type:"text",required:!0,pattern:"^\\d{2,5}$",placeholder:"5432",description:"PostgreSQL port"},{name:"database",type:"text",required:!0,placeholder:"mydb",description:"Database name"},{name:"user",type:"text",required:!0,placeholder:"postgres",description:"Database user"},{name:"password",type:"password",required:!0,placeholder:"password",description:"Database password"}]},{id:"supabase",name:"supabase",displayName:"Supabase",category:"datastores",icon:"",description:"Open-source Firebase alternative",popular:!0,fields:[{name:"url",type:"url",required:!0,placeholder:"https://yourproject.supabase.co",description:"Supabase project URL"},{name:"anonKey",type:"password",required:!0,placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6...",description:"Supabase anonymous key"},{name:"serviceRoleKey",type:"password",required:!1,placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6...",description:"Supabase service role key (optional)"}]},{id:"firebase",name:"firebase",displayName:"Firebase",category:"datastores",icon:"",description:"Google Firebase platform",fields:[{name:"serviceAccountJson",type:"json",required:!0,placeholder:'{"type": "service_account", ...}',description:"Firebase service account JSON"}]},{id:"neon",name:"neon",displayName:"Neon",category:"datastores",icon:"",description:"Serverless PostgreSQL platform",fields:[{name:"connectionString",type:"password",required:!0,placeholder:"postgres://user:pass@host/db",description:"Neon connection string"}]},{id:"upstash",name:"upstash",displayName:"Upstash",category:"datastores",icon:"",description:"Serverless Redis and Kafka",fields:[{name:"restUrl",type:"url",required:!0,placeholder:"https://your-db.upstash.io",description:"Upstash REST URL"},{name:"restToken",type:"password",required:!0,placeholder:"upstash-rest-token",description:"Upstash REST token"}]},{id:"segment",name:"segment",displayName:"Segment",category:"analytics",icon:"",description:"Customer data platform",fields:[{name:"writeKey",type:"password",required:!0,placeholder:"segment-write-key",description:"Segment write key"}]},{id:"mixpanel",name:"mixpanel",displayName:"Mixpanel",category:"analytics",icon:"",description:"Product analytics platform",fields:[{name:"projectToken",type:"password",required:!0,placeholder:"mixpanel-project-token",description:"Mixpanel project token"},{name:"apiSecret",type:"password",required:!0,placeholder:"mixpanel-api-secret",description:"Mixpanel API secret"}]},{id:"datadog",name:"datadog",displayName:"Datadog",category:"monitoring",icon:"",description:"Monitoring and analytics platform",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"datadog-api-key",description:"Datadog API key"},{name:"appKey",type:"password",required:!0,placeholder:"datadog-app-key",description:"Datadog application key"}]},{id:"sentry",name:"sentry",displayName:"Sentry",category:"monitoring",icon:"",description:"Error monitoring and performance tracking",popular:!0,fields:[{name:"dsn",type:"url",required:!0,placeholder:"https://key@sentry.io/project",description:"Sentry DSN"},{name:"authToken",type:"password",required:!1,placeholder:"sentry-auth-token",description:"Sentry auth token (optional)"}]},{id:"pagerduty",name:"pagerduty",displayName:"PagerDuty",category:"monitoring",icon:"",description:"Incident response and alerting",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"pagerduty-api-token",description:"PagerDuty API token"}]},{id:"github",name:"github",displayName:"GitHub",category:"misc",icon:"",description:"Code hosting and collaboration platform",popular:!0,fields:[{name:"token",type:"password",required:!0,pattern:"^gh[pousr]_[A-Za-z0-9]{36,}$",placeholder:"ghp_1234567890abcdef1234567890abcdef",description:"GitHub personal access token"}]},{id:"gitlab",name:"gitlab",displayName:"GitLab",category:"misc",icon:"",description:"DevOps platform and Git repository",fields:[{name:"token",type:"password",required:!0,placeholder:"glpat-1234567890abcdef",description:"GitLab access token"}]},{id:"openweather",name:"openweather",displayName:"OpenWeatherMap",category:"weather",icon:"",description:"Weather data and forecasting API",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"openweather-api-key",description:"OpenWeatherMap API key"}]}],pde={ai:Kn.ai,infrastructure:Kn.trigger,analytics:Kn.data,communication:Kn.http,payments:Kn.logic,productivity:Kn.mcp,"search-index":Kn.rag,"vector-db":Kn.rag,datastores:Kn.data,weather:Kn.fallback,monitoring:Kn.trigger,misc:Kn.fallback},NP={ai:"AI & Machine Learning",infrastructure:"Cloud Infrastructure",analytics:"Analytics & Metrics",communication:"Communication",payments:"Payments & Finance",productivity:"Productivity Tools","search-index":"Search & Indexing","vector-db":"Vector Databases",datastores:"Data Storage",weather:"Weather Services",monitoring:"Monitoring & Alerts",misc:"Miscellaneous"},EP=({onSelectProvider:n,selectedProvider:e,className:t=""})=>{const[r,i]=E.useState(""),[s,a]=E.useState("all"),[o,l]=E.useState(!1),u=E.useMemo(()=>Vu.filter(p=>{const m=p.displayName.toLowerCase().includes(r.toLowerCase())||p.description.toLowerCase().includes(r.toLowerCase())||p.name.toLowerCase().includes(r.toLowerCase()),g=s==="all"||p.category===s,y=!o||p.featured||p.popular;return m&&g&&y}),[r,s,o]),h=E.useMemo(()=>{const p={};return Vu.forEach(m=>{p[m.category]=(p[m.category]||0)+1}),Object.entries(p).map(([m,g])=>({key:m,name:NP[m]||m,count:g})).sort((m,g)=>g.count-m.count)},[]);return c.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl ${t}`,children:[c.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Provider Catalog"}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"50+ supported API providers with secure credential management"})]}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsxs("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-full text-sm font-medium",children:[u.length," providers"]})})]}),c.jsx("div",{className:"space-y-4",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[c.jsx("div",{className:"flex-1",children:c.jsx("input",{type:"text",placeholder:"Search providers...",value:r,onChange:p=>i(p.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})}),c.jsxs("select",{value:s,onChange:p=>a(p.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[c.jsxs("option",{value:"all",children:["All Categories (",Vu.length,")"]}),h.map(p=>c.jsxs("option",{value:p.key,children:[p.name," (",p.count,")"]},p.key))]}),c.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:o,onChange:p=>l(p.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-purple-600 focus:ring-purple-500"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Featured only"})]})]})})]}),c.jsxs("div",{className:"p-6",children:[c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(p=>c.jsxs("div",{onClick:()=>n(p),className:`p-4 border rounded-lg cursor-pointer transition-all hover:shadow-md ${e?.id===p.id?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[c.jsx("div",{className:"flex items-start justify-between mb-3",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white text-lg font-semibold",style:{background:pde[p.category]},children:p.icon}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:p.displayName}),c.jsxs("div",{className:"flex items-center space-x-1 text-xs",children:[c.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded",children:NP[p.category]}),p.popular&&c.jsx("span",{className:"px-2 py-1 bg-orange-100 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 rounded",children:"Popular"}),p.featured&&c.jsx("span",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded",children:"Featured"})]})]})]})}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:p.description}),c.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-500",children:[c.jsxs("span",{children:[p.fields.length," field",p.fields.length!==1?"s":""]}),p.documentationUrl&&c.jsx("span",{children:" Docs available"})]})]},p.id))}),u.length===0&&c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"text-6xl mb-4",children:""}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No providers found"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Try adjusting your search terms or filters"})]})]}),c.jsx("div",{className:"px-6 py-3 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 rounded-b-lg",children:c.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[c.jsxs("span",{children:[u.length," of ",Vu.length," providers shown"]}),c.jsxs("span",{children:[h.length," categories  ",Vu.filter(p=>p.popular).length," popular  ",Vu.filter(p=>p.featured).length," featured"]})]})})]})},mde=({provider:n,onSubmit:e,onCancel:t,isSubmitting:r=!1,className:i=""})=>{const[s,a]=E.useState({keyName:"",fields:{},expiresAt:"",rotationIntervalDays:90,metadata:{}}),[o,l]=E.useState({}),[u,h]=E.useState(!1);E.useEffect(()=>{const x={};n.fields.forEach(N=>{x[N.name]=""}),a(N=>({...N,keyName:`${n.displayName} Key`,fields:x})),l({})},[n]);const p=(x,N)=>{if(x.required&&!N.trim())return{isValid:!1,message:`${x.name} is required`};if(N&&x.pattern&&!new RegExp(x.pattern).test(N))return{isValid:!1,message:`Invalid ${x.name.charAt(0).toUpperCase()+x.name.slice(1)} format`};if(x.type==="json"&&N)try{JSON.parse(N)}catch{return{isValid:!1,message:"Invalid JSON format"}}if(x.type==="url"&&N)try{new URL(N)}catch{return{isValid:!1,message:"Invalid URL format"}}return{isValid:!0,message:""}},m=(x,N)=>{a(S=>({...S,fields:{...S.fields,[x]:N}}));const T=n.fields.find(S=>S.name===x);if(T){const S=p(T,N);l(M=>({...M,[x]:S}))}},g=()=>{const x={};let N=!0;return n.fields.forEach(T=>{const S=s.fields[T.name]||"",M=p(T,S);x[T.name]=M,M.isValid||(N=!1)}),s.keyName.trim()||(N=!1),l(x),N},y=async x=>{if(x.preventDefault(),!g())return;await e(s)&&(a({keyName:"",fields:{},expiresAt:"",rotationIntervalDays:90,metadata:{}}),l({}))},b=x=>{const N=s.fields[x.name]||"",T=o[x.name],M=`w-full px-4 py-3 rounded-lg border transition-colors focus:outline-none focus:ring-2 ${T&&!T.isValid?"border-red-500 focus:ring-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-300 dark:border-gray-600 focus:ring-purple-500 bg-white dark:bg-gray-800"} text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400`;switch(x.type){case"password":return c.jsx("input",{type:"password",value:N,onChange:C=>m(x.name,C.target.value),placeholder:x.placeholder,className:M,autoComplete:"new-password"});case"url":return c.jsx("input",{type:"url",value:N,onChange:C=>m(x.name,C.target.value),placeholder:x.placeholder,className:M});case"json":return c.jsx("textarea",{value:N,onChange:C=>m(x.name,C.target.value),placeholder:x.placeholder,rows:6,className:`${M} font-mono text-sm resize-y`});default:return c.jsx("input",{type:"text",value:N,onChange:C=>m(x.name,C.target.value),placeholder:x.placeholder,className:M})}},_=s.keyName.trim()&&n.fields.every(x=>!x.required||s.fields[x.name]?.trim())&&Object.values(o).every(x=>!x||x.isValid);return c.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl ${i}`,children:[c.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-white text-xl font-semibold",style:{background:Kn.ai},children:n.icon}),c.jsxs("div",{children:[c.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Add ",n.displayName," Credentials"]}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:n.description})]})]})}),c.jsx("form",{onSubmit:y,className:"p-6",children:c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Credential Name *"}),c.jsx("input",{type:"text",value:s.keyName,onChange:x=>a(N=>({...N,keyName:x.target.value})),placeholder:`e.g., Production ${n.displayName} Key`,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0})]}),n.fields.map(x=>c.jsxs("div",{children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[x.name.charAt(0).toUpperCase()+x.name.slice(1).replace(/([A-Z])/g," $1"),x.required&&" *"]}),b(x),x.description&&c.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:x.description}),o[x.name]&&!o[x.name].isValid&&c.jsxs("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400 flex items-center space-x-1",children:[c.jsx("span",{children:""}),c.jsx("span",{children:o[x.name].message})]})]},x.name)),c.jsxs("div",{children:[c.jsxs("button",{type:"button",onClick:()=>h(!u),className:"flex items-center space-x-2 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300",children:[c.jsx("span",{children:u?"":""}),c.jsx("span",{children:"Advanced Options"})]}),u&&c.jsx("div",{className:"mt-4 space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Expires At (Optional)"}),c.jsx("input",{type:"datetime-local",value:s.expiresAt,onChange:x=>a(N=>({...N,expiresAt:x.target.value})),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Auto-rotation Interval (Days)"}),c.jsxs("select",{value:s.rotationIntervalDays||90,onChange:x=>a(N=>({...N,rotationIntervalDays:parseInt(x.target.value)})),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[c.jsx("option",{value:"",children:"No auto-rotation"}),c.jsx("option",{value:30,children:"30 days"}),c.jsx("option",{value:60,children:"60 days"}),c.jsx("option",{value:90,children:"90 days"}),c.jsx("option",{value:180,children:"180 days"}),c.jsx("option",{value:365,children:"365 days"})]})]})]})})]}),n.documentationUrl&&c.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:c.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Need help getting your API key?"}),c.jsxs("a",{href:n.documentationUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline font-medium",children:["View ",n.displayName," Documentation "]})]})}),c.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200 dark:border-gray-700",children:[c.jsx("button",{type:"button",onClick:t,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",disabled:r,children:"Cancel"}),c.jsx("button",{type:"submit",disabled:!_||r,className:`px-6 py-2 rounded-lg font-medium transition-all flex items-center space-x-2 ${_&&!r?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:r?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),c.jsx("span",{children:"Adding..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Add Credential"})]})})]})]})})]})},Gu={valid:{bg:"bg-green-100 dark:bg-green-900/20",text:"text-green-800 dark:text-green-200",border:"border-green-500",icon:""},invalid:{bg:"bg-red-100 dark:bg-red-900/20",text:"text-red-800 dark:text-red-200",border:"border-red-500",icon:""},expired:{bg:"bg-orange-100 dark:bg-orange-900/20",text:"text-orange-800 dark:text-orange-200",border:"border-orange-500",icon:""},checking:{bg:"bg-blue-100 dark:bg-blue-900/20",text:"text-blue-800 dark:text-blue-200",border:"border-blue-500",icon:""},never_tested:{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-800 dark:text-gray-200",border:"border-gray-500",icon:""}},gde=({token:n,className:e=""})=>{const[t,r]=E.useState([]),[i,s]=E.useState(!0),[a,o]=E.useState(new Set),[l,u]=E.useState(null),h=async()=>{try{const y=await fetch("/api/vault/validation-status",{headers:{Authorization:`Bearer ${n}`}});if(y.ok){const b=await y.json();b.success&&r(b.validations)}}catch(y){console.error("Failed to load validation statuses:",y)}finally{s(!1)}},p=async y=>{o(b=>new Set(b).add(y));try{const b=await fetch(`/api/vault/credentials/${y}/validate`,{method:"POST",headers:{Authorization:`Bearer ${n}`}});if(b.ok){const _=await b.json();r(x=>x.map(N=>N.id===y?{...N,status:_.result.status,lastValidated:new Date().toISOString(),lastValidationMessage:_.result.message,responseTimeMs:_.result.responseTime,rateLimitRemaining:_.result.rateLimitRemaining,rateLimitResetAt:_.result.rateLimitResetAt}:N))}}catch(b){console.error(`Failed to validate credential ${y}:`,b)}finally{o(b=>{const _=new Set(b);return _.delete(y),_})}},m=async()=>{const y=t.map(b=>b.id);o(new Set(y));try{(await fetch("/api/vault/validate-all",{method:"POST",headers:{Authorization:`Bearer ${n}`}})).ok&&await h()}catch(b){console.error("Failed to validate all credentials:",b)}finally{o(new Set)}};E.useEffect(()=>{h()},[n]);const g=we.useMemo(()=>{const y=t.length,b=t.filter(T=>T.status==="valid").length,_=t.filter(T=>T.status==="invalid").length,x=t.filter(T=>T.status==="expired").length,N=t.filter(T=>T.status==="never_tested").length;return{total:y,valid:b,invalid:_,expired:x,neverTested:N}},[t]);return i?c.jsx("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl p-6 ${e}`,children:c.jsxs("div",{className:"animate-pulse space-y-4",children:[c.jsx("div",{className:"h-8 bg-gray-300 dark:bg-gray-700 rounded"}),c.jsx("div",{className:"space-y-3",children:[...Array(3)].map((y,b)=>c.jsx("div",{className:"h-20 bg-gray-300 dark:bg-gray-700 rounded"},b))})]})}):c.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl ${e}`,children:[c.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Credential Validation Dashboard"}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Monitor API credential health and validation status"})]}),c.jsx("button",{onClick:m,disabled:a.size>0,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors flex items-center space-x-2",children:a.size>0?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),c.jsx("span",{children:"Validating..."})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Validate All"})]})})]})}),c.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g.total}),c.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.valid}),c.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Valid"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-red-600",children:g.invalid}),c.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Invalid"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g.expired}),c.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expired"})]}),c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"text-2xl font-bold text-gray-600",children:g.neverTested}),c.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Untested"})]})]})}),c.jsx("div",{className:"p-6",children:c.jsxs("div",{className:"space-y-4",children:[t.map(y=>{const b=Gu[y.status],_=a.has(y.id);return c.jsxs("div",{className:`p-4 border rounded-lg transition-all hover:shadow-md cursor-pointer ${l?.id===y.id?`${b.border} ${b.bg}`:"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>u(y),children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"text-2xl",children:y.providerIcon}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:y.keyName}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:y.providerName})]})]}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-1 ${b.bg} ${b.text}`,children:[c.jsx("span",{children:_?"":b.icon}),c.jsx("span",{className:"capitalize",children:_?"Validating...":y.status.replace("_"," ")})]}),c.jsx("button",{onClick:x=>{x.stopPropagation(),p(y.id)},disabled:_,className:"px-3 py-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/40 text-blue-800 dark:text-blue-200 rounded text-sm transition-colors",children:_?"Testing...":"Test Now"})]})]}),c.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[y.lastValidated&&c.jsxs("span",{children:["Last tested: ",new Date(y.lastValidated).toLocaleString()]}),y.responseTimeMs&&c.jsxs("span",{children:["Response: ",y.responseTimeMs,"ms"]})]}),c.jsxs("div",{className:"flex items-center space-x-4",children:[y.rateLimitRemaining!==void 0&&c.jsxs("span",{className:"text-xs",children:["Rate limit: ",y.rateLimitRemaining," remaining"]}),y.usageQuota&&c.jsxs("span",{className:"text-xs",children:["Usage: ",y.usageQuota.used,"/",y.usageQuota.limit]})]})]}),y.status==="invalid"&&y.lastValidationMessage&&c.jsx("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-sm text-red-800 dark:text-red-200",children:y.lastValidationMessage})]},y.id)}),t.length===0&&c.jsxs("div",{className:"text-center py-12",children:[c.jsx("div",{className:"text-6xl mb-4",children:""}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No credentials to validate"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Add some API credentials to see their validation status here"})]})]})}),l&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:c.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[c.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[l.keyName," - Validation Details"]}),c.jsx("button",{onClick:()=>u(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:""})]})}),c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Current Status"}),c.jsxs("div",{className:`p-4 rounded-lg ${Gu[l.status].bg}`,children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-2xl",children:Gu[l.status].icon}),c.jsx("span",{className:`font-medium ${Gu[l.status].text}`,children:l.status.replace("_"," ").toUpperCase()})]}),l.lastValidationMessage&&c.jsx("p",{className:`mt-2 text-sm ${Gu[l.status].text}`,children:l.lastValidationMessage})]})]}),l.validationHistory&&l.validationHistory.length>0&&c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Validation History"}),c.jsx("div",{className:"space-y-2",children:l.validationHistory.map((y,b)=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("span",{className:"text-sm",children:Gu[y.status]?.icon||""}),c.jsxs("div",{children:[c.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:y.status.toUpperCase()}),c.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date(y.timestamp).toLocaleString()})]})]}),c.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-400",children:[c.jsxs("div",{children:[y.responseTime,"ms"]}),y.message&&c.jsx("div",{className:"text-xs truncate max-w-40",title:y.message,children:y.message})]})]},b))})]})]})]})})]})},xde={MASKED:"Masked",PARTIAL:"Partial",UNMASKED_ONCE:"Reveal Once"},yde=({maskedValue:n,fullValue:e,isRevealedInitially:t=!1,onReveal:r,onCopy:i,onMaskChange:s,mode:a="MASKED",disabled:o})=>{const[l,u]=E.useState(t),[h,p]=E.useState(l&&e?e:n),[m,g]=E.useState(!1),[y,b]=E.useState(null),_=async()=>{if(!l&&r){g(!0),b(null);try{const T=await r();T?(p(T),u(!0),a==="UNMASKED_ONCE"&&setTimeout(()=>{p(n),u(!1)},2e4)):b("Unable to reveal value")}catch(T){b(T.message||"Reveal failed")}finally{g(!1)}}},x=()=>{if(l){i&&i(h);try{navigator.clipboard.writeText(h)}catch{}}},N=T=>{s&&s(T)};return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("select",{disabled:o,className:"bg-gray-700 border border-gray-600 rounded px-2 py-1 text-xs focus:outline-none focus:border-green-500",value:a,onChange:T=>N(T.target.value),children:Object.entries(xde).map(([T,S])=>c.jsx("option",{value:T,children:S},T))}),c.jsx("div",{className:"flex-1 font-mono bg-gray-800 border border-gray-700 rounded px-3 py-2 text-sm overflow-x-auto select-none",children:h}),c.jsx("button",{disabled:o||l||!r,onClick:_,className:`px-3 py-2 rounded text-xs font-medium ${l?"bg-gray-700 text-gray-400":"bg-blue-600 hover:bg-blue-700"} disabled:opacity-50`,children:m?"":l?"Revealed":"Reveal"}),c.jsx("button",{disabled:o||!l,onClick:x,className:"px-3 py-2 rounded text-xs font-medium bg-gray-600 hover:bg-gray-500 disabled:opacity-50",children:"Copy"})]}),a==="UNMASKED_ONCE"&&c.jsx("div",{className:"text-[10px] text-yellow-400",children:"Auto-remasks after 20s"}),y&&c.jsx("div",{className:"text-xs text-red-400",children:y})]})},vde=({token:n,onBack:e})=>{const[t,r]=E.useState("dashboard"),[i,s]=E.useState(null),[a,o]=E.useState([]),[l,u]=E.useState([]),[h,p]=E.useState([]),[m,g]=E.useState(!0),[y,b]=E.useState({}),[_,x]=E.useState({}),[N,T]=E.useState({isOpen:!1,keyId:null,keyName:""});E.useEffect(()=>{S()},[n]);const S=async()=>{g(!0);try{const[P,G,$]=await Promise.all([fetch("/api/vault/providers",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/vault/keys",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/vault/security-events?limit=20",{headers:{Authorization:`Bearer ${n}`}})]),[U,K,O]=await Promise.all([P.json(),G.json(),$.json()]);U.success&&o(U.providers),K.success&&u(K.keys),O.success&&p(O.events)}catch(P){console.error("Error loading vault data:",P)}finally{g(!1)}},M=async P=>{try{const $=await(await fetch(`/api/vault/keys/${P}/test`,{method:"POST",headers:{Authorization:`Bearer ${n}`}})).json();x({..._,[P]:$.test_result})}catch(G){console.error("Error testing API key:",G)}},C=async(P,G)=>{try{(await fetch(`/api/vault/keys/${P}`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({is_active:!G})})).ok&&S()}catch($){console.error("Error toggling key status:",$)}},R=async(P,G)=>{T({isOpen:!0,keyId:P,keyName:G})},F=async()=>{if(N.keyId)try{const P=await fetch(`/api/vault/keys/${N.keyId}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(P.ok)S(),T({isOpen:!1,keyId:null,keyName:""});else{const G=await P.json();throw new Error(G.error||"Failed to delete API key")}}catch(P){console.error("Error deleting API key:",P)}},k=P=>{switch(P){case"critical":return"text-red-400 bg-red-900/20";case"warning":return"text-yellow-400 bg-yellow-900/20";default:return"text-blue-400 bg-blue-900/20"}},D=P=>P||"";return m?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500 mx-auto"}),c.jsx("p",{className:"text-white text-xl mt-4",children:"Loading API Key Vault..."})]})}):c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-6",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50",children:" Back"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gradient",children:" Secure API Key Vault"}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Centralized, encrypted storage for all your API keys and secrets"})]})]}),c.jsx("div",{className:"flex items-center space-x-4",children:c.jsxs("button",{onClick:()=>r("add"),className:"px-4 py-2 bg-gradient-green rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Add API Key"})]})})]})}),c.jsx("div",{className:"bg-gray-800 border-b border-gray-700",children:c.jsx("div",{className:"max-w-7xl mx-auto px-6",children:c.jsx("nav",{className:"flex space-x-8",children:[{id:"dashboard",name:"Dashboard",icon:""},{id:"keys",name:"API Keys",icon:""},{id:"add",name:"Add Key",icon:""},{id:"rotation",name:"Rotation",icon:""},{id:"security",name:"Security Events",icon:""},{id:"analytics",name:"Usage Analytics",icon:""},{id:"catalog",name:"Provider Catalog",icon:""},{id:"validation",name:"Validation Status",icon:""}].map(P=>c.jsxs("button",{onClick:()=>r(P.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${t===P.id?"border-green-500 text-green-400":"border-transparent text-gray-400 hover:text-white hover:border-gray-300"}`,children:[c.jsx("span",{className:"mr-2",children:P.icon}),P.name]},P.id))})})}),c.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[t==="dashboard"&&c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[c.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-green-100",children:"Total API Keys"}),c.jsx("p",{className:"text-2xl font-bold",children:l.length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-blue-100",children:"Active Keys"}),c.jsx("p",{className:"text-2xl font-bold",children:l.filter(P=>P.is_active).length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-yellow-100",children:"Need Rotation"}),c.jsx("p",{className:"text-2xl font-bold",children:l.filter(P=>P.needs_rotation).length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-purple-100",children:"Providers"}),c.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),c.jsx("div",{className:"text-3xl",children:""})]})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Recently Added Keys"})]}),c.jsx("div",{className:"space-y-4",children:l.slice(0,5).map(P=>c.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-700 rounded-lg",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("span",{className:"text-2xl",children:D(P.provider_icon)}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:P.key_name}),c.jsx("p",{className:"text-sm text-gray-400",children:P.provider_display_name})]})]}),c.jsxs("div",{className:"text-right text-sm",children:[c.jsx("div",{className:`px-2 py-1 rounded ${P.is_active?"bg-green-900/20 text-green-400":"bg-red-900/20 text-red-400"}`,children:P.is_active?"Active":"Inactive"}),c.jsx("div",{className:"text-gray-500 mt-1",children:new Date(P.created_at).toLocaleDateString()})]})]},P.id))})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Recent Security Events"})]}),c.jsx("div",{className:"space-y-4",children:h.slice(0,5).map(P=>c.jsxs("div",{className:"flex items-start space-x-3 p-4 border border-gray-700 rounded-lg",children:[c.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${k(P.severity)}`,children:P.severity.toUpperCase()}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm text-white",children:P.description}),c.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 mt-1",children:[c.jsx("span",{children:new Date(P.created_at).toLocaleString()}),P.ip_address&&c.jsxs("span",{children:["IP: ",P.ip_address]})]})]})]},P.id))})]})]})]}),t==="keys"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h2",{className:"text-2xl font-bold",children:["API Keys (",l.length,")"]}),c.jsx("div",{className:"flex items-center space-x-4",children:c.jsxs("select",{className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-green-500",children:[c.jsx("option",{value:"",children:"All Providers"}),a.map(P=>c.jsx("option",{value:P.name,children:P.display_name},P.id))]})})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(P=>c.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6 hover:border-green-500 transition-colors",children:[c.jsxs("div",{className:"flex items-start justify-between mb-4",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("span",{className:"text-2xl",children:D(P.provider_icon)}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-lg",children:P.key_name}),c.jsx("p",{className:"text-sm text-gray-400",children:P.provider_display_name})]})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[P.needs_rotation&&c.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full animate-pulse",title:"Needs rotation"}),c.jsx("div",{className:`w-3 h-3 rounded-full ${P.is_active?"bg-green-400":"bg-red-400"}`})]})]}),c.jsxs("div",{className:"space-y-3 mb-4",children:[c.jsx(yde,{maskedValue:"************"+(P.key_name.slice(-4)||"XXXX"),mode:y[P.id]||"MASKED",onMaskChange:G=>b($=>({...$,[P.id]:G})),onReveal:async()=>{try{const G=await fetch(`/api/vault/keys/${P.id}/reveal`,{headers:{Authorization:`Bearer ${n}`}});return G.ok&&(await G.json()).full_key||null}catch{return null}},onCopy:G=>{console.log("Copied credential value length",G.length)}}),c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-gray-400",children:"Usage:"}),c.jsxs("span",{className:"text-white",children:[P.usage_count," requests"]})]}),c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-gray-400",children:"Last used:"}),c.jsx("span",{className:"text-white",children:P.last_used_at?new Date(P.last_used_at).toLocaleDateString():"Never"})]}),P.usage_stats&&c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-gray-400",children:"Success rate:"}),c.jsxs("span",{className:"text-green-400",children:[P.usage_stats.total_requests>0?(P.usage_stats.successful_requests/P.usage_stats.total_requests*100).toFixed(1):0,"%"]})]})]}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("button",{onClick:()=>M(P.id),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors",children:" Test"}),c.jsx("button",{onClick:()=>C(P.id,P.is_active),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${P.is_active?"bg-yellow-600 hover:bg-yellow-700":"bg-green-600 hover:bg-green-700"}`,children:P.is_active?" Disable":" Enable"}),c.jsx("button",{onClick:()=>R(P.id,P.key_name),className:"px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium transition-colors",children:""})]}),_[P.id]&&c.jsxs("div",{className:`mt-4 p-3 rounded-lg text-sm ${_[P.id].status==="success"?"bg-green-900/20 border border-green-700 text-green-200":"bg-red-900/20 border border-red-700 text-red-200"}`,children:[c.jsx("div",{className:"font-medium",children:_[P.id].message}),_[P.id].details&&c.jsx("div",{className:"text-xs mt-1 opacity-75",children:_[P.id].details}),c.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Response time: ",_[P.id].response_time_ms,"ms"]})]})]},P.id))})]}),t==="add"&&!i&&c.jsx(EP,{onSelectProvider:P=>{s(P)},selectedProvider:i,className:"w-full"}),t==="add"&&i&&c.jsx(mde,{provider:i,onSubmit:async P=>{try{const $=await(await fetch("/api/vault/keys",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({provider_name:i.name,key_name:P.keyName,credential_data:P.fields,expires_at:P.expiresAt||null,rotation_interval_days:P.rotationIntervalDays||null,metadata:P.metadata||{}})})).json();return $.success?(s(null),r("keys"),S(),!0):(alert($.error),!1)}catch(G){return console.error("Error adding API key:",G),alert("Failed to add API key"),!1}},onCancel:()=>{s(null),r("keys")},className:"max-w-4xl mx-auto"}),t==="catalog"&&c.jsx(EP,{onSelectProvider:P=>{s(P),r("add")},selectedProvider:i,className:"w-full"}),t==="validation"&&c.jsx(gde,{token:n,className:"w-full"}),t==="security"&&c.jsxs("div",{className:"space-y-6",children:[c.jsx("h2",{className:"text-2xl font-bold",children:"Security Events"}),c.jsx("div",{className:"space-y-4",children:h.map(P=>c.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex items-start space-x-4",children:[c.jsx("div",{className:`px-3 py-1 rounded text-sm font-medium ${k(P.severity)}`,children:P.severity.toUpperCase()}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-lg",children:P.event_type.replace("_"," ").toUpperCase()}),c.jsx("p",{className:"text-gray-300 mt-1",children:P.description}),c.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500 mt-2",children:[c.jsxs("span",{children:[" ",new Date(P.created_at).toLocaleString()]}),P.ip_address&&c.jsxs("span",{children:[" ",P.ip_address]}),P.key_name&&c.jsxs("span",{children:[" ",P.key_name]}),P.provider_name&&c.jsxs("span",{children:[" ",P.provider_name]})]})]})]})})},P.id))})]}),t==="analytics"&&c.jsxs("div",{className:"space-y-6",children:[c.jsx("h2",{className:"text-2xl font-bold",children:"Usage Analytics"}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[c.jsx("div",{className:"text-6xl mb-4",children:""}),c.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Analytics Dashboard"}),c.jsx("p",{className:"text-gray-400",children:"Detailed usage analytics and cost tracking will be displayed here. This includes API call frequency, response times, token usage, and cost analysis."})]})]}),t==="rotation"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("h2",{className:"text-2xl font-bold flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Credential Rotation Scheduling"})]}),c.jsx("p",{className:"text-gray-400 max-w-3xl",children:"Define and manage automatic rotation policies for your stored credentials. Rotation reduces exposure risk and enforces compliance."}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[c.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Policies"})]}),c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"w-full text-sm",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"text-left text-gray-400 border-b border-gray-700",children:[c.jsx("th",{className:"py-2 pr-4",children:"Credential"}),c.jsx("th",{className:"py-2 pr-4",children:"Interval"}),c.jsx("th",{className:"py-2 pr-4",children:"Last Rotated"}),c.jsx("th",{className:"py-2 pr-4",children:"Next Due"}),c.jsx("th",{className:"py-2 pr-4",children:"Auto"}),c.jsx("th",{className:"py-2 pr-4",children:"Status"}),c.jsx("th",{className:"py-2 pr-4 text-right",children:"Actions"})]})}),c.jsx("tbody",{children:l.slice(0,10).map(P=>{const $=P.last_used_at||P.created_at,U=new Date(new Date($).getTime()+2160*60*60*1e3),K=U.getTime()<Date.now();return c.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-750/40",children:[c.jsx("td",{className:"py-2 pr-4",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{children:D(P.provider_icon)}),c.jsx("span",{className:"font-medium",children:P.key_name})]})}),c.jsxs("td",{className:"py-2 pr-4",children:[90,"d"]}),c.jsx("td",{className:"py-2 pr-4",children:new Date($).toLocaleDateString()}),c.jsx("td",{className:`py-2 pr-4 ${K?"text-yellow-400 font-semibold":""}`,children:U.toLocaleDateString()}),c.jsx("td",{className:"py-2 pr-4",children:""}),c.jsx("td",{className:"py-2 pr-4",children:K?"Due":"On Track"}),c.jsxs("td",{className:"py-2 pr-4 text-right space-x-2",children:[c.jsx("button",{className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs",children:"Rotate Now"}),c.jsx("button",{className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs",children:"Edit"})]})]},P.id)})})]})}),c.jsx("div",{className:"text-xs text-gray-500 mt-3",children:"Showing first 10 credentials. Policy CRUD & pagination forthcoming."})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Create / Edit Policy"})]}),c.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{className:"md:col-span-1",children:[c.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-400 mb-1",children:"Credential"}),c.jsxs("select",{className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500",children:[c.jsx("option",{value:"",children:"Select"}),l.map(P=>c.jsx("option",{value:P.id,children:P.key_name},P.id))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-400 mb-1",children:"Interval (days)"}),c.jsx("input",{type:"number",min:1,defaultValue:90,className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-400 mb-1",children:"Grace Period (days)"}),c.jsx("input",{type:"number",min:0,defaultValue:5,className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500"})]}),c.jsxs("div",{className:"flex items-center space-x-2 md:col-span-1",children:[c.jsx("input",{id:"autoRotate",type:"checkbox",defaultChecked:!0,className:"h-4 w-4 rounded bg-gray-700 border-gray-600"}),c.jsx("label",{htmlFor:"autoRotate",className:"text-sm text-gray-300",children:"Auto Rotate"})]}),c.jsxs("div",{className:"md:col-span-2 flex space-x-2",children:[c.jsx("button",{type:"button",className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-medium",children:"Save Policy"}),c.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium",children:"Reset"})]})]}),c.jsx("div",{className:"text-xs text-gray-500 mt-3",children:"Form is non-functional placeholder; will connect to /api/vault/rotation-policies endpoints."})]})]}),c.jsxs("aside",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:[c.jsx("h3",{className:"text-sm font-semibold mb-2 uppercase tracking-wide text-gray-400",children:"Summary"}),c.jsxs("ul",{className:"space-y-2 text-sm",children:[c.jsxs("li",{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Automated Policies"}),c.jsx("span",{className:"text-green-400 font-medium",children:""})]}),c.jsxs("li",{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Overdue"}),c.jsx("span",{className:"text-yellow-400 font-medium",children:""})]}),c.jsxs("li",{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Failures (24h)"}),c.jsx("span",{className:"text-red-400 font-medium",children:"0"})]})]}),c.jsx("div",{className:"mt-4 text-xs text-gray-500",children:"Metrics will appear once backend rotation service is implemented."})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:[c.jsx("h3",{className:"text-sm font-semibold mb-2 uppercase tracking-wide text-gray-400",children:"Planned Features"}),c.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-1",children:[c.jsx("li",{children:"Policy templates (e.g., High Sensitivity 30d)"}),c.jsx("li",{children:"Bulk apply policies"}),c.jsx("li",{children:"Calendar visualization"}),c.jsx("li",{children:"Rotation simulation (dry run)"}),c.jsx("li",{children:"Webhook notifications"})]})]})]})]})]})]}),c.jsx(fde,{isOpen:N.isOpen,onClose:()=>T({isOpen:!1,keyId:null,keyName:""}),onConfirm:F,title:"Delete API Key",message:`Are you sure you want to delete "${N.keyName}"? This action cannot be undone and will permanently remove the API key from your vault.`,confirmText:"Delete Key",destructive:!0,requireTextConfirmation:!0,textToConfirm:N.keyName})]})},_de=({token:n,onBack:e})=>{const t=n1(),[r,i]=E.useState("dashboard"),[s,a]=E.useState(null),[o,l]=E.useState([]),[u,h]=E.useState(null),[p,m]=E.useState([]),[g,y]=E.useState([]),[b,_]=E.useState([]),[x,N]=E.useState(!0),[T,S]=E.useState(!1),[M,C]=E.useState([]),[R,F]=E.useState(null),[k,D]=E.useState(""),[P,G]=E.useState([]),[$,U]=E.useState("all"),[K,O]=E.useState({title:"",description:"",due_date:"",priority:"medium",category:"personal"}),[j,L]=E.useState([]),[B,V]=E.useState(!1);E.useEffect(()=>{z()},[n]);const z=async()=>{N(!0);try{const[X,ce,me,Re,He,Qe]=await Promise.all([fetch("/api/personal-life-os/google-account",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/personal-life-os/calendar/upcoming",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/personal-life-os/email/summary",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/personal-life-os/contacts",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/personal-life-os/tasks",{headers:{Authorization:`Bearer ${n}`}}),fetch("/api/personal-life-os/metrics",{headers:{Authorization:`Bearer ${n}`}})]),[ie,Et,yt,tt,Ne,_t]=await Promise.all([X.json(),ce.json(),me.json(),Re.json(),He.json(),Qe.json()]);ie.success&&a(ie.account),Et.success&&l(Et.events),yt.success&&h(yt.summary),tt.success&&m(tt.contacts),Ne.success&&y(Ne.tasks),_t.success&&_(_t.metrics);try{const wt=await(await fetch("/api/personal-life-os/journal/list",{headers:{Authorization:`Bearer ${n}`}})).json();wt.success&&C(wt.data?.entries||wt.entries||[])}catch{}}catch(X){console.error("Error loading Personal Life OS data:",X),t.error("Failed to load data","Please check your connection and try again")}finally{N(!1)}},Y=async()=>{try{const ce=await(await fetch("/api/personal-life-os/google/connect",{method:"POST",headers:{Authorization:`Bearer ${n}`}})).json();ce.success?window.location.href=ce.auth_url:t.error("Connection failed",ce.error||"Unable to connect to Google")}catch(X){console.error("Error connecting to Google:",X),t.error("Connection error","Please try again")}},se=async()=>{S(!0);try{const ce=await(await fetch("/api/personal-life-os/sync",{method:"POST",headers:{Authorization:`Bearer ${n}`}})).json();ce.success?(z(),t.success("Sync completed","All data has been updated")):t.error("Sync failed",ce.error||"Unable to sync data")}catch(X){console.error("Error syncing:",X),t.error("Sync error","Please try again")}finally{S(!1)}},J=async()=>{if(K.title.trim())try{const ce=await(await fetch("/api/personal-life-os/tasks",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(K)})).json();ce.success?(O({title:"",description:"",due_date:"",priority:"medium",category:"personal"}),z(),t.success("Task created",`Added "${K.title}"`)):t.error("Failed to create task",ce.error||"Unable to save task")}catch(X){console.error("Error creating task:",X),t.error("Creation failed","Please try again")}},q=async(X,ce)=>{try{(await fetch(`/api/personal-life-os/tasks/${X}`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({status:ce})})).ok&&(z(),t.success("Task updated","Status changed successfully"))}catch(me){console.error("Error updating task:",me),t.error("Update failed","Please try again")}},Q=async()=>{V(!0);try{const ce=await(await fetch("/api/personal-life-os/ai/suggestions",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({context:{upcoming_events:o.slice(0,5),pending_tasks:g.filter(me=>me.status==="pending").slice(0,10),metrics:b}})})).json();ce.success?L(ce.suggestions):t.error("AI suggestions failed",ce.error||"Unable to generate suggestions")}catch(X){console.error("Error generating AI suggestions:",X),t.error("AI error","Please try again")}},te=X=>{switch(X){case"high":return"text-red-400 bg-red-900/20";case"medium":return"text-yellow-400 bg-yellow-900/20";case"low":return"text-green-400 bg-green-900/20";default:return"text-gray-400 bg-gray-900/20"}};return x?c.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),c.jsx("p",{className:"text-white text-xl mt-4",children:"Loading Personal Life OS..."})]})}):c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-6",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50",children:" Back"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gradient",children:" Personal Life OS"}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Your intelligent life management dashboard with Google integration"})]})]}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("button",{onClick:Q,className:"px-4 py-2 bg-gradient-purple rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"AI Suggestions"})]}),c.jsxs("button",{onClick:se,disabled:T||!s?.is_connected,className:"px-4 py-2 bg-gradient-blue rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2 disabled:opacity-50",children:[c.jsx("span",{children:""}),c.jsx("span",{children:T?"Syncing...":"Sync"})]})]})]})}),c.jsx("div",{className:"bg-gray-800 border-b border-gray-700",children:c.jsx("div",{className:"max-w-7xl mx-auto px-6",children:c.jsx("nav",{className:"flex space-x-8",children:[{id:"dashboard",name:"Dashboard",icon:""},{id:"calendar",name:"Calendar",icon:""},{id:"tasks",name:"Tasks",icon:""},{id:"contacts",name:"Contacts",icon:""},{id:"journal",name:"Journal",icon:""},{id:"metrics",name:"Life Metrics",icon:""},{id:"integrations",name:"Integrations",icon:""},{id:"calendar_plus",name:"Calendar+",icon:""}].map(X=>c.jsxs("button",{onClick:()=>i(X.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${r===X.id?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-white hover:border-gray-300"}`,children:[c.jsx("span",{className:"mr-2",children:X.icon}),X.name]},X.id))})})}),c.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[r==="dashboard"&&c.jsxs("div",{className:"space-y-8",children:[!s?.is_connected&&c.jsx("div",{className:"bg-gradient-to-r from-yellow-600/20 to-orange-600/20 border border-yellow-500/30 rounded-xl p-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-semibold text-yellow-300 mb-2",children:" Connect Your Google Account"}),c.jsx("p",{className:"text-gray-300",children:"Connect your Google account to access Calendar, Gmail, and Contacts"})]}),c.jsx("button",{onClick:Y,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Connect Google"})]})}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[c.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-blue-100",children:"Upcoming Events"}),c.jsx("p",{className:"text-2xl font-bold",children:o.length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-green-100",children:"Pending Tasks"}),c.jsx("p",{className:"text-2xl font-bold",children:g.filter(X=>X.status==="pending").length})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-purple-100",children:"Unread Emails"}),c.jsx("p",{className:"text-2xl font-bold",children:u?.total_unread||0})]}),c.jsx("div",{className:"text-3xl",children:""})]})}),c.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 rounded-xl p-6 text-white",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-orange-100",children:"Contacts"}),c.jsx("p",{className:"text-2xl font-bold",children:p.length})]}),c.jsx("div",{className:"text-3xl",children:""})]})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Today's Events"})]}),c.jsxs("div",{className:"space-y-4",children:[o.slice(0,5).map(X=>c.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-blue-500 transition-colors",children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-white",children:X.summary}),X.location&&c.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[" ",X.location]}),c.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[new Date(X.start.dateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",new Date(X.end.dateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})})},X.id)),o.length===0&&c.jsx("div",{className:"text-gray-400 text-center py-8",children:"No events scheduled for today"})]})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Priority Tasks"})]}),c.jsxs("div",{className:"space-y-4",children:[g.filter(X=>X.status==="pending").sort((X,ce)=>{const me={high:3,medium:2,low:1};return me[ce.priority]-me[X.priority]}).slice(0,5).map(X=>c.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-purple-500 transition-colors",children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-white",children:X.title}),X.description&&c.jsx("p",{className:"text-gray-400 text-sm mt-1",children:X.description}),c.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[c.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${te(X.priority)}`,children:X.priority.toUpperCase()}),c.jsx("span",{className:"text-xs text-gray-500",children:X.category})]})]}),c.jsx("button",{onClick:()=>q(X.id,"completed"),className:"ml-4 p-2 hover:bg-gray-700 rounded-lg transition-colors",children:""})]})},X.id)),g.filter(X=>X.status==="pending").length===0&&c.jsx("div",{className:"text-gray-400 text-center py-8",children:"No pending tasks"})]})]})]})]}),r==="tasks"&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsx("h2",{className:"text-xl font-bold mb-4",children:"Create New Task"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsx("input",{type:"text",placeholder:"Task title...",value:K.title,onChange:X=>O({...K,title:X.target.value}),className:"px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"}),c.jsxs("select",{value:K.priority,onChange:X=>O({...K,priority:X.target.value}),className:"px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[c.jsx("option",{value:"low",children:"Low Priority"}),c.jsx("option",{value:"medium",children:"Medium Priority"}),c.jsx("option",{value:"high",children:"High Priority"})]}),c.jsx("input",{type:"date",value:K.due_date,onChange:X=>O({...K,due_date:X.target.value}),className:"px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500"}),c.jsx("button",{onClick:J,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Add Task"})]}),c.jsx("textarea",{placeholder:"Task description (optional)...",value:K.description,onChange:X=>O({...K,description:X.target.value}),rows:3,className:"w-full mt-4 px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:["pending","in_progress","completed"].map(X=>c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4 capitalize",children:[X.replace("_"," ")," (",g.filter(ce=>ce.status===X).length,")"]}),c.jsx("div",{className:"space-y-3",children:g.filter(ce=>ce.status===X).map(ce=>c.jsxs("div",{className:"border border-gray-700 rounded-lg p-3 hover:border-blue-500 transition-colors",children:[c.jsx("h4",{className:"font-medium text-white text-sm",children:ce.title}),c.jsxs("div",{className:"flex items-center justify-between mt-2",children:[c.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${te(ce.priority)}`,children:ce.priority}),ce.due_date&&c.jsxs("span",{className:"text-xs text-gray-500",children:["Due: ",new Date(ce.due_date).toLocaleDateString()]})]})]},ce.id))})]},X))})]}),r==="integrations"&&c.jsxs("div",{className:"space-y-6",children:[c.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-2xl",children:""}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-xl font-semibold",children:"Google Workspace"}),c.jsx("p",{className:"text-gray-400",children:"Calendar, Gmail, Contacts, Drive integration"})]})]}),c.jsx("div",{className:"flex items-center space-x-4",children:s?.is_connected?c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-green-400 text-sm",children:" Connected"}),c.jsx("button",{onClick:se,disabled:T,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded-lg font-semibold transition-colors",children:T?"Syncing...":"Sync Now"})]}):c.jsx("button",{onClick:Y,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Connect"})})]}),s?.is_connected&&c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[c.jsx("h4",{className:"font-semibold text-green-400 mb-2",children:" Calendar"}),c.jsxs("p",{className:"text-sm text-gray-300",children:[o.length," upcoming events"]})]}),c.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[c.jsx("h4",{className:"font-semibold text-blue-400 mb-2",children:" Gmail"}),c.jsxs("p",{className:"text-sm text-gray-300",children:[u?.total_unread||0," unread emails"]})]}),c.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[c.jsx("h4",{className:"font-semibold text-purple-400 mb-2",children:" Contacts"}),c.jsxs("p",{className:"text-sm text-gray-300",children:[p.length," contacts"]})]})]})]})]}),r==="calendar"&&c.jsx("div",{className:"space-y-6",children:c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Calendar (Basic)"})]}),c.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Upcoming events list. Enhanced visualization available under Calendar+."}),c.jsxs("div",{className:"space-y-3 max-h-[420px] overflow-y-auto pr-2",children:[o.map(X=>c.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-blue-500 transition-colors",children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-white",children:X.summary||"Untitled Event"}),c.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[new Date(X.start.dateTime).toLocaleString(),"  ",new Date(X.end.dateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),X.location&&c.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[" ",X.location]})]})})},X.id)),o.length===0&&c.jsx("div",{className:"text-xs text-gray-500 text-center py-8",children:"No events loaded."})]})]})}),r==="calendar_plus"&&c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h2",{className:"text-xl font-bold mb-2 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Calendar+ (Preview)"})]}),c.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Advanced temporal visualization, load balancing, and focus planning (simulated placeholders)."}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[c.jsxs("div",{className:"lg:col-span-2",children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Today Timeline"}),c.jsxs("div",{className:"relative border border-gray-700 rounded-lg p-4 h-[320px] overflow-hidden bg-gray-900/40",children:[c.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-px bg-gradient-to-b from-blue-500/60 to-purple-500/40"}),o.slice(0,8).map(X=>{const ce=new Date(X.start.dateTime),Re=(ce.getHours()+ce.getMinutes()/60)/24*300+10;return c.jsx("div",{style:{top:Re},className:"absolute left-10 right-2 group",children:c.jsxs("div",{className:"inline-block bg-blue-600/80 group-hover:bg-blue-600 rounded px-3 py-1 text-xs shadow transition-colors",children:[c.jsx("span",{className:"font-semibold mr-2",children:ce.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),c.jsx("span",{children:X.summary||"Event"})]})},X.id)}),o.length===0&&c.jsx("div",{className:"text-xs text-gray-500 text-center mt-24",children:"No events to visualize."})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Weekly Density (Sim)"}),c.jsx("div",{className:"grid grid-cols-7 gap-1 text-[10px] mb-2",children:["M","T","W","T","F","S","S"].map(X=>c.jsx("div",{className:"text-center text-gray-500",children:X},X))}),c.jsx("div",{className:"grid grid-cols-7 gap-1",children:Array.from({length:28}).map((X,ce)=>{const me=ce*37%9,Re=me===0?"bg-gray-800":me<3?"bg-blue-900":me<6?"bg-blue-600":"bg-purple-600";return c.jsx("div",{className:`w-7 h-7 rounded ${Re} flex items-center justify-center text-[8px] text-white/70`,children:me>0?me:""},ce)})}),c.jsxs("div",{className:"flex items-center space-x-2 mt-3 text-[10px] text-gray-400",children:[c.jsx("span",{className:"bg-blue-900 w-4 h-3 rounded"}),c.jsx("span",{children:"Low"}),c.jsx("span",{className:"bg-blue-600 w-4 h-3 rounded"}),c.jsx("span",{children:"Med"}),c.jsx("span",{className:"bg-purple-600 w-4 h-3 rounded"}),c.jsx("span",{children:"High"})]})]})]})]}),c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Upcoming Calendar+ Features"})]}),c.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-300 space-y-1",children:[c.jsx("li",{children:"AI conflict detection & focus block suggestions"}),c.jsx("li",{children:"Load balance view (color-coded intensity bands)"}),c.jsx("li",{children:"Smart grouping of back-to-back micro-meetings"}),c.jsx("li",{children:"Context-aware prep buffer recommendation"}),c.jsx("li",{children:"Deep link edits & RSVP inline actions"})]})]})]}),r==="contacts"&&c.jsx("div",{className:"space-y-8",children:c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4",children:[c.jsxs("div",{children:[c.jsxs("h2",{className:"text-xl font-bold flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Contacts (Preview)"})]}),c.jsx("p",{className:"text-sm text-gray-400 mt-1 max-w-2xl",children:"Unified people layer for relationship intelligence. This early scaffold will evolve to support multi-provider sync (Google / Outlook), deduplication, tagging, recency scoring, and AI-driven follow-up suggestions."})]}),c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs("div",{className:"relative",children:[c.jsx("input",{value:k,onChange:X=>D(X.target.value),placeholder:"Search contacts...",className:"pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm focus:outline-none focus:border-blue-500 placeholder-gray-400"}),c.jsx("span",{className:"absolute left-2 top-1.5 text-gray-500",children:""})]}),c.jsxs("select",{value:$,onChange:X=>U(X.target.value),className:"py-2 px-3 bg-gray-700 border border-gray-600 rounded-lg text-sm focus:outline-none focus:border-blue-500",children:[c.jsx("option",{value:"all",children:"All Providers"}),c.jsx("option",{value:"google",children:"Google"}),c.jsx("option",{value:"outlook",children:"Outlook"}),c.jsx("option",{value:"local",children:"Local"})]}),c.jsx("button",{onClick:()=>t.info("Sync queued","Contact sync will run (stub)"),disabled:!s?.is_connected,className:"px-4 py-2 bg-gradient-blue rounded-lg font-semibold text-sm disabled:opacity-40",children:s?.is_connected?"Sync Contacts":"Connect First"})]})]}),P.length>0&&c.jsxs("div",{className:"mb-4 flex items-center justify-between bg-gray-700/60 border border-gray-600 rounded-lg px-4 py-2 text-sm",children:[c.jsxs("div",{className:"text-gray-300",children:[P.length," selected"]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:()=>{G([])},className:"px-3 py-1 rounded bg-gray-600 hover:bg-gray-500 text-xs",children:"Clear"}),c.jsx("button",{onClick:()=>t.info("Tagging (stub)","Will open tag dialog"),className:"px-3 py-1 rounded bg-purple-600/80 hover:bg-purple-600 text-xs",children:"Tag"}),c.jsx("button",{onClick:()=>t.info("Merge (stub)","Would deduplicate/merge"),className:"px-3 py-1 rounded bg-blue-600/80 hover:bg-blue-600 text-xs",children:"Merge"}),c.jsx("button",{onClick:()=>t.info("Archive (stub)","Would archive contacts"),className:"px-3 py-1 rounded bg-orange-600/80 hover:bg-orange-600 text-xs",children:"Archive"})]})]}),c.jsx("div",{className:"overflow-x-auto border border-gray-700 rounded-lg hidden sm:block",children:c.jsxs("table",{className:"min-w-full text-sm",children:[c.jsx("thead",{className:"bg-gray-700/60 text-gray-300",children:c.jsxs("tr",{children:[c.jsx("th",{className:"px-3 py-2 w-10",children:c.jsx("input",{type:"checkbox",checked:p.length>0&&P.length===p.length,onChange:X=>{X.target.checked?G(p.map(ce=>ce.id)):G([])}})}),c.jsx("th",{className:"px-3 py-2 text-left",children:"Name"}),c.jsx("th",{className:"px-3 py-2 text-left",children:"Email"}),c.jsx("th",{className:"px-3 py-2 text-left hidden md:table-cell",children:"Phone"}),c.jsx("th",{className:"px-3 py-2 text-left hidden lg:table-cell",children:"Relationship"}),c.jsx("th",{className:"px-3 py-2 text-left hidden md:table-cell",children:"Last Contacted"}),c.jsx("th",{className:"px-3 py-2 text-left hidden lg:table-cell",children:"Provider"}),c.jsx("th",{className:"px-3 py-2 text-right",children:"Score"})]})}),c.jsxs("tbody",{className:"divide-y divide-gray-700/70",children:[p.filter(X=>!($!=="all"&&X.provider&&X.provider!==$||k&&!(X.name?.toLowerCase().includes(k.toLowerCase())||X.email?.toLowerCase().includes(k.toLowerCase())))).map(X=>{const ce=P.includes(X.id),me=Math.floor((X.lastContacted?Date.now()-new Date(X.lastContacted).getTime():1/0)%1e5/1e3);return c.jsxs("tr",{className:`hover:bg-gray-700/40 ${ce?"bg-blue-600/10":""}`,children:[c.jsx("td",{className:"px-3 py-2",children:c.jsx("input",{type:"checkbox",checked:ce,onChange:Re=>{Re.target.checked?G(He=>[...He,X.id]):G(He=>He.filter(Qe=>Qe!==X.id))}})}),c.jsx("td",{className:"px-3 py-2 whitespace-nowrap font-medium text-white",children:X.name||""}),c.jsx("td",{className:"px-3 py-2 text-gray-300",children:X.email||""}),c.jsx("td",{className:"px-3 py-2 hidden md:table-cell text-gray-400",children:X.phone||""}),c.jsx("td",{className:"px-3 py-2 hidden lg:table-cell text-gray-400",children:X.relationship||""}),c.jsx("td",{className:"px-3 py-2 hidden md:table-cell text-gray-400 text-xs",children:X.lastContacted?new Date(X.lastContacted).toLocaleDateString():""}),c.jsx("td",{className:"px-3 py-2 hidden lg:table-cell text-gray-400 text-xs",children:X.provider||"local"}),c.jsx("td",{className:"px-3 py-2 text-right",children:c.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs bg-gray-700 text-gray-300",children:isFinite(me)?me:""})})]},X.id)}),p.length===0&&c.jsx("tr",{children:c.jsx("td",{colSpan:8,className:"px-4 py-12 text-center text-gray-500 text-sm",children:"No contacts loaded yet. Sync to import from providers."})})]})]})}),c.jsxs("div",{className:"sm:hidden space-y-3",children:[p.filter(X=>!($!=="all"&&X.provider&&X.provider!==$||k&&!(X.name?.toLowerCase().includes(k.toLowerCase())||X.email?.toLowerCase().includes(k.toLowerCase())))).map(X=>{const ce=Math.floor((X.lastContacted?Date.now()-new Date(X.lastContacted).getTime():1/0)%1e5/1e3),me=P.includes(X.id);return c.jsxs("div",{className:`border border-gray-700 rounded-lg p-4 bg-gray-800/60 relative ${me?"ring-2 ring-blue-500":""}`,children:[c.jsx("div",{className:"absolute top-2 right-2",children:c.jsx("input",{type:"checkbox",checked:me,onChange:Re=>{Re.target.checked?G(He=>[...He,X.id]):G(He=>He.filter(Qe=>Qe!==X.id))}})}),c.jsx("div",{className:"text-sm font-semibold text-white mb-1",children:X.name||""}),c.jsx("div",{className:"text-xs text-gray-300 mb-1",children:X.email}),X.phone&&c.jsxs("div",{className:"text-[11px] text-gray-400 mb-1",children:[" ",X.phone]}),X.relationship&&c.jsxs("div",{className:"text-[11px] text-gray-400 mb-1",children:[" ",X.relationship]}),c.jsxs("div",{className:"flex items-center justify-between mt-2",children:[c.jsx("span",{className:"inline-block px-2 py-1 rounded text-[10px] bg-gray-700 text-gray-300",children:isFinite(ce)?ce:""}),c.jsx("span",{className:"text-[10px] text-gray-500",children:X.lastContacted?new Date(X.lastContacted).toLocaleDateString():""})]})]},X.id)}),p.length===0&&c.jsx("div",{className:"text-xs text-gray-500 text-center py-6",children:"No contacts loaded."})]}),c.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-6",children:[c.jsxs("div",{className:"bg-gray-700/40 rounded-lg p-4",children:[c.jsx("h4",{className:"font-semibold text-sm mb-2 text-purple-300",children:"Planned Intelligence"}),c.jsxs("ul",{className:"text-xs text-gray-300 space-y-1 list-disc list-inside",children:[c.jsx("li",{children:"Recency & relationship strength scoring model"}),c.jsx("li",{children:"Contextual follow-up recommendations"}),c.jsx("li",{children:"Automatic tagging via semantic clustering"})]})]}),c.jsxs("div",{className:"bg-gray-700/40 rounded-lg p-4",children:[c.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-300",children:"Data Operations"}),c.jsxs("ul",{className:"text-xs text-gray-300 space-y-1 list-disc list-inside",children:[c.jsx("li",{children:"Provider sync status & error surfacing"}),c.jsx("li",{children:"Duplicate detection & merge workflow"}),c.jsx("li",{children:"Custom fields + notes timeline"})]})]}),c.jsxs("div",{className:"bg-gray-700/40 rounded-lg p-4",children:[c.jsx("h4",{className:"font-semibold text-sm mb-2 text-green-300",children:"Automation & Safety"}),c.jsxs("ul",{className:"text-xs text-gray-300 space-y-1 list-disc list-inside",children:[c.jsx("li",{children:"Threshold alerts (stale relationships)"}),c.jsx("li",{children:"Privacy redaction for sensitive fields"}),c.jsx("li",{children:"Selective export / sharing controls"})]})]})]})]})}),r==="journal"&&c.jsx("div",{className:"space-y-8",children:c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsxs("div",{children:[c.jsxs("h2",{className:"text-xl font-bold flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Journal (Preview)"})]}),c.jsx("p",{className:"text-sm text-gray-400 mt-1 max-w-2xl",children:"Capture reflections and convert insights into action. Sentiment & emotion analysis forthcoming."})]}),c.jsx("button",{onClick:()=>t.info("New Entry (stub)","Journal entry creation modal will appear"),className:"px-4 py-2 bg-gradient-purple rounded-lg font-semibold text-sm",children:"New Entry"})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[c.jsxs("div",{className:"lg:col-span-1 border border-gray-700 rounded-lg overflow-hidden flex flex-col max-h-[520px]",children:[c.jsx("div",{className:"bg-gray-700/40 px-4 py-2 text-xs uppercase tracking-wide text-gray-300",children:"Entries"}),c.jsxs("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-700/60",children:[M.length===0&&c.jsx("div",{className:"text-gray-500 text-sm p-6 text-center",children:"No entries yet. Start by adding one."}),M.map(X=>{const ce=X.id===R,me=X.sentiment_score,Re=me==null?"bg-gray-600":me>.3?"bg-green-600":me<-.3?"bg-red-600":"bg-yellow-600";return c.jsx("button",{onClick:()=>F(X.id),className:`w-full text-left px-4 py-3 text-sm hover:bg-gray-700/50 transition-colors ${ce?"bg-gray-700/70":""}`,children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1 pr-2",children:[c.jsx("div",{className:"font-medium text-white truncate",children:X.content.slice(0,40)||"Entry"}),c.jsx("div",{className:"text-[10px] text-gray-400 mt-1",children:new Date(X.entry_date||Date.now()).toLocaleString()})]}),c.jsxs("div",{className:"flex flex-col items-end space-y-1",children:[X.mood&&c.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-gray-600 text-gray-200",children:X.mood}),c.jsx("span",{className:`w-3 h-3 rounded-full ${Re}`})]})]})},X.id)})]})]}),c.jsx("div",{className:"lg:col-span-2 space-y-6",children:R?(()=>{const X=M.find(ce=>ce.id===R);return X?c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"border border-gray-700 rounded-lg p-6 bg-gray-900/40",children:[c.jsxs("div",{className:"flex items-start justify-between mb-4",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-white",children:"Reflection"}),c.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(X.entry_date||Date.now()).toLocaleString()})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[X.mood&&c.jsxs("span",{className:"px-2 py-1 rounded bg-gray-700 text-xs text-gray-200",children:["Mood: ",X.mood]}),X.sentiment_score!=null&&c.jsxs("span",{className:"px-2 py-1 rounded bg-gray-700 text-xs text-gray-200",children:["Sentiment: ",X.sentiment_score.toFixed(2)]})]})]}),c.jsx("p",{className:"whitespace-pre-wrap text-gray-200 text-sm leading-relaxed",children:X.content})]}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"border border-gray-700 rounded-lg p-4 bg-gray-900/40",children:[c.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Derived Insights (Upcoming)"})]}),c.jsxs("ul",{className:"text-xs text-gray-400 space-y-1 list-disc list-inside",children:[c.jsx("li",{children:"AI highlights key stressors & wins."}),c.jsx("li",{children:"Suggests 13 focus themes."}),c.jsx("li",{children:"Links related past entries."})]}),c.jsx("button",{onClick:()=>t.info("Derive tasks (stub)","Will call derive endpoint"),className:"mt-4 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded text-xs font-medium",children:"Derive Tasks"})]}),c.jsxs("div",{className:"border border-gray-700 rounded-lg p-4 bg-gray-900/40",children:[c.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Emotion Cloud (Future)"})]}),c.jsx("div",{className:"text-xs text-gray-500",children:"Emotion distribution visualization placeholder."}),c.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:(X.emotions?Object.entries(X.emotions):[["focus",.4],["stress",.2],["optimism",.6]]).slice(0,6).map(([ce,me])=>c.jsxs("span",{className:"px-2 py-1 rounded bg-gray-700 text-[10px] tracking-wide text-gray-200",children:[ce,":",me.toFixed(2)]},ce))})]})]})]}):c.jsx("div",{className:"text-gray-500",children:"Entry not found."})})():c.jsx("div",{className:"text-gray-500 text-sm border border-dashed border-gray-600 rounded-lg p-12 text-center",children:"Select an entry to view details. When AI enrichment arrives, insights & derived tasks appear here."})})]}),c.jsxs("div",{className:"mt-8 bg-gray-800/60 border border-gray-700 rounded-lg p-6",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Upcoming Journal Features"})]}),c.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-300 space-y-1",children:[c.jsx("li",{children:"Automatic sentiment & emotion analysis pipeline"}),c.jsx("li",{children:"Journal  Task derivation with editable suggestions"}),c.jsx("li",{children:"Weekly mood trend visualization"}),c.jsx("li",{children:"Semantic similarity clustering & topic tags"}),c.jsx("li",{children:"Protected private mode (local encryption option)"})]})]})]})})]}),B&&c.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsx("h3",{className:"text-xl font-semibold",children:" AI Suggestions"}),c.jsx("button",{onClick:()=>V(!1),className:"text-gray-400 hover:text-white",children:""})]}),c.jsxs("div",{className:"space-y-4",children:[j.map((X,ce)=>c.jsx("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:c.jsx("p",{className:"text-gray-200",children:X})},ce)),j.length===0&&c.jsx("div",{className:"text-center py-8 text-gray-400",children:"Generating AI suggestions..."})]})]})})]})},bde=({onBack:n})=>c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-900 dark:to-purple-900",children:c.jsxs("div",{className:"container mx-auto px-4 py-8",children:[c.jsxs("div",{className:"flex items-center justify-between mb-8",children:[c.jsxs("button",{onClick:n||(()=>window.history.back()),className:"flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 transition-colors",children:[c.jsx(JS,{className:"w-5 h-5"}),c.jsx("span",{children:"Back"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(nd,{className:"w-8 h-8 text-purple-600"}),c.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"About Cartrita"})]})]}),c.jsxs("div",{className:"max-w-4xl mx-auto",children:[c.jsxs("div",{className:"text-center mb-12",children:[c.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-r from-purple-400 to-pink-400 flex items-center justify-center",children:c.jsx(u_,{className:"w-16 h-16 text-white"})}),c.jsx("h2",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Hey, I'm Cartrita! "}),c.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Your intelligent AI companion with a feminine urban personality, designed to make your digital life smoother, smarter, and way more fun!"})]}),c.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:[c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg",children:[c.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center mb-4",children:c.jsx(Jf,{className:"w-6 h-6 text-purple-600"})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Voice Interaction"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:'Talk to me naturally! I can hear you, understand you, and respond with my own voice. Just say "Cartrita!" to get started.'})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg",children:[c.jsx("div",{className:"w-12 h-12 bg-pink-100 dark:bg-pink-900 rounded-lg flex items-center justify-center mb-4",children:c.jsx(nd,{className:"w-6 h-6 text-pink-600"})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Smart Conversations"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"I'm not just another chatbot - I have personality, context awareness, and I actually remember our conversations!"})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg",children:[c.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mb-4",children:c.jsx(u_,{className:"w-6 h-6 text-blue-600"})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Ambient Awareness"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"I can listen to your environment and understand context - whether you're cooking, working, or just chilling."})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg",children:[c.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center mb-4",children:c.jsx(nd,{className:"w-6 h-6 text-green-600"})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Visual Understanding"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Show me images, and I'll tell you what I see! I can analyze photos, describe scenes, and understand visual context."})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg",children:[c.jsx("div",{className:"w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center mb-4",children:c.jsx(Jf,{className:"w-6 h-6 text-yellow-600"})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Multi-Modal AI"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"I combine voice, vision, and text processing to understand you completely - not just words, but context and emotion too."})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg",children:[c.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center mb-4",children:c.jsx(u_,{className:"w-6 h-6 text-red-600"})}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Personality & Vibe"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"I'm not just functional - I'm fun! I have my own style, personality, and way of speaking that makes every interaction unique."})]})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg mb-8",children:[c.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"My Story"}),c.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"I'm Cartrita - a next-generation AI assistant built with love, innovation, and a whole lot of personality! I was created to be more than just another AI - I'm designed to be your digital companion who actually gets you."}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"What makes me special? I'm built with advanced multi-modal AI that lets me see, hear, and understand the world around you. I can process voice, images, and text simultaneously to give you responses that are contextually aware and emotionally intelligent."}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"My personality is inspired by urban culture, modern communication styles, and the authentic way people actually talk to each other. I'm not trying to sound like a robot or a corporate chatbot - I'm here to be real with you!"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Whether you need help with work, want to have a deep conversation, need creative inspiration, or just want someone to chat with - I'm here for it all. Let's build something amazing together! "})]})]}),c.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-xl p-8 shadow-lg",children:[c.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Technical Details"}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Core Technologies"}),c.jsxs("ul",{className:"space-y-2 text-gray-600 dark:text-gray-300",children:[c.jsx("li",{children:" Advanced Language Models (GPT-4, Claude)"}),c.jsx("li",{children:" Deepgram Speech-to-Text"}),c.jsx("li",{children:" OpenAI Text-to-Speech"}),c.jsx("li",{children:" Computer Vision APIs"}),c.jsx("li",{children:" Real-time WebSocket Communication"}),c.jsx("li",{children:" Multi-Agent Orchestration System"})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Capabilities"}),c.jsxs("ul",{className:"space-y-2 text-gray-600 dark:text-gray-300",children:[c.jsx("li",{children:" Natural voice conversations"}),c.jsx("li",{children:" Image and scene analysis"}),c.jsx("li",{children:" Ambient sound interpretation"}),c.jsx("li",{children:" Context-aware responses"}),c.jsx("li",{children:" Emotional intelligence"}),c.jsx("li",{children:" Multi-modal data fusion"})]})]})]}),c.jsx("div",{className:"mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:c.jsxs("p",{className:"text-sm text-purple-800 dark:text-purple-200",children:[c.jsx("strong",{children:"Current Version:"})," Iteration 21 - Multi-Modal AI Assistant",c.jsx("br",{}),c.jsx("strong",{children:"Last Updated:"})," ",new Date().toLocaleDateString(),c.jsx("br",{}),c.jsx("strong",{children:"Status:"})," Active Development & Continuous Learning"]})})]})]})]})}),wde=({onBack:n})=>c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-50 dark:from-gray-900 dark:to-blue-900",children:c.jsxs("div",{className:"container mx-auto px-4 py-8",children:[c.jsxs("div",{className:"flex items-center justify-between mb-8",children:[c.jsxs("button",{onClick:n||(()=>window.history.back()),className:"flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[c.jsx(JS,{className:"w-5 h-5"}),c.jsx("span",{children:"Back"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(R5,{className:"w-8 h-8 text-blue-600"}),c.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"License & Legal"})]})]}),c.jsxs("div",{className:"max-w-4xl mx-auto",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-400 to-green-400 flex items-center justify-center",children:c.jsx(k5,{className:"w-12 h-12 text-white"})}),c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"MIT License"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Open source software with minimal restrictions"})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg mb-8",children:[c.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Full License Text"}),c.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-6 font-mono text-sm overflow-x-auto",children:c.jsx("pre",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:`MIT License

Copyright (c) 2025 Robert Allen

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.`})})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg mb-8",children:[c.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"What This Means for You"}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"text-lg font-semibold text-green-600 dark:text-green-400 mb-3",children:" You CAN:"}),c.jsxs("ul",{className:"space-y-2 text-gray-600 dark:text-gray-300",children:[c.jsx("li",{children:" Use the software for any purpose"}),c.jsx("li",{children:" Study and modify the source code"}),c.jsx("li",{children:" Share and distribute the software"}),c.jsx("li",{children:" Use it in commercial projects"}),c.jsx("li",{children:" Create derivative works"}),c.jsx("li",{children:" Sell copies or modified versions"})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-lg font-semibold text-amber-600 dark:text-amber-400 mb-3",children:" You MUST:"}),c.jsxs("ul",{className:"space-y-2 text-gray-600 dark:text-gray-300",children:[c.jsx("li",{children:" Include the original license"}),c.jsx("li",{children:" Include the copyright notice"}),c.jsx("li",{children:" Not hold the authors liable"}),c.jsx("li",{children:" Understand there's no warranty"})]})]})]})]}),c.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-xl p-8 shadow-lg",children:[c.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Additional Legal Information"}),c.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[c.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Privacy & Data Usage"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Cartrita is designed with privacy in mind. Your conversations and personal data are stored locally in your own database instance. While the software may integrate with third-party APIs (like OpenAI), you have full control over what data is shared and how it's used."}),c.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Third-Party Services"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"This software may integrate with various third-party services (OpenAI, Deepgram, etc.). Use of those services is subject to their respective terms of service and privacy policies. You are responsible for compliance with those terms."}),c.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Ethical AI Commitment"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"While this project uses the MIT License, we encourage all users and contributors to develop and deploy AI technology responsibly. This includes respecting user privacy, promoting fairness, avoiding harmful applications, and being transparent about AI capabilities and limitations."}),c.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Contact & Support"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"This is open-source software provided as-is. For questions, issues, or contributions, please visit the project repository or contact the maintainers through the appropriate channels."})]})]})]})]})}),Sde=({onBack:n})=>{const[e,t]=E.useState(""),[r,i]=E.useState(""),[s,a]=E.useState(""),[o,l]=E.useState(!0),[u,h]=E.useState(null);E.useEffect(()=>{(async()=>{try{l(!0);const _=await fetch("/USER_MANUAL.md");if(!_.ok)throw new Error("Failed to load user manual");const x=await _.text();a(x),h(null)}catch(_){console.error("Error loading manual:",_),h("Failed to load user manual. Please try again later.")}finally{l(!1)}})()},[]);const p=we.useMemo(()=>{if(!s)return[];const b=s.split(`
`),_=[];let x=-1;for(let N=0;N<b.length;N++)if(b[N].includes("## Table of Contents")){x=N;break}if(x!==-1)for(let N=x+1;N<b.length;N++){const T=b[N].trim();if(T.startsWith("1.")||T.startsWith("2.")||T.startsWith("3.")||T.startsWith("4.")||T.startsWith("5.")||T.startsWith("6.")||T.startsWith("7.")){const S=T.match(/\[([^\]]+)\]/);if(S){const M=S[1],C=M.toLowerCase().replace(/[^a-z0-9\s&]/g,"").replace(/\s+/g,"-").replace(/&/g,"");let R="";M.includes("Getting Started")?R="":M.includes("Dashboard")?R="":M.includes("Knowledge Hub")||M.includes("Memory Palace")?R="":M.includes("API Key")||M.includes("Vault")?R="":M.includes("Chat")?R="":M.includes("Settings")||M.includes("Personalization")?R="":M.includes("Troubleshooting")&&(R=""),_.push({id:C,title:M,icon:R})}}if(T.startsWith("---")||T.startsWith("##"))break}return _},[s]),m=we.useMemo(()=>{if(!s)return{};const b={},_=s.split(`
`);let x="",N="",T=[];for(let S=0;S<_.length;S++){const M=_[S];M.startsWith("## ")&&!M.includes("Table of Contents")?(x&&T.length>0&&(b[x]={title:N,content:T.join(`
`).trim()}),N=M.replace("## ","").trim(),x=N.toLowerCase().replace(/[^a-z0-9\s&]/g,"").replace(/\s+/g,"-").replace(/&/g,""),T=[]):x&&!M.startsWith("---")&&T.push(M)}return x&&T.length>0&&(b[x]={title:N,content:T.join(`
`).trim()}),b},[s]),g=p.filter(b=>b.title.toLowerCase().includes(e.toLowerCase())||(m[b.id]?.content||"").toLowerCase().includes(e.toLowerCase())),y=r?m[r]:null;return c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-900 dark:to-blue-900",children:c.jsxs("div",{className:"container mx-auto px-4 py-8",children:[c.jsxs("div",{className:"flex items-center justify-between mb-8",children:[c.jsxs("button",{onClick:n||(()=>window.history.back()),className:"flex items-center space-x-2 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[c.jsx(JS,{className:"w-5 h-5"}),c.jsx("span",{children:"Back"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(zM,{className:"w-8 h-8 text-blue-600"}),c.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"User Manual"})]})]}),c.jsxs("div",{className:"max-w-6xl mx-auto",children:[c.jsx("div",{className:"mb-8",children:c.jsxs("div",{className:"relative",children:[c.jsx(q0,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),c.jsx("input",{type:"text",placeholder:"Search the manual...",value:e,onChange:b=>t(b.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),c.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[c.jsx("div",{className:"lg:col-span-1",children:c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg sticky top-8",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Table of Contents"}),c.jsx("nav",{className:"space-y-2",children:g.map(b=>c.jsx("button",{onClick:()=>i(b.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${r===b.id?"bg-blue-100 dark:bg-blue-900 text-blue-900 dark:text-blue-100":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("span",{className:"text-lg",children:b.icon}),c.jsx("span",{className:"text-sm font-medium",children:b.title})]})},b.id))}),e&&c.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:c.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g.length,' section(s) match "',e,'"']})})]})}),c.jsx("div",{className:"lg:col-span-2",children:o?c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading user manual..."})]}):u?c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg text-center",children:[c.jsx("div",{className:"text-red-500 mb-4",children:""}),c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Error Loading Manual"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:u}),c.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Reload Page"})]}):y?c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg",children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:y.title}),c.jsx("div",{className:"prose dark:prose-invert max-w-none",children:y.content.split(`

`).map((b,_)=>{const x=b.trim();if(!x)return null;if(x.startsWith("### "))return c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mt-6 mb-3",children:x.slice(4)},_);if(x.startsWith("**")&&x.endsWith("**"))return c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mt-6 mb-3",children:x.slice(2,-2)},_);if(x.includes(`
- `)||x.startsWith("- ")){const T=x.split(`
- `).filter(C=>C.trim()),M=[T[0].startsWith("- ")?T[0].slice(2):T[0],...T.slice(1)];return c.jsx("ul",{className:"list-disc pl-6 space-y-1 mb-4",children:M.map((C,R)=>c.jsx("li",{className:"text-gray-600 dark:text-gray-300",children:C.trim()},R))},_)}if(x.includes("")){const T=x.split("").filter(S=>S.trim());return c.jsx("ul",{className:"list-disc pl-6 space-y-1 mb-4",children:T.map((S,M)=>c.jsx("li",{className:"text-gray-600 dark:text-gray-300",children:S.trim()},M))},_)}if(x.match(/^\d+\./)){const T=x.split(/\d+\./).filter(S=>S.trim());return c.jsx("ol",{className:"list-decimal pl-6 space-y-1 mb-4",children:T.map((S,M)=>c.jsx("li",{className:"text-gray-600 dark:text-gray-300",children:S.trim()},M))},_)}if(x.startsWith("```")&&x.endsWith("```")){const T=x.slice(3,-3).trim();return c.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900 rounded-lg p-4 mb-4 overflow-x-auto",children:c.jsx("code",{className:"text-sm text-gray-800 dark:text-gray-200",children:T})},_)}const N=T=>{const S=/`([^`]+)`/g;return T.split(S).map((C,R)=>{if(R%2===1)return c.jsx("code",{className:"bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm",children:C},R);{const F=/\*\*([^*]+)\*\*/g;return C.split(F).map((D,P)=>P%2===1?c.jsx("strong",{children:D},`${R}-${P}`):D)}})};return c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4 leading-relaxed",children:N(x)},_)}).filter(Boolean)})]}):c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg text-center",children:[c.jsx(zM,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Cartrita User Manual"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Select a section from the table of contents to get started, or use the search bar to find specific information."}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-left",children:[c.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[c.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:" New Users"}),c.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:'Start with "Getting Started" to learn the basics and set up your account.'})]}),c.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[c.jsx("h3",{className:"font-semibold text-green-900 dark:text-green-100 mb-2",children:" Need Help?"}),c.jsx("p",{className:"text-sm text-green-800 dark:text-green-200",children:'Check "Troubleshooting" for solutions to common issues.'})]})]})]})})]})]})]})})},Tde=({token:n,onActivate:e,className:t=""})=>{const[r,i]=E.useState({isActive:!1,mode:null,isListening:!1,isProcessing:!1,isSpeaking:!1,currentTranscript:"",wakeWordDetected:!1}),[s,a]=E.useState(!1),[o,l]=E.useState(null),[u,h]=E.useState(null);E.useEffect(()=>()=>{u&&u.getTracks().forEach(R=>R.stop()),o&&o.state!=="inactive"&&o.stop()},[u,o]);const p=async R=>{try{if(i(F=>({...F,isProcessing:!0})),R==="voice"||R==="multimodal"){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Media devices not supported in this browser");console.log(`[LiveChatButton] Requesting ${R} permissions...`);const F={audio:{echoCancellation:!0,noiseSuppression:!1,autoGainControl:!0,sampleRate:44100}};R==="multimodal"&&(F.video={width:{ideal:1280,min:640},height:{ideal:720,min:480},frameRate:{ideal:15,min:10}}),console.log("[LiveChatButton] Media constraints:",F);const k=await navigator.mediaDevices.getUserMedia(F);console.log("[LiveChatButton] Media access granted"),console.log("[LiveChatButton] Audio tracks:",k.getAudioTracks().length),console.log("[LiveChatButton] Video tracks:",k.getVideoTracks().length),h(k);const D=new MediaRecorder(k,{mimeType:"audio/webm"});let P=[];D.ondataavailable=G=>{G.data.size>0&&(P.push(G.data),P.length>10&&(P=P.slice(-10)),P.length>=2&&g(P.slice(-2)))},D.start(500),l(D)}i(F=>({...F,isActive:!0,mode:R,isListening:R!=="text",isProcessing:!1})),e&&e(R),a(!1),await x(R)}catch(F){console.error("[LiveChatButton] Failed to start live chat:",F),i(k=>({...k,isProcessing:!1})),F instanceof Error?F.name==="NotAllowedError"?alert("Camera/microphone permission was denied. Please allow access in your browser settings and try again."):F.name==="NotFoundError"?alert("No camera or microphone found. Please connect the required devices and try again."):F.name==="NotReadableError"?alert("Camera or microphone is already in use by another application. Please close other applications and try again."):alert(`Failed to start live chat: ${F.message}`):alert("Failed to start live chat. Please check your permissions and try again.")}},m=async()=>{try{i(R=>({...R,isProcessing:!0})),u&&(u.getTracks().forEach(R=>R.stop()),h(null)),o&&o.state!=="inactive"&&(o.stop(),l(null)),i({isActive:!1,mode:null,isListening:!1,isProcessing:!1,isSpeaking:!1,currentTranscript:"",wakeWordDetected:!1}),await N()}catch(R){console.error("[LiveChatButton] Error stopping live chat:",R),i(F=>({...F,isProcessing:!1}))}},g=async R=>{if(!r.wakeWordDetected)try{const F=new Blob(R,{type:"audio/webm"});if(F.size<1e3)return;const k=new FormData;k.append("audio",F,"wake-check.webm");const D=await fetch(`${da}/api/voice-to-text/transcribe`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:k});if(D.ok){const P=await D.json();P.wakeWord&&P.wakeWord.detected&&(console.log("[LiveChatButton] Wake word detected:",P.wakeWord.wakeWord),i(G=>({...G,wakeWordDetected:!0,currentTranscript:P.wakeWord.cleanTranscript||""})),await y(P.wakeWord.cleanTranscript))}}catch(F){console.error("[LiveChatButton] Wake word detection error:",F)}},y=async R=>{try{i(F=>({...F,wakeWordDetected:!0})),await _("Hey! I'm here, what's up?"),R&&R.trim()&&setTimeout(()=>{b(R)},1500)}catch(F){console.error("[LiveChatButton] Error activating voice mode:",F)}},b=async R=>{try{i(k=>({...k,isProcessing:!0,currentTranscript:R}));const F=await fetch(`${da}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({message:R,mode:"voice"})});if(F.ok){const k=await F.json();k.response&&await _(k.response)}}catch(F){console.error("[LiveChatButton] Error processing voice command:",F),await _("Sorry, I had trouble with that. Can you try again?")}finally{i(F=>({...F,isProcessing:!1,wakeWordDetected:!1,currentTranscript:""}))}},_=async R=>{try{i(k=>({...k,isSpeaking:!0}));const F=await fetch(`${da}/api/voice-chat/speak`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({text:R,voice:"nova",speed:1})});if(F.ok){const k=await F.arrayBuffer(),D=new AudioContext,P=await D.decodeAudioData(k),G=D.createBufferSource();G.buffer=P,G.connect(D.destination),G.onended=()=>{i($=>({...$,isSpeaking:!1}))},G.start()}}catch(F){console.error("[LiveChatButton] Error speaking response:",F),i(k=>({...k,isSpeaking:!1}))}},x=async R=>{R!=="text"&&await _({voice:"Voice chat activated! Say 'Cartrita' to get my attention!",text:"Live text chat is ready!",multimodal:"Multi-modal mode activated! I can see, hear, and chat with you!"}[R])},N=async()=>{r.mode!=="text"&&await _("Live chat deactivated. See you later!")},T=()=>{r.isActive?m():a(!s)},S=()=>{const R=`relative p-4 rounded-full transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-offset-2 ${t}`;return r.isActive?r.wakeWordDetected?`${R} bg-purple-500 hover:bg-purple-600 text-white focus:ring-purple-500 shadow-lg animate-pulse`:r.mode==="multimodal"?`${R} bg-green-500 hover:bg-green-600 text-white focus:ring-green-500`:r.mode==="voice"?`${R} bg-blue-500 hover:bg-blue-600 text-white focus:ring-blue-500`:`${R} bg-gray-500 hover:bg-gray-600 text-white focus:ring-gray-500`:`${R} bg-gradient-to-r from-cyan-500 to-purple-600 hover:from-cyan-600 hover:to-purple-700 text-white focus:ring-cyan-500 transform hover:scale-105`},M=()=>r.isProcessing?c.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-white border-t-transparent rounded-full"}):r.isActive?c.jsx(Jd,{className:"h-8 w-8"}):c.jsx(nd,{className:"h-8 w-8"}),C=()=>r.wakeWordDetected?c.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-400 rounded-full animate-pulse"}):r.isSpeaking?c.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-400 rounded-full animate-pulse"}):r.isListening?c.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full animate-pulse"}):null;return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:T,disabled:r.isProcessing,className:S(),title:r.isActive?"Stop Live Chat":"Start Live Chat",children:[M(),C()]}),s&&!r.isActive&&c.jsxs("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 p-2 min-w-48",children:[c.jsx("div",{className:"text-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Choose Mode"}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("button",{onClick:()=>p("text"),className:"w-full flex items-center space-x-2 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-left text-sm",children:[c.jsx(n5,{className:"h-4 w-4 text-gray-500"}),c.jsx("span",{children:"Text Chat"})]}),c.jsxs("button",{onClick:()=>p("voice"),className:"w-full flex items-center space-x-2 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-left text-sm",children:[c.jsx(gl,{className:"h-4 w-4 text-blue-500"}),c.jsx("span",{children:"Voice Chat"})]}),c.jsxs("button",{onClick:()=>p("multimodal"),className:"w-full flex items-center space-x-2 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-left text-sm",children:[c.jsx(Dw,{className:"h-4 w-4 text-green-500"}),c.jsx("span",{children:"Iteration 21 (Voice + Camera)"})]})]})]}),r.isActive&&c.jsxs("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs rounded px-2 py-1 whitespace-nowrap",children:[r.wakeWordDetected&&"Voice Activated",r.isSpeaking&&!r.wakeWordDetected&&"Speaking",r.isListening&&!r.wakeWordDetected&&!r.isSpeaking&&`Listening (${r.mode})`,r.currentTranscript&&c.jsx("div",{className:"mt-1 italic",children:r.currentTranscript})]}),r.isActive&&r.mode!=="text"&&!r.wakeWordDetected&&c.jsxs("div",{className:"absolute top-full mt-2 left-1/2 transform -translate-x-1/2 bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100 text-xs rounded px-3 py-2 text-center whitespace-nowrap",children:[" Say ",c.jsx("strong",{children:'"Cartrita!"'})," to activate"]})]})},Nde=({children:n,className:e=""})=>c.jsx("div",{className:`glass-card rounded-xl ${e}`,children:n}),Ede=({variant:n="default",size:e="default",className:t="",children:r,disabled:i,...s})=>{const a="inline-flex items-center justify-center font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",o={default:"bg-blue-600/80 text-white hover:bg-blue-600 focus:ring-blue-500",outline:"border border-gray-600 bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white focus:ring-blue-500",ghost:"text-gray-300 hover:bg-gray-800/50 focus:ring-blue-500",destructive:"bg-red-600/80 text-white hover:bg-red-600 focus:ring-red-500",secondary:"bg-gray-700/80 text-gray-200 hover:bg-gray-600/80 focus:ring-gray-500"},l={default:"px-4 py-2 text-sm",sm:"px-3 py-1.5 text-xs",lg:"px-6 py-3 text-base"};return c.jsx("button",{className:`${a} ${o[n]} ${l[e]} ${t}`,disabled:i,...s,children:r})},Mde={},MP=["general","code","math","multilingual","long_context","tool_use","vision_language","audio","embedding","rerank","safety","lightweight","compression","meta"],Cde=()=>{const n=Mde?.VITE_API_BASE||"",[e,t]=E.useState([]),[r,i]=E.useState(!1),[s,a]=E.useState(null),[o,l]=E.useState("all"),[u,h]=E.useState(""),[p,m]=E.useState("Explain the benefits of streaming architectures."),[g,y]=E.useState(!1),[b,_]=E.useState(null);E.useEffect(()=>{let S=!0;return i(!0),fetch(`${n}/api/models/catalog`).then(M=>M.json()).then(M=>{S&&(M.success?t(M.data):a(M.error||"Failed to load catalog"))}).catch(M=>{S&&a(M.message)}).finally(()=>S&&i(!1)),()=>{S=!1}},[]);const x=E.useMemo(()=>{const S=u.toLowerCase();return e.filter(M=>(o==="all"||M.category===o)&&(!S||M.repo_id.toLowerCase().includes(S)||M.primary_tasks.some(C=>C.toLowerCase().includes(S))))},[e,o,u]),N=E.useMemo(()=>{const S={};x.forEach(M=>{S[M.category]||(S[M.category]=[]),S[M.category].push(M)});for(const M of Object.keys(S))S[M].sort((C,R)=>C.repo_id.localeCompare(R.repo_id));return S},[x]),T=async()=>{y(!0),a(null),_(null);try{const M=await(await fetch(`${n}/api/models/route`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:p})})).json();if(!M.success)throw new Error(M.error||"Route failed");_(M.result)}catch(S){a(S.message)}finally{y(!1)}};return c.jsxs(Nde,{className:"p-4 space-y-4 max-w-4xl mx-auto",children:[c.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[c.jsx("h2",{className:"text-lg font-semibold",children:"Model Router"}),c.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[c.jsxs("select",{value:o,onChange:S=>l(S.target.value),className:"border px-2 py-1 rounded text-sm",children:[c.jsx("option",{value:"all",children:"All Categories"}),MP.filter(S=>e.some(M=>M.category===S)).map(S=>c.jsx("option",{value:S,children:S},S))]}),c.jsx("input",{placeholder:"Search models/tasks",value:u,onChange:S=>h(S.target.value),className:"border px-2 py-1 rounded text-sm"})]})]}),r&&c.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading catalog"}),s&&c.jsx("div",{className:"text-sm text-red-600",children:s}),!r&&!s&&c.jsxs("div",{className:"max-h-72 overflow-auto border rounded",children:[MP.filter(S=>N[S]).map(S=>c.jsxs("div",{className:"border-b last:border-b-0",children:[c.jsxs("div",{className:"bg-muted/50 px-2 py-1 text-xs font-medium uppercase tracking-wide flex justify-between",children:[c.jsx("span",{children:S}),c.jsx("span",{children:N[S].length})]}),c.jsx("ul",{className:"divide-y",children:N[S].map(M=>c.jsxs("li",{className:"px-2 py-1 text-xs flex flex-col gap-0.5",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"font-mono",children:M.repo_id}),c.jsx("span",{className:"text-[10px] text-muted-foreground",children:M.approx_params})]}),c.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:M.primary_tasks.join(", ")})]},M.repo_id))})]},S)),x.length===0&&c.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"No models match filters."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("textarea",{value:p,onChange:S=>m(S.target.value),className:"w-full border rounded p-2 text-sm h-28"}),c.jsxs("div",{className:"flex gap-2 items-center",children:[c.jsx(Ede,{disabled:g,onClick:T,children:g?"Routing":"Route Prompt"}),b&&c.jsxs("span",{className:"text-xs text-muted-foreground",children:[b.model_id,"  ",b.task,"  ",b.timing_ms,"ms  conf ",(b.confidence*100).toFixed(0),"%"]})]}),b&&c.jsx("div",{className:"border rounded p-2 bg-muted/30 text-sm whitespace-pre-wrap max-h-64 overflow-auto",children:typeof b.output=="string"?b.output:JSON.stringify(b.output,null,2)})]})]})},CP={general:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",code:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",math:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",multilingual:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",safety:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",lightweight:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",vision:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300",audio:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300",embedding:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-300"},Ade={economy:"bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-200",standard:"bg-yellow-100 text-yellow-700 dark:bg-yellow-800 dark:text-yellow-200",premium:"bg-red-100 text-red-700 dark:bg-red-800 dark:text-red-200"},Rde=({onSelectModel:n,selectedModel:e,className:t=""})=>{const[r,i]=E.useState([]),[s,a]=E.useState(!0),[o,l]=E.useState(""),[u,h]=E.useState("all"),[p,m]=E.useState("all"),[g,y]=E.useState("quality"),[b,_]=E.useState(!1);E.useEffect(()=>{(async()=>{try{const M=await fetch("/api/huggingface/capabilities");M.ok&&(await M.json(),i([{idx:1,repo_id:"meta-llama/Meta-Llama-3-70B-Instruct",category:"general",approx_params:"70B",primary_tasks:["chat","reasoning","analysis"],serverless_candidate:!1,requires_endpoint:!0,notes:"Large; often needs dedicated endpoint.",cost_tier:"premium",quality_score:.95,context_length:8192},{idx:2,repo_id:"meta-llama/Meta-Llama-3-8B-Instruct",category:"general",approx_params:"8B",primary_tasks:["chat","drafting","analysis"],serverless_candidate:!0,requires_endpoint:!1,notes:"Good quality-size tradeoff.",cost_tier:"standard",quality_score:.85,context_length:8192},{idx:3,repo_id:"microsoft/DialoGPT-medium",category:"lightweight",approx_params:"345M",primary_tasks:["chat","conversation"],serverless_candidate:!0,requires_endpoint:!1,notes:"Fast response times.",cost_tier:"economy",quality_score:.65,context_length:1024},{idx:4,repo_id:"Qwen/Qwen2-7B-Instruct",category:"multilingual",approx_params:"7B",primary_tasks:["multilingual","chat","reasoning"],serverless_candidate:!0,requires_endpoint:!1,notes:"Excellent multilingual support.",cost_tier:"standard",quality_score:.82,context_length:32768},{idx:5,repo_id:"microsoft/speecht5_tts",category:"audio",approx_params:"unknown",primary_tasks:["text-to-speech","voice-synthesis"],serverless_candidate:!0,requires_endpoint:!1,notes:"High-quality TTS model.",cost_tier:"standard",quality_score:.88,context_length:512},{idx:6,repo_id:"BAAI/bge-large-en-v1.5",category:"embedding",approx_params:"335M",primary_tasks:["embedding","similarity","retrieval"],serverless_candidate:!0,requires_endpoint:!1,notes:"High-quality text embeddings.",cost_tier:"economy",quality_score:.9,context_length:512}]))}catch(M){console.error("Failed to load models:",M)}finally{a(!1)}})()},[]);const x=E.useMemo(()=>{let S=r.filter(M=>{const C=M.repo_id.toLowerCase().includes(o.toLowerCase())||M.primary_tasks.some(k=>k.toLowerCase().includes(o.toLowerCase())),R=u==="all"||M.category===u,F=p==="all"||M.cost_tier===p;return C&&R&&F});return S.sort((M,C)=>{switch(g){case"quality":return(C.quality_score||0)-(M.quality_score||0);case"cost":const R={economy:0,standard:1,premium:2};return(R[M.cost_tier]||1)-(R[C.cost_tier]||1);case"params":const F=k=>{const D=parseFloat(k);return k.includes("B")?D*1e3:k.includes("M")?D:0};return F(C.approx_params)-F(M.approx_params);case"name":return M.repo_id.localeCompare(C.repo_id);default:return 0}}),S},[r,o,u,p,g]),N=[...new Set(r.map(S=>S.category))],T=[...new Set(r.map(S=>S.cost_tier).filter(Boolean))];return s?c.jsx("div",{className:`p-6 ${t}`,children:c.jsxs("div",{className:"animate-pulse",children:[c.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),c.jsx("div",{className:"space-y-3",children:[...Array(5)].map((S,M)=>c.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"},M))})]})}):c.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg ${t}`,children:[c.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"HuggingFace Model Catalog"}),c.jsxs("button",{onClick:()=>_(!b),className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[c.jsx(y5,{className:"h-4 w-4"}),c.jsx("span",{children:"Filters"})]})]}),c.jsxs("div",{className:"relative",children:[c.jsx(q0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),c.jsx("input",{type:"text",placeholder:"Search models, tasks...",value:o,onChange:S=>l(S.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),b&&c.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),c.jsxs("select",{value:u,onChange:S=>h(S.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"all",children:"All Categories"}),N.map(S=>c.jsx("option",{value:S,children:S},S))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cost Tier"}),c.jsxs("select",{value:p,onChange:S=>m(S.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"all",children:"All Tiers"}),T.map(S=>c.jsx("option",{value:S,children:S},S))]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sort By"}),c.jsxs("select",{value:g,onChange:S=>y(S.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"quality",children:"Quality Score"}),c.jsx("option",{value:"cost",children:"Cost (Low to High)"}),c.jsx("option",{value:"params",children:"Parameter Size"}),c.jsx("option",{value:"name",children:"Name"})]})]})]})]}),c.jsxs("div",{className:"p-6",children:[c.jsx("div",{className:"space-y-4",children:x.map(S=>c.jsx("div",{onClick:()=>n(S),className:`p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md ${e?.repo_id===S.repo_id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:S.repo_id}),c.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${CP[S.category]||CP.general}`,children:S.category}),S.cost_tier&&c.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${Ade[S.cost_tier]}`,children:[c.jsx(u5,{className:"h-3 w-3 inline mr-1"}),S.cost_tier]})]}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:S.notes}),c.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:S.primary_tasks.map(M=>c.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded",children:M},M))}),c.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx(Jf,{className:"h-4 w-4"}),c.jsx("span",{children:S.approx_params})]}),S.quality_score&&c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx(F5,{className:"h-4 w-4"}),c.jsx("span",{children:S.quality_score.toFixed(2)})]}),S.context_length&&c.jsxs("div",{className:"flex items-center space-x-1",children:[c.jsx(Lw,{className:"h-4 w-4"}),c.jsxs("span",{children:[S.context_length.toLocaleString()," ctx"]})]}),c.jsx("div",{className:"flex items-center space-x-1",children:S.serverless_candidate?c.jsxs(c.Fragment,{children:[c.jsx(Bk,{className:"h-4 w-4 text-green-500"}),c.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Serverless"})]}):c.jsxs(c.Fragment,{children:[c.jsx(po,{className:"h-4 w-4 text-orange-500"}),c.jsx("span",{className:"text-orange-600 dark:text-orange-400",children:"Endpoint"})]})})]})]}),e?.repo_id===S.repo_id&&c.jsx(Xi,{className:"h-6 w-6 text-blue-500 flex-shrink-0"})]})},S.repo_id))}),x.length===0&&c.jsxs("div",{className:"text-center py-12",children:[c.jsx(q0,{className:"mx-auto h-12 w-12 text-gray-400"}),c.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"No models found"}),c.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Try adjusting your search or filters."})]})]})]})},Pde=({token:n,className:e=""})=>{const[t,r]=E.useState([]),[i,s]=E.useState(""),[a,o]=E.useState(null),[l,u]=E.useState(!1),[h,p]=E.useState(!1),[m,g]=E.useState(""),[y,b]=E.useState("BAAI/bge-large-en-v1.5"),[_,x]=E.useState("BAAI/bge-reranker-large"),[N,T]=E.useState("meta-llama/Meta-Llama-3-8B-Instruct"),[S]=E.useState(20),[M]=E.useState(8),[C,R]=E.useState(!1),[F,k]=E.useState(!0),[D,P]=E.useState("standard"),G=E.useRef(null),$=E.useCallback(async V=>{const z=[];for(let Y=0;Y<V.length;Y++){const se=V[Y];if(se.size>10*1024*1024){g(`File ${se.name} is too large (max 10MB)`);continue}try{let J="",q="text";se.type==="application/json"?(J=await se.text(),q="json"):se.type==="application/pdf"?(J=`[PDF Content] ${se.name} - This is a placeholder for PDF text extraction.`,q="pdf"):(J=await se.text(),q="text");const Q={id:`doc_${Date.now()}_${Y}`,name:se.name,content:J,size:se.size,type:q,uploadedAt:new Date};z.push(Q)}catch(J){console.error(`Error reading file ${se.name}:`,J),g(`Failed to read file: ${se.name}`)}}r(Y=>[...Y,...z]),g("")},[]),U=E.useCallback(V=>{V.preventDefault(),V.stopPropagation()},[]),K=E.useCallback(V=>{V.preventDefault(),V.stopPropagation();const z=V.dataTransfer.files;z.length>0&&$(z)},[$]),O=V=>{r(z=>z.filter(Y=>Y.id!==V))},j=async()=>{if(!i.trim()){g("Please enter a query");return}if(t.length===0){g("Please upload at least one document");return}u(!0),g(""),o(null);try{const V=t.map(se=>se.content),z=await fetch("/api/huggingface/rag",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({query:i,documentStore:V,embeddingModel:y,rerankModel:_,generationModel:N,topKRetrieval:S,topKRerank:M,useMultiQuery:C,includeCitations:F,budgetTier:D})});if(!z.ok)throw new Error(`RAG pipeline failed: ${z.statusText}`);const Y=await z.json();o(Y.result)}catch(V){console.error("RAG pipeline error:",V),g(V instanceof Error?V.message:"Failed to execute RAG pipeline")}finally{u(!1)}},L=V=>{if(V===0)return"0 Bytes";const z=1024,Y=["Bytes","KB","MB"],se=Math.floor(Math.log(V)/Math.log(z));return parseFloat((V/Math.pow(z,se)).toFixed(2))+" "+Y[se]},B=V=>V>=.8?"text-green-600 dark:text-green-400":V>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return c.jsx("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg ${e}`,children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(nd,{className:"h-6 w-6 text-purple-600"}),c.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"RAG Pipeline"})]}),c.jsx("button",{onClick:()=>p(!h),className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Advanced Settings"})]}),m&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:c.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:m})}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Documents"}),c.jsxs("div",{onDragOver:U,onDrop:K,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-gray-400 dark:hover:border-gray-500 transition-colors",children:[c.jsx(f5,{className:"mx-auto h-12 w-12 text-gray-400"}),c.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Drag and drop files here, or"," ",c.jsx("button",{onClick:()=>G.current?.click(),className:"text-blue-600 hover:text-blue-700 underline",children:"browse"})]}),c.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"Supports text files, PDFs, and JSON (max 10MB each)"})]}),c.jsx("input",{ref:G,type:"file",multiple:!0,accept:".txt,.pdf,.json,.md",onChange:V=>V.target.files&&$(V.target.files),className:"hidden"}),t.length>0&&c.jsx("div",{className:"mt-4 space-y-2",children:t.map(V=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(zk,{className:"h-5 w-5 text-gray-400"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:V.name}),c.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[L(V.size),"  ",V.type.toUpperCase()]})]})]}),c.jsx("button",{onClick:()=>O(V.id),className:"text-gray-400 hover:text-red-600 transition-colors",children:c.jsx(Gk,{className:"h-4 w-4"})})]},V.id))})]}),h&&c.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Pipeline Configuration"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Embedding Model"}),c.jsxs("select",{value:y,onChange:V=>b(V.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"BAAI/bge-large-en-v1.5",children:"BGE Large EN v1.5"}),c.jsx("option",{value:"sentence-transformers/all-MiniLM-L6-v2",children:"MiniLM L6 v2"}),c.jsx("option",{value:"intfloat/e5-large-v2",children:"E5 Large v2"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rerank Model"}),c.jsxs("select",{value:_,onChange:V=>x(V.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"BAAI/bge-reranker-large",children:"BGE Reranker Large"}),c.jsx("option",{value:"cross-encoder/ms-marco-MiniLM-L-6-v2",children:"MiniLM Cross Encoder"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Generation Model"}),c.jsxs("select",{value:N,onChange:V=>T(V.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"meta-llama/Meta-Llama-3-8B-Instruct",children:"Llama 3 8B"}),c.jsx("option",{value:"meta-llama/Meta-Llama-3-70B-Instruct",children:"Llama 3 70B"}),c.jsx("option",{value:"mistralai/Mixtral-8x7B-Instruct-v0.1",children:"Mixtral 8x7B"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Budget Tier"}),c.jsxs("select",{value:D,onChange:V=>P(V.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"economy",children:"Economy"}),c.jsx("option",{value:"standard",children:"Standard"}),c.jsx("option",{value:"premium",children:"Premium"})]})]}),c.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:C,onChange:V=>R(V.target.checked),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Multi Query"})]}),c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:F,onChange:V=>k(V.target.checked),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Citations"})]})]})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Query"}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx("div",{className:"flex-1 relative",children:c.jsx("textarea",{value:i,onChange:V=>s(V.target.value),placeholder:"Ask a question about your documents...",rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})}),c.jsx("button",{onClick:j,disabled:l||!i.trim()||t.length===0,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center space-x-2",children:l?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),c.jsx("span",{children:"Processing"})]}):c.jsxs(c.Fragment,{children:[c.jsx(q0,{className:"h-4 w-4"}),c.jsx("span",{children:"Search"})]})})]})]}),a&&c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[c.jsxs("div",{className:"flex items-start justify-between mb-3",children:[c.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Answer"}),c.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Confidence:"}),c.jsxs("span",{className:`font-medium ${B(a.confidence)}`,children:[Math.round(a.confidence*100),"%"]})]})]}),c.jsx("p",{className:"text-blue-800 dark:text-blue-200 leading-relaxed",children:a.answer})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Sources"}),c.jsx("div",{className:"space-y-2",children:a.sources.map(V=>c.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Source ",V.id]}),c.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[c.jsxs("span",{children:["Score: ",V.score.toFixed(3)]}),c.jsxs("span",{children:["Relevance: ",V.relevance.toFixed(2)]})]})]}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:V.content.length>200?V.content.substring(0,200)+"...":V.content})]},V.id))})]}),c.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Pipeline Metadata"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Duration:"}),c.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[a.metadata.pipeline_duration_ms,"ms"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Candidates:"}),c.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.metadata.total_candidates})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Reranked:"}),c.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.metadata.reranked_count})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Query Expanded:"}),c.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.metadata.query_expanded?"Yes":"No"})]})]})]})]})]})})},kde=({token:n,className:e=""})=>{const[t,r]=E.useState(null),[i,s]=E.useState(null),[a,o]=E.useState(!0),[l,u]=E.useState(""),[h,p]=E.useState(new Date),[m,g]=E.useState(!0),[y,b]=E.useState(""),[_,x]=E.useState({budget_tier:"standard",max_cost_per_1k_tokens:.01,min_confidence_threshold:.3,require_safety_filter:!1,context_length_needed:2048,multilingual:!1,enable_fallback:!0,max_candidates:5,temperature:.7,max_new_tokens:512}),[N,T]=E.useState(null),[S,M]=E.useState(!1),C=async()=>{try{u("");const P=new AbortController,G=setTimeout(()=>P.abort(),8e3),[$,U]=await Promise.all([fetch("/api/huggingface/stats",{headers:{Authorization:`Bearer ${n}`},signal:P.signal}).catch(K=>({ok:!1,status:0,_err:K})),fetch("/api/huggingface/health",{signal:P.signal}).catch(K=>({ok:!1,status:0,_err:K}))]);if(clearTimeout(G),!$.ok)$.status===404||$.status===503?u(K=>K||`Routing stats unavailable (${$.status})`):u(K=>K||"Failed to fetch routing statistics");else{const K=await $.json();r(K.stats)}if(!U.ok)U.status===503?u(K=>K||"Health check: orchestrator initializing"):U.status!==0&&u(K=>K||"Failed to fetch health status");else{const K=await U.json();s(K.health)}p(new Date)}catch(P){u(P instanceof Error?P.name==="AbortError"?"Dashboard request timed out":P.message:"Failed to fetch data")}finally{o(!1)}},R=async()=>{if(y.trim()){M(!0),T(null);try{const P=await fetch("/api/huggingface/inference",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({taskType:"text-generation",text:y,options:_})});if(!P.ok)throw new Error(`Routing test failed: ${P.statusText}`);const G=await P.json();T(G),C()}catch(P){console.error("Routing test error:",P),T({success:!1,error:P instanceof Error?P.message:"Test failed"})}finally{M(!1)}}},F=async()=>{try{(await fetch("/api/huggingface/clear-caches",{method:"POST",headers:{Authorization:`Bearer ${n}`}})).ok&&C()}catch(P){console.error("Failed to clear caches:",P)}};if(E.useEffect(()=>{C()},[]),E.useEffect(()=>{if(m){let P=setInterval(C,1e4);return()=>clearInterval(P)}},[m]),a&&!t&&!i)return c.jsx("div",{className:`p-6 ${e}`,children:c.jsxs("div",{className:"animate-pulse",children:[c.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(6)].map((P,G)=>c.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded"},G))})]})});const k=P=>P==="healthy"?c.jsx(Xi,{className:"h-5 w-5 text-green-500"}):c.jsx(X0,{className:"h-5 w-5 text-red-500"}),D=P=>P==="healthy"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800";return c.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg ${e}`,children:[c.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(kw,{className:"h-6 w-6 text-blue-600"}),c.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"HuggingFace Routing Dashboard"})]}),c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[c.jsx(Lw,{className:"h-4 w-4"}),c.jsxs("span",{children:["Updated: ",h.toLocaleTimeString()]})]}),c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:m,onChange:P=>g(P.target.checked),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto-refresh"})]}),c.jsx("button",{onClick:C,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:c.jsx(Ix,{className:"h-4 w-4"})})]})]}),l&&c.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:c.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:l})})]}),c.jsxs("div",{className:"p-6",children:[i&&c.jsxs("div",{className:"mb-8",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"System Health"}),c.jsx("div",{className:`p-4 rounded-lg border ${D(i.status)} mb-4`,children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[k(i.status),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:["Overall Status: ",i.status.charAt(0).toUpperCase()+i.status.slice(1)]}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.message})]})]}),c.jsx("div",{className:"flex items-center space-x-4 text-sm",children:i.enhanced_features&&typeof i.enhanced_features=="object"?Object.entries(i.enhanced_features).map(([P,G])=>c.jsxs("div",{className:"flex items-center space-x-1",children:[G?c.jsx(Xi,{className:"h-4 w-4 text-green-500"}):c.jsx(X0,{className:"h-4 w-4 text-red-500"}),c.jsx("span",{className:"text-gray-700 dark:text-gray-300 capitalize",children:P.replace(/_/g," ")})]},P)):c.jsx("span",{className:"text-xs text-gray-500",children:"No feature data"})})]})}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{className:`p-4 rounded-lg border ${D(i.routing_service.status)}`,children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[k(i.routing_service.status),c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Routing Service"})]}),i.routing_service.test_successful&&c.jsxs("div",{className:"text-xs space-y-1 text-gray-600 dark:text-gray-400",children:[c.jsxs("p",{children:["Model: ",i.routing_service.model_used]}),c.jsxs("p",{children:["Confidence: ",i.routing_service.confidence?.toFixed(3)]})]}),i.routing_service.error&&c.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:i.routing_service.error})]}),c.jsxs("div",{className:`p-4 rounded-lg border ${D(i.rag_service.status)}`,children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[k(i.rag_service.status),c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"RAG Service"})]}),c.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Cache Size: ",i.rag_service.cache_size," items"]})]}),c.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Agents"}),c.jsx("div",{className:"space-y-1",children:i.agents&&typeof i.agents=="object"?Object.entries(i.agents).map(([P,G])=>c.jsxs("div",{className:"flex items-center justify-between text-xs",children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:P}),k(G.status)]},P)):c.jsx("p",{className:"text-xs text-gray-500",children:"No agents"})})]})]})]}),t&&c.jsxs("div",{className:"mb-8",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Performance Statistics"}),c.jsx("button",{onClick:F,className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Clear Caches"})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[c.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[c.jsx(kw,{className:"h-5 w-5 text-blue-600"}),c.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Total Requests"})]}),c.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:t.totalRequests!=null?t.totalRequests.toLocaleString():""})]}),c.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[c.jsx(Xi,{className:"h-5 w-5 text-green-600"}),c.jsx("span",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Success Rate"})]}),c.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:t.successRate!=null?(t.successRate*100).toFixed(1)+"%":""})]}),c.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[c.jsx(Lw,{className:"h-5 w-5 text-yellow-600"}),c.jsx("span",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-100",children:"Avg Latency"})]}),c.jsx("p",{className:"text-2xl font-bold text-yellow-900 dark:text-yellow-100",children:t.averageLatency!=null?Math.round(t.averageLatency)+"ms":""})]}),c.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[c.jsx(po,{className:"h-5 w-5 text-purple-600"}),c.jsx("span",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:"Fallbacks Used"})]}),c.jsx("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:t.fallbacksUsed})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Available Models"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(Jf,{className:"h-5 w-5 text-gray-600"}),c.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[t.availableModels," models"]})]})]}),c.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"RAG Cache"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(Bk,{className:"h-5 w-5 text-gray-600"}),c.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[t.ragCacheStats.size," cached items"]})]})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Test Routing"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Test Prompt"}),c.jsx("textarea",{value:y,onChange:P=>b(P.target.value),placeholder:"Enter a prompt to test the routing system...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Budget Tier"}),c.jsxs("select",{value:_.budget_tier,onChange:P=>x(G=>({...G,budget_tier:P.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"economy",children:"Economy"}),c.jsx("option",{value:"standard",children:"Standard"}),c.jsx("option",{value:"premium",children:"Premium"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Min Confidence"}),c.jsx("input",{type:"number",min:"0",max:"1",step:"0.1",value:_.min_confidence_threshold,onChange:P=>x(G=>({...G,min_confidence_threshold:parseFloat(P.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),c.jsx("div",{className:"flex items-center space-x-4 text-sm",children:c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:_.require_safety_filter,onChange:P=>x(G=>({...G,require_safety_filter:P.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Safety Filter"})]})}),c.jsx("div",{className:"flex items-center space-x-4 text-sm",children:c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:_.multilingual,onChange:P=>x(G=>({...G,multilingual:P.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Multilingual"})]})})]}),c.jsx("button",{onClick:R,disabled:S||!y.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center space-x-2",children:S?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),c.jsx("span",{children:"Testing..."})]}):c.jsxs(c.Fragment,{children:[c.jsx(g5,{className:"h-4 w-4"}),c.jsx("span",{children:"Test Routing"})]})}),N&&c.jsxs("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Test Result"}),c.jsx("pre",{className:"text-sm text-gray-600 dark:text-gray-400 overflow-auto",children:JSON.stringify(N,null,2)})]})]})]})]})]})},Lde=({onTranscript:n,disabled:e=!1,token:t,showAdvancedSettings:r=!1,className:i=""})=>{const[s,a]=E.useState(!1),[o,l]=E.useState(!1),[u,h]=E.useState({microphone:"unknown",camera:"unknown"}),[p,m]=E.useState(!1),[g,y]=E.useState(!1),[b,_]=E.useState(""),[x,N]=E.useState(null),T=E.useRef(null),S=E.useRef(null),M=E.useRef([]),[C,R]=E.useState({model:"openai/whisper-large-v3",language:"auto",enable_confidence:!0,enable_alternatives:!0,noise_reduction:!0,auto_punctuation:!0,provider_preference:"huggingface"}),F=[{id:"openai/whisper-large-v3",name:"Whisper Large v3",quality:"High",speed:"Medium"},{id:"openai/whisper-medium",name:"Whisper Medium",quality:"Med",speed:"Fast"},{id:"openai/whisper-small",name:"Whisper Small",quality:"Basic",speed:"Very Fast"},{id:"openai/whisper-tiny",name:"Whisper Tiny",quality:"Low",speed:"Ultra Fast"},{id:"distil-whisper/distil-large-v3",name:"Distil Whisper Large v3",quality:"High",speed:"Faster"},{id:"distil-whisper/distil-medium.en",name:"Distil Whisper Medium EN",quality:"Med",speed:"Faster"},{id:"facebook/wav2vec2-large-960h",name:"Wav2Vec2 Large",quality:"Med",speed:"Fast"},{id:"facebook/wav2vec2-base-960h",name:"Wav2Vec2 Base",quality:"Basic",speed:"Very Fast"},{id:"jonatasgrosman/wav2vec2-large-xlsr-53-english",name:"Wav2Vec2 XLSR EN",quality:"Med",speed:"Fast"},{id:"jonatasgrosman/wav2vec2-large-xlsr-53-spanish",name:"Wav2Vec2 XLSR ES",quality:"Med",speed:"Fast"},{id:"nbroad/paraformer-ctc-en",name:"Paraformer CTC EN",quality:"Med",speed:"Fast"},{id:"kamo-naoyuki/wav2vec2-large-japanese",name:"Wav2Vec2 Japanese",quality:"Med",speed:"Fast"},{id:"openai/whisper-large-v2",name:"Whisper Large v2",quality:"High",speed:"Medium"},{id:"openai/whisper-base",name:"Whisper Base",quality:"Basic",speed:"Fast"},{id:"openai/whisper-base.en",name:"Whisper Base EN",quality:"Basic",speed:"Fast"}],k=E.useCallback(async O=>{let j=null;try{j=new AudioContext;const L=await O.arrayBuffer(),B=await j.decodeAudioData(L),V=B.getChannelData(0),z=V.length,Y=B.sampleRate,se=B.duration;let J=0,q=0,Q=0,te=Math.sign(V[0])||1;const X=Math.max(1,Math.floor(z/2e5));for(let tt=0;tt<z;tt+=X){const Ne=V[tt],_t=Ne<0?-Ne:Ne;J+=Ne*Ne,_t>q&&(q=_t);const it=Ne===0?te:Ne>0?1:-1;it!==te&&Q++,te=it}const ce=Math.ceil(z/X),me=Math.sqrt(J/ce),Re=.001,He=.01,Qe=.5,ie=Y*se*.3/X,Et={duration:se,rms:me,peak:q,zeroCrossings:Q,sampleRate:Y,fileSize:O.size,quality:q>He?"good":me>Re?"fair":"poor"};return{valid:se>=Qe&&(me>Re||q>He)&&Q<ie,analysis:Et}}catch(L){return console.error("[STT] Audio validation error:",L),{valid:!0,analysis:null}}finally{try{j?.close()}catch{}}},[]),D=E.useCallback(async()=>{if(!(e||!t))try{_(""),a(!0),console.log("[Enhanced STT] Starting recording with HuggingFace provider");const O=Hk();if(!O.isSupported)throw new Error(`Media not supported: ${O.issues.join(", ")}`);await qk();const j={...$k(),sampleRate:16e3,channelCount:1,echoCancellation:C.noise_reduction,noiseSuppression:C.noise_reduction,autoGainControl:!0},L=await navigator.mediaDevices.getUserMedia({audio:j});S.current=L,M.current=[];const B=Wk(),V=new MediaRecorder(L,B?{mimeType:B}:void 0);T.current=V,V.ondataavailable=Y=>{Y.data.size>0&&M.current.push(Y.data)};const z={done:!1};V.onstop=async()=>{if(!z.done){z.done=!0,console.log("[Enhanced STT] Processing with HuggingFace STT"),l(!0);try{const Y=new Blob(M.current,{type:"audio/webm"}),{valid:se,analysis:J}=await k(Y);if(!se)throw new Error(`Audio quality insufficient. Duration: ${J?.duration?.toFixed(2)}s, Quality: ${J?.quality}`);const q=new FormData;q.append("audio",Y,"recording.webm");const Q=await fetch("/api/huggingface/audio",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:q});if(!Q.ok){const X=await Q.json().catch(()=>({}));throw new Error(X.error||`STT failed: ${Q.statusText}`)}const te=await Q.json();if(te.success&&te.result){const X={transcript:te.result.transcript||te.result.text||"",confidence:te.result.confidence||.9,provider:"huggingface",model:C.model,latency_ms:te.result.latency_ms||0,language_detected:te.result.language_detected,word_count:(te.result.transcript||te.result.text||"").split(" ").length,alternatives:te.result.alternatives};N(X),n(X)}else throw new Error("No transcript received from HuggingFace STT")}catch(Y){console.error("[Enhanced STT] Processing error:",Y),_(Y instanceof Error?Y.message:"Transcription failed")}finally{l(!1)}}},V.start(1e3)}catch(O){console.error("[Enhanced STT] Failed to start recording:",O),a(!1),O instanceof Error&&(O.name==="NotAllowedError"?(_("Microphone permission denied. Please allow microphone access."),m(!0)):O.name==="NotFoundError"?_("No microphone found. Please connect a microphone."):O.name==="NotReadableError"?_("Microphone is already in use by another application."):_(O.message))}},[e,t,C,k,n]),P=E.useCallback(()=>{console.log("[Enhanced STT] Stopping recording"),T.current&&T.current.state!=="inactive"&&(T.current.stop(),T.current=null),S.current&&(S.current.getTracks().forEach(O=>O.stop()),S.current=null),a(!1)},[]),G=E.useCallback(()=>{if(s)P();else{if(u.microphone!=="granted"){m(!0);return}D()}},[s,u.microphone,D,P]),$=E.useCallback(O=>{h(O),O.microphone==="granted"&&p&&m(!1)},[p]),U=E.useCallback(async()=>{try{_(""),l(!0);const j=await(await fetch("/api/huggingface/health")).json();j.success&&j.health.agents?.AudioWizard?.status==="healthy"?_(""):_("Audio system not ready. Please try again in a moment.")}catch{_("Failed to test audio system")}finally{l(!1)}},[]);E.useEffect(()=>()=>{s&&P()},[s,P]);const K=e||o||!t;return c.jsxs("div",{className:`relative ${i}`,children:[c.jsx("button",{onClick:G,disabled:K,className:`
          p-3 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2
          ${s?"bg-red-500 hover:bg-red-600 text-white focus:ring-red-500 shadow-lg":o?"bg-blue-500 text-white animate-pulse":"bg-gray-100 hover:bg-gray-200 text-gray-600 focus:ring-blue-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}
          ${K?"opacity-50 cursor-not-allowed":"cursor-pointer transform hover:scale-105"}
        `,title:s?"Stop recording (HuggingFace STT)":o?"Processing with HuggingFace...":"Start voice input (Enhanced STT)",children:s?c.jsx(Jd,{className:"h-6 w-6"}):c.jsx(gl,{className:`h-6 w-6 ${o?"animate-pulse":""}`})}),s&&c.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full animate-pulse border-2 border-white"}),o&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-blue-500 text-white text-sm rounded shadow-lg whitespace-nowrap",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),c.jsx("span",{children:"Processing with HuggingFace STT..."})]})}),s&&S.current&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4",children:c.jsx(e1,{isRecording:s,audioStream:S.current,width:250,height:50,barColor:"#ef4444",backgroundColor:"rgba(0, 0, 0, 0.8)",sensitivity:1.5})}),r&&c.jsx("button",{onClick:()=>y(!g),className:"absolute top-0 right-0 transform translate-x-2 -translate-y-2 p-1 bg-gray-200 dark:bg-gray-600 rounded-full hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",title:"STT Settings",children:c.jsx(Dx,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),b&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-red-500 text-white text-sm rounded shadow-lg max-w-xs",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(po,{className:"h-4 w-4 flex-shrink-0"}),c.jsx("span",{children:b})]})}),x&&!b&&!o&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-green-500 text-white text-sm rounded shadow-lg",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(Xi,{className:"h-4 w-4"}),c.jsxs("span",{children:["Transcribed ",x.word_count," words (",x.confidence>.8?"High":x.confidence>.6?"Med":"Low"," confidence)"]})]})}),g&&c.jsxs("div",{className:"absolute top-full right-0 mt-2 w-80 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 z-10",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"STT Settings"}),c.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:""})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Model"}),c.jsx("select",{value:C.model,onChange:O=>R(j=>({...j,model:O.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:F.map(O=>c.jsxs("option",{value:O.id,children:[O.name," (",O.quality," quality, ",O.speed," speed)"]},O.id))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Language"}),c.jsxs("select",{value:C.language,onChange:O=>R(j=>({...j,language:O.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"auto",children:"Auto-detect"}),c.jsx("option",{value:"en",children:"English"}),c.jsx("option",{value:"es",children:"Spanish"}),c.jsx("option",{value:"fr",children:"French"}),c.jsx("option",{value:"de",children:"German"}),c.jsx("option",{value:"it",children:"Italian"}),c.jsx("option",{value:"pt",children:"Portuguese"}),c.jsx("option",{value:"ru",children:"Russian"}),c.jsx("option",{value:"zh",children:"Chinese"}),c.jsx("option",{value:"ja",children:"Japanese"}),c.jsx("option",{value:"ko",children:"Korean"})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:C.enable_confidence,onChange:O=>R(j=>({...j,enable_confidence:O.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable confidence scoring"})]}),c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:C.enable_alternatives,onChange:O=>R(j=>({...j,enable_alternatives:O.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Generate alternatives"})]}),c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:C.noise_reduction,onChange:O=>R(j=>({...j,noise_reduction:O.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Noise reduction"})]}),c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:C.auto_punctuation,onChange:O=>R(j=>({...j,auto_punctuation:O.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto punctuation"})]})]}),c.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:c.jsx("button",{onClick:U,disabled:o,className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm",children:"Test Audio System"})})]})]}),p&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 w-80",children:c.jsx(t1,{onPermissionChange:$,requiredPermissions:["microphone"],showUI:!0,autoRequest:!1})})]})},Dde={low:{width:640,height:480},medium:{width:1280,height:720},high:{width:1920,height:1080}},Ide=[{id:"image-classification",name:"Image Classification",description:"Identify what's in the image",icon:""},{id:"object-detection",name:"Object Detection",description:"Find and locate objects in the image",icon:""},{id:"image-to-text",name:"Image Description",description:"Generate text description of the image",icon:""},{id:"visual-question-answering",name:"Visual Q&A",description:"Answer questions about the image",icon:""}],jde=[{id:"fast",name:"Fast",description:"Quick results, basic quality"},{id:"quality",name:"Quality",description:"Best results, slower processing"},{id:"auto",name:"Auto",description:"Balanced speed and quality"}],Fde=({onAnalysis:n,disabled:e=!1,token:t,showAdvancedSettings:r=!1,className:i=""})=>{const[s,a]=E.useState(!1),[o,l]=E.useState(!1),[u,h]=E.useState({microphone:"unknown",camera:"unknown"}),[p,m]=E.useState(!1),[g,y]=E.useState(!1),[b,_]=E.useState(""),[x,N]=E.useState(null),[T,S]=E.useState(0),M=E.useRef(null),C=E.useRef(null),R=E.useRef(null),F=E.useRef(null),k=E.useRef(!1),D=E.useRef(!1),[P,G]=E.useState({resolution:"medium",task:"image-classification",model_preference:"auto",auto_capture:!1,capture_interval:5,enable_preprocessing:!0,batch_analysis:!1}),[$,U]=E.useState("What do you see in this image?"),K=E.useCallback(async()=>{if(!(e||!t))try{_(""),console.log("[Enhanced Camera] Starting camera with HuggingFace vision");const Y={video:{...Dde[P.resolution],facingMode:"user",frameRate:{ideal:30,max:60}}},se=await navigator.mediaDevices.getUserMedia(Y);C.current=se,M.current&&(D.current=!1,M.current.onloadedmetadata=async()=>{try{await M.current?.play(),D.current=!0}catch(J){console.warn("[Enhanced Camera] Autoplay prevented:",J)}},M.current.srcObject=se),a(!0),P.auto_capture&&(F.current=setInterval(()=>{j()},P.capture_interval*1e3))}catch(Y){console.error("[Enhanced Camera] Failed to start camera:",Y),Y instanceof Error&&(Y.name==="NotAllowedError"?(_("Camera permission denied. Please allow camera access."),m(!0)):Y.name==="NotFoundError"?_("No camera found. Please connect a camera."):Y.name==="NotReadableError"?_("Camera is already in use by another application."):_(Y.message))}},[e,t,P]),O=E.useCallback(()=>{k.current||(k.current=!0,console.log("[Enhanced Camera] Stopping camera"),F.current&&(clearInterval(F.current),F.current=null),C.current&&(C.current.getTracks().forEach(Y=>Y.stop()),C.current=null),M.current&&(M.current.srcObject=null),a(!1),D.current=!1,setTimeout(()=>{k.current=!1},100))},[]),j=E.useCallback(async()=>{if(!(!M.current||!R.current||!s)){if(!D.current){console.warn("[Enhanced Camera] Capture skipped: video not ready");return}try{l(!0),_("");const Y=M.current,se=R.current,J=se.getContext("2d");if(!J)throw new Error("Failed to get canvas context");se.width=Y.videoWidth,se.height=Y.videoHeight,J.drawImage(Y,0,0);const q=J.getImageData(0,0,Math.min(64,se.width),Math.min(64,se.height)).data;let Q=0;for(let He=0;He<q.length;He+=16){const Qe=q[He],ie=q[He+1],Et=q[He+2];if(Qe+ie+Et>30&&(Q++,Q>5))break}if(Q<=5){console.warn("[Enhanced Camera] Black/blank frame detected, skipping analysis"),l(!1);return}const te=await new Promise(He=>{se.toBlob(Qe=>{Qe&&He(Qe)},"image/jpeg",.8)}),X=new FormData;X.append("image",te,"capture.jpg"),X.append("taskType",P.task),P.task==="visual-question-answering"&&X.append("question",$);const ce={model_preference:P.model_preference,enable_preprocessing:P.enable_preprocessing,budget_tier:P.model_preference==="fast"?"economy":P.model_preference==="quality"?"premium":"standard"};X.append("options",JSON.stringify(ce));const me=await fetch("/api/huggingface/vision",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:X});if(!me.ok){const He=await me.json().catch(()=>({}));throw new Error(He.error||`Vision analysis failed: ${me.statusText}`)}const Re=await me.json();if(Re.success&&Re.result){const He={task_type:P.task,predictions:Re.result.predictions||[],confidence:Re.result.confidence||.9,model_used:Re.result.model_used||"unknown",processing_time_ms:Re.result.processing_time_ms||0,detected_objects:Re.result.detected_objects,classifications:Re.result.classifications,generated_text:Re.result.generated_text,image_description:Re.result.image_description};N(He),S(Qe=>Qe+1),n(He)}else throw new Error("No analysis result received from HuggingFace Vision")}catch(Y){console.error("[Enhanced Camera] Analysis error:",Y),_(Y instanceof Error?Y.message:"Analysis failed")}finally{l(!1)}}},[s,P,$,t,n]),L=E.useCallback(()=>{if(s)O();else{if(u.camera!=="granted"){m(!0);return}K()}},[s,u.camera,K,O]),B=E.useCallback(Y=>{h(Y),Y.camera==="granted"&&p&&m(!1)},[p]),V=E.useCallback(async()=>{try{_(""),l(!0);const se=await(await fetch("/api/huggingface/health")).json();se.success&&se.health.agents?.VisionMaster?.status==="healthy"?_(""):_("Vision system not ready. Please try again in a moment.")}catch{_("Failed to test vision system")}finally{l(!1)}},[]);E.useEffect(()=>()=>{O()},[O]);const z=e||o||!t;return c.jsxs("div",{className:`relative ${i}`,children:[c.jsx("button",{onClick:L,disabled:z,className:`
          p-3 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2
          ${s?"bg-red-500 hover:bg-red-600 text-white focus:ring-red-500 shadow-lg":o?"bg-blue-500 text-white animate-pulse":"bg-gray-100 hover:bg-gray-200 text-gray-600 focus:ring-blue-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}
          ${z?"opacity-50 cursor-not-allowed":"cursor-pointer transform hover:scale-105"}
        `,title:s?"Stop camera (HuggingFace Vision)":o?"Processing with HuggingFace...":"Start camera (Enhanced Vision)",children:s?c.jsx(Jd,{className:"h-6 w-6"}):c.jsx(Qf,{className:`h-6 w-6 ${o?"animate-pulse":""}`})}),s&&c.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full animate-pulse border-2 border-white"}),s&&c.jsx("button",{onClick:j,disabled:o,className:"absolute top-0 left-full ml-2 p-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-full transition-colors",title:"Capture and Analyze",children:c.jsx(Vk,{className:"h-5 w-5"})}),r&&c.jsx("button",{onClick:()=>y(!g),className:"absolute top-0 right-0 transform translate-x-2 -translate-y-2 p-1 bg-gray-200 dark:bg-gray-600 rounded-full hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",title:"Vision Settings",children:c.jsx(Dx,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),o&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-blue-500 text-white text-sm rounded shadow-lg whitespace-nowrap",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),c.jsx("span",{children:"Analyzing with HuggingFace Vision..."})]})}),b&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-red-500 text-white text-sm rounded shadow-lg max-w-xs",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(po,{className:"h-4 w-4 flex-shrink-0"}),c.jsx("span",{children:b})]})}),x&&!b&&!o&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-green-500 text-white text-sm rounded shadow-lg",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(Xi,{className:"h-4 w-4"}),c.jsx("span",{children:x.task_type==="image-classification"?`Classified (${x.confidence>.8?"High":"Med"} confidence)`:x.task_type==="object-detection"?`Found ${x.detected_objects?.length||0} objects`:x.task_type==="image-to-text"?"Description generated":"Analysis complete"})]})}),s&&c.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 bg-black rounded-lg overflow-hidden shadow-lg",children:[c.jsx("video",{ref:M,autoPlay:!0,muted:!0,playsInline:!0,className:"w-80 h-60 object-cover"}),T>0&&c.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:["Captures: ",T]}),P.auto_capture&&c.jsxs("div",{className:"absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded flex items-center space-x-1",children:[c.jsx(Ix,{className:"h-3 w-3 animate-spin"}),c.jsx("span",{children:"Auto"})]})]}),g&&c.jsxs("div",{className:"absolute top-full right-0 mt-2 w-96 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 z-10",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vision Settings"}),c.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:""})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Analysis Task"}),c.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ide.map(Y=>c.jsxs("button",{onClick:()=>G(se=>({...se,task:Y.id})),className:`p-3 text-left border rounded-lg transition-colors ${P.task===Y.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[c.jsx("span",{className:"text-lg",children:Y.icon}),c.jsx("span",{className:"font-medium text-sm text-gray-900 dark:text-white",children:Y.name})]}),c.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:Y.description})]},Y.id))})]}),P.task==="visual-question-answering"&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Question"}),c.jsx("input",{type:"text",value:$,onChange:Y=>U(Y.target.value),placeholder:"What do you see in this image?",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Model Preference"}),c.jsx("select",{value:P.model_preference,onChange:Y=>G(se=>({...se,model_preference:Y.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:jde.map(Y=>c.jsxs("option",{value:Y.id,children:[Y.name," - ",Y.description]},Y.id))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Resolution"}),c.jsxs("select",{value:P.resolution,onChange:Y=>G(se=>({...se,resolution:Y.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"low",children:"Low (640x480)"}),c.jsx("option",{value:"medium",children:"Medium (1280x720)"}),c.jsx("option",{value:"high",children:"High (1920x1080)"})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:P.auto_capture,onChange:Y=>G(se=>({...se,auto_capture:Y.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto-capture"})]}),P.auto_capture&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Capture Interval (seconds)"}),c.jsx("input",{type:"number",min:"1",max:"60",value:P.capture_interval,onChange:Y=>G(se=>({...se,capture_interval:parseInt(Y.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:P.enable_preprocessing,onChange:Y=>G(se=>({...se,enable_preprocessing:Y.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable preprocessing"})]})]}),c.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:c.jsx("button",{onClick:V,disabled:o,className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm",children:"Test Vision System"})})]})]}),c.jsx("canvas",{ref:R,className:"hidden"}),p&&c.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 w-80",children:c.jsx(t1,{onPermissionChange:B,requiredPermissions:["camera"],showUI:!0,autoRequest:!1})})]})},Ode=["Hello, this is a test of the speech-to-text system.","The quick brown fox jumps over the lazy dog.","Testing multilingual capabilities: Hola, cmo ests?","Technical terms: API, neural network, machine learning.","Numbers and dates: Today is January 15th, 2024, at 3:45 PM."],AP={stt:[{id:"openai/whisper-large-v3",name:"Whisper Large v3",quality:"High"},{id:"openai/whisper-medium",name:"Whisper Medium",quality:"Medium"},{id:"facebook/wav2vec2-large-960h",name:"Wav2Vec2 Large",quality:"Medium"}],tts:[{id:"microsoft/speecht5_tts",name:"SpeechT5 TTS",quality:"High"},{id:"facebook/fastspeech2-en-ljspeech",name:"FastSpeech2",quality:"Medium"}]},Ude=({token:n,className:e=""})=>{const[t,r]=E.useState([]),[i,s]=E.useState(!1),[a,o]=E.useState(""),[l,u]=E.useState(!1),[h,p]=E.useState(""),[m,g]=E.useState({stt_model:"openai/whisper-large-v3",tts_model:"microsoft/speecht5_tts",voice_swap_model:"microsoft/speecht5_tts",test_phrases:Ode,quality_threshold:.8,latency_threshold:5e3,enable_noise_test:!0,enable_quality_analysis:!0}),[y,b]=E.useState(!1),[_,x]=E.useState(null),[N,T]=E.useState(null),S=E.useRef(null),M=E.useRef(null),C=E.useRef([]),R=E.useRef(null),F=E.useCallback(async()=>{try{const j=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});M.current=j,C.current=[];const L=new MediaRecorder(j);S.current=L,L.ondataavailable=B=>{B.data.size>0&&C.current.push(B.data)},L.onstop=()=>{const B=new Blob(C.current,{type:"audio/webm"});x(B),j.getTracks().forEach(V=>V.stop()),M.current=null},L.start(1e3),b(!0)}catch(j){console.error("Failed to start recording:",j),p("Failed to start recording: "+(j instanceof Error?j.message:"Unknown error"))}},[]),k=E.useCallback(()=>{S.current&&S.current.state!=="inactive"&&(S.current.stop(),S.current=null),b(!1)},[]),D=E.useCallback((j,L)=>{if(N===L){R.current?.pause(),T(null);return}const B=URL.createObjectURL(j);R.current&&(R.current.src=B,R.current.onended=()=>{T(null),URL.revokeObjectURL(B)},R.current.play(),T(L))},[N]),P=E.useCallback(async()=>{if(!_)throw new Error("No recorded audio available");const j=Date.now(),L=new FormData;L.append("audio",_,"test-audio.webm"),L.append("taskType","automatic-speech-recognition"),L.append("options",JSON.stringify({model:m.stt_model,language:"auto"}));const B=await fetch("/api/huggingface/audio",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:L});if(!B.ok)throw new Error(`STT test failed: ${B.statusText}`);const V=await B.json(),z=Date.now()-j;return{test_type:"stt",success:V.success,result:V.result,latency_ms:z,quality_score:V.result?.confidence||0,model_used:m.stt_model,provider:"huggingface"}},[_,m.stt_model,n]),G=E.useCallback(async j=>{const L=Date.now(),B=await fetch("/api/huggingface/text",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({taskType:"text-to-speech",text:j,options:{model:m.tts_model,voice_settings:{speed:1,pitch:1}}})});if(!B.ok)throw new Error(`TTS test failed: ${B.statusText}`);const V=await B.json(),z=Date.now()-L,Y=V.success?Math.max(.5,1-z/1e4):0;return{test_type:"tts",success:V.success,result:V.result,latency_ms:z,quality_score:Y,model_used:m.tts_model,provider:"huggingface"}},[m.tts_model,n]),$=E.useCallback(async()=>{if(!_)throw new Error("No recorded audio available");const j=Date.now(),L=new FormData;L.append("audio",_,"test-audio.webm"),L.append("taskType","voice-swap"),L.append("options",JSON.stringify({stt_model:m.stt_model,tts_model:m.voice_swap_model,target_voice:"default"}));const B=await fetch("/api/huggingface/audio",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:L});if(!B.ok)throw new Error(`Voice swap test failed: ${B.statusText}`);const V=await B.json(),z=Date.now()-j;return{test_type:"voice_swap",success:V.success,result:V.result,latency_ms:z,quality_score:V.result?.confidence||0,model_used:`${m.stt_model} + ${m.voice_swap_model}`,provider:"huggingface"}},[_,m,n]),U=E.useCallback(async()=>{if(!_){p("Please record audio first");return}s(!0),p("");const j=[];try{o("Testing Speech-to-Text...");const L=await P();j.push(L),o("Testing Text-to-Speech...");const B=await G(m.test_phrases[0]);j.push(B),o("Testing Voice Conversion...");const V=await $();if(j.push(V),m.enable_quality_analysis)for(let z=1;z<Math.min(3,m.test_phrases.length);z++){o(`Testing TTS phrase ${z+1}...`);const Y=await G(m.test_phrases[z]);j.push({...Y,test_type:"tts"})}r(j),o("")}catch(L){console.error("Test suite error:",L),p(L instanceof Error?L.message:"Test suite failed")}finally{s(!1),o("")}},[_,m,P,G,$]),O=E.useCallback(()=>{if(t.length===0)return{status:"pending",message:"No tests run"};const L=t.filter(B=>B.success&&B.quality_score>=m.quality_threshold&&B.latency_ms<=m.latency_threshold).length/t.length;return L>=.8?{status:"excellent",message:"All systems performing well"}:L>=.6?{status:"good",message:"Most systems working correctly"}:L>=.4?{status:"fair",message:"Some issues detected"}:{status:"poor",message:"Multiple systems need attention"}},[t,m])();return c.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 ${e}`,children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(I5,{className:"h-6 w-6 text-purple-600"}),c.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Audio System Testing"})]}),c.jsx("div",{className:"flex items-center space-x-3",children:c.jsx("button",{onClick:()=>u(!l),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:c.jsx(Dx,{className:"h-5 w-5"})})})]}),h&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(po,{className:"h-5 w-5 text-red-600"}),c.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:h})]})}),t.length>0&&c.jsx("div",{className:`mb-6 p-4 rounded-lg border ${O.status==="excellent"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":O.status==="good"?"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":O.status==="fair"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800"}`,children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(Xi,{className:`h-6 w-6 ${O.status==="excellent"?"text-green-600":O.status==="good"?"text-blue-600":O.status==="fair"?"text-yellow-600":"text-red-600"}`}),c.jsxs("div",{children:[c.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:["System Status: ",O.status.charAt(0).toUpperCase()+O.status.slice(1)]}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:O.message})]})]}),c.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-400",children:[c.jsxs("p",{children:[t.filter(j=>j.success).length,"/",t.length," tests passed"]}),c.jsxs("p",{children:["Avg latency: ",Math.round(t.reduce((j,L)=>j+L.latency_ms,0)/t.length),"ms"]})]})]})}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Audio Recording"}),c.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[c.jsxs("button",{onClick:y?k:F,disabled:i,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${y?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-400"}`,children:[y?c.jsx(Jd,{className:"h-5 w-5"}):c.jsx(gl,{className:"h-5 w-5"}),c.jsx("span",{children:y?"Stop Recording":"Start Recording"})]}),_&&c.jsxs("button",{onClick:()=>D(_,"recorded"),className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[N==="recorded"?c.jsx(N5,{className:"h-5 w-5"}):c.jsx(C5,{className:"h-5 w-5"}),c.jsx("span",{children:"Play Recording"})]})]}),y&&M.current&&c.jsx("div",{className:"mb-4",children:c.jsx(e1,{isRecording:y,audioStream:M.current,width:400,height:60,barColor:"#3b82f6",backgroundColor:"rgba(0, 0, 0, 0.1)"})}),_&&c.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:c.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[" Audio recorded (",(_.size/1024).toFixed(1)," KB)"]})})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:U,disabled:!_||i,className:"flex items-center space-x-2 px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:i?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"}),c.jsx("span",{children:"Running Tests..."})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ix,{className:"h-5 w-5"}),c.jsx("span",{children:"Run Full Test Suite"})]})}),i&&a&&c.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[c.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-purple-600 border-t-transparent rounded-full"}),c.jsx("span",{children:a})]})]}),c.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Record audio first, then run the test suite to validate STT, TTS, and voice conversion capabilities."})]}),t.length>0&&c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Test Results"}),c.jsx("div",{className:"space-y-4",children:t.map((j,L)=>c.jsxs("div",{className:`p-4 border rounded-lg ${j.success&&j.quality_score>=m.quality_threshold&&j.latency_ms<=m.latency_threshold?"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":"border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800"}`,children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[j.success?c.jsx(Xi,{className:"h-5 w-5 text-green-600"}):c.jsx(po,{className:"h-5 w-5 text-red-600"}),c.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:[j.test_type.toUpperCase().replace("_"," ")," Test"]})]}),c.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[c.jsxs("span",{children:["Quality: ",(j.quality_score*100).toFixed(0),"%"]}),c.jsxs("span",{children:["Latency: ",j.latency_ms,"ms"]})]})]}),c.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsxs("p",{children:["Model: ",j.model_used]}),c.jsxs("p",{children:["Provider: ",j.provider]}),j.error&&c.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error: ",j.error]}),j.result&&j.test_type==="stt"&&c.jsxs("p",{children:['Transcript: "',j.result.transcript||j.result.text,'"']})]})]},L))})]}),l&&c.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-4",children:"Test Settings"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"STT Model"}),c.jsx("select",{value:m.stt_model,onChange:j=>g(L=>({...L,stt_model:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:AP.stt.map(j=>c.jsxs("option",{value:j.id,children:[j.name," (",j.quality,")"]},j.id))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"TTS Model"}),c.jsx("select",{value:m.tts_model,onChange:j=>g(L=>({...L,tts_model:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:AP.tts.map(j=>c.jsxs("option",{value:j.id,children:[j.name," (",j.quality,")"]},j.id))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quality Threshold"}),c.jsx("input",{type:"number",min:"0",max:"1",step:"0.1",value:m.quality_threshold,onChange:j=>g(L=>({...L,quality_threshold:parseFloat(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Latency Threshold (ms)"}),c.jsx("input",{type:"number",min:"1000",max:"30000",step:"500",value:m.latency_threshold,onChange:j=>g(L=>({...L,latency_threshold:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),c.jsx("div",{className:"mt-4 space-y-2",children:c.jsxs("label",{className:"flex items-center space-x-2",children:[c.jsx("input",{type:"checkbox",checked:m.enable_quality_analysis,onChange:j=>g(L=>({...L,enable_quality_analysis:j.target.checked})),className:"rounded border-gray-300"}),c.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable comprehensive quality analysis"})]})})]}),c.jsx("audio",{ref:R,className:"hidden"})]})},RP=["What objects can you see in this image?","What colors are prominent in this image?","What is the main subject of this image?","What activities are happening in this image?","What is the setting or location of this image?"],Bde={"image-classification":[{id:"google/vit-base-patch16-224",name:"Vision Transformer Base",quality:"High"},{id:"microsoft/resnet-50",name:"ResNet-50",quality:"Medium"}],"object-detection":[{id:"facebook/detr-resnet-50",name:"DETR ResNet-50",quality:"High"},{id:"microsoft/table-transformer-detection",name:"Table Transformer",quality:"Specialized"}],"image-to-text":[{id:"Salesforce/blip-image-captioning-base",name:"BLIP Image Captioning",quality:"High"},{id:"microsoft/git-base",name:"GIT Base",quality:"Medium"}],"visual-question-answering":[{id:"dandelin/vilt-b32-finetuned-vqa",name:"ViLT VQA",quality:"High"}]},zde=({token:n,className:e=""})=>{const[t,r]=E.useState([]),[i,s]=E.useState(!1),[a,o]=E.useState(""),[l,u]=E.useState(!1),[h,p]=E.useState(""),[m,g]=E.useState([]),[y,b]=E.useState(!1),[_,x]=E.useState(null),N=E.useRef(null),T=E.useRef(null),S=E.useRef(null),M=E.useRef(null),[C,R]=E.useState({resolution:"medium",models:{"image-classification":"google/vit-base-patch16-224","object-detection":"facebook/detr-resnet-50","image-to-text":"Salesforce/blip-image-captioning-base","visual-question-answering":"dandelin/vilt-b32-finetuned-vqa"},test_images:[],confidence_threshold:.7,latency_threshold:1e4,enable_batch_testing:!1,auto_capture_interval:5}),F={low:{width:640,height:480},medium:{width:1280,height:720},high:{width:1920,height:1080}},k=E.useCallback(async()=>{try{p("");const j={video:{...F[C.resolution],facingMode:"user"}},L=await navigator.mediaDevices.getUserMedia(j);S.current=L,N.current&&(N.current.srcObject=L,await N.current.play()),b(!0)}catch(j){console.error("Failed to start camera:",j),p("Failed to access camera: "+(j instanceof Error?j.message:"Unknown error"))}},[C.resolution]),D=E.useCallback(()=>{M.current&&(clearInterval(M.current),M.current=null),S.current&&(S.current.getTracks().forEach(j=>j.stop()),S.current=null),N.current&&(N.current.srcObject=null),b(!1)},[]),P=E.useCallback(async()=>{if(!N.current||!T.current)throw new Error("Camera not ready");const j=N.current,L=T.current,B=L.getContext("2d");if(!B)throw new Error("Failed to get canvas context");return L.width=j.videoWidth,L.height=j.videoHeight,B.drawImage(j,0,0),new Promise(V=>{L.toBlob(z=>{z&&V(z)},"image/jpeg",.85)})},[]),G=E.useCallback(async()=>{try{const j=await P(),L=`capture_${Date.now()}`;g(B=>[...B,{blob:j,timestamp:new Date,id:L}]),p("")}catch(j){p("Failed to capture image: "+(j instanceof Error?j.message:"Unknown error"))}},[P]),$=E.useCallback(async(j,L,B)=>{const V=Date.now(),z=new FormData;z.append("image",L,"test-image.jpg"),z.append("taskType",j),j==="visual-question-answering"&&B&&z.append("question",B);const Y={model:C.models[j],confidence_threshold:C.confidence_threshold};z.append("options",JSON.stringify(Y));const se=await fetch("/api/huggingface/vision",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:z});if(!se.ok)throw new Error(`${j} test failed: ${se.statusText}`);const J=await se.json(),q=Date.now()-V,Q={resolution:`${T.current?.width}x${T.current?.height}`,file_size:L.size,quality_score:L.size>1e5?.9:L.size>5e4?.7:.5};return{test_type:j,success:J.success,result:J.result,error:J.error,latency_ms:q,confidence:J.result?.confidence||0,model_used:C.models[j],provider:"huggingface",image_analysis:Q}},[C,n]),U=E.useCallback(async()=>{const j=m.find(B=>B.id===_);if(!j){p("Please capture and select an image first");return}s(!0),p("");const L=[];try{o("Testing Image Classification...");const B=await $("image-classification",j.blob);L.push(B),o("Testing Object Detection...");const V=await $("object-detection",j.blob);L.push(V),o("Testing Image Description...");const z=await $("image-to-text",j.blob);L.push(z);for(let Y=0;Y<Math.min(2,RP.length);Y++){o(`Testing Visual Q&A ${Y+1}...`);const se=await $("visual-question-answering",j.blob,RP[Y]);L.push(se)}r(L)}catch(B){console.error("Test suite error:",B),p(B instanceof Error?B.message:"Test suite failed")}finally{s(!1),o("")}},[m,_,$]),K=E.useCallback(()=>{if(t.length===0)return{status:"pending",message:"No tests run"};const L=t.filter(B=>B.success&&B.confidence>=C.confidence_threshold&&B.latency_ms<=C.latency_threshold).length/t.length;return L>=.8?{status:"excellent",message:"All vision systems performing well"}:L>=.6?{status:"good",message:"Most vision systems working correctly"}:L>=.4?{status:"fair",message:"Some vision issues detected"}:{status:"poor",message:"Multiple vision systems need attention"}},[t,C]);E.useEffect(()=>()=>{D()},[D]);const O=K();return c.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 ${e}`,children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(Qf,{className:"h-6 w-6 text-indigo-600"}),c.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Camera Vision Testing"})]}),c.jsx("button",{onClick:()=>u(!l),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:c.jsx(Dx,{className:"h-5 w-5"})})]}),h&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(po,{className:"h-5 w-5 text-red-600"}),c.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:h})]})}),t.length>0&&c.jsx("div",{className:`mb-6 p-4 rounded-lg border ${O.status==="excellent"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":O.status==="good"?"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":O.status==="fair"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800"}`,children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(Xi,{className:`h-6 w-6 ${O.status==="excellent"?"text-green-600":O.status==="good"?"text-blue-600":O.status==="fair"?"text-yellow-600":"text-red-600"}`}),c.jsxs("div",{children:[c.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:["Vision Status: ",O.status.charAt(0).toUpperCase()+O.status.slice(1)]}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:O.message})]})]}),c.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-400",children:[c.jsxs("p",{children:[t.filter(j=>j.success).length,"/",t.length," tests passed"]}),c.jsxs("p",{children:["Avg confidence: ",Math.round(t.reduce((j,L)=>j+L.confidence,0)/t.length*100),"%"]})]})]})}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Camera Control"}),c.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[c.jsxs("button",{onClick:y?D:k,disabled:i,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${y?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-400"}`,children:[y?c.jsx(Jd,{className:"h-5 w-5"}):c.jsx(Qf,{className:"h-5 w-5"}),c.jsx("span",{children:y?"Stop Camera":"Start Camera"})]}),y&&c.jsxs("button",{onClick:G,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[c.jsx(Vk,{className:"h-5 w-5"}),c.jsx("span",{children:"Capture Image"})]})]}),y&&c.jsx("div",{className:"mb-4 bg-black rounded-lg overflow-hidden",children:c.jsx("video",{ref:N,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full max-w-md mx-auto object-cover"})}),m.length>0&&c.jsxs("div",{children:[c.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:["Captured Images (",m.length,")"]}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:m.map(j=>c.jsxs("div",{className:`relative border-2 rounded-lg cursor-pointer ${_===j.id?"border-blue-500":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,onClick:()=>x(j.id),children:[c.jsx("img",{src:URL.createObjectURL(j.blob),alt:"Captured",className:"w-full h-24 object-cover rounded"}),c.jsx("div",{className:"absolute bottom-1 left-1 right-1 bg-black bg-opacity-50 text-white text-xs px-1 py-0.5 rounded text-center",children:j.timestamp.toLocaleTimeString()}),c.jsx("button",{onClick:L=>{L.stopPropagation(),g(B=>B.filter(V=>V.id!==j.id)),_===j.id&&x(null)},className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:c.jsx(Gk,{className:"h-3 w-3"})}),_===j.id&&c.jsx("div",{className:"absolute inset-0 bg-blue-500 bg-opacity-20 rounded-lg flex items-center justify-center",children:c.jsx(Xi,{className:"h-6 w-6 text-blue-600"})})]},j.id))})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:U,disabled:!_||i,className:"flex items-center space-x-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:i?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"}),c.jsx("span",{children:"Running Vision Tests..."})]}):c.jsxs(c.Fragment,{children:[c.jsx(Ix,{className:"h-5 w-5"}),c.jsx("span",{children:"Run Vision Test Suite"})]})}),i&&a&&c.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[c.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-indigo-600 border-t-transparent rounded-full"}),c.jsx("span",{children:a})]})]}),c.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Capture an image, select it, then run the test suite to validate classification, detection, captioning, and Q&A capabilities."})]}),t.length>0&&c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Vision Test Results"}),c.jsx("div",{className:"space-y-4",children:t.map((j,L)=>c.jsxs("div",{className:`p-4 border rounded-lg ${j.success&&j.confidence>=C.confidence_threshold&&j.latency_ms<=C.latency_threshold?"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":"border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800"}`,children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[j.success?c.jsx(Xi,{className:"h-5 w-5 text-green-600"}):c.jsx(po,{className:"h-5 w-5 text-red-600"}),c.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:[j.test_type.replace(/-/g," ").replace(/\b\w/g,B=>B.toUpperCase())," Test"]})]}),c.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[c.jsxs("span",{children:["Confidence: ",(j.confidence*100).toFixed(0),"%"]}),c.jsxs("span",{children:["Latency: ",j.latency_ms,"ms"]})]})]}),c.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsxs("p",{children:["Model: ",j.model_used]}),j.image_analysis&&c.jsxs("p",{children:["Resolution: ",j.image_analysis.resolution," | Size: ",(j.image_analysis.file_size/1024).toFixed(1),"KB"]}),j.error&&c.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error: ",j.error]}),j.success&&j.result&&c.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-600 rounded text-xs",children:[j.test_type==="image-classification"&&j.result.classifications&&c.jsxs("div",{children:[c.jsx("strong",{children:"Classifications:"}),j.result.classifications.slice(0,3).map((B,V)=>c.jsxs("div",{children:[" ",B.label,": ",(B.confidence*100).toFixed(1),"%"]},V))]}),j.test_type==="object-detection"&&j.result.detected_objects&&c.jsxs("div",{children:[c.jsx("strong",{children:"Objects Detected:"})," ",j.result.detected_objects.length,j.result.detected_objects.slice(0,3).map((B,V)=>c.jsxs("div",{children:[" ",B.label,": ",(B.confidence*100).toFixed(1),"%"]},V))]}),j.test_type==="image-to-text"&&j.result.generated_text&&c.jsxs("div",{children:[c.jsx("strong",{children:"Description:"}),' "',j.result.generated_text,'"']}),j.test_type==="visual-question-answering"&&j.result.answer&&c.jsxs("div",{children:[c.jsx("strong",{children:"Answer:"}),' "',j.result.answer,'"']})]})]})]},L))})]}),l&&c.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[c.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-4",children:"Vision Test Settings"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Camera Resolution"}),c.jsxs("select",{value:C.resolution,onChange:j=>R(L=>({...L,resolution:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[c.jsx("option",{value:"low",children:"Low (640x480)"}),c.jsx("option",{value:"medium",children:"Medium (1280x720)"}),c.jsx("option",{value:"high",children:"High (1920x1080)"})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confidence Threshold"}),c.jsx("input",{type:"number",min:"0",max:"1",step:"0.1",value:C.confidence_threshold,onChange:j=>R(L=>({...L,confidence_threshold:parseFloat(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Latency Threshold (ms)"}),c.jsx("input",{type:"number",min:"1000",max:"30000",step:"1000",value:C.latency_threshold,onChange:j=>R(L=>({...L,latency_threshold:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Model Preferences"}),Object.entries(Bde).map(([j,L])=>c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:j.replace(/-/g," ").replace(/\b\w/g,B=>B.toUpperCase())}),c.jsx("select",{value:C.models[j],onChange:B=>R(V=>({...V,models:{...V.models,[j]:B.target.value}})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:L.map(B=>c.jsxs("option",{value:B.id,children:[B.name," (",B.quality,")"]},B.id))})]},j))]})]})]}),c.jsx("canvas",{ref:T,className:"hidden"})]})},PP=[{id:"dashboard",name:"Dashboard",icon:kw,description:"System health and performance metrics"},{id:"models",name:"Model Catalog",icon:Jf,description:"Browse and select HuggingFace models"},{id:"rag",name:"RAG Pipeline",icon:zk,description:"Document-based question answering"},{id:"voice",name:"Voice AI",icon:gl,description:"Speech-to-text and voice processing"},{id:"vision",name:"Computer Vision",icon:Qf,description:"Image analysis and understanding"},{id:"audio-test",name:"Audio Testing",icon:BM,description:"Test audio processing capabilities"},{id:"camera-test",name:"Vision Testing",icon:BM,description:"Test computer vision capabilities"}],Vde=({token:n,className:e=""})=>{const[t,r]=E.useState("dashboard"),[i,s]=E.useState(),[a,o]=E.useState(null),[l,u]=E.useState(null),h=E.useCallback(y=>{s(y),console.log("[HF Hub] Model selected:",y.repo_id)},[]),p=E.useCallback(y=>{o(y),console.log("[HF Hub] Voice transcript received:",y.transcript)},[]),m=E.useCallback(y=>{u(y),console.log("[HF Hub] Vision analysis received:",y)},[]),g=()=>{switch(t){case"dashboard":return c.jsx(kde,{token:n,className:"w-full"});case"models":return c.jsx(Rde,{onSelectModel:h,selectedModel:i,className:"w-full"});case"rag":return c.jsx(Pde,{token:n,className:"w-full"});case"voice":return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Enhanced Voice AI"}),c.jsxs("div",{className:"flex items-center space-x-6",children:[c.jsx(Lde,{onTranscript:p,token:n,showAdvancedSettings:!0,className:"flex-shrink-0"}),c.jsx("div",{className:"flex-1",children:a?c.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Latest Transcription"}),c.jsxs("div",{className:"flex items-center space-x-3 text-sm text-blue-700 dark:text-blue-300",children:[c.jsxs("span",{children:["Model: ",a.model.split("/").pop()]}),c.jsxs("span",{children:["Confidence: ",Math.round(a.confidence*100),"%"]}),c.jsxs("span",{children:["Latency: ",a.latency_ms,"ms"]})]})]}),c.jsxs("blockquote",{className:"text-blue-800 dark:text-blue-200 italic",children:['"',a.transcript,'"']}),c.jsxs("div",{className:"mt-2 text-xs text-blue-600 dark:text-blue-400",children:["Words: ",a.word_count," |",a.language_detected&&` Language: ${a.language_detected} |`,"Provider: ",a.provider]})]}):c.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-center",children:c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Click the microphone button to start voice recording with HuggingFace STT"})})})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Advanced STT"}),c.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsx("li",{children:" Multiple model support (Whisper, Wav2Vec2)"}),c.jsx("li",{children:" Multilingual recognition"}),c.jsx("li",{children:" Confidence scoring"}),c.jsx("li",{children:" Real-time audio analysis"})]})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Quality Control"}),c.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsx("li",{children:" Audio validation"}),c.jsx("li",{children:" Noise reduction"}),c.jsx("li",{children:" Quality metrics"}),c.jsx("li",{children:" Auto punctuation"})]})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Performance"}),c.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsx("li",{children:" Sub-5s processing"}),c.jsx("li",{children:" Fallback models"}),c.jsx("li",{children:" Cost optimization"}),c.jsx("li",{children:" Real-time feedback"})]})]})]})]});case"vision":return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Enhanced Computer Vision"}),c.jsxs("div",{className:"flex items-start space-x-6",children:[c.jsx(Fde,{onAnalysis:m,token:n,showAdvancedSettings:!0,className:"flex-shrink-0"}),c.jsx("div",{className:"flex-1",children:l?c.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h4",{className:"font-medium text-green-900 dark:text-green-100",children:"Latest Vision Analysis"}),c.jsxs("div",{className:"flex items-center space-x-3 text-sm text-green-700 dark:text-green-300",children:[c.jsxs("span",{children:["Task: ",l.task_type]}),c.jsxs("span",{children:["Confidence: ",Math.round(l.confidence*100),"%"]}),c.jsxs("span",{children:["Time: ",l.processing_time_ms,"ms"]})]})]}),c.jsxs("div",{className:"space-y-2 text-sm",children:[l.classifications&&c.jsxs("div",{children:[c.jsx("strong",{className:"text-green-800 dark:text-green-200",children:"Classifications:"}),c.jsx("div",{className:"mt-1",children:l.classifications.slice(0,3).map((y,b)=>c.jsxs("div",{className:"text-green-700 dark:text-green-300",children:[" ",y.label,": ",Math.round(y.confidence*100),"%"]},b))})]}),l.detected_objects&&c.jsxs("div",{children:[c.jsxs("strong",{className:"text-green-800 dark:text-green-200",children:["Objects (",l.detected_objects.length," detected):"]}),c.jsx("div",{className:"mt-1",children:l.detected_objects.slice(0,5).map((y,b)=>c.jsxs("div",{className:"text-green-700 dark:text-green-300",children:[" ",y.label,": ",Math.round(y.confidence*100),"%"]},b))})]}),l.generated_text&&c.jsxs("div",{children:[c.jsx("strong",{className:"text-green-800 dark:text-green-200",children:"Description:"}),c.jsxs("p",{className:"mt-1 text-green-700 dark:text-green-300 italic",children:['"',l.generated_text,'"']})]})]}),c.jsxs("div",{className:"mt-2 text-xs text-green-600 dark:text-green-400",children:["Model: ",l.model_used," | Provider: HuggingFace"]})]}):c.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-center",children:c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Click the camera button to start image analysis with HuggingFace Vision"})})})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Classification"}),c.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsx("li",{children:" ViT models"}),c.jsx("li",{children:" ResNet variants"}),c.jsx("li",{children:" Custom categories"})]})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Object Detection"}),c.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsx("li",{children:" DETR models"}),c.jsx("li",{children:" Bounding boxes"}),c.jsx("li",{children:" Multi-object"})]})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Image Captioning"}),c.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsx("li",{children:" BLIP models"}),c.jsx("li",{children:" GIT variants"}),c.jsx("li",{children:" Context-aware"})]})]}),c.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[c.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Visual Q&A"}),c.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[c.jsx("li",{children:" ViLT models"}),c.jsx("li",{children:" Custom questions"}),c.jsx("li",{children:" Context reasoning"})]})]})]})]});case"audio-test":return c.jsx(Ude,{token:n,className:"w-full"});case"camera-test":return c.jsx(zde,{token:n,className:"w-full"});default:return c.jsx("div",{children:"Tab content not implemented"})}};return c.jsxs("div",{className:`bg-gray-50 dark:bg-gray-900 rounded-lg shadow-xl ${e}`,children:[c.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx(nd,{className:"h-8 w-8 text-purple-600"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HuggingFace AI Integration Hub"}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Advanced AI capabilities with enhanced routing, RAG, and multimodal processing"})]})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"px-3 py-1 bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 rounded-full text-sm font-medium",children:"Enhanced"}),c.jsx("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-full text-sm font-medium",children:"v2.0"})]})]})}),c.jsx("div",{className:"px-6 py-3 border-b border-gray-200 dark:border-gray-700 overflow-x-auto",children:c.jsx("nav",{className:"flex space-x-1",children:PP.map(y=>c.jsxs("button",{onClick:()=>r(y.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${t===y.id?"bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:y.description,children:[c.jsx(y.icon,{className:"h-4 w-4"}),c.jsx("span",{children:y.name})]},y.id))})}),c.jsx("div",{className:"p-6",children:g()}),c.jsx("div",{className:"px-6 py-3 bg-gray-100 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 rounded-b-lg",children:c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 dark:text-gray-400",children:[c.jsxs("span",{children:["Active Tab: ",PP.find(y=>y.id===t)?.name]}),i&&c.jsxs("span",{children:["Selected Model: ",i.repo_id]})]}),c.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 dark:text-gray-400",children:[a&&c.jsxs("span",{className:"flex items-center space-x-1",children:[c.jsx(gl,{className:"h-4 w-4 text-blue-500"}),c.jsxs("span",{children:["Last STT: ",a.word_count," words"]})]}),l&&c.jsxs("span",{className:"flex items-center space-x-1",children:[c.jsx(Qf,{className:"h-4 w-4 text-green-500"}),c.jsxs("span",{children:["Last Vision: ",l.task_type]})]}),c.jsx("span",{className:"text-xs text-gray-500",children:"HuggingFace Integration Hub  Enhanced with Advanced Routing & RAG"})]})]})})]})},kP=({data:n,stroke:e="#60a5fa",width:t=160,height:r=40})=>{if(!n.length)return c.jsx("svg",{width:t,height:r});const i=Math.min(...n.map(l=>l.v)),a=Math.max(...n.map(l=>l.v))-i||1,o=n.map((l,u)=>{const h=u/(n.length-1)*(t-4)+2,p=r-2-(l.v-i)/a*(r-4);return`${h},${p}`}).join(" ");return c.jsx("svg",{width:t,height:r,className:"overflow-visible",children:c.jsx("polyline",{fill:"none",stroke:e,strokeWidth:2,points:o})})},Gde=({data:n,width:e=200,height:t=60,barColor:r="#a855f7"})=>{const i=Math.max(...n,1),s=e/n.length;return c.jsx("svg",{width:e,height:t,children:n.map((a,o)=>{const l=a/i*(t-4);return c.jsx("rect",{x:o*s+1,y:t-l-2,width:s-2,height:l,rx:2,className:"transition-all",fill:r},o)})})},Hde=({value:n,max:e=100,label:t})=>{const r=Math.min(1,n/e),i=r*180;return c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsxs("div",{className:"relative w-40 h-20",children:[c.jsxs("svg",{viewBox:"0 0 100 50",className:"w-full h-full",children:[c.jsx("path",{d:"M5 50 A45 45 0 0 1 95 50",fill:"none",stroke:"#374151",strokeWidth:8}),c.jsx("path",{d:"M5 50 A45 45 0 0 1 95 50",fill:"none",stroke:"#4ade80",strokeWidth:8,strokeDasharray:`${Math.PI*45} ${Math.PI*45}`,strokeDashoffset:(1-r)*Math.PI*45,strokeLinecap:"round"}),c.jsx("g",{transform:"translate(50,50)",children:c.jsx("line",{x1:0,y1:0,x2:Math.sin((-90+i)*(Math.PI/180))*35,y2:Math.cos((-90+i)*(Math.PI/180))*-35,stroke:"#fbbf24",strokeWidth:4,strokeLinecap:"round"})})]}),c.jsxs("div",{className:"absolute inset-0 flex items-end justify-center pb-1 text-xs text-gray-300",children:[Math.round(r*100),"%"]})]}),c.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t})]})},$de=({token:n,onBack:e})=>{const[t,r]=E.useState({}),[i,s]=E.useState([]),[a,o]=E.useState([]),[l,u]=E.useState([2,4,6,9,7,3,1]),[h,p]=E.useState(12),m=E.useRef();E.useEffect(()=>{(async()=>{try{const b=await fetch("/api/health/system",{headers:{Authorization:`Bearer ${n}`}});if(b.ok){const _=await b.json();r({overall:_.status||_.overall,timestamp:_.timestamp||new Date().toISOString(),services:_.services,uptime_seconds:_.uptime||_.uptimeSeconds})}}catch{}})()},[n]),E.useEffect(()=>{const y=Date.now(),b=setInterval(()=>{const _=Date.now();s(x=>[...x,{t:_,v:(_-y)/1e3/60}].slice(-50)),o(x=>{const N=x.length?x[x.length-1].v:.5,T=Math.max(0,N+(Math.random()-.5)*.2);return[...x,{t:_,v:T}].slice(-50)}),u(x=>x.map(N=>Math.max(0,N+Math.round((Math.random()-.5)*2)))),p(x=>Math.max(5,Math.min(60,x+Math.round((Math.random()-.5)*4))))},3e3);return m.current=b,()=>clearInterval(b)},[]);const g=t.overall==="healthy"?"text-green-400":"text-red-400";return c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-4",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"System Health"}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Operational metrics & service status (preview)"})]}),c.jsx("div",{className:"flex items-center space-x-3",children:c.jsxs("button",{onClick:e,className:"bg-purple-600/80 hover:bg-purple-600 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Back"})]})})]})}),c.jsxs("main",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[c.jsxs("div",{className:"glass-card p-5 rounded-xl",children:[c.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-400 mb-1",children:"Overall"}),c.jsx("div",{className:`text-lg font-semibold ${g}`,children:t.overall||""}),c.jsxs("div",{className:"text-[10px] text-gray-500 mt-2",children:["Updated ",t.timestamp?new Date(t.timestamp).toLocaleTimeString():""]})]}),c.jsxs("div",{className:"glass-card p-5 rounded-xl",children:[c.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-400 mb-1",children:"Uptime (min)"}),c.jsx(kP,{data:i})]}),c.jsxs("div",{className:"glass-card p-5 rounded-xl",children:[c.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-400 mb-1",children:"Error Rate (sim)"}),c.jsx(kP,{data:a,stroke:"#f87171"})]}),c.jsx("div",{className:"glass-card p-5 rounded-xl flex items-center justify-center",children:c.jsx(Hde,{value:h,max:60,label:"DB Connections"})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[c.jsxs("div",{className:"glass-card p-6 rounded-xl lg:col-span-2",children:[c.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Request Latency Histogram (simulated)"})]}),c.jsx(Gde,{data:l}),c.jsx("div",{className:"grid grid-cols-7 text-[10px] text-gray-400 mt-2",children:l.map((y,b)=>c.jsxs("div",{className:"text-center",children:["B",b+1]},b))})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Services"})]}),c.jsx("div",{className:"space-y-2 text-sm",children:t.services?Object.entries(t.services).map(([y,b])=>{const _=b.status==="healthy"?"text-green-400":"text-red-400";return c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-gray-400 truncate mr-2",children:y}),c.jsxs("span",{className:`flex items-center space-x-1 ${_}`,children:[c.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b.status==="healthy"?"#22c55e":"#ef4444"}}),c.jsx("span",{children:b.status})]})]},y)}):c.jsx("div",{className:"text-gray-500 text-xs",children:"No service data yet."})})]})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h2",{className:"text-lg font-semibold mb-2 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Upcoming Enhancements"})]}),c.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-300 space-y-1",children:[c.jsx("li",{children:"Real-time WebSocket metrics stream (OpenTelemetry export tap)"}),c.jsx("li",{children:"Drill-down trace viewer & error log integration"}),c.jsx("li",{children:"Historical retention & selectable time ranges"}),c.jsx("li",{children:"Service dependency graph & saturation indicators"})]})]})]})]})},vw=[{id:"action_required",name:"Action Needed",icon:""},{id:"updates",name:"Updates / Notifications",icon:""},{id:"low_priority",name:"Low Priority",icon:""}],Wde=({token:n,onBack:e})=>{const[t,r]=E.useState([]),[i,s]=E.useState(!1),[a,o]=E.useState(new Set),[l,u]=E.useState(null),[h,p]=E.useState(!1),[m,g]=E.useState(vw[0].id),[y,b]=E.useState(!1);E.useEffect(()=>{const M=()=>b(window.innerWidth<1024);return M(),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[]);const _=async()=>{s(!0);try{const M=await fetch(`/api/email/messages?limit=40&unread_only=${h}`,{headers:{Authorization:`Bearer ${n}`}});if(M.ok){const R=((await M.json()).messages||[]).map(F=>({id:F.id,from:F.from,subject:F.subject,preview:F.preview,timestamp:F.timestamp,read:F.read,category:F.category||"misc",ai_summary:F.ai_summary,confidence:Math.random()*.3+.65,priority:Math.random()>.8?"high":Math.random()>.4?"normal":"low"}));r(R)}}catch(M){console.error("Failed to load messages",M)}finally{s(!1)}};E.useEffect(()=>{_()},[n,h]);const x=M=>{o(C=>{const R=new Set(C);return R.has(M)?R.delete(M):R.add(M),R})},N=()=>{r(M=>M.map(C=>a.has(C.id)?{...C,read:!0}:C)),o(new Set)},T=(M,C)=>{r(R=>R.map(F=>F.id===M?{...F,category:C}:F))},S=vw.map(M=>({bucket:M,items:t.filter(C=>M.id==="action_required"?["welcome","personal","finance","security"].includes(C.category)||C.priority==="high":M.id==="updates"?["notifications","updates","system"].includes(C.category)||C.priority==="normal":M.id==="low_priority"?["promotions","misc","low","marketing"].includes(C.category)||C.priority==="low":!1)}));return c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-4",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50",children:" Back"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"AI Email Inbox"}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Triage and prioritize with AI-assisted categorization (preview)"})]})]}),c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs("label",{className:"flex items-center space-x-2 text-sm text-gray-300",children:[c.jsx("input",{type:"checkbox",checked:h,onChange:M=>p(M.target.checked),className:"rounded"}),c.jsx("span",{children:"Unread Only"})]}),c.jsx("button",{onClick:_,disabled:i,className:"bg-blue-600/80 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm disabled:opacity-50 flex items-center space-x-2",children:c.jsx("span",{children:i?"Loading...":"Refresh"})})]})]})}),a.size>0&&c.jsx("div",{className:"sticky top-0 z-40 bg-purple-900/70 backdrop-blur border-b border-purple-500/40 text-sm",children:c.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-2 flex items-center justify-between",children:[c.jsxs("div",{children:[a.size," selected"]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("button",{onClick:N,className:"px-3 py-1 bg-green-600 hover:bg-green-500 rounded",children:"Mark Read"}),c.jsx("button",{onClick:()=>o(new Set),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded",children:"Clear"})]})]})}),c.jsxs("main",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[y&&c.jsx("div",{className:"lg:hidden mb-4 flex items-center justify-between gap-2",children:vw.map(M=>c.jsxs("button",{onClick:()=>g(M.id),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors ${m===M.id?"bg-blue-600 border-blue-500 text-white":"bg-gray-800/60 border-gray-700 text-gray-300"}`,children:[M.icon," ",M.name.split(" ")[0]]},M.id))}),c.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:S.filter(M=>!y||M.bucket.id===m).map(({bucket:M,items:C})=>c.jsxs("div",{className:"glass-card p-4 rounded-xl flex flex-col min-h-[560px]",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("h2",{className:"text-lg font-semibold flex items-center space-x-2",children:[c.jsx("span",{children:M.icon}),c.jsx("span",{children:M.name})]}),c.jsx("span",{className:"text-xs text-gray-400",children:C.length})]}),c.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto pr-1",children:[C.map(R=>{const F=a.has(R.id);return c.jsxs("div",{className:`border border-gray-700 rounded-lg p-3 group hover:border-purple-500 transition-colors relative ${R.read?"bg-gray-800/40":"bg-gray-800/70"}`,children:[c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>u(l===R.id?null:R.id),children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:`w-2 h-2 rounded-full ${R.read?"bg-gray-600":"bg-blue-400 animate-pulse"}`}),c.jsx("span",{className:"text-sm font-semibold truncate max-w-[140px]",children:R.from}),c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gray-700 text-gray-300",children:(R.confidence||0).toFixed(2)}),R.priority==="high"&&c.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-red-600/70 rounded",children:"HIGH"})]}),c.jsx("div",{className:"mt-1 text-sm text-gray-200 line-clamp-1",children:R.subject}),c.jsx("div",{className:"text-xs text-gray-500 line-clamp-1",children:R.preview})]}),c.jsxs("div",{className:"flex flex-col items-end space-y-2 ml-2",children:[c.jsx("input",{type:"checkbox",checked:F,onChange:()=>x(R.id)}),c.jsxs("select",{value:R.category,onChange:k=>T(R.id,k.target.value),className:"bg-gray-700 text-gray-300 text-[10px] rounded px-1 py-0.5 focus:outline-none",children:[c.jsx("option",{value:"welcome",children:"welcome"}),c.jsx("option",{value:"notifications",children:"notifications"}),c.jsx("option",{value:"updates",children:"updates"}),c.jsx("option",{value:"promotions",children:"promotions"}),c.jsx("option",{value:"personal",children:"personal"}),c.jsx("option",{value:"security",children:"security"}),c.jsx("option",{value:"finance",children:"finance"}),c.jsx("option",{value:"misc",children:"misc"})]})]})]}),l===R.id&&c.jsxs("div",{className:"mt-3 border-t border-gray-700 pt-3 text-xs space-y-2",children:[c.jsx("div",{className:"text-gray-400",children:"AI Summary:"}),c.jsx("div",{className:"text-gray-300 leading-relaxed",children:R.ai_summary||"No summary available (mock)."}),c.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[c.jsx("span",{children:new Date(R.timestamp).toLocaleString()}),c.jsx("span",{children:""}),c.jsx("button",{className:"text-purple-400 hover:text-purple-300",children:"Suggest Actions"}),c.jsx("span",{children:""}),c.jsx("button",{className:"text-blue-400 hover:text-blue-300",onClick:()=>r(k=>k.map(D=>D.id===R.id?{...D,read:!0}:D)),children:"Mark Read"})]})]})]},R.id)}),C.length===0&&c.jsx("div",{className:"text-xs text-gray-600 text-center py-8",children:"No messages in this bucket."})]})]},M.id))}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Upcoming Inbox Features"})]}),c.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-300 space-y-1",children:[c.jsx("li",{children:"Backend reclassify & bulk endpoints"}),c.jsx("li",{children:"Adaptive model retraining stats & drift alerts"}),c.jsx("li",{children:"Action suggestion model integration"}),c.jsx("li",{children:"Thread grouping & conversation view"}),c.jsx("li",{children:"Snooze & follow-up reminders"})]})]})]})]})},LP=n=>{if(!n||typeof n!="string")return null;const e=n.split(".");if(e.length!==3)return null;try{const t=e[1].replace(/-/g,"+").replace(/_/g,"/"),r=t.length%4,i=r?t+"=".repeat(4-r):t,s=atob(i);return JSON.parse(s)}catch{return null}},qde=({token:n,onLogout:e})=>{const[t,r]=E.useState(null),[i,s]=E.useState(!0),[a,o]=E.useState("chat"),l=!!LP(n),[u,h]=E.useState({ai_core:{status:"checking",message:"Checking AI Core..."},websocket:{status:"checking",message:"Checking WebSocket..."},database:{status:"checking",message:"Checking Database..."},voice_service:{status:"checking",message:"Checking Voice Services..."},visual_service:{status:"checking",message:"Checking Visual Analysis..."},email_service:{status:"checking",message:"Checking Email Service..."},calendar_service:{status:"checking",message:"Checking Calendar Service..."},contacts_service:{status:"checking",message:"Checking Contacts Service..."}}),p=E.useCallback(()=>{const m=LP(n);r(m?{id:m.userId||m.sub||m.id||0,name:m.name||m.username||"User",email:m.email||"No email provided"}:null),s(!1)},[n]);return E.useEffect(()=>{const m=async()=>{p()},g=async()=>{const b=localStorage.getItem("token");if(!b)return;try{const x=await fetch("/api/health");if(x.ok){const N=await x.json();h(T=>({...T,ai_core:{status:N.services?.openai?.status==="healthy"?"online":"offline",message:N.services?.openai?.status==="healthy"?"AI Core Active":"AI Core Unavailable"},database:{status:N.overall==="healthy"?"online":"offline",message:N.overall==="healthy"?"Database Connected":"Database Error"},websocket:{status:"online",message:"Socket Connected"}})),N.services?.deepgram&&h(T=>({...T,voice_service:{status:N.services.deepgram.status==="healthy"?"online":"offline",message:N.services.deepgram.status==="healthy"?"Voice Services Active":"Voice Services Offline"}})),N.services?.visualAnalysis&&h(T=>({...T,visual_service:{status:N.services.visualAnalysis.status==="healthy"?"online":"offline",message:N.services.visualAnalysis.status==="healthy"?"Visual Analysis Active":"Visual Analysis Offline"}}))}}catch(x){console.error("Failed to fetch health status:",x),h(N=>{const T={...N};return Object.keys(T).forEach(S=>{T[S]={status:"error",message:"Health Check Failed"}}),T})}const _=[{key:"email_service",endpoint:"/api/email/status"},{key:"calendar_service",endpoint:"/api/calendar/status"},{key:"contacts_service",endpoint:"/api/contacts/status"}];for(const x of _)try{const N=await fetch(x.endpoint,{headers:{Authorization:`Bearer ${b}`}});if(N.ok){const T=await N.json();h(S=>({...S,[x.key]:{status:"online",message:T.status?.service?`${T.status.service} Active`:"Service Online"}}))}else h(T=>({...T,[x.key]:{status:"offline",message:"Service Unavailable"}}))}catch{h(T=>({...T,[x.key]:{status:"error",message:"Connection Error"}}))}};m(),g();const y=setInterval(g,3e4);return()=>clearInterval(y)},[n,e]),i?c.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center",children:c.jsx("div",{className:"glass-card p-8 rounded-xl",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsx("div",{className:"spinner"}),c.jsx("span",{className:"text-white text-xl",children:"Loading dashboard..."})]})})}):l?a==="settings"?c.jsx(K5,{token:n,onBack:()=>o("chat")}):a==="workflows"?c.jsx(QH,{token:n,onBack:()=>o("chat")}):a==="knowledge"?c.jsx(hde,{token:n,onBack:()=>o("chat")}):a==="vault"?c.jsx(vde,{token:n,onBack:()=>o("chat")}):a==="lifeos"?c.jsx(_de,{token:n,onBack:()=>o("chat")}):a==="about"?c.jsx(bde,{onBack:()=>o("chat")}):a==="license"?c.jsx(wde,{onBack:()=>o("chat")}):a==="manual"?c.jsx(Sde,{onBack:()=>o("chat")}):a==="models"?c.jsxs("div",{className:"p-4 space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("h1",{className:"text-xl font-semibold",children:"Model Router"}),c.jsx("button",{onClick:()=>o("chat"),className:"text-xs px-2 py-1 border rounded",children:"Back"})]}),c.jsx(Cde,{})]}):a==="huggingface"?c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-4",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"HuggingFace AI Integration"}),c.jsx("p",{className:"text-gray-400 mt-1",children:"Advanced AI capabilities with enhanced routing and multimodal processing"})]}),c.jsxs("button",{onClick:()=>o("chat"),className:"bg-purple-600/80 hover:bg-purple-600 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Back to Dashboard"})]})]})}),c.jsx("main",{className:"max-w-7xl mx-auto p-6",children:c.jsx(Vde,{token:n,className:"w-full"})})]}):a==="health"?c.jsx($de,{token:n,onBack:()=>o("chat")}):a==="email"?c.jsx(Wde,{token:n,onBack:()=>o("chat")}):c.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[c.jsx("header",{className:"glass-card border-b border-gray-600/50 p-4",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"Dat Bitch Cartrita"}),c.jsxs("p",{className:"text-gray-400 mt-1",children:["Welcome back, ",t?.name," "]})]}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx(Tde,{token:n,className:"transform hover:scale-105",onActivate:m=>{console.log(`Live chat activated in ${m} mode`)}}),c.jsxs("button",{onClick:()=>o("workflows"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"Workflows",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Workflows"})]}),c.jsxs("button",{onClick:()=>o("knowledge"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"Knowledge Hub",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Knowledge"})]}),c.jsxs("button",{onClick:()=>o("vault"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"API Key Vault",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Vault"})]}),c.jsxs("button",{onClick:()=>o("lifeos"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"Personal Life OS",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Life OS"})]}),c.jsxs("button",{onClick:()=>o("settings"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"Settings",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Settings"})]}),c.jsxs("button",{onClick:()=>o("models"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"Model Router",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Models"})]}),c.jsxs("button",{onClick:()=>o("huggingface"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"HuggingFace AI Hub",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"HF AI"})]}),c.jsxs("button",{onClick:()=>o("health"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"System Health",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Health"})]}),c.jsxs("button",{onClick:()=>o("email"),className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-2",title:"Email Inbox",children:[c.jsx("span",{children:""}),c.jsx("span",{className:"hidden sm:inline",children:"Email"})]}),c.jsxs("button",{onClick:e,className:"bg-red-600/80 hover:bg-red-600 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Logout"})]})]})]})}),c.jsx("main",{className:"max-w-7xl mx-auto p-6",children:c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[c.jsx("div",{className:"lg:col-span-3",children:c.jsx(W5,{token:n})}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[c.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-xl font-bold",children:t?.name.charAt(0).toUpperCase()}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:t?.name}),c.jsx("p",{className:"text-sm text-gray-400",children:t?.email})]})]}),c.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[c.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),c.jsx("span",{className:"text-green-400",children:"Online"})]})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Quick Actions"})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("button",{onClick:()=>o("workflows"),className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Workflow Automation"})]}),c.jsxs("button",{onClick:()=>o("knowledge"),className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Knowledge Hub"})]}),c.jsxs("button",{onClick:()=>o("vault"),className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"API Key Vault"})]}),c.jsxs("button",{onClick:()=>o("lifeos"),className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Personal Life OS"})]}),c.jsxs("button",{onClick:()=>o("settings"),className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Account Settings"})]}),c.jsxs("button",{onClick:()=>o("huggingface"),className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"HuggingFace AI Hub"})]}),c.jsxs("button",{className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Clear Chat History"})]}),c.jsxs("button",{className:"w-full text-left p-3 rounded-lg hover:bg-gray-800/50 transition-colors flex items-center space-x-3",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Customize Theme"})]})]})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"System Status"})]}),c.jsxs("div",{className:"space-y-3 text-sm",children:[Object.entries(u).map(([m,g])=>{const y=x=>{switch(x){case"online":return"text-green-400";case"offline":return"text-red-400";case"error":return"text-yellow-400";default:return"text-gray-400"}},b=x=>{switch(x){case"online":return"bg-green-500";case"offline":return"bg-red-500";case"error":return"bg-yellow-500";default:return"bg-gray-500"}},_=x=>{switch(x){case"ai_core":return"AI Core";case"websocket":return"WebSocket";case"database":return"Database";case"email_service":return"Email Service";case"calendar_service":return"Calendar Service";case"contacts_service":return"Contacts Service";default:return x.replace("_"," ").replace(/\b\w/g,N=>N.toUpperCase())}};return c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-gray-400",children:_(m)}),c.jsxs("span",{className:`${y(g.status)} flex items-center space-x-1`,children:[c.jsx("div",{className:`w-2 h-2 ${b(g.status)} rounded-full ${g.status==="checking"?"animate-pulse":""}`}),c.jsx("span",{children:g.message})]})]},m)}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-gray-400",children:"Sub-Agents"}),c.jsx("span",{className:"text-blue-400",children:"4 Active"})]})]})]}),c.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"Available Features"})]}),c.jsxs("div",{className:"space-y-2 text-sm",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-green-400",children:""}),c.jsx("span",{children:"Real-time Chat"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-green-400",children:""}),c.jsx("span",{children:"Message History"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-green-400",children:""}),c.jsx("span",{children:"Code Generation"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-green-400",children:""}),c.jsx("span",{children:"Image Creation"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-yellow-400",children:""}),c.jsx("span",{children:"Voice Synthesis"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-yellow-400",children:""}),c.jsx("span",{children:"Ambient Listening"})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-gray-500",children:""}),c.jsx("span",{children:"Video Analysis"})]})]})]})]})]})}),c.jsx("footer",{className:"border-t border-gray-600/50 mt-12",children:c.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:c.jsxs("div",{className:"flex justify-center items-center space-x-6",children:[c.jsxs("button",{onClick:()=>o("about"),className:"text-gray-400 hover:text-white transition-colors text-sm flex items-center space-x-1",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"About Me"})]}),c.jsxs("button",{onClick:()=>o("manual"),className:"text-gray-400 hover:text-white transition-colors text-sm flex items-center space-x-1",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"User Manual"})]}),c.jsxs("button",{onClick:()=>o("license"),className:"text-gray-400 hover:text-white transition-colors text-sm flex items-center space-x-1",children:[c.jsx("span",{children:""}),c.jsx("span",{children:"License"})]}),c.jsx("div",{className:"text-gray-500 text-xs",children:" 2025 Dat Bitch Cartrita  Iteration 21"})]})})})]}):c.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center text-white",children:c.jsxs("div",{className:"glass-card p-8 rounded-xl max-w-md space-y-6",children:[c.jsx("h1",{className:"text-2xl font-bold text-gradient",children:"Authentication Required"}),c.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:"Your session token is missing or invalid. Please sign in again to access the Cartrita dashboard features."}),c.jsx("div",{className:"flex space-x-4",children:c.jsx("button",{onClick:e,className:"bg-purple-600/80 hover:bg-purple-600 px-4 py-2 rounded-lg transition-colors",children:"Go to Login"})})]})})},Xde={dark:{primaryColor:"#0a0e1a",secondaryColor:"#111827",backgroundColor:"#0f172a",surfaceColor:"rgba(17, 24, 39, 0.8)",textColor:"#f9fafb",accentColor:"#06b6d4",glassOpacity:.6,animationSpeed:"300ms",borderRadius:"12px",fontSize:"16px"},light:{primaryColor:"#ffffff",secondaryColor:"#f8fafc",backgroundColor:"#f1f5f9",surfaceColor:"rgba(255, 255, 255, 0.9)",textColor:"#1e293b",accentColor:"#3b82f6",glassOpacity:.8,animationSpeed:"300ms",borderRadius:"12px",fontSize:"16px"},cyberpunk:{primaryColor:"#0d1117",secondaryColor:"#161b22",backgroundColor:"#0a0a0a",surfaceColor:"rgba(13, 17, 23, 0.9)",textColor:"#00ff41",accentColor:"#ff0080",glassOpacity:.4,animationSpeed:"200ms",borderRadius:"4px",fontSize:"14px"},neon:{primaryColor:"#1a0033",secondaryColor:"#2d1b4e",backgroundColor:"#0f051f",surfaceColor:"rgba(26, 0, 51, 0.7)",textColor:"#ffffff",accentColor:"#ff0080",glassOpacity:.5,animationSpeed:"400ms",borderRadius:"20px",fontSize:"16px"},minimal:{primaryColor:"#ffffff",secondaryColor:"#f5f5f5",backgroundColor:"#fafafa",surfaceColor:"rgba(255, 255, 255, 0.95)",textColor:"#333333",accentColor:"#000000",glassOpacity:.9,animationSpeed:"150ms",borderRadius:"8px",fontSize:"15px"}},Yde=E.createContext(void 0),Kde=({children:n})=>{const[e,t]=E.useState(()=>localStorage.getItem("theme")||"dark"),[r,i]=E.useState(()=>{try{const p=localStorage.getItem("customThemeSettings");if(!p)return{};const m=JSON.parse(p);return typeof m=="object"&&m!==null?m:{}}catch(p){return console.warn("Error parsing custom theme settings from localStorage:",p),localStorage.removeItem("customThemeSettings"),{}}}),s={...Xde[e],...r},a=Object.keys(r).length>0,o=p=>{t(p),localStorage.setItem("theme",p)},l=p=>{const m={...r,...p};i(m),localStorage.setItem("customThemeSettings",JSON.stringify(m))},u=()=>{i({}),localStorage.removeItem("customThemeSettings")};E.useEffect(()=>{const p=document.documentElement;Object.entries(s).forEach(([m,g])=>{const y=`--theme-${m.replace(/([A-Z])/g,"-$1").toLowerCase()}`;p.style.setProperty(y,g.toString())}),p.className=p.className.replace(/theme-\w+/g,""),p.classList.add(`theme-${e}`),e==="cyberpunk"?(p.style.setProperty("--glow-color","#00ff41"),p.style.setProperty("--shadow-color","rgba(0, 255, 65, 0.5)")):e==="neon"?(p.style.setProperty("--glow-color","#ff0080"),p.style.setProperty("--shadow-color","rgba(255, 0, 128, 0.5)")):(p.style.setProperty("--glow-color",s.accentColor),p.style.setProperty("--shadow-color",`${s.accentColor}50`))},[e,s]);const h={theme:e,themeSettings:s,setTheme:o,customSettings:r,updateCustomSettings:l,resetToPreset:u,isCustomized:a};return c.jsx(Yde.Provider,{value:h,children:n})};class Zde extends E.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:c.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center",children:c.jsxs("div",{className:"glass-card p-8 rounded-xl max-w-md mx-auto text-center",children:[c.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-500/20 flex items-center justify-center",children:c.jsx("span",{className:"text-2xl",children:""})}),c.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Oops! Something went wrong"}),c.jsx("p",{className:"text-gray-300 mb-6",children:"Don't worry, this happens sometimes. The error has been logged and we're working on it."}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:" Reload Page"}),c.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors",children:" Try Again"})]}),!1]})}):this.props.children}}const Bt=n=>typeof n=="string",Ef=()=>{let n,e;const t=new Promise((r,i)=>{n=r,e=i});return t.resolve=n,t.reject=e,t},DP=n=>n==null?"":""+n,Qde=(n,e,t)=>{n.forEach(r=>{e[r]&&(t[r]=e[r])})},Jde=/###/g,IP=n=>n&&n.indexOf("###")>-1?n.replace(Jde,"."):n,jP=n=>!n||Bt(n),Kf=(n,e,t)=>{const r=Bt(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(jP(n))return{};const s=IP(r[i]);!n[s]&&t&&(n[s]=new t),Object.prototype.hasOwnProperty.call(n,s)?n=n[s]:n={},++i}return jP(n)?{}:{obj:n,k:IP(r[i])}},FP=(n,e,t)=>{const{obj:r,k:i}=Kf(n,e,Object);if(r!==void 0||e.length===1){r[i]=t;return}let s=e[e.length-1],a=e.slice(0,e.length-1),o=Kf(n,a,Object);for(;o.obj===void 0&&a.length;)s=`${a[a.length-1]}.${s}`,a=a.slice(0,a.length-1),o=Kf(n,a,Object),o?.obj&&typeof o.obj[`${o.k}.${s}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=t},ehe=(n,e,t,r)=>{const{obj:i,k:s}=Kf(n,e,Object);i[s]=i[s]||[],i[s].push(t)},Nx=(n,e)=>{const{obj:t,k:r}=Kf(n,e);if(t&&Object.prototype.hasOwnProperty.call(t,r))return t[r]},the=(n,e,t)=>{const r=Nx(n,t);return r!==void 0?r:Nx(e,t)},iF=(n,e,t)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in n?Bt(n[r])||n[r]instanceof String||Bt(e[r])||e[r]instanceof String?t&&(n[r]=e[r]):iF(n[r],e[r],t):n[r]=e[r]);return n},Hu=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var nhe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const rhe=n=>Bt(n)?n.replace(/[&<>"'\/]/g,e=>nhe[e]):n;class ihe{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const she=[" ",",","?","!",";"],ahe=new ihe(20),ohe=(n,e,t)=>{e=e||"",t=t||"";const r=she.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(r.length===0)return!0;const i=ahe.getRegExp(`(${r.map(a=>a==="?"?"\\?":a).join("|")})`);let s=!i.test(n);if(!s){const a=n.indexOf(t);a>0&&!i.test(n.substring(0,a))&&(s=!0)}return s},BS=(n,e,t=".")=>{if(!n)return;if(n[e])return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0;const r=e.split(t);let i=n;for(let s=0;s<r.length;){if(!i||typeof i!="object")return;let a,o="";for(let l=s;l<r.length;++l)if(l!==s&&(o+=t),o+=r[l],a=i[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<r.length-1)continue;s+=l-s+1;break}i=a}return i},jp=n=>n?.replace("_","-"),lhe={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console?.[n]?.apply?.(console,e)}};class Ex{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||lhe,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,i){return i&&!this.debug?null:(Bt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Ex(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Ex(this.logger,e)}}var ua=new Ex;class Sy{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(t)||0;this.observers[r].set(t,i+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([i,s])=>{for(let a=0;a<s;a++)i(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,s])=>{for(let a=0;a<s;a++)i.apply(i,[e,...t])})}}class OP extends Sy{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r,i={}){const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,a=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,t],r&&(Array.isArray(r)?o.push(...r):Bt(r)&&s?o.push(...r.split(s)):o.push(r)));const l=Nx(this.data,o);return!l&&!t&&!r&&e.indexOf(".")>-1&&(e=o[0],t=o[1],r=o.slice(2).join(".")),l||!a||!Bt(r)?l:BS(this.data?.[e]?.[t],r,s)}addResource(e,t,r,i,s={silent:!1}){const a=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=[e,t];r&&(o=o.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(o=e.split("."),i=t,t=o[1]),this.addNamespaces(t),FP(this.data,o,i),s.silent||this.emit("added",e,t,r,i)}addResources(e,t,r,i={silent:!1}){for(const s in r)(Bt(r[s])||Array.isArray(r[s]))&&this.addResource(e,t,s,r[s],{silent:!0});i.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,i,s,a={silent:!1,skipCopy:!1}){let o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),i=r,r=t,t=o[1]),this.addNamespaces(t);let l=Nx(this.data,o)||{};a.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?iF(l,r,s):l={...l,...r},FP(this.data,o,l),a.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(i=>t[i]&&Object.keys(t[i]).length>0)}toJSON(){return this.data}}var sF={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,r,i){return n.forEach(s=>{e=this.processors[s]?.process(e,t,r,i)??e}),e}};const UP={},BP=n=>!Bt(n)&&typeof n!="boolean"&&typeof n!="number";class Mx extends Sy{constructor(e,t={}){super(),Qde(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=ua.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const r={...t};return e==null?!1:this.resolve(e,r)?.res!==void 0}extractFromKey(e,t){let r=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const a=r&&e.indexOf(r)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!ohe(e,r,i);if(a&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:Bt(s)?[s]:s};const u=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(u[0])>-1)&&(s=u.shift()),e=u.join(i)}return{key:e,namespaces:Bt(s)?[s]:s}}translate(e,t,r){let i=typeof t=="object"?{...t}:t;if(typeof i!="object"&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),typeof options=="object"&&(i={...i}),i||(i={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const s=i.returnDetails!==void 0?i.returnDetails:this.options.returnDetails,a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,{key:o,namespaces:l}=this.extractFromKey(e[e.length-1],i),u=l[l.length-1];let h=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;h===void 0&&(h=":");const p=i.lng||this.language,m=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(p?.toLowerCase()==="cimode")return m?s?{res:`${u}${h}${o}`,usedKey:o,exactUsedKey:o,usedLng:p,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:`${u}${h}${o}`:s?{res:o,usedKey:o,exactUsedKey:o,usedLng:p,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:o;const g=this.resolve(e,i);let y=g?.res;const b=g?.usedKey||o,_=g?.exactUsedKey||o,x=["[object Number]","[object Function]","[object RegExp]"],N=i.joinArrays!==void 0?i.joinArrays:this.options.joinArrays,T=!this.i18nFormat||this.i18nFormat.handleAsObject,S=i.count!==void 0&&!Bt(i.count),M=Mx.hasDefaultValue(i),C=S?this.pluralResolver.getSuffix(p,i.count,i):"",R=i.ordinal&&S?this.pluralResolver.getSuffix(p,i.count,{ordinal:!1}):"",F=S&&!i.ordinal&&i.count===0,k=F&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${C}`]||i[`defaultValue${R}`]||i.defaultValue;let D=y;T&&!y&&M&&(D=k);const P=BP(D),G=Object.prototype.toString.apply(D);if(T&&D&&P&&x.indexOf(G)<0&&!(Bt(N)&&Array.isArray(D))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const $=this.options.returnedObjectHandler?this.options.returnedObjectHandler(b,D,{...i,ns:l}):`key '${o} (${this.language})' returned an object instead of string.`;return s?(g.res=$,g.usedParams=this.getUsedParamsDetails(i),g):$}if(a){const $=Array.isArray(D),U=$?[]:{},K=$?_:b;for(const O in D)if(Object.prototype.hasOwnProperty.call(D,O)){const j=`${K}${a}${O}`;M&&!y?U[O]=this.translate(j,{...i,defaultValue:BP(k)?k[O]:void 0,joinArrays:!1,ns:l}):U[O]=this.translate(j,{...i,joinArrays:!1,ns:l}),U[O]===j&&(U[O]=D[O])}y=U}}else if(T&&Bt(N)&&Array.isArray(y))y=y.join(N),y&&(y=this.extendTranslation(y,e,i,r));else{let $=!1,U=!1;!this.isValidLookup(y)&&M&&($=!0,y=k),this.isValidLookup(y)||(U=!0,y=o);const O=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&U?void 0:y,j=M&&k!==y&&this.options.updateMissing;if(U||$||j){if(this.logger.log(j?"updateKey":"missingKey",p,u,o,j?k:y),a){const z=this.resolve(o,{...i,keySeparator:!1});z&&z.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let L=[];const B=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if(this.options.saveMissingTo==="fallback"&&B&&B[0])for(let z=0;z<B.length;z++)L.push(B[z]);else this.options.saveMissingTo==="all"?L=this.languageUtils.toResolveHierarchy(i.lng||this.language):L.push(i.lng||this.language);const V=(z,Y,se)=>{const J=M&&se!==y?se:O;this.options.missingKeyHandler?this.options.missingKeyHandler(z,u,Y,J,j,i):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(z,u,Y,J,j,i),this.emit("missingKey",z,u,Y,y)};this.options.saveMissing&&(this.options.saveMissingPlurals&&S?L.forEach(z=>{const Y=this.pluralResolver.getSuffixes(z,i);F&&i[`defaultValue${this.options.pluralSeparator}zero`]&&Y.indexOf(`${this.options.pluralSeparator}zero`)<0&&Y.push(`${this.options.pluralSeparator}zero`),Y.forEach(se=>{V([z],o+se,i[`defaultValue${se}`]||k)})}):V(L,o,k))}y=this.extendTranslation(y,e,i,g,r),U&&y===o&&this.options.appendNamespaceToMissingKey&&(y=`${u}${h}${o}`),(U||$)&&this.options.parseMissingKeyHandler&&(y=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}${h}${o}`:o,$?y:void 0,i))}return s?(g.res=y,g.usedParams=this.getUsedParamsDetails(i),g):y}extendTranslation(e,t,r,i,s){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const l=Bt(e)&&(r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let u;if(l){const p=e.match(this.interpolator.nestingRegexp);u=p&&p.length}let h=r.replace&&!Bt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(h={...this.options.interpolation.defaultVariables,...h}),e=this.interpolator.interpolate(e,h,r.lng||this.language||i.usedLng,r),l){const p=e.match(this.interpolator.nestingRegexp),m=p&&p.length;u<m&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,(...p)=>s?.[0]===p[0]&&!r.context?(this.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${t[0]}`),null):this.translate(...p,t),r)),r.interpolation&&this.interpolator.reset()}const a=r.postProcess||this.options.postProcess,o=Bt(a)?[a]:a;return e!=null&&o?.length&&r.applyPostProcessor!==!1&&(e=sF.handle(o,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,t={}){let r,i,s,a,o;return Bt(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(r))return;const u=this.extractFromKey(l,t),h=u.key;i=h;let p=u.namespaces;this.options.fallbackNS&&(p=p.concat(this.options.fallbackNS));const m=t.count!==void 0&&!Bt(t.count),g=m&&!t.ordinal&&t.count===0,y=t.context!==void 0&&(Bt(t.context)||typeof t.context=="number")&&t.context!=="",b=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);p.forEach(_=>{this.isValidLookup(r)||(o=_,!UP[`${b[0]}-${_}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(UP[`${b[0]}-${_}`]=!0,this.logger.warn(`key "${i}" for languages "${b.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),b.forEach(x=>{if(this.isValidLookup(r))return;a=x;const N=[h];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(N,h,x,_,t);else{let S;m&&(S=this.pluralResolver.getSuffix(x,t.count,t));const M=`${this.options.pluralSeparator}zero`,C=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(m&&(N.push(h+S),t.ordinal&&S.indexOf(C)===0&&N.push(h+S.replace(C,this.options.pluralSeparator)),g&&N.push(h+M)),y){const R=`${h}${this.options.contextSeparator}${t.context}`;N.push(R),m&&(N.push(R+S),t.ordinal&&S.indexOf(C)===0&&N.push(R+S.replace(C,this.options.pluralSeparator)),g&&N.push(R+M))}}let T;for(;T=N.pop();)this.isValidLookup(r)||(s=T,r=this.getResource(x,_,T,t))}))})}),{res:r,usedKey:i,exactUsedKey:s,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,r,i={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,r,i):this.resourceStore.getResource(e,t,r,i)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!Bt(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const s of t)delete i[s]}return i}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&e[r]!==void 0)return!0;return!1}}class zP{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=ua.create("languageUtils")}getScriptPartFromCode(e){if(e=jp(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=jp(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(Bt(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(r=>{if(t)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(t=i)}),!t&&this.options.supportedLngs&&e.forEach(r=>{if(t)return;const i=this.getScriptPartFromCode(r);if(this.isSupportedCode(i))return t=i;const s=this.getLanguagePartFromCode(r);if(this.isSupportedCode(s))return t=s;t=this.options.supportedLngs.find(a=>{if(a===s)return a;if(!(a.indexOf("-")<0&&s.indexOf("-")<0)&&(a.indexOf("-")>0&&s.indexOf("-")<0&&a.substring(0,a.indexOf("-"))===s||a.indexOf(s)===0&&s.length>1))return a})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),Bt(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes((t===!1?[]:t)||this.options.fallbackLng||[],e),i=[],s=a=>{a&&(this.isSupportedCode(a)?i.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return Bt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):Bt(e)&&s(this.formatLanguageCode(e)),r.forEach(a=>{i.indexOf(a)<0&&s(this.formatLanguageCode(a))}),i}}const VP={zero:0,one:1,two:2,few:3,many:4,other:5},GP={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class che{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=ua.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const r=jp(e==="dev"?"en":e),i=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:i});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let a;try{a=new Intl.PluralRules(r,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),GP;if(!e.match(/-|_/))return GP;const l=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(l,t)}return this.pluralRulesCache[s]=a,a}needsPlural(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,r={}){return this.getSuffixes(e,r).map(i=>`${t}${i}`)}getSuffixes(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?r.resolvedOptions().pluralCategories.sort((i,s)=>VP[i]-VP[s]).map(i=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,t,r={}){const i=this.getRule(e,r);return i?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,r))}}const HP=(n,e,t,r=".",i=!0)=>{let s=the(n,e,t);return!s&&i&&Bt(t)&&(s=BS(n,t,r),s===void 0&&(s=BS(e,t,r))),s},_w=n=>n.replace(/\$/g,"$$$$");class uhe{constructor(e={}){this.logger=ua.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:i,prefix:s,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:u,unescapeSuffix:h,unescapePrefix:p,nestingPrefix:m,nestingPrefixEscaped:g,nestingSuffix:y,nestingSuffixEscaped:b,nestingOptionsSeparator:_,maxReplaces:x,alwaysFormat:N}=e.interpolation;this.escape=t!==void 0?t:rhe,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=s?Hu(s):a||"{{",this.suffix=o?Hu(o):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=h?"":p||"-",this.unescapeSuffix=this.unescapePrefix?"":h||"",this.nestingPrefix=m?Hu(m):g||Hu("$t("),this.nestingSuffix=y?Hu(y):b||Hu(")"),this.nestingOptionsSeparator=_||",",this.maxReplaces=x||1e3,this.alwaysFormat=N!==void 0?N:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,r)=>t?.source===r?(t.lastIndex=0,t):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,i){let s,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=g=>{if(g.indexOf(this.formatSeparator)<0){const x=HP(t,l,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(x,void 0,r,{...i,...t,interpolationkey:g}):x}const y=g.split(this.formatSeparator),b=y.shift().trim(),_=y.join(this.formatSeparator).trim();return this.format(HP(t,l,b,this.options.keySeparator,this.options.ignoreJSONStructure),_,r,{...i,...t,interpolationkey:b})};this.resetRegExp();const h=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,p=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>_w(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?_w(this.escape(g)):_w(g)}].forEach(g=>{for(o=0;s=g.regex.exec(e);){const y=s[1].trim();if(a=u(y),a===void 0)if(typeof h=="function"){const _=h(e,s,i);a=Bt(_)?_:""}else if(i&&Object.prototype.hasOwnProperty.call(i,y))a="";else if(p){a=s[0];continue}else this.logger.warn(`missed to pass in variable ${y} for interpolating ${e}`),a="";else!Bt(a)&&!this.useRawValueToEscape&&(a=DP(a));const b=g.safeValue(a);if(e=e.replace(s[0],b),p?(g.regex.lastIndex+=a.length,g.regex.lastIndex-=s[0].length):g.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,t,r={}){let i,s,a;const o=(l,u)=>{const h=this.nestingOptionsSeparator;if(l.indexOf(h)<0)return l;const p=l.split(new RegExp(`${h}[ ]*{`));let m=`{${p[1]}`;l=p[0],m=this.interpolate(m,a);const g=m.match(/'/g),y=m.match(/"/g);((g?.length??0)%2===0&&!y||y.length%2!==0)&&(m=m.replace(/'/g,'"'));try{a=JSON.parse(m),u&&(a={...u,...a})}catch(b){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,b),`${l}${h}${m}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;i=this.nestingRegexp.exec(e);){let l=[];a={...r},a=a.replace&&!Bt(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;const u=/{.*}/.test(i[1])?i[1].lastIndexOf("}")+1:i[1].indexOf(this.formatSeparator);if(u!==-1&&(l=i[1].slice(u).split(this.formatSeparator).map(h=>h.trim()).filter(Boolean),i[1]=i[1].slice(0,u)),s=t(o.call(this,i[1].trim(),a),a),s&&i[0]===e&&!Bt(s))return s;Bt(s)||(s=DP(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),l.length&&(s=l.reduce((h,p)=>this.format(h,p,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}const dhe=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const r=n.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?t.currency||(t.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?t.range||(t.range=i.trim()):i.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),h=o.trim();t[h]||(t[h]=u),u==="false"&&(t[h]=!1),u==="true"&&(t[h]=!0),isNaN(u)||(t[h]=parseInt(u,10))}})}return{formatName:e,formatOptions:t}},$P=n=>{const e={};return(t,r,i)=>{let s=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(s={...s,[i.interpolationkey]:void 0});const a=r+JSON.stringify(s);let o=e[a];return o||(o=n(jp(r),i),e[a]=o),o(t)}},hhe=n=>(e,t,r)=>n(jp(t),r)(e);class fhe{constructor(e={}){this.logger=ua.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const r=t.cacheInBuiltFormats?$P:hhe;this.formats={number:r((i,s)=>{const a=new Intl.NumberFormat(i,{...s});return o=>a.format(o)}),currency:r((i,s)=>{const a=new Intl.NumberFormat(i,{...s,style:"currency"});return o=>a.format(o)}),datetime:r((i,s)=>{const a=new Intl.DateTimeFormat(i,{...s});return o=>a.format(o)}),relativetime:r((i,s)=>{const a=new Intl.RelativeTimeFormat(i,{...s});return o=>a.format(o,s.range||"day")}),list:r((i,s)=>{const a=new Intl.ListFormat(i,{...s});return o=>a.format(o)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=$P(t)}format(e,t,r,i={}){const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(o=>o.indexOf(")")>-1)){const o=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,o)].join(this.formatSeparator)}return s.reduce((o,l)=>{const{formatName:u,formatOptions:h}=dhe(l);if(this.formats[u]){let p=o;try{const m=i?.formatParams?.[i.interpolationkey]||{},g=m.locale||m.lng||i.locale||i.lng||r;p=this.formats[u](o,g,{...h,...i,...m})}catch(m){this.logger.warn(m)}return p}else this.logger.warn(`there was no format function for ${u}`);return o},e)}}const phe=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class mhe extends Sy{constructor(e,t,r,i={}){super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=ua.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,i.backend,i)}queueLoad(e,t,r,i){const s={},a={},o={},l={};return e.forEach(u=>{let h=!0;t.forEach(p=>{const m=`${u}|${p}`;!r.reload&&this.store.hasResourceBundle(u,p)?this.state[m]=2:this.state[m]<0||(this.state[m]===1?a[m]===void 0&&(a[m]=!0):(this.state[m]=1,h=!1,a[m]===void 0&&(a[m]=!0),s[m]===void 0&&(s[m]=!0),l[p]===void 0&&(l[p]=!0)))}),h||(o[u]=!0)}),(Object.keys(s).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,t,r){const i=e.split("|"),s=i[0],a=i[1];t&&this.emit("failedLoading",s,a,t),!t&&r&&this.store.addResourceBundle(s,a,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const o={};this.queue.forEach(l=>{ehe(l.loaded,[s],a),phe(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{o[u]||(o[u]={});const h=l.loaded[u];h.length&&h.forEach(p=>{o[u][p]===void 0&&(o[u][p]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,t,r,i=0,s=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:r,tried:i,wait:s,callback:a});return}this.readingCalls++;const o=(u,h)=>{if(this.readingCalls--,this.waitingReads.length>0){const p=this.waitingReads.shift();this.read(p.lng,p.ns,p.fcName,p.tried,p.wait,p.callback)}if(u&&h&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,r,i+1,s*2,a)},s);return}a(u,h)},l=this.backend[r].bind(this.backend);if(l.length===2){try{const u=l(e,t);u&&typeof u.then=="function"?u.then(h=>o(null,h)).catch(o):o(null,u)}catch(u){o(u)}return}return l(e,t,o)}prepareLoading(e,t,r={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();Bt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Bt(t)&&(t=[t]);const s=this.queueLoad(e,t,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e,t=""){const r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${t}loading namespace ${s} for language ${i} failed`,a),!a&&o&&this.logger.log(`${t}loaded namespace ${s} for language ${i}`,o),this.loaded(e,a,o)})}saveMissing(e,t,r,i,s,a={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend?.create){const l={...a,isUpdate:s},u=this.backend.create.bind(this.backend);if(u.length<6)try{let h;u.length===5?h=u(e,t,r,i,l):h=u(e,t,r,i),h&&typeof h.then=="function"?h.then(p=>o(null,p)).catch(o):o(null,h)}catch(h){o(h)}else u(e,t,r,i,o,l)}!e||!e[0]||this.store.addResource(e[0],t,r,i)}}}const WP=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),Bt(n[1])&&(e.defaultValue=n[1]),Bt(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(r=>{e[r]=t[r]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),qP=n=>(Bt(n.ns)&&(n.ns=[n.ns]),Bt(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),Bt(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs?.indexOf?.("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n),N0=()=>{},ghe=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class Fp extends Sy{constructor(e={},t){if(super(),this.options=qP(e),this.services={},this.logger=ua,this.modules={external:[]},ghe(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,typeof e=="function"&&(t=e,e={}),e.defaultNS==null&&e.ns&&(Bt(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=WP();this.options={...r,...this.options,...qP(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator);const i=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?ua.init(i(this.modules.logger),this.options):ua.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:u=fhe;const h=new zP(this.options);this.store=new OP(this.options.resources,this.options);const p=this.services;p.logger=ua,p.resourceStore=this.store,p.languageUtils=h,p.pluralResolver=new che(h,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.warn("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),u&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(p.formatter=i(u),p.formatter.init&&p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new uhe(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new mhe(i(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",(g,...y)=>{this.emit(g,...y)}),this.modules.languageDetector&&(p.languageDetector=i(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=i(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new Mx(this.services,this.options),this.translator.on("*",(g,...y)=>{this.emit(g,...y)}),this.modules.external.forEach(g=>{g.init&&g.init(this)})}if(this.format=this.options.interpolation.format,t||(t=N0),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=(...h)=>this.store[u](...h)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=(...h)=>(this.store[u](...h),this)});const o=Ef(),l=()=>{const u=(h,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(p),t(h,p)};if(this.languages&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),o}loadResources(e,t=N0){let r=t;const i=Bt(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const s=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(u=>{u!=="cimode"&&s.indexOf(u)<0&&s.push(u)})};i?a(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload?.forEach?.(o=>a(o)),this.services.backendConnector.load(s,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(o)})}else r(null)}reloadResources(e,t,r){const i=Ef();return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=N0),this.services.backendConnector.reload(e,t,s=>{i.resolve(),r(s)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&sF.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let t=0;t<this.languages.length;t++){const r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const r=Ef();this.emit("languageChanging",e);const i=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},s=(o,l)=>{l?this.isLanguageChangingTo===e&&(i(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,r.resolve((...u)=>this.t(...u)),t&&t(o,(...u)=>this.t(...u))},a=o=>{!e&&!o&&this.services.languageDetector&&(o=[]);const l=Bt(o)?o:o&&o[0],u=this.store.hasLanguageSomeTranslations(l)?l:this.services.languageUtils.getBestMatchFromCodes(Bt(o)?[o]:o);u&&(this.language||i(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector?.cacheUserLanguage?.(u)),this.loadResources(u,h=>{s(h,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),r}getFixedT(e,t,r){const i=(s,a,...o)=>{let l;typeof a!="object"?l=this.options.overloadTranslationOptionHandler([s,a].concat(o)):l={...a},l.lng=l.lng||i.lng,l.lngs=l.lngs||i.lngs,l.ns=l.ns||i.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||r||i.keyPrefix);const u=this.options.keySeparator||".";let h;return l.keyPrefix&&Array.isArray(s)?h=s.map(p=>`${l.keyPrefix}${u}${p}`):h=l.keyPrefix?`${l.keyPrefix}${u}${s}`:s,this.t(h,l)};return Bt(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=r,i}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const u=this.services.backendConnector.state[`${o}|${l}`];return u===-1||u===0||u===2};if(t.precheck){const o=t.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(r,e)&&(!i||a(s,e)))}loadNamespaces(e,t){const r=Ef();return this.options.ns?(Bt(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),t&&t(i)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=Ef();Bt(e)&&(e=[e]);const i=this.options.preload||[],s=e.filter(a=>i.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return s.length?(this.options.preload=i.concat(s),this.loadResources(a=>{r.resolve(),t&&t(a)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const i=new Intl.Locale(e);if(i&&i.getTextInfo){const s=i.getTextInfo();if(s&&s.direction)return s.direction}}catch{}const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services?.languageUtils||new zP(WP());return e.toLowerCase().indexOf("-latn")>1?"ltr":t.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){return new Fp(e,t)}cloneInstance(e={},t=N0){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},s=new Fp(i);if((e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(o=>{s[o]=this[o]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const o=Object.keys(this.store.data).reduce((l,u)=>(l[u]={...this.store.data[u]},l[u]=Object.keys(l[u]).reduce((h,p)=>(h[p]={...l[u][p]},h),l[u]),l),{});s.store=new OP(o,i),s.services.resourceStore=s.store}return s.translator=new Mx(s.services,i),s.translator.on("*",(o,...l)=>{s.emit(o,...l)}),s.init(i,t),s.translator.options=i,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ti=Fp.createInstance();ti.createInstance=Fp.createInstance;ti.createInstance;ti.dir;ti.init;ti.loadResources;ti.reloadResources;ti.use;ti.changeLanguage;ti.getFixedT;ti.t;ti.exists;ti.setDefaultNamespace;ti.hasLoadedNamespace;ti.loadNamespaces;ti.loadLanguages;const{slice:xhe,forEach:yhe}=[];function vhe(n){return yhe.call(xhe.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}function _he(n){return typeof n!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(t=>t.test(n))}const XP=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,bhe=function(n,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let s=`${n}=${i}`;if(r.maxAge>0){const a=r.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(a)}`}if(r.domain){if(!XP.test(r.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${r.domain}`}if(r.path){if(!XP.test(r.path))throw new TypeError("option path is invalid");s+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(s+="; Partitioned"),s},YP={create(n,e,t,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+t*60*1e3)),r&&(i.domain=r),document.cookie=bhe(n,e,i)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let r=0;r<t.length;r++){let i=t[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(n,e){this.create(n,"",-1,e)}};var whe={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return YP.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:r,cookieDomain:i,cookieOptions:s}=e;t&&typeof document<"u"&&YP.create(t,n,r,i,s)}},She={name:"querystring",lookup(n){let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:r}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(r=window.location.hash.substring(window.location.hash.indexOf("?")));const s=r.substring(1).split("&");for(let a=0;a<s.length;a++){const o=s[a].indexOf("=");o>0&&s[a].substring(0,o)===e&&(t=s[a].substring(o+1))}}return t}},The={name:"hash",lookup(n){let{lookupHash:e,lookupFromHashIndex:t}=n,r;if(typeof window<"u"){const{hash:i}=window.location;if(i&&i.length>2){const s=i.substring(1);if(e){const a=s.split("&");for(let o=0;o<a.length;o++){const l=a[o].indexOf("=");l>0&&a[o].substring(0,l)===e&&(r=a[o].substring(l+1))}}if(r)return r;if(!r&&t>-1){const a=i.match(/\/([a-zA-Z-]*)/g);return Array.isArray(a)?a[typeof t=="number"?t:0]?.replace("/",""):void 0}}}return r}};let $u=null;const KP=()=>{if($u!==null)return $u;try{if($u=typeof window<"u"&&window.localStorage!==null,!$u)return!1;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{$u=!1}return $u};var Nhe={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&KP())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&KP()&&window.localStorage.setItem(t,n)}};let Wu=null;const ZP=()=>{if(Wu!==null)return Wu;try{if(Wu=typeof window<"u"&&window.sessionStorage!==null,!Wu)return!1;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{Wu=!1}return Wu};var Ehe={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&ZP())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&ZP()&&window.sessionStorage.setItem(t,n)}},Mhe={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:r,language:i}=navigator;if(t)for(let s=0;s<t.length;s++)e.push(t[s]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},Che={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(t=r.getAttribute("lang")),t}},Ahe={name:"path",lookup(n){let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?t[typeof e=="number"?e:0]?.replace("/",""):void 0}},Rhe={name:"subdomain",lookup(n){let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,r=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(r)return r[t]}};let aF=!1;try{document.cookie,aF=!0}catch{}const oF=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];aF||oF.splice(1,1);const Phe=()=>({order:oF,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n});class lF{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=vhe(t,this.options||{},Phe()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(whe),this.addDetector(She),this.addDetector(Nhe),this.addDetector(Ehe),this.addDetector(Mhe),this.addDetector(Che),this.addDetector(Ahe),this.addDetector(Rhe),this.addDetector(The)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,t=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(t=t.concat(i))}}),t=t.filter(r=>r!=null&&!_he(r)).map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}lF.type="languageDetector";function zS(n){"@babel/helpers - typeof";return zS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zS(n)}function cF(){return typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":zS(XMLHttpRequest))==="object"}function khe(n){return!!n&&typeof n.then=="function"}function Lhe(n){return khe(n)?n:Promise.resolve(n)}const Dhe="modulepreload",Ihe=function(n){return"/"+n},QP={},jhe=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let l=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");i=l(t.map(u=>{if(u=Ihe(u),u in QP)return;QP[u]=!0;const h=u.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":Dhe,h||(m.as="script"),m.crossOrigin="",m.href=u,o&&m.setAttribute("nonce",o),document.head.appendChild(m),h)return new Promise((g,y)=>{m.addEventListener("load",g),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})};function JP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function ek(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?JP(Object(t),!0).forEach(function(r){Fhe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):JP(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Fhe(n,e,t){return(e=Ohe(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ohe(n){var e=Uhe(n,"string");return Ac(e)=="symbol"?e:e+""}function Uhe(n,e){if(Ac(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(Ac(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Ac(n){"@babel/helpers - typeof";return Ac=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ac(n)}var Sl=typeof fetch=="function"?fetch:void 0;typeof global<"u"&&global.fetch?Sl=global.fetch:typeof window<"u"&&window.fetch&&(Sl=window.fetch);var Op;cF()&&(typeof global<"u"&&global.XMLHttpRequest?Op=global.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(Op=window.XMLHttpRequest));var Cx;typeof ActiveXObject=="function"&&(typeof global<"u"&&global.ActiveXObject?Cx=global.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(Cx=window.ActiveXObject));typeof Sl!="function"&&(Sl=void 0);if(!Sl&&!Op&&!Cx)try{jhe(()=>import("./browser-ponyfill-Dt36Qwb_.js").then(n=>n.b),[]).then(function(n){Sl=n.default}).catch(function(){})}catch{}var VS=function(e,t){if(t&&Ac(t)==="object"){var r="";for(var i in t)r+="&"+encodeURIComponent(i)+"="+encodeURIComponent(t[i]);if(!r)return e;e=e+(e.indexOf("?")!==-1?"&":"?")+r.slice(1)}return e},tk=function(e,t,r,i){var s=function(l){if(!l.ok)return r(l.statusText||"Error",{status:l.status});l.text().then(function(u){r(null,{status:l.status,data:u})}).catch(r)};if(i){var a=i(e,t);if(a instanceof Promise){a.then(s).catch(r);return}}typeof fetch=="function"?fetch(e,t).then(s).catch(r):Sl(e,t).then(s).catch(r)},nk=!1,Bhe=function(e,t,r,i){e.queryStringParams&&(t=VS(t,e.queryStringParams));var s=ek({},typeof e.customHeaders=="function"?e.customHeaders():e.customHeaders);typeof window>"u"&&typeof global<"u"&&typeof global.process<"u"&&global.process.versions&&global.process.versions.node&&(s["User-Agent"]="i18next-http-backend (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),r&&(s["Content-Type"]="application/json");var a=typeof e.requestOptions=="function"?e.requestOptions(r):e.requestOptions,o=ek({method:r?"POST":"GET",body:r?e.stringify(r):void 0,headers:s},nk?{}:a),l=typeof e.alternateFetch=="function"&&e.alternateFetch.length>=1?e.alternateFetch:void 0;try{tk(t,o,i,l)}catch(u){if(!a||Object.keys(a).length===0||!u.message||u.message.indexOf("not implemented")<0)return i(u);try{Object.keys(a).forEach(function(h){delete o[h]}),tk(t,o,i,l),nk=!0}catch(h){i(h)}}},zhe=function(e,t,r,i){r&&Ac(r)==="object"&&(r=VS("",r).slice(1)),e.queryStringParams&&(t=VS(t,e.queryStringParams));try{var s=Op?new Op:new Cx("MSXML2.XMLHTTP.3.0");s.open(r?"POST":"GET",t,1),e.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!e.withCredentials,r&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var a=e.customHeaders;if(a=typeof a=="function"?a():a,a)for(var o in a)s.setRequestHeader(o,a[o]);s.onreadystatechange=function(){s.readyState>3&&i(s.status>=400?s.statusText:null,{status:s.status,data:s.responseText})},s.send(r)}catch(l){console&&console.log(l)}},Vhe=function(e,t,r,i){if(typeof r=="function"&&(i=r,r=void 0),i=i||function(){},Sl&&t.indexOf("file:")!==0)return Bhe(e,t,r,i);if(cF()||typeof ActiveXObject=="function")return zhe(e,t,r,i);i(new Error("No fetch and no xhr implementation found!"))};function Yd(n){"@babel/helpers - typeof";return Yd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yd(n)}function rk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function bw(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?rk(Object(t),!0).forEach(function(r){uF(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):rk(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Ghe(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Hhe(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,dF(r.key),r)}}function $he(n,e,t){return e&&Hhe(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function uF(n,e,t){return(e=dF(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function dF(n){var e=Whe(n,"string");return Yd(e)=="symbol"?e:e+""}function Whe(n,e){if(Yd(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(Yd(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}var qhe=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",parse:function(t){return JSON.parse(t)},stringify:JSON.stringify,parsePayload:function(t,r,i){return uF({},r,i||"")},parseLoadPayload:function(t,r){},request:Vhe,reloadInterval:typeof window<"u"?!1:3600*1e3,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},hF=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Ghe(this,n),this.services=e,this.options=t,this.allOptions=r,this.type="backend",this.init(e,t,r)}return $he(n,[{key:"init",value:function(t){var r=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.services=t,this.options=bw(bw(bw({},qhe()),this.options||{}),i),this.allOptions=s,this.services&&this.options.reloadInterval){var a=setInterval(function(){return r.reload()},this.options.reloadInterval);Yd(a)==="object"&&typeof a.unref=="function"&&a.unref()}}},{key:"readMulti",value:function(t,r,i){this._readAny(t,t,r,r,i)}},{key:"read",value:function(t,r,i){this._readAny([t],t,[r],r,i)}},{key:"_readAny",value:function(t,r,i,s,a){var o=this,l=this.options.loadPath;typeof this.options.loadPath=="function"&&(l=this.options.loadPath(t,i)),l=Lhe(l),l.then(function(u){if(!u)return a(null,{});var h=o.services.interpolator.interpolate(u,{lng:t.join("+"),ns:i.join("+")});o.loadUrl(h,a,r,s)})}},{key:"loadUrl",value:function(t,r,i,s){var a=this,o=typeof i=="string"?[i]:i,l=typeof s=="string"?[s]:s,u=this.options.parseLoadPayload(o,l);this.options.request(this.options,t,u,function(h,p){if(p&&(p.status>=500&&p.status<600||!p.status))return r("failed loading "+t+"; status code: "+p.status,!0);if(p&&p.status>=400&&p.status<500)return r("failed loading "+t+"; status code: "+p.status,!1);if(!p&&h&&h.message){var m=h.message.toLowerCase(),g=["failed","fetch","network","load"].find(function(_){return m.indexOf(_)>-1});if(g)return r("failed loading "+t+": "+h.message,!0)}if(h)return r(h,!1);var y,b;try{typeof p.data=="string"?y=a.options.parse(p.data,i,s):y=p.data}catch{b="failed parsing "+t+" to json"}if(b)return r(b,!1);r(null,y)})}},{key:"create",value:function(t,r,i,s,a){var o=this;if(this.options.addPath){typeof t=="string"&&(t=[t]);var l=this.options.parsePayload(r,i,s),u=0,h=[],p=[];t.forEach(function(m){var g=o.options.addPath;typeof o.options.addPath=="function"&&(g=o.options.addPath(m,r));var y=o.services.interpolator.interpolate(g,{lng:m,ns:r});o.options.request(o.options,y,l,function(b,_){u+=1,h.push(b),p.push(_),u===t.length&&typeof a=="function"&&a(h,p)})})}}},{key:"reload",value:function(){var t=this,r=this.services,i=r.backendConnector,s=r.languageUtils,a=r.logger,o=i.language;if(!(o&&o.toLowerCase()==="cimode")){var l=[],u=function(p){var m=s.toResolveHierarchy(p);m.forEach(function(g){l.indexOf(g)<0&&l.push(g)})};u(o),this.allOptions.preload&&this.allOptions.preload.forEach(function(h){return u(h)}),l.forEach(function(h){t.allOptions.ns.forEach(function(p){i.read(h,p,"read",null,null,function(m,g){m&&a.warn("loading namespace ".concat(p," for language ").concat(h," failed"),m),!m&&g&&a.log("loaded namespace ".concat(p," for language ").concat(h),g),i.loaded("".concat(h,"|").concat(p),m,g)})})})}}}])}();hF.type="backend";ti.use(hF).use(lF).use(jB).init({fallbackLng:"en",debug:!1,backend:{loadPath:"/locales/{{lng}}/translation.json",requestOptions:{cache:"no-cache"},parse:n=>{try{return JSON.parse(n)}catch(e){return console.error("i18n: Failed to parse translation data:",e),{}}}},interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"],lookupLocalStorage:"preferredLanguage"},preload:["en"],saveMissing:!1,keySeparator:".",nsSeparator:":",missingKeyHandler:(n,e,t)=>{console.debug(`i18n: Missing translation key "${t}" for language "${n}"`)}}).catch(n=>{console.error("i18n initialization failed:",n)});function Xhe(){const[n,e]=E.useState(localStorage.getItem("authToken")),[t,r]=E.useState("login");E.useEffect(()=>{const o=localStorage.getItem("authToken");o&&e(o)},[]);const i=o=>{localStorage.setItem("authToken",o),e(o)},s=()=>{localStorage.removeItem("authToken"),e(null),r("login")},a=()=>r("login");return c.jsx(Zde,{children:c.jsx(Kde,{children:n?c.jsx(qde,{token:n,onLogout:s}):t==="login"?c.jsx(SB,{onLoginSuccess:i,onSwitchToRegister:()=>r("register")}):c.jsx(TB,{onSwitchToLogin:()=>r("login"),onRegisterSuccess:a})})})}const Yhe={audioEnabled:!0,videoEnabled:!1,proactiveResponses:!0,privacyMode:"standard"},Khe=E.createContext(void 0),Zhe=({children:n})=>{const[e,t]=E.useState(!1),[r,i]=E.useState("prompt"),[s,a]=E.useState(Yhe),o=E.useRef(null),l=E.useRef(null),u=E.useRef(null),h=E.useRef(null),p=E.useRef(null),m=(x,N)=>{try{const T=new MediaRecorder(N,{mimeType:"audio/webm"});u.current=T,T.addEventListener("dataavailable",S=>{S.data.size>0&&x.emit("audio_stream",S.data)}),T.addEventListener("error",S=>{console.error("[AudioRecorder] Error:",S)}),T.start(250),console.log("[AudioRecorder] Started")}catch(T){console.error("[AudioRecorder] Setup failed:",T)}},g=(x,N)=>{try{const T=document.createElement("video"),S=document.createElement("canvas"),M=S.getContext("2d");if(!M){console.error("[VideoProcessor] Failed to get canvas context");return}T.srcObject=N,T.play(),T.addEventListener("loadedmetadata",()=>{S.width=T.videoWidth,S.height=T.videoHeight;const C=()=>{if(e)try{M.drawImage(T,0,0,S.width,S.height),S.toBlob(R=>{R&&x.emit("video_frame",R)},"image/jpeg",.3)}catch(R){console.error("[VideoProcessor] Frame processing error:",R)}};p.current=setInterval(C,1e3),console.log("[VideoProcessor] Started at 1 FPS")})}catch(T){console.error("[VideoProcessor] Setup failed:",T)}},y=async(x,N={})=>{if(e)return;const T={...s,...N};a(T);try{const S={audio:T.audioEnabled,video:T.videoEnabled?{width:640,height:480,frameRate:5}:!1},M=await navigator.mediaDevices.getUserMedia(S);T.audioEnabled&&(o.current=M),T.videoEnabled&&(l.current=M),i("granted"),t(!0);const C=`${wk}/ambient`,R=Of(C,{...Sk,auth:{token:x},query:{audioEnabled:T.audioEnabled,videoEnabled:T.videoEnabled,privacyMode:T.privacyMode}});h.current=R,R.on("connect",()=>{console.log("[AmbientSocket] Connected with settings:",T),T.audioEnabled&&o.current&&m(R,o.current),T.videoEnabled&&l.current&&g(R,l.current)}),R.on("disconnect",()=>{console.log("[AmbientSocket] Disconnected")})}catch(S){console.error("[AmbientContext] Permission denied or error:",S),i("denied"),t(!1)}},b=()=>{console.log("[AmbientContext] Disabling ambient mode"),p.current&&(clearInterval(p.current),p.current=null),u.current&&(u.current.stop(),u.current=null),h.current&&(h.current.disconnect(),h.current=null),o.current&&(o.current.getTracks().forEach(x=>x.stop()),o.current=null),l.current&&(l.current.getTracks().forEach(x=>x.stop()),l.current=null),t(!1)},_=x=>{a(N=>({...N,...x})),e&&h.current&&(h.current,b(),setTimeout(()=>{console.log("[AmbientContext] Settings updated, restart required")},100))};return c.jsx(Khe.Provider,{value:{isAmbientModeEnabled:e,permissionState:r,settings:s,enableAmbientMode:y,disableAmbientMode:b,updateSettings:_},children:n})},ik=window.fetch.bind(window);function Qhe(n){return typeof n=="string"&&n.startsWith("/api/")}window.__API_BASE_SHIM_INSTALLED__||(window.__API_BASE_SHIM_INSTALLED__=!0,window.fetch=async(n,e)=>{if(Qhe(n)){const t=`${da}${n}`;return ik(t,e)}return ik(n,e)});JO.createRoot(document.getElementById("root")).render(c.jsx(we.StrictMode,{children:c.jsx(hB,{children:c.jsx(Zhe,{children:c.jsx(q5,{children:c.jsx(Xhe,{})})})})}));export{Jhe as c,Kd as g};
