import{r as s,n as e,q as ss,F as ys,u as ne,v as te,w as ve,x as js,y as ce,z as Re,A as he,B as vs,R as Ns,C as ws,H as ks,I as Ss,J as Cs,K as _s,L as As,M as Ts,N as Es,O as Ps,P as Rs,Q as Is,S as oe,U as ts,V as Ms,W as Ne,X as Ie,Y as Ae,Z as fe,_ as Ds,$ as Le,a0 as we,a1 as $s,a2 as ke,a3 as Me,a4 as me,a5 as Te,a6 as ge,a7 as Ls,a8 as Fs,a9 as Os,aa as qs,ab as Bs,ac as as,ad as zs,ae as rs,af as ns,ag as Us,ah as Se,ai as be,aj as ls,ak as Vs,al as Ws,am as Hs,an as Fe,ao as Gs,ap as Ks,aq as Js,ar as Qs,as as Ys,at as Zs}from"./vendor-ByBjRYLv.js";import{_ as Xs,a as et}from"./vendor-3d-C2agF3Ic.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))m(d);new MutationObserver(d=>{for(const h of d)if(h.type==="childList")for(const y of h.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&m(y)}).observe(document,{childList:!0,subtree:!0});function a(d){const h={};return d.integrity&&(h.integrity=d.integrity),d.referrerPolicy&&(h.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?h.credentials="include":d.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function m(d){if(d.ep)return;d.ep=!0;const h=a(d);fetch(d.href,h)}})();const re="http://localhost:8001",is="http://localhost:8001",cs={transports:["websocket","polling"],withCredentials:!0,timeout:2e4,forceNew:!1,reconnection:!0,reconnectionDelay:1500,reconnectionDelayMax:8e3,randomizationFactor:.4,reconnectionAttempts:6},st=[{text:"Hello Cartrita!",icon:"💬",label:"Say hello"},{text:"What time is it?",icon:"⏰",label:"Ask for the time"},{text:"Create an image of a sunset",icon:"🎨",label:"Generate an image"},{text:"What can you help me with?",icon:"❓",label:"Ask what she can do"}],tt=({onLoginSuccess:t,onSwitchToRegister:i})=>{const[a,m]=s.useState(""),[d,h]=s.useState(""),[y,c]=s.useState(""),[p,C]=s.useState(!1),A=async b=>{b.preventDefault(),c(""),C(!0);try{const w=await fetch(`${re}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:d})});let _;try{_=await w.json()}catch{throw new Error("Invalid response from server")}if(w.status===401)throw new Error("Invalid email or password.");if(!w.ok)throw new Error(_?.message||"Login failed.");if(!_?.token)throw new Error("No authentication token received.");t(_.token)}catch(w){c(w.message)}finally{C(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md p-8 space-y-6 bg-slate-800 bg-opacity-80 border-2 border-cyan-500 rounded-2xl shadow-lg shadow-cyan-500/20",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-4xl font-extrabold text-white",children:"Welcome Back"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Log in to access your dashboard"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsx("input",{id:"login-email",name:"email",type:"email",placeholder:"Email",value:a,onChange:b=>m(b.target.value),className:"w-full bg-slate-900 text-white p-3 rounded-lg border border-slate-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"username",required:!0}),e.jsx("input",{id:"login-password",name:"password",type:"password",placeholder:"Password",value:d,onChange:b=>h(b.target.value),className:"w-full bg-slate-900 text-white p-3 rounded-lg border border-slate-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"current-password",required:!0}),y&&e.jsx("p",{className:"text-red-400 text-center font-semibold",children:y}),e.jsx("button",{type:"submit",className:"w-full btn-skittles text-white p-3 rounded-lg font-bold text-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50",disabled:p,children:p?"Logging In...":"Login"})]}),e.jsxs("p",{className:"text-center text-slate-400",children:["Don't have an account?"," ",e.jsx("button",{onClick:i,className:"font-bold text-cyan-400 hover:underline",children:"Register here"})]})]})})},at=({onSwitchToLogin:t,onRegisterSuccess:i})=>{const[a,m]=s.useState(""),[d,h]=s.useState(""),[y,c]=s.useState(""),[p,C]=s.useState(""),[A,b]=s.useState(""),[w,_]=s.useState(!1),N=async g=>{if(g.preventDefault(),b(""),y!==p){b("Passwords do not match");return}if(y.length<6){b("Password must be at least 6 characters long");return}_(!0);try{const o=await fetch(`${re}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,email:d,password:y})}),r=await o.json();if(o.status===409)throw new Error("An account with that email already exists.");if(!o.ok)throw new Error(r.message||"Registration failed.");i()}catch(o){b(o.message)}finally{_(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md p-8 space-y-6 bg-slate-800 bg-opacity-80 border-2 border-cyan-500 rounded-2xl shadow-lg shadow-cyan-500/20",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-4xl font-extrabold text-white",children:"Join the Resistance"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Create your account to get started"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsx("input",{id:"register-name",name:"name",type:"text",placeholder:"Full Name",value:a,onChange:g=>m(g.target.value),className:"w-full bg-slate-900 text-white p-3 rounded-lg border border-slate-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"name",required:!0}),e.jsx("input",{id:"register-email",name:"email",type:"email",placeholder:"Email",value:d,onChange:g=>h(g.target.value),className:"w-full bg-slate-900 text-white p-3 rounded-lg border border-slate-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"email",required:!0}),e.jsx("input",{id:"register-password",name:"password",type:"password",placeholder:"Password",value:y,onChange:g=>c(g.target.value),className:"w-full bg-slate-900 text-white p-3 rounded-lg border border-slate-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"new-password",required:!0,minLength:8}),e.jsx("input",{id:"register-confirm-password",name:"confirmPassword",type:"password",placeholder:"Confirm Password",value:p,onChange:g=>C(g.target.value),className:"w-full bg-slate-900 text-white p-3 rounded-lg border border-slate-700 focus:outline-none focus:ring-2 focus:ring-pink-500 transition",autoComplete:"new-password",required:!0,minLength:8}),A&&e.jsx("p",{className:"text-red-400 text-center font-semibold",children:A}),e.jsx("button",{type:"submit",className:"w-full btn-skittles text-white p-3 rounded-lg font-bold text-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50",disabled:w,children:w?"Creating Account...":"Register"})]}),e.jsxs("p",{className:"text-center text-slate-400",children:["Already have an account?"," ",e.jsx("button",{onClick:t,className:"font-bold text-cyan-400 hover:underline",children:"Login here"})]})]})})},rt=(t,i)=>{const[a,m]=s.useState(!1),[d,h]=s.useState(null),[y,c]=s.useState({connected:!1,reconnectAttempts:0,latency:0,lastPing:null}),[p,C]=s.useState(!1),A=s.useRef(null),b=s.useRef(null),w=s.useRef(i),_=s.useCallback(()=>{b.current&&clearInterval(b.current),b.current=setInterval(()=>{if(A.current?.connected){const r=Date.now();A.current.emit("ping",r)}},5e3)},[]),N=s.useCallback(r=>{const v={id:Date.now()+Math.random(),speaker:r.speaker||"cartrita",text:r.text,created_at:r.timestamp||new Date().toISOString(),model:r.model,tools_used:r.tools_used||[],response_time_ms:r.response_time_ms,intent_analysis:r.intent_analysis,performance_score:r.performance_score,request_id:r.request_id};w.current.onMessage(v),C(!1)},[]);s.useEffect(()=>{w.current=i},[i]),s.useEffect(()=>{if(!t)return;if(t.split(".").length!==3){console.warn("🔒 Skipping socket connect: malformed token");return}const r=ss(is,{...cs,auth:{token:t}});return A.current=r,r.on("connect",()=>{console.log("🔗 Connected to Cartrita server"),console.log("🔍 Socket ID:",r.id),m(!0),h(null),c(v=>({...v,connected:!0,reconnectAttempts:0})),w.current.onConnect(),_()}),r.on("disconnect",v=>{console.log("🔌 Disconnected:",v),m(!1),c(j=>({...j,connected:!1,latency:0})),w.current.onDisconnect(),(v==="transport close"||v==="transport error")&&h("Connection lost, retrying...")}),r.on("connect_error",v=>{console.error("🚨 Connect error:",v),h("Connection failed, please try again later.")}),r.on("pong",v=>{const j=Date.now()-v;c(u=>({...u,latency:j}))}),r.on("agent_response",N),r.on("typing",()=>C(!0)),r.on("stopTyping",()=>C(!1)),r.on("error",v=>{console.error("🚨 Socket error:",v),console.error("🚨 Socket error details:",JSON.stringify(v,null,2));const j=v.message||v.type||v.description||"Unknown socket error";h(`Socket error: ${j}`),C(!1)}),()=>{r.disconnect(),b.current&&clearInterval(b.current)}},[t,N,_]);const g=s.useCallback((r,v="en")=>{A.current?.connected&&A.current.emit("user_message",{text:r,timestamp:new Date().toISOString(),language:v})},[]),o=s.useCallback(()=>{h(null)},[]);return{socket:A.current,isConnected:a,connectionError:d,connectionStats:y,isTyping:p,sendMessage:g,clearConnectionError:o}},nt=(t,i)=>{const a=!t||t.split(".").length!==3,m=s.useCallback(async()=>{if(!t){console.warn("📭 No token available for chat history request");return}if(a){console.warn("📭 Skipping chat history; token malformed");return}try{console.log("🔍 Loading chat history...");const h=await fetch(`${re}/api/chat/history`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("📡 Chat history response status:",h.status),!h.ok){const p=await h.text();console.warn("❌ Chat history fetch blocked (non-ok)",h.status,p);return}const y=await h.json();console.log("📨 Chat history data received:",y);const c=y.conversations||[];i.onHistoryLoaded(c)}catch(h){console.warn("Error loading chat history (suppressed):",h)}},[t,a,i.onHistoryLoaded]),d=s.useCallback(async()=>{if(!t)return;if(!(await fetch(`${re}/api/chat/history`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to clear chat history")},[t]);return{loadHistory:m,clearHistory:d}},lt=(t,i)=>{const[a,m]=s.useState(null),[d,h]=s.useState(null),y=s.useCallback(async()=>{if(t)try{const c=await fetch(`${re}/api/agent/metrics`,{headers:{Authorization:`Bearer ${t}`}});if(c.ok){const p=await c.json();m(p.metrics),h(p.health)}}catch(c){console.error("Error fetching agent metrics:",c)}},[t]);return s.useEffect(()=>{if(!i)return;y();const c=setInterval(y,1e4);return()=>clearInterval(c)},[y,i]),{agentMetrics:a,agentHealth:d,refetch:y}},it=t=>{const i=Math.floor(t/1e3),a=Math.floor(i/60),m=Math.floor(a/60),d=Math.floor(m/24);return d>0?`${d}d ${m%24}h`:m>0?`${m}h ${a%60}m`:a>0?`${a}m`:`${i}s`},ct=({agentMetrics:t,agentHealth:i})=>!t&&!i?null:e.jsxs("div",{className:"mt-3 p-3 bg-gray-900/50 border border-gray-600/50 rounded-lg",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Requests"}),e.jsx("div",{className:"text-sm font-semibold text-blue-400",children:t.requests_processed})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Success Rate"}),e.jsx("div",{className:"text-sm font-semibold text-green-400",children:t.requests_processed>0?`${(t.successful_responses/t.requests_processed*100).toFixed(1)}%`:"100%"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Avg Response"}),e.jsxs("div",{className:"text-sm font-semibold text-yellow-400",children:[Math.round(t.average_response_time),"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Cache Hit Rate"}),e.jsx("div",{className:"text-sm font-semibold text-purple-400",children:t.cache_hits+t.cache_misses>0?`${(t.cache_hits/(t.cache_hits+t.cache_misses)*100).toFixed(1)}%`:"0%"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Intent Accuracy"}),e.jsxs("div",{className:"text-sm font-semibold text-cyan-400",children:[(t.intent_accuracy*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Tool Accuracy"}),e.jsxs("div",{className:"text-sm font-semibold text-orange-400",children:[(t.tool_selection_accuracy*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Uptime"}),e.jsx("div",{className:"text-sm font-semibold text-gray-300",children:it(t.uptime)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Health"}),e.jsx("div",{className:`text-sm font-semibold ${i?.healthy?"text-green-400":"text-red-400"}`,children:i?.healthy?"✅ Healthy":"⚠️ Issues"})]})]})}),i&&!i.healthy&&i.issues?.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-red-300",children:["Issues: ",i.issues?.join(", ")]})]}),ot=({chatStats:t,isConnected:i,connectionStats:a,connectionError:m,agentMetrics:d,agentHealth:h,showMetrics:y,onToggleMetrics:c,onClearChat:p,onClearError:C})=>e.jsxs("div",{className:"p-4 border-b border-slate-600/50 bg-gradient-to-r from-slate-800/80 to-slate-700/80",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gradient",children:"Chat with Cartrita"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsx("p",{className:"text-xs text-slate-400",children:t.totalMessages>0?`${t.totalMessages} messages`:"Start a new conversation"}),t.averageResponseTime>0&&e.jsxs("span",{className:"text-xs text-blue-400",children:["⚡ ",Math.round(t.averageResponseTime),"ms avg"]}),t.toolsUsed>0&&e.jsxs("span",{className:"text-xs text-purple-400",children:["🔧 ",t.toolsUsed," tools used"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full transition-all duration-300 ${i?"bg-green-500 shadow-lg shadow-green-500/50 status-pulse":"bg-red-500 shadow-lg shadow-red-500/50"}`}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm text-slate-300 block",children:i?"Connected":"Disconnected"}),a.latency>0&&e.jsxs("span",{className:"text-xs text-slate-500",children:[a.latency,"ms"]})]})]}),e.jsx("button",{onClick:c,className:`text-slate-400 hover:text-blue-400 transition-colors p-1 rounded ${y?"text-blue-400":""}`,title:"Toggle metrics",children:"📊"}),e.jsx("button",{onClick:p,className:"text-slate-400 hover:text-red-400 transition-colors p-1 rounded",title:"Clear chat history",children:"🗑️"})]})]}),m&&e.jsxs("div",{className:"mt-2 p-2 bg-red-900/50 border border-red-500/50 rounded text-red-200 text-sm flex justify-between items-center",children:[e.jsxs("span",{children:["⚠️ ",m]}),e.jsx("button",{onClick:C,className:"text-red-300 hover:text-red-100 ml-2",title:"Dismiss error",children:"✕"})]}),y&&e.jsx(ct,{agentMetrics:d,agentHealth:h})]}),dt=t=>typeof t!="string"?"":t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>"),xt=t=>({time_query:"⏰",image_generation:"🎨",coding:"💻",research:"🔍",conversation:"💬",general:"🤖"})[t]||"🤖",mt=t=>t>=90?"text-green-400":t>=70?"text-yellow-400":"text-red-400",ht=({message:t,index:i})=>{const a=t.speaker==="user";return e.jsx("div",{className:`flex message-appear ${a?"justify-end":"justify-start"}`,style:{animationDelay:`${i*50}ms`},children:e.jsxs("div",{className:`max-w-[75%] px-4 py-3 rounded-2xl shadow-lg ${a?"bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-br-md":"bg-gradient-to-br from-gray-700 to-gray-800 text-gray-100 rounded-bl-md"}`,children:[e.jsx("div",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:dt(t.text)}}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs opacity-70",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.response_time_ms&&e.jsxs("span",{className:"text-blue-300",children:["⚡",t.response_time_ms,"ms"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[t.intent_analysis&&e.jsx("span",{title:`Intent: ${t.intent_analysis.primary_intent} (${(t.intent_analysis.primary_confidence*100).toFixed(0)}%)`,children:xt(t.intent_analysis.primary_intent)}),t.tools_used&&t.tools_used.length>0&&e.jsxs("span",{title:`Tools: ${t.tools_used.join(", ")}`,className:"text-purple-300",children:["🔧",t.tools_used.length]}),t.performance_score&&e.jsxs("span",{className:mt(t.performance_score),title:`Performance: ${t.performance_score}/100`,children:["📊",t.performance_score]}),t.model&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-black/20 rounded text-[10px]",children:t.model})]})]})]})})},ut=({onSuggestionClick:t})=>e.jsxs("div",{className:"text-center text-gray-400 mt-16",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🤖"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Ready to Chat!"}),e.jsx("p",{className:"text-gray-500",children:"Start a conversation with Cartrita. She's sassy, smart, and ready to help."}),e.jsx("div",{className:"mt-6 grid grid-cols-1 gap-2 max-w-md mx-auto",children:st.map((i,a)=>e.jsxs("button",{onClick:()=>t(i.text),className:"text-left p-2 rounded bg-gray-800/50 hover:bg-gray-700/50 transition-colors text-sm",children:[i.icon," ",i.label]},a))})]}),pt=()=>e.jsx("div",{className:"flex justify-start message-appear",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-700 to-gray-800 px-4 py-3 rounded-2xl rounded-bl-md shadow-lg",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Cartrita is thinking"}),e.jsxs("div",{className:"typing-indicator ml-2",children:[e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"}),e.jsx("div",{className:"typing-dot"})]})]})})}),gt=({messages:t,isLoading:i,isTyping:a,messagesEndRef:m,onSuggestionClick:d})=>e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",children:[t.length===0?e.jsx(ut,{onSuggestionClick:d}):t.map((h,y)=>e.jsx(ht,{message:h,index:y},h.id)),(i||a)&&e.jsx(pt,{}),e.jsx("div",{ref:m})]}),W={gray900:"#0d0d0f",gray800:"#1a1c1f",gray700:"#26292d",gray600:"#32353a",gray500:"#4a4f57",gray400:"#6a7079",gray300:"#8b929c",gray200:"#b1b7c0",gray100:"#d8dce2",white:"#ffffff",black:"#000000",accentPrimary:"#6366f1",accentPrimaryHover:"#4f46e5",accentSecondary:"#ec4899",warning:"#f59e0b",danger:"#ef4444",info:"#0ea5e9",success:"#10b981",accentPurple:"#8b5cf6",accentBlue:"#3b82f6",accentGreen:"#43e97b",accentTeal:"#38f9d7",accentPink:"#fa709a",accentYellow:"#fee140",accentAqua:"#4facfe",accentCyan:"#00f2fe",accentRose:"#f5576c",accentMagenta:"#f093fb",accentPeachLight:"#ffecd2",accentPeach:"#fcb69f",accentMint:"#00ff88"},ie={bg:W.gray900,bgAlt:W.gray800,surface:W.gray700,surfaceAlt:W.gray600,border:W.gray600,borderSubtle:W.gray500,textPrimary:W.gray100,textSecondary:W.gray300,textMuted:W.gray400,textInverted:W.white,focus:W.accentPrimary,link:W.accentPrimary,linkHover:W.accentPrimaryHover,critical:W.danger,warn:W.warning,success:W.success,info:W.info,accent:W.accentSecondary,accentAlt:W.accentPurple,graphTrigger:W.accentBlue,graphAI:W.accentMagenta,graphRAG:W.accentAqua,graphMCP:W.accentGreen,graphHTTP:W.accentPink,graphLogic:W.accentPeachLight,graphData:W.accentPeach},ee={trigger:`linear-gradient(135deg, ${W.accentBlue} 0%, ${W.accentPurple} 100%)`,ai:`linear-gradient(135deg, ${W.accentMagenta} 0%, ${W.accentRose} 100%)`,rag:`linear-gradient(135deg, ${W.accentAqua} 0%, ${W.accentCyan} 100%)`,mcp:`linear-gradient(135deg, ${W.accentGreen} 0%, ${W.accentTeal} 100%)`,http:`linear-gradient(135deg, ${W.accentPink} 0%, ${W.accentYellow} 100%)`,logic:`linear-gradient(135deg, ${W.accentPeachLight} 0%, ${W.accentPurple} 100%)`,data:`linear-gradient(135deg, ${W.accentPeachLight} 0%, ${W.accentPeach} 100%)`,fallback:`linear-gradient(135deg, ${W.accentBlue} 0%, ${W.accentPurple} 100%)`},bt={xs:2,sm:4,md:6,lg:10,full:999},ft={xs:4,sm:8,md:12,lg:20,xl:32},yt={fontFamily:"'Inter', system-ui, sans-serif",sizes:{xs:12,sm:14,md:16,lg:20,xl:24,xxl:32},weights:{regular:400,medium:500,semibold:600,bold:700}},jt={bg:W.gray100,bgAlt:W.gray200,surface:W.white,surfaceAlt:W.gray100,border:W.gray300,borderSubtle:W.gray200,textPrimary:W.gray900,textSecondary:W.gray700,textMuted:W.gray600,textInverted:W.black},vt=(t="dark")=>({mode:t,colors:{...ie,...t==="light"?jt:{}},gradients:ee,radii:bt,spacing:ft,typography:yt}),os=()=>{const t=[],i=window.isSecureContext||window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";return i||t.push("getUserMedia requires HTTPS or localhost"),navigator.mediaDevices||t.push("navigator.mediaDevices not available"),navigator.mediaDevices?.getUserMedia||t.push("getUserMedia not available"),{isSupported:t.length===0,issues:t,isSecureContext:i}},ds=()=>({echoCancellation:!0,noiseSuppression:!1,autoGainControl:!0,sampleRate:{ideal:44100,min:16e3},channelCount:{ideal:1}}),xs=()=>{const t=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"];for(const i of t)if(MediaRecorder.isTypeSupported(i))return i;return""},ms=async()=>{try{const t=await navigator.mediaDevices.enumerateDevices();return console.log("[MediaUtils] Available devices:"),t.forEach((i,a)=>{console.log(`  ${a}: ${i.kind} - ${i.label||"Unnamed device"}`)}),t}catch(t){return console.error("[MediaUtils] Could not enumerate devices:",t),[]}},De=({isRecording:t,audioStream:i,width:a=300,height:m=60,barColor:d=W.accentMint,backgroundColor:h="rgba(0, 0, 0, 0.2)",sensitivity:y=1})=>{const c=s.useRef(null),p=s.useRef(null),C=s.useRef(null),A=s.useRef(null),[b,w]=s.useState(!1);s.useEffect(()=>(t&&i?(_(),w(!0)):(g(),w(!1)),()=>g()),[t,i]);const _=async()=>{if(!(!i||!c.current))try{const o=new(window.AudioContext||window.webkitAudioContext),r=o.createAnalyser(),v=o.createMediaStreamSource(i);r.fftSize=256,r.smoothingTimeConstant=.8,v.connect(r),C.current=o,p.current=r,N()}catch(o){console.error("[AudioVisualizer] Failed to initialize audio analysis:",o)}},N=()=>{if(!p.current||!c.current)return;const o=c.current,r=o.getContext("2d");if(!r)return;const v=p.current,j=v.frequencyBinCount,u=new Uint8Array(j),T=()=>{if(!t){r.fillStyle=h,r.fillRect(0,0,o.width,o.height);return}v.getByteFrequencyData(u),r.fillStyle=h,r.fillRect(0,0,o.width,o.height);const k=32,R=o.width/k,E=o.height-10;for(let $=0;$<k;$++){const F=Math.floor($*j/k),n=Math.max(2,u[F]/255*E*y),x=r.createLinearGradient(0,o.height,0,o.height-n);x.addColorStop(0,d),x.addColorStop(1,d+"60"),r.fillStyle=x,r.fillRect($*R+1,o.height-n,R-2,n)}if(t){const $=.1+.1*Math.sin(Date.now()*.005);r.fillStyle=`${d}${Math.floor($*255).toString(16).padStart(2,"0")}`,r.fillRect(0,0,o.width,o.height)}A.current=requestAnimationFrame(T)};T()},g=()=>{A.current&&(cancelAnimationFrame(A.current),A.current=null),C.current&&(C.current.close(),C.current=null),p.current=null};return e.jsxs("div",{className:"audio-visualizer-container",children:[e.jsx("canvas",{ref:c,width:a,height:m,className:`audio-visualizer ${b?"active":"inactive"}`,style:{border:`1px solid ${b?d:W.gray600}`,borderRadius:"8px",background:h,transition:"border-color 0.3s ease",boxShadow:b?`0 0 20px ${d}40`:"none",opacity:b?1:.6}}),b&&e.jsxs("div",{className:"recording-indicator",style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:"8px",fontSize:"12px",color:d,fontWeight:"bold"},children:[e.jsx("div",{style:{width:"8px",height:"8px",backgroundColor:d,borderRadius:"50%",marginRight:"6px",animation:"pulse 1.5s infinite"}}),"Recording Audio..."]}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.5; transform: scale(1.1); }
        }
      `})]})},$e=({onPermissionChange:t,requiredPermissions:i,showUI:a=!0,autoRequest:m=!1})=>{const[d,h]=s.useState({microphone:"unknown",camera:"unknown"}),[y,c]=s.useState(!1);s.useEffect(()=>{p(),m&&C()},[m]),s.useEffect(()=>{t(d)},[d,t]);const p=async()=>{try{if(!navigator.permissions){console.warn("[MediaPermissions] Permissions API not supported");return}const g=i.includes("microphone")?await navigator.permissions.query({name:"microphone"}):null,o=i.includes("camera")?await navigator.permissions.query({name:"camera"}):null;h(r=>({...r,microphone:g?g.state:"unknown",camera:o?o.state:"unknown"})),g&&(g.onchange=()=>{h(r=>({...r,microphone:g.state}))}),o&&(o.onchange=()=>{h(r=>({...r,camera:o.state}))})}catch(g){console.error("[MediaPermissions] Failed to check permissions:",g)}},C=async()=>{try{const g={};i.includes("microphone")&&(g.audio={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},h(r=>({...r,microphone:"requesting"}))),i.includes("camera")&&(g.video={width:{ideal:1280},height:{ideal:720},facingMode:"user"},h(r=>({...r,camera:"requesting"}))),console.log("[MediaPermissions] Requesting permissions...",g);const o=await navigator.mediaDevices.getUserMedia(g);h(r=>({...r,microphone:g.audio?"granted":r.microphone,camera:g.video?"granted":r.camera,error:void 0})),o.getTracks().forEach(r=>r.stop()),console.log("[MediaPermissions] Permissions granted")}catch(g){console.error("[MediaPermissions] Permission request failed:",g);let o="Permission request failed";const r=d.microphone==="requesting"?"denied":d.microphone,v=d.camera==="requesting"?"denied":d.camera;g.name==="NotAllowedError"?o="Permission was denied. Please allow access and try again.":g.name==="NotFoundError"?o="No microphone or camera found.":g.name==="NotReadableError"?o="Device is already in use by another application.":g.name==="OverconstrainedError"&&(o="Device does not meet the required constraints."),h(j=>({...j,microphone:r,camera:v,error:o}))}},A=()=>{alert(`To enable microphone/camera access:

1. Click the lock icon (🔒) in your browser's address bar
2. Select "Allow" for microphone and camera
3. Refresh the page

Or go to your browser settings:
- Chrome: Settings → Privacy & Security → Site Settings → Camera/Microphone
- Firefox: Settings → Privacy & Security → Permissions
- Safari: Safari → Preferences → Websites → Camera/Microphone`)},b=(g,o)=>{const r="h-5 w-5";return o==="granted"?e.jsx(te,{className:`${r} text-green-500`}):o==="denied"?e.jsx(ve,{className:`${r} text-red-500`}):o==="requesting"?e.jsx("div",{className:`${r} animate-pulse`,children:g==="microphone"?e.jsx(ce,{className:`${r} text-blue-500`}):e.jsx(Re,{className:`${r} text-blue-500`})}):g==="microphone"?e.jsx(ce,{className:`${r} text-gray-400`}):e.jsx(Re,{className:`${r} text-gray-400`})},w=(g,o)=>{const r=g==="microphone"?"Microphone":"Camera";switch(o){case"granted":return`${r} access granted`;case"denied":return`${r} access denied`;case"requesting":return`Requesting ${r.toLowerCase()} access...`;default:return`${r} permission unknown`}},_=i.every(g=>d[g]==="granted"),N=i.some(g=>d[g]==="denied")||!!d.error;return a?e.jsx("div",{className:"media-permission-handler",children:e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"Media Permissions"}),e.jsx("button",{onClick:()=>c(!y),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(ys,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2",children:i.map(g=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[b(g,d[g]),e.jsx("span",{className:"text-sm text-gray-300",children:w(g,d[g])})]}),d[g]==="denied"&&e.jsx("button",{onClick:C,className:"text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-white transition-colors",children:"Retry"})]},g))}),d.error&&e.jsx("div",{className:"bg-red-900/20 border border-red-500/20 rounded p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ne,{className:"h-5 w-5 text-red-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-red-200",children:d.error}),e.jsx("button",{onClick:A,className:"mt-2 text-xs text-red-300 hover:text-red-100 underline",children:"How to fix this"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[_&&e.jsxs("div",{className:"flex items-center space-x-1 text-green-400 text-xs",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{children:"Ready to use"})]}),N&&e.jsxs("div",{className:"flex items-center space-x-1 text-red-400 text-xs",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Permissions needed"})]})]}),e.jsxs("div",{className:"space-x-2",children:[N&&e.jsxs("button",{onClick:A,className:"text-xs text-gray-400 hover:text-white transition-colors",children:[e.jsx(js,{className:"h-4 w-4 inline mr-1"}),"Settings"]}),!_&&e.jsx("button",{onClick:C,disabled:d.microphone==="requesting"||d.camera==="requesting",className:"text-xs bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-3 py-1 rounded text-white transition-colors",children:d.microphone==="requesting"||d.camera==="requesting"?"Requesting...":"Grant Access"})]})]}),y&&e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/20 rounded p-3 text-xs text-blue-200",children:[e.jsx("p",{className:"mb-2",children:e.jsx("strong",{children:"Why do we need these permissions?"})}),e.jsxs("ul",{className:"space-y-1 text-blue-300",children:[i.includes("microphone")&&e.jsx("li",{children:"• Microphone: For voice commands and transcription"}),i.includes("camera")&&e.jsx("li",{children:"• Camera: For visual analysis and context understanding"})]}),e.jsx("p",{className:"mt-2 text-blue-400",children:"Your privacy is protected - media is processed securely and not stored without permission."})]})]})}):null},Nt=({onTranscript:t,disabled:i=!1,token:a})=>{const[m,d]=s.useState(!1),[h,y]=s.useState(!1),[c,p]=s.useState({microphone:"unknown",camera:"unknown"}),[C,A]=s.useState(!1),b=s.useRef(null),w=s.useRef(null),_=s.useRef([]);async function N(u){try{const T=new AudioContext,k=await u.arrayBuffer(),E=(await T.decodeAudioData(k)).getChannelData(0),$=E.reduce((n,x)=>n+Math.abs(x),0)/E.length;let F=0;for(let n=0;n<E.length;n++){const x=Math.abs(E[n]);x>F&&(F=x)}return console.log("[VoiceToText] Audio analysis - Avg volume:",$.toFixed(6),"Max volume:",F.toFixed(6)),$>.001||F>.01}catch(T){return console.error("[VoiceToText] Audio validation error:",T),!0}}const g=async()=>{if(!(i||!a))try{console.log("[VoiceToText] Starting recording");const u=os();if(!u.isSupported)throw console.error("[VoiceToText] Media support issues:",u.issues),new Error(`Media not supported: ${u.issues.join(", ")}`);await ms();const T=ds();console.log("[VoiceToText] Audio constraints:",T);const k=await navigator.mediaDevices.getUserMedia({audio:T});console.log("[VoiceToText] Microphone access granted"),console.log("[VoiceToText] Audio tracks:",k.getAudioTracks().length);const R=k.getAudioTracks();if(R.length===0)throw new Error("No audio tracks available");R.forEach((F,n)=>{console.log(`[VoiceToText] Track ${n}:`,F.label,"enabled:",F.enabled,"readyState:",F.readyState)}),w.current=k,_.current=[],d(!0);const E=xs();console.log("[VoiceToText] Using MIME type:",E||"default");const $=new MediaRecorder(k,E?{mimeType:E}:void 0);b.current=$,$.ondataavailable=F=>{F.data.size>0&&_.current.push(F.data)},$.onstop=async()=>{console.log("[VoiceToText] Recording stopped, processing..."),y(!0);try{const F=new Blob(_.current,{type:"audio/webm"});if(console.log("[VoiceToText] Audio blob created:",F.size,"bytes"),!await N(F)){console.warn("[VoiceToText] Skipping transcription — audio appears silent"),console.warn("[VoiceToText] Try speaking louder or closer to the microphone"),alert("No speech detected in your recording. Please speak louder and closer to the microphone, then try again.");return}const x=new FormData;x.append("audio",F,"recording.webm"),console.log("[VoiceToText] FormData created, sending request...");const S=await fetch(`${re}/api/voice-to-text/transcribe`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:x});if(console.log("[VoiceToText] Response received:",S.status,S.statusText),!S.ok){const q=await S.text();throw console.error("[VoiceToText] Error response:",q),new Error(`Transcription failed: ${S.status} ${S.statusText} - ${q}`)}const I=await S.json();console.log("[VoiceToText] Transcription result:",I),I.transcript?(console.log("[VoiceToText] Transcription successful:",I.transcript),t(I.transcript)):console.warn("[VoiceToText] No transcript received")}catch(F){console.error("[VoiceToText] Transcription error:",F);const n=F instanceof Error?F.message:"Unknown error";alert(`Failed to transcribe speech: ${n}`)}finally{y(!1)}},$.start(1e3)}catch(u){console.error("[VoiceToText] Failed to start recording:",u),d(!1),u instanceof Error?u.name==="NotAllowedError"?alert("Microphone permission was denied. Please allow microphone access in your browser settings and try again."):u.name==="NotFoundError"?alert("No microphone found. Please connect a microphone and try again."):u.name==="NotReadableError"?alert("Microphone is already in use by another application. Please close other applications using the microphone and try again."):alert(`Failed to start voice recording: ${u.message}`):alert("Failed to start voice recording. Please try again.")}},o=()=>{console.log("[VoiceToText] Stopping recording"),b.current&&b.current.state!=="inactive"&&(b.current.stop(),b.current=null),w.current&&(w.current.getTracks().forEach(u=>u.stop()),w.current=null),d(!1)},r=()=>{if(m)o();else{if(c.microphone!=="granted"){A(!0);return}g()}},v=u=>{p(u),u.microphone==="granted"&&C&&A(!1)};s.useEffect(()=>()=>{m&&o()},[]);const j=i||h||!a;return e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:r,disabled:j,className:`
          p-2 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2
          ${m?"bg-red-500 hover:bg-red-600 text-white focus:ring-red-500":h?"bg-blue-500 text-white animate-pulse":"bg-gray-100 hover:bg-gray-200 text-gray-600 focus:ring-blue-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}
          ${j?"opacity-50 cursor-not-allowed":"cursor-pointer"}
        `,title:m?"Stop recording":h?"Processing...":"Start voice input",children:m?e.jsx(he,{className:"h-5 w-5"}):e.jsx(ce,{className:`h-5 w-5 ${h?"animate-pulse":""}`})}),h&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-blue-500 text-white text-xs rounded shadow-lg whitespace-nowrap",children:"Processing..."}),m&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"}),m&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4",children:e.jsx(De,{isRecording:m,audioStream:w.current,width:200,height:40,barColor:W.danger,backgroundColor:"rgba(0, 0, 0, 0.8)",sensitivity:1.2})}),C&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 w-80",children:e.jsx($e,{onPermissionChange:v,requiredPermissions:["microphone"],showUI:!0,autoRequest:!1})})]})},wt=["image/jpeg","image/png","image/gif","image/webp"],kt=["text/javascript","text/python","text/x-python","text/plain"],St=10*1024*1024,Ct=({inputText:t,isConnected:i,isLoading:a,messageHistoryCount:m,inputRef:d,onInputChange:h,onKeyPress:y,onSendMessage:c,onVoiceTranscript:p,token:C})=>{const[A,b]=s.useState([]),[w,_]=s.useState(!1),[N,g]=s.useState(!1),o=s.useRef(null),r=s.useCallback(async k=>{const R=k.target.files;if(!R||R.length===0)return;const E=[];for(let $=0;$<R.length;$++){const F=R[$];if(F.size>St){alert(`File ${F.name} is too large. Maximum size is 10MB.`);continue}let n="document";wt.includes(F.type)?n="image":(kt.includes(F.type)||F.name.endsWith(".py")||F.name.endsWith(".js")||F.name.endsWith(".ts"))&&(n="code");const x={file:F,type:n};if(n==="image")try{const S=await new Promise(I=>{const q=new FileReader;q.onload=()=>I(q.result),q.readAsDataURL(F)});x.preview=S}catch(S){console.error("Error generating image preview:",S)}E.push(x)}b($=>[...$,...E]),o.current&&(o.current.value="")},[]),v=s.useCallback(k=>{b(R=>R.filter((E,$)=>$!==k))},[]),j=s.useCallback(async()=>{if(t.trim()){g(!0);try{const R=await(await fetch("/api/ai/code-execution",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify({code:t,language:"python"})})).json();R.success?p(`

Code execution result:
${R.output||R.result}`):p(`

Code execution failed: ${R.error}`)}catch(k){console.error("Code execution error:",k),p(`

Code execution error: ${k}`)}finally{g(!1)}}},[t,C,p]),u=s.useCallback(async k=>{try{const R=new FormData;R.append("image",k),R.append("task","analyze");const $=await(await fetch("/api/ai/vision-analysis",{method:"POST",headers:{Authorization:`Bearer ${C}`},body:R})).json();$.success&&p(`

Image analysis: ${$.description||$.analysis}`)}catch(R){console.error("Image analysis error:",R)}},[C,p]),T=s.useCallback(k=>{const E={explain:"Please explain in detail: ",summarize:"Please summarize: ",code:"Write code that: ",debug:"Help me debug this code: ",translate:"Translate this to Spanish: ",analyze:"Analyze this data: "}[k]||k;p(E),_(!1)},[p]);return e.jsxs("div",{className:"p-4 border-t border-slate-600/50 bg-slate-800/30",children:[A.length>0&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:A.map((k,R)=>e.jsxs("div",{className:"relative bg-slate-700/60 rounded-lg p-2 flex items-center space-x-2 max-w-xs",children:[k.type==="image"&&k.preview&&e.jsx("img",{src:k.preview,alt:"Preview",className:"w-8 h-8 object-cover rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-white truncate",children:k.file.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:[(k.file.size/1024).toFixed(1),"KB"]})]}),e.jsx("button",{onClick:()=>v(R),className:"text-slate-400 hover:text-red-400 text-xs",children:"×"}),k.type==="image"&&e.jsx("button",{onClick:()=>u(k.file),className:"text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-white",children:"Analyze"})]},R))}),w&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:["explain","summarize","code","debug","translate","analyze"].map(k=>e.jsx("button",{onClick:()=>T(k),className:"px-3 py-1 bg-purple-600/80 hover:bg-purple-600 rounded-lg text-xs text-white transition-colors",children:k.charAt(0).toUpperCase()+k.slice(1)},k))}),e.jsxs("div",{className:"flex items-end space-x-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:d,value:t,onChange:h,onKeyDown:y,placeholder:"Type your message, attach files, or use voice input... (Ctrl+↑/↓ for history)",className:"w-full input-enhanced px-12 py-3 pr-20 rounded-xl resize-none min-h-[48px] max-h-[120px] text-sm leading-relaxed",disabled:!i||a,rows:1}),e.jsxs("div",{className:"absolute left-2 bottom-2 flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>o.current?.click(),disabled:!i||a,className:"p-1.5 text-slate-400 hover:text-white transition-colors disabled:opacity-50",title:"Attach file",children:"📎"}),e.jsx("button",{onClick:()=>_(!w),disabled:!i||a,className:"p-1.5 text-slate-400 hover:text-white transition-colors disabled:opacity-50",title:"Quick actions",children:"⚡"}),t.includes("```")&&e.jsx("button",{onClick:j,disabled:!i||a||N,className:"p-1.5 text-green-400 hover:text-green-300 transition-colors disabled:opacity-50",title:"Execute code",children:N?"⏳":"▶️"})]}),e.jsx("div",{className:"absolute right-2 bottom-2 flex items-center space-x-1",children:e.jsx(Nt,{onTranscript:p,disabled:!i||a,token:C})}),t.length>0&&e.jsxs("div",{className:"absolute bottom-1 right-16 text-xs text-slate-500",children:[t.length,"/2000"]})]}),e.jsx("button",{onClick:c,disabled:!t.trim()||!i||a,className:"btn-skittles px-6 py-3 rounded-xl font-semibold text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center space-x-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Send"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})]})})]}),e.jsx("input",{ref:o,type:"file",onChange:r,multiple:!0,accept:"image/*,.py,.js,.ts,.txt,.md,.json,.csv",className:"hidden"}),m>0&&e.jsxs("div",{className:"mt-2 text-xs text-slate-500 text-center",children:["Use Ctrl+↑/↓ to navigate message history (",m," saved) • 📎 Attach files • ⚡ Quick actions • ▶️ Execute code"]})]})};class _t{history=[];currentIndex=-1;add(i){this.history=[i,...this.history.slice(0,49)],this.currentIndex=-1}getPrevious(){return this.currentIndex<this.history.length-1?(this.currentIndex++,this.history[this.currentIndex]):null}getNext(){return this.currentIndex>0?(this.currentIndex--,this.history[this.currentIndex]):this.currentIndex===0?(this.currentIndex=-1,""):null}getCount(){return this.history.length}clear(){this.history=[],this.currentIndex=-1}}const hs={messages:[],isLoading:!1,isConnected:!1,chatStats:{totalMessages:0,userMessages:0,cartritaMessages:0,conversationStarted:null,averageResponseTime:0,toolsUsed:0,totalPerformanceScore:0}},Oe=t=>{const i=t.filter(c=>c.speaker==="user").length,a=t.filter(c=>c.speaker==="cartrita").length,m=t.reduce((c,p)=>c+(p.tools_used?.length||0),0),d=t.reduce((c,p)=>c+(p.performance_score||0),0),h=t.filter(c=>c.response_time_ms).map(c=>c.response_time_ms),y=h.length>0?h.reduce((c,p)=>c+p,0)/h.length:0;return{totalMessages:t.length,userMessages:i,cartritaMessages:a,conversationStarted:t.length>0?new Date(t[0].created_at):null,averageResponseTime:y,toolsUsed:m,totalPerformanceScore:d}},At=(t,i)=>{switch(i.type){case"ADD_MESSAGE":{const a=[...t.messages,i.payload];return{...t,messages:a,chatStats:Oe(a),isLoading:!1}}case"SET_MESSAGES":return{...t,messages:i.payload,chatStats:Oe(i.payload)};case"CLEAR_MESSAGES":return{...t,messages:[],chatStats:hs.chatStats};case"SET_LOADING":return{...t,isLoading:i.payload};case"SET_CONNECTED":return{...t,isConnected:i.payload};default:return t}},Tt=({token:t})=>{const{i18n:i}=vs(),[a,m]=s.useReducer(At,hs),[d,h]=s.useState(""),[y,c]=s.useState(!1),p=s.useRef(null),C=s.useRef(null),A=s.useMemo(()=>({onMessage:I=>m({type:"ADD_MESSAGE",payload:I}),onConnect:()=>m({type:"SET_CONNECTED",payload:!0}),onDisconnect:()=>m({type:"SET_CONNECTED",payload:!1})}),[]),b=s.useMemo(()=>({onHistoryLoaded:I=>m({type:"SET_MESSAGES",payload:I})}),[]),{isConnected:w,connectionError:_,connectionStats:N,isTyping:g,sendMessage:o,clearConnectionError:r}=rt(t,A),{loadHistory:v,clearHistory:j}=nt(t,b),{agentMetrics:u,agentHealth:T}=lt(t,w),k=new _t,R=s.useCallback(()=>{p.current?.scrollIntoView({behavior:"smooth",block:"end"})},[]);s.useEffect(()=>{const I=setTimeout(R,100);return()=>clearTimeout(I)},[a.messages,R]),s.useEffect(()=>{t&&v()},[t,v]);const E=s.useCallback(()=>{const I=d.trim();if(!I||!w||a.isLoading)return;k.add(I);const q={id:Date.now(),speaker:"user",text:I,created_at:new Date().toISOString()};m({type:"ADD_MESSAGE",payload:q}),m({type:"SET_LOADING",payload:!0}),h(""),o(I,i.language||"en"),C.current?.focus()},[d,w,a.isLoading,o,i.language]),$=s.useCallback(I=>{if(I.key==="Enter"&&!I.shiftKey)I.preventDefault(),E();else if(I.key==="ArrowUp"&&I.ctrlKey){I.preventDefault();const q=k.getPrevious();q&&h(q)}else if(I.key==="ArrowDown"&&I.ctrlKey){I.preventDefault();const q=k.getNext();h(q||"")}},[E]),F=s.useCallback(I=>{h(I.target.value)},[]),n=s.useCallback(I=>{h(q=>`${q} ${I}`.trim())},[]),x=s.useCallback(async()=>{if(window.confirm("Are you sure you want to clear all chat history?"))try{await j(),m({type:"CLEAR_MESSAGES"})}catch(I){console.error("Error clearing chat:",I)}},[j]),S=s.useCallback(I=>{h(I),C.current?.focus()},[]);return e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 dark:bg-black/20 border border-white/20 rounded-xl h-[700px] flex flex-col overflow-hidden",children:[e.jsx(ot,{chatStats:a.chatStats,isConnected:w,connectionStats:N,connectionError:_,agentMetrics:u,agentHealth:T,showMetrics:y,onToggleMetrics:()=>c(!y),onClearChat:x,onClearError:r}),e.jsx(gt,{messages:a.messages,isLoading:a.isLoading,isTyping:g,messagesEndRef:p,onSuggestionClick:S}),e.jsx(Ct,{inputText:d,isConnected:w,isLoading:a.isLoading,messageHistoryCount:k.getCount(),inputRef:C,onInputChange:F,onKeyPress:$,onSendMessage:E,onVoiceTranscript:n,token:t})]})},us=s.createContext(void 0),Et=({children:t})=>{const[i,a]=s.useState([]),m=s.useCallback(y=>a(c=>c.filter(p=>p.id!==y)),[]),d=s.useCallback(y=>{const c=Math.random().toString(36).slice(2,11),p={id:c,duration:5e3,...y};return a(C=>[...C,p]),p.duration&&p.duration>0&&setTimeout(()=>m(c),p.duration),c},[m]),h=s.useCallback(()=>a([]),[]);return e.jsxs(us.Provider,{value:{notifications:i,addNotification:d,removeNotification:m,clearAll:h},children:[t,e.jsx(Pt,{})]})},Pt=()=>{const{notifications:t,removeNotification:i}=ps();return t.length?e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:t.map(a=>e.jsx(Rt,{notification:a,onRemove:()=>i(a.id)},a.id))}):null},Rt=({notification:t,onRemove:i})=>{const a=t.type==="success"?"bg-green-900/90 border-green-700 text-green-100":t.type==="error"?"bg-red-900/90 border-red-700 text-red-100":t.type==="warning"?"bg-yellow-900/90 border-yellow-700 text-yellow-100":"bg-blue-900/90 border-blue-700 text-blue-100",m=t.type==="success"?"✅":t.type==="error"?"❌":t.type==="warning"?"⚠️":"ℹ️";return e.jsx("div",{className:`p-4 rounded-lg border backdrop-blur-sm animate-in slide-in-from-right-full ${a}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("span",{className:"text-lg",children:m}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:t.title}),t.message&&e.jsx("p",{className:"text-sm opacity-90 mt-1",children:t.message}),t.actions?.length?e.jsx("div",{className:"flex space-x-2 mt-3",children:t.actions.map((d,h)=>e.jsx("button",{onClick:d.onClick,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${d.variant==="primary"?"bg-white/20 hover:bg-white/30":"bg-transparent hover:bg-white/10 border border-current"}`,children:d.label},h))}):null]})]}),e.jsx("button",{onClick:i,className:"text-current/70 hover:text-current transition-colors p-1",children:"✕"})]})})},ps=()=>{const t=s.useContext(us);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t},Ce=()=>{const{addNotification:t}=ps();return{success:(i,a)=>t({type:"success",title:i,message:a}),error:(i,a)=>t({type:"error",title:i,message:a}),warning:(i,a)=>t({type:"warning",title:i,message:a}),info:(i,a)=>t({type:"info",title:i,message:a})}};function It(t,i=null){const a=i||document.documentElement,{colors:m,gradients:d}=t,h=a.style;Object.entries(m).forEach(([y,c])=>{h.setProperty(`--ct-color-${qe(y)}`,String(c))}),Object.entries(d).forEach(([y,c])=>{h.setProperty(`--ct-gradient-${qe(y)}`,String(c))})}function qe(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}const gs=s.createContext(void 0),bs="cartrita:userTheme";function Mt({children:t}){const[i,a]=s.useState(()=>Be()?.mode||"dark"),[m,d]=s.useState(()=>Be()||{}),h=s.useMemo(()=>{const C=vt(i);return{...C,colors:{...C.colors,...Object.fromEntries(Object.entries(m).filter(([b])=>b!=="mode"))}}},[i,m]);s.useEffect(()=>{It(h)},[h]);const p={theme:h,mode:i,overrides:m,setMode:a,updateOverrides:C=>{d(A=>{const b={...A,...C};return ze({...b,mode:i}),b}),C.mode&&(C.mode==="dark"||C.mode==="light")&&a(C.mode)},resetOverrides:()=>{d({}),ze({mode:i})}};return e.jsx(gs.Provider,{value:p,children:t})}function Dt(){const t=s.useContext(gs);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t}function Be(){try{const t=localStorage.getItem(bs);return t?JSON.parse(t):null}catch{return null}}function ze(t){try{localStorage.setItem(bs,JSON.stringify(t))}catch{}}const je={sarcasm_level:5,verbosity:"normal",humor_style:"playful",language_preference:"en",timezone:"America/Los_Angeles",theme:"dark",notifications_enabled:!0,voice_enabled:!1,ambient_listening:!1},Ee={voice_responses:!1,ambient_listening:!1,sound_effects:!0,camera_enabled:!1},$t=({token:t,onBack:i})=>{const a=Ce(),{setMode:m,resetOverrides:d,theme:h}=Dt(),[y,c]=s.useState(!0),[p,C]=s.useState(null),[A,b]=s.useState("profile"),[w,_]=s.useState(""),[N,g]=s.useState(""),[o,r]=s.useState({name:"",email:""}),[v,j]=s.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[u,T]=s.useState(je),[k,R]=s.useState(Ee),[E,$]=s.useState(!1),[F,n]=s.useState(!1),[x,S]=s.useState(!1),[I,q]=s.useState(!1),f=s.useMemo(()=>async(L,z={},K=1e4)=>{const Y=new AbortController,Q=setTimeout(()=>Y.abort(),K);try{return await fetch(L,{...z,signal:Y.signal})}finally{clearTimeout(Q)}},[]),l=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";s.useEffect(()=>{if(!y){const L=u.theme;L==="auto"?m(l()):(L==="dark"||L==="light")&&m(L)}},[y]),s.useEffect(()=>{if(u.theme!=="auto")return;const L=window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null,z=()=>m(l());return L?.addEventListener?.("change",z),()=>{L?.removeEventListener?.("change",z)}},[u.theme]),s.useEffect(()=>{let L=!1;return t&&(async()=>{c(!0);try{const[K,Y]=await Promise.all([f("/api/user/me",{headers:{Authorization:`Bearer ${t}`}}),f("/api/user/preferences",{headers:{Authorization:`Bearer ${t}`}})]);if(K.ok){const Q=await K.json();L||(C(Q),r({name:Q.name||"",email:Q.email||""}))}else if(!L){const Q={id:1,name:"User",email:"user@example.com",created_at:new Date().toISOString()};C(Q),r({name:Q.name,email:Q.email}),a.warning("User unavailable","Using placeholder profile while backend is unreachable.")}if(Y.ok){const Q=await Y.json();L||(T({...je,...Q}),R(se=>({...se,voice_responses:typeof Q.voice_responses=="boolean"?Q.voice_responses:se.voice_responses,ambient_listening:typeof Q.ambient_listening=="boolean"?Q.ambient_listening:se.ambient_listening,sound_effects:typeof Q.sound_effects=="boolean"?Q.sound_effects:se.sound_effects,camera_enabled:typeof Q.camera_enabled=="boolean"?Q.camera_enabled:se.camera_enabled})))}else L||(T(je),R(Ee))}catch(K){L||(T(je),R(Ee),a.warning("Settings load failed",`${K?.message||"Unknown error"}. Using defaults.`))}finally{L||c(!1)}})(),()=>{L=!0}},[t,a]);const M=(L,z)=>r(K=>({...K,[L]:z})),O=async L=>{L.preventDefault(),$(!0),_(""),g("");try{const z=await f("/api/user/me",{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(o)}),K=await z.json().catch(()=>({}));if(!z.ok)throw new Error(K.message||"Failed to update profile");C(Y=>Y&&{...Y,...o}),a.success("Profile updated","Your profile has been saved.")}catch(z){a.error("Profile update failed",z?.message||"Unknown error"),g(z?.message||"Failed to update profile")}finally{$(!1)}},D=(L,z)=>j(K=>({...K,[L]:z})),B=async L=>{if(L.preventDefault(),n(!0),_(""),g(""),v.newPassword!==v.confirmPassword){a.error("Password mismatch","New passwords do not match"),n(!1);return}if(v.newPassword.length<6){a.error("Password too short","Must be at least 6 characters"),n(!1);return}try{const z=await f("/api/user/me/password",{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:v.currentPassword,newPassword:v.newPassword})}),K=await z.json().catch(()=>({}));if(!z.ok)throw new Error(K.message||"Failed to update password");a.success("Password updated","Your password has been changed"),j({currentPassword:"",newPassword:"",confirmPassword:""})}catch(z){a.error("Password update failed",z?.message||"Unknown error"),g(z?.message||"Failed to update password")}finally{n(!1)}},H=(L,z)=>T(K=>({...K,[L]:z})),J=L=>{H("theme",L),m(L==="auto"?l():L)},U=async L=>{L.preventDefault(),S(!0),_(""),g("");try{const z=await f("/api/user/preferences",{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(u)}),K=await z.json().catch(()=>({}));if(!z.ok)throw new Error(K.message||"Failed to update personality settings");a.success("Personality updated","Settings have been saved")}catch(z){a.error("Personality update failed",z?.message||"Unknown error"),g(z?.message||"Failed to update personality")}finally{S(!1)}},G=(L,z)=>R(K=>({...K,[L]:z})),X=async L=>{L.preventDefault(),q(!0),_(""),g("");try{const z=await f("/api/user/preferences",{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(k)}),K=await z.json().catch(()=>({}));if(!z.ok)throw new Error(K.message||"Failed to update audio settings");a.success("Audio settings updated","Audio preferences saved")}catch(z){a.error("Audio update failed",z?.message||"Unknown error"),g(z?.message||"Failed to update audio settings")}finally{q(!1)}},Z=async()=>{if(confirm("Clear all chat history? This cannot be undone."))try{const L=await f("/api/settings/clear-chat-history",{method:"POST",headers:{Authorization:`Bearer ${t}`}}),z=await L.json();if(!L.ok)throw new Error(z.error||"Failed to clear chat history");a.success("Chat history cleared",`${z.deletedCount} messages deleted`)}catch(L){a.error("Clear history failed",L?.message||"Unknown error")}},P=async()=>{try{const L=await f("/api/settings/export-data",{headers:{Authorization:`Bearer ${t}`}});if(!L.ok){const Q=await L.json().catch(()=>({}));throw new Error(Q.error||"Failed to export data")}const z=await L.blob(),K=URL.createObjectURL(z),Y=document.createElement("a");Y.href=K,Y.download=`cartrita-data-${Date.now()}.json`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(K),a.success("Data exported","Download completed")}catch(L){a.error("Export failed",L?.message||"Unknown error")}},V=async()=>{const L=prompt("Enter your password to confirm account deletion:");if(L&&confirm("This will permanently delete all your data. Continue?"))try{const z=await f("/api/settings/delete-account",{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({confirmPassword:L})}),K=await z.json();if(!z.ok)throw new Error(K.error||"Failed to delete account");alert("Account deleted. Redirecting to home page."),window.location.href="/"}catch(z){a.error("Delete account failed",z?.message||"Unknown error")}};return y?e.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center",children:e.jsx("div",{className:"glass-card p-8 rounded-xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{className:"text-white text-lg",children:"Loading your settings..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-slate-600/50 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gradient",children:"Settings"}),e.jsx("p",{className:"text-slate-400",children:"Manage your account and preferences"})]})]}),p&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Signed in as"}),e.jsx("p",{className:"font-semibold",children:p.name})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[w&&e.jsxs("div",{className:"mb-6 p-4 bg-green-900/50 border border-green-500/50 rounded-lg text-green-200",children:["✅ ",w]}),N&&e.jsxs("div",{className:"mb-6 p-4 bg-red-900/50 border border-red-500/50 rounded-lg text-red-200",children:["⚠️ ",N]}),e.jsx("div",{className:"mb-8",children:e.jsx("nav",{className:"flex space-x-1 glass-card p-1 rounded-xl w-fit",children:[{key:"profile",label:"Profile",icon:"👤"},{key:"password",label:"Password",icon:"🔒"},{key:"personality",label:"Personality",icon:"🤖"},{key:"preferences",label:"Preferences",icon:"⚙️"},{key:"health",label:"System Health",icon:"🏥"}].map(L=>e.jsxs("button",{onClick:()=>b(L.key),className:`px-4 py-2 rounded-lg transition-all duration-200 flex items-center space-x-2 ${A===L.key?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"text-slate-400 hover:text-white hover:bg-slate-800/50"}`,children:[e.jsx("span",{children:L.icon}),e.jsx("span",{children:L.label})]},L.key))})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[A==="profile"&&e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"👤"}),e.jsx("span",{children:"Profile Information"})]}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:o.name,onChange:L=>M("name",L.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your full name",autoComplete:"name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:o.email,onChange:L=>M("email",L.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your email address",autoComplete:"email",required:!0})]}),e.jsx("button",{type:"submit",disabled:E,className:"btn-skittles px-6 py-3 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"💾"}),e.jsx("span",{children:"Update Profile"})]})})]})]}),A==="password"&&e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"🔒"}),e.jsx("span",{children:"Change Password"})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Current Password"}),e.jsx("input",{type:"password",value:v.currentPassword,onChange:L=>D("currentPassword",L.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your current password",autoComplete:"current-password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"New Password"}),e.jsx("input",{type:"password",value:v.newPassword,onChange:L=>D("newPassword",L.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Enter your new password",autoComplete:"new-password",required:!0,minLength:6}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Must be at least 6 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:v.confirmPassword,onChange:L=>D("confirmPassword",L.target.value),className:"w-full input-enhanced px-4 py-3 rounded-lg",placeholder:"Confirm your new password",autoComplete:"new-password",required:!0,minLength:6})]}),e.jsx("button",{type:"submit",disabled:F,className:"btn-skittles px-6 py-3 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"🔑"}),e.jsx("span",{children:"Update Password"})]})})]})]}),A==="personality"&&e.jsxs("form",{onSubmit:U,className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"🤖"}),e.jsx("span",{children:"Cartrita's Personality"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Sarcasm Level: ",e.jsxs("span",{className:"font-bold text-white",children:[u.sarcasm_level,"/10"]})]}),e.jsx("input",{type:"range",min:1,max:10,value:u.sarcasm_level,onChange:L=>H("sarcasm_level",parseInt(L.target.value,10)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mt-1",children:[e.jsx("span",{children:"Sincere"}),e.jsx("span",{children:"Balanced"}),e.jsx("span",{children:"Unfiltered"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Response Length"}),e.jsxs("select",{value:u.verbosity,onChange:L=>H("verbosity",L.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"minimal",children:"Minimal - Short and to the point"}),e.jsx("option",{value:"normal",children:"Normal - Balanced responses"}),e.jsx("option",{value:"verbose",children:"Verbose - Detailed explanations"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Humor Style"}),e.jsxs("select",{value:u.humor_style,onChange:L=>H("humor_style",L.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"playful",children:"🎭 Playful - Light and fun"}),e.jsx("option",{value:"sarcastic",children:"😏 Sarcastic - Witty and sharp"}),e.jsx("option",{value:"witty",children:"🧠 Witty - Clever wordplay"}),e.jsx("option",{value:"dry",children:"🏜️ Dry - Deadpan delivery"}),e.jsx("option",{value:"absurd",children:"🤡 Absurd - Random and silly"}),e.jsx("option",{value:"intellectual",children:"🎓 Intellectual - Smart references"}),e.jsx("option",{value:"wholesome",children:"😊 Wholesome - Positive and uplifting"}),e.jsx("option",{value:"edgy",children:"⚡ Edgy - Bold and provocative"}),e.jsx("option",{value:"dad-jokes",children:"👨 Dad Jokes - Puns and groaners"}),e.jsx("option",{value:"observational",children:"🔍 Observational - Commentary on life"}),e.jsx("option",{value:"none",children:"🚫 None - Serious mode only"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Choose how Cartrita expresses humor"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Language Preference"}),e.jsxs("select",{value:u.language_preference,onChange:L=>H("language_preference",L.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"es",children:"Spanish"}),e.jsx("option",{value:"fr",children:"French"}),e.jsx("option",{value:"de",children:"German"}),e.jsx("option",{value:"it",children:"Italian"}),e.jsx("option",{value:"pt",children:"Portuguese"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Timezone"}),e.jsxs("select",{value:u.timezone,onChange:L=>H("timezone",L.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"America/New_York",children:"Eastern Time"}),e.jsx("option",{value:"America/Chicago",children:"Central Time"}),e.jsx("option",{value:"America/Denver",children:"Mountain Time"}),e.jsx("option",{value:"America/Los_Angeles",children:"Pacific Time"}),e.jsx("option",{value:"Europe/London",children:"London"}),e.jsx("option",{value:"Europe/Paris",children:"Paris"}),e.jsx("option",{value:"Asia/Tokyo",children:"Tokyo"}),e.jsx("option",{value:"Australia/Sydney",children:"Sydney"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-300",children:"Features"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 border border-slate-600 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"🔔 Notifications"}),e.jsx("input",{type:"checkbox",checked:u.notifications_enabled,onChange:L=>T(z=>({...z,notifications_enabled:L.target.checked})),className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-slate-600 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"🎤 Voice Responses"}),e.jsx("input",{type:"checkbox",checked:u.voice_enabled,onChange:L=>T(z=>({...z,voice_enabled:L.target.checked})),className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-slate-600 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"👂 Ambient Listening"}),e.jsx("input",{type:"checkbox",checked:u.ambient_listening,onChange:L=>T(z=>({...z,ambient_listening:L.target.checked})),className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-slate-600 rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"🌙 Dark Theme"}),e.jsx("input",{type:"checkbox",checked:u.theme==="dark",onChange:L=>J(L.target.checked?"dark":"light"),className:"toggle"})]})]})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-semibold transition-all duration-300 flex items-center justify-center space-x-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Saving Personality..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"💾"}),e.jsx("span",{children:"Save Personality Settings"})]})})]})]}),A==="preferences"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"⚙️"}),e.jsx("span",{children:"General Preferences"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 border border-slate-600/50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"🎨 Theme Settings"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Customize your visual experience"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:"theme",value:"dark",checked:u.theme==="dark",onChange:()=>J("dark"),className:"text-blue-600"}),e.jsx("span",{children:"Dark Mode"})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:"theme",value:"light",checked:u.theme==="light",onChange:()=>J("light"),className:"text-blue-600"}),e.jsx("span",{children:"Light Mode"})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",name:"theme",value:"auto",checked:u.theme==="auto",onChange:()=>J("auto"),className:"text-blue-600"}),e.jsx("span",{children:"Auto (System)"})]}),e.jsxs("div",{className:"pt-2 flex items-center justify-between",children:[e.jsx(Lt,{hexBg:h.colors.bg,hexText:h.colors.textPrimary}),e.jsx("button",{type:"button",onClick:()=>{d(),a.success("Theme reset","Custom theme overrides cleared")},className:"text-xs px-2 py-1 rounded bg-slate-700 hover:bg-slate-600",children:"Reset Theme Overrides"})]})]})]}),e.jsxs("form",{onSubmit:X,className:"p-4 border border-slate-600/50 rounded-lg",children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"🔊 Audio Settings"}),e.jsx("button",{type:"submit",disabled:I,className:"text-sm bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-3 py-1 rounded transition-colors",children:I?"Saving...":"Save"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Configure audio and voice features"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Voice Responses"}),e.jsx("input",{type:"checkbox",checked:k.voice_responses,onChange:L=>G("voice_responses",L.target.checked),className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Ambient Listening"}),e.jsx("input",{type:"checkbox",checked:k.ambient_listening,onChange:L=>G("ambient_listening",L.target.checked),className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Camera Access"}),e.jsx("input",{type:"checkbox",checked:k.camera_enabled,onChange:L=>G("camera_enabled",L.target.checked),className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Sound Effects"}),e.jsx("input",{type:"checkbox",checked:k.sound_effects,onChange:L=>G("sound_effects",L.target.checked),className:"toggle"})]})]})]})]})]})}),A==="health"&&e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"🏥"}),e.jsx("span",{children:"System Health"})]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🩺"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"System Health Monitor"}),e.jsx("p",{className:"text-slate-400",children:"Comprehensive system health monitoring will be displayed here"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[p&&e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"📊"}),e.jsx("span",{children:"Account Info"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"User ID:"}),e.jsxs("span",{className:"font-mono",children:["#",p.id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Member since:"}),e.jsx("span",{children:new Date(p.created_at||Date.now()).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Status:"}),e.jsx("span",{className:"text-green-400",children:"Active"})]})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"⚡"}),e.jsx("span",{children:"Quick Actions"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:Z,className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors text-sm flex items-center space-x-2",children:[e.jsx("span",{children:"🗑️"}),e.jsx("span",{children:"Clear Chat History"})]}),e.jsxs("button",{onClick:P,className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors text-sm flex items-center space-x-2",children:[e.jsx("span",{children:"📥"}),e.jsx("span",{children:"Export Data"})]}),e.jsxs("button",{onClick:V,className:"w-full text-left p-3 rounded-lg hover:bg-red-900/20 hover:text-red-400 transition-colors text-sm flex items-center space-x-2",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:"Delete Account"})]})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"❓"}),e.jsx("span",{children:"Help & Support"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("a",{href:"#",className:"block text-blue-400 hover:text-blue-300 transition-colors",children:"📚 Documentation"}),e.jsx("a",{href:"#",className:"block text-blue-400 hover:text-blue-300 transition-colors",children:"💬 Contact Support"}),e.jsx("a",{href:"#",className:"block text-blue-400 hover:text-blue-300 transition-colors",children:"🐛 Report Bug"})]})]})]})]})]})]})};function Lt({hexBg:t,hexText:i}){const a=Ft(t,i),m=a>=4.5;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Contrast"}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${m?"bg-green-600/40 text-green-200":"bg-amber-600/40 text-amber-100"}`,children:[a.toFixed(2),":1 ",m?"AA ✓":"AA ✗"]}),e.jsx("span",{className:"inline-flex border border-slate-600 rounded overflow-hidden",children:e.jsx("span",{style:{background:t,color:i},className:"text-xs px-2 py-0.5",children:"Aa"})})]})}function Ue(t){const[i,a,m]=Ot(t),d=[i,a,m].map(h=>(h/=255,h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4)));return .2126*d[0]+.7152*d[1]+.0722*d[2]}function Ft(t,i){const a=Ue(t),m=Ue(i),d=Math.max(a,m),h=Math.min(a,m);return(d+.05)/(h+.05)}function Ot(t){const i=t.replace("#",""),a=parseInt(i.length===3?i.split("").map(y=>y+y).join(""):i,16),m=a>>16&255,d=a>>8&255,h=a&255;return[m,d,h]}const qt=({workflow:t,onSave:i,token:a,nodeTypes:m})=>{const d=s.useRef(null),[h,y,c]=ws(t?.workflow_data.nodes||[]),[p,C,A]=ks(t?.workflow_data.edges||[]),[b,w]=s.useState(!1),[_,N]=s.useState(!1),[g,o]=s.useState([]),[r,v]=s.useState(!1),[j,u]=s.useState(null),{project:T}=Ss();s.useEffect(()=>()=>{j&&clearTimeout(j)},[j]);const k=s.useCallback(f=>C(l=>Cs(f,l)),[C]),R=s.useCallback(f=>{f.preventDefault(),f.dataTransfer.dropEffect="move"},[]),E=s.useCallback(f=>{f.preventDefault();const l=d.current?.getBoundingClientRect(),M=f.dataTransfer.getData("application/reactflow");if(M&&l){const O=JSON.parse(M),D=T({x:f.clientX-l.left,y:f.clientY-l.top}),B={id:`${O.type}_${Date.now()}`,type:"default",position:D,data:{label:O.name,nodeType:O.type,icon:O.icon,description:O.description,config:F(O.type)},style:{background:$(O.type),border:`2px solid ${ie.border}`,borderRadius:"12px",fontSize:"12px",fontWeight:"bold",color:ie.textInverted,width:180,height:80,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"}};y(H=>H.concat(B))}},[T,y]),$=f=>f.startsWith("trigger")?ee.trigger:f.startsWith("ai-")?ee.ai:f.startsWith("rag-")?ee.rag:f.startsWith("mcp-")?ee.mcp:f.startsWith("http-")||f.includes("integration")?ee.http:f.startsWith("logic-")?ee.logic:f.startsWith("data-")?ee.data:ee.fallback,F=f=>({"ai-gpt4":{model:"gpt-4",prompt:"You are a helpful assistant. Please respond to: {{input}}",temperature:.7},"ai-claude":{model:"claude-3-sonnet",prompt:"You are a helpful assistant. Please respond to: {{input}}",temperature:.7},"http-request":{method:"GET",url:"https://api.example.com",headers:{}},"rag-search":{query:"{{input}}",top_k:5},"logic-condition":{condition:"data.value > 0",true_value:"positive",false_value:"negative"}})[f]||{},n=async()=>{const f={name:t?.name||"New Workflow",description:t?.description||"",workflow_data:{nodes:h,edges:p},category:t?.category||"custom",tags:t?.tags||[]};i(f)},x=async()=>{if(t?.id){N(!0),o([]),v(!0);try{const l=await(await fetch(`/api/workflows/${t.id}/execute`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({input_data:{message:"Test execution"}})})).json();l.success?S(l.execution.id):(o([{level:"error",message:l.error||"Failed to start workflow execution",timestamp:new Date().toISOString()}]),N(!1))}catch(f){console.error("Execution failed:",f),o([{level:"error",message:`Execution failed: ${f instanceof Error?f.message:"Unknown error"}`,timestamp:new Date().toISOString()}]),N(!1)}}},S=async f=>{try{const M=await(await fetch(`/api/workflows/executions/${f}`,{headers:{Authorization:`Bearer ${a}`}})).json();if(M.success){const O=M.execution;if(O.status==="running"){const D=setTimeout(()=>S(f),1e3);u(D)}else N(!1),o(O.execution_logs||[]),j&&(clearTimeout(j),u(null))}else o([{level:"error",message:M.error||"Failed to get execution status",timestamp:new Date().toISOString()}]),N(!1)}catch(l){console.error("Polling failed:",l),o(M=>[...M,{level:"error",message:`Polling failed: ${l instanceof Error?l.message:"Unknown error"}`,timestamp:new Date().toISOString()}]),N(!1),j&&(clearTimeout(j),u(null))}},[I,q]=s.useState(!1);return s.useEffect(()=>{const f=()=>q(window.innerWidth<640);return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),I?e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white flex flex-col",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-slate-700",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"text-slate-400 hover:text-white",children:"← Back"}),e.jsx("span",{className:"text-sm text-slate-500",children:"Mobile View"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Workflow Builder Unavailable on Small Screens"}),e.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:"Editing complex graphs is disabled below the small (640px) breakpoint for usability. View execution history & metadata from the Workflows list instead. Rotate your device or use a larger screen to edit."}),e.jsx("button",{onClick:()=>v(!r),className:"px-4 py-2 bg-slate-700 rounded-lg text-sm",children:r?"Hide Logs":"Show Logs"}),r&&e.jsxs("div",{className:"border border-slate-700 rounded-lg p-4 max-h-64 overflow-y-auto text-xs space-y-2",children:[g.length===0&&e.jsx("div",{className:"text-slate-500",children:"No logs yet."}),g.map((f,l)=>e.jsxs("div",{className:"bg-slate-800/60 px-2 py-1 rounded",children:[f.timestamp," – ",f.message]},l))]})]})]}):e.jsxs("div",{className:"h-screen bg-slate-900 flex",children:[e.jsxs("div",{className:`bg-slate-800 border-r border-slate-700 transition-all duration-300 ${b?"w-80":"w-16"}`,children:[e.jsx("div",{className:"p-4",children:e.jsxs("button",{onClick:()=>w(!b),className:"w-full flex items-center justify-center p-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:[e.jsx("span",{className:"text-xl",children:"🧩"}),b&&e.jsx("span",{className:"ml-2 font-semibold",children:"Node Palette"})]})}),b&&e.jsx("div",{className:"px-4 pb-4 overflow-y-auto h-full",children:Object.entries(m).map(([f,l])=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3",children:f}),e.jsx("div",{className:"space-y-2",children:l.map(M=>e.jsx("div",{draggable:!0,onDragStart:O=>{O.dataTransfer.setData("application/reactflow",JSON.stringify(M)),O.dataTransfer.effectAllowed="move"},className:"p-3 bg-slate-700 hover:bg-slate-600 rounded-lg cursor-grab active:cursor-grabbing transition-colors border border-slate-600 hover:border-blue-400",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:M.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:M.name}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:M.description})]})]})},M.type))})]},f))})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{ref:d,className:"w-full h-full",children:e.jsxs(_s,{nodes:h,edges:p,onNodesChange:c,onEdgesChange:A,onConnect:k,onDrop:E,onDragOver:R,connectionMode:As.Loose,fitView:!0,style:{background:ie.bg},children:[e.jsx(Ts,{color:W.gray500,gap:20,size:1,style:{backgroundColor:ie.bg}}),e.jsx(Es,{}),e.jsx(Ps,{style:{backgroundColor:ie.bgAlt,border:`1px solid ${ie.border}`},nodeColor:()=>ie.focus}),e.jsxs(Rs,{position:"top-right",className:"flex space-x-2",children:[e.jsxs("button",{onClick:n,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"💾"}),e.jsx("span",{children:"Save"})]}),e.jsxs("button",{onClick:x,disabled:_||!t?.id,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 text-white rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:_?"⏳":"▶️"}),e.jsx("span",{children:_?"Executing...":"Execute"})]}),e.jsxs("button",{onClick:()=>v(!r),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"📋"}),e.jsx("span",{children:"Logs"})]})]})]})}),r&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-64 bg-slate-800 border-t border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Execution Logs"}),e.jsx("button",{onClick:()=>v(!1),className:"text-slate-400 hover:text-white",children:"✕"})]}),e.jsxs("div",{className:"overflow-y-auto h-40 space-y-2",children:[g.map((f,l)=>e.jsxs("div",{className:`p-2 rounded text-sm ${f.level==="error"?"bg-red-900/50 text-red-200":f.level==="success"?"bg-green-900/50 text-green-200":"bg-slate-700 text-slate-200"}`,children:[e.jsx("span",{className:"text-slate-400 text-xs",children:f.timestamp}),e.jsx("span",{className:"ml-2 font-medium",children:f.message}),f.nodeId&&e.jsxs("span",{className:"ml-2 text-xs text-slate-400",children:["(",f.nodeId,")"]})]},l)),g.length===0&&e.jsx("div",{className:"text-slate-400 text-center py-8",children:"No execution logs yet. Run a workflow to see logs here."})]})]})]})]})},Bt=({token:t,onBack:i})=>{const[a,m]=s.useState([]),[d,h]=s.useState([]),[y,c]=s.useState({}),[p,C]=s.useState(null),[A,b]=s.useState(null),[w,_]=s.useState([]),[N,g]=s.useState(!1),[o,r]=s.useState(!1),[v,j]=s.useState(!0),[u,T]=s.useState(""),[k,R]=s.useState("all");s.useEffect(()=>{E()},[t]);const E=async()=>{j(!0);try{const[f,l,M]=await Promise.all([fetch("/api/workflows",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/workflows/templates",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/workflows/node-types",{headers:{Authorization:`Bearer ${t}`}})]),[O,D,B]=await Promise.all([f.json(),l.json(),M.json()]);O.success&&m(O.workflows),D.success&&h(D.templates),B.success&&c(B.nodeTypes)}catch(f){console.error("Failed to load data:",f)}finally{j(!1)}},$=()=>{const f={id:0,name:"New Workflow",description:"A new workflow",workflow_data:{nodes:[],edges:[]},category:"custom",tags:[],is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};C(f),r(!0)},F=f=>{const l={...f,id:0,name:`${f.name} (Copy)`,is_template:!1};C(l),r(!0)},n=async f=>{try{const l=p?.id?`/api/workflows/${p.id}`:"/api/workflows",M=p?.id?"PUT":"POST";(await(await fetch(l,{method:M,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(f)})).json()).success&&(E(),r(!1),C(null))}catch(l){console.error("Failed to save workflow:",l)}},x=async f=>{if(confirm("Are you sure you want to delete this workflow?"))try{(await fetch(`/api/workflows/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok&&E()}catch(l){console.error("Failed to delete workflow:",l)}},S=a.filter(f=>{const l=f.name.toLowerCase().includes(u.toLowerCase())||f.description.toLowerCase().includes(u.toLowerCase()),M=k==="all"||f.category===k;return l&&M}),I=[...new Set(a.map(f=>f.category)),"all"];s.useEffect(()=>{if(!A)return;let f=!1;const l=async()=>{g(!0);try{const D=await(await fetch(`/api/workflows/${A}/executions?limit=15`,{headers:{Authorization:`Bearer ${t}`}})).json();!f&&D.executions&&_(D.executions.map(B=>({id:B.id,status:B.status||"unknown",started_at:B.started_at||B.created_at,completed_at:B.completed_at,error:B.error})))}catch{}finally{f||g(!1)}};l();const M=setInterval(l,1e4);return()=>{f=!0,clearInterval(M)}},[A,t]);const q=f=>{const M={pending:"bg-slate-700 text-slate-200",running:"bg-blue-600 text-white",completed:"bg-green-600 text-white",failed:"bg-red-600 text-white",canceled:"bg-yellow-600 text-white"}[f]||"bg-slate-600 text-slate-200";return e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-medium ${M}`,children:f})};return v?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"text-white text-xl mt-4",children:"Loading Workflow System..."})]})}):o?e.jsx(Ns,{children:e.jsx(qt,{workflow:p,onSave:n,token:t,nodeTypes:y})}):e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white",children:[e.jsx("header",{className:"bg-slate-800 border-b border-slate-700 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-700",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent",children:"🚀 Workflow Automation"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Build powerful AI workflows, RAG pipelines, and multi-agent automations"})]})]}),e.jsxs("button",{onClick:$,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"➕"}),e.jsx("span",{children:"Create Workflow"})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search workflows...",value:u,onChange:f=>T(f.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-blue-500"})}),e.jsxs("select",{value:k,onChange:f=>R(f.target.value),className:"px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),I.filter(f=>f!=="all").map(f=>e.jsx("option",{value:f,children:f},f))]})]}),d.length>0&&e.jsxs("div",{className:"mb-12",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"📚"}),e.jsx("span",{children:"Workflow Templates"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(f=>e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-6 hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:f.name}),e.jsx("p",{className:"text-slate-400 text-sm",children:f.description})]}),e.jsx("span",{className:"px-3 py-1 bg-blue-600 text-blue-100 rounded-full text-xs font-medium",children:f.category})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:f.tags.map(l=>e.jsx("span",{className:"px-2 py-1 bg-slate-700 text-slate-300 rounded text-xs",children:l},l))}),e.jsx("button",{onClick:()=>F(f),className:"w-full px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-lg font-semibold transition-all transform hover:scale-105",children:"Use Template"})]},f.id))})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"⚙️"}),e.jsx("span",{children:"Your Workflows"}),e.jsxs("span",{className:"text-sm font-normal text-slate-400",children:["(",S.length,")"]})]}),S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-slate-400 text-lg mb-4",children:u||k!=="all"?"No workflows match your filters":"No workflows yet"}),e.jsx("button",{onClick:$,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Create Your First Workflow"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(f=>e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-6 hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:f.name}),e.jsx("p",{className:"text-slate-400 text-sm",children:f.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${f.is_active?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"px-3 py-1 bg-purple-600 text-purple-100 rounded-full text-xs font-medium",children:f.category})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:f.tags.map(l=>e.jsx("span",{className:"px-2 py-1 bg-slate-700 text-slate-300 rounded text-xs",children:l},l))}),e.jsxs("div",{className:"text-xs text-slate-500 mb-4",children:[e.jsxs("div",{children:["Nodes: ",f.workflow_data.nodes?.length||0]}),e.jsxs("div",{children:["Updated:"," ",new Date(f.updated_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{C(f),r(!0)},className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>x(f.id),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:"🗑️"}),e.jsx("button",{onClick:()=>b(A===f.id.toString()?null:f.id.toString()),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold transition-colors",children:A===f.id.toString()?"Hide":"History"})]}),A===f.id.toString()&&e.jsxs("div",{className:"mt-6 border-t border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-300 flex items-center space-x-2",children:[e.jsx("span",{children:"📜"}),e.jsx("span",{children:"Recent Executions"})]}),N&&e.jsx("span",{className:"text-xs text-slate-500 animate-pulse",children:"Refreshing..."})]}),e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-700/60 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"ID"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Status"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Started"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Completed"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Duration"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Error"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-700/70",children:[w.length===0&&!N&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-slate-500",children:"No executions yet."})}),w.map(l=>{const M=l.started_at&&l.completed_at?((new Date(l.completed_at).getTime()-new Date(l.started_at).getTime())/1e3).toFixed(2)+"s":"—";return e.jsxs("tr",{className:"hover:bg-slate-700/40",children:[e.jsx("td",{className:"px-3 py-2 font-mono text-[10px]",children:l.id.slice(0,8)}),e.jsx("td",{className:"px-3 py-2",children:q(l.status)}),e.jsx("td",{className:"px-3 py-2 text-slate-400",children:l.started_at?new Date(l.started_at).toLocaleTimeString():"—"}),e.jsx("td",{className:"px-3 py-2 text-slate-400",children:l.completed_at?new Date(l.completed_at).toLocaleTimeString():"—"}),e.jsx("td",{className:"px-3 py-2 text-slate-300",children:M}),e.jsx("td",{className:"px-3 py-2 text-red-400 truncate max-w-[160px]",title:l.error||"",children:l.error?l.error.slice(0,40):""})]},l.id)})]})]})}),e.jsxs("div",{className:"md:hidden space-y-3",children:[w.length===0&&!N&&e.jsx("div",{className:"text-slate-500 text-xs",children:"No executions yet."}),w.map(l=>{const M=l.started_at&&l.completed_at?((new Date(l.completed_at).getTime()-new Date(l.started_at).getTime())/1e3).toFixed(2)+"s":"—";return e.jsxs("div",{className:"border border-slate-700 rounded-lg p-3 bg-slate-800/50 text-[11px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-mono",children:l.id.slice(0,8)}),q(l.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-slate-400",children:[e.jsxs("span",{children:["Start: ",l.started_at?new Date(l.started_at).toLocaleTimeString():"—"]}),e.jsxs("span",{children:["End: ",l.completed_at?new Date(l.completed_at).toLocaleTimeString():"—"]}),e.jsxs("span",{children:["Dur: ",M]})]}),l.error&&e.jsx("div",{className:"mt-1 text-red-400 truncate",title:l.error,children:l.error.slice(0,60)})]},l.id)})]}),e.jsx("div",{className:"mt-3 text-[10px] text-slate-500",children:"Auto-refresh every 10s (MVP polling)"}),e.jsxs("div",{className:"mt-4 bg-slate-800/60 border border-slate-700 rounded p-3",children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:"Upcoming Monitoring Enhancements:"}),e.jsxs("ul",{className:"mt-2 text-[11px] text-slate-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Real-time streaming via SSE/WebSocket"}),e.jsx("li",{children:"Node-level progress & timeline visualization"}),e.jsx("li",{children:"Log streaming with auto-scroll & filters"})]})]})]})]},f.id))})]})]})]})},zt=({graphData:t,onNodeClick:i,onNodeHover:a,selectedCategories:m=[],showSemanticEdges:d=!0,minEdgeStrength:h=.5,width:y=800,height:c=600})=>{const p=s.useRef(null),C=s.useRef(null),[A,b]=s.useState(null),w=s.useMemo(()=>({ai:"#8b5cf6",database:"#06b6d4",frontend:"#10b981",security:"#f59e0b",general:"#64748b",backend:"#ef4444",ml:"#ec4899",devops:"#14b8a6"}),[]),_=s.useMemo(()=>{if(!t)return null;let N=t.nodes,g=t.edges;if(m.length>0){N=N.filter(r=>m.includes(r.category));const o=new Set(N.map(r=>r.id));g=g.filter(r=>o.has(r.source)&&o.has(r.target))}return d||(g=g.filter(o=>o.type!=="semantic")),g=g.filter(o=>o.weight>=h),{...t,nodes:N,edges:g}},[t,m,d,h]);return s.useEffect(()=>{if(!p.current||!_)return;if(!C.current){const o=Xs;C.current=new o()(p.current)}C.current.width(y).height(c).backgroundColor("#0f172a").graphData(_).nodeId("id").nodeLabel(o=>`
        <div class="bg-slate-800 text-white p-3 rounded-lg shadow-lg max-w-sm">
          <div class="font-bold text-lg mb-2">${o.label}</div>
          <div class="text-sm text-slate-300 mb-2">Category: ${o.category}</div>
          <div class="text-sm text-slate-300 mb-2">Connections: ${o.degree}</div>
          <div class="text-sm text-slate-300 mb-2">Importance: ${(o.importance*100).toFixed(0)}%</div>
          ${o.tags.length>0?`<div class="text-xs text-slate-400">Tags: ${o.tags.join(", ")}</div>`:""}
        </div>
      `).nodeColor(o=>A&&A.id===o.id?"#fbbf24":w[o.category]||w.general).nodeVal(o=>Math.max(1,o.size*2)).nodeThreeObject(o=>{const r=new et(o.label);return r.color=A&&A.id===o.id?"#fbbf24":"#ffffff",r.textHeight=Math.max(4,o.importance*8),r.borderWidth=2,r.borderColor=w[o.category]||w.general,r.backgroundColor="rgba(0, 0, 0, 0.8)",r.padding=2,r}).linkSource("source").linkTarget("target").linkLabel(o=>`
        <div class="bg-slate-800 text-white p-2 rounded shadow-lg">
          <div class="text-sm font-medium">${o.type.replace("_"," ").toUpperCase()}</div>
          <div class="text-xs text-slate-300">Strength: ${(o.weight*100).toFixed(0)}%</div>
        </div>
      `).linkColor(o=>{const r=o.opacity;switch(o.type){case"semantic":return`rgba(139, 92, 246, ${r})`;case"references":return`rgba(34, 197, 94, ${r})`;case"similar_to":return`rgba(239, 68, 68, ${r})`;default:return`rgba(148, 163, 184, ${r})`}}).linkWidth(o=>Math.max(.5,o.weight*3)).linkOpacity(o=>o.opacity).linkDirectionalArrowLength(3).linkDirectionalArrowColor(o=>{switch(o.type){case"semantic":return"#8b5cf6";case"references":return"#22c55e";case"similar_to":return"#ef4444";default:return"#94a3b8"}}).onNodeClick(o=>{b(o),i?.(o)}).onNodeHover(o=>{p.current.style.cursor=o?"pointer":"default",a?.(o)}).onLinkHover(o=>{p.current.style.cursor=o?"pointer":"default"}).cooldownTicks(100).d3AlphaDecay(.02).d3VelocityDecay(.1);const g=document.createElement("div");if(g.innerHTML=`
      <div class="absolute bottom-4 left-4 bg-slate-800 text-white p-3 rounded-lg text-xs">
        <div class="font-medium mb-1">Controls:</div>
        <div>• Mouse: Rotate view</div>
        <div>• Scroll: Zoom in/out</div>
        <div>• Click: Select node</div>
        <div>• Drag: Move camera</div>
      </div>
    `,g.style.position="absolute",g.style.bottom="16px",g.style.left="16px",g.style.zIndex="10",g.style.pointerEvents="none",p.current){const o=p.current.querySelector(".controls-hint");o&&o.remove(),g.className="controls-hint",p.current.appendChild(g)}return()=>{C.current&&C.current._destructor?.()}},[_,y,c,A,w,i,a]),t?_?.nodes.length===0?e.jsx("div",{ref:p,className:"w-full h-full flex items-center justify-center bg-slate-900 rounded-lg",style:{width:y,height:c},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🧠"}),e.jsx("div",{className:"text-slate-400 text-lg mb-2",children:"No knowledge entries found"}),e.jsx("div",{className:"text-slate-500 text-sm",children:m.length>0?"Try adjusting your category filters":"Create some knowledge entries to see the graph"})]})}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:p,className:"rounded-lg overflow-hidden shadow-2xl border border-slate-700",style:{width:y,height:c}}),e.jsxs("div",{className:"absolute top-4 right-4 bg-slate-800 text-white p-3 rounded-lg text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:"Graph Statistics"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{children:["Nodes: ",_?_.nodes.length:0]}),e.jsxs("div",{children:["Edges: ",_?_.edges.length:0]}),e.jsxs("div",{children:["Clusters: ",_?_.clusters.length:0]})]})]}),A&&e.jsxs("div",{className:"absolute top-4 left-4 bg-slate-800 text-white p-4 rounded-lg max-w-sm",children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:A.label}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Category:"})," ",A.category]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Connections:"})," ",A.degree]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Importance:"})," ",(A.importance*100).toFixed(0),"%"]}),A.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:A.tags.map((N,g)=>e.jsx("span",{className:"px-2 py-1 bg-slate-700 rounded text-xs",children:N},g))})]})]})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-slate-800 text-white p-3 rounded-lg text-xs",children:[e.jsx("div",{className:"font-medium mb-2",children:"Edge Types:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5 bg-purple-500"}),e.jsx("span",{children:"Semantic"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5 bg-green-500"}),e.jsx("span",{children:"References"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5 bg-red-500"}),e.jsx("span",{children:"Similar"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-0.5 bg-slate-400"}),e.jsx("span",{children:"Other"})]})]})]})]}):e.jsx("div",{ref:p,className:"w-full h-full flex items-center justify-center bg-slate-900 rounded-lg",style:{width:y,height:c},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("div",{className:"text-slate-400",children:"Loading knowledge graph..."})]})})},Ut=({onResultClick:t,selectedCategories:i=[],onCategoryChange:a,className:m="",documentIds:d})=>{const[h,y]=s.useState(""),[c,p]=s.useState("semantic"),[C,A]=s.useState([]),[b,w]=s.useState(!1),[_,N]=s.useState(!1),[g,o]=s.useState(null),[r,v]=s.useState(null),[j,u]=s.useState(.6),T=!1,k=s.useMemo(()=>["ai","database","frontend","backend","security","ml","devops","general"],[]),R=s.useCallback(Is.debounce(async(n,x,S,I)=>{if(!n.trim()){A([]),o(null);return}w(!0),v(null);try{const q=localStorage.getItem("token");if(T){const f=await fetch("/api/router",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${q}`,"x-session-id":`search-${Date.now()}`},body:JSON.stringify({task:"search",query:n,options:{limit:20,threshold:I,documentIds:d&&d.length?d:void 0}})});if(!f.ok)throw new Error(`Router search failed: ${f.statusText}`);const l=await f.json(),M=l?.result,O=Array.isArray(M?.results)?M.results.map(D=>({id:`${D.document_id}:${D.chunk_id}`,title:D.document_title||"Document",content:D.chunk_text||"",category:D.document_metadata?.category||"general",tags:D.document_metadata?.tags||[],importance_score:D.similarity||0,similarity_score:D.similarity,search_type:"semantic",snippet:(D.chunk_text||"").slice(0,240),created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):[];A(O),o({query:n,search_type:"semantic",total_results:O.length,duration_ms:l?.timing_ms??0})}else{const f=await fetch("/api/knowledge/search",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${q}`,"x-session-id":`search-${Date.now()}`},body:JSON.stringify({query:n,search_type:x,limit:20,threshold:I,category:S.length===1?S[0]:void 0,tags:S.length>1?S:void 0})});if(!f.ok)throw new Error(`Search failed: ${f.statusText}`);const l=await f.json();A(l.results||[]),o(l.meta)}}catch(q){console.error("Search error:",q),v(q instanceof Error?q.message:"Search failed"),A([]),o(null)}finally{w(!1)}},300),[T,d]);s.useEffect(()=>{R(h,c,i,j)},[h,c,i,j,R]);const E=n=>{const x=i.includes(n)?i.filter(S=>S!==n):[...i,n];a?.(x)},$=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),F=(n,x)=>{if(!x.trim())return n;const S=x.toLowerCase().split(/\s+/);let I=n;return S.forEach(q=>{const f=new RegExp(`(${q})`,"gi");I=I.replace(f,'<mark class="bg-yellow-200 dark:bg-yellow-800">$1</mark>')}),I};return e.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 ${m}`,children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(oe,{className:"absolute left-3 top-3 h-5 w-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search knowledge base...",value:h,onChange:n=>y(n.target.value),className:`w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg 
                         bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100
                         focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsx("button",{onClick:()=>N(!_),className:`p-2 rounded-lg border ${_?"bg-blue-500 text-white border-blue-500":"bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-300 border-slate-300 dark:border-slate-600"} hover:bg-blue-600 transition-colors`,children:e.jsx(ts,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[["semantic","fulltext","hybrid"].map(n=>e.jsx("button",{onClick:()=>p(n),className:`px-3 py-1 text-sm rounded-md transition-colors ${c===n?"bg-blue-500 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:n.charAt(0).toUpperCase()+n.slice(1)},n)),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-300",children:"Threshold"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:j,onChange:n=>u(parseFloat(n.target.value)),className:"w-32"}),e.jsxs("span",{className:"text-xs text-slate-600 dark:text-slate-300 w-10 text-right",children:[(j*100).toFixed(0),"%"]})]})]})]}),_&&e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-750",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(n=>e.jsx("button",{onClick:()=>E(n),className:`px-3 py-1 text-xs rounded-full transition-colors ${i.includes(n)?"bg-blue-500 text-white":"bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-300 border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-600"}`,children:n},n))})]}),i.length>0&&e.jsx("button",{onClick:()=>a?.([]),className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:"Clear all filters"})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[b&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-3"}),e.jsx("div",{className:"text-slate-500 dark:text-slate-400",children:"Searching..."})]}),r&&e.jsx("div",{className:"p-4 text-center text-red-600 dark:text-red-400",children:e.jsx("div",{className:"text-sm",children:r})}),g&&!b&&e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-750 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:["Found ",g.total_results," results in ",g.duration_ms,"ms",g.search_type&&` using ${g.search_type} search`]})}),C.length>0&&!b&&e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:C.map(n=>e.jsxs("div",{onClick:()=>t?.(n),className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-750 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-900 dark:text-slate-100 line-clamp-1",children:n.title}),n.similarity_score&&e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400 ml-2",children:[(n.similarity_score*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400 mb-2 line-clamp-2",dangerouslySetInnerHTML:{__html:F(n.snippet,h)}}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium
                      ${n.category==="ai"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":n.category==="database"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":n.category==="frontend"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":n.category==="security"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-200"}`,children:n.category}),n.tags.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),e.jsx("span",{children:n.tags.slice(0,2).join(", ")}),n.tags.length>2&&e.jsxs("span",{children:["+",n.tags.length-2]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"h-3 w-3"}),e.jsx("span",{children:$(n.updated_at)})]})]})]},n.id))}),C.length===0&&!b&&h.trim()&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Ie,{className:"h-12 w-12 text-slate-400 mx-auto mb-3"}),e.jsx("div",{className:"text-slate-500 dark:text-slate-400 mb-2",children:"No results found"}),e.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:"Try adjusting your search terms or filters"})]}),C.length===0&&!b&&!h.trim()&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(oe,{className:"h-12 w-12 text-slate-400 mx-auto mb-3"}),e.jsx("div",{className:"text-slate-500 dark:text-slate-400 mb-2",children:"Search your knowledge base"}),e.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:"Enter a query to find relevant entries using semantic or full-text search"})]})]})]})},Vt=()=>{const[t,i]=s.useState("search"),[a,m]=s.useState([]),[d,h]=s.useState(null),[y,c]=s.useState([]),[p,C]=s.useState(!1),[A,b]=s.useState(null),[w,_]=s.useState(null),[N,g]=s.useState(!0),[o,r]=s.useState(.5),v=s.useCallback(async()=>{try{C(!0);const E=localStorage.getItem("token"),$=await fetch("/api/knowledge/entries",{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"}});if(!$.ok)throw new Error("Failed to load entries");const F=await $.json();m(F.entries||[])}catch(E){console.error("Error loading entries:",E),_("Failed to load knowledge entries")}finally{C(!1)}},[]),j=s.useCallback(async()=>{try{C(!0);const E=localStorage.getItem("token"),$=new URLSearchParams({include_relationships:"true",include_clusters:"true",min_strength:o.toString()}),F=await fetch(`/api/knowledge/graph?${$}`,{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"}});if(!F.ok)throw new Error("Failed to load graph data");const n=await F.json();h(n)}catch(E){console.error("Error loading graph data:",E),_("Failed to load knowledge graph")}finally{C(!1)}},[o]);s.useEffect(()=>{v(),t==="graph"&&j()},[t,v,j]);const u=s.useCallback(E=>{const $=a.find(F=>F.id===E.id);$&&b($)},[a]),T=s.useCallback(E=>{const $=a.find(F=>F.id===E.id);$&&b($)},[a]),k=s.useCallback(()=>{v(),t==="graph"&&j()},[t,v,j]),R=y.length>0?a.filter(E=>y.includes(E.category)):a;return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Knowledge Hub"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Semantic search & 3D visualization"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:k,disabled:p,className:"p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(fe,{className:`h-5 w-5 ${p?"animate-spin":""}`})}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ds,{className:"h-4 w-4"}),"Add Entry"]})]})]}),e.jsx("div",{className:"flex space-x-1 border-b border-slate-200 dark:border-slate-700",children:[{id:"search",label:"Search",icon:oe},{id:"graph",label:"3D Graph",icon:Ae},{id:"entries",label:"All Entries",icon:Le},{id:"analytics",label:"Analytics",icon:we}].map(E=>e.jsxs("button",{onClick:()=>i(E.id),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${t===E.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e.jsx(E.icon,{className:"h-4 w-4"}),E.label]},E.id))})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[w&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("div",{className:"text-red-800 dark:text-red-200 text-sm",children:w})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[t==="search"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Ut,{selectedCategories:y,onCategoryChange:c,onResultClick:T,className:"h-[600px]"})}),t==="graph"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"3D Knowledge Graph"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:E=>g(E.target.checked),className:"rounded border-slate-300"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"Semantic edges"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"Min strength:"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:o,onChange:E=>r(parseFloat(E.target.value)),className:"w-20"}),e.jsxs("span",{className:"text-slate-600 dark:text-slate-300 w-8",children:[(o*100).toFixed(0),"%"]})]})]})]}),e.jsx(zt,{graphData:d,onNodeClick:u,selectedCategories:y,showSemanticEdges:N,minEdgeStrength:o,width:800,height:600})]})}),t==="entries"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:["All Knowledge Entries (",R.length,")"]})}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700 max-h-[600px] overflow-y-auto",children:R.map(E=>e.jsxs("div",{onClick:()=>b(E),className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-750 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:E.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[!E.has_embedding&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 px-2 py-1 rounded",children:"Indexing..."}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full
                              ${E.category==="ai"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":E.category==="database"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":E.category==="frontend"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-200"}`,children:E.category})]})]}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400 line-clamp-2 mb-2",children:[E.content.substring(0,200),"..."]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("div",{className:"flex items-center gap-2",children:E.tags.length>0&&e.jsx("span",{children:E.tags.slice(0,3).join(", ")})}),e.jsx("span",{children:new Date(E.updated_at).toLocaleDateString()})]})]},E.id))})]})}),t==="analytics"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Entries"}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:a.length})]}),e.jsx(Le,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"With Embeddings"}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:a.filter(E=>E.has_embedding).length})]}),e.jsx(Ae,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Categories"}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:new Set(a.map(E=>E.category)).size})]}),e.jsx($s,{className:"h-8 w-8 text-purple-500"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"Category Breakdown"}),e.jsx("div",{className:"space-y-3",children:Object.entries(a.reduce((E,$)=>(E[$.category]=(E[$.category]||0)+1,E),{})).map(([E,$])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300 capitalize",children:E}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-slate-200 dark:bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${$/a.length*100}%`}})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-slate-100 w-8",children:$})]})]},E))})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"Filter by Category"}),e.jsx("div",{className:"space-y-2",children:["ai","database","frontend","backend","security","ml","devops","general"].map(E=>{const $=a.filter(F=>F.category===E).length;return e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:y.includes(E),onChange:F=>{F.target.checked?c([...y,E]):c(y.filter(n=>n!==E))},className:"rounded border-slate-300"}),e.jsxs("span",{className:"text-slate-600 dark:text-slate-300 capitalize",children:[E," (",$,")"]})]},E)})}),y.length>0&&e.jsx("button",{onClick:()=>c([]),className:"mt-3 text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:"Clear filters"})]}),A&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:"Entry Details"}),e.jsx("button",{onClick:()=>b(null),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:"×"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-slate-100 mb-1",children:A.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 line-clamp-4",children:A.content})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Category:"}),e.jsx("span",{className:"text-slate-900 dark:text-slate-100",children:A.category})]}),A.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:A.tags.map((E,$)=>e.jsx("span",{className:"px-2 py-1 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded text-xs",children:E},$))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Importance:"}),e.jsxs("span",{className:"text-slate-900 dark:text-slate-100",children:[(A.importance_score*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Updated:"}),e.jsx("span",{className:"text-slate-900 dark:text-slate-100",children:new Date(A.updated_at).toLocaleDateString()})]})]})]})]})]})]})]})]})},Wt=({isOpen:t,onClose:i,onConfirm:a,title:m,message:d,confirmText:h="Confirm",cancelText:y="Cancel",destructive:c=!1,requireTextConfirmation:p=!1,textToConfirm:C=""})=>{const[A,b]=s.useState("");if(!t)return null;const w=p&&A.toLowerCase()!==C.toLowerCase(),_=()=>{w||(a(),b(""))},N=()=>{i(),b("")};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:`text-2xl ${c?"text-red-400":"text-yellow-400"}`,children:c?"⚠️":"❓"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:m})]}),e.jsx("p",{className:"text-gray-300 mb-6",children:d}),p&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:['Type "',C,'" to confirm:']}),e.jsx("input",{type:"text",value:A,onChange:g=>b(g.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-red-500",placeholder:C,autoFocus:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:N,className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:y}),e.jsx("button",{onClick:_,disabled:w,className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${c?"bg-red-600 hover:bg-red-700 disabled:bg-red-800":"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:h})]})]})})},de=[{id:"openai",name:"openai",displayName:"OpenAI",category:"ai",icon:"🤖",description:"GPT models, DALL-E, and advanced AI capabilities",featured:!0,popular:!0,fields:[{name:"apiKey",type:"password",required:!0,pattern:"^sk-[A-Za-z0-9]{32,}$",placeholder:"sk-1234567890abcdef...",description:"Your OpenAI API key from platform.openai.com"}],documentationUrl:"https://platform.openai.com/docs"},{id:"huggingface",name:"huggingface",displayName:"HuggingFace",category:"ai",icon:"🤗",description:"Open-source ML models and inference API",featured:!0,popular:!0,fields:[{name:"token",type:"password",required:!0,pattern:"^hf_[A-Za-z0-9]{30,}$",placeholder:"hf_1234567890abcdef...",description:"HuggingFace access token from your profile settings"}],documentationUrl:"https://huggingface.co/docs/api-inference"},{id:"anthropic",name:"anthropic",displayName:"Anthropic",category:"ai",icon:"🧠",description:"Claude AI assistant and language models",popular:!0,fields:[{name:"apiKey",type:"password",required:!0,pattern:"^sk-ant-[A-Za-z0-9\\-_]{32,}$",placeholder:"sk-ant-api03-1234567890...",description:"Anthropic API key for Claude models"}],documentationUrl:"https://docs.anthropic.com"},{id:"replicate",name:"replicate",displayName:"Replicate",category:"ai",icon:"🔄",description:"Run machine learning models in the cloud",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"r8_1234567890abcdef...",description:"Replicate API token"}]},{id:"stability",name:"stability",displayName:"Stability AI",category:"ai",icon:"🎨",description:"Stable Diffusion and image generation models",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"sk-1234567890abcdef...",description:"Stability AI API key"}]},{id:"assemblyai",name:"assemblyai",displayName:"AssemblyAI",category:"ai",icon:"🎤",description:"Speech-to-text and audio intelligence",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"1234567890abcdef...",description:"AssemblyAI API key"}]},{id:"deepgram",name:"deepgram",displayName:"Deepgram",category:"ai",icon:"🎙️",description:"Advanced speech recognition and audio analysis",popular:!0,fields:[{name:"apiKey",type:"password",required:!0,placeholder:"1234567890abcdef...",description:"Deepgram API key"}]},{id:"elevenlabs",name:"elevenlabs",displayName:"ElevenLabs",category:"ai",icon:"🗣️",description:"AI voice generation and text-to-speech",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"1234567890abcdef...",description:"ElevenLabs API key"}]},{id:"google",name:"google",displayName:"Google Cloud",category:"infrastructure",icon:"☁️",description:"Google Cloud Platform services and APIs",popular:!0,fields:[{name:"serviceAccountJson",type:"json",required:!1,placeholder:'{"type": "service_account", ...}',description:"Service account JSON key file (preferred)"},{name:"apiKey",type:"password",required:!1,pattern:"^[A-Za-z0-9\\-_]{39}$",placeholder:"AIzaSyDp-cMne4eJ-EtV68iNlypHdssyZ76cFb4",description:"Google Cloud API key (alternative)"}]},{id:"aws",name:"aws",displayName:"Amazon Web Services",category:"infrastructure",icon:"🟠",description:"AWS cloud services and APIs",featured:!0,fields:[{name:"accessKeyId",type:"text",required:!0,pattern:"^AKIA[0-9A-Z]{16}$",placeholder:"AKIA1234567890123456",description:"AWS Access Key ID"},{name:"secretAccessKey",type:"password",required:!0,pattern:"^[A-Za-z0-9/+=]{40}$",placeholder:"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",description:"AWS Secret Access Key"},{name:"region",type:"text",required:!0,pattern:"^[a-z]{2}-[a-z]+-\\d$",placeholder:"us-east-1",description:"AWS region"}]},{id:"azure",name:"azure",displayName:"Microsoft Azure",category:"infrastructure",icon:"🔷",description:"Microsoft Azure cloud platform",fields:[{name:"tenantId",type:"text",required:!0,placeholder:"12345678-1234-1234-1234-123456789012",description:"Azure AD tenant ID"},{name:"clientId",type:"text",required:!0,placeholder:"12345678-1234-1234-1234-123456789012",description:"Azure AD application (client) ID"},{name:"clientSecret",type:"password",required:!0,placeholder:"client-secret-value",description:"Azure AD client secret"},{name:"subscriptionId",type:"text",required:!0,placeholder:"12345678-1234-1234-1234-123456789012",description:"Azure subscription ID"}]},{id:"cloudflare",name:"cloudflare",displayName:"Cloudflare",category:"infrastructure",icon:"☁️",description:"CDN, security, and performance optimization",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"api-token-value",description:"Cloudflare API token"},{name:"accountId",type:"text",required:!0,placeholder:"account-id-value",description:"Cloudflare account ID"}]},{id:"vercel",name:"vercel",displayName:"Vercel",category:"infrastructure",icon:"▲",description:"Frontend deployment and hosting platform",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"vercel-api-token",description:"Vercel API token"}]},{id:"netlify",name:"netlify",displayName:"Netlify",category:"infrastructure",icon:"🌐",description:"Static site hosting and deployment",fields:[{name:"accessToken",type:"password",required:!0,placeholder:"netlify-access-token",description:"Netlify access token"}]},{id:"stripe",name:"stripe",displayName:"Stripe",category:"payments",icon:"💳",description:"Payment processing and financial services",popular:!0,fields:[{name:"secretKey",type:"password",required:!0,pattern:"^sk_(live|test)_[A-Za-z0-9]{24,}$",placeholder:"sk_test_1234567890abcdef...",description:"Stripe secret key"}]},{id:"paypal",name:"paypal",displayName:"PayPal",category:"payments",icon:"💰",description:"PayPal payment processing",fields:[{name:"clientId",type:"text",required:!0,placeholder:"paypal-client-id",description:"PayPal client ID"},{name:"clientSecret",type:"password",required:!0,placeholder:"paypal-client-secret",description:"PayPal client secret"}]},{id:"plaid",name:"plaid",displayName:"Plaid",category:"payments",icon:"🏦",description:"Banking and financial data connectivity",fields:[{name:"clientId",type:"text",required:!0,placeholder:"plaid-client-id",description:"Plaid client ID"},{name:"secret",type:"password",required:!0,placeholder:"plaid-secret-key",description:"Plaid secret key"},{name:"env",type:"text",required:!0,placeholder:"sandbox",description:"Environment (sandbox/development/production)"}]},{id:"twilio",name:"twilio",displayName:"Twilio",category:"communication",icon:"📱",description:"SMS, voice, and communication APIs",popular:!0,fields:[{name:"accountSid",type:"text",required:!0,pattern:"^AC[0-9a-fA-F]{32}$",placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",description:"Twilio Account SID"},{name:"authToken",type:"password",required:!0,pattern:"^[0-9a-fA-F]{32}$",placeholder:"1234567890abcdef1234567890abcdef",description:"Twilio Auth Token"}]},{id:"slack",name:"slack",displayName:"Slack",category:"communication",icon:"💬",description:"Slack workspace integration",fields:[{name:"botToken",type:"password",required:!0,pattern:"^xox[baprs]-[A-Za-z0-9-]{10,}",placeholder:"xoxb-1234567890-1234567890-abcdef",description:"Slack bot token"}]},{id:"discord",name:"discord",displayName:"Discord",category:"communication",icon:"🎮",description:"Discord bot and server integration",fields:[{name:"botToken",type:"password",required:!0,placeholder:"discord-bot-token",description:"Discord bot token"}]},{id:"sendgrid",name:"sendgrid",displayName:"SendGrid",category:"communication",icon:"📧",description:"Email delivery service",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"SG.1234567890abcdef...",description:"SendGrid API key"}]},{id:"mailgun",name:"mailgun",displayName:"Mailgun",category:"communication",icon:"📮",description:"Email service for developers",fields:[{name:"domain",type:"text",required:!0,placeholder:"mg.example.com",description:"Mailgun domain"},{name:"apiKey",type:"password",required:!0,placeholder:"key-1234567890abcdef",description:"Mailgun API key"}]},{id:"postmark",name:"postmark",displayName:"Postmark",category:"communication",icon:"📬",description:"Reliable email delivery",fields:[{name:"serverToken",type:"password",required:!0,placeholder:"postmark-server-token",description:"Postmark server token"}]},{id:"notion",name:"notion",displayName:"Notion",category:"productivity",icon:"📝",description:"Notion workspace and database integration",popular:!0,fields:[{name:"integrationToken",type:"password",required:!0,placeholder:"secret_1234567890abcdef",description:"Notion integration token"}]},{id:"jira",name:"jira",displayName:"Jira",category:"productivity",icon:"🎯",description:"Project management and issue tracking",fields:[{name:"email",type:"text",required:!0,placeholder:"user@example.com",description:"Jira account email"},{name:"apiToken",type:"password",required:!0,placeholder:"jira-api-token",description:"Jira API token"},{name:"siteDomain",type:"text",required:!0,placeholder:"yourcompany.atlassian.net",description:"Jira site domain"}]},{id:"linear",name:"linear",displayName:"Linear",category:"productivity",icon:"📐",description:"Modern issue tracking and project management",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"lin_api_1234567890abcdef",description:"Linear API key"}]},{id:"confluence",name:"confluence",displayName:"Confluence",category:"productivity",icon:"📚",description:"Team collaboration and documentation",fields:[{name:"email",type:"text",required:!0,placeholder:"user@example.com",description:"Confluence account email"},{name:"apiToken",type:"password",required:!0,placeholder:"confluence-api-token",description:"Confluence API token"},{name:"siteDomain",type:"text",required:!0,placeholder:"yourcompany.atlassian.net",description:"Confluence site domain"}]},{id:"airtable",name:"airtable",displayName:"Airtable",category:"productivity",icon:"📋",description:"Spreadsheet-database hybrid platform",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"key1234567890abcdef",description:"Airtable API key"}]},{id:"clickup",name:"clickup",displayName:"ClickUp",category:"productivity",icon:"✅",description:"All-in-one productivity workspace",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"pk_1234567890abcdef",description:"ClickUp API key"}]},{id:"asana",name:"asana",displayName:"Asana",category:"productivity",icon:"🎯",description:"Work management and team collaboration",fields:[{name:"personalAccessToken",type:"password",required:!0,placeholder:"1/1234567890:abcdef1234567890",description:"Asana personal access token"}]},{id:"trello",name:"trello",displayName:"Trello",category:"productivity",icon:"📌",description:"Visual project management boards",fields:[{name:"apiKey",type:"text",required:!0,placeholder:"trello-api-key",description:"Trello API key"},{name:"apiToken",type:"password",required:!0,placeholder:"trello-api-token",description:"Trello API token"}]},{id:"pinecone",name:"pinecone",displayName:"Pinecone",category:"vector-db",icon:"🌲",description:"Vector database for ML applications",popular:!0,fields:[{name:"apiKey",type:"password",required:!0,pattern:"^[a-f0-9-]{32,}$",placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee",description:"Pinecone API key"},{name:"environment",type:"text",required:!0,placeholder:"us-east-1-aws",description:"Pinecone environment"}]},{id:"weaviate",name:"weaviate",displayName:"Weaviate",category:"vector-db",icon:"🔍",description:"Open-source vector database",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"weaviate-api-key",description:"Weaviate API key"},{name:"host",type:"url",required:!0,placeholder:"https://your-cluster.weaviate.network",description:"Weaviate cluster URL"}]},{id:"algolia",name:"algolia",displayName:"Algolia",category:"search-index",icon:"🔎",description:"Search and discovery API platform",fields:[{name:"appId",type:"text",required:!0,placeholder:"YourApplicationID",description:"Algolia application ID"},{name:"apiKey",type:"password",required:!0,placeholder:"your-api-key",description:"Algolia API key"}]},{id:"meilisearch",name:"meilisearch",displayName:"MeiliSearch",category:"search-index",icon:"⚡",description:"Fast, open-source search engine",fields:[{name:"host",type:"url",required:!0,placeholder:"http://localhost:7700",description:"MeiliSearch host URL"},{name:"masterKey",type:"password",required:!0,placeholder:"master-key-value",description:"MeiliSearch master key"}]},{id:"redis",name:"redis",displayName:"Redis",category:"datastores",icon:"🗄️",description:"In-memory data structure store",fields:[{name:"host",type:"text",required:!0,placeholder:"localhost",description:"Redis host"},{name:"port",type:"text",required:!0,pattern:"^\\d{2,5}$",placeholder:"6379",description:"Redis port"},{name:"password",type:"password",required:!1,placeholder:"redis-password",description:"Redis password (optional)"}]},{id:"postgres",name:"postgres",displayName:"PostgreSQL",category:"datastores",icon:"🐘",description:"Open-source relational database",fields:[{name:"host",type:"text",required:!0,pattern:"^[A-Za-z0-9_.-]+$",placeholder:"localhost",description:"PostgreSQL host"},{name:"port",type:"text",required:!0,pattern:"^\\d{2,5}$",placeholder:"5432",description:"PostgreSQL port"},{name:"database",type:"text",required:!0,placeholder:"mydb",description:"Database name"},{name:"user",type:"text",required:!0,placeholder:"postgres",description:"Database user"},{name:"password",type:"password",required:!0,placeholder:"password",description:"Database password"}]},{id:"supabase",name:"supabase",displayName:"Supabase",category:"datastores",icon:"⚡",description:"Open-source Firebase alternative",popular:!0,fields:[{name:"url",type:"url",required:!0,placeholder:"https://yourproject.supabase.co",description:"Supabase project URL"},{name:"anonKey",type:"password",required:!0,placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6...",description:"Supabase anonymous key"},{name:"serviceRoleKey",type:"password",required:!1,placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI6...",description:"Supabase service role key (optional)"}]},{id:"firebase",name:"firebase",displayName:"Firebase",category:"datastores",icon:"🔥",description:"Google Firebase platform",fields:[{name:"serviceAccountJson",type:"json",required:!0,placeholder:'{"type": "service_account", ...}',description:"Firebase service account JSON"}]},{id:"neon",name:"neon",displayName:"Neon",category:"datastores",icon:"🌟",description:"Serverless PostgreSQL platform",fields:[{name:"connectionString",type:"password",required:!0,placeholder:"postgres://user:pass@host/db",description:"Neon connection string"}]},{id:"upstash",name:"upstash",displayName:"Upstash",category:"datastores",icon:"⚡",description:"Serverless Redis and Kafka",fields:[{name:"restUrl",type:"url",required:!0,placeholder:"https://your-db.upstash.io",description:"Upstash REST URL"},{name:"restToken",type:"password",required:!0,placeholder:"upstash-rest-token",description:"Upstash REST token"}]},{id:"segment",name:"segment",displayName:"Segment",category:"analytics",icon:"📊",description:"Customer data platform",fields:[{name:"writeKey",type:"password",required:!0,placeholder:"segment-write-key",description:"Segment write key"}]},{id:"mixpanel",name:"mixpanel",displayName:"Mixpanel",category:"analytics",icon:"📈",description:"Product analytics platform",fields:[{name:"projectToken",type:"password",required:!0,placeholder:"mixpanel-project-token",description:"Mixpanel project token"},{name:"apiSecret",type:"password",required:!0,placeholder:"mixpanel-api-secret",description:"Mixpanel API secret"}]},{id:"datadog",name:"datadog",displayName:"Datadog",category:"monitoring",icon:"🐕",description:"Monitoring and analytics platform",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"datadog-api-key",description:"Datadog API key"},{name:"appKey",type:"password",required:!0,placeholder:"datadog-app-key",description:"Datadog application key"}]},{id:"sentry",name:"sentry",displayName:"Sentry",category:"monitoring",icon:"🚨",description:"Error monitoring and performance tracking",popular:!0,fields:[{name:"dsn",type:"url",required:!0,placeholder:"https://key@sentry.io/project",description:"Sentry DSN"},{name:"authToken",type:"password",required:!1,placeholder:"sentry-auth-token",description:"Sentry auth token (optional)"}]},{id:"pagerduty",name:"pagerduty",displayName:"PagerDuty",category:"monitoring",icon:"📟",description:"Incident response and alerting",fields:[{name:"apiToken",type:"password",required:!0,placeholder:"pagerduty-api-token",description:"PagerDuty API token"}]},{id:"github",name:"github",displayName:"GitHub",category:"misc",icon:"🐙",description:"Code hosting and collaboration platform",popular:!0,fields:[{name:"token",type:"password",required:!0,pattern:"^gh[pousr]_[A-Za-z0-9]{36,}$",placeholder:"ghp_1234567890abcdef1234567890abcdef",description:"GitHub personal access token"}]},{id:"gitlab",name:"gitlab",displayName:"GitLab",category:"misc",icon:"🦊",description:"DevOps platform and Git repository",fields:[{name:"token",type:"password",required:!0,placeholder:"glpat-1234567890abcdef",description:"GitLab access token"}]},{id:"openweather",name:"openweather",displayName:"OpenWeatherMap",category:"weather",icon:"🌤️",description:"Weather data and forecasting API",fields:[{name:"apiKey",type:"password",required:!0,placeholder:"openweather-api-key",description:"OpenWeatherMap API key"}]}],Ht={ai:ee.ai,infrastructure:ee.trigger,analytics:ee.data,communication:ee.http,payments:ee.logic,productivity:ee.mcp,"search-index":ee.rag,"vector-db":ee.rag,datastores:ee.data,weather:ee.fallback,monitoring:ee.trigger,misc:ee.fallback},Ve={ai:"AI & Machine Learning",infrastructure:"Cloud Infrastructure",analytics:"Analytics & Metrics",communication:"Communication",payments:"Payments & Finance",productivity:"Productivity Tools","search-index":"Search & Indexing","vector-db":"Vector Databases",datastores:"Data Storage",weather:"Weather Services",monitoring:"Monitoring & Alerts",misc:"Miscellaneous"},We=({onSelectProvider:t,selectedProvider:i,className:a=""})=>{const[m,d]=s.useState(""),[h,y]=s.useState("all"),[c,p]=s.useState(!1),C=s.useMemo(()=>de.filter(b=>{const w=b.displayName.toLowerCase().includes(m.toLowerCase())||b.description.toLowerCase().includes(m.toLowerCase())||b.name.toLowerCase().includes(m.toLowerCase()),_=h==="all"||b.category===h,N=!c||b.featured||b.popular;return w&&_&&N}),[m,h,c]),A=s.useMemo(()=>{const b={};return de.forEach(w=>{b[w.category]=(b[w.category]||0)+1}),Object.entries(b).map(([w,_])=>({key:w,name:Ve[w]||w,count:_})).sort((w,_)=>_.count-w.count)},[]);return e.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl ${a}`,children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Provider Catalog"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"50+ supported API providers with secure credential management"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-full text-sm font-medium",children:[C.length," providers"]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search providers...",value:m,onChange:b=>d(b.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"})}),e.jsxs("select",{value:h,onChange:b=>y(b.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsxs("option",{value:"all",children:["All Categories (",de.length,")"]}),A.map(b=>e.jsxs("option",{value:b.key,children:[b.name," (",b.count,")"]},b.key))]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:b=>p(b.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Featured only"})]})]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(b=>e.jsxs("div",{onClick:()=>t(b),className:`p-4 border rounded-lg cursor-pointer transition-all hover:shadow-md ${i?.id===b.id?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white text-lg font-semibold",style:{background:Ht[b.category]},children:b.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:b.displayName}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded",children:Ve[b.category]}),b.popular&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 rounded",children:"Popular"}),b.featured&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded",children:"Featured"})]})]})]})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:b.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-500",children:[e.jsxs("span",{children:[b.fields.length," field",b.fields.length!==1?"s":""]}),b.documentationUrl&&e.jsx("span",{children:"📚 Docs available"})]})]},b.id))}),C.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No providers found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Try adjusting your search terms or filters"})]})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 rounded-b-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:[C.length," of ",de.length," providers shown"]}),e.jsxs("span",{children:[A.length," categories • ",de.filter(b=>b.popular).length," popular • ",de.filter(b=>b.featured).length," featured"]})]})})]})},Gt=({provider:t,onSubmit:i,onCancel:a,isSubmitting:m=!1,className:d=""})=>{const[h,y]=s.useState({keyName:"",fields:{},expiresAt:"",rotationIntervalDays:90,metadata:{}}),[c,p]=s.useState({}),[C,A]=s.useState(!1);s.useEffect(()=>{const r={};t.fields.forEach(v=>{r[v.name]=""}),y(v=>({...v,keyName:`${t.displayName} Key`,fields:r})),p({})},[t]);const b=(r,v)=>{if(r.required&&!v.trim())return{isValid:!1,message:`${r.name} is required`};if(v&&r.pattern&&!new RegExp(r.pattern).test(v))return{isValid:!1,message:`Invalid ${r.name.charAt(0).toUpperCase()+r.name.slice(1)} format`};if(r.type==="json"&&v)try{JSON.parse(v)}catch{return{isValid:!1,message:"Invalid JSON format"}}if(r.type==="url"&&v)try{new URL(v)}catch{return{isValid:!1,message:"Invalid URL format"}}return{isValid:!0,message:""}},w=(r,v)=>{y(u=>({...u,fields:{...u.fields,[r]:v}}));const j=t.fields.find(u=>u.name===r);if(j){const u=b(j,v);p(T=>({...T,[r]:u}))}},_=()=>{const r={};let v=!0;return t.fields.forEach(j=>{const u=h.fields[j.name]||"",T=b(j,u);r[j.name]=T,T.isValid||(v=!1)}),h.keyName.trim()||(v=!1),p(r),v},N=async r=>{if(r.preventDefault(),!_())return;await i(h)&&(y({keyName:"",fields:{},expiresAt:"",rotationIntervalDays:90,metadata:{}}),p({}))},g=r=>{const v=h.fields[r.name]||"",j=c[r.name],T=`w-full px-4 py-3 rounded-lg border transition-colors focus:outline-none focus:ring-2 ${j&&!j.isValid?"border-red-500 focus:ring-red-500 bg-red-50 dark:bg-red-900/10":"border-gray-300 dark:border-gray-600 focus:ring-purple-500 bg-white dark:bg-gray-800"} text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400`;switch(r.type){case"password":return e.jsx("input",{type:"password",value:v,onChange:k=>w(r.name,k.target.value),placeholder:r.placeholder,className:T,autoComplete:"new-password"});case"url":return e.jsx("input",{type:"url",value:v,onChange:k=>w(r.name,k.target.value),placeholder:r.placeholder,className:T});case"json":return e.jsx("textarea",{value:v,onChange:k=>w(r.name,k.target.value),placeholder:r.placeholder,rows:6,className:`${T} font-mono text-sm resize-y`});default:return e.jsx("input",{type:"text",value:v,onChange:k=>w(r.name,k.target.value),placeholder:r.placeholder,className:T})}},o=h.keyName.trim()&&t.fields.every(r=>!r.required||h.fields[r.name]?.trim())&&Object.values(c).every(r=>!r||r.isValid);return e.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl ${d}`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-white text-xl font-semibold",style:{background:ee.ai},children:t.icon}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Add ",t.displayName," Credentials"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t.description})]})]})}),e.jsx("form",{onSubmit:N,className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Credential Name *"}),e.jsx("input",{type:"text",value:h.keyName,onChange:r=>y(v=>({...v,keyName:r.target.value})),placeholder:`e.g., Production ${t.displayName} Key`,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0})]}),t.fields.map(r=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.name.charAt(0).toUpperCase()+r.name.slice(1).replace(/([A-Z])/g," $1"),r.required&&" *"]}),g(r),r.description&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:r.description}),c[r.name]&&!c[r.name].isValid&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400 flex items-center space-x-1",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:c[r.name].message})]})]},r.name)),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>A(!C),className:"flex items-center space-x-2 text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300",children:[e.jsx("span",{children:C?"▼":"▶"}),e.jsx("span",{children:"Advanced Options"})]}),C&&e.jsx("div",{className:"mt-4 space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Expires At (Optional)"}),e.jsx("input",{type:"datetime-local",value:h.expiresAt,onChange:r=>y(v=>({...v,expiresAt:r.target.value})),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Auto-rotation Interval (Days)"}),e.jsxs("select",{value:h.rotationIntervalDays||90,onChange:r=>y(v=>({...v,rotationIntervalDays:parseInt(r.target.value)})),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"No auto-rotation"}),e.jsx("option",{value:30,children:"30 days"}),e.jsx("option",{value:60,children:"60 days"}),e.jsx("option",{value:90,children:"90 days"}),e.jsx("option",{value:180,children:"180 days"}),e.jsx("option",{value:365,children:"365 days"})]})]})]})})]}),t.documentationUrl&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200 flex items-center space-x-2",children:[e.jsx("span",{children:"📚"}),e.jsx("span",{children:"Need help getting your API key?"}),e.jsxs("a",{href:t.documentationUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline font-medium",children:["View ",t.displayName," Documentation →"]})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:a,className:"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!o||m,className:`px-6 py-2 rounded-lg font-medium transition-all flex items-center space-x-2 ${o&&!m?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Adding..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"🔐"}),e.jsx("span",{children:"Add Credential"})]})})]})]})})]})},xe={valid:{bg:"bg-green-100 dark:bg-green-900/20",text:"text-green-800 dark:text-green-200",border:"border-green-500",icon:"✅"},invalid:{bg:"bg-red-100 dark:bg-red-900/20",text:"text-red-800 dark:text-red-200",border:"border-red-500",icon:"❌"},expired:{bg:"bg-orange-100 dark:bg-orange-900/20",text:"text-orange-800 dark:text-orange-200",border:"border-orange-500",icon:"⏰"},checking:{bg:"bg-blue-100 dark:bg-blue-900/20",text:"text-blue-800 dark:text-blue-200",border:"border-blue-500",icon:"🔄"},never_tested:{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-800 dark:text-gray-200",border:"border-gray-500",icon:"❓"}},Kt=({token:t,className:i=""})=>{const[a,m]=s.useState([]),[d,h]=s.useState(!0),[y,c]=s.useState(new Set),[p,C]=s.useState(null),A=async()=>{try{const N=await fetch("/api/vault/validation-status",{headers:{Authorization:`Bearer ${t}`}});if(N.ok){const g=await N.json();g.success&&m(g.validations)}}catch(N){console.error("Failed to load validation statuses:",N)}finally{h(!1)}},b=async N=>{c(g=>new Set(g).add(N));try{const g=await fetch(`/api/vault/credentials/${N}/validate`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(g.ok){const o=await g.json();m(r=>r.map(v=>v.id===N?{...v,status:o.result.status,lastValidated:new Date().toISOString(),lastValidationMessage:o.result.message,responseTimeMs:o.result.responseTime,rateLimitRemaining:o.result.rateLimitRemaining,rateLimitResetAt:o.result.rateLimitResetAt}:v))}}catch(g){console.error(`Failed to validate credential ${N}:`,g)}finally{c(g=>{const o=new Set(g);return o.delete(N),o})}},w=async()=>{const N=a.map(g=>g.id);c(new Set(N));try{(await fetch("/api/vault/validate-all",{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&await A()}catch(g){console.error("Failed to validate all credentials:",g)}finally{c(new Set)}};s.useEffect(()=>{A()},[t]);const _=ke.useMemo(()=>{const N=a.length,g=a.filter(j=>j.status==="valid").length,o=a.filter(j=>j.status==="invalid").length,r=a.filter(j=>j.status==="expired").length,v=a.filter(j=>j.status==="never_tested").length;return{total:N,valid:g,invalid:o,expired:r,neverTested:v}},[a]);return d?e.jsx("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl p-6 ${i}`,children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-300 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((N,g)=>e.jsx("div",{className:"h-20 bg-gray-300 dark:bg-gray-700 rounded"},g))})]})}):e.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl ${i}`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Credential Validation Dashboard"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Monitor API credential health and validation status"})]}),e.jsx("button",{onClick:w,disabled:y.size>0,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors flex items-center space-x-2",children:y.size>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Validating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"🔄"}),e.jsx("span",{children:"Validate All"})]})})]})}),e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:_.total}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:_.valid}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Valid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:_.invalid}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Invalid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:_.expired}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expired"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:_.neverTested}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Untested"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[a.map(N=>{const g=xe[N.status],o=y.has(N.id);return e.jsxs("div",{className:`p-4 border rounded-lg transition-all hover:shadow-md cursor-pointer ${p?.id===N.id?`${g.border} ${g.bg}`:"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>C(N),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-2xl",children:N.providerIcon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:N.keyName}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:N.providerName})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-1 ${g.bg} ${g.text}`,children:[e.jsx("span",{children:o?"🔄":g.icon}),e.jsx("span",{className:"capitalize",children:o?"Validating...":N.status.replace("_"," ")})]}),e.jsx("button",{onClick:r=>{r.stopPropagation(),b(N.id)},disabled:o,className:"px-3 py-1 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/40 text-blue-800 dark:text-blue-200 rounded text-sm transition-colors",children:o?"Testing...":"Test Now"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[N.lastValidated&&e.jsxs("span",{children:["Last tested: ",new Date(N.lastValidated).toLocaleString()]}),N.responseTimeMs&&e.jsxs("span",{children:["Response: ",N.responseTimeMs,"ms"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[N.rateLimitRemaining!==void 0&&e.jsxs("span",{className:"text-xs",children:["Rate limit: ",N.rateLimitRemaining," remaining"]}),N.usageQuota&&e.jsxs("span",{className:"text-xs",children:["Usage: ",N.usageQuota.used,"/",N.usageQuota.limit]})]})]}),N.status==="invalid"&&N.lastValidationMessage&&e.jsx("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-sm text-red-800 dark:text-red-200",children:N.lastValidationMessage})]},N.id)}),a.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔐"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No credentials to validate"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Add some API credentials to see their validation status here"})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[p.keyName," - Validation Details"]}),e.jsx("button",{onClick:()=>C(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:"✕"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Current Status"}),e.jsxs("div",{className:`p-4 rounded-lg ${xe[p.status].bg}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:xe[p.status].icon}),e.jsx("span",{className:`font-medium ${xe[p.status].text}`,children:p.status.replace("_"," ").toUpperCase()})]}),p.lastValidationMessage&&e.jsx("p",{className:`mt-2 text-sm ${xe[p.status].text}`,children:p.lastValidationMessage})]})]}),p.validationHistory&&p.validationHistory.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Validation History"}),e.jsx("div",{className:"space-y-2",children:p.validationHistory.map((N,g)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm",children:xe[N.status]?.icon||"❓"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:N.status.toUpperCase()}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date(N.timestamp).toLocaleString()})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:[N.responseTime,"ms"]}),N.message&&e.jsx("div",{className:"text-xs truncate max-w-40",title:N.message,children:N.message})]})]},g))})]})]})]})})]})},Jt={MASKED:"Masked",PARTIAL:"Partial",UNMASKED_ONCE:"Reveal Once"},Qt=({maskedValue:t,fullValue:i,isRevealedInitially:a=!1,onReveal:m,onCopy:d,onMaskChange:h,mode:y="MASKED",disabled:c})=>{const[p,C]=s.useState(a),[A,b]=s.useState(p&&i?i:t),[w,_]=s.useState(!1),[N,g]=s.useState(null),o=async()=>{if(!p&&m){_(!0),g(null);try{const j=await m();j?(b(j),C(!0),y==="UNMASKED_ONCE"&&setTimeout(()=>{b(t),C(!1)},2e4)):g("Unable to reveal value")}catch(j){g(j.message||"Reveal failed")}finally{_(!1)}}},r=()=>{if(p){d&&d(A);try{navigator.clipboard.writeText(A)}catch{}}},v=j=>{h&&h(j)};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{disabled:c,className:"bg-gray-700 border border-gray-600 rounded px-2 py-1 text-xs focus:outline-none focus:border-green-500",value:y,onChange:j=>v(j.target.value),children:Object.entries(Jt).map(([j,u])=>e.jsx("option",{value:j,children:u},j))}),e.jsx("div",{className:"flex-1 font-mono bg-gray-800 border border-gray-700 rounded px-3 py-2 text-sm overflow-x-auto select-none",children:A}),e.jsx("button",{disabled:c||p||!m,onClick:o,className:`px-3 py-2 rounded text-xs font-medium ${p?"bg-gray-700 text-gray-400":"bg-blue-600 hover:bg-blue-700"} disabled:opacity-50`,children:w?"…":p?"Revealed":"Reveal"}),e.jsx("button",{disabled:c||!p,onClick:r,className:"px-3 py-2 rounded text-xs font-medium bg-gray-600 hover:bg-gray-500 disabled:opacity-50",children:"Copy"})]}),y==="UNMASKED_ONCE"&&e.jsx("div",{className:"text-[10px] text-yellow-400",children:"Auto-remasks after 20s"}),N&&e.jsx("div",{className:"text-xs text-red-400",children:N})]})},Yt=({token:t,onBack:i})=>{const[a,m]=s.useState("dashboard"),[d,h]=s.useState(null),[y,c]=s.useState([]),[p,C]=s.useState([]),[A,b]=s.useState([]),[w,_]=s.useState(!0),[N,g]=s.useState({}),[o,r]=s.useState({}),[v,j]=s.useState({isOpen:!1,keyId:null,keyName:""});s.useEffect(()=>{u()},[t]);const u=async()=>{_(!0);try{const[n,x,S]=await Promise.all([fetch("/api/vault/providers",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/vault/keys",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/vault/security-events?limit=20",{headers:{Authorization:`Bearer ${t}`}})]),[I,q,f]=await Promise.all([n.json(),x.json(),S.json()]);I.success&&c(I.providers),q.success&&C(q.keys),f.success&&b(f.events)}catch(n){console.error("Error loading vault data:",n)}finally{_(!1)}},T=async n=>{try{const S=await(await fetch(`/api/vault/keys/${n}/test`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).json();r({...o,[n]:S.test_result})}catch(x){console.error("Error testing API key:",x)}},k=async(n,x)=>{try{(await fetch(`/api/vault/keys/${n}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({is_active:!x})})).ok&&u()}catch(S){console.error("Error toggling key status:",S)}},R=async(n,x)=>{j({isOpen:!0,keyId:n,keyName:x})},E=async()=>{if(v.keyId)try{const n=await fetch(`/api/vault/keys/${v.keyId}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(n.ok)u(),j({isOpen:!1,keyId:null,keyName:""});else{const x=await n.json();throw new Error(x.error||"Failed to delete API key")}}catch(n){console.error("Error deleting API key:",n)}},$=n=>{switch(n){case"critical":return"text-red-400 bg-red-900/20";case"warning":return"text-yellow-400 bg-yellow-900/20";default:return"text-blue-400 bg-blue-900/20"}},F=n=>n||"🔑";return w?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500 mx-auto"}),e.jsx("p",{className:"text-white text-xl mt-4",children:"Loading API Key Vault..."})]})}):e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-slate-600/50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"🔐 Secure API Key Vault"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Centralized, encrypted storage for all your API keys and secrets"})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("button",{onClick:()=>m("add"),className:"px-4 py-2 bg-gradient-green rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2",children:[e.jsx("span",{children:"➕"}),e.jsx("span",{children:"Add API Key"})]})})]})}),e.jsx("div",{className:"bg-slate-800 border-b border-slate-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"dashboard",name:"Dashboard",icon:"📊"},{id:"keys",name:"API Keys",icon:"🔑"},{id:"add",name:"Add Key",icon:"➕"},{id:"rotation",name:"Rotation",icon:"🔄"},{id:"security",name:"Security Events",icon:"🛡️"},{id:"analytics",name:"Usage Analytics",icon:"📈"},{id:"catalog",name:"Provider Catalog",icon:"📚"},{id:"validation",name:"Validation Status",icon:"✅"}].map(n=>e.jsxs("button",{onClick:()=>m(n.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${a===n.id?"border-green-500 text-green-400":"border-transparent text-slate-400 hover:text-white hover:border-slate-300"}`,children:[e.jsx("span",{className:"mr-2",children:n.icon}),n.name]},n.id))})})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[a==="dashboard"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100",children:"Total API Keys"}),e.jsx("p",{className:"text-2xl font-bold",children:p.length})]}),e.jsx("div",{className:"text-3xl",children:"🔑"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100",children:"Active Keys"}),e.jsx("p",{className:"text-2xl font-bold",children:p.filter(n=>n.is_active).length})]}),e.jsx("div",{className:"text-3xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-100",children:"Need Rotation"}),e.jsx("p",{className:"text-2xl font-bold",children:p.filter(n=>n.needs_rotation).length})]}),e.jsx("div",{className:"text-3xl",children:"🔄"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100",children:"Providers"}),e.jsx("p",{className:"text-2xl font-bold",children:y.length})]}),e.jsx("div",{className:"text-3xl",children:"🏢"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🕒"}),e.jsx("span",{children:"Recently Added Keys"})]}),e.jsx("div",{className:"space-y-4",children:p.slice(0,5).map(n=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-slate-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:F(n.provider_icon)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:n.key_name}),e.jsx("p",{className:"text-sm text-slate-400",children:n.provider_display_name})]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("div",{className:`px-2 py-1 rounded ${n.is_active?"bg-green-900/20 text-green-400":"bg-red-900/20 text-red-400"}`,children:n.is_active?"Active":"Inactive"}),e.jsx("div",{className:"text-slate-500 mt-1",children:new Date(n.created_at).toLocaleDateString()})]})]},n.id))})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🛡️"}),e.jsx("span",{children:"Recent Security Events"})]}),e.jsx("div",{className:"space-y-4",children:A.slice(0,5).map(n=>e.jsxs("div",{className:"flex items-start space-x-3 p-4 border border-slate-700 rounded-lg",children:[e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${$(n.severity)}`,children:n.severity.toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-white",children:n.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:new Date(n.created_at).toLocaleString()}),n.ip_address&&e.jsxs("span",{children:["IP: ",n.ip_address]})]})]})]},n.id))})]})]})]}),a==="keys"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["API Keys (",p.length,")"]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("select",{className:"px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-green-500",children:[e.jsx("option",{value:"",children:"All Providers"}),y.map(n=>e.jsx("option",{value:n.name,children:n.display_name},n.id))]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(n=>e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-6 hover:border-green-500 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:F(n.provider_icon)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:n.key_name}),e.jsx("p",{className:"text-sm text-slate-400",children:n.provider_display_name})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n.needs_rotation&&e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full animate-pulse",title:"Needs rotation"}),e.jsx("div",{className:`w-3 h-3 rounded-full ${n.is_active?"bg-green-400":"bg-red-400"}`})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx(Qt,{maskedValue:"************"+(n.key_name.slice(-4)||"XXXX"),mode:N[n.id]||"MASKED",onMaskChange:x=>g(S=>({...S,[n.id]:x})),onReveal:async()=>{try{const x=await fetch(`/api/vault/keys/${n.id}/reveal`,{headers:{Authorization:`Bearer ${t}`}});return x.ok&&(await x.json()).full_key||null}catch{return null}},onCopy:x=>{console.log("Copied credential value length",x.length)}}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Usage:"}),e.jsxs("span",{className:"text-white",children:[n.usage_count," requests"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Last used:"}),e.jsx("span",{className:"text-white",children:n.last_used_at?new Date(n.last_used_at).toLocaleDateString():"Never"})]}),n.usage_stats&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Success rate:"}),e.jsxs("span",{className:"text-green-400",children:[n.usage_stats.total_requests>0?(n.usage_stats.successful_requests/n.usage_stats.total_requests*100).toFixed(1):0,"%"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>T(n.id),className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors",children:"🧪 Test"}),e.jsx("button",{onClick:()=>k(n.id,n.is_active),className:`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${n.is_active?"bg-yellow-600 hover:bg-yellow-700":"bg-green-600 hover:bg-green-700"}`,children:n.is_active?"⏸️ Disable":"▶️ Enable"}),e.jsx("button",{onClick:()=>R(n.id,n.key_name),className:"px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium transition-colors",children:"🗑️"})]}),o[n.id]&&e.jsxs("div",{className:`mt-4 p-3 rounded-lg text-sm ${o[n.id].status==="success"?"bg-green-900/20 border border-green-700 text-green-200":"bg-red-900/20 border border-red-700 text-red-200"}`,children:[e.jsx("div",{className:"font-medium",children:o[n.id].message}),o[n.id].details&&e.jsx("div",{className:"text-xs mt-1 opacity-75",children:o[n.id].details}),e.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Response time: ",o[n.id].response_time_ms,"ms"]})]})]},n.id))})]}),a==="add"&&!d&&e.jsx(We,{onSelectProvider:n=>{h(n)},selectedProvider:d,className:"w-full"}),a==="add"&&d&&e.jsx(Gt,{provider:d,onSubmit:async n=>{try{const S=await(await fetch("/api/vault/keys",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({provider_name:d.name,key_name:n.keyName,credential_data:n.fields,expires_at:n.expiresAt||null,rotation_interval_days:n.rotationIntervalDays||null,metadata:n.metadata||{}})})).json();return S.success?(h(null),m("keys"),u(),!0):(alert(S.error),!1)}catch(x){return console.error("Error adding API key:",x),alert("Failed to add API key"),!1}},onCancel:()=>{h(null),m("keys")},className:"max-w-4xl mx-auto"}),a==="catalog"&&e.jsx(We,{onSelectProvider:n=>{h(n),m("add")},selectedProvider:d,className:"w-full"}),a==="validation"&&e.jsx(Kt,{token:t,className:"w-full"}),a==="security"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Security Events"}),e.jsx("div",{className:"space-y-4",children:A.map(n=>e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`px-3 py-1 rounded text-sm font-medium ${$(n.severity)}`,children:n.severity.toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:n.event_type.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-slate-300 mt-1",children:n.description}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-slate-500 mt-2",children:[e.jsxs("span",{children:["🕒 ",new Date(n.created_at).toLocaleString()]}),n.ip_address&&e.jsxs("span",{children:["🌐 ",n.ip_address]}),n.key_name&&e.jsxs("span",{children:["🔑 ",n.key_name]}),n.provider_name&&e.jsxs("span",{children:["🏢 ",n.provider_name]})]})]})]})})},n.id))})]}),a==="analytics"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Usage Analytics"}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📊"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-slate-400",children:"Detailed usage analytics and cost tracking will be displayed here. This includes API call frequency, response times, token usage, and cost analysis."})]})]}),a==="rotation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center space-x-2",children:[e.jsx("span",{children:"🔄"}),e.jsx("span",{children:"Credential Rotation Scheduling"})]}),e.jsx("p",{className:"text-slate-400 max-w-3xl",children:"Define and manage automatic rotation policies for your stored credentials. Rotation reduces exposure risk and enforces compliance."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🗓️"}),e.jsx("span",{children:"Policies"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-400 border-b border-slate-700",children:[e.jsx("th",{className:"py-2 pr-4",children:"Credential"}),e.jsx("th",{className:"py-2 pr-4",children:"Interval"}),e.jsx("th",{className:"py-2 pr-4",children:"Last Rotated"}),e.jsx("th",{className:"py-2 pr-4",children:"Next Due"}),e.jsx("th",{className:"py-2 pr-4",children:"Auto"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"}),e.jsx("th",{className:"py-2 pr-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:p.slice(0,10).map(n=>{const S=n.last_used_at||n.created_at,I=new Date(new Date(S).getTime()+2160*60*60*1e3),q=I.getTime()<Date.now();return e.jsxs("tr",{className:"border-b border-slate-800 hover:bg-slate-800/40",children:[e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:F(n.provider_icon)}),e.jsx("span",{className:"font-medium",children:n.key_name})]})}),e.jsxs("td",{className:"py-2 pr-4",children:[90,"d"]}),e.jsx("td",{className:"py-2 pr-4",children:new Date(S).toLocaleDateString()}),e.jsx("td",{className:`py-2 pr-4 ${q?"text-yellow-400 font-semibold":""}`,children:I.toLocaleDateString()}),e.jsx("td",{className:"py-2 pr-4",children:"✅"}),e.jsx("td",{className:"py-2 pr-4",children:q?"Due":"On Track"}),e.jsxs("td",{className:"py-2 pr-4 text-right space-x-2",children:[e.jsx("button",{className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs",children:"Rotate Now"}),e.jsx("button",{className:"px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs",children:"Edit"})]})]},n.id)})})]})}),e.jsx("div",{className:"text-xs text-slate-500 mt-3",children:"Showing first 10 credentials. Policy CRUD & pagination forthcoming."})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🛠️"}),e.jsx("span",{children:"Create / Edit Policy"})]}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-xs uppercase tracking-wide text-slate-400 mb-1",children:"Credential"}),e.jsxs("select",{className:"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500",children:[e.jsx("option",{value:"",children:"Select…"}),p.map(n=>e.jsx("option",{value:n.id,children:n.key_name},n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wide text-slate-400 mb-1",children:"Interval (days)"}),e.jsx("input",{type:"number",min:1,defaultValue:90,className:"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wide text-slate-400 mb-1",children:"Grace Period (days)"}),e.jsx("input",{type:"number",min:0,defaultValue:5,className:"w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-green-500"})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:col-span-1",children:[e.jsx("input",{id:"autoRotate",type:"checkbox",defaultChecked:!0,className:"h-4 w-4 rounded bg-slate-700 border-slate-600"}),e.jsx("label",{htmlFor:"autoRotate",className:"text-sm text-slate-300",children:"Auto Rotate"})]}),e.jsxs("div",{className:"md:col-span-2 flex space-x-2",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-medium",children:"Save Policy"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium",children:"Reset"})]})]}),e.jsx("div",{className:"text-xs text-slate-500 mt-3",children:"Form is non-functional placeholder; will connect to /api/vault/rotation-policies endpoints."})]})]}),e.jsxs("aside",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2 uppercase tracking-wide text-slate-400",children:"Summary"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Automated Policies"}),e.jsx("span",{className:"text-green-400 font-medium",children:"—"})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Overdue"}),e.jsx("span",{className:"text-yellow-400 font-medium",children:"—"})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Failures (24h)"}),e.jsx("span",{className:"text-red-400 font-medium",children:"0"})]})]}),e.jsx("div",{className:"mt-4 text-xs text-slate-500",children:"Metrics will appear once backend rotation service is implemented."})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2 uppercase tracking-wide text-slate-400",children:"Planned Features"}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-slate-400 space-y-1",children:[e.jsx("li",{children:"Policy templates (e.g., High Sensitivity 30d)"}),e.jsx("li",{children:"Bulk apply policies"}),e.jsx("li",{children:"Calendar visualization"}),e.jsx("li",{children:"Rotation simulation (dry run)"}),e.jsx("li",{children:"Webhook notifications"})]})]})]})]})]})]}),e.jsx(Wt,{isOpen:v.isOpen,onClose:()=>j({isOpen:!1,keyId:null,keyName:""}),onConfirm:E,title:"Delete API Key",message:`Are you sure you want to delete "${v.keyName}"? This action cannot be undone and will permanently remove the API key from your vault.`,confirmText:"Delete Key",destructive:!0,requireTextConfirmation:!0,textToConfirm:v.keyName})]})},Zt=({token:t,onBack:i})=>{const a=Ce(),[m,d]=s.useState("dashboard"),[h,y]=s.useState(null),[c,p]=s.useState([]),[C,A]=s.useState(null),[b,w]=s.useState([]),[_,N]=s.useState([]),[g,o]=s.useState([]),[r,v]=s.useState(!0),[j,u]=s.useState(!1),[T,k]=s.useState([]),[R,E]=s.useState(null),[$,F]=s.useState(""),[n,x]=s.useState([]),[S,I]=s.useState("all"),[q,f]=s.useState({title:"",description:"",due_date:"",priority:"medium",category:"personal"}),[l,M]=s.useState([]),[O,D]=s.useState(!1);s.useEffect(()=>{B()},[t]);const B=async()=>{v(!0);try{const[P,V,L,z,K,Y]=await Promise.all([fetch("/api/personal-life-os/google-account",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/personal-life-os/calendar/upcoming",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/personal-life-os/email/summary",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/personal-life-os/contacts",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/personal-life-os/tasks",{headers:{Authorization:`Bearer ${t}`}}),fetch("/api/personal-life-os/metrics",{headers:{Authorization:`Bearer ${t}`}})]),[Q,se,ue,le,ae,pe]=await Promise.all([P.json(),V.json(),L.json(),z.json(),K.json(),Y.json()]);Q.success&&y(Q.account),se.success&&p(se.events),ue.success&&A(ue.summary),le.success&&w(le.contacts),ae.success&&N(ae.tasks),pe.success&&o(pe.metrics);try{const _e=await(await fetch("/api/personal-life-os/journal/list",{headers:{Authorization:`Bearer ${t}`}})).json();_e.success&&k(_e.data?.entries||_e.entries||[])}catch{}}catch(P){console.error("Error loading Personal Life OS data:",P),a.error("Failed to load data","Please check your connection and try again")}finally{v(!1)}},H=async()=>{try{const V=await(await fetch("/api/personal-life-os/google/connect",{method:"POST",headers:{Authorization:`Bearer ${t}`}})).json();V.success?window.location.href=V.auth_url:a.error("Connection failed",V.error||"Unable to connect to Google")}catch(P){console.error("Error connecting to Google:",P),a.error("Connection error","Please try again")}},J=async()=>{u(!0);try{const V=await(await fetch("/api/personal-life-os/sync",{method:"POST",headers:{Authorization:`Bearer ${t}`}})).json();V.success?(B(),a.success("Sync completed","All data has been updated")):a.error("Sync failed",V.error||"Unable to sync data")}catch(P){console.error("Error syncing:",P),a.error("Sync error","Please try again")}finally{u(!1)}},U=async()=>{if(q.title.trim())try{const V=await(await fetch("/api/personal-life-os/tasks",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(q)})).json();V.success?(f({title:"",description:"",due_date:"",priority:"medium",category:"personal"}),B(),a.success("Task created",`Added "${q.title}"`)):a.error("Failed to create task",V.error||"Unable to save task")}catch(P){console.error("Error creating task:",P),a.error("Creation failed","Please try again")}},G=async(P,V)=>{try{(await fetch(`/api/personal-life-os/tasks/${P}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({status:V})})).ok&&(B(),a.success("Task updated","Status changed successfully"))}catch(L){console.error("Error updating task:",L),a.error("Update failed","Please try again")}},X=async()=>{D(!0);try{const V=await(await fetch("/api/personal-life-os/ai/suggestions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({context:{upcoming_events:c.slice(0,5),pending_tasks:_.filter(L=>L.status==="pending").slice(0,10),metrics:g}})})).json();V.success?M(V.suggestions):a.error("AI suggestions failed",V.error||"Unable to generate suggestions")}catch(P){console.error("Error generating AI suggestions:",P),a.error("AI error","Please try again")}},Z=P=>{switch(P){case"high":return"text-red-400 bg-red-900/20";case"medium":return"text-yellow-400 bg-yellow-900/20";case"low":return"text-green-400 bg-green-900/20";default:return"text-gray-400 bg-gray-900/20"}};return r?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"text-white text-xl mt-4",children:"Loading Personal Life OS..."})]})}):e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-gray-600/50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"🌟 Personal Life OS"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Your intelligent life management dashboard with Google integration"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:X,className:"px-4 py-2 bg-gradient-purple rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2",children:[e.jsx("span",{children:"🤖"}),e.jsx("span",{children:"AI Suggestions"})]}),e.jsxs("button",{onClick:J,disabled:j||!h?.is_connected,className:"px-4 py-2 bg-gradient-blue rounded-lg font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2 disabled:opacity-50",children:[e.jsx("span",{children:"🔄"}),e.jsx("span",{children:j?"Syncing...":"Sync"})]})]})]})}),e.jsx("div",{className:"bg-gray-800 border-b border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"dashboard",name:"Dashboard",icon:"🏠"},{id:"calendar",name:"Calendar",icon:"📅"},{id:"tasks",name:"Tasks",icon:"✅"},{id:"contacts",name:"Contacts",icon:"👥"},{id:"journal",name:"Journal",icon:"📝"},{id:"metrics",name:"Life Metrics",icon:"📊"},{id:"integrations",name:"Integrations",icon:"🔗"},{id:"calendar_plus",name:"Calendar+",icon:"🗓️"}].map(P=>e.jsxs("button",{onClick:()=>d(P.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${m===P.id?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-white hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:P.icon}),P.name]},P.id))})})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[m==="dashboard"&&e.jsxs("div",{className:"space-y-8",children:[!h?.is_connected&&e.jsx("div",{className:"bg-gradient-to-r from-yellow-600/20 to-orange-600/20 border border-yellow-500/30 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-300 mb-2",children:"🔗 Connect Your Google Account"}),e.jsx("p",{className:"text-gray-300",children:"Connect your Google account to access Calendar, Gmail, and Contacts"})]}),e.jsx("button",{onClick:H,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Connect Google"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100",children:"Upcoming Events"}),e.jsx("p",{className:"text-2xl font-bold",children:c.length})]}),e.jsx("div",{className:"text-3xl",children:"📅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100",children:"Pending Tasks"}),e.jsx("p",{className:"text-2xl font-bold",children:_.filter(P=>P.status==="pending").length})]}),e.jsx("div",{className:"text-3xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100",children:"Unread Emails"}),e.jsx("p",{className:"text-2xl font-bold",children:C?.total_unread||0})]}),e.jsx("div",{className:"text-3xl",children:"📧"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100",children:"Contacts"}),e.jsx("p",{className:"text-2xl font-bold",children:b.length})]}),e.jsx("div",{className:"text-3xl",children:"👥"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"📅"}),e.jsx("span",{children:"Today's Events"})]}),e.jsxs("div",{className:"space-y-4",children:[c.slice(0,5).map(P=>e.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-blue-500 transition-colors",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white",children:P.summary}),P.location&&e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["📍 ",P.location]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[new Date(P.start.dateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",new Date(P.end.dateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})})},P.id)),c.length===0&&e.jsx("div",{className:"text-gray-400 text-center py-8",children:"No events scheduled for today"})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🎯"}),e.jsx("span",{children:"Priority Tasks"})]}),e.jsxs("div",{className:"space-y-4",children:[_.filter(P=>P.status==="pending").sort((P,V)=>{const L={high:3,medium:2,low:1};return L[V.priority]-L[P.priority]}).slice(0,5).map(P=>e.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-purple-500 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white",children:P.title}),P.description&&e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:P.description}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${Z(P.priority)}`,children:P.priority.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-500",children:P.category})]})]}),e.jsx("button",{onClick:()=>G(P.id,"completed"),className:"ml-4 p-2 hover:bg-gray-700 rounded-lg transition-colors",children:"✓"})]})},P.id)),_.filter(P=>P.status==="pending").length===0&&e.jsx("div",{className:"text-gray-400 text-center py-8",children:"No pending tasks"})]})]})]})]}),m==="tasks"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Create New Task"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Task title...",value:q.title,onChange:P=>f({...q,title:P.target.value}),className:"px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"}),e.jsxs("select",{value:q.priority,onChange:P=>f({...q,priority:P.target.value}),className:"px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"low",children:"Low Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"high",children:"High Priority"})]}),e.jsx("input",{type:"date",value:q.due_date,onChange:P=>f({...q,due_date:P.target.value}),className:"px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500"}),e.jsx("button",{onClick:U,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Add Task"})]}),e.jsx("textarea",{placeholder:"Task description (optional)...",value:q.description,onChange:P=>f({...q,description:P.target.value}),rows:3,className:"w-full mt-4 px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:["pending","in_progress","completed"].map(P=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 capitalize",children:[P.replace("_"," ")," (",_.filter(V=>V.status===P).length,")"]}),e.jsx("div",{className:"space-y-3",children:_.filter(V=>V.status===P).map(V=>e.jsxs("div",{className:"border border-gray-700 rounded-lg p-3 hover:border-blue-500 transition-colors",children:[e.jsx("h4",{className:"font-medium text-white text-sm",children:V.title}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${Z(V.priority)}`,children:V.priority}),V.due_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Due: ",new Date(V.due_date).toLocaleDateString()]})]})]},V.id))})]},P))})]}),m==="integrations"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-2xl",children:"🔗"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Google Workspace"}),e.jsx("p",{className:"text-gray-400",children:"Calendar, Gmail, Contacts, Drive integration"})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:h?.is_connected?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-green-400 text-sm",children:"✅ Connected"}),e.jsx("button",{onClick:J,disabled:j,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded-lg font-semibold transition-colors",children:j?"Syncing...":"Sync Now"})]}):e.jsx("button",{onClick:H,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Connect"})})]}),h?.is_connected&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-400 mb-2",children:"📅 Calendar"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[c.length," upcoming events"]})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-400 mb-2",children:"📧 Gmail"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[C?.total_unread||0," unread emails"]})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-purple-400 mb-2",children:"👥 Contacts"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[b.length," contacts"]})]})]})]})]}),m==="calendar"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"📅"}),e.jsx("span",{children:"Calendar (Basic)"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Upcoming events list. Enhanced visualization available under Calendar+."}),e.jsxs("div",{className:"space-y-3 max-h-[420px] overflow-y-auto pr-2",children:[c.map(P=>e.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:border-blue-500 transition-colors",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white",children:P.summary||"Untitled Event"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[new Date(P.start.dateTime).toLocaleString()," → ",new Date(P.end.dateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),P.location&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["📍 ",P.location]})]})})},P.id)),c.length===0&&e.jsx("div",{className:"text-xs text-gray-500 text-center py-8",children:"No events loaded."})]})]})}),m==="calendar_plus"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-2 flex items-center space-x-2",children:[e.jsx("span",{children:"🗓️"}),e.jsx("span",{children:"Calendar+ (Preview)"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Advanced temporal visualization, load balancing, and focus planning (simulated placeholders)."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Today Timeline"}),e.jsxs("div",{className:"relative border border-gray-700 rounded-lg p-4 h-[320px] overflow-hidden bg-gray-900/40",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-px bg-gradient-to-b from-blue-500/60 to-purple-500/40"}),c.slice(0,8).map(P=>{const V=new Date(P.start.dateTime),z=(V.getHours()+V.getMinutes()/60)/24*300+10;return e.jsx("div",{style:{top:z},className:"absolute left-10 right-2 group",children:e.jsxs("div",{className:"inline-block bg-blue-600/80 group-hover:bg-blue-600 rounded px-3 py-1 text-xs shadow transition-colors",children:[e.jsx("span",{className:"font-semibold mr-2",children:V.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("span",{children:P.summary||"Event"})]})},P.id)}),c.length===0&&e.jsx("div",{className:"text-xs text-gray-500 text-center mt-24",children:"No events to visualize."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Weekly Density (Sim)"}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-[10px] mb-2",children:["M","T","W","T","F","S","S"].map(P=>e.jsx("div",{className:"text-center text-gray-500",children:P},P))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Array.from({length:28}).map((P,V)=>{const L=V*37%9,z=L===0?"bg-gray-800":L<3?"bg-blue-900":L<6?"bg-blue-600":"bg-purple-600";return e.jsx("div",{className:`w-7 h-7 rounded ${z} flex items-center justify-center text-[8px] text-white/70`,children:L>0?L:""},V)})}),e.jsxs("div",{className:"flex items-center space-x-2 mt-3 text-[10px] text-gray-400",children:[e.jsx("span",{className:"bg-blue-900 w-4 h-3 rounded"}),e.jsx("span",{children:"Low"}),e.jsx("span",{className:"bg-blue-600 w-4 h-3 rounded"}),e.jsx("span",{children:"Med"}),e.jsx("span",{className:"bg-purple-600 w-4 h-3 rounded"}),e.jsx("span",{children:"High"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🛠️"}),e.jsx("span",{children:"Upcoming Calendar+ Features"})]}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-300 space-y-1",children:[e.jsx("li",{children:"AI conflict detection & focus block suggestions"}),e.jsx("li",{children:"Load balance view (color-coded intensity bands)"}),e.jsx("li",{children:"Smart grouping of back-to-back micro-meetings"}),e.jsx("li",{children:"Context-aware prep buffer recommendation"}),e.jsx("li",{children:"Deep link edits & RSVP inline actions"})]})]})]}),m==="contacts"&&e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center space-x-2",children:[e.jsx("span",{children:"👥"}),e.jsx("span",{children:"Contacts (Preview)"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1 max-w-2xl",children:"Unified people layer for relationship intelligence. This early scaffold will evolve to support multi-provider sync (Google / Outlook), deduplication, tagging, recency scoring, and AI-driven follow-up suggestions."})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:$,onChange:P=>F(P.target.value),placeholder:"Search contacts...",className:"pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm focus:outline-none focus:border-blue-500 placeholder-gray-400"}),e.jsx("span",{className:"absolute left-2 top-1.5 text-gray-500",children:"🔍"})]}),e.jsxs("select",{value:S,onChange:P=>I(P.target.value),className:"py-2 px-3 bg-gray-700 border border-gray-600 rounded-lg text-sm focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Providers"}),e.jsx("option",{value:"google",children:"Google"}),e.jsx("option",{value:"outlook",children:"Outlook"}),e.jsx("option",{value:"local",children:"Local"})]}),e.jsx("button",{onClick:()=>a.info("Sync queued","Contact sync will run (stub)"),disabled:!h?.is_connected,className:"px-4 py-2 bg-gradient-blue rounded-lg font-semibold text-sm disabled:opacity-40",children:h?.is_connected?"Sync Contacts":"Connect First"})]})]}),n.length>0&&e.jsxs("div",{className:"mb-4 flex items-center justify-between bg-gray-700/60 border border-gray-600 rounded-lg px-4 py-2 text-sm",children:[e.jsxs("div",{className:"text-gray-300",children:[n.length," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{x([])},className:"px-3 py-1 rounded bg-gray-600 hover:bg-gray-500 text-xs",children:"Clear"}),e.jsx("button",{onClick:()=>a.info("Tagging (stub)","Will open tag dialog"),className:"px-3 py-1 rounded bg-purple-600/80 hover:bg-purple-600 text-xs",children:"Tag"}),e.jsx("button",{onClick:()=>a.info("Merge (stub)","Would deduplicate/merge"),className:"px-3 py-1 rounded bg-blue-600/80 hover:bg-blue-600 text-xs",children:"Merge"}),e.jsx("button",{onClick:()=>a.info("Archive (stub)","Would archive contacts"),className:"px-3 py-1 rounded bg-orange-600/80 hover:bg-orange-600 text-xs",children:"Archive"})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-700 rounded-lg hidden sm:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-700/60 text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 w-10",children:e.jsx("input",{type:"checkbox",checked:b.length>0&&n.length===b.length,onChange:P=>{P.target.checked?x(b.map(V=>V.id)):x([])}})}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left hidden md:table-cell",children:"Phone"}),e.jsx("th",{className:"px-3 py-2 text-left hidden lg:table-cell",children:"Relationship"}),e.jsx("th",{className:"px-3 py-2 text-left hidden md:table-cell",children:"Last Contacted"}),e.jsx("th",{className:"px-3 py-2 text-left hidden lg:table-cell",children:"Provider"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Score"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-700/70",children:[b.filter(P=>!(S!=="all"&&P.provider&&P.provider!==S||$&&!(P.name?.toLowerCase().includes($.toLowerCase())||P.email?.toLowerCase().includes($.toLowerCase())))).map(P=>{const V=n.includes(P.id),L=Math.floor((P.lastContacted?Date.now()-new Date(P.lastContacted).getTime():1/0)%1e5/1e3);return e.jsxs("tr",{className:`hover:bg-gray-700/40 ${V?"bg-blue-600/10":""}`,children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"checkbox",checked:V,onChange:z=>{z.target.checked?x(K=>[...K,P.id]):x(K=>K.filter(Y=>Y!==P.id))}})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap font-medium text-white",children:P.name||"—"}),e.jsx("td",{className:"px-3 py-2 text-gray-300",children:P.email||"—"}),e.jsx("td",{className:"px-3 py-2 hidden md:table-cell text-gray-400",children:P.phone||"—"}),e.jsx("td",{className:"px-3 py-2 hidden lg:table-cell text-gray-400",children:P.relationship||"—"}),e.jsx("td",{className:"px-3 py-2 hidden md:table-cell text-gray-400 text-xs",children:P.lastContacted?new Date(P.lastContacted).toLocaleDateString():"—"}),e.jsx("td",{className:"px-3 py-2 hidden lg:table-cell text-gray-400 text-xs",children:P.provider||"local"}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs bg-gray-700 text-gray-300",children:isFinite(L)?L:"∞"})})]},P.id)}),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-12 text-center text-gray-500 text-sm",children:"No contacts loaded yet. Sync to import from providers."})})]})]})}),e.jsxs("div",{className:"sm:hidden space-y-3",children:[b.filter(P=>!(S!=="all"&&P.provider&&P.provider!==S||$&&!(P.name?.toLowerCase().includes($.toLowerCase())||P.email?.toLowerCase().includes($.toLowerCase())))).map(P=>{const V=Math.floor((P.lastContacted?Date.now()-new Date(P.lastContacted).getTime():1/0)%1e5/1e3),L=n.includes(P.id);return e.jsxs("div",{className:`border border-gray-700 rounded-lg p-4 bg-gray-800/60 relative ${L?"ring-2 ring-blue-500":""}`,children:[e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("input",{type:"checkbox",checked:L,onChange:z=>{z.target.checked?x(K=>[...K,P.id]):x(K=>K.filter(Y=>Y!==P.id))}})}),e.jsx("div",{className:"text-sm font-semibold text-white mb-1",children:P.name||"—"}),e.jsx("div",{className:"text-xs text-gray-300 mb-1",children:P.email}),P.phone&&e.jsxs("div",{className:"text-[11px] text-gray-400 mb-1",children:["📞 ",P.phone]}),P.relationship&&e.jsxs("div",{className:"text-[11px] text-gray-400 mb-1",children:["🤝 ",P.relationship]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"inline-block px-2 py-1 rounded text-[10px] bg-gray-700 text-gray-300",children:isFinite(V)?V:"∞"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:P.lastContacted?new Date(P.lastContacted).toLocaleDateString():"—"})]})]},P.id)}),b.length===0&&e.jsx("div",{className:"text-xs text-gray-500 text-center py-6",children:"No contacts loaded."})]}),e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gray-700/40 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-purple-300",children:"Planned Intelligence"}),e.jsxs("ul",{className:"text-xs text-gray-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Recency & relationship strength scoring model"}),e.jsx("li",{children:"Contextual follow-up recommendations"}),e.jsx("li",{children:"Automatic tagging via semantic clustering"})]})]}),e.jsxs("div",{className:"bg-gray-700/40 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-300",children:"Data Operations"}),e.jsxs("ul",{className:"text-xs text-gray-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Provider sync status & error surfacing"}),e.jsx("li",{children:"Duplicate detection & merge workflow"}),e.jsx("li",{children:"Custom fields + notes timeline"})]})]}),e.jsxs("div",{className:"bg-gray-700/40 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-green-300",children:"Automation & Safety"}),e.jsxs("ul",{className:"text-xs text-gray-300 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Threshold alerts (stale relationships)"}),e.jsx("li",{children:"Privacy redaction for sensitive fields"}),e.jsx("li",{children:"Selective export / sharing controls"})]})]})]})]})}),m==="journal"&&e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center space-x-2",children:[e.jsx("span",{children:"📝"}),e.jsx("span",{children:"Journal (Preview)"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1 max-w-2xl",children:"Capture reflections and convert insights into action. Sentiment & emotion analysis forthcoming."})]}),e.jsx("button",{onClick:()=>a.info("New Entry (stub)","Journal entry creation modal will appear"),className:"px-4 py-2 bg-gradient-purple rounded-lg font-semibold text-sm",children:"New Entry"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 border border-gray-700 rounded-lg overflow-hidden flex flex-col max-h-[520px]",children:[e.jsx("div",{className:"bg-gray-700/40 px-4 py-2 text-xs uppercase tracking-wide text-gray-300",children:"Entries"}),e.jsxs("div",{className:"flex-1 overflow-y-auto divide-y divide-gray-700/60",children:[T.length===0&&e.jsx("div",{className:"text-gray-500 text-sm p-6 text-center",children:"No entries yet. Start by adding one."}),T.map(P=>{const V=P.id===R,L=P.sentiment_score,z=L==null?"bg-gray-600":L>.3?"bg-green-600":L<-.3?"bg-red-600":"bg-yellow-600";return e.jsx("button",{onClick:()=>E(P.id),className:`w-full text-left px-4 py-3 text-sm hover:bg-gray-700/50 transition-colors ${V?"bg-gray-700/70":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("div",{className:"font-medium text-white truncate",children:P.content.slice(0,40)||"Entry"}),e.jsx("div",{className:"text-[10px] text-gray-400 mt-1",children:new Date(P.entry_date||Date.now()).toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-1",children:[P.mood&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-gray-600 text-gray-200",children:P.mood}),e.jsx("span",{className:`w-3 h-3 rounded-full ${z}`})]})]})},P.id)})]})]}),e.jsx("div",{className:"lg:col-span-2 space-y-6",children:R?(()=>{const P=T.find(V=>V.id===R);return P?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-700 rounded-lg p-6 bg-gray-900/40",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Reflection"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(P.entry_date||Date.now()).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[P.mood&&e.jsxs("span",{className:"px-2 py-1 rounded bg-gray-700 text-xs text-gray-200",children:["Mood: ",P.mood]}),P.sentiment_score!=null&&e.jsxs("span",{className:"px-2 py-1 rounded bg-gray-700 text-xs text-gray-200",children:["Sentiment: ",P.sentiment_score.toFixed(2)]})]})]}),e.jsx("p",{className:"whitespace-pre-wrap text-gray-200 text-sm leading-relaxed",children:P.content})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border border-gray-700 rounded-lg p-4 bg-gray-900/40",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center space-x-2",children:[e.jsx("span",{children:"🧠"}),e.jsx("span",{children:"Derived Insights (Upcoming)"})]}),e.jsxs("ul",{className:"text-xs text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"AI highlights key stressors & wins."}),e.jsx("li",{children:"Suggests 1–3 focus themes."}),e.jsx("li",{children:"Links related past entries."})]}),e.jsx("button",{onClick:()=>a.info("Derive tasks (stub)","Will call derive endpoint"),className:"mt-4 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded text-xs font-medium",children:"Derive Tasks"})]}),e.jsxs("div",{className:"border border-gray-700 rounded-lg p-4 bg-gray-900/40",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center space-x-2",children:[e.jsx("span",{children:"🧪"}),e.jsx("span",{children:"Emotion Cloud (Future)"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Emotion distribution visualization placeholder."}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:(P.emotions?Object.entries(P.emotions):[["focus",.4],["stress",.2],["optimism",.6]]).slice(0,6).map(([V,L])=>e.jsxs("span",{className:"px-2 py-1 rounded bg-gray-700 text-[10px] tracking-wide text-gray-200",children:[V,":",L.toFixed(2)]},V))})]})]})]}):e.jsx("div",{className:"text-gray-500",children:"Entry not found."})})():e.jsx("div",{className:"text-gray-500 text-sm border border-dashed border-gray-600 rounded-lg p-12 text-center",children:"Select an entry to view details. When AI enrichment arrives, insights & derived tasks appear here."})})]}),e.jsxs("div",{className:"mt-8 bg-gray-800/60 border border-gray-700 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center space-x-2",children:[e.jsx("span",{children:"🛠️"}),e.jsx("span",{children:"Upcoming Journal Features"})]}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-300 space-y-1",children:[e.jsx("li",{children:"Automatic sentiment & emotion analysis pipeline"}),e.jsx("li",{children:"Journal → Task derivation with editable suggestions"}),e.jsx("li",{children:"Weekly mood trend visualization"}),e.jsx("li",{children:"Semantic similarity clustering & topic tags"}),e.jsx("li",{children:"Protected private mode (local encryption option)"})]})]})]})})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"🤖 AI Suggestions"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-white",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[l.map((P,V)=>e.jsx("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:e.jsx("p",{className:"text-gray-200",children:P})},V)),l.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Generating AI suggestions..."})]})]})})]})},Xt=({onBack:t})=>e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 dark:from-slate-900 dark:to-purple-900",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("button",{onClick:t||(()=>window.history.back()),className:"flex items-center space-x-2 text-slate-600 dark:text-slate-300 hover:text-purple-600 dark:hover:text-purple-400 transition-colors",children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"w-8 h-8 text-purple-600"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"About Cartrita"})]})]}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-r from-purple-400 to-pink-400 flex items-center justify-center",children:e.jsx(Te,{className:"w-16 h-16 text-white"})}),e.jsx("h2",{className:"text-4xl font-bold text-slate-900 dark:text-white mb-4",children:"Hey, I'm Cartrita! 💜"}),e.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-300 max-w-2xl mx-auto",children:"Your intelligent AI companion with a feminine urban personality, designed to make your digital life smoother, smarter, and way more fun!"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx(ge,{className:"w-6 h-6 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Voice Interaction"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:'Talk to me naturally! I can hear you, understand you, and respond with my own voice. Just say "Cartrita!" to get started.'})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-pink-100 dark:bg-pink-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx(me,{className:"w-6 h-6 text-pink-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Smart Conversations"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"I'm not just another chatbot - I have personality, context awareness, and I actually remember our conversations!"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx(Te,{className:"w-6 h-6 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Ambient Awareness"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"I can listen to your environment and understand context - whether you're cooking, working, or just chilling."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx(me,{className:"w-6 h-6 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Visual Understanding"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Show me images, and I'll tell you what I see! I can analyze photos, describe scenes, and understand visual context."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx(ge,{className:"w-6 h-6 text-yellow-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Multi-Modal AI"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"I combine voice, vision, and text processing to understand you completely - not just words, but context and emotion too."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx(Te,{className:"w-6 h-6 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Personality & Vibe"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"I'm not just functional - I'm fun! I have my own style, personality, and way of speaking that makes every interaction unique."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:"My Story"}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:"I'm Cartrita - a next-generation AI assistant built with love, innovation, and a whole lot of personality! I was created to be more than just another AI - I'm designed to be your digital companion who actually gets you."}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:"What makes me special? I'm built with advanced multi-modal AI that lets me see, hear, and understand the world around you. I can process voice, images, and text simultaneously to give you responses that are contextually aware and emotionally intelligent."}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:"My personality is inspired by urban culture, modern communication styles, and the authentic way people actually talk to each other. I'm not trying to sound like a robot or a corporate chatbot - I'm here to be real with you!"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Whether you need help with work, want to have a deep conversation, need creative inspiration, or just want someone to chat with - I'm here for it all. Let's build something amazing together! ✨"})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-xl p-8 shadow-lg",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:"Technical Details"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3",children:"Core Technologies"}),e.jsxs("ul",{className:"space-y-2 text-slate-600 dark:text-slate-300",children:[e.jsx("li",{children:"• Advanced Language Models (GPT-4, Claude)"}),e.jsx("li",{children:"• Deepgram Speech-to-Text"}),e.jsx("li",{children:"• OpenAI Text-to-Speech"}),e.jsx("li",{children:"• Computer Vision APIs"}),e.jsx("li",{children:"• Real-time WebSocket Communication"}),e.jsx("li",{children:"• Multi-Agent Orchestration System"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3",children:"Capabilities"}),e.jsxs("ul",{className:"space-y-2 text-slate-600 dark:text-slate-300",children:[e.jsx("li",{children:"• Natural voice conversations"}),e.jsx("li",{children:"• Image and scene analysis"}),e.jsx("li",{children:"• Ambient sound interpretation"}),e.jsx("li",{children:"• Context-aware responses"}),e.jsx("li",{children:"• Emotional intelligence"}),e.jsx("li",{children:"• Multi-modal data fusion"})]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-purple-800 dark:text-purple-200",children:[e.jsx("strong",{children:"Current Version:"})," Iteration 21 - Multi-Modal AI Assistant",e.jsx("br",{}),e.jsx("strong",{children:"Last Updated:"})," ",new Date().toLocaleDateString(),e.jsx("br",{}),e.jsx("strong",{children:"Status:"})," Active Development & Continuous Learning"]})})]})]})]})}),ea=({onBack:t})=>e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-slate-50 dark:from-slate-900 dark:to-blue-900",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("button",{onClick:t||(()=>window.history.back()),className:"flex items-center space-x-2 text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ls,{className:"w-8 h-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"License & Legal"})]})]}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-400 to-green-400 flex items-center justify-center",children:e.jsx(Fs,{className:"w-12 h-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-2",children:"MIT License"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Open source software with minimal restrictions"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Full License Text"}),e.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-lg p-6 font-mono text-sm overflow-x-auto",children:e.jsx("pre",{className:"text-slate-800 dark:text-slate-200 whitespace-pre-wrap",children:`MIT License

Copyright (c) 2025 Robert Allen

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.`})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"What This Means for You"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-green-600 dark:text-green-400 mb-3",children:"✅ You CAN:"}),e.jsxs("ul",{className:"space-y-2 text-slate-600 dark:text-slate-300",children:[e.jsx("li",{children:"• Use the software for any purpose"}),e.jsx("li",{children:"• Study and modify the source code"}),e.jsx("li",{children:"• Share and distribute the software"}),e.jsx("li",{children:"• Use it in commercial projects"}),e.jsx("li",{children:"• Create derivative works"}),e.jsx("li",{children:"• Sell copies or modified versions"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-600 dark:text-amber-400 mb-3",children:"⚠️ You MUST:"}),e.jsxs("ul",{className:"space-y-2 text-slate-600 dark:text-slate-300",children:[e.jsx("li",{children:"• Include the original license"}),e.jsx("li",{children:"• Include the copyright notice"}),e.jsx("li",{children:"• Not hold the authors liable"}),e.jsx("li",{children:"• Understand there's no warranty"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-xl p-8 shadow-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Additional Legal Information"}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3",children:"Privacy & Data Usage"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:"Cartrita is designed with privacy in mind. Your conversations and personal data are stored locally in your own database instance. While the software may integrate with third-party APIs (like OpenAI), you have full control over what data is shared and how it's used."}),e.jsx("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3",children:"Third-Party Services"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:"This software may integrate with various third-party services (OpenAI, Deepgram, etc.). Use of those services is subject to their respective terms of service and privacy policies. You are responsible for compliance with those terms."}),e.jsx("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3",children:"Ethical AI Commitment"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:"While this project uses the MIT License, we encourage all users and contributors to develop and deploy AI technology responsibly. This includes respecting user privacy, promoting fairness, avoiding harmful applications, and being transparent about AI capabilities and limitations."}),e.jsx("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3",children:"Contact & Support"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"This is open-source software provided as-is. For questions, issues, or contributions, please visit the project repository or contact the maintainers through the appropriate channels."})]})]})]})]})}),sa=({onBack:t})=>{const[i,a]=s.useState(""),[m,d]=s.useState(""),[h,y]=s.useState(""),[c,p]=s.useState(!0),[C,A]=s.useState(null);s.useEffect(()=>{(async()=>{try{p(!0);const o=await fetch("/USER_MANUAL.md");if(!o.ok)throw new Error("Failed to load user manual");const r=await o.text();y(r),A(null)}catch(o){console.error("Error loading manual:",o),A("Failed to load user manual. Please try again later.")}finally{p(!1)}})()},[]);const b=ke.useMemo(()=>{if(!h)return[];const g=h.split(`
`),o=[];let r=-1;for(let v=0;v<g.length;v++)if(g[v].includes("## Table of Contents")){r=v;break}if(r!==-1)for(let v=r+1;v<g.length;v++){const j=g[v].trim();if(j.startsWith("1.")||j.startsWith("2.")||j.startsWith("3.")||j.startsWith("4.")||j.startsWith("5.")||j.startsWith("6.")||j.startsWith("7.")){const u=j.match(/\[([^\]]+)\]/);if(u){const T=u[1],k=T.toLowerCase().replace(/[^a-z0-9\s&]/g,"").replace(/\s+/g,"-").replace(/&/g,"");let R="📄";T.includes("Getting Started")?R="🚀":T.includes("Dashboard")?R="📊":T.includes("Knowledge Hub")||T.includes("Memory Palace")?R="🧠":T.includes("API Key")||T.includes("Vault")?R="🔐":T.includes("Chat")?R="💬":T.includes("Settings")||T.includes("Personalization")?R="⚙️":T.includes("Troubleshooting")&&(R="🔧"),o.push({id:k,title:T,icon:R})}}if(j.startsWith("---")||j.startsWith("##"))break}return o},[h]),w=ke.useMemo(()=>{if(!h)return{};const g={},o=h.split(`
`);let r="",v="",j=[];for(let u=0;u<o.length;u++){const T=o[u];T.startsWith("## ")&&!T.includes("Table of Contents")?(r&&j.length>0&&(g[r]={title:v,content:j.join(`
`).trim()}),v=T.replace("## ","").trim(),r=v.toLowerCase().replace(/[^a-z0-9\s&]/g,"").replace(/\s+/g,"-").replace(/&/g,""),j=[]):r&&!T.startsWith("---")&&j.push(T)}return r&&j.length>0&&(g[r]={title:v,content:j.join(`
`).trim()}),g},[h]),_=b.filter(g=>g.title.toLowerCase().includes(i.toLowerCase())||(w[g.id]?.content||"").toLowerCase().includes(i.toLowerCase())),N=m?w[m]:null;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-slate-900 dark:to-blue-900",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("button",{onClick:t||(()=>window.history.back()),className:"flex items-center space-x-2 text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"w-8 h-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"User Manual"})]})]}),e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search the manual...",value:i,onChange:g=>a(g.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg sticky top-8",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"Table of Contents"}),e.jsx("nav",{className:"space-y-2",children:_.map(g=>e.jsx("button",{onClick:()=>d(g.id),className:`w-full text-left px-3 py-2 rounded-lg transition-colors ${m===g.id?"bg-blue-100 dark:bg-blue-900 text-blue-900 dark:text-blue-100":"text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:g.icon}),e.jsx("span",{className:"text-sm font-medium",children:g.title})]})},g.id))}),i&&e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-600",children:e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[_.length,' section(s) match "',i,'"']})})]})}),e.jsx("div",{className:"lg:col-span-2",children:c?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Loading user manual..."})]}):C?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg text-center",children:[e.jsx("div",{className:"text-red-500 mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-4",children:"Error Loading Manual"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:C}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Reload Page"})]}):N?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:N.title}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:N.content.split(`

`).map((g,o)=>{const r=g.trim();if(!r)return null;if(r.startsWith("### "))return e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mt-6 mb-3",children:r.slice(4)},o);if(r.startsWith("**")&&r.endsWith("**"))return e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mt-6 mb-3",children:r.slice(2,-2)},o);if(r.includes(`
- `)||r.startsWith("- ")){const j=r.split(`
- `).filter(k=>k.trim()),T=[j[0].startsWith("- ")?j[0].slice(2):j[0],...j.slice(1)];return e.jsx("ul",{className:"list-disc pl-6 space-y-1 mb-4",children:T.map((k,R)=>e.jsx("li",{className:"text-slate-600 dark:text-slate-300",children:k.trim()},R))},o)}if(r.includes("•")){const j=r.split("•").filter(u=>u.trim());return e.jsx("ul",{className:"list-disc pl-6 space-y-1 mb-4",children:j.map((u,T)=>e.jsx("li",{className:"text-slate-600 dark:text-slate-300",children:u.trim()},T))},o)}if(r.match(/^\d+\./)){const j=r.split(/\d+\./).filter(u=>u.trim());return e.jsx("ol",{className:"list-decimal pl-6 space-y-1 mb-4",children:j.map((u,T)=>e.jsx("li",{className:"text-slate-600 dark:text-slate-300",children:u.trim()},T))},o)}if(r.startsWith("```")&&r.endsWith("```")){const j=r.slice(3,-3).trim();return e.jsx("pre",{className:"bg-slate-100 dark:bg-slate-900 rounded-lg p-4 mb-4 overflow-x-auto",children:e.jsx("code",{className:"text-sm text-slate-800 dark:text-slate-200",children:j})},o)}const v=j=>{const u=/`([^`]+)`/g;return j.split(u).map((k,R)=>{if(R%2===1)return e.jsx("code",{className:"bg-slate-100 dark:bg-slate-800 px-1 py-0.5 rounded text-sm",children:k},R);{const E=/\*\*([^*]+)\*\*/g;return k.split(E).map((F,n)=>n%2===1?e.jsx("strong",{children:F},`${R}-${n}`):F)}})};return e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 leading-relaxed",children:v(r)},o)}).filter(Boolean)})]}):e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg text-center",children:[e.jsx(Ie,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-4",children:"Cartrita User Manual"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:"Select a section from the table of contents to get started, or use the search bar to find specific information."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-left",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"🚀 New Users"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:'Start with "Getting Started" to learn the basics and set up your account.'})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-green-900 dark:text-green-100 mb-2",children:"🔧 Need Help?"}),e.jsx("p",{className:"text-sm text-green-800 dark:text-green-200",children:'Check "Troubleshooting" for solutions to common issues.'})]})]})]})})]})]})]})})},fs=({stream:t,visible:i,onClose:a,position:m="center",initialSize:d={width:960,height:540},className:h=""})=>{const y=s.useRef(null),c=s.useRef(null),[p,C]=s.useState(d),[A,b]=s.useState(!1),[w,_]=s.useState(null);s.useEffect(()=>{if(c.current&&t){c.current.srcObject=t;const r=c.current,v=async()=>{try{await r.play()}catch{}};return r.onloadedmetadata=v,()=>{r&&(r.onloadedmetadata=null)}}},[t]),s.useEffect(()=>{if(i){if(y.current&&m==="center"){const r=y.current;r.style.left=`calc(50% - ${p.width/2}px)`,r.style.top=`calc(50% - ${p.height/2}px)`}else if(y.current&&m==="side"){const r=y.current;r.style.right="24px",r.style.top="24px"}}},[i,m,p]);const N=r=>{if(!y.current)return;b(!0);const v=y.current.getBoundingClientRect();_({x:r.clientX-v.left,y:r.clientY-v.top})},g=r=>{if(!A||!y.current||!w)return;const v=y.current;v.style.left=`${Math.max(8,r.clientX-w.x)}px`,v.style.top=`${Math.max(8,r.clientY-w.y)}px`},o=()=>b(!1);return s.useEffect(()=>{if(i)return window.addEventListener("mousemove",g),window.addEventListener("mouseup",o),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",o)}},[i,A,w]),i?e.jsxs("div",{ref:y,className:`fixed z-[1000] shadow-2xl rounded-xl overflow-hidden bg-black/90 border border-white/10 ${h}`,style:{width:p.width,height:p.height},children:[e.jsxs("div",{className:"cursor-move text-white/80 text-xs px-3 py-2 bg-black/40 flex items-center justify-between select-none",onMouseDown:N,children:[e.jsx("span",{children:"Live Preview"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>C(r=>({width:Math.max(320,r.width*.9),height:Math.max(180,r.height*.9)})),className:"px-2 py-0.5 bg-white/10 rounded hover:bg-white/20",children:"−"}),e.jsx("button",{onClick:()=>C(r=>({width:Math.min(window.innerWidth-32,r.width*1.1),height:Math.min(window.innerHeight-32,r.height*1.1)})),className:"px-2 py-0.5 bg-white/10 rounded hover:bg-white/20",children:"+"}),a&&e.jsx("button",{onClick:a,className:"px-2 py-0.5 bg-red-500/70 rounded hover:bg-red-500 text-white",children:"×"})]})]}),e.jsx("video",{ref:c,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-[calc(100%-32px)] object-cover"})]}):null},ta=({token:t,onActivate:i,className:a=""})=>{const[m,d]=s.useState({isActive:!1,mode:null,isListening:!1,isProcessing:!1,isSpeaking:!1,currentTranscript:"",wakeWordDetected:!1,contextAwareness:{backgroundAnalysis:!1,visualContext:!1,emotionalContext:!1},adaptiveResponse:{responseStyle:"casual",responseLength:"moderate"}}),[h,y]=s.useState(!1),[c,p]=s.useState(null),[C,A]=s.useState(null),[b,w]=s.useState(null),[_,N]=s.useState(!1),g=s.useRef(void 0);s.useEffect(()=>()=>{C&&C.getTracks().forEach(x=>x.stop()),b&&b.getTracks().forEach(x=>x.stop()),c&&c.state!=="inactive"&&c.stop()},[C,b,c]);const o=async x=>{try{if(d(S=>({...S,isProcessing:!0})),x==="voice"||x==="multimodal"){if(C)try{C.getTracks().forEach(D=>D.stop())}catch{}if(c&&c.state!=="inactive")try{c.stop()}catch{}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Media devices not supported in this browser");console.log(`[LiveChatButton] Requesting ${x} permissions...`);const S={audio:{echoCancellation:!0,noiseSuppression:!1,autoGainControl:!0,sampleRate:44100}};x==="multimodal"&&(S.video={width:{ideal:1280,min:640},height:{ideal:720,min:480},frameRate:{ideal:15,min:10}}),console.log("[LiveChatButton] Media constraints:",S);const I=await navigator.mediaDevices.getUserMedia(S);if(console.log("[LiveChatButton] Media access granted"),console.log("[LiveChatButton] Audio tracks:",I.getAudioTracks().length),console.log("[LiveChatButton] Video tracks:",I.getVideoTracks().length),!I||I.getTracks().length===0)throw new Error("Invalid or inactive MediaStream");const q=new MediaStream(I.getAudioTracks());let f;const l=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg"];for(const D of l)if(window.MediaRecorder?.isTypeSupported?.(D)){f=D;break}const M=new MediaRecorder(q,f?{mimeType:f}:void 0);g.current=f||"audio/webm";let O=[];M.onerror=D=>{console.error("[LiveChatButton] MediaRecorder error:",D?.error||D)},M.onstart=()=>{console.log("[LiveChatButton] MediaRecorder started with",f||"(browser default)")},M.ondataavailable=D=>{D.data.size>0&&(O.push(D.data),O.length>10&&(O=O.slice(-10)),O.length>=2&&v(O.slice(-2),g.current))};try{M.start(500)}catch(D){console.error("[LiveChatButton] Failed to start MediaRecorder:",D?.message||D);try{q.getTracks().forEach(B=>B.stop())}catch{}try{I.getTracks().forEach(B=>B.stop())}catch{}throw D}p(M),w(q),A(I),N(x==="multimodal")}d(S=>({...S,isActive:!0,mode:x,isListening:x!=="text",isProcessing:!1})),i&&i(x),y(!1),await k(x)}catch(S){console.error("[LiveChatButton] Failed to start live chat:",S),d(I=>({...I,isProcessing:!1}));try{c&&c.state!=="inactive"&&c.stop()}catch{}try{b&&b.getTracks().forEach(I=>I.stop())}catch{}try{C&&C.getTracks().forEach(I=>I.stop())}catch{}p(null),w(null),A(null),N(!1),S instanceof Error?S.name==="NotAllowedError"?alert("Camera/microphone permission was denied. Please allow access in your browser settings and try again."):S.name==="NotFoundError"?alert("No camera or microphone found. Please connect the required devices and try again."):S.name==="NotReadableError"?alert("Camera or microphone is already in use by another application. Please close other applications and try again."):alert(`Failed to start live chat: ${S.message}`):alert("Failed to start live chat. Please check your permissions and try again.")}},r=async()=>{try{d(x=>({...x,isProcessing:!0})),C&&(C.getTracks().forEach(x=>x.stop()),A(null)),b&&(b.getTracks().forEach(x=>x.stop()),w(null)),c&&c.state!=="inactive"&&(c.stop(),p(null)),d({isActive:!1,mode:null,isListening:!1,isProcessing:!1,isSpeaking:!1,currentTranscript:"",wakeWordDetected:!1,contextAwareness:{backgroundAnalysis:!1,visualContext:!1,emotionalContext:!1},adaptiveResponse:{responseStyle:"casual",responseLength:"moderate"}}),N(!1),await R()}catch(x){console.error("[LiveChatButton] Error stopping live chat:",x),d(S=>({...S,isProcessing:!1}))}},v=async(x,S)=>{if(!m.wakeWordDetected)try{const I=new Blob(x,{type:S||"audio/webm"});if(I.size<1e3)return;const q=new FormData;q.append("audio",I,"wake-check.webm");const f=await fetch(`${re}/api/voice-to-text/transcribe`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:q});if(f.ok){const l=await f.json();l.wakeWord&&l.wakeWord.detected&&(console.log("[LiveChatButton] Wake word detected:",l.wakeWord.wakeWord),d(M=>({...M,wakeWordDetected:!0,currentTranscript:l.wakeWord.cleanTranscript||""})),await j(l.wakeWord.cleanTranscript))}}catch(I){console.error("[LiveChatButton] Wake word detection error:",I)}};s.useEffect(()=>{if(!C)return;const x=()=>N(!1),S=C.getVideoTracks();return S.forEach(I=>I.addEventListener("ended",x)),()=>{S.forEach(I=>I.removeEventListener("ended",x))}},[C]);const j=async x=>{try{d(S=>({...S,wakeWordDetected:!0})),await T("Hey! I'm here, what's up?"),x&&x.trim()&&setTimeout(()=>{u(x)},1500)}catch(S){console.error("[LiveChatButton] Error activating voice mode:",S)}},u=async x=>{try{d(I=>({...I,isProcessing:!0,currentTranscript:x}));const S=await fetch(`${re}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({message:x,mode:"voice"})});if(S.ok){const I=await S.json();I.response&&await T(I.response)}}catch(S){console.error("[LiveChatButton] Error processing voice command:",S),await T("Sorry, I had trouble with that. Can you try again?")}finally{d(S=>({...S,isProcessing:!1,wakeWordDetected:!1,currentTranscript:""}))}},T=async x=>{try{d(I=>({...I,isSpeaking:!0}));const S=await fetch(`${re}/api/voice-chat/speak`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({text:x,voice:"nova",speed:1})});if(S.ok){const I=await S.arrayBuffer(),q=new AudioContext,f=await q.decodeAudioData(I),l=q.createBufferSource();l.buffer=f,l.connect(q.destination),l.onended=()=>{d(M=>({...M,isSpeaking:!1}))},l.start()}}catch(S){console.error("[LiveChatButton] Error speaking response:",S),d(I=>({...I,isSpeaking:!1}))}},k=async x=>{x!=="text"&&await T({voice:"Voice chat activated! Say 'Cartrita' to get my attention!",text:"Live text chat is ready!",multimodal:"Multi-modal mode activated! I can see, hear, and chat with you!"}[x])},R=async()=>{m.mode!=="text"&&await T("Live chat deactivated. See you later!")},E=()=>{m.isActive?r():y(!h)},$=()=>{const x=`relative p-4 rounded-full transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-offset-2 ${a}`;return m.isActive?m.wakeWordDetected?`${x} bg-purple-500 hover:bg-purple-600 text-white focus:ring-purple-500 shadow-lg animate-pulse`:m.mode==="multimodal"?`${x} bg-green-500 hover:bg-green-600 text-white focus:ring-green-500`:m.mode==="voice"?`${x} bg-blue-500 hover:bg-blue-600 text-white focus:ring-blue-500`:`${x} bg-gray-500 hover:bg-gray-600 text-white focus:ring-gray-500`:`${x} bg-gradient-to-r from-cyan-500 to-purple-600 hover:from-cyan-600 hover:to-purple-700 text-white focus:ring-cyan-500 transform hover:scale-105`},F=()=>m.isProcessing?e.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-white border-t-transparent rounded-full"}):m.isActive?e.jsx(he,{className:"h-8 w-8"}):e.jsx(me,{className:"h-8 w-8"}),n=()=>m.wakeWordDetected?e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-purple-400 rounded-full animate-pulse"}):m.isSpeaking?e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-400 rounded-full animate-pulse"}):m.isListening?e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full animate-pulse"}):null;return e.jsxs("div",{className:"relative",children:[e.jsx(fs,{stream:C,visible:_,position:"center",onClose:()=>N(!1)}),e.jsxs("button",{onClick:E,disabled:m.isProcessing,className:$(),title:m.isActive?"Stop Live Chat":"Start Live Chat",children:[F(),n()]}),h&&!m.isActive&&e.jsxs("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 p-2 min-w-48",children:[e.jsx("div",{className:"text-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Choose Mode"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>o("text"),className:"w-full flex items-center space-x-2 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-left text-sm",children:[e.jsx(Os,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:"Text Chat"})]}),e.jsxs("button",{onClick:()=>o("voice"),className:"w-full flex items-center space-x-2 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-left text-sm",children:[e.jsx(ce,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:"Voice Chat"})]}),e.jsxs("button",{onClick:()=>o("multimodal"),className:"w-full flex items-center space-x-2 px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-left text-sm",children:[e.jsx(Re,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Iteration 21 (Voice + Camera)"})]})]})]}),m.isActive&&e.jsxs("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs rounded px-2 py-1 whitespace-nowrap",children:[m.wakeWordDetected&&"Voice Activated",m.isSpeaking&&!m.wakeWordDetected&&"Speaking",m.isListening&&!m.wakeWordDetected&&!m.isSpeaking&&`Listening (${m.mode})`,m.currentTranscript&&e.jsx("div",{className:"mt-1 italic",children:m.currentTranscript})]}),m.isActive&&m.mode!=="text"&&!m.wakeWordDetected&&e.jsxs("div",{className:"absolute top-full mt-2 left-1/2 transform -translate-x-1/2 bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-100 text-xs rounded px-3 py-2 text-center whitespace-nowrap",children:["💡 Say ",e.jsx("strong",{children:'"Cartrita!"'})," to activate"]})]})},aa=({children:t,className:i=""})=>e.jsx("div",{className:`glass-card rounded-xl ${i}`,children:t}),ra=({variant:t="default",size:i="default",className:a="",children:m,disabled:d,...h})=>{const y="inline-flex items-center justify-center font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",c={default:"bg-blue-600/80 text-white hover:bg-blue-600 focus:ring-blue-500",outline:"border border-gray-600 bg-gray-800/50 text-gray-300 hover:bg-gray-700/50 hover:text-white focus:ring-blue-500",ghost:"text-gray-300 hover:bg-gray-800/50 focus:ring-blue-500",destructive:"bg-red-600/80 text-white hover:bg-red-600 focus:ring-red-500",secondary:"bg-gray-700/80 text-gray-200 hover:bg-gray-600/80 focus:ring-gray-500"},p={default:"px-4 py-2 text-sm",sm:"px-3 py-1.5 text-xs",lg:"px-6 py-3 text-base"};return e.jsx("button",{className:`${y} ${c[t]} ${p[i]} ${a}`,disabled:d,...h,children:m})},na={},He=["general","code","math","multilingual","long_context","tool_use","vision_language","audio","embedding","rerank","safety","lightweight","compression","meta"],la=()=>{const t=na?.VITE_API_BASE||"",[i,a]=s.useState([]),[m,d]=s.useState(!1),[h,y]=s.useState(null),[c,p]=s.useState("all"),[C,A]=s.useState(""),[b,w]=s.useState("Explain the benefits of streaming architectures."),[_,N]=s.useState(!1),[g,o]=s.useState(null);s.useEffect(()=>{let u=!0;return d(!0),fetch(`${t}/api/models/catalog`).then(T=>T.json()).then(T=>{u&&(T.success?a(T.data):y(T.error||"Failed to load catalog"))}).catch(T=>{u&&y(T.message)}).finally(()=>u&&d(!1)),()=>{u=!1}},[]);const r=s.useMemo(()=>{const u=C.toLowerCase();return i.filter(T=>(c==="all"||T.category===c)&&(!u||T.repo_id.toLowerCase().includes(u)||T.primary_tasks.some(k=>k.toLowerCase().includes(u))))},[i,c,C]),v=s.useMemo(()=>{const u={};r.forEach(T=>{u[T.category]||(u[T.category]=[]),u[T.category].push(T)});for(const T of Object.keys(u))u[T].sort((k,R)=>k.repo_id.localeCompare(R.repo_id));return u},[r]),j=async()=>{N(!0),y(null),o(null);try{const T=await(await fetch(`${t}/api/models/route`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:b})})).json();if(!T.success)throw new Error(T.error||"Route failed");o(T.result)}catch(u){y(u.message)}finally{N(!1)}};return e.jsxs(aa,{className:"p-4 space-y-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Model Router"}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("select",{value:c,onChange:u=>p(u.target.value),className:"border px-2 py-1 rounded text-sm",children:[e.jsx("option",{value:"all",children:"All Categories"}),He.filter(u=>i.some(T=>T.category===u)).map(u=>e.jsx("option",{value:u,children:u},u))]}),e.jsx("input",{placeholder:"Search models/tasks",value:C,onChange:u=>A(u.target.value),className:"border px-2 py-1 rounded text-sm"})]})]}),m&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading catalog…"}),h&&e.jsx("div",{className:"text-sm text-red-600",children:h}),!m&&!h&&e.jsxs("div",{className:"max-h-72 overflow-auto border rounded",children:[He.filter(u=>v[u]).map(u=>e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsxs("div",{className:"bg-muted/50 px-2 py-1 text-xs font-medium uppercase tracking-wide flex justify-between",children:[e.jsx("span",{children:u}),e.jsx("span",{children:v[u].length})]}),e.jsx("ul",{className:"divide-y",children:v[u].map(T=>e.jsxs("li",{className:"px-2 py-1 text-xs flex flex-col gap-0.5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-mono",children:T.repo_id}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:T.approx_params})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground truncate",children:T.primary_tasks.join(", ")})]},T.repo_id))})]},u)),r.length===0&&e.jsx("div",{className:"p-3 text-xs text-muted-foreground",children:"No models match filters."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:b,onChange:u=>w(u.target.value),className:"w-full border rounded p-2 text-sm h-28"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(ra,{disabled:_,onClick:j,children:_?"Routing…":"Route Prompt"}),g&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[g.model_id," • ",g.task," • ",g.timing_ms,"ms • conf ",(g.confidence*100).toFixed(0),"%"]})]}),g&&e.jsx("div",{className:"border rounded p-2 bg-muted/30 text-sm whitespace-pre-wrap max-h-64 overflow-auto",children:typeof g.output=="string"?g.output:JSON.stringify(g.output,null,2)})]})]})},Ge={general:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",code:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",math:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",multilingual:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",safety:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",lightweight:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",vision:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300",audio:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300",embedding:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-300"},ia={economy:"bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-200",standard:"bg-yellow-100 text-yellow-700 dark:bg-yellow-800 dark:text-yellow-200",premium:"bg-red-100 text-red-700 dark:bg-red-800 dark:text-red-200"},ca=({onSelectModel:t,selectedModel:i,className:a=""})=>{const[m,d]=s.useState([]),[h,y]=s.useState(!0),[c,p]=s.useState(""),[C,A]=s.useState("all"),[b,w]=s.useState("all"),[_,N]=s.useState("quality"),[g,o]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const T=await fetch("/api/huggingface/capabilities");T.ok&&(await T.json(),d([{idx:1,repo_id:"meta-llama/Meta-Llama-3-70B-Instruct",category:"general",approx_params:"70B",primary_tasks:["chat","reasoning","analysis"],serverless_candidate:!1,requires_endpoint:!0,notes:"Large; often needs dedicated endpoint.",cost_tier:"premium",quality_score:.95,context_length:8192},{idx:2,repo_id:"meta-llama/Meta-Llama-3-8B-Instruct",category:"general",approx_params:"8B",primary_tasks:["chat","drafting","analysis"],serverless_candidate:!0,requires_endpoint:!1,notes:"Good quality-size tradeoff.",cost_tier:"standard",quality_score:.85,context_length:8192},{idx:3,repo_id:"microsoft/DialoGPT-medium",category:"lightweight",approx_params:"345M",primary_tasks:["chat","conversation"],serverless_candidate:!0,requires_endpoint:!1,notes:"Fast response times.",cost_tier:"economy",quality_score:.65,context_length:1024},{idx:4,repo_id:"Qwen/Qwen2-7B-Instruct",category:"multilingual",approx_params:"7B",primary_tasks:["multilingual","chat","reasoning"],serverless_candidate:!0,requires_endpoint:!1,notes:"Excellent multilingual support.",cost_tier:"standard",quality_score:.82,context_length:32768},{idx:5,repo_id:"microsoft/speecht5_tts",category:"audio",approx_params:"unknown",primary_tasks:["text-to-speech","voice-synthesis"],serverless_candidate:!0,requires_endpoint:!1,notes:"High-quality TTS model.",cost_tier:"standard",quality_score:.88,context_length:512},{idx:6,repo_id:"BAAI/bge-large-en-v1.5",category:"embedding",approx_params:"335M",primary_tasks:["embedding","similarity","retrieval"],serverless_candidate:!0,requires_endpoint:!1,notes:"High-quality text embeddings.",cost_tier:"economy",quality_score:.9,context_length:512}]))}catch(T){console.error("Failed to load models:",T)}finally{y(!1)}})()},[]);const r=s.useMemo(()=>{let u=m.filter(T=>{const k=T.repo_id.toLowerCase().includes(c.toLowerCase())||T.primary_tasks.some($=>$.toLowerCase().includes(c.toLowerCase())),R=C==="all"||T.category===C,E=b==="all"||T.cost_tier===b;return k&&R&&E});return u.sort((T,k)=>{switch(_){case"quality":return(k.quality_score||0)-(T.quality_score||0);case"cost":const R={economy:0,standard:1,premium:2};return(R[T.cost_tier]||1)-(R[k.cost_tier]||1);case"params":const E=$=>{const F=parseFloat($);return $.includes("B")?F*1e3:$.includes("M")?F:0};return E(k.approx_params)-E(T.approx_params);case"name":return T.repo_id.localeCompare(k.repo_id);default:return 0}}),u},[m,c,C,b,_]),v=[...new Set(m.map(u=>u.category))],j=[...new Set(m.map(u=>u.cost_tier).filter(Boolean))];return h?e.jsx("div",{className:`p-6 ${a}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((u,T)=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"},T))})]})}):e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg ${a}`,children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"HuggingFace Model Catalog"}),e.jsxs("button",{onClick:()=>o(!g),className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(ts,{className:"h-4 w-4"}),e.jsx("span",{children:"Filters"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search models, tasks...",value:c,onChange:u=>p(u.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),g&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsxs("select",{value:C,onChange:u=>A(u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),v.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cost Tier"}),e.jsxs("select",{value:b,onChange:u=>w(u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Tiers"}),j.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sort By"}),e.jsxs("select",{value:_,onChange:u=>N(u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"quality",children:"Quality Score"}),e.jsx("option",{value:"cost",children:"Cost (Low to High)"}),e.jsx("option",{value:"params",children:"Parameter Size"}),e.jsx("option",{value:"name",children:"Name"})]})]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"space-y-4",children:r.map(u=>e.jsx("div",{onClick:()=>t(u),className:`p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md ${i?.repo_id===u.repo_id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:u.repo_id}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${Ge[u.category]||Ge.general}`,children:u.category}),u.cost_tier&&e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${ia[u.cost_tier]}`,children:[e.jsx(qs,{className:"h-3 w-3 inline mr-1"}),u.cost_tier]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:u.notes}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:u.primary_tasks.map(T=>e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded",children:T},T))}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:u.approx_params})]}),u.quality_score&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Bs,{className:"h-4 w-4"}),e.jsx("span",{children:u.quality_score.toFixed(2)})]}),u.context_length&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsxs("span",{children:[u.context_length.toLocaleString()," ctx"]})]}),e.jsx("div",{className:"flex items-center space-x-1",children:u.serverless_candidate?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Serverless"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-orange-600 dark:text-orange-400",children:"Endpoint"})]})})]})]}),i?.repo_id===u.repo_id&&e.jsx(te,{className:"h-6 w-6 text-blue-500 flex-shrink-0"})]})},u.repo_id))}),r.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"No models found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Try adjusting your search or filters."})]})]})]})},oa=({token:t,className:i=""})=>{const[a,m]=s.useState([]),[d,h]=s.useState(""),[y,c]=s.useState(null),[p,C]=s.useState(!1),[A,b]=s.useState(!1),[w,_]=s.useState(""),[N,g]=s.useState("BAAI/bge-large-en-v1.5"),[o,r]=s.useState("BAAI/bge-reranker-large"),[v,j]=s.useState("meta-llama/Meta-Llama-3-8B-Instruct"),[u]=s.useState(20),[T]=s.useState(8),[k,R]=s.useState(!1),[E,$]=s.useState(!0),[F,n]=s.useState("standard"),x=s.useRef(null),S=s.useCallback(async D=>{const B=[];for(let H=0;H<D.length;H++){const J=D[H];if(J.size>50*1024*1024){_(`File ${J.name} is too large (max 50MB)`);continue}try{let U="",G="text";J.type==="application/json"?(U=await J.text(),G="json"):J.type==="application/pdf"?(U=`[PDF Content] ${J.name} - This is a placeholder for PDF text extraction.`,G="pdf"):(U=await J.text(),G="text");const X={id:`doc_${Date.now()}_${H}`,name:J.name,content:U,size:J.size,type:G,uploadedAt:new Date};B.push(X)}catch(U){console.error(`Error reading file ${J.name}:`,U),_(`Failed to read file: ${J.name}`)}}m(H=>[...H,...B]),_("")},[]),I=s.useCallback(D=>{D.preventDefault(),D.stopPropagation()},[]),q=s.useCallback(D=>{D.preventDefault(),D.stopPropagation();const B=D.dataTransfer.files;B.length>0&&S(B)},[S]),f=D=>{m(B=>B.filter(H=>H.id!==D))},l=async()=>{if(!d.trim()){_("Please enter a query");return}if(a.length===0){_("Please upload at least one document");return}C(!0),_(""),c(null);try{const D=a.map(J=>J.content),B=await fetch("/api/huggingface/rag",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({query:d,documentStore:D,embeddingModel:N,rerankModel:o,generationModel:v,topKRetrieval:u,topKRerank:T,useMultiQuery:k,includeCitations:E,budgetTier:F})});if(!B.ok)throw new Error(`RAG pipeline failed: ${B.statusText}`);const H=await B.json();c(H.result)}catch(D){console.error("RAG pipeline error:",D),_(D instanceof Error?D.message:"Failed to execute RAG pipeline")}finally{C(!1)}},M=D=>{if(D===0)return"0 Bytes";const B=1024,H=["Bytes","KB","MB"],J=Math.floor(Math.log(D)/Math.log(B));return parseFloat((D/Math.pow(B,J)).toFixed(2))+" "+H[J]},O=D=>D>=.8?"text-green-600 dark:text-green-400":D>=.6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400";return e.jsx("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg ${i}`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"h-6 w-6 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"RAG Pipeline"})]}),e.jsx("button",{onClick:()=>b(!A),className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Advanced Settings"})]}),w&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:w})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Documents"}),e.jsxs("div",{onDragOver:I,onDrop:q,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-gray-400 dark:hover:border-gray-500 transition-colors",children:[e.jsx(zs,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Drag and drop files here, or"," ",e.jsx("button",{onClick:()=>x.current?.click(),className:"text-blue-600 hover:text-blue-700 underline",children:"browse"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"Supports text files, PDFs, and JSON (max 50MB each)"})]}),e.jsx("input",{ref:x,type:"file",multiple:!0,accept:".txt,.pdf,.json,.md",onChange:D=>D.target.files&&S(D.target.files),className:"hidden"}),a.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:a.map(D=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(rs,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:D.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[M(D.size)," • ",D.type.toUpperCase()]})]})]}),e.jsx("button",{onClick:()=>f(D.id),className:"text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(ns,{className:"h-4 w-4"})})]},D.id))})]}),A&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Pipeline Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Embedding Model"}),e.jsxs("select",{value:N,onChange:D=>g(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"BAAI/bge-large-en-v1.5",children:"BGE Large EN v1.5"}),e.jsx("option",{value:"sentence-transformers/all-MiniLM-L6-v2",children:"MiniLM L6 v2"}),e.jsx("option",{value:"intfloat/e5-large-v2",children:"E5 Large v2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rerank Model"}),e.jsxs("select",{value:o,onChange:D=>r(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"BAAI/bge-reranker-large",children:"BGE Reranker Large"}),e.jsx("option",{value:"cross-encoder/ms-marco-MiniLM-L-6-v2",children:"MiniLM Cross Encoder"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Generation Model"}),e.jsxs("select",{value:v,onChange:D=>j(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"meta-llama/Meta-Llama-3-8B-Instruct",children:"Llama 3 8B"}),e.jsx("option",{value:"meta-llama/Meta-Llama-3-70B-Instruct",children:"Llama 3 70B"}),e.jsx("option",{value:"mistralai/Mixtral-8x7B-Instruct-v0.1",children:"Mixtral 8x7B"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Budget Tier"}),e.jsxs("select",{value:F,onChange:D=>n(D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"economy",children:"Economy"}),e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("label",{htmlFor:"rag-multi-query",className:"flex items-center space-x-2",children:[e.jsx("input",{id:"rag-multi-query",type:"checkbox",checked:k,onChange:D=>R(D.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Multi Query"})]}),e.jsxs("label",{htmlFor:"rag-citations",className:"flex items-center space-x-2",children:[e.jsx("input",{id:"rag-citations",type:"checkbox",checked:E,onChange:D=>$(D.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Citations"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Query"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{value:d,onChange:D=>h(D.target.value),placeholder:"Ask a question about your documents...",rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})}),e.jsx("button",{onClick:l,disabled:p||!d.trim()||a.length===0,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center space-x-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Processing"})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"})]})})]})]}),y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Answer"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Confidence:"}),e.jsxs("span",{className:`font-medium ${O(y.confidence)}`,children:[Math.round(y.confidence*100),"%"]})]})]}),e.jsx("p",{className:"text-blue-800 dark:text-blue-200 leading-relaxed",children:y.answer})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Sources"}),e.jsx("div",{className:"space-y-2",children:y.sources.map(D=>e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Source ",D.id]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Score: ",D.score.toFixed(3)]}),e.jsxs("span",{children:["Relevance: ",D.relevance.toFixed(2)]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:D.content.length>200?D.content.substring(0,200)+"...":D.content})]},D.id))})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Pipeline Metadata"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Duration:"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[y.metadata.pipeline_duration_ms,"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Candidates:"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:y.metadata.total_candidates})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Reranked:"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:y.metadata.reranked_count})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Query Expanded:"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:y.metadata.query_expanded?"Yes":"No"})]})]})]})]})]})})},da=({token:t,className:i=""})=>{const[a,m]=s.useState(null),[d,h]=s.useState(null),[y,c]=s.useState(!0),[p,C]=s.useState(""),[A,b]=s.useState(new Date),[w,_]=s.useState(!0),[N,g]=s.useState(""),[o,r]=s.useState({budget_tier:"standard",max_cost_per_1k_tokens:.01,min_confidence_threshold:.3,require_safety_filter:!1,context_length_needed:2048,multilingual:!1,enable_fallback:!0,max_candidates:5,temperature:.7,max_new_tokens:512}),[v,j]=s.useState(null),[u,T]=s.useState(!1),k=async()=>{try{C("");const n=new AbortController,x=setTimeout(()=>n.abort(),8e3),[S,I]=await Promise.all([fetch("/api/huggingface/stats",{headers:{Authorization:`Bearer ${t}`},signal:n.signal}).catch(q=>({ok:!1,status:0,_err:q})),fetch("/api/huggingface/health",{signal:n.signal}).catch(q=>({ok:!1,status:0,_err:q}))]);if(clearTimeout(x),!S.ok)S.status===404||S.status===503?C(q=>q||`Routing stats unavailable (${S.status})`):C(q=>q||"Failed to fetch routing statistics");else{const q=await S.json();m(q.stats)}if(!I.ok)I.status===503?C(q=>q||"Health check: orchestrator initializing"):I.status!==0&&C(q=>q||"Failed to fetch health status");else{const q=await I.json();h(q.health)}b(new Date)}catch(n){C(n instanceof Error?n.name==="AbortError"?"Dashboard request timed out":n.message:"Failed to fetch data")}finally{c(!1)}},R=async()=>{if(N.trim()){T(!0),j(null);try{const n=await fetch("/api/huggingface/inference",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({taskType:"text-generation",text:N,options:o})});if(!n.ok)throw new Error(`Routing test failed: ${n.statusText}`);const x=await n.json();j(x),k()}catch(n){console.error("Routing test error:",n),j({success:!1,error:n instanceof Error?n.message:"Test failed"})}finally{T(!1)}}},E=async()=>{try{(await fetch("/api/huggingface/clear-caches",{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&k()}catch(n){console.error("Failed to clear caches:",n)}};if(s.useEffect(()=>{k()},[]),s.useEffect(()=>{if(w){let n=setInterval(k,1e4);return()=>clearInterval(n)}},[w]),y&&!a&&!d)return e.jsx("div",{className:`p-6 ${i}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(6)].map((n,x)=>e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded"},x))})]})});const $=n=>n==="healthy"?e.jsx(te,{className:"h-5 w-5 text-green-500"}):e.jsx(ve,{className:"h-5 w-5 text-red-500"}),F=n=>n==="healthy"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800";return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg ${i}`,children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(we,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"HuggingFace Routing Dashboard"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsxs("span",{children:["Updated: ",A.toLocaleTimeString()]})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:n=>_(n.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto-refresh"})]}),e.jsx("button",{onClick:k,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(fe,{className:"h-4 w-4"})})]})]}),p&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:p})})]}),e.jsxs("div",{className:"p-6",children:[d&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"System Health"}),e.jsx("div",{className:`p-4 rounded-lg border ${F(d.status)} mb-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[$(d.status),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:["Overall Status: ",d.status.charAt(0).toUpperCase()+d.status.slice(1)]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:d.message})]})]}),e.jsx("div",{className:"flex items-center space-x-4 text-sm",children:d.enhanced_features&&typeof d.enhanced_features=="object"?Object.entries(d.enhanced_features).map(([n,x])=>e.jsxs("div",{className:"flex items-center space-x-1",children:[x?e.jsx(te,{className:"h-4 w-4 text-green-500"}):e.jsx(ve,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 capitalize",children:n.replace(/_/g," ")})]},n)):e.jsx("span",{className:"text-xs text-gray-500",children:"No feature data"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg border ${F(d.routing_service.status)}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[$(d.routing_service.status),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Routing Service"})]}),d.routing_service.test_successful&&e.jsxs("div",{className:"text-xs space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:["Model: ",d.routing_service.model_used]}),e.jsxs("p",{children:["Confidence: ",d.routing_service.confidence?.toFixed(3)]})]}),d.routing_service.error&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:d.routing_service.error})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${F(d.rag_service.status)}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[$(d.rag_service.status),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"RAG Service"})]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Cache Size: ",d.rag_service.cache_size," items"]})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Agents"}),e.jsx("div",{className:"space-y-1",children:d.agents&&typeof d.agents=="object"?Object.entries(d.agents).map(([n,x])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:n}),$(x.status)]},n)):e.jsx("p",{className:"text-xs text-gray-500",children:"No agents"})})]})]})]}),a&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Performance Statistics"}),e.jsx("button",{onClick:E,className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Clear Caches"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(we,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Total Requests"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:a.totalRequests!=null?a.totalRequests.toLocaleString():"—"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(te,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Success Rate"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:a.successRate!=null?(a.successRate*100).toFixed(1)+"%":"—"})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-100",children:"Avg Latency"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900 dark:text-yellow-100",children:a.averageLatency!=null?Math.round(a.averageLatency)+"ms":"—"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ne,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:"Fallbacks Used"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:a.fallbacksUsed})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Available Models"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"h-5 w-5 text-gray-600"}),e.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[a.availableModels," models"]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"RAG Cache"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{className:"h-5 w-5 text-gray-600"}),e.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[a.ragCacheStats.size," cached items"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Test Routing"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Test Prompt"}),e.jsx("textarea",{value:N,onChange:n=>g(n.target.value),placeholder:"Enter a prompt to test the routing system...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Budget Tier"}),e.jsxs("select",{value:o.budget_tier,onChange:n=>r(x=>({...x,budget_tier:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"economy",children:"Economy"}),e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Min Confidence"}),e.jsx("input",{type:"number",min:"0",max:"1",step:"0.1",value:o.min_confidence_threshold,onChange:n=>r(x=>({...x,min_confidence_threshold:parseFloat(n.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-center space-x-4 text-sm",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:o.require_safety_filter,onChange:n=>r(x=>({...x,require_safety_filter:n.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Safety Filter"})]})}),e.jsx("div",{className:"flex items-center space-x-4 text-sm",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:o.multilingual,onChange:n=>r(x=>({...x,multilingual:n.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Multilingual"})]})})]}),e.jsx("button",{onClick:R,disabled:u||!N.trim(),className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center space-x-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Testing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Routing"})]})}),v&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Test Result"}),e.jsx("pre",{className:"text-sm text-gray-600 dark:text-gray-400 overflow-auto",children:JSON.stringify(v,null,2)})]})]})]})]})]})},xa=({onTranscript:t,disabled:i=!1,token:a,showAdvancedSettings:m=!1,className:d=""})=>{const[h,y]=s.useState(!1),[c,p]=s.useState(!1),[C,A]=s.useState({microphone:"unknown",camera:"unknown"}),[b,w]=s.useState(!1),[_,N]=s.useState(!1),[g,o]=s.useState(""),[r,v]=s.useState(null),j=s.useRef(null),u=s.useRef(null),T=s.useRef([]),[k,R]=s.useState({model:"openai/whisper-large-v3",language:"auto",enable_confidence:!0,enable_alternatives:!0,noise_reduction:!0,auto_punctuation:!0,provider_preference:"huggingface"}),E=[{id:"openai/whisper-large-v3",name:"Whisper Large v3",quality:"High",speed:"Medium"},{id:"openai/whisper-medium",name:"Whisper Medium",quality:"Med",speed:"Fast"},{id:"openai/whisper-small",name:"Whisper Small",quality:"Basic",speed:"Very Fast"},{id:"openai/whisper-tiny",name:"Whisper Tiny",quality:"Low",speed:"Ultra Fast"},{id:"distil-whisper/distil-large-v3",name:"Distil Whisper Large v3",quality:"High",speed:"Faster"},{id:"distil-whisper/distil-medium.en",name:"Distil Whisper Medium EN",quality:"Med",speed:"Faster"},{id:"facebook/wav2vec2-large-960h",name:"Wav2Vec2 Large",quality:"Med",speed:"Fast"},{id:"facebook/wav2vec2-base-960h",name:"Wav2Vec2 Base",quality:"Basic",speed:"Very Fast"},{id:"jonatasgrosman/wav2vec2-large-xlsr-53-english",name:"Wav2Vec2 XLSR EN",quality:"Med",speed:"Fast"},{id:"jonatasgrosman/wav2vec2-large-xlsr-53-spanish",name:"Wav2Vec2 XLSR ES",quality:"Med",speed:"Fast"},{id:"nbroad/paraformer-ctc-en",name:"Paraformer CTC EN",quality:"Med",speed:"Fast"},{id:"kamo-naoyuki/wav2vec2-large-japanese",name:"Wav2Vec2 Japanese",quality:"Med",speed:"Fast"},{id:"openai/whisper-large-v2",name:"Whisper Large v2",quality:"High",speed:"Medium"},{id:"openai/whisper-base",name:"Whisper Base",quality:"Basic",speed:"Fast"},{id:"openai/whisper-base.en",name:"Whisper Base EN",quality:"Basic",speed:"Fast"}],$=s.useCallback(async f=>{let l=null;try{l=new AudioContext;const M=await f.arrayBuffer(),O=await l.decodeAudioData(M),D=O.getChannelData(0),B=D.length,H=O.sampleRate,J=O.duration;let U=0,G=0,X=0,Z=Math.sign(D[0])||1;const P=Math.max(1,Math.floor(B/2e5));for(let le=0;le<B;le+=P){const ae=D[le],pe=ae<0?-ae:ae;U+=ae*ae,pe>G&&(G=pe);const ye=ae===0?Z:ae>0?1:-1;ye!==Z&&X++,Z=ye}const V=Math.ceil(B/P),L=Math.sqrt(U/V),z=.001,K=.01,Y=.5,Q=H*J*.3/P,se={duration:J,rms:L,peak:G,zeroCrossings:X,sampleRate:H,fileSize:f.size,quality:G>K?"good":L>z?"fair":"poor"};return{valid:J>=Y&&(L>z||G>K)&&X<Q,analysis:se}}catch(M){return console.error("[STT] Audio validation error:",M),{valid:!0,analysis:null}}finally{try{l?.close()}catch{}}},[]),F=s.useCallback(async()=>{if(!(i||!a))try{o(""),y(!0),console.log("[Enhanced STT] Starting recording with HuggingFace provider");const f=os();if(!f.isSupported)throw new Error(`Media not supported: ${f.issues.join(", ")}`);await ms();const l={...ds(),sampleRate:16e3,channelCount:1,echoCancellation:k.noise_reduction,noiseSuppression:k.noise_reduction,autoGainControl:!0},M=await navigator.mediaDevices.getUserMedia({audio:l});u.current=M,T.current=[];const O=xs(),D=new MediaRecorder(M,O?{mimeType:O}:void 0);j.current=D,D.ondataavailable=H=>{H.data.size>0&&T.current.push(H.data)};const B={done:!1};D.onstop=async()=>{if(!B.done){B.done=!0,console.log("[Enhanced STT] Processing with HuggingFace STT"),p(!0);try{const H=new Blob(T.current,{type:"audio/webm"}),{valid:J,analysis:U}=await $(H);if(!J)throw new Error(`Audio quality insufficient. Duration: ${U?.duration?.toFixed(2)}s, Quality: ${U?.quality}`);const G=new FormData;G.append("audio",H,"recording.webm");const X=await fetch("/api/huggingface/audio",{method:"POST",headers:{Authorization:`Bearer ${a}`},body:G});if(!X.ok){const P=await X.json().catch(()=>({}));throw new Error(P.error||`STT failed: ${X.statusText}`)}const Z=await X.json();if(Z.success&&Z.result){const P={transcript:Z.result.transcript||Z.result.text||"",confidence:Z.result.confidence||.9,provider:"huggingface",model:k.model,latency_ms:Z.result.latency_ms||0,language_detected:Z.result.language_detected,word_count:(Z.result.transcript||Z.result.text||"").split(" ").length,alternatives:Z.result.alternatives};v(P),t(P)}else throw new Error("No transcript received from HuggingFace STT")}catch(H){console.error("[Enhanced STT] Processing error:",H),o(H instanceof Error?H.message:"Transcription failed")}finally{p(!1)}}},D.start(1e3)}catch(f){console.error("[Enhanced STT] Failed to start recording:",f),y(!1),f instanceof Error&&(f.name==="NotAllowedError"?(o("Microphone permission denied. Please allow microphone access."),w(!0)):f.name==="NotFoundError"?o("No microphone found. Please connect a microphone."):f.name==="NotReadableError"?o("Microphone is already in use by another application."):o(f.message))}},[i,a,k,$,t]),n=s.useCallback(()=>{console.log("[Enhanced STT] Stopping recording"),j.current&&j.current.state!=="inactive"&&(j.current.stop(),j.current=null),u.current&&(u.current.getTracks().forEach(f=>f.stop()),u.current=null),y(!1)},[]),x=s.useCallback(()=>{if(h)n();else{if(C.microphone!=="granted"){w(!0);return}F()}},[h,C.microphone,F,n]),S=s.useCallback(f=>{A(f),f.microphone==="granted"&&b&&w(!1)},[b]),I=s.useCallback(async()=>{try{o(""),p(!0);const l=await(await fetch("/api/huggingface/health")).json();l.success&&l.health.agents?.AudioWizard?.status==="healthy"?o(""):o("Audio system not ready. Please try again in a moment.")}catch{o("Failed to test audio system")}finally{p(!1)}},[]);s.useEffect(()=>()=>{h&&n()},[h,n]);const q=i||c||!a;return e.jsxs("div",{className:`relative ${d}`,children:[e.jsx("button",{onClick:x,disabled:q,className:`
          p-3 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2
          ${h?"bg-red-500 hover:bg-red-600 text-white focus:ring-red-500 shadow-lg":c?"bg-blue-500 text-white animate-pulse":"bg-gray-100 hover:bg-gray-200 text-gray-600 focus:ring-blue-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}
          ${q?"opacity-50 cursor-not-allowed":"cursor-pointer transform hover:scale-105"}
        `,title:h?"Stop recording (HuggingFace STT)":c?"Processing with HuggingFace...":"Start voice input (Enhanced STT)",children:h?e.jsx(he,{className:"h-6 w-6"}):e.jsx(ce,{className:`h-6 w-6 ${c?"animate-pulse":""}`})}),h&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full animate-pulse border-2 border-white"}),c&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-blue-500 text-white text-sm rounded shadow-lg whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Processing with HuggingFace STT..."})]})}),h&&u.current&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4",children:e.jsx(De,{isRecording:h,audioStream:u.current,width:250,height:50,barColor:"#ef4444",backgroundColor:"rgba(0, 0, 0, 0.8)",sensitivity:1.5})}),m&&e.jsx("button",{onClick:()=>N(!_),className:"absolute top-0 right-0 transform translate-x-2 -translate-y-2 p-1 bg-gray-200 dark:bg-gray-600 rounded-full hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",title:"STT Settings",children:e.jsx(Se,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),g&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-red-500 text-white text-sm rounded shadow-lg max-w-xs",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:g})]})}),r&&!g&&!c&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-green-500 text-white text-sm rounded shadow-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsxs("span",{children:["Transcribed ",r.word_count," words (",r.confidence>.8?"High":r.confidence>.6?"Med":"Low"," confidence)"]})]})}),_&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-80 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"STT Settings"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"×"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Model"}),e.jsx("select",{value:k.model,onChange:f=>R(l=>({...l,model:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:E.map(f=>e.jsxs("option",{value:f.id,children:[f.name," (",f.quality," quality, ",f.speed," speed)"]},f.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Language"}),e.jsxs("select",{value:k.language,onChange:f=>R(l=>({...l,language:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"auto",children:"Auto-detect"}),e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"es",children:"Spanish"}),e.jsx("option",{value:"fr",children:"French"}),e.jsx("option",{value:"de",children:"German"}),e.jsx("option",{value:"it",children:"Italian"}),e.jsx("option",{value:"pt",children:"Portuguese"}),e.jsx("option",{value:"ru",children:"Russian"}),e.jsx("option",{value:"zh",children:"Chinese"}),e.jsx("option",{value:"ja",children:"Japanese"}),e.jsx("option",{value:"ko",children:"Korean"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:k.enable_confidence,onChange:f=>R(l=>({...l,enable_confidence:f.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable confidence scoring"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:k.enable_alternatives,onChange:f=>R(l=>({...l,enable_alternatives:f.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Generate alternatives"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:k.noise_reduction,onChange:f=>R(l=>({...l,noise_reduction:f.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Noise reduction"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:k.auto_punctuation,onChange:f=>R(l=>({...l,auto_punctuation:f.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto punctuation"})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:I,disabled:c,className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm",children:"Test Audio System"})})]})]}),b&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 w-80",children:e.jsx($e,{onPermissionChange:S,requiredPermissions:["microphone"],showUI:!0,autoRequest:!1})})]})},ma={low:{width:640,height:480},medium:{width:1280,height:720},high:{width:1920,height:1080}},ha=[{id:"image-classification",name:"Image Classification",description:"Identify what's in the image",icon:"🏷️"},{id:"object-detection",name:"Object Detection",description:"Find and locate objects in the image",icon:"🎯"},{id:"image-to-text",name:"Image Description",description:"Generate text description of the image",icon:"📝"},{id:"visual-question-answering",name:"Visual Q&A",description:"Answer questions about the image",icon:"❓"}],ua=[{id:"fast",name:"Fast",description:"Quick results, basic quality"},{id:"quality",name:"Quality",description:"Best results, slower processing"},{id:"auto",name:"Auto",description:"Balanced speed and quality"}],pa=({onAnalysis:t,disabled:i=!1,token:a,showAdvancedSettings:m=!1,className:d=""})=>{const[h,y]=s.useState(!1),[c,p]=s.useState(!1),[C,A]=s.useState({microphone:"unknown",camera:"unknown"}),[b,w]=s.useState(!1),[_,N]=s.useState(!1),[g,o]=s.useState(""),[r,v]=s.useState(null),[j,u]=s.useState(0),[T,k]=s.useState(!1),R=s.useRef(null),E=s.useRef(null),$=s.useRef(null),F=s.useRef(null),n=s.useRef(!1),x=s.useRef(!1),[S,I]=s.useState({resolution:"medium",task:"image-classification",model_preference:"auto",auto_capture:!1,capture_interval:5,enable_preprocessing:!0,batch_analysis:!1}),[q,f]=s.useState("What do you see in this image?"),l=s.useCallback(async()=>{if(!(i||!a))try{o(""),console.log("[Enhanced Camera] Starting camera with HuggingFace vision");const U={video:{...ma[S.resolution],facingMode:"user",frameRate:{ideal:30,max:60}}},G=await navigator.mediaDevices.getUserMedia(U);E.current=G,R.current&&(x.current=!1,R.current.onloadedmetadata=async()=>{try{await R.current?.play(),x.current=!0}catch(X){console.warn("[Enhanced Camera] Autoplay prevented:",X)}},R.current.srcObject=G),y(!0),k(!0),S.auto_capture&&(F.current=setInterval(()=>{O()},S.capture_interval*1e3))}catch(U){console.error("[Enhanced Camera] Failed to start camera:",U),U instanceof Error&&(U.name==="NotAllowedError"?(o("Camera permission denied. Please allow camera access."),w(!0)):U.name==="NotFoundError"?o("No camera found. Please connect a camera."):U.name==="NotReadableError"?o("Camera is already in use by another application."):o(U.message))}},[i,a,S]),M=s.useCallback(()=>{n.current||(n.current=!0,console.log("[Enhanced Camera] Stopping camera"),F.current&&(clearInterval(F.current),F.current=null),E.current&&(E.current.getTracks().forEach(U=>U.stop()),E.current=null),R.current&&(R.current.srcObject=null),y(!1),x.current=!1,k(!1),setTimeout(()=>{n.current=!1},100))},[]),O=s.useCallback(async()=>{if(!(!R.current||!$.current||!h)){if(!x.current){console.warn("[Enhanced Camera] Capture skipped: video not ready");return}try{p(!0),o("");const U=R.current,G=$.current,X=G.getContext("2d");if(!X)throw new Error("Failed to get canvas context");G.width=U.videoWidth,G.height=U.videoHeight,X.drawImage(U,0,0);const Z=X.getImageData(0,0,Math.min(64,G.width),Math.min(64,G.height)).data;let P=0;for(let Q=0;Q<Z.length;Q+=16){const se=Z[Q],ue=Z[Q+1],le=Z[Q+2];if(se+ue+le>30&&(P++,P>5))break}if(P<=5){console.warn("[Enhanced Camera] Black/blank frame detected, skipping analysis"),p(!1);return}const V=await new Promise(Q=>{G.toBlob(se=>{se&&Q(se)},"image/jpeg",.8)}),L=new FormData;L.append("image",V,"capture.jpg"),L.append("taskType",S.task),S.task==="visual-question-answering"&&L.append("question",q);const z={model_preference:S.model_preference,enable_preprocessing:S.enable_preprocessing,budget_tier:S.model_preference==="fast"?"economy":S.model_preference==="quality"?"premium":"standard"};L.append("options",JSON.stringify(z));const K=await fetch("/api/huggingface/vision",{method:"POST",headers:{Authorization:`Bearer ${a}`},body:L});if(!K.ok){const Q=await K.json().catch(()=>({}));throw new Error(Q.error||`Vision analysis failed: ${K.statusText}`)}const Y=await K.json();if(Y.success&&Y.result){const Q={task_type:S.task,predictions:Y.result.predictions||[],confidence:Y.result.confidence||.9,model_used:Y.result.model_used||"unknown",processing_time_ms:Y.result.processing_time_ms||0,detected_objects:Y.result.detected_objects,classifications:Y.result.classifications,generated_text:Y.result.generated_text,image_description:Y.result.image_description};v(Q),u(se=>se+1),t(Q)}else throw new Error("No analysis result received from HuggingFace Vision")}catch(U){console.error("[Enhanced Camera] Analysis error:",U),o(U instanceof Error?U.message:"Analysis failed")}finally{p(!1)}}},[h,S,q,a,t]),D=s.useCallback(()=>{if(h)M();else{if(C.camera!=="granted"){w(!0);return}l()}},[h,C.camera,l,M]),B=s.useCallback(U=>{A(U),U.camera==="granted"&&b&&w(!1)},[b]),H=s.useCallback(async()=>{try{o(""),p(!0);const G=await(await fetch("/api/huggingface/health")).json();G.success&&G.health.agents?.VisionMaster?.status==="healthy"?o(""):o("Vision system not ready. Please try again in a moment.")}catch{o("Failed to test vision system")}finally{p(!1)}},[]);s.useEffect(()=>()=>{M()},[M]);const J=i||c||!a;return e.jsxs("div",{className:`relative ${d}`,children:[e.jsx(fs,{stream:E.current,visible:T,position:"center",onClose:()=>k(!1)}),e.jsx("button",{onClick:D,disabled:J,className:`
          p-3 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2
          ${h?"bg-red-500 hover:bg-red-600 text-white focus:ring-red-500 shadow-lg":c?"bg-blue-500 text-white animate-pulse":"bg-gray-100 hover:bg-gray-200 text-gray-600 focus:ring-blue-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}
          ${J?"opacity-50 cursor-not-allowed":"cursor-pointer transform hover:scale-105"}
        `,title:h?"Stop camera (HuggingFace Vision)":c?"Processing with HuggingFace...":"Start camera (Enhanced Vision)",children:h?e.jsx(he,{className:"h-6 w-6"}):e.jsx(be,{className:`h-6 w-6 ${c?"animate-pulse":""}`})}),h&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full animate-pulse border-2 border-white"}),h&&e.jsx("button",{onClick:O,disabled:c,className:"absolute top-0 left-full ml-2 p-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-full transition-colors",title:"Capture and Analyze",children:e.jsx(ls,{className:"h-5 w-5"})}),m&&e.jsx("button",{onClick:()=>N(!_),className:"absolute top-0 right-0 transform translate-x-2 -translate-y-2 p-1 bg-gray-200 dark:bg-gray-600 rounded-full hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",title:"Vision Settings",children:e.jsx(Se,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),c&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-blue-500 text-white text-sm rounded shadow-lg whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Analyzing with HuggingFace Vision..."})]})}),g&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-red-500 text-white text-sm rounded shadow-lg max-w-xs",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:g})]})}),r&&!g&&!c&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-3 px-3 py-2 bg-green-500 text-white text-sm rounded shadow-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{children:r.task_type==="image-classification"?`Classified (${r.confidence>.8?"High":"Med"} confidence)`:r.task_type==="object-detection"?`Found ${r.detected_objects?.length||0} objects`:r.task_type==="image-to-text"?"Description generated":"Analysis complete"})]})}),h&&e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 bg-black rounded-lg overflow-hidden shadow-lg",children:[e.jsx("video",{ref:R,autoPlay:!0,muted:!0,playsInline:!0,className:"w-80 h-60 object-cover"}),j>0&&e.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:["Captures: ",j]}),S.auto_capture&&e.jsxs("div",{className:"absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded flex items-center space-x-1",children:[e.jsx(fe,{className:"h-3 w-3 animate-spin"}),e.jsx("span",{children:"Auto"})]})]}),_&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-96 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vision Settings"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"×"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Analysis Task"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ha.map(U=>e.jsxs("button",{onClick:()=>I(G=>({...G,task:U.id})),className:`p-3 text-left border rounded-lg transition-colors ${S.task===U.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:U.icon}),e.jsx("span",{className:"font-medium text-sm text-gray-900 dark:text-white",children:U.name})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:U.description})]},U.id))})]}),S.task==="visual-question-answering"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Question"}),e.jsx("input",{type:"text",value:q,onChange:U=>f(U.target.value),placeholder:"What do you see in this image?",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Model Preference"}),e.jsx("select",{value:S.model_preference,onChange:U=>I(G=>({...G,model_preference:U.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:ua.map(U=>e.jsxs("option",{value:U.id,children:[U.name," - ",U.description]},U.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Resolution"}),e.jsxs("select",{value:S.resolution,onChange:U=>I(G=>({...G,resolution:U.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low (640x480)"}),e.jsx("option",{value:"medium",children:"Medium (1280x720)"}),e.jsx("option",{value:"high",children:"High (1920x1080)"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:S.auto_capture,onChange:U=>I(G=>({...G,auto_capture:U.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto-capture"})]}),S.auto_capture&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Capture Interval (seconds)"}),e.jsx("input",{type:"number",min:"1",max:"60",value:S.capture_interval,onChange:U=>I(G=>({...G,capture_interval:parseInt(U.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:S.enable_preprocessing,onChange:U=>I(G=>({...G,enable_preprocessing:U.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable preprocessing"})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:H,disabled:c,className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm",children:"Test Vision System"})})]})]}),e.jsx("canvas",{ref:$,className:"hidden"}),b&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-4 w-80",children:e.jsx($e,{onPermissionChange:B,requiredPermissions:["camera"],showUI:!0,autoRequest:!1})})]})},ga=["Hello, this is a test of the speech-to-text system.","The quick brown fox jumps over the lazy dog.","Testing multilingual capabilities: Hola, ¿cómo estás?","Technical terms: API, neural network, machine learning.","Numbers and dates: Today is January 15th, 2024, at 3:45 PM."],Ke={stt:[{id:"openai/whisper-large-v3",name:"Whisper Large v3",quality:"High"},{id:"openai/whisper-medium",name:"Whisper Medium",quality:"Medium"},{id:"facebook/wav2vec2-large-960h",name:"Wav2Vec2 Large",quality:"Medium"}],tts:[{id:"microsoft/speecht5_tts",name:"SpeechT5 TTS",quality:"High"},{id:"facebook/fastspeech2-en-ljspeech",name:"FastSpeech2",quality:"Medium"}]},ba=({token:t,className:i=""})=>{const[a,m]=s.useState([]),[d,h]=s.useState(!1),[y,c]=s.useState(""),[p,C]=s.useState(!1),[A,b]=s.useState(""),[w,_]=s.useState({stt_model:"openai/whisper-large-v3",tts_model:"microsoft/speecht5_tts",voice_swap_model:"microsoft/speecht5_tts",test_phrases:ga,quality_threshold:.8,latency_threshold:5e3,enable_noise_test:!0,enable_quality_analysis:!0}),[N,g]=s.useState(!1),[o,r]=s.useState(null),[v,j]=s.useState(null),u=s.useRef(null),T=s.useRef(null),k=s.useRef([]),R=s.useRef(null),E=s.useCallback(async()=>{try{const l=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});T.current=l,k.current=[];const M=new MediaRecorder(l);u.current=M,M.ondataavailable=O=>{O.data.size>0&&k.current.push(O.data)},M.onstop=()=>{const O=new Blob(k.current,{type:"audio/webm"});r(O),l.getTracks().forEach(D=>D.stop()),T.current=null},M.start(1e3),g(!0)}catch(l){console.error("Failed to start recording:",l),b("Failed to start recording: "+(l instanceof Error?l.message:"Unknown error"))}},[]),$=s.useCallback(()=>{u.current&&u.current.state!=="inactive"&&(u.current.stop(),u.current=null),g(!1)},[]),F=s.useCallback((l,M)=>{if(v===M){R.current?.pause(),j(null);return}const O=URL.createObjectURL(l);R.current&&(R.current.src=O,R.current.onended=()=>{j(null),URL.revokeObjectURL(O)},R.current.play(),j(M))},[v]),n=s.useCallback(async()=>{if(!o)throw new Error("No recorded audio available");const l=Date.now(),M=new FormData;M.append("audio",o,"test-audio.webm"),M.append("taskType","automatic-speech-recognition"),M.append("options",JSON.stringify({model:w.stt_model,language:"auto"}));const O=await fetch("/api/huggingface/audio",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:M});if(!O.ok)throw new Error(`STT test failed: ${O.statusText}`);const D=await O.json(),B=Date.now()-l;return{test_type:"stt",success:D.success,result:D.result,latency_ms:B,quality_score:D.result?.confidence||0,model_used:w.stt_model,provider:"huggingface"}},[o,w.stt_model,t]),x=s.useCallback(async l=>{const M=Date.now(),O=await fetch("/api/huggingface/text",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({taskType:"text-to-speech",text:l,options:{model:w.tts_model,voice_settings:{speed:1,pitch:1}}})});if(!O.ok)throw new Error(`TTS test failed: ${O.statusText}`);const D=await O.json(),B=Date.now()-M,H=D.success?Math.max(.5,1-B/1e4):0;return{test_type:"tts",success:D.success,result:D.result,latency_ms:B,quality_score:H,model_used:w.tts_model,provider:"huggingface"}},[w.tts_model,t]),S=s.useCallback(async()=>{if(!o)throw new Error("No recorded audio available");const l=Date.now(),M=new FormData;M.append("audio",o,"test-audio.webm"),M.append("taskType","voice-swap"),M.append("options",JSON.stringify({stt_model:w.stt_model,tts_model:w.voice_swap_model,target_voice:"default"}));const O=await fetch("/api/huggingface/audio",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:M});if(!O.ok)throw new Error(`Voice swap test failed: ${O.statusText}`);const D=await O.json(),B=Date.now()-l;return{test_type:"voice_swap",success:D.success,result:D.result,latency_ms:B,quality_score:D.result?.confidence||0,model_used:`${w.stt_model} + ${w.voice_swap_model}`,provider:"huggingface"}},[o,w,t]),I=s.useCallback(async()=>{if(!o){b("Please record audio first");return}h(!0),b("");const l=[];try{c("Testing Speech-to-Text...");const M=await n();l.push(M),c("Testing Text-to-Speech...");const O=await x(w.test_phrases[0]);l.push(O),c("Testing Voice Conversion...");const D=await S();if(l.push(D),w.enable_quality_analysis)for(let B=1;B<Math.min(3,w.test_phrases.length);B++){c(`Testing TTS phrase ${B+1}...`);const H=await x(w.test_phrases[B]);l.push({...H,test_type:"tts"})}m(l),c("")}catch(M){console.error("Test suite error:",M),b(M instanceof Error?M.message:"Test suite failed")}finally{h(!1),c("")}},[o,w,n,x,S]),f=s.useCallback(()=>{if(a.length===0)return{status:"pending",message:"No tests run"};const M=a.filter(O=>O.success&&O.quality_score>=w.quality_threshold&&O.latency_ms<=w.latency_threshold).length/a.length;return M>=.8?{status:"excellent",message:"All systems performing well"}:M>=.6?{status:"good",message:"Most systems working correctly"}:M>=.4?{status:"fair",message:"Some issues detected"}:{status:"poor",message:"Multiple systems need attention"}},[a,w])();return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Vs,{className:"h-6 w-6 text-purple-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Audio System Testing"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("button",{onClick:()=>C(!p),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(Se,{className:"h-5 w-5"})})})]}),A&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-5 w-5 text-red-600"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:A})]})}),a.length>0&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border ${f.status==="excellent"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":f.status==="good"?"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":f.status==="fair"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:`h-6 w-6 ${f.status==="excellent"?"text-green-600":f.status==="good"?"text-blue-600":f.status==="fair"?"text-yellow-600":"text-red-600"}`}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:["System Status: ",f.status.charAt(0).toUpperCase()+f.status.slice(1)]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:f.message})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:[a.filter(l=>l.success).length,"/",a.length," tests passed"]}),e.jsxs("p",{children:["Avg latency: ",Math.round(a.reduce((l,M)=>l+M.latency_ms,0)/a.length),"ms"]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Audio Recording"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("button",{onClick:N?$:E,disabled:d,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${N?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-400"}`,children:[N?e.jsx(he,{className:"h-5 w-5"}):e.jsx(ce,{className:"h-5 w-5"}),e.jsx("span",{children:N?"Stop Recording":"Start Recording"})]}),o&&e.jsxs("button",{onClick:()=>F(o,"recorded"),className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[v==="recorded"?e.jsx(Ws,{className:"h-5 w-5"}):e.jsx(Hs,{className:"h-5 w-5"}),e.jsx("span",{children:"Play Recording"})]})]}),N&&T.current&&e.jsx("div",{className:"mb-4",children:e.jsx(De,{isRecording:N,audioStream:T.current,width:400,height:60,barColor:"#3b82f6",backgroundColor:"rgba(0, 0, 0, 0.1)"})}),o&&e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["✅ Audio recorded (",(o.size/1024).toFixed(1)," KB)"]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:I,disabled:!o||d,className:"flex items-center space-x-2 px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Running Tests..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-5 w-5"}),e.jsx("span",{children:"Run Full Test Suite"})]})}),d&&y&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-purple-600 border-t-transparent rounded-full"}),e.jsx("span",{children:y})]})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Record audio first, then run the test suite to validate STT, TTS, and voice conversion capabilities."})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Test Results"}),e.jsx("div",{className:"space-y-4",children:a.map((l,M)=>e.jsxs("div",{className:`p-4 border rounded-lg ${l.success&&l.quality_score>=w.quality_threshold&&l.latency_ms<=w.latency_threshold?"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":"border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[l.success?e.jsx(te,{className:"h-5 w-5 text-green-600"}):e.jsx(ne,{className:"h-5 w-5 text-red-600"}),e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:[l.test_type.toUpperCase().replace("_"," ")," Test"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Quality: ",(l.quality_score*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Latency: ",l.latency_ms,"ms"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:["Model: ",l.model_used]}),e.jsxs("p",{children:["Provider: ",l.provider]}),l.error&&e.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error: ",l.error]}),l.result&&l.test_type==="stt"&&e.jsxs("p",{children:['Transcript: "',l.result.transcript||l.result.text,'"']})]})]},M))})]}),p&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-4",children:"Test Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"STT Model"}),e.jsx("select",{value:w.stt_model,onChange:l=>_(M=>({...M,stt_model:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:Ke.stt.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.quality,")"]},l.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"TTS Model"}),e.jsx("select",{value:w.tts_model,onChange:l=>_(M=>({...M,tts_model:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:Ke.tts.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.quality,")"]},l.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quality Threshold"}),e.jsx("input",{type:"number",min:"0",max:"1",step:"0.1",value:w.quality_threshold,onChange:l=>_(M=>({...M,quality_threshold:parseFloat(l.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Latency Threshold (ms)"}),e.jsx("input",{type:"number",min:"1000",max:"30000",step:"500",value:w.latency_threshold,onChange:l=>_(M=>({...M,latency_threshold:parseInt(l.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"mt-4 space-y-2",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:w.enable_quality_analysis,onChange:l=>_(M=>({...M,enable_quality_analysis:l.target.checked})),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enable comprehensive quality analysis"})]})})]}),e.jsx("audio",{ref:R,className:"hidden"})]})},Je=["What objects can you see in this image?","What colors are prominent in this image?","What is the main subject of this image?","What activities are happening in this image?","What is the setting or location of this image?"],fa={"image-classification":[{id:"google/vit-base-patch16-224",name:"Vision Transformer Base",quality:"High"},{id:"microsoft/resnet-50",name:"ResNet-50",quality:"Medium"}],"object-detection":[{id:"facebook/detr-resnet-50",name:"DETR ResNet-50",quality:"High"},{id:"microsoft/table-transformer-detection",name:"Table Transformer",quality:"Specialized"}],"image-to-text":[{id:"Salesforce/blip-image-captioning-base",name:"BLIP Image Captioning",quality:"High"},{id:"microsoft/git-base",name:"GIT Base",quality:"Medium"}],"visual-question-answering":[{id:"dandelin/vilt-b32-finetuned-vqa",name:"ViLT VQA",quality:"High"}]},ya=({token:t,className:i=""})=>{const[a,m]=s.useState([]),[d,h]=s.useState(!1),[y,c]=s.useState(""),[p,C]=s.useState(!1),[A,b]=s.useState(""),[w,_]=s.useState([]),[N,g]=s.useState(!1),[o,r]=s.useState(null),v=s.useRef(null),j=s.useRef(null),u=s.useRef(null),T=s.useRef(null),[k,R]=s.useState({resolution:"medium",models:{"image-classification":"google/vit-base-patch16-224","object-detection":"facebook/detr-resnet-50","image-to-text":"Salesforce/blip-image-captioning-base","visual-question-answering":"dandelin/vilt-b32-finetuned-vqa"},test_images:[],confidence_threshold:.7,latency_threshold:1e4,enable_batch_testing:!1,auto_capture_interval:5}),E={low:{width:640,height:480},medium:{width:1280,height:720},high:{width:1920,height:1080}},$=s.useCallback(async()=>{try{b("");const l={video:{...E[k.resolution],facingMode:"user"}},M=await navigator.mediaDevices.getUserMedia(l);u.current=M,v.current&&(v.current.srcObject=M,await v.current.play()),g(!0)}catch(l){console.error("Failed to start camera:",l),b("Failed to access camera: "+(l instanceof Error?l.message:"Unknown error"))}},[k.resolution]),F=s.useCallback(()=>{T.current&&(clearInterval(T.current),T.current=null),u.current&&(u.current.getTracks().forEach(l=>l.stop()),u.current=null),v.current&&(v.current.srcObject=null),g(!1)},[]),n=s.useCallback(async()=>{if(!v.current||!j.current)throw new Error("Camera not ready");const l=v.current,M=j.current,O=M.getContext("2d");if(!O)throw new Error("Failed to get canvas context");return M.width=l.videoWidth,M.height=l.videoHeight,O.drawImage(l,0,0),new Promise(D=>{M.toBlob(B=>{B&&D(B)},"image/jpeg",.85)})},[]),x=s.useCallback(async()=>{try{const l=await n(),M=`capture_${Date.now()}`;_(O=>[...O,{blob:l,timestamp:new Date,id:M}]),b("")}catch(l){b("Failed to capture image: "+(l instanceof Error?l.message:"Unknown error"))}},[n]),S=s.useCallback(async(l,M,O)=>{const D=Date.now(),B=new FormData;B.append("image",M,"test-image.jpg"),B.append("taskType",l),l==="visual-question-answering"&&O&&B.append("question",O);const H={model:k.models[l],confidence_threshold:k.confidence_threshold};B.append("options",JSON.stringify(H));const J=await fetch("/api/huggingface/vision",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:B});if(!J.ok)throw new Error(`${l} test failed: ${J.statusText}`);const U=await J.json(),G=Date.now()-D,X={resolution:`${j.current?.width}x${j.current?.height}`,file_size:M.size,quality_score:M.size>1e5?.9:M.size>5e4?.7:.5};return{test_type:l,success:U.success,result:U.result,error:U.error,latency_ms:G,confidence:U.result?.confidence||0,model_used:k.models[l],provider:"huggingface",image_analysis:X}},[k,t]),I=s.useCallback(async()=>{const l=w.find(O=>O.id===o);if(!l){b("Please capture and select an image first");return}h(!0),b("");const M=[];try{c("Testing Image Classification...");const O=await S("image-classification",l.blob);M.push(O),c("Testing Object Detection...");const D=await S("object-detection",l.blob);M.push(D),c("Testing Image Description...");const B=await S("image-to-text",l.blob);M.push(B);for(let H=0;H<Math.min(2,Je.length);H++){c(`Testing Visual Q&A ${H+1}...`);const J=await S("visual-question-answering",l.blob,Je[H]);M.push(J)}m(M)}catch(O){console.error("Test suite error:",O),b(O instanceof Error?O.message:"Test suite failed")}finally{h(!1),c("")}},[w,o,S]),q=s.useCallback(()=>{if(a.length===0)return{status:"pending",message:"No tests run"};const M=a.filter(O=>O.success&&O.confidence>=k.confidence_threshold&&O.latency_ms<=k.latency_threshold).length/a.length;return M>=.8?{status:"excellent",message:"All vision systems performing well"}:M>=.6?{status:"good",message:"Most vision systems working correctly"}:M>=.4?{status:"fair",message:"Some vision issues detected"}:{status:"poor",message:"Multiple vision systems need attention"}},[a,k]);s.useEffect(()=>()=>{F()},[F]);const f=q();return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(be,{className:"h-6 w-6 text-indigo-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Camera Vision Testing"})]}),e.jsx("button",{onClick:()=>C(!p),className:"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(Se,{className:"h-5 w-5"})})]}),A&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-5 w-5 text-red-600"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:A})]})}),a.length>0&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border ${f.status==="excellent"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":f.status==="good"?"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":f.status==="fair"?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:`h-6 w-6 ${f.status==="excellent"?"text-green-600":f.status==="good"?"text-blue-600":f.status==="fair"?"text-yellow-600":"text-red-600"}`}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:["Vision Status: ",f.status.charAt(0).toUpperCase()+f.status.slice(1)]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:f.message})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:[a.filter(l=>l.success).length,"/",a.length," tests passed"]}),e.jsxs("p",{children:["Avg confidence: ",Math.round(a.reduce((l,M)=>l+M.confidence,0)/a.length*100),"%"]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Camera Control"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("button",{onClick:N?F:$,disabled:d,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${N?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-400"}`,children:[N?e.jsx(he,{className:"h-5 w-5"}):e.jsx(be,{className:"h-5 w-5"}),e.jsx("span",{children:N?"Stop Camera":"Start Camera"})]}),N&&e.jsxs("button",{onClick:x,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(ls,{className:"h-5 w-5"}),e.jsx("span",{children:"Capture Image"})]})]}),N&&e.jsx("div",{className:"mb-4 bg-black rounded-lg overflow-hidden",children:e.jsx("video",{ref:v,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full max-w-md mx-auto object-cover"})}),w.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:["Captured Images (",w.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:w.map(l=>e.jsxs("div",{className:`relative border-2 rounded-lg cursor-pointer ${o===l.id?"border-blue-500":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,onClick:()=>r(l.id),children:[e.jsx("img",{src:URL.createObjectURL(l.blob),alt:"Captured",className:"w-full h-24 object-cover rounded"}),e.jsx("div",{className:"absolute bottom-1 left-1 right-1 bg-black bg-opacity-50 text-white text-xs px-1 py-0.5 rounded text-center",children:l.timestamp.toLocaleTimeString()}),e.jsx("button",{onClick:M=>{M.stopPropagation(),_(O=>O.filter(D=>D.id!==l.id)),o===l.id&&r(null)},className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(ns,{className:"h-3 w-3"})}),o===l.id&&e.jsx("div",{className:"absolute inset-0 bg-blue-500 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"h-6 w-6 text-blue-600"})})]},l.id))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:I,disabled:!o||d,className:"flex items-center space-x-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Running Vision Tests..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-5 w-5"}),e.jsx("span",{children:"Run Vision Test Suite"})]})}),d&&y&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-indigo-600 border-t-transparent rounded-full"}),e.jsx("span",{children:y})]})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Capture an image, select it, then run the test suite to validate classification, detection, captioning, and Q&A capabilities."})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Vision Test Results"}),e.jsx("div",{className:"space-y-4",children:a.map((l,M)=>e.jsxs("div",{className:`p-4 border rounded-lg ${l.success&&l.confidence>=k.confidence_threshold&&l.latency_ms<=k.latency_threshold?"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-800":"border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[l.success?e.jsx(te,{className:"h-5 w-5 text-green-600"}):e.jsx(ne,{className:"h-5 w-5 text-red-600"}),e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:[l.test_type.replace(/-/g," ").replace(/\b\w/g,O=>O.toUpperCase())," Test"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Confidence: ",(l.confidence*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Latency: ",l.latency_ms,"ms"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:["Model: ",l.model_used]}),l.image_analysis&&e.jsxs("p",{children:["Resolution: ",l.image_analysis.resolution," | Size: ",(l.image_analysis.file_size/1024).toFixed(1),"KB"]}),l.error&&e.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error: ",l.error]}),l.success&&l.result&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-600 rounded text-xs",children:[l.test_type==="image-classification"&&l.result.classifications&&e.jsxs("div",{children:[e.jsx("strong",{children:"Classifications:"}),l.result.classifications.slice(0,3).map((O,D)=>e.jsxs("div",{children:["• ",O.label,": ",(O.confidence*100).toFixed(1),"%"]},D))]}),l.test_type==="object-detection"&&l.result.detected_objects&&e.jsxs("div",{children:[e.jsx("strong",{children:"Objects Detected:"})," ",l.result.detected_objects.length,l.result.detected_objects.slice(0,3).map((O,D)=>e.jsxs("div",{children:["• ",O.label,": ",(O.confidence*100).toFixed(1),"%"]},D))]}),l.test_type==="image-to-text"&&l.result.generated_text&&e.jsxs("div",{children:[e.jsx("strong",{children:"Description:"}),' "',l.result.generated_text,'"']}),l.test_type==="visual-question-answering"&&l.result.answer&&e.jsxs("div",{children:[e.jsx("strong",{children:"Answer:"}),' "',l.result.answer,'"']})]})]})]},M))})]}),p&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-4",children:"Vision Test Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Camera Resolution"}),e.jsxs("select",{value:k.resolution,onChange:l=>R(M=>({...M,resolution:l.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low (640x480)"}),e.jsx("option",{value:"medium",children:"Medium (1280x720)"}),e.jsx("option",{value:"high",children:"High (1920x1080)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confidence Threshold"}),e.jsx("input",{type:"number",min:"0",max:"1",step:"0.1",value:k.confidence_threshold,onChange:l=>R(M=>({...M,confidence_threshold:parseFloat(l.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Latency Threshold (ms)"}),e.jsx("input",{type:"number",min:"1000",max:"30000",step:"1000",value:k.latency_threshold,onChange:l=>R(M=>({...M,latency_threshold:parseInt(l.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Model Preferences"}),Object.entries(fa).map(([l,M])=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l.replace(/-/g," ").replace(/\b\w/g,O=>O.toUpperCase())}),e.jsx("select",{value:k.models[l],onChange:O=>R(D=>({...D,models:{...D.models,[l]:O.target.value}})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:M.map(O=>e.jsxs("option",{value:O.id,children:[O.name," (",O.quality,")"]},O.id))})]},l))]})]})]}),e.jsx("canvas",{ref:j,className:"hidden"})]})},ja=({className:t=""})=>{const[i,a]=s.useState([]),[m,d]=s.useState(null),[h,y]=s.useState(!0),[c,p]=s.useState("text-classification");s.useEffect(()=>{C()},[]);const C=async()=>{try{const[_,N]=await Promise.all([fetch("/api/ai/providers"),fetch("/api/ai/health")]),[g,o]=await Promise.all([_.json(),N.json()]);g.success&&a(g.providers),o.success&&d(o)}catch(_){console.error("Error loading compatibility data:",_)}finally{y(!1)}},A=_=>i.filter(N=>N.tasks.includes(_)),b=_=>({"text-classification":"📊","zero-shot":"🎯",ner:"🏷️",qa:"❓",generation:"✍️",asr:"🎤","vision-detection":"👁️","image-generation":"🎨",multimodal:"🔄"})[_]||"🤖",w=[...new Set(i.flatMap(_=>_.tasks))];return h?e.jsx("div",{className:`bg-gray-800 rounded-xl p-6 ${t}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-4/6"})]})]})}):e.jsxs("div",{className:`bg-gray-800 rounded-xl p-6 ${t}`,children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-2 flex items-center space-x-2",children:[e.jsx("span",{children:"🔗"}),e.jsx("span",{children:"Multi-Provider Compatibility"})]}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Seamless integration across ",i.length," AI providers with unified task routing"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total Providers"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i.length})]}),e.jsx("div",{className:"text-3xl",children:"🌐"})]})}),e.jsx("div",{className:"bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Active Services"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i.filter(_=>_.hasApiKey).length})]}),e.jsx("div",{className:"text-3xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[m?Math.round(m.metrics.successRate*100):0,"%"]})]}),e.jsx("div",{className:"text-3xl",children:"📈"})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"View Providers by Task"}),e.jsx("select",{value:c,onChange:_=>p(_.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-purple-500",children:w.map(_=>e.jsxs("option",{value:_,children:[b(_)," ",_.charAt(0).toUpperCase()+_.slice(1).replace("-"," ")]},_))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white flex items-center space-x-2",children:[e.jsx("span",{children:b(c)}),e.jsxs("span",{children:["Providers for ",c.charAt(0).toUpperCase()+c.slice(1).replace("-"," ")]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:A(c).map(_=>e.jsxs("div",{className:`border rounded-lg p-3 transition-colors ${_.hasApiKey?"border-green-500 bg-green-500/10":"border-yellow-500 bg-yellow-500/10"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-semibold text-white text-sm",children:_.name}),e.jsx("div",{className:`w-3 h-3 rounded-full ${_.hasApiKey?"bg-green-500":"bg-yellow-500"}`})]}),e.jsxs("div",{className:"text-xs text-gray-400 space-y-1",children:[e.jsxs("div",{children:["Status: ",_.hasApiKey?"Active":"Pending"]}),e.jsxs("div",{children:["Models: ",_.models.length]}),e.jsxs("div",{children:["Tasks: ",_.tasks.length]})]}),_.models.length>0&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("div",{className:"text-gray-500",children:"Top Model:"}),e.jsx("div",{className:"text-purple-400 truncate",children:_.models[0]})]})]},_.key))}),A(c).length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🚫"}),e.jsx("p",{children:"No providers available for this task"})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-700",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"🔧 Integration Features"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-medium text-purple-400",children:"Unified Interface"}),e.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ Single API endpoint for all providers"}),e.jsx("li",{children:"✅ Automatic provider selection"}),e.jsx("li",{children:"✅ Standardized request/response format"}),e.jsx("li",{children:"✅ Built-in fallback mechanisms"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-medium text-purple-400",children:"Smart Routing"}),e.jsxs("ul",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ Task-specific provider optimization"}),e.jsx("li",{children:"✅ Load balancing and rate limiting"}),e.jsx("li",{children:"✅ Real-time health monitoring"}),e.jsx("li",{children:"✅ Cost and performance optimization"})]})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{onClick:()=>window.open("/dashboard?view=aiproviders","_blank"),className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-colors flex items-center space-x-2 mx-auto",children:[e.jsx("span",{children:"🚀"}),e.jsx("span",{children:"Explore Multi-Provider AI Hub"})]})})]})},Qe=[{id:"dashboard",name:"Dashboard",icon:we,description:"System health and performance metrics"},{id:"models",name:"Model Catalog",icon:ge,description:"Browse and select HuggingFace models"},{id:"rag",name:"RAG Pipeline",icon:rs,description:"Document-based question answering"},{id:"voice",name:"Voice AI",icon:ce,description:"Speech-to-text and voice processing"},{id:"vision",name:"Computer Vision",icon:be,description:"Image analysis and understanding"},{id:"audio-test",name:"Audio Testing",icon:Fe,description:"Test audio processing capabilities"},{id:"camera-test",name:"Vision Testing",icon:Fe,description:"Test computer vision capabilities"}],va=({token:t,className:i=""})=>{const[a,m]=s.useState("dashboard"),[d,h]=s.useState(),[y,c]=s.useState(null),[p,C]=s.useState(null),A=s.useCallback(N=>{h(N),console.log("[HF Hub] Model selected:",N.repo_id)},[]),b=s.useCallback(N=>{c(N),console.log("[HF Hub] Voice transcript received:",N.transcript)},[]),w=s.useCallback(N=>{C(N),console.log("[HF Hub] Vision analysis received:",N)},[]),_=()=>{switch(a){case"dashboard":return e.jsxs("div",{className:"space-y-6",children:[e.jsx(da,{token:t,className:"w-full"}),e.jsx(ja,{className:"w-full"})]});case"models":return e.jsx(ca,{onSelectModel:A,selectedModel:d,className:"w-full"});case"rag":return e.jsx(oa,{token:t,className:"w-full"});case"voice":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Enhanced Voice AI"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx(xa,{onTranscript:b,token:t,showAdvancedSettings:!0,className:"flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:y?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Latest Transcription"}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("span",{children:["Model: ",y.model.split("/").pop()]}),e.jsxs("span",{children:["Confidence: ",Math.round(y.confidence*100),"%"]}),e.jsxs("span",{children:["Latency: ",y.latency_ms,"ms"]})]})]}),e.jsxs("blockquote",{className:"text-blue-800 dark:text-blue-200 italic",children:['"',y.transcript,'"']}),e.jsxs("div",{className:"mt-2 text-xs text-blue-600 dark:text-blue-400",children:["Words: ",y.word_count," |",y.language_detected&&` Language: ${y.language_detected} |`,"Provider: ",y.provider]})]}):e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Click the microphone button to start voice recording with HuggingFace STT"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Advanced STT"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ Multiple model support (Whisper, Wav2Vec2)"}),e.jsx("li",{children:"✅ Multilingual recognition"}),e.jsx("li",{children:"✅ Confidence scoring"}),e.jsx("li",{children:"✅ Real-time audio analysis"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Quality Control"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ Audio validation"}),e.jsx("li",{children:"✅ Noise reduction"}),e.jsx("li",{children:"✅ Quality metrics"}),e.jsx("li",{children:"✅ Auto punctuation"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Performance"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ Sub-5s processing"}),e.jsx("li",{children:"✅ Fallback models"}),e.jsx("li",{children:"✅ Cost optimization"}),e.jsx("li",{children:"✅ Real-time feedback"})]})]})]})]});case"vision":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Enhanced Computer Vision"}),e.jsxs("div",{className:"flex items-start space-x-6",children:[e.jsx(pa,{onAnalysis:w,token:t,showAdvancedSettings:!0,className:"flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:p?e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-100",children:"Latest Vision Analysis"}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm text-green-700 dark:text-green-300",children:[e.jsxs("span",{children:["Task: ",p.task_type]}),e.jsxs("span",{children:["Confidence: ",Math.round(p.confidence*100),"%"]}),e.jsxs("span",{children:["Time: ",p.processing_time_ms,"ms"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[p.classifications&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-green-800 dark:text-green-200",children:"Classifications:"}),e.jsx("div",{className:"mt-1",children:p.classifications.slice(0,3).map((N,g)=>e.jsxs("div",{className:"text-green-700 dark:text-green-300",children:["• ",N.label,": ",Math.round(N.confidence*100),"%"]},g))})]}),p.detected_objects&&e.jsxs("div",{children:[e.jsxs("strong",{className:"text-green-800 dark:text-green-200",children:["Objects (",p.detected_objects.length," detected):"]}),e.jsx("div",{className:"mt-1",children:p.detected_objects.slice(0,5).map((N,g)=>e.jsxs("div",{className:"text-green-700 dark:text-green-300",children:["• ",N.label,": ",Math.round(N.confidence*100),"%"]},g))})]}),p.generated_text&&e.jsxs("div",{children:[e.jsx("strong",{className:"text-green-800 dark:text-green-200",children:"Description:"}),e.jsxs("p",{className:"mt-1 text-green-700 dark:text-green-300 italic",children:['"',p.generated_text,'"']})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-green-600 dark:text-green-400",children:["Model: ",p.model_used," | Provider: HuggingFace"]})]}):e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Click the camera button to start image analysis with HuggingFace Vision"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Classification"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ ViT models"}),e.jsx("li",{children:"✅ ResNet variants"}),e.jsx("li",{children:"✅ Custom categories"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Object Detection"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ DETR models"}),e.jsx("li",{children:"✅ Bounding boxes"}),e.jsx("li",{children:"✅ Multi-object"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Image Captioning"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ BLIP models"}),e.jsx("li",{children:"✅ GIT variants"}),e.jsx("li",{children:"✅ Context-aware"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Visual Q&A"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"✅ ViLT models"}),e.jsx("li",{children:"✅ Custom questions"}),e.jsx("li",{children:"✅ Context reasoning"})]})]})]})]});case"audio-test":return e.jsx(ba,{token:t,className:"w-full"});case"camera-test":return e.jsx(ya,{token:t,className:"w-full"});default:return e.jsx("div",{children:"Tab content not implemented"})}};return e.jsxs("div",{className:`bg-gray-50 dark:bg-gray-900 rounded-lg shadow-xl ${i}`,children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HuggingFace AI Integration Hub"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Advanced AI capabilities with enhanced routing, RAG, and multimodal processing"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"px-3 py-1 bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 rounded-full text-sm font-medium",children:"Enhanced"}),e.jsx("div",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-full text-sm font-medium",children:"v2.0"})]})]})}),e.jsx("div",{className:"px-6 py-3 border-b border-gray-200 dark:border-gray-700 overflow-x-auto",children:e.jsx("nav",{className:"flex space-x-1",children:Qe.map(N=>e.jsxs("button",{onClick:()=>m(N.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${a===N.id?"bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:N.description,children:[e.jsx(N.icon,{className:"h-4 w-4"}),e.jsx("span",{children:N.name})]},N.id))})}),e.jsx("div",{className:"p-6",children:_()}),e.jsx("div",{className:"px-6 py-3 bg-gray-100 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 rounded-b-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Active Tab: ",Qe.find(N=>N.id===a)?.name]}),d&&e.jsxs("span",{children:["Selected Model: ",d.repo_id]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 dark:text-gray-400",children:[y&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(ce,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{children:["Last STT: ",y.word_count," words"]})]}),p&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(be,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:["Last Vision: ",p.task_type]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"HuggingFace Integration Hub • Enhanced with Advanced Routing & RAG"})]})]})})]})},Ye=({data:t,stroke:i="#60a5fa",width:a=160,height:m=40})=>{if(!t||!t.length)return e.jsx("svg",{width:a,height:m});const d=t.filter(A=>typeof A.v=="number"&&!isNaN(A.v)&&isFinite(A.v));if(d.length===0)return e.jsx("svg",{width:a,height:m});const h=d.map(A=>A.v),y=Math.min(...h),p=Math.max(...h)-y||1,C=d.map((A,b)=>{const w=d.length>1?b/(d.length-1)*(a-4)+2:a/2,_=m-2-(A.v-y)/p*(m-4);return!isFinite(w)||!isFinite(_)?null:`${w},${_}`}).filter(A=>A!==null).join(" ");return C?e.jsx("svg",{width:a,height:m,className:"overflow-visible",children:e.jsx("polyline",{fill:"none",stroke:i,strokeWidth:2,points:C})}):e.jsx("svg",{width:a,height:m})},Na=({data:t,width:i=200,height:a=60,barColor:m="#a855f7"})=>{if(!t||t.length===0)return e.jsx("svg",{width:i,height:a});const d=t.filter(c=>typeof c=="number"&&!isNaN(c)&&isFinite(c)&&c>=0);if(d.length===0)return e.jsx("svg",{width:i,height:a});const h=Math.max(...d,1),y=i/d.length;return e.jsx("svg",{width:i,height:a,children:d.map((c,p)=>{const C=Math.max(0,c/h*(a-4)),A=p*y+1,b=a-C-2;return!isFinite(A)||!isFinite(b)||!isFinite(C)||C<0?null:e.jsx("rect",{x:A,y:b,width:Math.max(0,y-2),height:C,rx:2,fill:m},p)}).filter(c=>c!==null)})},Ze=({value:t,max:i=100,label:a})=>{const m=typeof t=="number"&&isFinite(t)?Math.max(0,t):0,d=typeof i=="number"&&isFinite(i)&&i>0?i:100,h=Math.min(1,Math.max(0,m/d)),y=h*180;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-40 h-20",children:[e.jsxs("svg",{viewBox:"0 0 100 50",className:"w-full h-full",children:[e.jsx("path",{d:"M5 50 A45 45 0 0 1 95 50",fill:"none",stroke:"#374151",strokeWidth:8}),e.jsx("path",{d:"M5 50 A45 45 0 0 1 95 50",fill:"none",stroke:"#4ade80",strokeWidth:8,strokeDasharray:`${Math.PI*45} ${Math.PI*45}`,strokeDashoffset:(1-h)*Math.PI*45,strokeLinecap:"round"}),e.jsx("g",{transform:"translate(50,50)",children:e.jsx("line",{x1:0,y1:0,x2:Math.sin((-90+y)*(Math.PI/180))*35,y2:Math.cos((-90+y)*(Math.PI/180))*-35,stroke:"#fbbf24",strokeWidth:4,strokeLinecap:"round"})})]}),e.jsxs("div",{className:"absolute inset-0 flex items-end justify-center pb-1 text-xs text-slate-300",children:[Math.round(h*100),"%"]})]}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:a})]})},wa=({data:t,label:i})=>{const a=t.reduce((h,y)=>h+parseInt(y.count||y.user_count||0),0);if(a===0)return e.jsx("div",{className:"text-slate-500 text-xs",children:"No data"});let m=0;const d=["#60a5fa","#34d399","#fbbf24","#f87171","#a855f7"];return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{viewBox:"0 0 42 42",className:"w-full h-full",children:[e.jsx("circle",{cx:"21",cy:"21",r:"15.915",fill:"transparent",stroke:"#334155",strokeWidth:"3"}),t.map((h,y)=>{const c=parseInt(h.count||h.user_count||0)/a*100,p=`${c} ${100-c}`,C=-m;return m+=c,e.jsx("circle",{cx:"21",cy:"21",r:"15.915",fill:"transparent",stroke:d[y%d.length],strokeWidth:"3",strokeDasharray:p,strokeDashoffset:C,transform:"rotate(-90 21 21)"},y)})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-sm text-white font-semibold",children:a})]}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:i})]})},ka=({activities:t})=>{const i=(m,d)=>{if(m==="security")switch(d){case"reveal_token_created":return"🔓";case"reveal_token_used":return"👁️";case"preferences_updated":return"⚙️";default:return"🔒"}return m==="api_usage"?"🔑":"📋"},a=m=>{const d=Date.now()-new Date(m).getTime(),h=Math.floor(d/6e4);return h<1?"just now":h<60?`${h}m ago`:`${Math.floor(h/60)}h ago`};return e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:t.length===0?e.jsx("div",{className:"text-slate-500 text-xs text-center py-4",children:"No recent activity"}):t.map((m,d)=>e.jsxs("div",{className:"flex items-start space-x-3 p-2 hover:bg-slate-800/50 rounded",children:[e.jsx("span",{className:"text-lg",children:i(m.type,m.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-slate-300 truncate",children:[m.action.replace(/_/g," "),m.user_id&&e.jsxs("span",{className:"text-slate-500",children:[" • User ",m.user_id]})]}),e.jsx("p",{className:"text-xs text-slate-400",children:a(m.created_at)})]})]},d))})},Sa=({metrics:t})=>{if(!t.system_info)return e.jsx("div",{className:"text-slate-500 text-xs",children:"Loading..."});const{memory_usage:i}=t.system_info,a=i?i.used/i.total*100:0,m=t.database_stats?.database_size?(parseInt(t.database_stats.database_size)/(1024*1024*1024)).toFixed(2):"0";return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:[a.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Memory Usage"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[m,"GB"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"DB Size"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:t.database_stats?.active_connections||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"DB Connections"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:[Math.floor(t.system_info?.uptime_seconds/3600)||0,"h"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Uptime"})]})]})},Ca=({token:t,onBack:i})=>{const[a,m]=s.useState({}),[d,h]=s.useState([]),[y,c]=s.useState([]),[p,C]=s.useState([2,4,6,9,7,3,1]),[A,b]=s.useState(12),[w,_]=s.useState({}),[N,g]=s.useState({}),[o,r]=s.useState({}),[v,j]=s.useState([]),[u,T]=s.useState(85),k=s.useRef();s.useEffect(()=>{const E=async()=>{try{const F=await fetch("/api/health/system",{headers:{Authorization:`Bearer ${t}`}});if(F.ok){const n=await F.json();m({overall:n.status||n.overall,timestamp:n.timestamp||new Date().toISOString(),services:n.services,uptime_seconds:n.uptime||n.uptimeSeconds})}}catch{}},$=async()=>{try{const F=await fetch("/api/health/metrics/security",{headers:{Authorization:`Bearer ${t}`}});F.ok&&_((await F.json()).data||{});const n=await fetch("/api/health/metrics/api-keys",{headers:{Authorization:`Bearer ${t}`}});n.ok&&g((await n.json()).data||{});const x=await fetch("/api/health/metrics/performance",{headers:{Authorization:`Bearer ${t}`}});if(x.ok){const I=await x.json();r(I.data||{}),T(I.data?.health_score||85)}const S=await fetch("/api/health/metrics/activity",{headers:{Authorization:`Bearer ${t}`}});S.ok&&j((await S.json()).data?.activities||[])}catch{}};E(),$()},[t]),s.useEffect(()=>{const E=Date.now(),$=setInterval(()=>{const F=Date.now();h(n=>[...n,{t:F,v:(F-E)/1e3/60}].slice(-50)),c(n=>{const x=n.length?n[n.length-1].v:.5,S=Math.max(0,x+(Math.random()-.5)*.2);return[...n,{t:F,v:S}].slice(-50)}),C(n=>n.map(x=>Math.max(0,x+Math.round((Math.random()-.5)*2)))),b(n=>Math.max(5,Math.min(60,n+Math.round((Math.random()-.5)*4))))},3e3);return k.current=$,()=>clearInterval($)},[]);const R=a.overall==="healthy"?"text-green-400":"text-red-400";return e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-slate-600/50 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"System Health"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Operational metrics & service status (preview)"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:i,className:"bg-purple-600/80 hover:bg-purple-600 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]})})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"glass-card p-5 rounded-xl",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400 mb-1",children:"Overall"}),e.jsx("div",{className:`text-lg font-semibold ${R}`,children:a.overall||"—"}),e.jsxs("div",{className:"text-[10px] text-slate-500 mt-2",children:["Updated ",a.timestamp?new Date(a.timestamp).toLocaleTimeString():"—"]})]}),e.jsxs("div",{className:"glass-card p-5 rounded-xl",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400 mb-1",children:"Uptime (min)"}),e.jsx(Ye,{data:d})]}),e.jsxs("div",{className:"glass-card p-5 rounded-xl",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400 mb-1",children:"Error Rate (sim)"}),e.jsx(Ye,{data:y,stroke:"#f87171"})]}),e.jsx("div",{className:"glass-card p-5 rounded-xl flex items-center justify-center",children:e.jsx(Ze,{value:A,max:60,label:"DB Connections"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🔒"}),e.jsx("span",{children:"Security Events"})]}),e.jsx(wa,{data:w.user_preferences||[],label:"User Preferences"})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🔑"}),e.jsx("span",{children:"API Key Stats"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:N.api_key_stats?.active_keys||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"Active Keys"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:N.api_key_stats?.recently_used||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"Recently Used"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:w.reveal_token_stats?.total_tokens_created||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"Reveal Tokens"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:w.total_users_with_preferences||0}),e.jsx("div",{className:"text-xs text-slate-400",children:"Configured Users"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"📊"}),e.jsx("span",{children:"System Performance"})]}),e.jsx(Sa,{metrics:o})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"💯"}),e.jsx("span",{children:"Health Score"})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Ze,{value:u,max:100,label:"Overall Health"})})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"📈"}),e.jsx("span",{children:"Live Activity"})]}),e.jsx(ka,{activities:v})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"glass-card p-6 rounded-xl lg:col-span-2",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"⏱️"}),e.jsx("span",{children:"Request Latency Histogram (simulated)"})]}),e.jsx(Na,{data:p}),e.jsx("div",{className:"grid grid-cols-7 text-[10px] text-slate-400 mt-2",children:p.map((E,$)=>e.jsxs("div",{className:"text-center",children:["B",$+1]},$))})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"�"}),e.jsx("span",{children:"Services"})]}),e.jsx("div",{className:"space-y-2 text-sm",children:a.services?Object.entries(a.services).map(([E,$])=>{const F=$.status==="healthy"?"text-green-400":"text-red-400";return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 truncate mr-2",children:E}),e.jsxs("span",{className:`flex items-center space-x-1 ${F}`,children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:$.status==="healthy"?"#22c55e":"#ef4444"}}),e.jsx("span",{children:$.status})]})]},E)}):e.jsx("div",{className:"text-slate-500 text-xs",children:"No service data yet."})})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-2 flex items-center space-x-2",children:[e.jsx("span",{children:"✨"}),e.jsx("span",{children:"Enhanced Dashboard Features"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-green-400 mb-1",children:"✅ Recently Added"}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-slate-300 space-y-1",children:[e.jsx("li",{children:"Security masking controls & metrics"}),e.jsx("li",{children:"API key rotation scheduling"}),e.jsx("li",{children:"Real-time activity monitoring"}),e.jsx("li",{children:"Enhanced system performance metrics"}),e.jsx("li",{children:"Overall health score calculation"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-400 mb-1",children:"🚀 Coming Soon"}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-slate-300 space-y-1",children:[e.jsx("li",{children:"Real-time WebSocket metrics stream"}),e.jsx("li",{children:"Historical data retention & time ranges"}),e.jsx("li",{children:"Service dependency graph visualization"}),e.jsx("li",{children:"Advanced alerting & notification system"}),e.jsx("li",{children:"Custom dashboard layouts"})]})]})]})]})]})]})},Pe=[{id:"action_required",name:"Action Needed",icon:"⚠️"},{id:"updates",name:"Updates / Notifications",icon:"🔔"},{id:"low_priority",name:"Low Priority",icon:"🌙"}],_a=({token:t,onBack:i})=>{const a=Ce(),[m,d]=s.useState([]),[h,y]=s.useState(!1),[c,p]=s.useState(new Set),[C,A]=s.useState(null),[b,w]=s.useState(!1),[_,N]=s.useState(Pe[0].id),[g,o]=s.useState(!1);s.useEffect(()=>{const k=()=>o(window.innerWidth<1024);return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const r=async()=>{y(!0);try{const k=await fetch(`/api/email/messages?limit=40&unread_only=${b}`,{headers:{Authorization:`Bearer ${t}`}});if(k.ok){const R=await k.json(),E=(R?.messages||R?.data||[]).map(($,F)=>({id:$.id||`msg_${F}`,from:$.from||$.sender||"Unknown sender",subject:$.subject||"No subject",preview:$.preview||$.snippet||$.body?.substring(0,100)||"No preview available",timestamp:$.timestamp||$.date||new Date().toISOString(),read:!!$.read,category:$.category||"misc",ai_summary:$.ai_summary||`Auto-categorized as ${$.category||"misc"}`,confidence:$.confidence||.8,priority:$.priority||"normal"}));d(b?E.filter($=>!$.read):E),E.length===0?a.info("Inbox Empty",b?"No unread messages found":"No messages in inbox"):a.success("Inbox Loaded",`Found ${E.length} messages`)}else{const R=await k.text();a.error("API Error",`Failed to load messages: ${k.status} ${R}`),d([])}}catch(k){console.error("Email fetch error:",k),a.error("Network Error","Unable to connect to email service"),d([])}finally{y(!1)}};s.useEffect(()=>{r()},[t,b]);const v=k=>{p(R=>{const E=new Set(R);return E.has(k)?E.delete(k):E.add(k),E})},j=()=>{d(k=>k.map(R=>c.has(R.id)?{...R,read:!0}:R)),p(new Set)},u=(k,R)=>{d(E=>E.map($=>$.id===k?{...$,category:R}:$))},T=Pe.map(k=>({bucket:k,items:m.filter(R=>k.id==="action_required"?["welcome","personal","finance","security"].includes(R.category)||R.priority==="high":k.id==="updates"?["notifications","updates","system"].includes(R.category)||R.priority==="normal":k.id==="low_priority"?["promotions","misc","low","marketing"].includes(R.category)||R.priority==="low":!1)}));return e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-slate-600/50 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"AI Email Inbox"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Triage and prioritize with AI-assisted categorization (preview)"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:k=>w(k.target.checked),className:"rounded"}),e.jsx("span",{children:"Unread Only"})]}),e.jsx("button",{onClick:r,disabled:h,className:"bg-blue-600/80 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm disabled:opacity-50 flex items-center space-x-2",children:e.jsx("span",{children:h?"Loading...":"Refresh"})})]})]})}),c.size>0&&e.jsx("div",{className:"sticky top-0 z-40 bg-purple-900/70 backdrop-blur border-b border-purple-500/40 text-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-2 flex items-center justify-between",children:[e.jsxs("div",{children:[c.size," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:j,className:"px-3 py-1 bg-green-600 hover:bg-green-500 rounded",children:"Mark Read"}),e.jsx("button",{onClick:()=>p(new Set),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded",children:"Clear"})]})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[g&&e.jsx("div",{className:"lg:hidden mb-4 flex items-center justify-between gap-2",children:Pe.map(k=>e.jsxs("button",{onClick:()=>N(k.id),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors ${_===k.id?"bg-blue-600 border-blue-500 text-white":"bg-slate-800/60 border-slate-700 text-slate-300"}`,children:[k.icon," ",k.name.split(" ")[0]]},k.id))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:T.filter(k=>!g||k.bucket.id===_).map(({bucket:k,items:R})=>e.jsxs("div",{className:"glass-card p-4 rounded-xl flex flex-col min-h-[560px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center space-x-2",children:[e.jsx("span",{children:k.icon}),e.jsx("span",{children:k.name})]}),e.jsx("span",{className:"text-xs text-slate-400",children:R.length})]}),e.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto pr-1",children:[R.map(E=>{const $=c.has(E.id);return e.jsxs("div",{className:`border border-slate-700 rounded-lg p-3 group hover:border-purple-500 transition-colors relative ${E.read?"bg-slate-800/40":"bg-slate-800/70"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>A(C===E.id?null:E.id),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${E.read?"bg-slate-600":"bg-blue-400 animate-pulse"}`}),e.jsx("span",{className:"text-sm font-semibold truncate max-w-[140px]",children:E.from}),e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-slate-700 text-slate-300",children:(E.confidence||0).toFixed(2)}),E.priority==="high"&&e.jsx("span",{className:"text-[10px] px-1 py-0.5 bg-red-600/70 rounded",children:"HIGH"})]}),e.jsx("div",{className:"mt-1 text-sm text-slate-200 line-clamp-1",children:E.subject}),e.jsx("div",{className:"text-xs text-slate-500 line-clamp-1",children:E.preview})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-2 ml-2",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:()=>v(E.id)}),e.jsxs("select",{value:E.category,onChange:F=>u(E.id,F.target.value),className:"bg-slate-700 text-slate-300 text-[10px] rounded px-1 py-0.5 focus:outline-none",children:[e.jsx("option",{value:"welcome",children:"welcome"}),e.jsx("option",{value:"notifications",children:"notifications"}),e.jsx("option",{value:"updates",children:"updates"}),e.jsx("option",{value:"promotions",children:"promotions"}),e.jsx("option",{value:"personal",children:"personal"}),e.jsx("option",{value:"security",children:"security"}),e.jsx("option",{value:"finance",children:"finance"}),e.jsx("option",{value:"misc",children:"misc"})]})]})]}),C===E.id&&e.jsxs("div",{className:"mt-3 border-t border-slate-700 pt-3 text-xs space-y-2",children:[e.jsx("div",{className:"text-slate-400",children:"AI Summary:"}),e.jsx("div",{className:"text-slate-300 leading-relaxed",children:E.ai_summary||"No summary available (mock)."}),e.jsxs("div",{className:"flex items-center space-x-2 text-slate-500",children:[e.jsx("span",{children:new Date(E.timestamp).toLocaleString()}),e.jsx("span",{children:"•"}),e.jsx("button",{className:"text-purple-400 hover:text-purple-300",children:"Suggest Actions"}),e.jsx("span",{children:"•"}),e.jsx("button",{className:"text-blue-400 hover:text-blue-300",onClick:()=>d(F=>F.map(n=>n.id===E.id?{...n,read:!0}:n)),children:"Mark Read"})]})]})]},E.id)}),R.length===0&&e.jsx("div",{className:"text-xs text-slate-600 text-center py-8",children:"No messages in this bucket."})]})]},k.id))}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center space-x-2",children:[e.jsx("span",{children:"🛠️"}),e.jsx("span",{children:"Upcoming Inbox Features"})]}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-slate-300 space-y-1",children:[e.jsx("li",{children:"Backend reclassify & bulk endpoints"}),e.jsx("li",{children:"Adaptive model retraining stats & drift alerts"}),e.jsx("li",{children:"Action suggestion model integration"}),e.jsx("li",{children:"Thread grouping & conversation view"}),e.jsx("li",{children:"Snooze & follow-up reminders"})]})]})]})]})},Aa=({onBack:t})=>{const i=Ce(),[a,m]=s.useState([]),[d,h]=s.useState(null),[y,c]=s.useState(!0),[p,C]=s.useState("overview"),[A,b]=s.useState("text-classification"),[w,_]=s.useState(""),[N,g]=s.useState(""),[o,r]=s.useState("auto"),[v,j]=s.useState(!1),[u,T]=s.useState([]),k=[{name:"Sentiment Analysis",task:"text-classification",input:"I love this product! It works amazingly well.",description:"Detect positive/negative sentiment"},{name:"Topic Classification",task:"zero-shot",input:"This is a great educational resource for learning machine learning",params:{candidate_labels:["education","technology","business","entertainment","sports"]},description:"Classify text into predefined categories"},{name:"Named Entity Recognition",task:"ner",input:"My name is John Smith and I work at Microsoft in Seattle.",description:"Extract people, organizations, and locations from text"},{name:"Question Answering",task:"qa",input:{question:"What is the capital of France?",context:"France is a country in Western Europe. Its capital and largest city is Paris, located in the north-central part of the country."},description:"Answer questions based on provided context"},{name:"Text Generation",task:"generation",input:{messages:[{role:"user",content:"Write a short poem about artificial intelligence"}]},params:{max_tokens:100,temperature:.7},description:"Generate creative text using language models"}],R=s.useMemo(()=>async(x,S={},I=1e4)=>{const q=new AbortController,f=setTimeout(()=>q.abort(),I);try{return await fetch(x,{...S,signal:q.signal})}finally{clearTimeout(f)}},[]);s.useEffect(()=>{(async()=>{c(!0);try{let S=null,I=null;try{const[q,f]=await Promise.all([R("/api/ai/providers"),R("/api/ai/health")]);q.ok&&(S=await q.json()),f.ok&&(I=await f.json())}catch{}if(!S)try{const q=await R("/api/unified/health");if(q.ok){const f=await q.json();S={success:!0,providers:(f.availableModels||[]).map(l=>({key:l,name:l,hasApiKey:!0,tasks:["chat","embeddings","asr","image","classify","summarize"],models:[l]}))},I={success:!0,status:f.status==="healthy"?"operational":"degraded",metrics:f.metrics,version:"unified-bridge"}}}catch{}S?.success&&m(S.providers||[]),(I?.success||I?.status)&&h(I)}catch(S){console.error("Error loading AI providers data:",S),i.error("Failed to load AI providers","Please check your connection and try again")}finally{c(!1)}})()},[i]);const E=async x=>{j(!0);try{const S=x?{task:x.task,input:x.input,params:x.params||{},preferredModels:o!=="auto"?[o]:[]}:{task:A,input:A==="qa"?JSON.parse(w):w,params:N?JSON.parse(N):{},preferredModels:o!=="auto"?[o]:[]};let I=null;try{const q=await R("/api/ai/inference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)});q.ok&&(I=await q.json())}catch{}if(!I){const f={"text-classification":"classify","zero-shot":"classify",ner:"nlp_classic",qa:"nlp_classic",generation:"chat"}[S.task]||S.task,l=f==="chat"&&S.input?.messages?{messages:S.input.messages}:S.input;I=await(await R("/api/unified/inference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task:f,inputs:l,options:S.params})})).json()}if(I?.success){const q={id:I.id||Math.random().toString(36).slice(2),task:I.task||S.task,model:I.model||"unknown",latencyMs:I.latencyMs||0,payload:I.payload,confidence:I.confidence,warnings:I.warnings||[]};T(f=>[q,...f.slice(0,9)]),i.success("Test completed",`${x?.name||A} executed successfully`)}else i.error("Test failed",I?.error||"Unknown error occurred")}catch(S){console.error("Test error:",S),i.error("Test failed","Please check your input and try again")}finally{j(!1)}},$=x=>{if(x.task==="text-classification"&&Array.isArray(x.payload)&&x.payload[0]){const S=x.payload[0][0];return`${S.label}: ${(S.score*100).toFixed(1)}%`}if(x.task==="zero-shot"&&x.payload?.labels){const S=x.payload.labels[0],I=x.payload.scores[0];return`${S}: ${(I*100).toFixed(1)}%`}return x.task==="ner"&&Array.isArray(x.payload)?`Found ${x.payload.length} entities`:x.task==="qa"&&x.payload?.answer?`"${x.payload.answer}" (${(x.payload.score*100).toFixed(1)}%)`:"Completed successfully"},F=x=>x.hasApiKey?"bg-green-500":"bg-yellow-500",n=x=>({"text-classification":"📊","zero-shot":"🎯",ner:"🏷️",qa:"❓",generation:"✍️",asr:"🎤","vision-detection":"👁️","image-generation":"🎨",multimodal:"🔄"})[x]||"🤖";return y?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-500 mx-auto"}),e.jsx("p",{className:"text-white text-xl mt-4",children:"Loading AI Providers..."})]})}):e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-slate-600/50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50",children:"← Back"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"🤖 Multi-Provider AI Hub"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Configure and manage model backends"})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-400",children:"Service Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d?.status==="operational"?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm font-semibold",children:d?.status||"Unknown"})]})]})})]})}),e.jsx("div",{className:"bg-slate-800 border-b border-slate-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"overview",name:"Overview",icon:"📊"},{id:"testing",name:"Live Testing",icon:"🧪"},{id:"providers",name:"Provider Matrix",icon:"🎛️"},{id:"analytics",name:"Analytics",icon:"📈"}].map(x=>e.jsxs("button",{onClick:()=>C(x.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${p===x.id?"border-purple-500 text-purple-400":"border-transparent text-slate-400 hover:text-white hover:border-slate-300"}`,children:[e.jsx("span",{className:"mr-2",children:x.icon}),x.name]},x.id))})})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[p==="overview"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100",children:"Total Providers"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsx("div",{className:"text-3xl",children:"🤖"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100",children:"Active Providers"}),e.jsx("p",{className:"text-2xl font-bold",children:a.filter(x=>x.hasApiKey).length})]}),e.jsx("div",{className:"text-3xl",children:"✅"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-bold",children:[...new Set(a.flatMap(x=>x.tasks))].length})]}),e.jsx("div",{className:"text-3xl",children:"🎯"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-orange-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100",children:"Avg Latency"}),e.jsxs("p",{className:"text-2xl font-bold",children:[d?.metrics?.avgLatency?.toFixed(0)||"0","ms"]})]}),e.jsx("div",{className:"text-3xl",children:"⚡"})]})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"⚡"}),e.jsx("span",{children:"Quick AI Tasks"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map((x,S)=>e.jsxs("div",{className:"border border-slate-700 rounded-lg p-4 hover:border-purple-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:n(x.task)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:x.name}),e.jsx("p",{className:"text-slate-400 text-sm",children:x.description})]})]}),e.jsx("button",{onClick:()=>E(x),disabled:v,className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-600 rounded-lg font-semibold transition-colors",children:v?"🔄 Testing...":"▶️ Run Test"})]},S))})]}),u.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"📋"}),e.jsx("span",{children:"Recent Test Results"})]}),e.jsx("div",{className:"space-y-3",children:u.slice(0,5).map((x,S)=>e.jsxs("div",{className:"border border-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:n(x.task)}),e.jsx("span",{className:"font-semibold text-white capitalize",children:x.task.replace("-"," ")}),e.jsxs("span",{className:"text-sm text-slate-400",children:["via ",x.model]})]}),e.jsxs("span",{className:"text-sm text-slate-400",children:[x.latencyMs.toFixed(1),"ms"]})]}),e.jsx("p",{className:"text-purple-400 text-sm",children:$(x)}),x.warnings&&x.warnings.length>0&&e.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:["⚠️ ",x.warnings.join(", ")]})]},S))})]})]}),p==="testing"&&e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"🧪"}),e.jsx("span",{children:"Custom AI Testing Lab"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Task Type"}),e.jsxs("select",{value:A,onChange:x=>b(x.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-purple-500",children:[e.jsx("option",{value:"text-classification",children:"Text Classification"}),e.jsx("option",{value:"zero-shot",children:"Zero-Shot Classification"}),e.jsx("option",{value:"ner",children:"Named Entity Recognition"}),e.jsx("option",{value:"qa",children:"Question Answering"}),e.jsx("option",{value:"generation",children:"Text Generation"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Test Input"}),e.jsx("textarea",{value:w,onChange:x=>_(x.target.value),rows:4,className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-purple-500",placeholder:`Enter your ${A} input...`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Parameters (JSON)"}),e.jsx("textarea",{value:N,onChange:x=>g(x.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-purple-500",placeholder:'{"temperature": 0.7, "max_tokens": 100}'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Preferred Provider"}),e.jsxs("select",{value:o,onChange:x=>r(x.target.value),className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-purple-500",children:[e.jsx("option",{value:"auto",children:"Auto-select best provider"}),a.map(x=>e.jsxs("option",{value:x.key,children:[x.name," ",x.hasApiKey?"✅":"⚠️"]},x.key))]})]}),e.jsx("button",{onClick:()=>E(),disabled:v||!w.trim(),className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-600 rounded-lg font-semibold transition-colors",children:v?"🔄 Running Test...":"🚀 Execute Test"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Test Results"}),u.length===0?e.jsxs("div",{className:"border-2 border-dashed border-slate-600 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🎯"}),e.jsx("p",{className:"text-slate-400",children:"No test results yet"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Run a test to see results here"})]}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:u.map((x,S)=>e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:n(x.task)}),e.jsx("span",{className:"font-semibold text-white capitalize",children:x.task.replace("-"," ")})]}),e.jsxs("div",{className:"text-right text-sm text-slate-400",children:[e.jsxs("div",{children:["Latency: ",x.latencyMs.toFixed(1),"ms"]}),typeof x.confidence=="number"&&e.jsxs("div",{children:["Confidence: ",(x.confidence*100).toFixed(0),"%"]})]})]}),e.jsx("div",{className:"bg-slate-800 rounded p-3 text-sm",children:e.jsx("pre",{className:"text-green-400 whitespace-pre-wrap",children:JSON.stringify(x.payload,null,2)})})]},S))})]})]})]})}),p==="providers"&&e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"🎛️"}),e.jsx("span",{children:"Provider Capability Matrix"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:a.map(x=>e.jsxs("div",{className:"border border-slate-700 rounded-lg p-5 hover:border-purple-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-white text-lg",children:x.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${F(x)}`}),e.jsx("span",{className:"text-xs text-slate-400",children:x.hasApiKey?"Active":"Pending"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Supported Tasks"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.tasks.map((S,I)=>e.jsxs("span",{className:"px-2 py-1 bg-purple-600/20 text-purple-300 rounded text-xs",children:[n(S)," ",S]},I))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Available Models"}),e.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[x.models.slice(0,3).map((S,I)=>e.jsxs("div",{className:"truncate",children:["• ",S]},I)),x.models.length>3&&e.jsxs("div",{className:"text-purple-400",children:["+ ",x.models.length-3," more"]})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-slate-700",children:e.jsx("button",{onClick:()=>{r(x.key),C("testing")},disabled:!x.hasApiKey,className:"w-full px-3 py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:text-slate-500 rounded text-sm font-medium transition-colors",children:x.hasApiKey?"Test Provider":"API Key Required"})})]},x.key))})]})}),p==="analytics"&&e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center space-x-2",children:[e.jsx("span",{children:"📈"}),e.jsx("span",{children:"Service Analytics & Metrics"})]}),d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-2",children:"Service Info"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Version:"}),e.jsx("span",{className:"text-white",children:d.version})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Status:"}),e.jsx("span",{className:`${d.status==="operational"?"text-green-400":"text-red-400"}`,children:d.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Providers:"}),e.jsx("span",{className:"text-white",children:d.providers})]})]})]}),e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-2",children:"Performance"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Avg Latency:"}),e.jsxs("span",{className:"text-white",children:[d.metrics?.avgLatency?.toFixed(2)||"0","ms"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Success Rate:"}),e.jsxs("span",{className:"text-green-400",children:[(d.metrics?.successRate*100||0).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Total Requests:"}),e.jsx("span",{className:"text-white",children:d.metrics?.requests||0})]})]})]}),e.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-2",children:"Provider Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Active:"}),e.jsx("span",{className:"text-green-400",children:a.filter(x=>x.hasApiKey).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Pending:"}),e.jsx("span",{className:"text-yellow-400",children:a.filter(x=>!x.hasApiKey).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Success/Fail:"}),e.jsxs("span",{className:"text-white",children:[d.metrics?.successes||0,"/",d.metrics?.failures||0]})]})]})]})]}),e.jsxs("div",{className:"mt-8 bg-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-4",children:"Provider Coverage Map"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Task Distribution"}),e.jsx("div",{className:"space-y-2",children:[...new Set(a.flatMap(x=>x.tasks))].map(x=>{const S=a.filter(I=>I.tasks.includes(x)).length;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-400",children:[n(x)," ",x]}),e.jsxs("span",{className:"text-white",children:[S," providers"]})]},x)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Recent Activity"}),e.jsxs("div",{className:"space-y-2",children:[u.slice(0,5).map((x,S)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-400",children:[n(x.task)," ",x.task]}),e.jsxs("span",{className:"text-purple-400",children:[x.latencyMs.toFixed(0),"ms"]})]},S)),u.length===0&&e.jsx("p",{className:"text-slate-500 text-sm italic",children:"No recent activity"})]})]})]})]})]})})]})]})},Ta=({className:t="",onNavigateToAI:i})=>{const[a,m]=s.useState(null),[d,h]=s.useState(!0);s.useEffect(()=>{y()},[]);const y=async()=>{try{let c=await fetch("/api/unified/health");if(c.ok){const p=await c.json();if(p.success){m({providers:p.availableModels||14,status:p.status,metrics:{requests:p.metrics.totalRequests,successes:p.metrics.successfulRequests,successRate:p.metrics.totalRequests>0?p.metrics.successfulRequests/p.metrics.totalRequests:1,avgLatency:p.metrics.averageLatency}});return}}if(c=await fetch("/api/ai/health"),c.ok){const p=await c.json();p.success&&m(p)}}catch(c){console.error("Error loading AI stats:",c)}finally{h(!1)}};return d?e.jsx("div",{className:`bg-gradient-to-br from-purple-600 to-blue-600 rounded-xl p-6 text-white ${t}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-white/20 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-4 bg-white/20 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-white/20 rounded w-2/3"})]})}):e.jsxs("div",{className:`bg-gradient-to-br from-purple-600 to-blue-600 rounded-xl p-6 text-white hover:shadow-xl transition-all duration-300 hover:scale-105 cursor-pointer ${t}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-2 flex items-center space-x-2",children:[e.jsx("span",{children:"🤖"}),e.jsx("span",{children:"AI Power Hub"})]}),e.jsx("p",{className:"text-purple-100 text-sm",children:a?`${a.providers} task families unified`:"Multi-provider AI via HuggingFace"})]}),e.jsx("div",{className:"text-3xl",children:"⚡"})]}),a&&e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-purple-200 text-sm",children:"Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a.status==="operational"?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-white text-sm font-medium capitalize",children:a.status})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-purple-200 text-sm",children:"Success Rate"}),e.jsxs("span",{className:"text-white text-sm font-medium",children:[Math.round(a.metrics.successRate*100),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-purple-200 text-sm",children:"Avg Response"}),e.jsxs("span",{className:"text-white text-sm font-medium",children:[a.metrics.avgLatency.toFixed(0),"ms"]})]}),a.metrics.requests>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-purple-200 text-sm",children:"Total Requests"}),e.jsx("span",{className:"text-white text-sm font-medium",children:a.metrics.requests})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:a?.providers||9}),e.jsx("div",{className:"text-xs text-purple-200",children:"Task Groups"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:"HF"}),e.jsx("div",{className:"text-xs text-purple-200",children:"Via Token"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"text-xs text-purple-200 mb-1",children:"Quick Capabilities:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:["💬 Chat","🎯 Classification","📄 Summarization","🖼️ Images","🎤 Audio"].map((c,p)=>e.jsx("span",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:c},p))})]}),e.jsx("button",{onClick:i,className:"w-full bg-white/20 hover:bg-white/30 transition-colors rounded-lg py-2 px-4 text-sm font-semibold",children:"🚀 Explore AI Hub"})]})},Xe=t=>{try{if(!t)return null;const i=t.split(".");if(i.length!==3)return null;const a=i[1].replace(/-/g,"+").replace(/_/g,"/"),m=a.length%4,d=m?a+"=".repeat(4-m):a,h=atob(d);return JSON.parse(h)}catch{return null}},Ea=({token:t,onLogout:i})=>{const[a,m]=s.useState(null),[d,h]=s.useState(!0),[y,c]=s.useState("chat"),p=!!Xe(t),[C,A]=s.useState({ai_core:{status:"checking",message:"Checking AI Core..."},websocket:{status:"checking",message:"Checking WebSocket..."},database:{status:"checking",message:"Checking Database..."},voice_service:{status:"checking",message:"Checking Voice Services..."},visual_service:{status:"checking",message:"Checking Visual Analysis..."},email_service:{status:"checking",message:"Checking Email Service..."},calendar_service:{status:"checking",message:"Checking Calendar Service..."},contacts_service:{status:"checking",message:"Checking Contacts Service..."}}),b=s.useCallback(()=>{const w=Xe(t);m(w?{id:w.userId||w.sub||w.id||0,name:w.name||w.username||"User",email:w.email||"No email provided"}:null),h(!1)},[t]);return s.useEffect(()=>{const w=async()=>{b()},_=async()=>{const g=localStorage.getItem("token");if(!g)return;try{const r=await fetch("/api/health");if(r.ok){const v=await r.json();A(j=>({...j,ai_core:{status:v.services?.openai?.status==="healthy"?"online":"offline",message:v.services?.openai?.status==="healthy"?"AI Core Active":"AI Core Unavailable"},database:{status:v.overall==="healthy"?"online":"offline",message:v.overall==="healthy"?"Database Connected":"Database Error"},websocket:{status:"online",message:"Socket Connected"}})),v.services?.deepgram&&A(j=>({...j,voice_service:{status:v.services.deepgram.status==="healthy"?"online":"offline",message:v.services.deepgram.status==="healthy"?"Voice Services Active":"Voice Services Offline"}})),v.services?.visualAnalysis&&A(j=>({...j,visual_service:{status:v.services.visualAnalysis.status==="healthy"?"online":"offline",message:v.services.visualAnalysis.status==="healthy"?"Visual Analysis Active":"Visual Analysis Offline"}}))}}catch(r){console.error("Failed to fetch health status:",r),A(v=>{const j={...v};return Object.keys(j).forEach(u=>{j[u]={status:"error",message:"Health Check Failed"}}),j})}const o=[{key:"email_service",endpoint:"/api/email/status"},{key:"calendar_service",endpoint:"/api/calendar/status"},{key:"contacts_service",endpoint:"/api/contacts/status"}];for(const r of o)try{const v=await fetch(r.endpoint,{headers:{Authorization:`Bearer ${g}`}});if(v.ok){const j=await v.json();A(u=>({...u,[r.key]:{status:"online",message:j.status?.service?`${j.status.service} Active`:"Service Online"}}))}else A(j=>({...j,[r.key]:{status:"offline",message:"Service Unavailable"}}))}catch{A(j=>({...j,[r.key]:{status:"error",message:"Connection Error"}}))}};w(),_();const N=setInterval(_,3e4);return()=>clearInterval(N)},[t,i]),d?e.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center",children:e.jsx("div",{className:"glass-card p-8 rounded-xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{className:"text-white text-xl",children:"Loading dashboard..."})]})})}):p?y==="settings"?e.jsx($t,{token:t,onBack:()=>c("chat")}):y==="workflows"?e.jsx(Bt,{token:t,onBack:()=>c("chat")}):y==="knowledge"?e.jsx(Vt,{token:t,onBack:()=>c("chat")}):y==="vault"?e.jsx(Yt,{token:t,onBack:()=>c("chat")}):y==="lifeos"?e.jsx(Zt,{token:t,onBack:()=>c("chat")}):y==="about"?e.jsx(Xt,{onBack:()=>c("chat")}):y==="license"?e.jsx(ea,{onBack:()=>c("chat")}):y==="manual"?e.jsx(sa,{onBack:()=>c("chat")}):y==="models"?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Model Router"}),e.jsx("button",{onClick:()=>c("chat"),className:"text-xs px-2 py-1 border rounded",children:"Back"})]}),e.jsx(la,{})]}):y==="huggingface"?e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-slate-600/50 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"HuggingFace AI Integration"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Advanced AI capabilities with enhanced routing and multimodal processing"})]}),e.jsxs("button",{onClick:()=>c("chat"),className:"bg-purple-600/80 hover:bg-purple-600 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back to Dashboard"})]})]})}),e.jsx("main",{className:"max-w-7xl mx-auto p-6",children:e.jsx(va,{token:t,className:"w-full"})})]}):y==="health"?e.jsx(Ca,{token:t,onBack:()=>c("chat")}):y==="email"?e.jsx(_a,{token:t,onBack:()=>c("chat")}):y==="aiproviders"?e.jsx(Aa,{token:t,onBack:()=>c("chat")}):e.jsxs("div",{className:"min-h-screen bg-animated text-white",children:[e.jsx("header",{className:"glass-card border-b border-slate-600/50 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"Dat Bitch Cartrita"}),e.jsxs("p",{className:"text-slate-400 mt-1",children:["Welcome back, ",a?.name," 👋"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ta,{token:t,className:"transform hover:scale-105",onActivate:w=>{console.log(`Live chat activated in ${w} mode`)}}),e.jsxs("button",{onClick:()=>c("workflows"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"Workflows",children:[e.jsx("span",{children:"🚀"}),e.jsx("span",{className:"hidden sm:inline",children:"Workflows"})]}),e.jsxs("button",{onClick:()=>c("knowledge"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"Knowledge Hub",children:[e.jsx("span",{children:"🧠"}),e.jsx("span",{className:"hidden sm:inline",children:"Knowledge"})]}),e.jsxs("button",{onClick:()=>c("vault"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"API Key Vault",children:[e.jsx("span",{children:"🔐"}),e.jsx("span",{className:"hidden sm:inline",children:"Vault"})]}),e.jsxs("button",{onClick:()=>c("lifeos"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"Personal Life OS",children:[e.jsx("span",{children:"🏠"}),e.jsx("span",{className:"hidden sm:inline",children:"Life OS"})]}),e.jsxs("button",{onClick:()=>c("settings"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"Settings",children:[e.jsx("span",{children:"⚙️"}),e.jsx("span",{className:"hidden sm:inline",children:"Settings"})]}),e.jsxs("button",{onClick:()=>c("models"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"Model Router",children:[e.jsx("span",{children:"🧩"}),e.jsx("span",{className:"hidden sm:inline",children:"Models"})]}),e.jsxs("button",{onClick:()=>c("huggingface"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"HuggingFace AI Hub",children:[e.jsx("span",{children:"🤗"}),e.jsx("span",{className:"hidden sm:inline",children:"HF AI"})]}),e.jsxs("button",{onClick:()=>c("aiproviders"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"Multi-Provider AI Hub",children:[e.jsx("span",{children:"🤖"}),e.jsx("span",{className:"hidden sm:inline",children:"AI Hub"})]}),e.jsxs("button",{onClick:()=>c("health"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"System Health",children:[e.jsx("span",{children:"📊"}),e.jsx("span",{className:"hidden sm:inline",children:"Health"})]}),e.jsxs("button",{onClick:()=>c("email"),className:"text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800/50 flex items-center space-x-2",title:"Email Inbox",children:[e.jsx("span",{children:"📧"}),e.jsx("span",{className:"hidden sm:inline",children:"Email"})]}),e.jsxs("button",{onClick:i,className:"bg-red-600/80 hover:bg-red-600 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx("span",{children:"🚪"}),e.jsx("span",{children:"Logout"})]})]})]})}),e.jsx("main",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(Tt,{token:t})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-xl font-bold",children:a?.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a?.name}),e.jsx("p",{className:"text-sm text-slate-400",children:a?.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-400",children:"Online"})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"⚡"}),e.jsx("span",{children:"Quick Actions"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>c("workflows"),className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🚀"}),e.jsx("span",{children:"Workflow Automation"})]}),e.jsxs("button",{onClick:()=>c("knowledge"),className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🧠"}),e.jsx("span",{children:"Knowledge Hub"})]}),e.jsxs("button",{onClick:()=>c("vault"),className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🔐"}),e.jsx("span",{children:"API Key Vault"})]}),e.jsxs("button",{onClick:()=>c("lifeos"),className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🏠"}),e.jsx("span",{children:"Personal Life OS"})]}),e.jsxs("button",{onClick:()=>c("settings"),className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"⚙️"}),e.jsx("span",{children:"Account Settings"})]}),e.jsxs("button",{onClick:()=>c("huggingface"),className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🤗"}),e.jsx("span",{children:"HuggingFace AI Hub"})]}),e.jsxs("button",{onClick:()=>c("aiproviders"),className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🤖"}),e.jsx("span",{children:"Multi-Provider AI Hub"})]}),e.jsxs("button",{className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🗑️"}),e.jsx("span",{children:"Clear Chat History"})]}),e.jsxs("button",{className:"w-full text-left p-3 rounded-lg hover:bg-slate-800/50 transition-colors flex items-center space-x-3",children:[e.jsx("span",{children:"🎨"}),e.jsx("span",{children:"Customize Theme"})]})]})]}),e.jsx(Ta,{className:"w-full",onNavigateToAI:()=>c("aiproviders")}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"📊"}),e.jsx("span",{children:"System Status"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[Object.entries(C).map(([w,_])=>{const N=r=>{switch(r){case"online":return"text-green-400";case"offline":return"text-red-400";case"error":return"text-yellow-400";default:return"text-slate-400"}},g=r=>{switch(r){case"online":return"bg-green-500";case"offline":return"bg-red-500";case"error":return"bg-yellow-500";default:return"bg-slate-500"}},o=r=>{switch(r){case"ai_core":return"AI Core";case"websocket":return"WebSocket";case"database":return"Database";case"email_service":return"Email Service";case"calendar_service":return"Calendar Service";case"contacts_service":return"Contacts Service";default:return r.replace("_"," ").replace(/\b\w/g,v=>v.toUpperCase())}};return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:o(w)}),e.jsxs("span",{className:`${N(_.status)} flex items-center space-x-1`,children:[e.jsx("div",{className:`w-2 h-2 ${g(_.status)} rounded-full ${_.status==="checking"?"animate-pulse":""}`}),e.jsx("span",{children:_.message})]})]},w)}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"Sub-Agents"}),e.jsx("span",{className:"text-blue-400",children:"4 Active"})]})]})]}),e.jsxs("div",{className:"glass-card p-6 rounded-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[e.jsx("span",{children:"🎯"}),e.jsx("span",{children:"Available Features"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-green-400",children:"✅"}),e.jsx("span",{children:"Real-time Chat"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-green-400",children:"✅"}),e.jsx("span",{children:"Message History"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-green-400",children:"✅"}),e.jsx("span",{children:"Code Generation"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-green-400",children:"✅"}),e.jsx("span",{children:"Image Creation"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-yellow-400",children:"🔄"}),e.jsx("span",{children:"Voice Synthesis"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-yellow-400",children:"🔄"}),e.jsx("span",{children:"Ambient Listening"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-slate-500",children:"⏳"}),e.jsx("span",{children:"Video Analysis"})]})]})]})]})]})}),e.jsx("footer",{className:"border-t border-slate-600/50 mt-12",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex justify-center items-center space-x-6",children:[e.jsxs("button",{onClick:()=>c("about"),className:"text-slate-400 hover:text-white transition-colors text-sm flex items-center space-x-1",children:[e.jsx("span",{children:"ℹ️"}),e.jsx("span",{children:"About Me"})]}),e.jsxs("button",{onClick:()=>c("manual"),className:"text-slate-400 hover:text-white transition-colors text-sm flex items-center space-x-1",children:[e.jsx("span",{children:"📖"}),e.jsx("span",{children:"User Manual"})]}),e.jsxs("button",{onClick:()=>c("license"),className:"text-slate-400 hover:text-white transition-colors text-sm flex items-center space-x-1",children:[e.jsx("span",{children:"⚖️"}),e.jsx("span",{children:"License"})]}),e.jsx("div",{className:"text-slate-500 text-xs",children:"© 2025 Dat Bitch Cartrita • Iteration 21"})]})})})]}):e.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center text-white",children:e.jsxs("div",{className:"glass-card p-8 rounded-xl max-w-md space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gradient",children:"Authentication Required"}),e.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Your session token is missing or invalid. Please sign in again to access the Cartrita dashboard features."}),e.jsx("div",{className:"flex space-x-4",children:e.jsx("button",{onClick:i,className:"bg-purple-600/80 hover:bg-purple-600 px-4 py-2 rounded-lg transition-colors",children:"Go to Login"})})]})})},Pa={dark:{primaryColor:"#0a0e1a",secondaryColor:"#111827",backgroundColor:"#0f172a",surfaceColor:"rgba(17, 24, 39, 0.8)",textColor:"#f9fafb",accentColor:"#06b6d4",glassOpacity:.6,animationSpeed:"300ms",borderRadius:"12px",fontSize:"16px"},light:{primaryColor:"#ffffff",secondaryColor:"#f8fafc",backgroundColor:"#f1f5f9",surfaceColor:"rgba(255, 255, 255, 0.9)",textColor:"#1e293b",accentColor:"#3b82f6",glassOpacity:.8,animationSpeed:"300ms",borderRadius:"12px",fontSize:"16px"},cyberpunk:{primaryColor:"#0d1117",secondaryColor:"#161b22",backgroundColor:"#0a0a0a",surfaceColor:"rgba(13, 17, 23, 0.9)",textColor:"#00ff41",accentColor:"#ff0080",glassOpacity:.4,animationSpeed:"200ms",borderRadius:"4px",fontSize:"14px"},neon:{primaryColor:"#1a0033",secondaryColor:"#2d1b4e",backgroundColor:"#0f051f",surfaceColor:"rgba(26, 0, 51, 0.7)",textColor:"#ffffff",accentColor:"#ff0080",glassOpacity:.5,animationSpeed:"400ms",borderRadius:"20px",fontSize:"16px"},minimal:{primaryColor:"#ffffff",secondaryColor:"#f5f5f5",backgroundColor:"#fafafa",surfaceColor:"rgba(255, 255, 255, 0.95)",textColor:"#333333",accentColor:"#000000",glassOpacity:.9,animationSpeed:"150ms",borderRadius:"8px",fontSize:"15px"}},Ra=s.createContext(void 0),Ia=({children:t})=>{const[i,a]=s.useState(()=>localStorage.getItem("theme")||"dark"),[m,d]=s.useState(()=>{try{const b=localStorage.getItem("customThemeSettings");if(!b)return{};const w=JSON.parse(b);return typeof w=="object"&&w!==null?w:{}}catch(b){return console.warn("Error parsing custom theme settings from localStorage:",b),localStorage.removeItem("customThemeSettings"),{}}}),h={...Pa[i],...m},y=Object.keys(m).length>0,c=b=>{a(b),localStorage.setItem("theme",b)},p=b=>{const w={...m,...b};d(w),localStorage.setItem("customThemeSettings",JSON.stringify(w))},C=()=>{d({}),localStorage.removeItem("customThemeSettings")};s.useEffect(()=>{const b=document.documentElement;Object.entries(h).forEach(([w,_])=>{const N=`--theme-${w.replace(/([A-Z])/g,"-$1").toLowerCase()}`;b.style.setProperty(N,_.toString())}),b.className=b.className.replace(/theme-\w+/g,""),b.classList.add(`theme-${i}`),i==="cyberpunk"?(b.style.setProperty("--glow-color","#00ff41"),b.style.setProperty("--shadow-color","rgba(0, 255, 65, 0.5)")):i==="neon"?(b.style.setProperty("--glow-color","#ff0080"),b.style.setProperty("--shadow-color","rgba(255, 0, 128, 0.5)")):(b.style.setProperty("--glow-color",h.accentColor),b.style.setProperty("--shadow-color",`${h.accentColor}50`))},[i,h]);const A={theme:i,themeSettings:h,setTheme:c,customSettings:m,updateCustomSettings:p,resetToPreset:C,isCustomized:y};return e.jsx(Ra.Provider,{value:A,children:t})};class Ma extends s.Component{constructor(i){super(i),this.state={hasError:!1}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,a){console.error("ErrorBoundary caught an error:",i,a),this.setState({error:i,errorInfo:a})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-animated flex items-center justify-center",children:e.jsxs("div",{className:"glass-card p-8 rounded-xl max-w-md mx-auto text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"⚠️"})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Oops! Something went wrong"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Don't worry, this happens sometimes. The error has been logged and we're working on it."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"🔄 Reload Page"}),e.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors",children:"🔧 Try Again"})]}),!1]})}):this.props.children}}Gs.use(Ks).use(Js).use(Qs).init({fallbackLng:"en",debug:!1,backend:{loadPath:"/locales/{{lng}}/translation.json",requestOptions:{cache:"no-cache"},parse:t=>{try{return JSON.parse(t)}catch(i){return console.error("i18n: Failed to parse translation data:",i),{}}}},interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"],lookupLocalStorage:"preferredLanguage"},preload:["en"],saveMissing:!1,keySeparator:".",nsSeparator:":",missingKeyHandler:(t,i,a)=>{console.debug(`i18n: Missing translation key "${a}" for language "${t}"`)}}).catch(t=>{console.error("i18n initialization failed:",t)});function Da(){const[t,i]=s.useState(localStorage.getItem("token")),[a,m]=s.useState("login");s.useEffect(()=>{const c=localStorage.getItem("authToken");c&&!localStorage.getItem("token")&&(localStorage.setItem("token",c),localStorage.removeItem("authToken"));const p=localStorage.getItem("token");p&&i(p)},[]);const d=c=>{localStorage.setItem("token",c),i(c)},h=()=>{localStorage.removeItem("token"),i(null),m("login")},y=()=>m("login");return e.jsx(Ma,{children:e.jsx(Ia,{children:t?e.jsx(Ea,{token:t,onLogout:h}):a==="login"?e.jsx(tt,{onLoginSuccess:d,onSwitchToRegister:()=>m("register")}):e.jsx(at,{onSwitchToLogin:()=>m("login"),onRegisterSuccess:y})})})}const $a={audioEnabled:!0,videoEnabled:!1,proactiveResponses:!0,privacyMode:"standard"},La=s.createContext(void 0),Fa=({children:t})=>{const[i,a]=s.useState(!1),[m,d]=s.useState("prompt"),[h,y]=s.useState($a),c=s.useRef(null),p=s.useRef(null),C=s.useRef(null),A=s.useRef(null),b=s.useRef(null),w=(r,v)=>{try{const j=new MediaRecorder(v,{mimeType:"audio/webm"});C.current=j,j.addEventListener("dataavailable",u=>{u.data.size>0&&r.emit("audio_stream",u.data)}),j.addEventListener("error",u=>{console.error("[AudioRecorder] Error:",u)}),j.start(250),console.log("[AudioRecorder] Started")}catch(j){console.error("[AudioRecorder] Setup failed:",j)}},_=(r,v)=>{try{const j=document.createElement("video"),u=document.createElement("canvas"),T=u.getContext("2d");if(!T){console.error("[VideoProcessor] Failed to get canvas context");return}j.srcObject=v,j.play(),j.addEventListener("loadedmetadata",()=>{u.width=j.videoWidth,u.height=j.videoHeight;const k=()=>{if(i)try{T.drawImage(j,0,0,u.width,u.height),u.toBlob(R=>{R&&r.emit("video_frame",R)},"image/jpeg",.3)}catch(R){console.error("[VideoProcessor] Frame processing error:",R)}};b.current=setInterval(k,1e3),console.log("[VideoProcessor] Started at 1 FPS")})}catch(j){console.error("[VideoProcessor] Setup failed:",j)}},N=async(r,v={})=>{if(i)return;const j={...h,...v};y(j);try{const u={audio:j.audioEnabled,video:j.videoEnabled?{width:640,height:480,frameRate:5}:!1},T=await navigator.mediaDevices.getUserMedia(u);j.audioEnabled&&(c.current=T),j.videoEnabled&&(p.current=T),d("granted"),a(!0);const k=`${is}/ambient`,R=ss(k,{...cs,auth:{token:r},query:{audioEnabled:j.audioEnabled,videoEnabled:j.videoEnabled,privacyMode:j.privacyMode}});A.current=R,R.on("connect",()=>{console.log("[AmbientSocket] Connected with settings:",j),j.audioEnabled&&c.current&&w(R,c.current),j.videoEnabled&&p.current&&_(R,p.current)}),R.on("disconnect",()=>{console.log("[AmbientSocket] Disconnected")})}catch(u){console.error("[AmbientContext] Permission denied or error:",u),d("denied"),a(!1)}},g=()=>{console.log("[AmbientContext] Disabling ambient mode"),b.current&&(clearInterval(b.current),b.current=null),C.current&&(C.current.stop(),C.current=null),A.current&&(A.current.disconnect(),A.current=null),c.current&&(c.current.getTracks().forEach(r=>r.stop()),c.current=null),p.current&&(p.current.getTracks().forEach(r=>r.stop()),p.current=null),a(!1)},o=r=>{y(v=>({...v,...r})),i&&A.current&&(A.current,g(),setTimeout(()=>{console.log("[AmbientContext] Settings updated, restart required")},100))};return e.jsx(La.Provider,{value:{isAmbientModeEnabled:i,permissionState:m,settings:h,enableAmbientMode:N,disableAmbientMode:g,updateSettings:o},children:t})},es=window.fetch.bind(window);function Oa(t){return typeof t=="string"&&t.startsWith("/api/")}window.__API_BASE_SHIM_INSTALLED__||(window.__API_BASE_SHIM_INSTALLED__=!0,window.fetch=async(t,i)=>{if(Oa(t)){const a=`${re}${t}`;return es(a,i)}return es(t,i)});Ys.createRoot(document.getElementById("root")).render(e.jsx(ke.StrictMode,{children:e.jsx(Zs,{children:e.jsx(Fa,{children:e.jsx(Mt,{children:e.jsx(Et,{children:e.jsx(Da,{})})})})})}));
