<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Robbie Allen (Lead Architect)" />
  <meta name="author" content="Cartrita Development Team" />
  <title>Cartrita Hierarchical MCP Transformation Guide 2025</title>
  <style>
    html {
      font-size: 11pt;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Cartrita Hierarchical MCP Transformation Guide
2025</h1>
<p class="subtitle">Converting a Multi-Agent AI System into a
Production-Ready Master Control Program</p>
<p class="author">Robbie Allen (Lead Architect)</p>
<p class="author">Cartrita Development Team</p>
<p class="date">August 2025</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#executive-summary" id="toc-executive-summary"><span
class="toc-section-number">1</span> Executive Summary</a></li>
<li><a href="#current-state-analysis"
id="toc-current-state-analysis"><span
class="toc-section-number">2</span> 1. Current State Analysis</a>
<ul>
<li><a href="#project-overview" id="toc-project-overview"><span
class="toc-section-number">2.1</span> 1.1 Project Overview</a></li>
<li><a href="#current-architecture-strengths"
id="toc-current-architecture-strengths"><span
class="toc-section-number">2.2</span> 1.2 Current Architecture
Strengths</a>
<ul>
<li><a href="#advanced-ai-integration"
id="toc-advanced-ai-integration"><span
class="toc-section-number">2.2.1</span> 1.2.1 Advanced AI
Integration</a></li>
<li><a href="#production-infrastructure"
id="toc-production-infrastructure"><span
class="toc-section-number">2.2.2</span> 1.2.2 Production
Infrastructure</a></li>
<li><a href="#personal-ai-os-features"
id="toc-personal-ai-os-features"><span
class="toc-section-number">2.2.3</span> 1.2.3 Personal AI OS
Features</a></li>
</ul></li>
<li><a href="#current-architecture-limitations"
id="toc-current-architecture-limitations"><span
class="toc-section-number">2.3</span> 1.3 Current Architecture
Limitations</a>
<ul>
<li><a href="#flat-agent-structure" id="toc-flat-agent-structure"><span
class="toc-section-number">2.3.1</span> 1.3.1 Flat Agent
Structure</a></li>
<li><a href="#communication-bottlenecks"
id="toc-communication-bottlenecks"><span
class="toc-section-number">2.3.2</span> 1.3.2 Communication
Bottlenecks</a></li>
<li><a href="#resource-management-issues"
id="toc-resource-management-issues"><span
class="toc-section-number">2.3.3</span> 1.3.3 Resource Management
Issues</a></li>
<li><a href="#scaling-limitations" id="toc-scaling-limitations"><span
class="toc-section-number">2.3.4</span> 1.3.4 Scaling
Limitations</a></li>
</ul></li>
</ul></li>
<li><a href="#target-architecture-hierarchical-mcp"
id="toc-target-architecture-hierarchical-mcp"><span
class="toc-section-number">3</span> 2. Target Architecture: Hierarchical
MCP</a>
<ul>
<li><a href="#three-tier-architecture-design"
id="toc-three-tier-architecture-design"><span
class="toc-section-number">3.1</span> 2.1 Three-Tier Architecture
Design</a></li>
<li><a href="#tier-responsibilities"
id="toc-tier-responsibilities"><span
class="toc-section-number">3.2</span> 2.2 Tier Responsibilities</a>
<ul>
<li><a href="#tier-0-main-orchestrator"
id="toc-tier-0-main-orchestrator"><span
class="toc-section-number">3.2.1</span> 2.2.1 Tier 0: Main
Orchestrator</a></li>
<li><a href="#tier-1-supervisors" id="toc-tier-1-supervisors"><span
class="toc-section-number">3.2.2</span> 2.2.2 Tier 1:
Supervisors</a></li>
<li><a href="#tier-2-sub-agents" id="toc-tier-2-sub-agents"><span
class="toc-section-number">3.2.3</span> 2.2.3 Tier 2:
Sub-Agents</a></li>
</ul></li>
</ul></li>
<li><a href="#model-context-protocol-mcp-implementation"
id="toc-model-context-protocol-mcp-implementation"><span
class="toc-section-number">4</span> 3. Model Context Protocol (MCP)
Implementation</a>
<ul>
<li><a href="#mcp-message-specification"
id="toc-mcp-message-specification"><span
class="toc-section-number">4.1</span> 3.1 MCP Message Specification</a>
<ul>
<li><a href="#core-message-envelope"
id="toc-core-message-envelope"><span
class="toc-section-number">4.1.1</span> 3.1.1 Core Message
Envelope</a></li>
<li><a href="#task-request-payload" id="toc-task-request-payload"><span
class="toc-section-number">4.1.2</span> 3.1.2 Task Request
Payload</a></li>
</ul></li>
<li><a href="#transport-layer-design"
id="toc-transport-layer-design"><span
class="toc-section-number">4.2</span> 3.2 Transport Layer Design</a>
<ul>
<li><a href="#in-process-communication-tier-0-tier-1"
id="toc-in-process-communication-tier-0-tier-1"><span
class="toc-section-number">4.2.1</span> 3.2.1 In-Process Communication
(Tier 0 ↔︎ Tier 1)</a></li>
<li><a href="#inter-process-communication-tier-1-tier-2"
id="toc-inter-process-communication-tier-1-tier-2"><span
class="toc-section-number">4.2.2</span> 3.2.2 Inter-Process
Communication (Tier 1 ↔︎ Tier 2)</a></li>
</ul></li>
</ul></li>
<li><a href="#detailed-migration-strategy"
id="toc-detailed-migration-strategy"><span
class="toc-section-number">5</span> 4. Detailed Migration Strategy</a>
<ul>
<li><a href="#phase-by-phase-implementation"
id="toc-phase-by-phase-implementation"><span
class="toc-section-number">5.1</span> 4.1 Phase-by-Phase
Implementation</a>
<ul>
<li><a href="#phase-0-foundation-week-1-2"
id="toc-phase-0-foundation-week-1-2"><span
class="toc-section-number">5.1.1</span> Phase 0: Foundation (Week
1-2)</a></li>
<li><a href="#phase-1-orchestrator-extraction-week-3-4"
id="toc-phase-1-orchestrator-extraction-week-3-4"><span
class="toc-section-number">5.1.2</span> Phase 1: Orchestrator Extraction
(Week 3-4)</a></li>
<li><a href="#phase-2-intelligence-supervisor-week-5-7"
id="toc-phase-2-intelligence-supervisor-week-5-7"><span
class="toc-section-number">5.1.3</span> Phase 2: Intelligence Supervisor
(Week 5-7)</a></li>
<li><a href="#phase-3-multi-modal-supervisor-week-8-9"
id="toc-phase-3-multi-modal-supervisor-week-8-9"><span
class="toc-section-number">5.1.4</span> Phase 3: Multi-Modal Supervisor
(Week 8-9)</a></li>
<li><a href="#phase-4-system-supervisor-week-10-11"
id="toc-phase-4-system-supervisor-week-10-11"><span
class="toc-section-number">5.1.5</span> Phase 4: System Supervisor (Week
10-11)</a></li>
<li><a href="#phase-5-agent-migration-week-12-14"
id="toc-phase-5-agent-migration-week-12-14"><span
class="toc-section-number">5.1.6</span> Phase 5: Agent Migration (Week
12-14)</a></li>
<li><a href="#phase-6-legacy-route-migration-week-15-16"
id="toc-phase-6-legacy-route-migration-week-15-16"><span
class="toc-section-number">5.1.7</span> Phase 6: Legacy Route Migration
(Week 15-16)</a></li>
</ul></li>
<li><a href="#backward-compatibility-strategy"
id="toc-backward-compatibility-strategy"><span
class="toc-section-number">5.2</span> 4.2 Backward Compatibility
Strategy</a>
<ul>
<li><a href="#api-version-management"
id="toc-api-version-management"><span
class="toc-section-number">5.2.1</span> 4.2.1 API Version
Management</a></li>
<li><a href="#database-migration-strategy"
id="toc-database-migration-strategy"><span
class="toc-section-number">5.2.2</span> 4.2.2 Database Migration
Strategy</a></li>
<li><a href="#configuration-migration"
id="toc-configuration-migration"><span
class="toc-section-number">5.2.3</span> 4.2.3 Configuration
Migration</a></li>
</ul></li>
</ul></li>
<li><a href="#opentelemetry-integration-strategy"
id="toc-opentelemetry-integration-strategy"><span
class="toc-section-number">6</span> 5. OpenTelemetry Integration
Strategy</a>
<ul>
<li><a href="#cross-tier-trace-propagation"
id="toc-cross-tier-trace-propagation"><span
class="toc-section-number">6.1</span> 5.1 Cross-Tier Trace
Propagation</a>
<ul>
<li><a href="#context-injection-points"
id="toc-context-injection-points"><span
class="toc-section-number">6.1.1</span> 5.1.1 Context Injection
Points</a></li>
<li><a href="#custom-mcp-span-attributes"
id="toc-custom-mcp-span-attributes"><span
class="toc-section-number">6.1.2</span> 5.1.2 Custom MCP Span
Attributes</a></li>
</ul></li>
<li><a href="#distributed-tracing-architecture"
id="toc-distributed-tracing-architecture"><span
class="toc-section-number">6.2</span> 5.2 Distributed Tracing
Architecture</a></li>
<li><a href="#custom-metrics-and-dashboards"
id="toc-custom-metrics-and-dashboards"><span
class="toc-section-number">6.3</span> 5.3 Custom Metrics and
Dashboards</a>
<ul>
<li><a href="#mcp-specific-metrics" id="toc-mcp-specific-metrics"><span
class="toc-section-number">6.3.1</span> 5.3.1 MCP-Specific
Metrics</a></li>
<li><a href="#grafana-dashboard-configuration"
id="toc-grafana-dashboard-configuration"><span
class="toc-section-number">6.3.2</span> 5.3.2 Grafana Dashboard
Configuration</a></li>
</ul></li>
</ul></li>
<li><a href="#security-and-access-control"
id="toc-security-and-access-control"><span
class="toc-section-number">7</span> 6. Security and Access Control</a>
<ul>
<li><a href="#multi-tier-security-model"
id="toc-multi-tier-security-model"><span
class="toc-section-number">7.1</span> 6.1 Multi-Tier Security Model</a>
<ul>
<li><a href="#authentication-chain" id="toc-authentication-chain"><span
class="toc-section-number">7.1.1</span> 6.1.1 Authentication
Chain</a></li>
<li><a href="#mcp-security-headers" id="toc-mcp-security-headers"><span
class="toc-section-number">7.1.2</span> 6.1.2 MCP Security
Headers</a></li>
</ul></li>
<li><a href="#secret-management-integration"
id="toc-secret-management-integration"><span
class="toc-section-number">7.2</span> 6.2 Secret Management
Integration</a>
<ul>
<li><a href="#hashicorp-vault-integration"
id="toc-hashicorp-vault-integration"><span
class="toc-section-number">7.2.1</span> 6.2.1 HashiCorp Vault
Integration</a></li>
</ul></li>
<li><a href="#audit-and-compliance" id="toc-audit-and-compliance"><span
class="toc-section-number">7.3</span> 6.3 Audit and Compliance</a>
<ul>
<li><a href="#comprehensive-audit-logging"
id="toc-comprehensive-audit-logging"><span
class="toc-section-number">7.3.1</span> 6.3.1 Comprehensive Audit
Logging</a></li>
</ul></li>
</ul></li>
<li><a href="#performance-optimization-and-resource-management"
id="toc-performance-optimization-and-resource-management"><span
class="toc-section-number">8</span> 7. Performance Optimization and
Resource Management</a>
<ul>
<li><a href="#intelligent-resource-allocation"
id="toc-intelligent-resource-allocation"><span
class="toc-section-number">8.1</span> 7.1 Intelligent Resource
Allocation</a>
<ul>
<li><a href="#dynamic-supervisor-scaling"
id="toc-dynamic-supervisor-scaling"><span
class="toc-section-number">8.1.1</span> 7.1.1 Dynamic Supervisor
Scaling</a></li>
<li><a href="#intelligent-caching-strategy"
id="toc-intelligent-caching-strategy"><span
class="toc-section-number">8.1.2</span> 7.1.2 Intelligent Caching
Strategy</a></li>
</ul></li>
<li><a href="#cost-management-and-optimization"
id="toc-cost-management-and-optimization"><span
class="toc-section-number">8.2</span> 7.2 Cost Management and
Optimization</a>
<ul>
<li><a href="#multi-provider-cost-tracking"
id="toc-multi-provider-cost-tracking"><span
class="toc-section-number">8.2.1</span> 7.2.1 Multi-Provider Cost
Tracking</a></li>
</ul></li>
</ul></li>
<li><a href="#development-and-testing-strategy"
id="toc-development-and-testing-strategy"><span
class="toc-section-number">9</span> 8. Development and Testing
Strategy</a>
<ul>
<li><a href="#mcp-aware-testing-framework"
id="toc-mcp-aware-testing-framework"><span
class="toc-section-number">9.1</span> 8.1 MCP-Aware Testing
Framework</a>
<ul>
<li><a href="#message-flow-testing" id="toc-message-flow-testing"><span
class="toc-section-number">9.1.1</span> 8.1.1 Message Flow
Testing</a></li>
<li><a href="#load-testing-with-mcp-simulation"
id="toc-load-testing-with-mcp-simulation"><span
class="toc-section-number">9.1.2</span> 8.1.2 Load Testing with MCP
Simulation</a></li>
</ul></li>
<li><a href="#continuous-integration-pipeline"
id="toc-continuous-integration-pipeline"><span
class="toc-section-number">9.2</span> 8.2 Continuous Integration
Pipeline</a>
<ul>
<li><a href="#multi-stage-testing-pipeline"
id="toc-multi-stage-testing-pipeline"><span
class="toc-section-number">9.2.1</span> 8.2.1 Multi-Stage Testing
Pipeline</a></li>
</ul></li>
</ul></li>
<li><a href="#deployment-and-operations"
id="toc-deployment-and-operations"><span
class="toc-section-number">10</span> 9. Deployment and Operations</a>
<ul>
<li><a href="#docker-based-deployment-strategy"
id="toc-docker-based-deployment-strategy"><span
class="toc-section-number">10.1</span> 9.1 Docker-Based Deployment
Strategy</a>
<ul>
<li><a href="#multi-stage-container-architecture"
id="toc-multi-stage-container-architecture"><span
class="toc-section-number">10.1.1</span> 9.1.1 Multi-Stage Container
Architecture</a></li>
<li><a href="#docker-compose-configuration"
id="toc-docker-compose-configuration"><span
class="toc-section-number">10.1.2</span> 9.1.2 Docker Compose
Configuration</a></li>
</ul></li>
<li><a href="#kubernetes-deployment-optional"
id="toc-kubernetes-deployment-optional"><span
class="toc-section-number">10.2</span> 9.2 Kubernetes Deployment
(Optional)</a>
<ul>
<li><a href="#orchestrator-deployment"
id="toc-orchestrator-deployment"><span
class="toc-section-number">10.2.1</span> 9.2.1 Orchestrator
Deployment</a></li>
<li><a href="#supervisor-deployments"
id="toc-supervisor-deployments"><span
class="toc-section-number">10.2.2</span> 9.2.2 Supervisor
Deployments</a></li>
</ul></li>
<li><a href="#monitoring-and-alerting"
id="toc-monitoring-and-alerting"><span
class="toc-section-number">10.3</span> 9.3 Monitoring and Alerting</a>
<ul>
<li><a href="#prometheus-metrics-configuration"
id="toc-prometheus-metrics-configuration"><span
class="toc-section-number">10.3.1</span> 9.3.1 Prometheus Metrics
Configuration</a></li>
<li><a href="#critical-alerting-rules"
id="toc-critical-alerting-rules"><span
class="toc-section-number">10.3.2</span> 9.3.2 Critical Alerting
Rules</a></li>
</ul></li>
</ul></li>
<li><a href="#migration-checklist-and-success-criteria"
id="toc-migration-checklist-and-success-criteria"><span
class="toc-section-number">11</span> 10. Migration Checklist and Success
Criteria</a>
<ul>
<li><a href="#pre-migration-checklist"
id="toc-pre-migration-checklist"><span
class="toc-section-number">11.1</span> 10.1 Pre-Migration Checklist</a>
<ul>
<li><a href="#infrastructure-readiness"
id="toc-infrastructure-readiness"><span
class="toc-section-number">11.1.1</span> 10.1.1 Infrastructure
Readiness</a></li>
<li><a href="#code-readiness" id="toc-code-readiness"><span
class="toc-section-number">11.1.2</span> 10.1.2 Code Readiness</a></li>
</ul></li>
<li><a href="#migration-success-criteria"
id="toc-migration-success-criteria"><span
class="toc-section-number">11.2</span> 10.2 Migration Success
Criteria</a>
<ul>
<li><a href="#functional-requirements"
id="toc-functional-requirements"><span
class="toc-section-number">11.2.1</span> 10.2.1 Functional
Requirements</a></li>
<li><a href="#performance-requirements"
id="toc-performance-requirements"><span
class="toc-section-number">11.2.2</span> 10.2.2 Performance
Requirements</a></li>
<li><a href="#observability-requirements"
id="toc-observability-requirements"><span
class="toc-section-number">11.2.3</span> 10.2.3 Observability
Requirements</a></li>
</ul></li>
<li><a href="#rollback-plan" id="toc-rollback-plan"><span
class="toc-section-number">11.3</span> 10.3 Rollback Plan</a>
<ul>
<li><a href="#rollback-triggers" id="toc-rollback-triggers"><span
class="toc-section-number">11.3.1</span> 10.3.1 Rollback
Triggers</a></li>
<li><a href="#rollback-procedure" id="toc-rollback-procedure"><span
class="toc-section-number">11.3.2</span> 10.3.2 Rollback
Procedure</a></li>
</ul></li>
</ul></li>
<li><a href="#cost-analysis-and-roi-projections"
id="toc-cost-analysis-and-roi-projections"><span
class="toc-section-number">12</span> 11. Cost Analysis and ROI
Projections</a>
<ul>
<li><a href="#migration-costs" id="toc-migration-costs"><span
class="toc-section-number">12.1</span> 11.1 Migration Costs</a>
<ul>
<li><a href="#development-investment"
id="toc-development-investment"><span
class="toc-section-number">12.1.1</span> 11.1.1 Development
Investment</a></li>
<li><a href="#operational-cost-comparison"
id="toc-operational-cost-comparison"><span
class="toc-section-number">12.1.2</span> 11.1.2 Operational Cost
Comparison</a></li>
</ul></li>
<li><a href="#return-on-investment-analysis"
id="toc-return-on-investment-analysis"><span
class="toc-section-number">12.2</span> 11.2 Return on Investment
Analysis</a>
<ul>
<li><a href="#direct-benefits" id="toc-direct-benefits"><span
class="toc-section-number">12.2.1</span> 11.2.1 Direct Benefits</a></li>
<li><a href="#roi-calculations" id="toc-roi-calculations"><span
class="toc-section-number">12.2.2</span> 11.2.2 ROI
Calculations</a></li>
</ul></li>
</ul></li>
<li><a href="#risk-assessment-and-mitigation"
id="toc-risk-assessment-and-mitigation"><span
class="toc-section-number">13</span> 12. Risk Assessment and
Mitigation</a>
<ul>
<li><a href="#technical-risks" id="toc-technical-risks"><span
class="toc-section-number">13.1</span> 12.1 Technical Risks</a>
<ul>
<li><a href="#high-impact-risks" id="toc-high-impact-risks"><span
class="toc-section-number">13.1.1</span> 12.1.1 High-Impact
Risks</a></li>
<li><a href="#medium-impact-risks" id="toc-medium-impact-risks"><span
class="toc-section-number">13.1.2</span> 12.1.2 Medium-Impact
Risks</a></li>
</ul></li>
<li><a href="#business-risks" id="toc-business-risks"><span
class="toc-section-number">13.2</span> 12.2 Business Risks</a>
<ul>
<li><a href="#project-timeline-risks"
id="toc-project-timeline-risks"><span
class="toc-section-number">13.2.1</span> 12.2.1 Project Timeline
Risks</a></li>
<li><a href="#user-impact-risks" id="toc-user-impact-risks"><span
class="toc-section-number">13.2.2</span> 12.2.2 User Impact
Risks</a></li>
</ul></li>
<li><a href="#risk-mitigation-framework"
id="toc-risk-mitigation-framework"><span
class="toc-section-number">13.3</span> 12.3 Risk Mitigation
Framework</a>
<ul>
<li><a href="#risk-monitoring-dashboard"
id="toc-risk-monitoring-dashboard"><span
class="toc-section-number">13.3.1</span> 12.3.1 Risk Monitoring
Dashboard</a></li>
</ul></li>
</ul></li>
<li><a href="#future-evolution-and-extensibility"
id="toc-future-evolution-and-extensibility"><span
class="toc-section-number">14</span> 13. Future Evolution and
Extensibility</a>
<ul>
<li><a href="#post-migration-enhancement-roadmap"
id="toc-post-migration-enhancement-roadmap"><span
class="toc-section-number">14.1</span> 13.1 Post-Migration Enhancement
Roadmap</a>
<ul>
<li><a href="#phase-7-advanced-intelligence-q4-2025"
id="toc-phase-7-advanced-intelligence-q4-2025"><span
class="toc-section-number">14.1.1</span> 13.1.1 Phase 7: Advanced
Intelligence (Q4 2025)</a></li>
<li><a href="#phase-8-ecosystem-integration-q1-2026"
id="toc-phase-8-ecosystem-integration-q1-2026"><span
class="toc-section-number">14.1.2</span> 13.1.2 Phase 8: Ecosystem
Integration (Q1 2026)</a></li>
<li><a href="#phase-9-mobile-and-edge-q2-2026"
id="toc-phase-9-mobile-and-edge-q2-2026"><span
class="toc-section-number">14.1.3</span> 13.1.3 Phase 9: Mobile and Edge
(Q2 2026)</a></li>
</ul></li>
<li><a href="#architectural-evolution-patterns"
id="toc-architectural-evolution-patterns"><span
class="toc-section-number">14.2</span> 13.2 Architectural Evolution
Patterns</a>
<ul>
<li><a href="#micro-supervisor-pattern"
id="toc-micro-supervisor-pattern"><span
class="toc-section-number">14.2.1</span> 13.2.1 Micro-Supervisor
Pattern</a></li>
<li><a href="#dynamic-agent-marketplace"
id="toc-dynamic-agent-marketplace"><span
class="toc-section-number">14.2.2</span> 13.2.2 Dynamic Agent
Marketplace</a></li>
</ul></li>
</ul></li>
<li><a href="#conclusion-and-next-steps"
id="toc-conclusion-and-next-steps"><span
class="toc-section-number">15</span> 14. Conclusion and Next Steps</a>
<ul>
<li><a href="#executive-summary-1" id="toc-executive-summary-1"><span
class="toc-section-number">15.1</span> 14.1 Executive Summary</a></li>
<li><a href="#critical-success-factors"
id="toc-critical-success-factors"><span
class="toc-section-number">15.2</span> 14.2 Critical Success Factors</a>
<ul>
<li><a href="#technical-excellence" id="toc-technical-excellence"><span
class="toc-section-number">15.2.1</span> 14.2.1 Technical
Excellence</a></li>
<li><a href="#project-management" id="toc-project-management"><span
class="toc-section-number">15.2.2</span> 14.2.2 Project
Management</a></li>
<li><a href="#operational-readiness"
id="toc-operational-readiness"><span
class="toc-section-number">15.2.3</span> 14.2.3 Operational
Readiness</a></li>
</ul></li>
<li><a href="#immediate-next-steps-week-1-2"
id="toc-immediate-next-steps-week-1-2"><span
class="toc-section-number">15.3</span> 14.3 Immediate Next Steps (Week
1-2)</a></li>
<li><a href="#long-term-vision" id="toc-long-term-vision"><span
class="toc-section-number">15.4</span> 14.4 Long-Term Vision</a></li>
</ul></li>
<li><a href="#appendices" id="toc-appendices"><span
class="toc-section-number">16</span> Appendices</a>
<ul>
<li><a href="#appendix-a-complete-docker-compose-configuration"
id="toc-appendix-a-complete-docker-compose-configuration"><span
class="toc-section-number">16.1</span> Appendix A: Complete Docker
Compose Configuration</a></li>
<li><a href="#appendix-b-mcp-protocol-buffer-definitions"
id="toc-appendix-b-mcp-protocol-buffer-definitions"><span
class="toc-section-number">16.2</span> Appendix B: MCP Protocol Buffer
Definitions</a></li>
<li><a href="#appendix-c-migration-phase-checklist-template"
id="toc-appendix-c-migration-phase-checklist-template"><span
class="toc-section-number">16.3</span> Appendix C: Migration Phase
Checklist Template</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="executive-summary"><span
class="header-section-number">1</span> Executive Summary</h1>
<p>Cartrita has evolved from a simple AI chatbot into a sophisticated
multi-agent system with 15+ specialized agents, 41+ HuggingFace
inference capabilities, comprehensive OpenTelemetry integration, and a
complete Personal AI Operating System. However, the current flat
architecture creates operational challenges, resource conflicts, and
scaling limitations.</p>
<p>This whitepaper provides a comprehensive transformation plan to
convert Cartrita into a true <strong>Hierarchical Master Control Program
(MCP)</strong> - a three-tier architecture that maintains all existing
functionality while dramatically improving orchestration, observability,
resource management, and scalability.</p>
<p><strong>Key Goals:</strong> - Transform flat agent architecture into
hierarchical control structure - Implement production-grade Model
Context Protocol (MCP) for inter-agent communication - Maintain existing
functionality while improving performance and reliability - Create a
scalable foundation for future AI system evolution</p>
<hr />
<h1 data-number="2" id="current-state-analysis"><span
class="header-section-number">2</span> 1. Current State Analysis</h1>
<h2 data-number="2.1" id="project-overview"><span
class="header-section-number">2.1</span> 1.1 Project Overview</h2>
<p><strong>Repository Structure:</strong> - <strong>Files:</strong>
5,808 files across 2,442 directories - <strong>Database:</strong> 35+
PostgreSQL tables with pgvector extensions - <strong>Agents:</strong>
15+ specialized agents with real tool access - <strong>APIs:</strong>
50+ production endpoints across all systems -
<strong>Integrations:</strong> 40+ functional tools (no mocks)</p>
<h2 data-number="2.2" id="current-architecture-strengths"><span
class="header-section-number">2.2</span> 1.2 Current Architecture
Strengths</h2>
<h3 data-number="2.2.1" id="advanced-ai-integration"><span
class="header-section-number">2.2.1</span> 1.2.1 Advanced AI
Integration</h3>
<ul>
<li><strong>HuggingFace Pro:</strong> Complete integration with 41+
inference tasks</li>
<li><strong>OpenAI Suite:</strong> GPT-4, Vision, DALL-E 3, TTS,
Fine-tuning</li>
<li><strong>Multi-Modal:</strong> Voice (Deepgram), Vision, Text
processing</li>
<li><strong>LangChain:</strong> StateGraph orchestration with
specialized agents</li>
</ul>
<h3 data-number="2.2.2" id="production-infrastructure"><span
class="header-section-number">2.2.2</span> 1.2.2 Production
Infrastructure</h3>
<ul>
<li><strong>OpenTelemetry:</strong> Complete upstream JS &amp; Contrib
integration</li>
<li><strong>Security:</strong> AES-256-GCM encryption, secure API
vault</li>
<li><strong>Database:</strong> PostgreSQL with pgvector semantic
search</li>
<li><strong>Real-Time:</strong> Socket.IO with authentication</li>
<li><strong>Observability:</strong> Natural language telemetry
interface</li>
</ul>
<h3 data-number="2.2.3" id="personal-ai-os-features"><span
class="header-section-number">2.2.3</span> 1.2.3 Personal AI OS
Features</h3>
<ul>
<li><strong>Life Management:</strong> Calendar, email, contact
synchronization</li>
<li><strong>Workflow Tools:</strong> 1000+ automation tools with vector
search</li>
<li><strong>Fine-Tuning:</strong> Complete OpenAI model
customization</li>
<li><strong>Multi-Modal Fusion:</strong> Cross-sensory AI
processing</li>
</ul>
<h2 data-number="2.3" id="current-architecture-limitations"><span
class="header-section-number">2.3</span> 1.3 Current Architecture
Limitations</h2>
<h3 data-number="2.3.1" id="flat-agent-structure"><span
class="header-section-number">2.3.1</span> 1.3.1 Flat Agent
Structure</h3>
<pre><code>Current: All agents at same level → Resource conflicts, unclear ownership
Needed: Hierarchical control → Clear responsibility chains</code></pre>
<h3 data-number="2.3.2" id="communication-bottlenecks"><span
class="header-section-number">2.3.2</span> 1.3.2 Communication
Bottlenecks</h3>
<ul>
<li>Direct agent-to-agent communication creates tight coupling</li>
<li>No standardized message protocol between agents</li>
<li>OpenTelemetry traces can become fragmented</li>
</ul>
<h3 data-number="2.3.3" id="resource-management-issues"><span
class="header-section-number">2.3.3</span> 1.3.3 Resource Management
Issues</h3>
<ul>
<li>No centralized resource allocation</li>
<li>Difficult to prioritize tasks across agents</li>
<li>Memory and computation conflicts during peak usage</li>
</ul>
<h3 data-number="2.3.4" id="scaling-limitations"><span
class="header-section-number">2.3.4</span> 1.3.4 Scaling
Limitations</h3>
<ul>
<li>Cannot easily add new agents without architecture changes</li>
<li>No clear upgrade/downgrade paths for agent capabilities</li>
<li>Monitoring becomes complex with flat structure</li>
</ul>
<hr />
<h1 data-number="3" id="target-architecture-hierarchical-mcp"><span
class="header-section-number">3</span> 2. Target Architecture:
Hierarchical MCP</h1>
<h2 data-number="3.1" id="three-tier-architecture-design"><span
class="header-section-number">3.1</span> 2.1 Three-Tier Architecture
Design</h2>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                     TIER 0: ORCHESTRATOR                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │            Main Control Orchestrator                    │   │
│  │         (Express.js + Socket.IO Gateway)                │   │
│  └─────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────┤
│                    TIER 1: SUPERVISORS                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   Intelligence  │  │   Multi-Modal   │  │    System       │ │
│  │   Supervisor    │  │   Supervisor    │  │   Supervisor    │ │
│  │                 │  │                 │  │                 │ │
│  │ • HuggingFace   │  │ • Voice/Vision  │  │ • Health        │ │
│  │ • LangChain     │  │ • Audio/TTS     │  │ • Telemetry     │ │
│  │ • Fine-Tuning   │  │ • Cross-Modal   │  │ • Security      │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│                     TIER 2: SUB-AGENTS                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Specialized Workers (Stateless, Crash-Safe)           │   │
│  │                                                         │   │
│  │  • VisionMaster      • AudioWizard     • DataSage      │   │
│  │  • LanguageMaestro   • MultiModalOracle               │   │
│  │  • ResearcherAgent   • CodeWriter      • ArtistAgent   │   │
│  │  • SchedulerAgent    • WriterAgent     • AnalyticsAgent│   │
│  │  • TaskManagement    • EmotionalIntel  • DesignAgent   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘</code></pre>
<h2 data-number="3.2" id="tier-responsibilities"><span
class="header-section-number">3.2</span> 2.2 Tier Responsibilities</h2>
<h3 data-number="3.2.1" id="tier-0-main-orchestrator"><span
class="header-section-number">3.2.1</span> 2.2.1 Tier 0: Main
Orchestrator</h3>
<p><strong>Role:</strong> Single point of entry and ultimate decision
authority</p>
<p><strong>Responsibilities:</strong> - HTTP/WebSocket request handling
- Authentication and authorization - Request routing to appropriate
supervisors - Cross-supervisor coordination - Client response formatting
- Emergency override capabilities</p>
<p><strong>Technology Stack:</strong> Node.js, Express.js, Socket.IO</p>
<h3 data-number="3.2.2" id="tier-1-supervisors"><span
class="header-section-number">3.2.2</span> 2.2.2 Tier 1:
Supervisors</h3>
<p><strong>Role:</strong> Domain-specific resource management and agent
coordination</p>
<h4 data-number="3.2.2.1" id="intelligence-supervisor"><span
class="header-section-number">3.2.2.1</span> Intelligence
Supervisor</h4>
<ul>
<li><strong>Scope:</strong> All AI model operations</li>
<li><strong>Manages:</strong> HuggingFace agents, Fine-tuning, LangChain
workflows</li>
<li><strong>Decisions:</strong> Model selection, token budgeting,
quality assurance</li>
</ul>
<h4 data-number="3.2.2.2" id="multi-modal-supervisor"><span
class="header-section-number">3.2.2.2</span> Multi-Modal Supervisor</h4>
<ul>
<li><strong>Scope:</strong> Cross-modal AI processing</li>
<li><strong>Manages:</strong> Vision, Audio, Speech, TTS agents</li>
<li><strong>Decisions:</strong> Sensor fusion, modality routing,
streaming optimization</li>
</ul>
<h4 data-number="3.2.2.3" id="system-supervisor"><span
class="header-section-number">3.2.2.3</span> System Supervisor</h4>
<ul>
<li><strong>Scope:</strong> Infrastructure and operations</li>
<li><strong>Manages:</strong> Health monitoring, telemetry, security,
life OS</li>
<li><strong>Decisions:</strong> Resource allocation, scaling, security
policies</li>
</ul>
<h3 data-number="3.2.3" id="tier-2-sub-agents"><span
class="header-section-number">3.2.3</span> 2.2.3 Tier 2: Sub-Agents</h3>
<p><strong>Role:</strong> Specialized task execution</p>
<p><strong>Characteristics:</strong> - Stateless workers (receive
context via MCP) - Crash-only design with automatic restart - Single
responsibility principle - Resource-bounded execution</p>
<hr />
<h1 data-number="4" id="model-context-protocol-mcp-implementation"><span
class="header-section-number">4</span> 3. Model Context Protocol (MCP)
Implementation</h1>
<h2 data-number="4.1" id="mcp-message-specification"><span
class="header-section-number">4.1</span> 3.1 MCP Message
Specification</h2>
<h3 data-number="4.1.1" id="core-message-envelope"><span
class="header-section-number">4.1.1</span> 3.1.1 Core Message
Envelope</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> MCPMessage {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Message Identity</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>              <span class="co">// UUID v7 for temporal ordering</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  parent_id<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span>      <span class="co">// For request-response chains</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  correlation_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>  <span class="co">// For distributed tracing</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Routing</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  sender<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>          <span class="co">// &quot;supervisor.intelligence@v2.1&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  recipient<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>       <span class="co">// &quot;agent.visionmaster@v1.3&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  broadcast<span class="op">?:</span> <span class="dt">boolean</span><span class="op">;</span>     <span class="co">// For supervisor-wide messages</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Lifecycle</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>       <span class="co">// ISO 8601 with milliseconds</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  ttl_ms<span class="op">:</span> <span class="dt">number</span><span class="op">;</span>         <span class="co">// Message expiration time</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  priority<span class="op">:</span> <span class="st">&#39;low&#39;</span> <span class="op">|</span> <span class="st">&#39;normal&#39;</span> <span class="op">|</span> <span class="st">&#39;high&#39;</span> <span class="op">|</span> <span class="st">&#39;critical&#39;</span><span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Context Propagation</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  context<span class="op">:</span> {</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    user_id<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    conversation_id<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    trace_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>      <span class="co">// OpenTelemetry trace</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    span_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>       <span class="co">// OpenTelemetry span</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    session_id<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    workspace_id<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Payload</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> MCPMessageType<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  payload<span class="op">:</span> <span class="dt">unknown</span><span class="op">;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Delivery Guarantees</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  delivery_mode<span class="op">:</span> <span class="st">&#39;at_most_once&#39;</span> <span class="op">|</span> <span class="st">&#39;at_least_once&#39;</span> <span class="op">|</span> <span class="st">&#39;exactly_once&#39;</span><span class="op">;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  retry_count<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  max_retries<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> MCPMessageType {</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Control Messages</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  PING <span class="op">=</span> <span class="st">&#39;ping&#39;</span><span class="op">,</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  PONG <span class="op">=</span> <span class="st">&#39;pong&#39;</span><span class="op">,</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  HEARTBEAT <span class="op">=</span> <span class="st">&#39;heartbeat&#39;</span><span class="op">,</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  SHUTDOWN <span class="op">=</span> <span class="st">&#39;shutdown&#39;</span><span class="op">,</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Task Messages  </span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  TASK_REQUEST <span class="op">=</span> <span class="st">&#39;task_request&#39;</span><span class="op">,</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  TASK_RESPONSE <span class="op">=</span> <span class="st">&#39;task_response&#39;</span><span class="op">,</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  TASK_ERROR <span class="op">=</span> <span class="st">&#39;task_error&#39;</span><span class="op">,</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  TASK_PROGRESS <span class="op">=</span> <span class="st">&#39;task_progress&#39;</span><span class="op">,</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Coordination</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  RESOURCE_REQUEST <span class="op">=</span> <span class="st">&#39;resource_request&#39;</span><span class="op">,</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  RESOURCE_GRANT <span class="op">=</span> <span class="st">&#39;resource_grant&#39;</span><span class="op">,</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  RESOURCE_DENY <span class="op">=</span> <span class="st">&#39;resource_deny&#39;</span><span class="op">,</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Streaming</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  STREAM_START <span class="op">=</span> <span class="st">&#39;stream_start&#39;</span><span class="op">,</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  STREAM_DATA <span class="op">=</span> <span class="st">&#39;stream_data&#39;</span><span class="op">,</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  STREAM_END <span class="op">=</span> <span class="st">&#39;stream_end&#39;</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="4.1.2" id="task-request-payload"><span
class="header-section-number">4.1.2</span> 3.1.2 Task Request
Payload</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> TaskRequestPayload {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  task<span class="op">:</span> {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    type<span class="op">:</span> <span class="dt">string</span><span class="op">;</span>           <span class="co">// &#39;huggingface.image-classification&#39;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    parameters<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">unknown</span><span class="op">&gt;;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    constraints<span class="op">?:</span> {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      max_execution_time_ms<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      max_memory_mb<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      max_cost_usd<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span> {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    data<span class="op">?:</span> <span class="dt">unknown</span><span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    files<span class="op">?:</span> <span class="bu">Array</span><span class="op">&lt;</span>{</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      content_type<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      size_bytes<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      url<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span>        <span class="co">// For large files</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      inline_data<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// Base64 for small files</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    }<span class="op">&gt;;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  preferences<span class="op">?:</span> {</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    quality_level<span class="op">:</span> <span class="st">&#39;fast&#39;</span> <span class="op">|</span> <span class="st">&#39;balanced&#39;</span> <span class="op">|</span> <span class="st">&#39;best&#39;</span><span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    cost_optimization<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    streaming<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 data-number="4.2" id="transport-layer-design"><span
class="header-section-number">4.2</span> 3.2 Transport Layer Design</h2>
<h3 data-number="4.2.1"
id="in-process-communication-tier-0-tier-1"><span
class="header-section-number">4.2.1</span> 3.2.1 In-Process
Communication (Tier 0 ↔︎ Tier 1)</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MCPInProcessTransport <span class="kw">extends</span> <span class="bu">EventEmitter</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">send</span>(message<span class="op">:</span> MCPMessage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add OpenTelemetry context injection</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> activeSpan <span class="op">=</span> trace<span class="op">.</span><span class="fu">getActiveSpan</span>()<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (activeSpan) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      message<span class="op">.</span><span class="at">context</span><span class="op">.</span><span class="at">trace_id</span> <span class="op">=</span> activeSpan<span class="op">.</span><span class="fu">spanContext</span>()<span class="op">.</span><span class="at">traceId</span><span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      message<span class="op">.</span><span class="at">context</span><span class="op">.</span><span class="at">span_id</span> <span class="op">=</span> activeSpan<span class="op">.</span><span class="fu">spanContext</span>()<span class="op">.</span><span class="at">spanId</span><span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Emit with error handling and timeout</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">emit</span>(<span class="vs">`message:</span><span class="sc">${</span>message<span class="op">.</span><span class="at">recipient</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> message)<span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="4.2.2"
id="inter-process-communication-tier-1-tier-2"><span
class="header-section-number">4.2.2</span> 3.2.2 Inter-Process
Communication (Tier 1 ↔︎ Tier 2)</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MCPUnixSocketTransport {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> socket<span class="op">:</span> net<span class="op">.</span><span class="at">Socket</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">send</span>(message<span class="op">:</span> MCPMessage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>MCPMessage<span class="op">&gt;</span> {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> serialized <span class="op">=</span> msgpack<span class="op">.</span><span class="fu">encode</span>(message)<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> timeout <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">reject</span>(<span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`MCP timeout after </span><span class="sc">${</span>message<span class="op">.</span><span class="at">ttl_ms</span><span class="sc">}</span><span class="vs">ms`</span>))<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> message<span class="op">.</span><span class="at">ttl_ms</span>)<span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">socket</span><span class="op">.</span><span class="fu">write</span>(serialized)<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">once</span>(<span class="vs">`response:</span><span class="sc">${</span>message<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> (response) <span class="kw">=&gt;</span> {</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="pp">clearTimeout</span>(timeout)<span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resolve</span>(response)<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h1 data-number="5" id="detailed-migration-strategy"><span
class="header-section-number">5</span> 4. Detailed Migration
Strategy</h1>
<h2 data-number="5.1" id="phase-by-phase-implementation"><span
class="header-section-number">5.1</span> 4.1 Phase-by-Phase
Implementation</h2>
<h3 data-number="5.1.1" id="phase-0-foundation-week-1-2"><span
class="header-section-number">5.1.1</span> Phase 0: Foundation (Week
1-2)</h3>
<p><strong>Objective:</strong> Establish MCP infrastructure without
disrupting current functionality</p>
<p><strong>Deliverables:</strong> 1. <strong>MCP Protocol
Library</strong> (<code>packages/mcp-core/</code>) - Message definitions
and validation - Transport abstractions - OpenTelemetry integration
helpers</p>
<ol start="2" type="1">
<li><strong>Testing Framework</strong>
(<code>packages/mcp-testing/</code>)
<ul>
<li>Message simulation utilities<br />
</li>
<li>Integration test harnesses</li>
<li>Performance benchmarking tools</li>
</ul></li>
<li><strong>Documentation Setup</strong>
<ul>
<li>API documentation generation</li>
<li>Architecture decision records (ADRs)</li>
<li>Migration tracking dashboard</li>
</ul></li>
</ol>
<p><strong>Success Criteria:</strong> - [ ] All existing tests pass
unchanged - [ ] MCP messages can be sent/received between test processes
- [ ] OpenTelemetry traces bridge correctly across MCP boundaries</p>
<h3 data-number="5.1.2"
id="phase-1-orchestrator-extraction-week-3-4"><span
class="header-section-number">5.1.2</span> Phase 1: Orchestrator
Extraction (Week 3-4)</h3>
<p><strong>Objective:</strong> Create Tier 0 orchestrator without
breaking existing functionality</p>
<p><strong>Implementation:</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// packages/orchestrator/src/main.ts</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> CartritaOrchestrator {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> supervisors <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> Supervisor<span class="op">&gt;</span>()<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> mcpTransport<span class="op">:</span> MCPTransport<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">initialize</span>() {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start supervisors</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">startSupervisor</span>(<span class="st">&#39;intelligence&#39;</span><span class="op">,</span> IntelligenceSupervisor)<span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">startSupervisor</span>(<span class="st">&#39;multimodal&#39;</span><span class="op">,</span> MultiModalSupervisor)<span class="op">;</span>  </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">startSupervisor</span>(<span class="st">&#39;system&#39;</span><span class="op">,</span> SystemSupervisor)<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Establish MCP connections</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">mcpTransport</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">MCPInProcessTransport</span>()<span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Health check all supervisors</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">healthCheckAll</span>()<span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">routeRequest</span>(req<span class="op">:</span> HttpRequest)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>HttpResponse<span class="op">&gt;</span> {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> supervisor <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">selectSupervisor</span>(req<span class="op">.</span><span class="at">path</span>)<span class="op">;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mcpMessage<span class="op">:</span> MCPMessage <span class="op">=</span> {</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="fu">generateUUID</span>()<span class="op">,</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      sender<span class="op">:</span> <span class="st">&#39;orchestrator@v1.0&#39;</span><span class="op">,</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      recipient<span class="op">:</span> <span class="vs">`supervisor.</span><span class="sc">${</span>supervisor<span class="sc">}</span><span class="vs">@v1.0`</span><span class="op">,</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> MCPMessageType<span class="op">.</span><span class="at">TASK_REQUEST</span><span class="op">,</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      payload<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">transformRequest</span>(req)<span class="op">,</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ... other fields</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">mcpTransport</span><span class="op">.</span><span class="fu">send</span>(mcpMessage)<span class="op">;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">transformResponse</span>(response)<span class="op">;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Migration Path:</strong> 1. Create orchestrator package
alongside existing backend 2. Implement request forwarding to existing
handlers 3. Add MCP wrapper around existing agent calls 4. Gradually
replace direct agent calls with MCP messages</p>
<h3 data-number="5.1.3"
id="phase-2-intelligence-supervisor-week-5-7"><span
class="header-section-number">5.1.3</span> Phase 2: Intelligence
Supervisor (Week 5-7)</h3>
<p><strong>Objective:</strong> Consolidate all AI model operations under
single supervisor</p>
<p><strong>Components:</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// packages/supervisor-intelligence/src/IntelligenceSupervisor.ts</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> IntelligenceSupervisor <span class="kw">extends</span> BaseSupervisor {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> huggingFaceAgents<span class="op">:</span> HuggingFaceAgentPool<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> langChainOrchestrator<span class="op">:</span> LangChainOrchestrator<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> fineTuningService<span class="op">:</span> FineTuningService<span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleTaskRequest</span>(message<span class="op">:</span> MCPMessage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>MCPMessage<span class="op">&gt;</span> {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { task } <span class="op">=</span> message<span class="op">.</span><span class="at">payload</span> <span class="im">as</span> TaskRequestPayload<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (task<span class="op">.</span><span class="at">type</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;huggingface.&#39;</span>)) {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">huggingFaceAgents</span><span class="op">.</span><span class="fu">process</span>(message)<span class="op">;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (task<span class="op">.</span><span class="at">type</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;langchain.&#39;</span>)) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">langChainOrchestrator</span><span class="op">.</span><span class="fu">process</span>(message)<span class="op">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (task<span class="op">.</span><span class="at">type</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;fine-tuning.&#39;</span>)) {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">fineTuningService</span><span class="op">.</span><span class="fu">process</span>(message)<span class="op">;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Unknown intelligence task: </span><span class="sc">${</span>task<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">manageResources</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Token budget management</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">tokenBudgetManager</span><span class="op">.</span><span class="fu">reconcile</span>()<span class="op">;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Model cache optimization</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">modelCache</span><span class="op">.</span><span class="fu">evictLRU</span>()<span class="op">;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Agent health checks</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">healthCheckAllAgents</span>()<span class="op">;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Key Features:</strong> - <strong>Token Budget
Management:</strong> Prevent OpenAI/HuggingFace cost overruns -
<strong>Model Caching:</strong> Optimize HuggingFace model loading -
<strong>Quality Assurance:</strong> Validate AI outputs before returning
- <strong>Performance Monitoring:</strong> Track model latency and
success rates</p>
<h3 data-number="5.1.4"
id="phase-3-multi-modal-supervisor-week-8-9"><span
class="header-section-number">5.1.4</span> Phase 3: Multi-Modal
Supervisor (Week 8-9)</h3>
<p><strong>Objective:</strong> Unify voice, vision, and cross-modal
processing</p>
<p><strong>Architecture:</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> MultiModalSupervisor <span class="kw">extends</span> BaseSupervisor {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> audioPipeline<span class="op">:</span> OptimizedAudioPipeline<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> visionPipeline<span class="op">:</span> VisualAnalysisService<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> crossModalFusion<span class="op">:</span> MultiModalProcessingService<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">processMultiModalRequest</span>(message<span class="op">:</span> MCPMessage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>MCPMessage<span class="op">&gt;</span> {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { task<span class="op">,</span> input } <span class="op">=</span> message<span class="op">.</span><span class="at">payload</span> <span class="im">as</span> TaskRequestPayload<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Analyze input modalities</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> modalities <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">detectModalities</span>(input)<span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (modalities<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">processSingleModal</span>(task<span class="op">,</span> input<span class="op">,</span> modalities[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">crossModalFusion</span><span class="op">.</span><span class="fu">process</span>(task<span class="op">,</span> input<span class="op">,</span> modalities)<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">detectModalities</span>(input<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> <span class="dt">string</span>[] {</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> modalities<span class="op">:</span> <span class="dt">string</span>[] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">files</span><span class="op">?.</span><span class="fu">some</span>(f <span class="kw">=&gt;</span> f<span class="op">.</span><span class="at">content_type</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;image/&#39;</span>))) {</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      modalities<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;vision&#39;</span>)<span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">files</span><span class="op">?.</span><span class="fu">some</span>(f <span class="kw">=&gt;</span> f<span class="op">.</span><span class="at">content_type</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;audio/&#39;</span>))) {</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>      modalities<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;audio&#39;</span>)<span class="op">;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">data</span> <span class="op">&amp;&amp;</span> <span class="kw">typeof</span> input<span class="op">.</span><span class="at">data</span> <span class="op">===</span> <span class="st">&#39;string&#39;</span>) {</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      modalities<span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;text&#39;</span>)<span class="op">;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> modalities<span class="op">;</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="5.1.5" id="phase-4-system-supervisor-week-10-11"><span
class="header-section-number">5.1.5</span> Phase 4: System Supervisor
(Week 10-11)</h3>
<p><strong>Objective:</strong> Centralize infrastructure, monitoring,
and operational concerns</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> SystemSupervisor <span class="kw">extends</span> BaseSupervisor {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> healthMonitor<span class="op">:</span> SystemHealthMonitor<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> telemetryAgent<span class="op">:</span> TelemetryAgent<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> lifeOSServices<span class="op">:</span> LifeOSService[]<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> securityAuditor<span class="op">:</span> SecurityAuditAgent<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleSystemTask</span>(message<span class="op">:</span> MCPMessage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>MCPMessage<span class="op">&gt;</span> {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { task } <span class="op">=</span> message<span class="op">.</span><span class="at">payload</span> <span class="im">as</span> TaskRequestPayload<span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> (task<span class="op">.</span><span class="at">type</span>) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;system.health_check&#39;</span><span class="op">:</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">performHealthCheck</span>()<span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;system.telemetry_query&#39;</span><span class="op">:</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">telemetryAgent</span><span class="op">.</span><span class="fu">query</span>(task<span class="op">.</span><span class="at">parameters</span>)<span class="op">;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;lifeos.calendar_sync&#39;</span><span class="op">:</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">lifeOSServices</span><span class="op">.</span><span class="at">calendar</span><span class="op">.</span><span class="fu">sync</span>()<span class="op">;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;security.audit&#39;</span><span class="op">:</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">securityAuditor</span><span class="op">.</span><span class="fu">performAudit</span>()<span class="op">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">default</span><span class="op">:</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Unknown system task: </span><span class="sc">${</span>task<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">performHealthCheck</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>MCPMessage<span class="op">&gt;</span> {</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> status <span class="op">=</span> {</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>      database<span class="op">:</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkDatabase</span>()<span class="op">,</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>      redis<span class="op">:</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkRedis</span>()<span class="op">,</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>      openai<span class="op">:</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkOpenAI</span>()<span class="op">,</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>      huggingface<span class="op">:</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkHuggingFace</span>()<span class="op">,</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>      deepgram<span class="op">:</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkDeepgram</span>()</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> MCPMessageType<span class="op">.</span><span class="at">TASK_RESPONSE</span><span class="op">,</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>      payload<span class="op">:</span> { status<span class="op">,</span> overall<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">computeOverallHealth</span>(status) }</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    } <span class="im">as</span> MCPMessage<span class="op">;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="5.1.6" id="phase-5-agent-migration-week-12-14"><span
class="header-section-number">5.1.6</span> Phase 5: Agent Migration
(Week 12-14)</h3>
<p><strong>Objective:</strong> Convert existing agents to Tier 2
sub-agents</p>
<p><strong>Agent Transformation Pattern:</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Before: Direct agent instantiation</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> visionAgent <span class="op">=</span> <span class="kw">new</span> <span class="fu">VisionMasterAgent</span>()<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> visionAgent<span class="op">.</span><span class="fu">analyzeImage</span>(imageData<span class="op">,</span> <span class="st">&#39;comprehensive&#39;</span>)<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">// After: MCP-mediated agent communication  </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> message<span class="op">:</span> MCPMessage <span class="op">=</span> {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> MCPMessageType<span class="op">.</span><span class="at">TASK_REQUEST</span><span class="op">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  payload<span class="op">:</span> {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    task<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;vision.analyze_image&#39;</span><span class="op">,</span> parameters<span class="op">:</span> { analysis_type<span class="op">:</span> <span class="st">&#39;comprehensive&#39;</span> }}<span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span> { files<span class="op">:</span> [{ name<span class="op">:</span> <span class="st">&#39;image.jpg&#39;</span><span class="op">,</span> inline_data<span class="op">:</span> base64Image }]}</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">mcpTransport</span><span class="op">.</span><span class="fu">send</span>(message)<span class="op">;</span></span></code></pre></div>
<p><strong>Agent Wrapper Implementation:</strong></p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> VisionMasterAgentMCP <span class="kw">extends</span> BaseMCPAgent {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> visionAgent <span class="op">=</span> <span class="kw">new</span> <span class="fu">VisionMasterAgent</span>()<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleMessage</span>(message<span class="op">:</span> MCPMessage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>MCPMessage<span class="op">&gt;</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> { task<span class="op">,</span> input } <span class="op">=</span> message<span class="op">.</span><span class="at">payload</span> <span class="im">as</span> TaskRequestPayload<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Convert MCP input to agent format</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> agentInput <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">transformInput</span>(input)<span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Execute original agent logic</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">visionAgent</span><span class="op">.</span><span class="fu">analyzeImage</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        agentInput<span class="op">.</span><span class="at">imageData</span><span class="op">,</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        task<span class="op">.</span><span class="at">parameters</span><span class="op">.</span><span class="at">analysis_type</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Return MCP response</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createSuccessResponse</span>(message<span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createErrorResponse</span>(message<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="5.1.7"
id="phase-6-legacy-route-migration-week-15-16"><span
class="header-section-number">5.1.7</span> Phase 6: Legacy Route
Migration (Week 15-16)</h3>
<p><strong>Objective:</strong> Replace direct HTTP routes with
MCP-mediated requests</p>
<p><strong>HTTP → MCP Bridge:</strong></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// packages/orchestrator/src/routes/bridge.ts</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">createMCPBridge</span>(path<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> supervisor<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> taskType<span class="op">:</span> <span class="dt">string</span>) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">async</span> (req<span class="op">:</span> Request<span class="op">,</span> res<span class="op">:</span> Response) <span class="kw">=&gt;</span> {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> message<span class="op">:</span> MCPMessage <span class="op">=</span> {</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="fu">generateUUID</span>()<span class="op">,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      sender<span class="op">:</span> <span class="st">&#39;http-bridge@v1.0&#39;</span><span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      recipient<span class="op">:</span> <span class="vs">`supervisor.</span><span class="sc">${</span>supervisor<span class="sc">}</span><span class="vs">@v1.0`</span><span class="op">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> MCPMessageType<span class="op">.</span><span class="at">TASK_REQUEST</span><span class="op">,</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      payload<span class="op">:</span> {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        task<span class="op">:</span> { type<span class="op">:</span> taskType<span class="op">,</span> parameters<span class="op">:</span> req<span class="op">.</span><span class="at">body</span> }<span class="op">,</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        input<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">extractInput</span>(req)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      context<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">extractContext</span>(req)<span class="op">,</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ... other fields</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">mcpTransport</span><span class="op">.</span><span class="fu">send</span>(message)<span class="op">;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">json</span>(response<span class="op">.</span><span class="at">payload</span>)<span class="op">;</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ error<span class="op">:</span> error<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Route registration</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">post</span>(<span class="st">&#39;/api/huggingface/vision&#39;</span><span class="op">,</span> </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">createMCPBridge</span>(<span class="st">&#39;huggingface-vision&#39;</span><span class="op">,</span> <span class="st">&#39;intelligence&#39;</span><span class="op">,</span> <span class="st">&#39;huggingface.vision&#39;</span>))<span class="op">;</span></span></code></pre></div>
<h2 data-number="5.2" id="backward-compatibility-strategy"><span
class="header-section-number">5.2</span> 4.2 Backward Compatibility
Strategy</h2>
<h3 data-number="5.2.1" id="api-version-management"><span
class="header-section-number">5.2.1</span> 4.2.1 API Version
Management</h3>
<ul>
<li>Maintain existing v2 API endpoints during migration</li>
<li>Introduce v3 endpoints with MCP architecture</li>
<li>Provide 6-month deprecation timeline for v2</li>
<li>Use HTTP 301 redirects where appropriate</li>
</ul>
<h3 data-number="5.2.2" id="database-migration-strategy"><span
class="header-section-number">5.2.2</span> 4.2.2 Database Migration
Strategy</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Add MCP-specific tables alongside existing ones</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> mcp_messages (</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  correlation_id UUID <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  sender <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  recipient <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  payload JSONB <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  processed_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;pending&#39;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create indexes for performance</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_mcp_messages_correlation <span class="kw">ON</span> mcp_messages(correlation_id);</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_mcp_messages_recipient <span class="kw">ON</span> mcp_messages(recipient);</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_mcp_messages_created <span class="kw">ON</span> mcp_messages(created_at);</span></code></pre></div>
<h3 data-number="5.2.3" id="configuration-migration"><span
class="header-section-number">5.2.3</span> 4.2.3 Configuration
Migration</h3>
<div class="sourceCode" id="cb15"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Support both old and new configuration formats</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ConfigV2 {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  agents<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> AgentConfig<span class="op">&gt;;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  services<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> ServiceConfig<span class="op">&gt;;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ConfigV3 {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  orchestrator<span class="op">:</span> OrchestratorConfig<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  supervisors<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> SupervisorConfig<span class="op">&gt;;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  mcp<span class="op">:</span> MCPConfig<span class="op">;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConfigMigrator {</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">migrate</span>(v2Config<span class="op">:</span> ConfigV2)<span class="op">:</span> ConfigV3 {</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>      orchestrator<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">migrateOrchestrator</span>(v2Config)<span class="op">,</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>      supervisors<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">migrateSupervisors</span>(v2Config)<span class="op">,</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>      mcp<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createMCPConfig</span>()</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h1 data-number="6" id="opentelemetry-integration-strategy"><span
class="header-section-number">6</span> 5. OpenTelemetry Integration
Strategy</h1>
<h2 data-number="6.1" id="cross-tier-trace-propagation"><span
class="header-section-number">6.1</span> 5.1 Cross-Tier Trace
Propagation</h2>
<h3 data-number="6.1.1" id="context-injection-points"><span
class="header-section-number">6.1.1</span> 5.1.1 Context Injection
Points</h3>
<div class="sourceCode" id="cb16"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Orchestrator → Supervisor</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">routeToSupervisor</span>(request<span class="op">:</span> <span class="dt">any</span><span class="op">,</span> supervisorName<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">await</span> tracer<span class="op">.</span><span class="fu">startActiveSpan</span>(<span class="st">&#39;mcp.supervisor.call&#39;</span><span class="op">,</span> <span class="kw">async</span> (span) <span class="kw">=&gt;</span> {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> message<span class="op">:</span> MCPMessage <span class="op">=</span> {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ... other fields</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      context<span class="op">:</span> {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        trace_id<span class="op">:</span> span<span class="op">.</span><span class="fu">spanContext</span>()<span class="op">.</span><span class="at">traceId</span><span class="op">,</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        span_id<span class="op">:</span> span<span class="op">.</span><span class="fu">spanContext</span>()<span class="op">.</span><span class="at">spanId</span><span class="op">,</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">mcpTransport</span><span class="op">.</span><span class="fu">send</span>(message)<span class="op">;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    span<span class="op">.</span><span class="fu">setAttributes</span>({</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;mcp.supervisor&#39;</span><span class="op">:</span> supervisorName<span class="op">,</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;mcp.task.type&#39;</span><span class="op">:</span> request<span class="op">.</span><span class="at">type</span><span class="op">,</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;mcp.response.status&#39;</span><span class="op">:</span> response<span class="op">.</span><span class="at">status</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Supervisor → Agent  </span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">delegateToAgent</span>(message<span class="op">:</span> MCPMessage<span class="op">,</span> agentName<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> {</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Recreate span context from message</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spanContext <span class="op">=</span> trace<span class="op">.</span><span class="fu">createSpanContext</span>({</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    traceId<span class="op">:</span> message<span class="op">.</span><span class="at">context</span><span class="op">.</span><span class="at">trace_id</span><span class="op">,</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    spanId<span class="op">:</span> message<span class="op">.</span><span class="at">context</span><span class="op">.</span><span class="at">span_id</span><span class="op">,</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    traceFlags<span class="op">:</span> TraceFlags<span class="op">.</span><span class="at">SAMPLED</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">await</span> tracer<span class="op">.</span><span class="fu">startSpan</span>(<span class="st">&#39;mcp.agent.execute&#39;</span><span class="op">,</span> {</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    parent<span class="op">:</span> spanContext</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> <span class="kw">async</span> (span) <span class="kw">=&gt;</span> {</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Execute agent task</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">agents</span>[agentName]<span class="op">.</span><span class="fu">execute</span>(message)<span class="op">;</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    span<span class="op">.</span><span class="fu">setAttributes</span>({</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;mcp.agent&#39;</span><span class="op">:</span> agentName<span class="op">,</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;mcp.task.duration_ms&#39;</span><span class="op">:</span> span<span class="op">.</span><span class="at">duration</span><span class="op">,</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;mcp.task.success&#39;</span><span class="op">:</span> <span class="op">!</span>result<span class="op">.</span><span class="at">error</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="6.1.2" id="custom-mcp-span-attributes"><span
class="header-section-number">6.1.2</span> 5.1.2 Custom MCP Span
Attributes</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> MCPSpanAttributes {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Message Flow</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.message.id&#39;</span><span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.message.type&#39;</span><span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.message.sender&#39;</span><span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.message.recipient&#39;</span><span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Performance</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.queue.wait_time_ms&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.processing.duration_ms&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.transport.latency_ms&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Resources</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.memory.peak_mb&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.cpu.utilization_percent&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.cost.tokens_used&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.cost.usd_estimate&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Quality</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.retry.count&#39;</span><span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.error.type&#39;</span><span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;mcp.result.quality_score&#39;</span><span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 data-number="6.2" id="distributed-tracing-architecture"><span
class="header-section-number">6.2</span> 5.2 Distributed Tracing
Architecture</h2>
<pre><code>┌─────────────┐    OTLP/gRPC    ┌─────────────────┐
│ Orchestrator│ ──────────────→ │ OTEL Collector │
└─────────────┘                 └─────────────────┘
                                         │
┌─────────────┐    OTLP/gRPC             ▼
│ Supervisors │ ──────────────→ ┌─────────────────┐
└─────────────┘                 │     Jaeger      │
                                └─────────────────┘
┌─────────────┐    OTLP/gRPC             │
│ Sub-Agents  │ ──────────────────────────┘
└─────────────┘</code></pre>
<h2 data-number="6.3" id="custom-metrics-and-dashboards"><span
class="header-section-number">6.3</span> 5.3 Custom Metrics and
Dashboards</h2>
<h3 data-number="6.3.1" id="mcp-specific-metrics"><span
class="header-section-number">6.3.1</span> 5.3.1 MCP-Specific
Metrics</h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// packages/mcp-core/src/metrics.ts</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> MCPMetrics {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> messageCounter <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">meter</span><span class="op">.</span><span class="fu">createCounter</span>(<span class="st">&#39;mcp_messages_total&#39;</span><span class="op">,</span> {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    description<span class="op">:</span> <span class="st">&#39;Total number of MCP messages processed&#39;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> processingDuration <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">meter</span><span class="op">.</span><span class="fu">createHistogram</span>(<span class="st">&#39;mcp_processing_duration_ms&#39;</span><span class="op">,</span> {</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    description<span class="op">:</span> <span class="st">&#39;Time spent processing MCP messages&#39;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> queueDepth <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">meter</span><span class="op">.</span><span class="fu">createUpDownCounter</span>(<span class="st">&#39;mcp_queue_depth&#39;</span><span class="op">,</span> {</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    description<span class="op">:</span> <span class="st">&#39;Current number of messages in supervisor queues&#39;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recordMessage</span>(supervisor<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> messageType<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> duration<span class="op">:</span> <span class="dt">number</span>) {</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">messageCounter</span><span class="op">.</span><span class="fu">add</span>(<span class="dv">1</span><span class="op">,</span> { supervisor<span class="op">,</span> message_type<span class="op">:</span> messageType })<span class="op">;</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">processingDuration</span><span class="op">.</span><span class="fu">record</span>(duration<span class="op">,</span> { supervisor<span class="op">,</span> message_type<span class="op">:</span> messageType })<span class="op">;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="6.3.2" id="grafana-dashboard-configuration"><span
class="header-section-number">6.3.2</span> 5.3.2 Grafana Dashboard
Configuration</h3>
<div class="sourceCode" id="cb20"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;dashboard&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Cartrita MCP Overview&quot;</span><span class="fu">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;panels&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Message Throughput by Supervisor&quot;</span><span class="fu">,</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;graph&quot;</span><span class="fu">,</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;targets&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;expr&quot;</span><span class="fu">:</span> <span class="st">&quot;rate(mcp_messages_total[5m])&quot;</span><span class="fu">,</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;legendFormat&quot;</span><span class="fu">:</span> <span class="st">&quot;{{supervisor}}&quot;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Processing Latency Percentiles&quot;</span><span class="fu">,</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;graph&quot;</span><span class="fu">,</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;targets&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;expr&quot;</span><span class="fu">:</span> <span class="st">&quot;histogram_quantile(0.95, rate(mcp_processing_duration_ms_bucket[5m]))&quot;</span><span class="fu">,</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;legendFormat&quot;</span><span class="fu">:</span> <span class="st">&quot;95th percentile&quot;</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h1 data-number="7" id="security-and-access-control"><span
class="header-section-number">7</span> 6. Security and Access
Control</h1>
<h2 data-number="7.1" id="multi-tier-security-model"><span
class="header-section-number">7.1</span> 6.1 Multi-Tier Security
Model</h2>
<h3 data-number="7.1.1" id="authentication-chain"><span
class="header-section-number">7.1.1</span> 6.1.1 Authentication
Chain</h3>
<pre><code>Client Request → JWT Validation → Orchestrator
                                      ↓
                               Supervisor Token
                                      ↓
                                Agent Execution Context</code></pre>
<h3 data-number="7.1.2" id="mcp-security-headers"><span
class="header-section-number">7.1.2</span> 6.1.2 MCP Security
Headers</h3>
<div class="sourceCode" id="cb22"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> MCPSecurityContext {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Authentication</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  user_id<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  session_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  permissions<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Authorization</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  resource_grants<span class="op">:</span> ResourceGrant[]<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  cost_budget<span class="op">:</span> CostBudget<span class="op">;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  rate_limits<span class="op">:</span> RateLimit[]<span class="op">;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Audit</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  audit_trail<span class="op">:</span> AuditEvent[]<span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  security_level<span class="op">:</span> <span class="st">&#39;public&#39;</span> <span class="op">|</span> <span class="st">&#39;internal&#39;</span> <span class="op">|</span> <span class="st">&#39;confidential&#39;</span> <span class="op">|</span> <span class="st">&#39;restricted&#39;</span><span class="op">;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MCPSecurityValidator {</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">validateMessage</span>(message<span class="op">:</span> MCPMessage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>ValidationResult<span class="op">&gt;</span> {</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check authentication</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateSender</span>(message<span class="op">.</span><span class="at">sender</span>)) {</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { valid<span class="op">:</span> <span class="kw">false</span><span class="op">,</span> reason<span class="op">:</span> <span class="st">&#39;Invalid sender credentials&#39;</span> }<span class="op">;</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check authorization</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkPermissions</span>(message<span class="op">.</span><span class="at">context</span><span class="op">,</span> message<span class="op">.</span><span class="at">type</span>)) {</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { valid<span class="op">:</span> <span class="kw">false</span><span class="op">,</span> reason<span class="op">:</span> <span class="st">&#39;Insufficient permissions&#39;</span> }<span class="op">;</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check resource limits</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkResourceLimits</span>(message<span class="op">.</span><span class="at">context</span><span class="op">,</span> message<span class="op">.</span><span class="at">payload</span>)) {</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { valid<span class="op">:</span> <span class="kw">false</span><span class="op">,</span> reason<span class="op">:</span> <span class="st">&#39;Resource limits exceeded&#39;</span> }<span class="op">;</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { valid<span class="op">:</span> <span class="kw">true</span> }<span class="op">;</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 data-number="7.2" id="secret-management-integration"><span
class="header-section-number">7.2</span> 6.2 Secret Management
Integration</h2>
<h3 data-number="7.2.1" id="hashicorp-vault-integration"><span
class="header-section-number">7.2.1</span> 6.2.1 HashiCorp Vault
Integration</h3>
<div class="sourceCode" id="cb23"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// packages/mcp-security/src/VaultManager.ts</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> MCPVaultManager {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> vault<span class="op">:</span> VaultApi<span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getCredentials</span>(path<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">string</span><span class="op">&gt;&gt;</span> {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> secret <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">vault</span><span class="op">.</span><span class="fu">read</span>(<span class="vs">`secret/mcp/</span><span class="sc">${</span>path<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> secret<span class="op">.</span><span class="at">data</span><span class="op">;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">rotateApiKeys</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> keys <span class="op">=</span> [<span class="st">&#39;openai&#39;</span><span class="op">,</span> <span class="st">&#39;huggingface&#39;</span><span class="op">,</span> <span class="st">&#39;deepgram&#39;</span>]<span class="op">;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> key <span class="kw">of</span> keys) {</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> newKey <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">generateNewKey</span>(key)<span class="op">;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">vault</span><span class="op">.</span><span class="fu">write</span>(<span class="vs">`secret/mcp/keys/</span><span class="sc">${</span>key<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> { value<span class="op">:</span> newKey })<span class="op">;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">notifyServices</span>(key<span class="op">,</span> newKey)<span class="op">;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 data-number="7.3" id="audit-and-compliance"><span
class="header-section-number">7.3</span> 6.3 Audit and Compliance</h2>
<h3 data-number="7.3.1" id="comprehensive-audit-logging"><span
class="header-section-number">7.3.1</span> 6.3.1 Comprehensive Audit
Logging</h3>
<div class="sourceCode" id="cb24"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> MCPAuditEvent {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  event_type<span class="op">:</span> <span class="st">&#39;message_sent&#39;</span> <span class="op">|</span> <span class="st">&#39;message_received&#39;</span> <span class="op">|</span> <span class="st">&#39;security_violation&#39;</span> <span class="op">|</span> <span class="st">&#39;resource_access&#39;</span><span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  actor<span class="op">:</span> {</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    user_id<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    supervisor<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    agent<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  target<span class="op">:</span> {</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    resource<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    operation<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  context<span class="op">:</span> {</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    trace_id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    security_level<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    cost_impact<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  outcome<span class="op">:</span> <span class="st">&#39;success&#39;</span> <span class="op">|</span> <span class="st">&#39;failure&#39;</span> <span class="op">|</span> <span class="st">&#39;blocked&#39;</span><span class="op">;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">unknown</span><span class="op">&gt;;</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MCPAuditLogger {</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">logEvent</span>(event<span class="op">:</span> MCPAuditEvent)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Store in database for compliance</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">database</span><span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="vs">      INSERT INTO mcp_audit_log (timestamp, event_type, actor, target, context, outcome, metadata)</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="vs">      VALUES ($1, $2, $3, $4, $5, $6, $7)</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span> [<span class="bu">event</span><span class="op">.</span><span class="at">timestamp</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">event_type</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="bu">event</span><span class="op">.</span><span class="at">actor</span>)<span class="op">,</span> </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="bu">event</span><span class="op">.</span><span class="at">context</span>)<span class="op">,</span> </span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">outcome</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="bu">event</span><span class="op">.</span><span class="at">metadata</span>)])<span class="op">;</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send to SIEM if security violation</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">event_type</span> <span class="op">===</span> <span class="st">&#39;security_violation&#39;</span>) {</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">siemIntegration</span><span class="op">.</span><span class="fu">sendAlert</span>(<span class="bu">event</span>)<span class="op">;</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h1 data-number="8"
id="performance-optimization-and-resource-management"><span
class="header-section-number">8</span> 7. Performance Optimization and
Resource Management</h1>
<h2 data-number="8.1" id="intelligent-resource-allocation"><span
class="header-section-number">8.1</span> 7.1 Intelligent Resource
Allocation</h2>
<h3 data-number="8.1.1" id="dynamic-supervisor-scaling"><span
class="header-section-number">8.1.1</span> 7.1.1 Dynamic Supervisor
Scaling</h3>
<div class="sourceCode" id="cb25"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SupervisorResourceManager {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> resourceMetrics <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> ResourceUsage<span class="op">&gt;</span>()<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> scalingPolicies <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> ScalingPolicy<span class="op">&gt;</span>()<span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">monitorAndScale</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> [supervisor<span class="op">,</span> usage] <span class="kw">of</span> <span class="kw">this</span><span class="op">.</span><span class="at">resourceMetrics</span><span class="op">.</span><span class="fu">entries</span>()) {</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> policy <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">scalingPolicies</span><span class="op">.</span><span class="fu">get</span>(supervisor)<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (usage<span class="op">.</span><span class="at">cpu</span> <span class="op">&gt;</span> policy<span class="op">.</span><span class="at">cpu_threshold</span> <span class="op">||</span> usage<span class="op">.</span><span class="at">memory</span> <span class="op">&gt;</span> policy<span class="op">.</span><span class="at">memory_threshold</span>) {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">scaleUp</span>(supervisor<span class="op">,</span> usage)<span class="op">;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (usage<span class="op">.</span><span class="at">idle_time</span> <span class="op">&gt;</span> policy<span class="op">.</span><span class="at">idle_threshold</span>) {</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">scaleDown</span>(supervisor)<span class="op">;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">async</span> <span class="fu">scaleUp</span>(supervisor<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> usage<span class="op">:</span> ResourceUsage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Launch additional worker processes</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> workerId <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>supervisor<span class="sc">}</span><span class="vs">-worker-</span><span class="sc">${</span><span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">processManager</span><span class="op">.</span><span class="fu">spawn</span>({</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> workerId<span class="op">,</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>      command<span class="op">:</span> <span class="vs">`node supervisor-</span><span class="sc">${</span>supervisor<span class="sc">}</span><span class="vs">/dist/main.js`</span><span class="op">,</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>      env<span class="op">:</span> { <span class="op">...</span><span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">,</span> WORKER_ID<span class="op">:</span> workerId }<span class="op">,</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>      resources<span class="op">:</span> {</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        cpu_limit<span class="op">:</span> <span class="st">&#39;2&#39;</span><span class="op">,</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        memory_limit<span class="op">:</span> <span class="st">&#39;2Gi&#39;</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Register worker with load balancer</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">loadBalancer</span><span class="op">.</span><span class="fu">addWorker</span>(supervisor<span class="op">,</span> workerId)<span class="op">;</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="8.1.2" id="intelligent-caching-strategy"><span
class="header-section-number">8.1.2</span> 7.1.2 Intelligent Caching
Strategy</h3>
<div class="sourceCode" id="cb26"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MCPCacheManager {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> memoryCache <span class="op">=</span> <span class="kw">new</span> <span class="fu">LRUCache</span>({ max<span class="op">:</span> <span class="dv">1000</span> })<span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> redisCache<span class="op">:</span> Redis<span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> pgvectorCache<span class="op">:</span> PGVectorStore<span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">get</span>(key<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> context<span class="op">:</span> MCPContext)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">any</span><span class="op">&gt;</span> {</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// L1: Memory cache (fastest)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> result <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">memoryCache</span><span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (result) {</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">recordCacheHit</span>(<span class="st">&#39;memory&#39;</span><span class="op">,</span> key)<span class="op">;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// L2: Redis cache (fast)</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">redisCache</span><span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (result) {</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">memoryCache</span><span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">recordCacheHit</span>(<span class="st">&#39;redis&#39;</span><span class="op">,</span> key)<span class="op">;</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(result)<span class="op">;</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// L3: Vector similarity cache (intelligent)</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (context<span class="op">.</span><span class="at">user_id</span> <span class="op">&amp;&amp;</span> context<span class="op">.</span><span class="at">task_type</span>) {</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> similar <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">pgvectorCache</span><span class="op">.</span><span class="fu">findSimilar</span>(key<span class="op">,</span> {</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>        user_id<span class="op">:</span> context<span class="op">.</span><span class="at">user_id</span><span class="op">,</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>        task_type<span class="op">:</span> context<span class="op">.</span><span class="at">task_type</span><span class="op">,</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>        similarity_threshold<span class="op">:</span> <span class="fl">0.85</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (similar<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">recordCacheHit</span>(<span class="st">&#39;vector&#39;</span><span class="op">,</span> key)<span class="op">;</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> similar[<span class="dv">0</span>]<span class="op">.</span><span class="at">result</span><span class="op">;</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">recordCacheMiss</span>(key)<span class="op">;</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 data-number="8.2" id="cost-management-and-optimization"><span
class="header-section-number">8.2</span> 7.2 Cost Management and
Optimization</h2>
<h3 data-number="8.2.1" id="multi-provider-cost-tracking"><span
class="header-section-number">8.2.1</span> 7.2.1 Multi-Provider Cost
Tracking</h3>
<div class="sourceCode" id="cb27"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> CostTracker {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  openai<span class="op">:</span> {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    tokens_used<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    cost_usd<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    model_breakdown<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">number</span><span class="op">&gt;;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  huggingface<span class="op">:</span> {</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    inference_calls<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    cost_usd<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    model_breakdown<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">number</span><span class="op">&gt;;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  deepgram<span class="op">:</span> {</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    minutes_processed<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    cost_usd<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  total_cost_usd<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  budget_remaining<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CostOptimizer {</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">optimizeRequest</span>(request<span class="op">:</span> TaskRequest)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>TaskRequest<span class="op">&gt;</span> {</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentCosts <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getCurrentCosts</span>()<span class="op">;</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If approaching budget limits, use cheaper alternatives</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (currentCosts<span class="op">.</span><span class="at">budget_remaining</span> <span class="op">&lt;</span> <span class="fl">10.0</span>) {</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>      request <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">applyCostReductions</span>(request)<span class="op">;</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Optimize model selection based on cost/performance</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (request<span class="op">.</span><span class="at">task</span><span class="op">.</span><span class="at">type</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;huggingface.&#39;</span>)) {</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">model</span> <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">selectOptimalModel</span>(request<span class="op">,</span> currentCosts)<span class="op">;</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> request<span class="op">;</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">async</span> <span class="fu">applyCostReductions</span>(request<span class="op">:</span> TaskRequest)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>TaskRequest<span class="op">&gt;</span> {</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Switch to smaller models</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (request<span class="op">.</span><span class="at">model</span> <span class="op">===</span> <span class="st">&#39;gpt-4&#39;</span>) {</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">model</span> <span class="op">=</span> <span class="st">&#39;gpt-4o-mini&#39;</span><span class="op">;</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reduce quality for cost</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (request<span class="op">.</span><span class="at">preferences</span><span class="op">?.</span><span class="at">quality_level</span> <span class="op">===</span> <span class="st">&#39;best&#39;</span>) {</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">preferences</span><span class="op">.</span><span class="at">quality_level</span> <span class="op">=</span> <span class="st">&#39;balanced&#39;</span><span class="op">;</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Enable aggressive caching</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    request<span class="op">.</span><span class="at">cache_policy</span> <span class="op">=</span> <span class="st">&#39;aggressive&#39;</span><span class="op">;</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> request<span class="op">;</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h1 data-number="9" id="development-and-testing-strategy"><span
class="header-section-number">9</span> 8. Development and Testing
Strategy</h1>
<h2 data-number="9.1" id="mcp-aware-testing-framework"><span
class="header-section-number">9.1</span> 8.1 MCP-Aware Testing
Framework</h2>
<h3 data-number="9.1.1" id="message-flow-testing"><span
class="header-section-number">9.1.1</span> 8.1.1 Message Flow
Testing</h3>
<div class="sourceCode" id="cb28"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// packages/mcp-testing/src/MessageFlowTester.ts</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> MCPMessageFlowTester {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> orchestrator<span class="op">:</span> TestOrchestrator<span class="op">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> supervisors<span class="op">:</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> TestSupervisor<span class="op">&gt;;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">testCompleteFlow</span>(scenario<span class="op">:</span> TestScenario)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>TestResult<span class="op">&gt;</span> {</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> traceId <span class="op">=</span> <span class="fu">generateUUID</span>()<span class="op">;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start trace</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> trace <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">tracer</span><span class="op">.</span><span class="fu">startTrace</span>(traceId)<span class="op">;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send initial request</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> initialMessage<span class="op">:</span> MCPMessage <span class="op">=</span> {</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="fu">generateUUID</span>()<span class="op">,</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      sender<span class="op">:</span> <span class="st">&#39;test-client@v1.0&#39;</span><span class="op">,</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>      recipient<span class="op">:</span> <span class="st">&#39;orchestrator@v1.0&#39;</span><span class="op">,</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> MCPMessageType<span class="op">.</span><span class="at">TASK_REQUEST</span><span class="op">,</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      payload<span class="op">:</span> scenario<span class="op">.</span><span class="at">request</span><span class="op">,</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      context<span class="op">:</span> { trace_id<span class="op">:</span> traceId }</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">orchestrator</span><span class="op">.</span><span class="fu">handleMessage</span>(initialMessage)<span class="op">;</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validate message flow</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> messageFlow <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">traceAnalyzer</span><span class="op">.</span><span class="fu">getMessageFlow</span>(traceId)<span class="op">;</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>      success<span class="op">:</span> response<span class="op">.</span><span class="at">type</span> <span class="op">!==</span> MCPMessageType<span class="op">.</span><span class="at">TASK_ERROR</span><span class="op">,</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>      response_time_ms<span class="op">:</span> response<span class="op">.</span><span class="at">timestamp</span> <span class="op">-</span> initialMessage<span class="op">.</span><span class="at">timestamp</span><span class="op">,</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>      message_count<span class="op">:</span> messageFlow<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>      supervisors_involved<span class="op">:</span> messageFlow<span class="op">.</span><span class="fu">map</span>(m <span class="kw">=&gt;</span> m<span class="op">.</span><span class="at">recipient</span>)<span class="op">.</span><span class="fu">filter</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="fu">includes</span>(<span class="st">&#39;supervisor&#39;</span>))<span class="op">,</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>      agents_involved<span class="op">:</span> messageFlow<span class="op">.</span><span class="fu">map</span>(m <span class="kw">=&gt;</span> m<span class="op">.</span><span class="at">recipient</span>)<span class="op">.</span><span class="fu">filter</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="fu">includes</span>(<span class="st">&#39;agent&#39;</span>))<span class="op">,</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>      cost_estimate<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculateTestCost</span>(messageFlow)<span class="op">,</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>      trace_completeness<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateTraceCompleteness</span>(messageFlow)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="9.1.2" id="load-testing-with-mcp-simulation"><span
class="header-section-number">9.1.2</span> 8.1.2 Load Testing with MCP
Simulation</h3>
<div class="sourceCode" id="cb29"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MCPLoadTester {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">runLoadTest</span>(config<span class="op">:</span> LoadTestConfig)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>LoadTestResult<span class="op">&gt;</span> {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> clients <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ length<span class="op">:</span> config<span class="op">.</span><span class="at">concurrent_clients</span> }<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">new</span> <span class="fu">MCPTestClient</span>(<span class="vs">`client-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startTime <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> promises <span class="op">=</span> clients<span class="op">.</span><span class="fu">map</span>(client <span class="kw">=&gt;</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">runClientScenario</span>(client<span class="op">,</span> config<span class="op">.</span><span class="at">scenario</span><span class="op">,</span> config<span class="op">.</span><span class="at">duration_ms</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> results <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>(promises)<span class="op">;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>      total_requests<span class="op">:</span> results<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> r) <span class="kw">=&gt;</span> sum <span class="op">+</span> r<span class="op">.</span><span class="at">requests</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>      successful_requests<span class="op">:</span> results<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> r) <span class="kw">=&gt;</span> sum <span class="op">+</span> r<span class="op">.</span><span class="at">successes</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>      average_response_time<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculateAverage</span>(results<span class="op">.</span><span class="fu">map</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">avg_response_time</span>))<span class="op">,</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>      p95_response_time<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculatePercentile</span>(results<span class="op">.</span><span class="fu">map</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">response_times</span>)<span class="op">,</span> <span class="fl">0.95</span>)<span class="op">,</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>      errors_by_type<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateErrors</span>(results)<span class="op">,</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>      resource_usage<span class="op">:</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getResourceUsage</span>()<span class="op">,</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>      cost_analysis<span class="op">:</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getCostAnalysis</span>()</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 data-number="9.2" id="continuous-integration-pipeline"><span
class="header-section-number">9.2</span> 8.2 Continuous Integration
Pipeline</h2>
<h3 data-number="9.2.1" id="multi-stage-testing-pipeline"><span
class="header-section-number">9.2.1</span> 8.2.1 Multi-Stage Testing
Pipeline</h3>
<div class="sourceCode" id="cb30"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .github/workflows/mcp-ci.yml</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> MCP CI Pipeline</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">push</span><span class="kw">,</span><span class="at"> pull_request</span><span class="kw">]</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">unit-tests</span><span class="kw">:</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-node@v4</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">node-version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;20&#39;</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm ci</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm run test:unit</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">integration-tests</span><span class="kw">:</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> unit-tests</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ankane/pgvector:15</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> 5432:5432</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> redis:7-alpine</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> 6379:6379</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-node@v4</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">node-version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;20&#39;</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm ci</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm run test:integration</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mcp-flow-tests</span><span class="kw">:</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> integration-tests</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-node@v4</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">node-version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;20&#39;</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm ci</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm run build</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm run test:mcp-flows</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">performance-tests</span><span class="kw">:</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> mcp-flow-tests</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-node@v4</span></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">node-version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;20&#39;</span></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm ci</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm run build</span></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">run</span><span class="kw">:</span><span class="at"> npm run test:performance</span></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/upload-artifact@v3</span></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> performance-report</span></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">path</span><span class="kw">:</span><span class="at"> test-results/performance/</span></span></code></pre></div>
<hr />
<h1 data-number="10" id="deployment-and-operations"><span
class="header-section-number">10</span> 9. Deployment and
Operations</h1>
<h2 data-number="10.1" id="docker-based-deployment-strategy"><span
class="header-section-number">10.1</span> 9.1 Docker-Based Deployment
Strategy</h2>
<h3 data-number="10.1.1" id="multi-stage-container-architecture"><span
class="header-section-number">10.1.1</span> 9.1.1 Multi-Stage Container
Architecture</h3>
<div class="sourceCode" id="cb31"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dockerfile.mcp-orchestrator</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:20-alpine <span class="kw">AS</span> builder</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> package*.json ./</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> packages/orchestrator/package*.json ./packages/orchestrator/</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> ci <span class="at">--workspaces</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> packages/orchestrator/ ./packages/orchestrator/</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> packages/mcp-core/ ./packages/mcp-core/</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> run build</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:20-alpine <span class="kw">AS</span> runtime</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=builder</span> /app/packages/orchestrator/dist ./</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=builder</span> /app/node_modules ./node_modules</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8001</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;node&quot;</span>, <span class="st">&quot;main.js&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dockerfile.mcp-supervisor</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:20-alpine <span class="kw">AS</span> supervisor-base</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apk</span> add <span class="at">--no-cache</span> python3 py3-pip</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> requirements.txt ./</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip3</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> supervisor-base <span class="kw">AS</span> intelligence-supervisor</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> packages/supervisor-intelligence/ ./</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;node&quot;</span>, <span class="st">&quot;dist/main.js&quot;</span>]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> supervisor-base <span class="kw">AS</span> multimodal-supervisor  </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> packages/supervisor-multimodal/ ./</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;node&quot;</span>, <span class="st">&quot;dist/main.js&quot;</span>]</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> supervisor-base <span class="kw">AS</span> system-supervisor</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> packages/supervisor-system/ ./</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;node&quot;</span>, <span class="st">&quot;dist/main.js&quot;</span>]</span></code></pre></div>
<h3 data-number="10.1.2" id="docker-compose-configuration"><span
class="header-section-number">10.1.2</span> 9.1.2 Docker Compose
Configuration</h3>
<div class="sourceCode" id="cb33"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker-compose.mcp.yml</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">orchestrator</span><span class="kw">:</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-orchestrator</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8001:8001&quot;</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> NODE_ENV=production</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> DATABASE_URL=postgresql://cartrita:${DB_PASSWORD}@postgres:5432/cartrita</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> REDIS_URL=redis://redis:6379</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> redis</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> supervisor-intelligence</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> supervisor-multimodal</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> supervisor-system</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">supervisor-intelligence</span><span class="kw">:</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-supervisor</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span><span class="at"> intelligence-supervisor</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SUPERVISOR_TYPE=intelligence</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OPENAI_API_KEY=${OPENAI_API_KEY}</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> HUGGINGFACE_API_TOKEN=${HUGGINGFACE_API_TOKEN}</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">supervisor-multimodal</span><span class="kw">:</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-supervisor</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span><span class="at"> multimodal-supervisor</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SUPERVISOR_TYPE=multimodal</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> DEEPGRAM_API_KEY=${DEEPGRAM_API_KEY}</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">supervisor-system</span><span class="kw">:</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-supervisor  </span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span><span class="at"> system-supervisor</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SUPERVISOR_TYPE=system</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ankane/pgvector:15</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_DB=cartrita</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_USER=cartrita</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_PASSWORD=${DB_PASSWORD}</span></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./db-init:/docker-entrypoint-initdb.d</span></span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> redis:7-alpine</span></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> redis_data:/data</span></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">otel-collector</span><span class="kw">:</span></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> otel/opentelemetry-collector-contrib:0.97.0</span></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;--config=/etc/otel-collector-config.yml&quot;</span><span class="kw">]</span></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./otel-collector-config.yml:/etc/otel-collector-config.yml</span></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;4317:4317&quot;</span><span class="co">   # OTLP gRPC</span></span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;4318:4318&quot;</span><span class="co">   # OTLP HTTP</span></span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">jaeger</span><span class="kw">:</span></span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> jaegertracing/all-in-one:1.47</span></span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;16686:16686&quot;</span></span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;14268:14268&quot;</span></span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> COLLECTOR_OTLP_ENABLED=true</span></span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mcp-network</span><span class="kw">:</span></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> bridge</span></span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis_data</span><span class="kw">:</span></span></code></pre></div>
<h2 data-number="10.2" id="kubernetes-deployment-optional"><span
class="header-section-number">10.2</span> 9.2 Kubernetes Deployment
(Optional)</h2>
<h3 data-number="10.2.1" id="orchestrator-deployment"><span
class="header-section-number">10.2.1</span> 9.2.1 Orchestrator
Deployment</h3>
<div class="sourceCode" id="cb34"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k8s/orchestrator-deployment.yml</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cartrita-orchestrator</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> cartrita-orchestrator</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> cartrita-orchestrator</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> cartrita-orchestrator</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> orchestrator</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> cartrita/mcp-orchestrator:latest</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">8001</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> NODE_ENV</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;production&quot;</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DATABASE_URL</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cartrita-secrets</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> database-url</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;512Mi&quot;</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1Gi&quot;</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1000m&quot;</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">readinessProbe</span><span class="kw">:</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8001</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">livenessProbe</span><span class="kw">:</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8001</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Service</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cartrita-orchestrator-service</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> cartrita-orchestrator</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">protocol</span><span class="kw">:</span><span class="at"> TCP</span></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">targetPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">8001</span></span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadBalancer</span></span></code></pre></div>
<h3 data-number="10.2.2" id="supervisor-deployments"><span
class="header-section-number">10.2.2</span> 9.2.2 Supervisor
Deployments</h3>
<div class="sourceCode" id="cb35"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># k8s/supervisors-deployment.yml</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cartrita-intelligence-supervisor</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> intelligence-supervisor</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> intelligence-supervisor</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> supervisor</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> cartrita/mcp-supervisor:intelligence-latest</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> SUPERVISOR_TYPE</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;intelligence&quot;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> OPENAI_API_KEY</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cartrita-secrets</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> openai-key</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1Gi&quot;</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1000m&quot;</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;2Gi&quot;</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;2000m&quot;</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Similar deployments for multimodal-supervisor and system-supervisor</span></span></code></pre></div>
<h2 data-number="10.3" id="monitoring-and-alerting"><span
class="header-section-number">10.3</span> 9.3 Monitoring and
Alerting</h2>
<h3 data-number="10.3.1" id="prometheus-metrics-configuration"><span
class="header-section-number">10.3.1</span> 9.3.1 Prometheus Metrics
Configuration</h3>
<div class="sourceCode" id="cb36"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prometheus/prometheus.yml</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">global</span><span class="kw">:</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scrape_interval</span><span class="kw">:</span><span class="at"> 15s</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_configs</span><span class="kw">:</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cartrita-orchestrator&#39;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">static_configs</span><span class="kw">:</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">targets</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;orchestrator:8001&#39;</span><span class="kw">]</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metrics_path</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;/metrics&#39;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">scrape_interval</span><span class="kw">:</span><span class="at"> 5s</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cartrita-supervisors&#39;</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">static_configs</span><span class="kw">:</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">targets</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;supervisor-intelligence:8002&#39;</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;supervisor-multimodal:8003&#39;</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;supervisor-system:8004&#39;</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metrics_path</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;/metrics&#39;</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">scrape_interval</span><span class="kw">:</span><span class="at"> 10s</span></span></code></pre></div>
<h3 data-number="10.3.2" id="critical-alerting-rules"><span
class="header-section-number">10.3.2</span> 9.3.2 Critical Alerting
Rules</h3>
<div class="sourceCode" id="cb37"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alerts/cartrita-mcp.yml</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cartrita-mcp</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> MCPOrchestratorDown</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> up{job=&quot;cartrita-orchestrator&quot;} == 0</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 1m</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Cartrita orchestrator is down&quot;</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> MCPHighErrorRate</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> rate(mcp_messages_total{status=&quot;error&quot;}[5m]) &gt; 0.1</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 2m</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> warning</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;High MCP error rate detected&quot;</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> MCPHighLatency</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> histogram_quantile(0.95, rate(mcp_processing_duration_ms_bucket[5m])) &gt; 5000</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 3m</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> warning</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;MCP processing latency is high&quot;</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> MCPCostBudgetExceeded</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> mcp_daily_cost_usd &gt; 100</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 1m</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Daily cost budget exceeded&quot;</span></span></code></pre></div>
<hr />
<h1 data-number="11" id="migration-checklist-and-success-criteria"><span
class="header-section-number">11</span> 10. Migration Checklist and
Success Criteria</h1>
<h2 data-number="11.1" id="pre-migration-checklist"><span
class="header-section-number">11.1</span> 10.1 Pre-Migration
Checklist</h2>
<h3 data-number="11.1.1" id="infrastructure-readiness"><span
class="header-section-number">11.1.1</span> 10.1.1 Infrastructure
Readiness</h3>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>Docker Environment
Setup</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />Docker 20.10+ installed on all
target systems</label></li>
<li><label><input type="checkbox" />Docker Compose v2
available</label></li>
<li><label><input type="checkbox" />Container registry access
configured</label></li>
<li><label><input type="checkbox" />Network policies defined and
tested</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Database
Preparation</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />PostgreSQL 14+ with pgvector
extension</label></li>
<li><label><input type="checkbox" />Database migration scripts
tested</label></li>
<li><label><input type="checkbox" />Backup and recovery procedures
validated</label></li>
<li><label><input type="checkbox" />Performance baseline
established</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Observability
Stack</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />OpenTelemetry Collector deployed and
configured</label></li>
<li><label><input type="checkbox" />Jaeger/Tempo instance
running</label></li>
<li><label><input type="checkbox" />Prometheus metrics collection
active</label></li>
<li><label><input type="checkbox" />Grafana dashboards
created</label></li>
<li><label><input type="checkbox" />Alert rules configured and
tested</label></li>
</ul></li>
</ul>
<h3 data-number="11.1.2" id="code-readiness"><span
class="header-section-number">11.1.2</span> 10.1.2 Code Readiness</h3>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>MCP Core
Library</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />Message protocol implementation
complete</label></li>
<li><label><input type="checkbox" />Transport layer abstraction
functional</label></li>
<li><label><input type="checkbox" />OpenTelemetry integration
working</label></li>
<li><label><input type="checkbox" />Unit tests passing (&gt;95%
coverage)</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Orchestrator
Package</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />HTTP request routing
functional</label></li>
<li><label><input type="checkbox" />WebSocket connections
stable</label></li>
<li><label><input type="checkbox" />Supervisor communication
established</label></li>
<li><label><input type="checkbox" />Health checks
implemented</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Supervisor
Packages</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />Intelligence supervisor with
HuggingFace integration</label></li>
<li><label><input type="checkbox" />Multi-modal supervisor with
voice/vision pipelines</label></li>
<li><label><input type="checkbox" />System supervisor with telemetry and
life OS</label></li>
<li><label><input type="checkbox" />Inter-supervisor communication
protocols</label></li>
</ul></li>
</ul>
<h2 data-number="11.2" id="migration-success-criteria"><span
class="header-section-number">11.2</span> 10.2 Migration Success
Criteria</h2>
<h3 data-number="11.2.1" id="functional-requirements"><span
class="header-section-number">11.2.1</span> 10.2.1 Functional
Requirements</h3>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>API
Compatibility</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />All existing v2 API endpoints
respond correctly</label></li>
<li><label><input type="checkbox" />Response times within 150% of
baseline</label></li>
<li><label><input type="checkbox" />Error rates remain below
1%</label></li>
<li><label><input type="checkbox" />WebSocket connections stable under
load</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Agent
Functionality</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />All 15 agents accessible via
MCP</label></li>
<li><label><input type="checkbox" />HuggingFace 41 tasks working
correctly</label></li>
<li><label><input type="checkbox" />Multi-modal processing
functional</label></li>
<li><label><input type="checkbox" />Fine-tuning workflows
operational</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Data
Integrity</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />All database operations
successful</label></li>
<li><label><input type="checkbox" />Vector embeddings properly
migrated</label></li>
<li><label><input type="checkbox" />User data preserved and
accessible</label></li>
<li><label><input type="checkbox" />Conversation history
intact</label></li>
</ul></li>
</ul>
<h3 data-number="11.2.2" id="performance-requirements"><span
class="header-section-number">11.2.2</span> 10.2.2 Performance
Requirements</h3>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>Response
Times</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />Orchestrator routing: &lt;50ms
p95</label></li>
<li><label><input type="checkbox" />Supervisor processing: &lt;200ms
p95</label></li>
<li><label><input type="checkbox" />End-to-end requests: &lt;2s
p95</label></li>
<li><label><input type="checkbox" />WebSocket message handling:
&lt;100ms p95</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Throughput</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />Handle 100 concurrent
users</label></li>
<li><label><input type="checkbox" />Process 1000 requests/minute
sustained</label></li>
<li><label><input type="checkbox" />Support 50 WebSocket
connections</label></li>
<li><label><input type="checkbox" />Maintain &lt;5% error rate under
load</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Resource
Utilization</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />Memory usage &lt;4GB total (laptop
deployment)</label></li>
<li><label><input type="checkbox" />CPU utilization &lt;70% under normal
load</label></li>
<li><label><input type="checkbox" />Database connections &lt;50
concurrent</label></li>
<li><label><input type="checkbox" />Disk I/O within acceptable
limits</label></li>
</ul></li>
</ul>
<h3 data-number="11.2.3" id="observability-requirements"><span
class="header-section-number">11.2.3</span> 10.2.3 Observability
Requirements</h3>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>Distributed
Tracing</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />End-to-end trace completeness
&gt;99%</label></li>
<li><label><input type="checkbox" />Cross-supervisor trace propagation
working</label></li>
<li><label><input type="checkbox" />Custom MCP span attributes
populated</label></li>
<li><label><input type="checkbox" />Trace sampling and retention
configured</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Metrics and
Monitoring</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />All MCP metrics being
collected</label></li>
<li><label><input type="checkbox" />Grafana dashboards
functional</label></li>
<li><label><input type="checkbox" />Alert rules firing
correctly</label></li>
<li><label><input type="checkbox" />Cost tracking
operational</label></li>
</ul></li>
<li><label><input type="checkbox" /><strong>Logging</strong></label>
<ul class="task-list">
<li><label><input type="checkbox" />Structured logs from all
components</label></li>
<li><label><input type="checkbox" />Log aggregation and
searchability</label></li>
<li><label><input type="checkbox" />Error tracking and
notification</label></li>
<li><label><input type="checkbox" />Security audit trail
complete</label></li>
</ul></li>
</ul>
<h2 data-number="11.3" id="rollback-plan"><span
class="header-section-number">11.3</span> 10.3 Rollback Plan</h2>
<h3 data-number="11.3.1" id="rollback-triggers"><span
class="header-section-number">11.3.1</span> 10.3.1 Rollback
Triggers</h3>
<ul>
<li>System-wide error rate exceeds 5% for &gt;10 minutes</li>
<li>End-to-end response time degrades by &gt;300% for &gt;5
minutes<br />
</li>
<li>Critical security vulnerability discovered</li>
<li>Data corruption or loss detected</li>
<li>User-facing functionality completely broken</li>
</ul>
<h3 data-number="11.3.2" id="rollback-procedure"><span
class="header-section-number">11.3.2</span> 10.3.2 Rollback
Procedure</h3>
<ol type="1">
<li><strong>Immediate Actions (0-5 minutes)</strong>
<ul>
<li>Stop new MCP container deployments</li>
<li>Route traffic back to v2 backend</li>
<li>Notify operations team and stakeholders</li>
</ul></li>
<li><strong>Service Restoration (5-15 minutes)</strong>
<ul>
<li>Scale up v2 backend containers</li>
<li>Verify database consistency</li>
<li>Test critical user flows</li>
<li>Monitor error rates and performance</li>
</ul></li>
<li><strong>Investigation Phase (15-60 minutes)</strong>
<ul>
<li>Collect MCP system logs and traces</li>
<li>Identify root cause of failure</li>
<li>Document lessons learned</li>
<li>Plan remediation strategy</li>
</ul></li>
</ol>
<hr />
<h1 data-number="12" id="cost-analysis-and-roi-projections"><span
class="header-section-number">12</span> 11. Cost Analysis and ROI
Projections</h1>
<h2 data-number="12.1" id="migration-costs"><span
class="header-section-number">12.1</span> 11.1 Migration Costs</h2>
<h3 data-number="12.1.1" id="development-investment"><span
class="header-section-number">12.1.1</span> 11.1.1 Development
Investment</h3>
<ul>
<li><p><strong>Engineering Time:</strong> 16 weeks × 2 senior engineers
= 640 hours</p></li>
<li><p><strong>Hourly Rate:</strong> $150/hour average</p></li>
<li><p><strong>Total Development Cost:</strong> $96,000</p></li>
<li><p><strong>Infrastructure Costs During Migration:</strong></p>
<ul>
<li>Additional staging environments: $500/month × 4 months = $2,000</li>
<li>Testing infrastructure: $300/month × 4 months = $1,200</li>
<li>Monitoring and observability tools: $200/month × 4 months =
$800</li>
</ul></li>
<li><p><strong>Training and Documentation:</strong></p>
<ul>
<li>Technical documentation: 80 hours × $100/hour = $8,000</li>
<li>Team training sessions: 40 hours × $150/hour = $6,000</li>
</ul></li>
</ul>
<p><strong>Total Migration Investment:</strong> $114,000</p>
<h3 data-number="12.1.2" id="operational-cost-comparison"><span
class="header-section-number">12.1.2</span> 11.1.2 Operational Cost
Comparison</h3>
<p><strong>Current V2 Architecture (Monthly):</strong> - Server
resources: $800 - Database hosting: $300 - Third-party AI services:
$2,000 - Monitoring/logging: $200 - <strong>Total:</strong>
$3,300/month</p>
<p><strong>New MCP Architecture (Monthly):</strong> - Orchestrator
instances: $400 - Supervisor containers: $600<br />
- Agent processing: $300 - Enhanced database: $350 - Improved
observability: $300 - Third-party AI services: $1,800 (10% savings
through optimization) - <strong>Total:</strong> $3,750/month</p>
<p><strong>Additional Monthly Cost:</strong> $450</p>
<h2 data-number="12.2" id="return-on-investment-analysis"><span
class="header-section-number">12.2</span> 11.2 Return on Investment
Analysis</h2>
<h3 data-number="12.2.1" id="direct-benefits"><span
class="header-section-number">12.2.1</span> 11.2.1 Direct Benefits</h3>
<ul>
<li><strong>Development Velocity:</strong> 40% faster feature
development after migration</li>
<li><strong>Operational Efficiency:</strong> 25% reduction in debugging
time</li>
<li><strong>Cost Optimization:</strong> 15% reduction in AI service
costs through intelligent routing</li>
<li><strong>Scaling Efficiency:</strong> 60% better resource
utilization</li>
</ul>
<h3 data-number="12.2.2" id="roi-calculations"><span
class="header-section-number">12.2.2</span> 11.2.2 ROI Calculations</h3>
<p><strong>Year 1 Benefits:</strong> - Faster development: 200 hours
saved × $150/hour = $30,000 - Reduced debugging: 100 hours saved ×
$150/hour = $15,000 - AI cost savings: $2,000 × 12 months × 15% = $3,600
- <strong>Total Year 1 Benefits:</strong> $48,600</p>
<p><strong>Year 2-3 Benefits (Annual):</strong> - Development velocity
gains: $40,000/year - Operational efficiency: $20,000/year - AI
optimization: $4,000/year<br />
- Improved user retention (estimated): $25,000/year - <strong>Annual
Benefits Years 2-3:</strong> $89,000</p>
<p><strong>3-Year ROI:</strong> - Total Investment: $114,000 - Total
Benefits: $48,600 + $89,000 + $89,000 = $226,600 - <strong>Net ROI:
98.8%</strong> - <strong>Payback Period: 18 months</strong></p>
<hr />
<h1 data-number="13" id="risk-assessment-and-mitigation"><span
class="header-section-number">13</span> 12. Risk Assessment and
Mitigation</h1>
<h2 data-number="13.1" id="technical-risks"><span
class="header-section-number">13.1</span> 12.1 Technical Risks</h2>
<h3 data-number="13.1.1" id="high-impact-risks"><span
class="header-section-number">13.1.1</span> 12.1.1 High-Impact
Risks</h3>
<p><strong>Risk: MCP Protocol Performance Bottleneck</strong> -
<strong>Impact:</strong> System-wide latency increase, poor user
experience - <strong>Probability:</strong> Medium (30%) -
<strong>Mitigation:</strong> Extensive load testing, performance
profiling, async message processing - <strong>Contingency:</strong>
Protocol optimization patches, caching layers, request batching</p>
<p><strong>Risk: OpenTelemetry Trace Fragmentation</strong> -
<strong>Impact:</strong> Difficult debugging, incomplete observability -
<strong>Probability:</strong> Medium (25%) -
<strong>Mitigation:</strong> Thorough context propagation testing, trace
validation tools - <strong>Contingency:</strong> Fallback to structured
logging, trace reconstruction tools</p>
<p><strong>Risk: Database Migration Failures</strong> -
<strong>Impact:</strong> Data loss, extended downtime -
<strong>Probability:</strong> Low (10%) - <strong>Mitigation:</strong>
Comprehensive backups, staged migration, rollback procedures -
<strong>Contingency:</strong> Point-in-time recovery, manual data
reconstruction</p>
<h3 data-number="13.1.2" id="medium-impact-risks"><span
class="header-section-number">13.1.2</span> 12.1.2 Medium-Impact
Risks</h3>
<p><strong>Risk: Agent Compatibility Issues</strong> -
<strong>Impact:</strong> Specific agent functionality broken -
<strong>Probability:</strong> High (60%) - <strong>Mitigation:</strong>
Gradual agent migration, compatibility testing, wrapper patterns -
<strong>Contingency:</strong> Temporary direct agent access, rapid
patches</p>
<p><strong>Risk: Resource Consumption Spikes</strong> -
<strong>Impact:</strong> System instability, increased costs -
<strong>Probability:</strong> Medium (40%) -
<strong>Mitigation:</strong> Resource limits, monitoring, auto-scaling
policies - <strong>Contingency:</strong> Emergency resource scaling,
load shedding</p>
<h2 data-number="13.2" id="business-risks"><span
class="header-section-number">13.2</span> 12.2 Business Risks</h2>
<h3 data-number="13.2.1" id="project-timeline-risks"><span
class="header-section-number">13.2.1</span> 12.2.1 Project Timeline
Risks</h3>
<ul>
<li><strong>Development Overruns:</strong> Add 25% buffer to all phase
estimates</li>
<li><strong>Integration Complexities:</strong> Allocate dedicated
integration testing phases</li>
<li><strong>Third-Party Dependencies:</strong> Identify critical
dependencies early, have alternatives</li>
</ul>
<h3 data-number="13.2.2" id="user-impact-risks"><span
class="header-section-number">13.2.2</span> 12.2.2 User Impact
Risks</h3>
<ul>
<li><strong>Service Disruption:</strong> Maintain 99.5% uptime during
migration</li>
<li><strong>Feature Regression:</strong> Comprehensive regression
testing before each phase</li>
<li><strong>Performance Degradation:</strong> Continuous performance
monitoring and optimization</li>
</ul>
<h2 data-number="13.3" id="risk-mitigation-framework"><span
class="header-section-number">13.3</span> 12.3 Risk Mitigation
Framework</h2>
<h3 data-number="13.3.1" id="risk-monitoring-dashboard"><span
class="header-section-number">13.3.1</span> 12.3.1 Risk Monitoring
Dashboard</h3>
<div class="sourceCode" id="cb38"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> RiskMetric {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  current_value<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  warning_threshold<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  critical_threshold<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  trend<span class="op">:</span> <span class="st">&#39;improving&#39;</span> <span class="op">|</span> <span class="st">&#39;stable&#39;</span> <span class="op">|</span> <span class="st">&#39;degrading&#39;</span><span class="op">;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> migrationRisks<span class="op">:</span> RiskMetric[] <span class="op">=</span> [</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="st">&#39;MCP Message Latency&#39;</span><span class="op">,</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    current_value<span class="op">:</span> <span class="dv">45</span><span class="op">,</span> <span class="co">// ms</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    warning_threshold<span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    critical_threshold<span class="op">:</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    trend<span class="op">:</span> <span class="st">&#39;stable&#39;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="st">&#39;Trace Completeness&#39;</span><span class="op">,</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    current_value<span class="op">:</span> <span class="fl">98.5</span><span class="op">,</span> <span class="co">// percentage  </span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    warning_threshold<span class="op">:</span> <span class="dv">95</span><span class="op">,</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    critical_threshold<span class="op">:</span> <span class="dv">90</span><span class="op">,</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    trend<span class="op">:</span> <span class="st">&#39;improving&#39;</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... additional metrics</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div>
<hr />
<h1 data-number="14" id="future-evolution-and-extensibility"><span
class="header-section-number">14</span> 13. Future Evolution and
Extensibility</h1>
<h2 data-number="14.1" id="post-migration-enhancement-roadmap"><span
class="header-section-number">14.1</span> 13.1 Post-Migration
Enhancement Roadmap</h2>
<h3 data-number="14.1.1"
id="phase-7-advanced-intelligence-q4-2025"><span
class="header-section-number">14.1.1</span> 13.1.1 Phase 7: Advanced
Intelligence (Q4 2025)</h3>
<ul>
<li><strong>Federated Learning:</strong> Multi-instance knowledge
sharing between Cartrita deployments</li>
<li><strong>Advanced Reasoning:</strong> Chain-of-thought and
tree-search planning capabilities</li>
<li><strong>Custom Model Integration:</strong> Support for locally
fine-tuned models</li>
<li><strong>Quantum-Classical Hybrid:</strong> Integration with quantum
computing simulators</li>
</ul>
<h3 data-number="14.1.2"
id="phase-8-ecosystem-integration-q1-2026"><span
class="header-section-number">14.1.2</span> 13.1.2 Phase 8: Ecosystem
Integration (Q1 2026)</h3>
<ul>
<li><strong>Third-Party AI Services:</strong> Anthropic, Cohere,
Stability AI integrations</li>
<li><strong>Enterprise Connectors:</strong> Salesforce, ServiceNow, JIRA
integrations<br />
</li>
<li><strong>API Marketplace:</strong> User-contributed agent and tool
marketplace</li>
<li><strong>White-Label Platform:</strong> Cartrita-as-a-Service
offering</li>
</ul>
<h3 data-number="14.1.3" id="phase-9-mobile-and-edge-q2-2026"><span
class="header-section-number">14.1.3</span> 13.1.3 Phase 9: Mobile and
Edge (Q2 2026)</h3>
<ul>
<li><strong>Mobile Apps:</strong> Native iOS and Android
applications</li>
<li><strong>Edge Computing:</strong> On-device model execution for
privacy</li>
<li><strong>Offline Capabilities:</strong> Core functionality without
internet connection</li>
<li><strong>IoT Integration:</strong> Smart home and device control
capabilities</li>
</ul>
<h2 data-number="14.2" id="architectural-evolution-patterns"><span
class="header-section-number">14.2</span> 13.2 Architectural Evolution
Patterns</h2>
<h3 data-number="14.2.1" id="micro-supervisor-pattern"><span
class="header-section-number">14.2.1</span> 13.2.1 Micro-Supervisor
Pattern</h3>
<div class="sourceCode" id="cb39"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Future: Domain-specific micro-supervisors</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> MicroSupervisor {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  domain<span class="op">:</span> <span class="st">&#39;finance&#39;</span> <span class="op">|</span> <span class="st">&#39;health&#39;</span> <span class="op">|</span> <span class="st">&#39;education&#39;</span> <span class="op">|</span> <span class="st">&#39;creative&#39;</span><span class="op">;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  agents<span class="op">:</span> Agent[]<span class="op">;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  policies<span class="op">:</span> DomainPolicy[]<span class="op">;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  compliance<span class="op">:</span> ComplianceRule[]<span class="op">;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FinanceMicroSupervisor <span class="kw">implements</span> MicroSupervisor {</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  domain <span class="op">=</span> <span class="st">&#39;finance&#39;</span><span class="op">;</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">processFinancialQuery</span>(query<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>FinancialResponse<span class="op">&gt;</span> {</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Specialized financial processing logic</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Compliance-aware agent coordination</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Audit trail generation</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="14.2.2" id="dynamic-agent-marketplace"><span
class="header-section-number">14.2.2</span> 13.2.2 Dynamic Agent
Marketplace</h3>
<div class="sourceCode" id="cb40"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> AgentMarketplace {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discoverAgents</span>(criteria<span class="op">:</span> SearchCriteria)<span class="op">:</span> Agent[]<span class="op">;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">installAgent</span>(agentId<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> supervisorId<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rateAgent</span>(agentId<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> rating<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> review<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateAgent</span>(agentId<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DynamicAgentLoader {</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">loadAgentRuntime</span>(agentPackage<span class="op">:</span> AgentPackage)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>Agent<span class="op">&gt;</span> {</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Security validation</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validatePackageSecurity</span>(agentPackage)<span class="op">;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sandboxed execution environment</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sandbox <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createSandbox</span>(agentPackage<span class="op">.</span><span class="at">requirements</span>)<span class="op">;</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load and initialize agent</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> sandbox<span class="op">.</span><span class="fu">loadAgent</span>(agentPackage<span class="op">.</span><span class="at">code</span>)<span class="op">;</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h1 data-number="15" id="conclusion-and-next-steps"><span
class="header-section-number">15</span> 14. Conclusion and Next
Steps</h1>
<h2 data-number="15.1" id="executive-summary-1"><span
class="header-section-number">15.1</span> 14.1 Executive Summary</h2>
<p>The transformation of Cartrita from a flat multi-agent system into a
hierarchical Master Control Program represents a significant
architectural evolution that will:</p>
<ol type="1">
<li><strong>Improve System Reliability:</strong> Clear separation of
concerns and fault isolation</li>
<li><strong>Enable Better Resource Management:</strong> Intelligent
allocation and cost optimization<br />
</li>
<li><strong>Enhance Observability:</strong> End-to-end tracing and
monitoring capabilities</li>
<li><strong>Provide Future Scalability:</strong> Foundation for advanced
AI capabilities and integrations</li>
<li><strong>Maintain Backward Compatibility:</strong> Seamless migration
with minimal user disruption</li>
</ol>
<h2 data-number="15.2" id="critical-success-factors"><span
class="header-section-number">15.2</span> 14.2 Critical Success
Factors</h2>
<h3 data-number="15.2.1" id="technical-excellence"><span
class="header-section-number">15.2.1</span> 14.2.1 Technical
Excellence</h3>
<ul>
<li>Rigorous testing at every migration phase</li>
<li>Performance monitoring and optimization throughout</li>
<li>Comprehensive observability from day one</li>
<li>Security and compliance built-in, not bolted-on</li>
</ul>
<h3 data-number="15.2.2" id="project-management"><span
class="header-section-number">15.2.2</span> 14.2.2 Project
Management</h3>
<ul>
<li>Clear phase gates with objective success criteria</li>
<li>Risk-aware planning with contingency procedures</li>
<li>Regular stakeholder communication and expectation management</li>
<li>Dedicated migration team with clear accountability</li>
</ul>
<h3 data-number="15.2.3" id="operational-readiness"><span
class="header-section-number">15.2.3</span> 14.2.3 Operational
Readiness</h3>
<ul>
<li>Production deployment procedures tested and documented</li>
<li>Monitoring and alerting configured before go-live</li>
<li>Support team trained on new architecture</li>
<li>Rollback procedures validated and ready</li>
</ul>
<h2 data-number="15.3" id="immediate-next-steps-week-1-2"><span
class="header-section-number">15.3</span> 14.3 Immediate Next Steps
(Week 1-2)</h2>
<ol type="1">
<li><strong>Team Formation and Planning</strong>
<ul class="task-list">
<li><label><input type="checkbox" />Assemble migration team (2 senior
engineers, 1 DevOps, 1 QA)</label></li>
<li><label><input type="checkbox" />Create detailed project plan with
milestones</label></li>
<li><label><input type="checkbox" />Set up project tracking and
communication channels</label></li>
<li><label><input type="checkbox" />Establish stakeholder review and
approval processes</label></li>
</ul></li>
<li><strong>Infrastructure Preparation</strong>
<ul class="task-list">
<li><label><input type="checkbox" />Set up development and staging
environments</label></li>
<li><label><input type="checkbox" />Configure observability stack
(OpenTelemetry, Jaeger, Prometheus)</label></li>
<li><label><input type="checkbox" />Establish CI/CD pipelines for new
packages</label></li>
<li><label><input type="checkbox" />Create database migration testing
environment</label></li>
</ul></li>
<li><strong>Technical Foundation</strong>
<ul class="task-list">
<li><label><input type="checkbox" />Create MCP core library package
structure</label></li>
<li><label><input type="checkbox" />Implement basic message protocol and
validation</label></li>
<li><label><input type="checkbox" />Set up testing frameworks and
quality gates</label></li>
<li><label><input type="checkbox" />Begin orchestrator package
development</label></li>
</ul></li>
<li><strong>Documentation and Communication</strong>
<ul class="task-list">
<li><label><input type="checkbox" />Create migration documentation
repository</label></li>
<li><label><input type="checkbox" />Set up architecture decision record
(ADR) process<br />
</label></li>
<li><label><input type="checkbox" />Establish weekly stakeholder
updates</label></li>
<li><label><input type="checkbox" />Create migration status
dashboard</label></li>
</ul></li>
</ol>
<h2 data-number="15.4" id="long-term-vision"><span
class="header-section-number">15.4</span> 14.4 Long-Term Vision</h2>
<p>By completing this hierarchical MCP transformation, Cartrita will be
positioned as a leading Personal AI Operating System with:</p>
<ul>
<li><strong>Industry-Leading Architecture:</strong> Three-tier
hierarchical design with standardized MCP communication</li>
<li><strong>Production-Grade Reliability:</strong> Comprehensive
observability, security, and operational practices</li>
<li><strong>Unlimited Scalability:</strong> Foundation for future AI
advances and integrations</li>
<li><strong>Developer-Friendly Platform:</strong> Clear APIs and
extension points for third-party contributions</li>
</ul>
<p>The investment in this migration will pay dividends for years to
come, establishing Cartrita as a truly revolutionary AI system that can
adapt and grow with the rapidly evolving AI landscape.</p>
<hr />
<h1 data-number="16" id="appendices"><span
class="header-section-number">16</span> Appendices</h1>
<h2 data-number="16.1"
id="appendix-a-complete-docker-compose-configuration"><span
class="header-section-number">16.1</span> Appendix A: Complete Docker
Compose Configuration</h2>
<div class="sourceCode" id="cb41"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker-compose.production.yml</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # Main Orchestrator</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">orchestrator</span><span class="kw">:</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-orchestrator</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8001:8001&quot;</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> NODE_ENV=production</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> DATABASE_URL=postgresql://cartrita:${DB_PASSWORD}@postgres:5432/cartrita</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> REDIS_URL=redis://redis:6379</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_SERVICE_NAME=cartrita-orchestrator</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CMD&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;curl&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;-f&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;http://localhost:8001/health&quot;</span><span class="kw">]</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 30s</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 10s</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co">  # Intelligence Supervisor</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">supervisor-intelligence</span><span class="kw">:</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-supervisor</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span><span class="at"> intelligence-supervisor</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> NODE_ENV=production</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SUPERVISOR_TYPE=intelligence</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OPENAI_API_KEY=${OPENAI_API_KEY}</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> HUGGINGFACE_API_TOKEN=${HUGGINGFACE_API_TOKEN}</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_SERVICE_NAME=cartrita-intelligence-supervisor</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 2G</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cpus</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;2.0&#39;</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="co">  # Multi-Modal Supervisor</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">supervisor-multimodal</span><span class="kw">:</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-supervisor</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span><span class="at"> multimodal-supervisor</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> NODE_ENV=production</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SUPERVISOR_TYPE=multimodal</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> DEEPGRAM_API_KEY=${DEEPGRAM_API_KEY}</span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_SERVICE_NAME=cartrita-multimodal-supervisor</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="co">  # System Supervisor</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">supervisor-system</span><span class="kw">:</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile.mcp-supervisor</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span><span class="at"> system-supervisor</span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> NODE_ENV=production</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SUPERVISOR_TYPE=system</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}</span></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317</span></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> OTEL_SERVICE_NAME=cartrita-system-supervisor</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="co">  # Database</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ankane/pgvector:15</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_DB=cartrita</span></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_USER=cartrita</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_PASSWORD=${DB_PASSWORD}</span></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./db-init:/docker-entrypoint-initdb.d</span></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CMD-SHELL&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;pg_isready -U cartrita -d cartrita&quot;</span><span class="kw">]</span></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 10s</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 5s</span></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a><span class="co">  # Redis Cache</span></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> redis:7-alpine</span></span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> redis-server --appendonly yes</span></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> redis_data:/data</span></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CMD&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;redis-cli&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;ping&quot;</span><span class="kw">]</span></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 10s</span></span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 3s</span></span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a><span class="co">  # OpenTelemetry Collector</span></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">otel-collector</span><span class="kw">:</span></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> otel/opentelemetry-collector-contrib:0.97.0</span></span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;--config=/etc/otel-collector-config.yml&quot;</span><span class="kw">]</span></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./otel-collector-config.yml:/etc/otel-collector-config.yml</span></span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;4317:4317&quot;</span><span class="co">   # OTLP gRPC</span></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;4318:4318&quot;</span><span class="co">   # OTLP HTTP  </span></span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8889:8889&quot;</span><span class="co">   # Prometheus metrics</span></span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a><span class="co">  # Jaeger</span></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">jaeger</span><span class="kw">:</span></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> jaegertracing/all-in-one:1.47</span></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;16686:16686&quot;</span><span class="co">  # Jaeger UI</span></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;14268:14268&quot;</span><span class="co">  # Jaeger collector</span></span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> COLLECTOR_OTLP_ENABLED=true</span></span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a><span class="co">  # Prometheus  </span></span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">prometheus</span><span class="kw">:</span></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> prom/prometheus:v2.47.0</span></span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span></span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;--storage.tsdb.path=/prometheus&#39;</span></span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;--web.console.libraries=/etc/prometheus/console_libraries&#39;</span></span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;--web.console.templates=/etc/prometheus/consoles&#39;</span></span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;--web.enable-lifecycle&#39;</span></span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9090:9090&quot;</span></span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> prometheus_data:/prometheus</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a><span class="co">  # Grafana</span></span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">grafana</span><span class="kw">:</span></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> grafana/grafana:10.1.0</span></span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3000:3000&quot;</span></span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}</span></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> grafana_data:/var/lib/grafana</span></span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./grafana/dashboards:/etc/grafana/provisioning/dashboards</span></span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./grafana/datasources:/etc/grafana/provisioning/datasources</span></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mcp-network</span></span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mcp-network</span><span class="kw">:</span></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> bridge</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis_data</span><span class="kw">:</span></span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">prometheus_data</span><span class="kw">:</span></span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">grafana_data</span><span class="kw">:</span></span></code></pre></div>
<h2 data-number="16.2"
id="appendix-b-mcp-protocol-buffer-definitions"><span
class="header-section-number">16.2</span> Appendix B: MCP Protocol
Buffer Definitions</h2>
<div class="sourceCode" id="cb42"><pre
class="sourceCode protobuf"><code class="sourceCode protobuf"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">// mcp.proto - Protocol Buffer definitions for MCP messages</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>syntax = <span class="st">&quot;proto3&quot;</span>;</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> cartrita.mcp.v1;</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="kw">option</span> go_package = <span class="st">&quot;github.com/cartrita/mcp/proto/v1&quot;</span>;</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Core MCP message envelope</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> MCPMessage {</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Message identity and routing</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> id = <span class="dv">1</span>;</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> parent_id = <span class="dv">2</span>;</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> correlation_id = <span class="dv">3</span>;</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> sender = <span class="dv">4</span>;</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> recipient = <span class="dv">5</span>;</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> broadcast = <span class="dv">6</span>;</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Lifecycle management</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int64</span> timestamp = <span class="dv">7</span>;</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> ttl_ms = <span class="dv">8</span>;</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  Priority priority = <span class="dv">9</span>;</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Context propagation</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  MCPContext context = <span class="dv">10</span>;</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Message content</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  MCPMessageType type = <span class="dv">11</span>;</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Any payload = <span class="dv">12</span>;</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Delivery guarantees</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  DeliveryMode delivery_mode = <span class="dv">13</span>;</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> retry_count = <span class="dv">14</span>;</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> max_retries = <span class="dv">15</span>;</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> MCPContext {</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> user_id = <span class="dv">1</span>;</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> conversation_id = <span class="dv">2</span>;</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> trace_id = <span class="dv">3</span>;</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> span_id = <span class="dv">4</span>;</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> session_id = <span class="dv">5</span>;</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> workspace_id = <span class="dv">6</span>;</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>  map&lt;<span class="dt">string</span>, <span class="dt">string</span>&gt; custom_attributes = <span class="dv">7</span>;</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> MCPMessageType {</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  UNKNOWN = <span class="dv">0</span>;</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  PING = <span class="dv">1</span>;</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>  PONG = <span class="dv">2</span>;</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>  HEARTBEAT = <span class="dv">3</span>;</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>  SHUTDOWN = <span class="dv">4</span>;</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>  TASK_REQUEST = <span class="dv">5</span>;</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>  TASK_RESPONSE = <span class="dv">6</span>;</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>  TASK_ERROR = <span class="dv">7</span>;</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>  TASK_PROGRESS = <span class="dv">8</span>;</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>  RESOURCE_REQUEST = <span class="dv">9</span>;</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>  RESOURCE_GRANT = <span class="dv">10</span>;</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>  RESOURCE_DENY = <span class="dv">11</span>;</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>  STREAM_START = <span class="dv">12</span>;</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>  STREAM_DATA = <span class="dv">13</span>;</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>  STREAM_END = <span class="dv">14</span>;</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Priority {</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>  LOW = <span class="dv">0</span>;</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>  NORMAL = <span class="dv">1</span>;</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>  HIGH = <span class="dv">2</span>;</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a>  CRITICAL = <span class="dv">3</span>;</span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> DeliveryMode {</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a>  AT_MOST_ONCE = <span class="dv">0</span>;</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>  AT_LEAST_ONCE = <span class="dv">1</span>;</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>  EXACTLY_ONCE = <span class="dv">2</span>;</span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a><span class="co">// Task-specific message payloads</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> TaskRequest {</span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>  Task task = <span class="dv">1</span>;</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a>  TaskInput input = <span class="dv">2</span>;</span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>  TaskPreferences preferences = <span class="dv">3</span>;</span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> Task {</span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> type = <span class="dv">1</span>;</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a>  map&lt;<span class="dt">string</span>, google.protobuf.Value&gt; parameters = <span class="dv">2</span>;</span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a>  TaskConstraints constraints = <span class="dv">3</span>;</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> TaskConstraints {</span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> max_execution_time_ms = <span class="dv">1</span>;</span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> max_memory_mb = <span class="dv">2</span>;</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> max_cost_usd = <span class="dv">3</span>;</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> TaskInput {</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Value data = <span class="dv">1</span>;</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a>  <span class="kw">repeated</span> FileInput files = <span class="dv">2</span>;</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> FileInput {</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> name = <span class="dv">1</span>;</span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> content_type = <span class="dv">2</span>;</span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int64</span> size_bytes = <span class="dv">3</span>;</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> url = <span class="dv">4</span>;</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bytes</span> inline_data = <span class="dv">5</span>;</span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> TaskPreferences {</span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>  QualityLevel quality_level = <span class="dv">1</span>;</span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> cost_optimization = <span class="dv">2</span>;</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> streaming = <span class="dv">3</span>;</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> QualityLevel {</span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a>  FAST = <span class="dv">0</span>;</span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>  BALANCED = <span class="dv">1</span>;</span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>  BEST = <span class="dv">2</span>;</span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> TaskResponse {</span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>  TaskStatus status = <span class="dv">1</span>;</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>  google.protobuf.Value result = <span class="dv">2</span>;</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a>  TaskMetrics metrics = <span class="dv">3</span>;</span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> error_message = <span class="dv">4</span>;</span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> TaskStatus {</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>  PENDING = <span class="dv">0</span>;</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>  IN_PROGRESS = <span class="dv">1</span>;</span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a>  COMPLETED = <span class="dv">2</span>;</span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>  FAILED = <span class="dv">3</span>;</span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>  CANCELLED = <span class="dv">4</span>;</span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> TaskMetrics {</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int64</span> processing_time_ms = <span class="dv">1</span>;</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> memory_used_mb = <span class="dv">2</span>;</span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> cost_usd = <span class="dv">3</span>;</span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int32</span> tokens_used = <span class="dv">4</span>;</span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> quality_score = <span class="dv">5</span>;</span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a><span class="co">// Service definitions</span></span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a>service MCPService {</span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>  rpc SendMessage(MCPMessage) returns (MCPMessage);</span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>  rpc StreamMessages(stream MCPMessage) returns (stream MCPMessage);</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>  rpc GetHealth(HealthRequest) returns (HealthResponse);</span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> HealthRequest {</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> include_details = <span class="dv">1</span>;</span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a><span class="kw">message</span> HealthResponse {</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> healthy = <span class="dv">1</span>;</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>  <span class="dt">string</span> version = <span class="dv">2</span>;</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a>  map&lt;<span class="dt">string</span>, <span class="dt">string</span>&gt; details = <span class="dv">3</span>;</span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 data-number="16.3"
id="appendix-c-migration-phase-checklist-template"><span
class="header-section-number">16.3</span> Appendix C: Migration Phase
Checklist Template</h2>
<div class="sourceCode" id="cb43"><pre
class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Phase X Migration Checklist</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pre-Phase Requirements</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> All previous phases completed successfully</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Test environment updated and functional  </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Backup procedures verified</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Team availability confirmed</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Stakeholder approval received</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## Development Tasks</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Task 1:** <span class="co">[</span><span class="ot">Description</span><span class="co">]</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Implementation complete</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Unit tests passing</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Code review approved</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Documentation updated</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Task 2:** <span class="co">[</span><span class="ot">Description</span><span class="co">]</span>  </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Implementation complete</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Integration tests passing</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Performance validated</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Security review complete</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Testing Requirements</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Unit Tests**</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> New code coverage &gt;95%</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> All tests passing</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Performance benchmarks met</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Integration Tests**</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> End-to-end workflows verified</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Cross-component communication tested</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Error handling validated</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Performance Tests**</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Load testing completed</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Memory usage within limits</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Response times acceptable</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Deployment Checklist</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Pre-Deployment**</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Staging environment updated</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Database migrations tested</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Configuration validated</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Monitoring configured</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Deployment Execution**</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Blue-green deployment initiated</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Health checks passing</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Smoke tests successful</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Rollback plan ready</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Post-Deployment**</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Monitoring dashboards updated</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Performance metrics validated</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> User acceptance testing</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Documentation published</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Success Criteria Validation</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Functional Requirements**</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> All specified features working</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> No regressions detected</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> User workflows functional</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> **Non-Functional Requirements**</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Performance targets met</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Security requirements satisfied</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="va">[ ]</span> Reliability metrics achieved</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Phase Completion</span></span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> All checklist items completed</span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Stakeholder sign-off received</span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Next phase preparation started</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Lessons learned documented</span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>**Phase Completion Date:** ___________  </span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>**Approved By:** ___________  </span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>**Notes:** ___________</span></code></pre></div>
<hr />
<p><em>This completes the 20-page comprehensive migration guide for
transforming Cartrita into a hierarchical Master Control Program. The
document provides detailed implementation strategies, code examples,
deployment procedures, and success criteria to ensure a successful
migration while maintaining all existing functionality and improving
system architecture.</em></p>
</body>
</html>
